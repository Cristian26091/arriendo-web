(self.webpackChunkreal_state_web=self.webpackChunkreal_state_web||[]).push([[179],{25:(M0,Lp,Op)=>{"use strict";function sr(n){return"function"==typeof n}function wm(n){const t=n(i=>{Error.call(i),i.stack=(new Error).stack});return t.prototype=Object.create(Error.prototype),t.prototype.constructor=t,t}const C0=wm(n=>function(t){n(this),this.message=t?`${t.length} errors occurred during unsubscription:\n${t.map((i,r)=>`${r+1}) ${i.toString()}`).join("\n  ")}`:"",this.name="UnsubscriptionError",this.errors=t});function g(n,e){if(n){const t=n.indexOf(e);0<=t&&n.splice(t,1)}}class lt{constructor(e){this.initialTeardown=e,this.closed=!1,this._parentage=null,this._finalizers=null}unsubscribe(){let e;if(!this.closed){this.closed=!0;const{_parentage:t}=this;if(t)if(this._parentage=null,Array.isArray(t))for(const s of t)s.remove(this);else t.remove(this);const{initialTeardown:i}=this;if(sr(i))try{i()}catch(s){e=s instanceof C0?s.errors:[s]}const{_finalizers:r}=this;if(r){this._finalizers=null;for(const s of r)try{wi(s)}catch(c){e=e??[],c instanceof C0?e=[...e,...c.errors]:e.push(c)}}if(e)throw new C0(e)}}add(e){var t;if(e&&e!==this)if(this.closed)wi(e);else{if(e instanceof lt){if(e.closed||e._hasParent(this))return;e._addParent(this)}(this._finalizers=null!==(t=this._finalizers)&&void 0!==t?t:[]).push(e)}}_hasParent(e){const{_parentage:t}=this;return t===e||Array.isArray(t)&&t.includes(e)}_addParent(e){const{_parentage:t}=this;this._parentage=Array.isArray(t)?(t.push(e),t):t?[t,e]:e}_removeParent(e){const{_parentage:t}=this;t===e?this._parentage=null:Array.isArray(t)&&g(t,e)}remove(e){const{_finalizers:t}=this;t&&g(t,e),e instanceof lt&&e._removeParent(this)}}lt.EMPTY=(()=>{const n=new lt;return n.closed=!0,n})();const Al=lt.EMPTY;function Aa(n){return n instanceof lt||n&&"closed"in n&&sr(n.remove)&&sr(n.add)&&sr(n.unsubscribe)}function wi(n){sr(n)?n():n.unsubscribe()}const mi={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1},Ss={setTimeout(n,e,...t){const{delegate:i}=Ss;return i?.setTimeout?i.setTimeout(n,e,...t):setTimeout(n,e,...t)},clearTimeout(n){const{delegate:e}=Ss;return(e?.clearTimeout||clearTimeout)(n)},delegate:void 0};function ro(n){Ss.setTimeout(()=>{const{onUnhandledError:e}=mi;if(!e)throw n;e(n)})}function Ja(){}const hh=Pc("C",void 0,void 0);function Pc(n,e,t){return{kind:n,value:e,error:t}}let Ia=null;function Ht(n){if(mi.useDeprecatedSynchronousErrorHandling){const e=!Ia;if(e&&(Ia={errorThrown:!1,error:null}),n(),e){const{errorThrown:t,error:i}=Ia;if(Ia=null,t)throw i}}else n()}class Kl extends lt{constructor(e){super(),this.isStopped=!1,e?(this.destination=e,Aa(e)&&e.add(this)):this.destination=Ei}static create(e,t,i){return new xu(e,t,i)}next(e){this.isStopped?wu(function Il(n){return Pc("N",n,void 0)}(e),this):this._next(e)}error(e){this.isStopped?wu(function ph(n){return Pc("E",void 0,n)}(e),this):(this.isStopped=!0,this._error(e))}complete(){this.isStopped?wu(hh,this):(this.isStopped=!0,this._complete())}unsubscribe(){this.closed||(this.isStopped=!0,super.unsubscribe(),this.destination=null)}_next(e){this.destination.next(e)}_error(e){try{this.destination.error(e)}finally{this.unsubscribe()}}_complete(){try{this.destination.complete()}finally{this.unsubscribe()}}}const Fp=Function.prototype.bind;function Si(n,e){return Fp.call(n,e)}class Es{constructor(e){this.partialObserver=e}next(e){const{partialObserver:t}=this;if(t.next)try{t.next(e)}catch(i){bu(i)}}error(e){const{partialObserver:t}=this;if(t.error)try{t.error(e)}catch(i){bu(i)}else bu(e)}complete(){const{partialObserver:e}=this;if(e.complete)try{e.complete()}catch(t){bu(t)}}}class xu extends Kl{constructor(e,t,i){let r;if(super(),sr(e)||!e)r={next:e??void 0,error:t??void 0,complete:i??void 0};else{let s;this&&mi.useDeprecatedNextContext?(s=Object.create(e),s.unsubscribe=()=>this.unsubscribe(),r={next:e.next&&Si(e.next,s),error:e.error&&Si(e.error,s),complete:e.complete&&Si(e.complete,s)}):r=e}this.destination=new Es(r)}}function bu(n){mi.useDeprecatedSynchronousErrorHandling?function Pa(n){mi.useDeprecatedSynchronousErrorHandling&&Ia&&(Ia.errorThrown=!0,Ia.error=n)}(n):ro(n)}function wu(n,e){const{onStoppedNotification:t}=mi;t&&Ss.setTimeout(()=>t(n,e))}const Ei={closed:!0,next:Ja,error:function fh(n){throw n},complete:Ja},Mu="function"==typeof Symbol&&Symbol.observable||"@@observable";function Wo(n){return n}function kc(n){return 0===n.length?Wo:1===n.length?n[0]:function(t){return n.reduce((i,r)=>r(i),t)}}let ci=(()=>{class n{constructor(t){t&&(this._subscribe=t)}lift(t){const i=new n;return i.source=this,i.operator=t,i}subscribe(t,i,r){const s=function Ql(n){return n&&n instanceof Kl||function mh(n){return n&&sr(n.next)&&sr(n.error)&&sr(n.complete)}(n)&&Aa(n)}(t)?t:new xu(t,i,r);return Ht(()=>{const{operator:c,source:d}=this;s.add(c?c.call(s,d):d?this._subscribe(s):this._trySubscribe(s))}),s}_trySubscribe(t){try{return this._subscribe(t)}catch(i){t.error(i)}}forEach(t,i){return new(i=Cu(i))((r,s)=>{const c=new xu({next:d=>{try{t(d)}catch(m){s(m),c.unsubscribe()}},error:s,complete:r});this.subscribe(c)})}_subscribe(t){var i;return null===(i=this.source)||void 0===i?void 0:i.subscribe(t)}[Mu](){return this}pipe(...t){return kc(t)(this)}toPromise(t){return new(t=Cu(t))((i,r)=>{let s;this.subscribe(c=>s=c,c=>r(c),()=>i(s))})}}return n.create=e=>new n(e),n})();function Cu(n){var e;return null!==(e=n??mi.Promise)&&void 0!==e?e:Promise}const Pl=wm(n=>function(){n(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"});let si=(()=>{class n extends ci{constructor(){super(),this.closed=!1,this.currentObservers=null,this.observers=[],this.isStopped=!1,this.hasError=!1,this.thrownError=null}lift(t){const i=new Lc(this,this);return i.operator=t,i}_throwIfClosed(){if(this.closed)throw new Pl}next(t){Ht(()=>{if(this._throwIfClosed(),!this.isStopped){this.currentObservers||(this.currentObservers=Array.from(this.observers));for(const i of this.currentObservers)i.next(t)}})}error(t){Ht(()=>{if(this._throwIfClosed(),!this.isStopped){this.hasError=this.isStopped=!0,this.thrownError=t;const{observers:i}=this;for(;i.length;)i.shift().error(t)}})}complete(){Ht(()=>{if(this._throwIfClosed(),!this.isStopped){this.isStopped=!0;const{observers:t}=this;for(;t.length;)t.shift().complete()}})}unsubscribe(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null}get observed(){var t;return(null===(t=this.observers)||void 0===t?void 0:t.length)>0}_trySubscribe(t){return this._throwIfClosed(),super._trySubscribe(t)}_subscribe(t){return this._throwIfClosed(),this._checkFinalizedStatuses(t),this._innerSubscribe(t)}_innerSubscribe(t){const{hasError:i,isStopped:r,observers:s}=this;return i||r?Al:(this.currentObservers=null,s.push(t),new lt(()=>{this.currentObservers=null,g(s,t)}))}_checkFinalizedStatuses(t){const{hasError:i,thrownError:r,isStopped:s}=this;i?t.error(r):s&&t.complete()}asObservable(){const t=new ci;return t.source=this,t}}return n.create=(e,t)=>new Lc(e,t),n})();class Lc extends si{constructor(e,t){super(),this.destination=e,this.source=t}next(e){var t,i;null===(i=null===(t=this.destination)||void 0===t?void 0:t.next)||void 0===i||i.call(t,e)}error(e){var t,i;null===(i=null===(t=this.destination)||void 0===t?void 0:t.error)||void 0===i||i.call(t,e)}complete(){var e,t;null===(t=null===(e=this.destination)||void 0===e?void 0:e.complete)||void 0===t||t.call(e)}_subscribe(e){var t,i;return null!==(i=null===(t=this.source)||void 0===t?void 0:t.subscribe(e))&&void 0!==i?i:Al}}function ca(n){return sr(n?.lift)}function Dr(n){return e=>{if(ca(e))return e.lift(function(t){try{return n(t,this)}catch(i){this.error(i)}});throw new TypeError("Unable to lift unknown Observable type")}}function Pr(n,e,t,i,r){return new ua(n,e,t,i,r)}class ua extends Kl{constructor(e,t,i,r,s,c){super(e),this.onFinalize=s,this.shouldUnsubscribe=c,this._next=t?function(d){try{t(d)}catch(m){e.error(m)}}:super._next,this._error=r?function(d){try{r(d)}catch(m){e.error(m)}finally{this.unsubscribe()}}:super._error,this._complete=i?function(){try{i()}catch(d){e.error(d)}finally{this.unsubscribe()}}:super._complete}unsubscribe(){var e;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){const{closed:t}=this;super.unsubscribe(),!t&&(null===(e=this.onFinalize)||void 0===e||e.call(this))}}}function ei(n,e){return Dr((t,i)=>{let r=0;t.subscribe(Pr(i,s=>{i.next(n.call(e,s,r++))}))})}function el(n){return this instanceof el?(this.v=n,this):new el(n)}function bd(n,e,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r,i=t.apply(n,e||[]),s=[];return r={},c("next"),c("throw"),c("return"),r[Symbol.asyncIterator]=function(){return this},r;function c(T){i[T]&&(r[T]=function(I){return new Promise(function(R,k){s.push([T,I,R,k])>1||d(T,I)})})}function d(T,I){try{!function m(T){T.value instanceof el?Promise.resolve(T.value.v).then(y,w):S(s[0][2],T)}(i[T](I))}catch(R){S(s[0][3],R)}}function y(T){d("next",T)}function w(T){d("throw",T)}function S(T,I){T(I),s.shift(),s.length&&d(s[0][0],s[0][1])}}function xh(n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,e=n[Symbol.asyncIterator];return e?e.call(n):(n=function Jl(n){var e="function"==typeof Symbol&&Symbol.iterator,t=e&&n[e],i=0;if(t)return t.call(n);if(n&&"number"==typeof n.length)return{next:function(){return n&&i>=n.length&&(n=void 0),{value:n&&n[i++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}(n),t={},i("next"),i("throw"),i("return"),t[Symbol.asyncIterator]=function(){return this},t);function i(s){t[s]=n[s]&&function(c){return new Promise(function(d,m){!function r(s,c,d,m){Promise.resolve(m).then(function(y){s({value:y,done:d})},c)}(d,m,(c=n[s](c)).done,c.value)})}}}const Nc=n=>n&&"number"==typeof n.length&&"function"!=typeof n;function Au(n){return sr(n?.then)}function ka(n){return sr(n[Mu])}function Iu(n){return Symbol.asyncIterator&&sr(n?.[Symbol.asyncIterator])}function Mh(n){return new TypeError(`You provided ${null!==n&&"object"==typeof n?"an invalid object":`'${n}'`} where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.`)}const Pu=function wd(){return"function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator"}();function Io(n){return sr(n?.[Pu])}function Bc(n){return bd(this,arguments,function*(){const t=n.getReader();try{for(;;){const{value:i,done:r}=yield el(t.read());if(r)return yield el(void 0);yield yield el(i)}}finally{t.releaseLock()}})}function Md(n){return sr(n?.getReader)}function ws(n){if(n instanceof ci)return n;if(null!=n){if(ka(n))return function he(n){return new ci(e=>{const t=n[Mu]();if(sr(t.subscribe))return t.subscribe(e);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}(n);if(Nc(n))return function q(n){return new ci(e=>{for(let t=0;t<n.length&&!e.closed;t++)e.next(n[t]);e.complete()})}(n);if(Au(n))return function K(n){return new ci(e=>{n.then(t=>{e.closed||(e.next(t),e.complete())},t=>e.error(t)).then(null,ro)})}(n);if(Iu(n))return ye(n);if(Io(n))return function ce(n){return new ci(e=>{for(const t of n)if(e.next(t),e.closed)return;e.complete()})}(n);if(Md(n))return function Re(n){return ye(Bc(n))}(n)}throw Mh(n)}function ye(n){return new ci(e=>{(function Ve(n,e){var t,i,r,s;return function _h(n,e,t,i){return new(t||(t=Promise))(function(s,c){function d(w){try{y(i.next(w))}catch(S){c(S)}}function m(w){try{y(i.throw(w))}catch(S){c(S)}}function y(w){w.done?s(w.value):function r(s){return s instanceof t?s:new t(function(c){c(s)})}(w.value).then(d,m)}y((i=i.apply(n,e||[])).next())})}(this,void 0,void 0,function*(){try{for(t=xh(n);!(i=yield t.next()).done;)if(e.next(i.value),e.closed)return}catch(c){r={error:c}}finally{try{i&&!i.done&&(s=t.return)&&(yield s.call(t))}finally{if(r)throw r.error}}e.complete()})})(n,e).catch(t=>e.error(t))})}function Be(n,e,t,i=0,r=!1){const s=e.schedule(function(){t(),r?n.add(this.schedule(null,i)):this.unsubscribe()},i);if(n.add(s),!r)return s}function ze(n,e,t=1/0){return sr(e)?ze((i,r)=>ei((s,c)=>e(i,s,r,c))(ws(n(i,r))),t):("number"==typeof e&&(t=e),Dr((i,r)=>function Le(n,e,t,i,r,s,c,d){const m=[];let y=0,w=0,S=!1;const T=()=>{S&&!m.length&&!y&&e.complete()},I=k=>y<i?R(k):m.push(k),R=k=>{s&&e.next(k),y++;let F=!1;ws(t(k,w++)).subscribe(Pr(e,G=>{r?.(G),s?I(G):e.next(G)},()=>{F=!0},void 0,()=>{if(F)try{for(y--;m.length&&y<i;){const G=m.shift();c?Be(e,c,()=>R(G)):R(G)}T()}catch(G){e.error(G)}}))};return n.subscribe(Pr(e,I,()=>{S=!0,T()})),()=>{d?.()}}(i,r,n,t)))}function _t(n=1/0){return ze(Wo,n)}const Gt=new ci(n=>n.complete());function Sn(n){return n&&sr(n.schedule)}function Mn(n){return n[n.length-1]}function Vn(n){return sr(Mn(n))?n.pop():void 0}function oi(n){return Sn(Mn(n))?n.pop():void 0}function Fn(n,e=0){return Dr((t,i)=>{t.subscribe(Pr(i,r=>Be(i,n,()=>i.next(r),e),()=>Be(i,n,()=>i.complete(),e),r=>Be(i,n,()=>i.error(r),e)))})}function or(n,e=0){return Dr((t,i)=>{i.add(n.schedule(()=>t.subscribe(i),e))})}function Ll(n,e){if(!n)throw new Error("Iterable cannot be null");return new ci(t=>{Be(t,e,()=>{const i=n[Symbol.asyncIterator]();Be(t,e,()=>{i.next().then(r=>{r.done?t.complete():t.next(r.value)})},0,!0)})})}function fs(n,e){return e?function Vc(n,e){if(null!=n){if(ka(n))return function pr(n,e){return ws(n).pipe(or(e),Fn(e))}(n,e);if(Nc(n))return function ec(n,e){return new ci(t=>{let i=0;return e.schedule(function(){i===n.length?t.complete():(t.next(n[i++]),t.closed||this.schedule())})})}(n,e);if(Au(n))return function zc(n,e){return ws(n).pipe(or(e),Fn(e))}(n,e);if(Iu(n))return Ll(n,e);if(Io(n))return function rt(n,e){return new ci(t=>{let i;return Be(t,e,()=>{i=n[Pu](),Be(t,e,()=>{let r,s;try{({value:r,done:s}=i.next())}catch(c){return void t.error(c)}s?t.complete():t.next(r)},0,!0)}),()=>sr(i?.return)&&i.return()})}(n,e);if(Md(n))return function ps(n,e){return Ll(Bc(n),e)}(n,e)}throw Mh(n)}(n,e):ws(n)}function so(...n){const e=oi(n),t=function Ui(n,e){return"number"==typeof Mn(n)?n.pop():e}(n,1/0),i=n;return i.length?1===i.length?ws(i[0]):_t(t)(fs(i,e)):Gt}function Vp(n,e,...t){if(!0===e)return void n();if(!1===e)return;const i=new xu({next:()=>{i.unsubscribe(),n()}});return e(...t).subscribe(i)}function ar(n){for(let e in n)if(n[e]===ar)return e;throw Error("Could not find renamed property on target object.")}function Zt(n,e){for(const t in e)e.hasOwnProperty(t)&&!n.hasOwnProperty(t)&&(n[t]=e[t])}function vn(n){if("string"==typeof n)return n;if(Array.isArray(n))return"["+n.map(vn).join(", ")+"]";if(null==n)return""+n;if(n.overriddenName)return`${n.overriddenName}`;if(n.name)return`${n.name}`;const e=n.toString();if(null==e)return""+e;const t=e.indexOf("\n");return-1===t?e:e.substring(0,t)}function _i(n,e){return null==n||""===n?null===e?"":e:null==e||""===e?n:n+" "+e}const Ol=ar({__forward_ref__:ar});function Ai(n){return n.__forward_ref__=Ai,n.toString=function(){return vn(this())},n}function Xt(n){return ku(n)?n():n}function ku(n){return"function"==typeof n&&n.hasOwnProperty(Ol)&&n.__forward_ref__===Ai}class bt extends Error{constructor(e,t){super(function oo(n,e){return`NG0${Math.abs(n)}${e?": "+e.trim():""}`}(e,t)),this.code=e}}function bn(n){return"string"==typeof n?n:null==n?"":String(n)}function Cd(n,e){throw new bt(-201,!1)}function lr(n,e){null==n&&function Zi(n,e,t,i){throw new Error(`ASSERTION ERROR: ${n}`+(null==i?"":` [Expected=> ${t} ${i} ${e} <=Actual]`))}(e,n,null,"!=")}function Yt(n){return{token:n.token,providedIn:n.providedIn||null,factory:n.factory,value:void 0}}function Bn(n){return{providers:n.providers||[],imports:n.imports||[]}}function nl(n){return E_(n,Eh)||E_(n,La)}function E_(n,e){return n.hasOwnProperty(e)?n[e]:null}function T_(n){return n&&(n.hasOwnProperty(tc)||n.hasOwnProperty(jp))?n[tc]:null}const Eh=ar({\u0275prov:ar}),tc=ar({\u0275inj:ar}),La=ar({ngInjectableDef:ar}),jp=ar({ngInjectorDef:ar});var Hn=(()=>((Hn=Hn||{})[Hn.Default=0]="Default",Hn[Hn.Host=1]="Host",Hn[Hn.Self=2]="Self",Hn[Hn.SkipSelf=4]="SkipSelf",Hn[Hn.Optional=8]="Optional",Hn))();let Th;function gs(n){const e=Th;return Th=n,e}function Tm(n,e,t){const i=nl(n);return i&&"root"==i.providedIn?void 0===i.value?i.value=i.factory():i.value:t&Hn.Optional?null:void 0!==e?e:void Cd(vn(n))}function nc(n){return{toString:n}.toString()}var ha=(()=>((ha=ha||{})[ha.OnPush=0]="OnPush",ha[ha.Default=1]="Default",ha))(),pa=(()=>{return(n=pa||(pa={}))[n.Emulated=0]="Emulated",n[n.None=2]="None",n[n.ShadowDom=3]="ShadowDom",pa;var n})();const cr=(()=>typeof globalThis<"u"&&globalThis||typeof global<"u"&&global||typeof window<"u"&&window||typeof self<"u"&&typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&self)(),ic={},er=[],fa=ar({\u0275cmp:ar}),Li=ar({\u0275dir:ar}),Lu=ar({\u0275pipe:ar}),Dh=ar({\u0275mod:ar}),Oa=ar({\u0275fac:ar}),Uc=ar({__NG_ELEMENT_ID__:ar});let P_=0;function Qn(n){return nc(()=>{const t=!0===n.standalone,i={},r={type:n.type,providersResolver:null,decls:n.decls,vars:n.vars,factory:null,template:n.template||null,consts:n.consts||null,ngContentSelectors:n.ngContentSelectors,hostBindings:n.hostBindings||null,hostVars:n.hostVars||0,hostAttrs:n.hostAttrs||null,contentQueries:n.contentQueries||null,declaredInputs:i,inputs:null,outputs:null,exportAs:n.exportAs||null,onPush:n.changeDetection===ha.OnPush,directiveDefs:null,pipeDefs:null,standalone:t,dependencies:t&&n.dependencies||null,getStandaloneInjector:null,selectors:n.selectors||er,viewQuery:n.viewQuery||null,features:n.features||null,data:n.data||{},encapsulation:n.encapsulation||pa.Emulated,id:"c"+P_++,styles:n.styles||er,_:null,setInput:null,schemas:n.schemas||null,tView:null},s=n.dependencies,c=n.features;return r.inputs=Oi(n.inputs,i),r.outputs=Oi(n.outputs),c&&c.forEach(d=>d(r)),r.directiveDefs=s?()=>("function"==typeof s?s():s).map(Ah).filter(Td):null,r.pipeDefs=s?()=>("function"==typeof s?s():s).map(Bs).filter(Td):null,r})}function Ah(n){return yr(n)||uo(n)}function Td(n){return null!==n}function Gn(n){return nc(()=>({type:n.type,bootstrap:n.bootstrap||er,declarations:n.declarations||er,imports:n.imports||er,exports:n.exports||er,transitiveCompileScopes:null,schemas:n.schemas||null,id:n.id||null}))}function Oi(n,e){if(null==n)return ic;const t={};for(const i in n)if(n.hasOwnProperty(i)){let r=n[i],s=r;Array.isArray(r)&&(s=r[1],r=r[0]),t[r]=i,e&&(e[r]=s)}return t}const an=Qn;function co(n){return{type:n.type,name:n.name,factory:null,pure:!1!==n.pure,standalone:!0===n.standalone,onDestroy:n.type.prototype.ngOnDestroy||null}}function yr(n){return n[fa]||null}function uo(n){return n[Li]||null}function Bs(n){return n[Lu]||null}function Xo(n,e){const t=n[Dh]||null;if(!t&&!0===e)throw new Error(`Type ${vn(n)} does not have '\u0275mod' property.`);return t}function Ds(n){return Array.isArray(n)&&"object"==typeof n[1]}function il(n){return Array.isArray(n)&&!0===n[1]}function Pm(n){return 0!=(8&n.flags)}function kh(n){return 2==(2&n.flags)}function Lh(n){return 1==(1&n.flags)}function Na(n){return null!==n.template}function Rm(n){return 0!=(256&n[2])}function rl(n,e){return n.hasOwnProperty(Oa)?n[Oa]:null}class Nh{constructor(e,t,i){this.previousValue=e,this.currentValue=t,this.firstChange=i}isFirstChange(){return this.firstChange}}function Nr(){return Bh}function Bh(n){return n.type.prototype.ngOnChanges&&(n.setInput=zh),Zp}function Zp(){const n=Pd(this),e=n?.current;if(e){const t=n.previous;if(t===ic)n.previous=e;else for(let i in e)t[i]=e[i];n.current=null,this.ngOnChanges(e)}}function zh(n,e,t,i){const r=Pd(n)||function Jt(n,e){return n[Nl]=e}(n,{previous:ic,current:null}),s=r.current||(r.current={}),c=r.previous,d=this.declaredInputs[t],m=c[d];s[d]=new Nh(m&&m.currentValue,e,c===ic),n[i]=e}Nr.ngInherit=!0;const Nl="__ngSimpleChanges__";function Pd(n){return n[Nl]||null}function es(n){for(;Array.isArray(n);)n=n[0];return n}function Ba(n,e){return es(e[n])}function Zr(n,e){return es(e[n.index])}function Jp(n,e){return n.data[e]}function cc(n,e){return n[e]}function Fo(n,e){const t=e[n];return Ds(t)?t:t[0]}function Uu(n){return 64==(64&n[2])}function za(n,e){return null==e?null:n[e]}function Fm(n){n[18]=0}function tf(n,e){n[5]+=e;let t=n,i=n[3];for(;null!==i&&(1===e&&1===t[5]||-1===e&&0===t[5]);)i[5]+=e,t=i,i=i[3]}const ui={lFrame:jm(null),bindingsEnabled:!0};function Rd(){return ui.bindingsEnabled}function Rt(){return ui.lFrame.lView}function ai(){return ui.lFrame.tView}function As(n){return ui.lFrame.contextLView=n,n[8]}function Us(n){return ui.lFrame.contextLView=null,n}function Is(){let n=q_();for(;null!==n&&64===n.type;)n=n.parent;return n}function q_(){return ui.lFrame.currentTNode}function Va(n,e){const t=ui.lFrame;t.currentTNode=n,t.isParent=e}function Wc(){return ui.lFrame.isParent}function Ua(){ui.lFrame.isParent=!1}function Ps(){const n=ui.lFrame;let e=n.bindingRootIndex;return-1===e&&(e=n.bindingRootIndex=n.tView.bindingStartIndex),e}function Gu(){return ui.lFrame.bindingIndex++}function ya(n){const e=ui.lFrame,t=e.bindingIndex;return e.bindingIndex=e.bindingIndex+n,t}function X_(n,e){const t=ui.lFrame;t.bindingIndex=t.bindingRootIndex=n,ju(e)}function ju(n){ui.lFrame.currentDirectiveIndex=n}function Ld(){return ui.lFrame.currentQueryIndex}function Od(n){ui.lFrame.currentQueryIndex=n}function sf(n){const e=n[1];return 2===e.type?e.declTNode:1===e.type?n[6]:null}function Gm(n,e,t){if(t&Hn.SkipSelf){let r=e,s=n;for(;!(r=r.parent,null!==r||t&Hn.Host||(r=sf(s),null===r||(s=s[15],10&r.type))););if(null===r)return!1;e=r,n=s}const i=ui.lFrame=lf();return i.currentTNode=e,i.lView=n,!0}function af(n){const e=lf(),t=n[1];ui.lFrame=e,e.currentTNode=t.firstChild,e.lView=n,e.tView=t,e.contextLView=n,e.bindingIndex=t.bindingStartIndex,e.inI18n=!1}function lf(){const n=ui.lFrame,e=null===n?null:n.child;return null===e?jm(n):e}function jm(n){const e={currentTNode:null,isParent:!0,lView:null,tView:null,selectedIndex:-1,contextLView:null,elementDepthCount:0,currentNamespace:null,currentDirectiveIndex:-1,bindingRootIndex:-1,bindingIndex:-1,currentQueryIndex:0,parent:n,child:null,inI18n:!1};return null!==n&&(n.child=e),e}function $m(){const n=ui.lFrame;return ui.lFrame=n.parent,n.currentTNode=null,n.lView=null,n}const cf=$m;function Fd(){const n=$m();n.isParent=!0,n.tView=null,n.selectedIndex=-1,n.contextLView=null,n.elementDepthCount=0,n.currentDirectiveIndex=-1,n.currentNamespace=null,n.bindingRootIndex=-1,n.bindingIndex=-1,n.currentQueryIndex=0}function fo(){return ui.lFrame.selectedIndex}function Bl(n){ui.lFrame.selectedIndex=n}function ts(){const n=ui.lFrame;return Jp(n.tView,n.selectedIndex)}function M(n,e){for(let t=e.directiveStart,i=e.directiveEnd;t<i;t++){const s=n.data[t].type.prototype,{ngAfterContentInit:c,ngAfterContentChecked:d,ngAfterViewInit:m,ngAfterViewChecked:y,ngOnDestroy:w}=s;c&&(n.contentHooks||(n.contentHooks=[])).push(-t,c),d&&((n.contentHooks||(n.contentHooks=[])).push(t,d),(n.contentCheckHooks||(n.contentCheckHooks=[])).push(t,d)),m&&(n.viewHooks||(n.viewHooks=[])).push(-t,m),y&&((n.viewHooks||(n.viewHooks=[])).push(t,y),(n.viewCheckHooks||(n.viewCheckHooks=[])).push(t,y)),null!=w&&(n.destroyHooks||(n.destroyHooks=[])).push(t,w)}}function E(n,e,t){N(n,e,3,t)}function P(n,e,t,i){(3&n[2])===t&&N(n,e,t,i)}function O(n,e){let t=n[2];(3&t)===e&&(t&=2047,t+=1,n[2]=t)}function N(n,e,t,i){const s=i??-1,c=e.length-1;let d=0;for(let m=void 0!==i?65535&n[18]:0;m<c;m++)if("number"==typeof e[m+1]){if(d=e[m],null!=i&&d>=i)break}else e[m]<0&&(n[18]+=65536),(d<s||-1==s)&&(U(n,t,e,m),n[18]=(4294901760&n[18])+m+2),m++}function U(n,e,t,i){const r=t[i]<0,s=t[i+1],d=n[r?-t[i]:t[i]];if(r){if(n[2]>>11<n[18]>>16&&(3&n[2])===e){n[2]+=2048;try{s.call(d)}finally{}}}else try{s.call(d)}finally{}}const H=-1;class Z{constructor(e,t,i){this.factory=e,this.resolving=!1,this.canSeeViewProviders=t,this.injectImpl=i}}function Me(n,e,t){let i=0;for(;i<t.length;){const r=t[i];if("number"==typeof r){if(0!==r)break;i++;const s=t[i++],c=t[i++],d=t[i++];n.setAttribute(e,c,d,s)}else{const s=r,c=t[++i];ge(s)?n.setProperty(e,s,c):n.setAttribute(e,s,c),i++}}return i}function Se(n){return 3===n||4===n||6===n}function ge(n){return 64===n.charCodeAt(0)}function De(n,e){if(null!==e&&0!==e.length)if(null===n||0===n.length)n=e.slice();else{let t=-1;for(let i=0;i<e.length;i++){const r=e[i];"number"==typeof r?t=r:0===t||Ue(n,t,r,null,-1===t||2===t?e[++i]:null)}}return n}function Ue(n,e,t,i,r){let s=0,c=n.length;if(-1===e)c=-1;else for(;s<n.length;){const d=n[s++];if("number"==typeof d){if(d===e){c=-1;break}if(d>e){c=s-1;break}}}for(;s<n.length;){const d=n[s];if("number"==typeof d)break;if(d===t){if(null===i)return void(null!==r&&(n[s+1]=r));if(i===n[s+1])return void(n[s+2]=r)}s++,null!==i&&s++,null!==r&&s++}-1!==c&&(n.splice(c,0,e),s=c+1),n.splice(s++,0,t),null!==i&&n.splice(s++,0,i),null!==r&&n.splice(s++,0,r)}function Ke(n){return n!==H}function je(n){return 32767&n}function Ne(n,e){let t=function St(n){return n>>16}(n),i=e;for(;t>0;)i=i[15],t--;return i}let pt=!0;function ht(n){const e=pt;return pt=n,e}let Ft=0;const kt={};function un(n,e){const t=Tn(n,e);if(-1!==t)return t;const i=e[1];i.firstCreatePass&&(n.injectorIndex=e.length,Nn(i.data,n),Nn(e,null),Nn(i.blueprint,null));const r=mn(n,e),s=n.injectorIndex;if(Ke(r)){const c=je(r),d=Ne(r,e),m=d[1].data;for(let y=0;y<8;y++)e[s+y]=d[c+y]|m[c+y]}return e[s+8]=r,s}function Nn(n,e){n.push(0,0,0,0,0,0,0,0,e)}function Tn(n,e){return-1===n.injectorIndex||n.parent&&n.parent.injectorIndex===n.injectorIndex||null===e[n.injectorIndex+8]?-1:n.injectorIndex}function mn(n,e){if(n.parent&&-1!==n.parent.injectorIndex)return n.parent.injectorIndex;let t=0,i=null,r=e;for(;null!==r;){if(i=Ha(r),null===i)return H;if(t++,r=r[15],-1!==i.injectorIndex)return i.injectorIndex|t<<16}return H}function Lt(n,e,t){!function Bt(n,e,t){let i;"string"==typeof t?i=t.charCodeAt(0)||0:t.hasOwnProperty(Uc)&&(i=t[Uc]),null==i&&(i=t[Uc]=Ft++);const r=255&i;e.data[n+(r>>5)]|=1<<r}(n,e,t)}function di(n,e,t){if(t&Hn.Optional||void 0!==n)return n;Cd()}function ur(n,e,t,i){if(t&Hn.Optional&&void 0===i&&(i=null),0==(t&(Hn.Self|Hn.Host))){const r=n[9],s=gs(void 0);try{return r?r.get(e,i,t&Hn.Optional):Tm(e,i,t&Hn.Optional)}finally{gs(s)}}return di(i,0,t)}function dr(n,e,t,i=Hn.Default,r){if(null!==n){if(1024&e[2]){const c=function $u(n,e,t,i,r){let s=n,c=e;for(;null!==s&&null!==c&&1024&c[2]&&!(256&c[2]);){const d=Yi(s,c,t,i|Hn.Self,kt);if(d!==kt)return d;let m=s.parent;if(!m){const y=c[21];if(y){const w=y.get(t,kt,i);if(w!==kt)return w}m=Ha(c),c=c[15]}s=m}return r}(n,e,t,i,kt);if(c!==kt)return c}const s=Yi(n,e,t,i,kt);if(s!==kt)return s}return ur(e,t,i,r)}function Yi(n,e,t,i,r){const s=function Rr(n){if("string"==typeof n)return n.charCodeAt(0)||0;const e=n.hasOwnProperty(Uc)?n[Uc]:void 0;return"number"==typeof e?e>=0?255&e:mo:e}(t);if("function"==typeof s){if(!Gm(e,n,i))return i&Hn.Host?di(r,0,i):ur(e,t,i,r);try{const c=s(i);if(null!=c||i&Hn.Optional)return c;Cd()}finally{cf()}}else if("number"==typeof s){let c=null,d=Tn(n,e),m=H,y=i&Hn.Host?e[16][6]:null;for((-1===d||i&Hn.SkipSelf)&&(m=-1===d?mn(n,e):e[d+8],m!==H&&Hi(i,!1)?(c=e[1],d=je(m),e=Ne(m,e)):d=-1);-1!==d;){const w=e[1];if(Gr(s,d,w.data)){const S=Rs(d,e,t,c,i,y);if(S!==kt)return S}m=e[d+8],m!==H&&Hi(i,e[1].data[d+8]===y)&&Gr(s,d,e)?(c=w,d=je(m),e=Ne(m,e)):d=-1}}return r}function Rs(n,e,t,i,r,s){const c=e[1],d=c.data[n+8],w=Hs(d,c,t,null==i?kh(d)&&pt:i!=c&&0!=(3&d.type),r&Hn.Host&&s===d);return null!==w?Yo(e,c,w,d):kt}function Hs(n,e,t,i,r){const s=n.providerIndexes,c=e.data,d=1048575&s,m=n.directiveStart,w=s>>20,T=r?d+w:n.directiveEnd;for(let I=i?d:d+w;I<T;I++){const R=c[I];if(I<m&&t===R||I>=m&&R.type===t)return I}if(r){const I=c[m];if(I&&Na(I)&&I.type===t)return m}return null}function Yo(n,e,t,i){let r=n[t];const s=e.data;if(function Q(n){return n instanceof Z}(r)){const c=r;c.resolving&&function tl(n,e){const t=e?`. Dependency path: ${e.join(" > ")} > ${n}`:"";throw new bt(-200,`Circular dependency in DI detected for ${n}${t}`)}(function fr(n){return"function"==typeof n?n.name||n.toString():"object"==typeof n&&null!=n&&"function"==typeof n.type?n.type.name||n.type.toString():bn(n)}(s[t]));const d=ht(c.canSeeViewProviders);c.resolving=!0;const m=c.injectImpl?gs(c.injectImpl):null;Gm(n,i,Hn.Default);try{r=n[t]=c.factory(void 0,s,n,i),e.firstCreatePass&&t>=i.directiveStart&&function x(n,e,t){const{ngOnChanges:i,ngOnInit:r,ngDoCheck:s}=e.type.prototype;if(i){const c=Bh(e);(t.preOrderHooks||(t.preOrderHooks=[])).push(n,c),(t.preOrderCheckHooks||(t.preOrderCheckHooks=[])).push(n,c)}r&&(t.preOrderHooks||(t.preOrderHooks=[])).push(0-n,r),s&&((t.preOrderHooks||(t.preOrderHooks=[])).push(n,s),(t.preOrderCheckHooks||(t.preOrderCheckHooks=[])).push(n,s))}(t,s[t],e)}finally{null!==m&&gs(m),ht(d),c.resolving=!1,cf()}}return r}function Gr(n,e,t){return!!(t[e+(n>>5)]&1<<n)}function Hi(n,e){return!(n&Hn.Self||n&Hn.Host&&e)}class jr{constructor(e,t){this._tNode=e,this._lView=t}get(e,t,i){return dr(this._tNode,this._lView,e,i,t)}}function mo(){return new jr(Is(),Rt())}function hi(n){return nc(()=>{const e=n.prototype.constructor,t=e[Oa]||go(e),i=Object.prototype;let r=Object.getPrototypeOf(n.prototype).constructor;for(;r&&r!==i;){const s=r[Oa]||go(r);if(s&&s!==t)return s;r=Object.getPrototypeOf(r)}return s=>new s})}function go(n){return ku(n)?()=>{const e=go(Xt(n));return e&&e()}:rl(n)}function Ha(n){const e=n[1],t=e.type;return 2===t?e.declTNode:1===t?n[6]:null}function ns(n){return function qn(n,e){if("class"===e)return n.classes;if("style"===e)return n.styles;const t=n.attrs;if(t){const i=t.length;let r=0;for(;r<i;){const s=t[r];if(Se(s))break;if(0===s)r+=2;else if("number"==typeof s)for(r++;r<i&&"string"==typeof t[r];)r++;else{if(s===e)return t[r+1];r+=2}}}return null}(Is(),n)}const va="__parameters__";function _o(n,e,t){return nc(()=>{const i=function zl(n){return function(...t){if(n){const i=n(...t);for(const r in i)this[r]=i[r]}}}(e);function r(...s){if(this instanceof r)return i.apply(this,s),this;const c=new r(...s);return d.annotation=c,d;function d(m,y,w){const S=m.hasOwnProperty(va)?m[va]:Object.defineProperty(m,va,{value:[]})[va];for(;S.length<=w;)S.push(null);return(S[w]=S[w]||[]).push(c),m}}return t&&(r.prototype=Object.create(t.prototype)),r.prototype.ngMetadataName=n,r.annotationCls=r,r})}class Vt{constructor(e,t){this._desc=e,this.ngMetadataName="InjectionToken",this.\u0275prov=void 0,"number"==typeof t?this.__NG_ELEMENT_ID__=t:void 0!==t&&(this.\u0275prov=Yt({token:this,providedIn:t.providedIn||"root",factory:t.factory}))}get multi(){return this}toString(){return`InjectionToken ${this._desc}`}}function al(n,e){void 0===e&&(e=n);for(let t=0;t<n.length;t++){let i=n[t];Array.isArray(i)?(e===n&&(e=n.slice(0,t)),al(i,e)):e!==n&&e.push(i)}return e}function Wu(n,e){n.forEach(t=>Array.isArray(t)?Wu(t,e):e(t))}function Gh(n,e,t){e>=n.length?n.push(t):n.splice(e,0,t)}function Wm(n,e){return e>=n.length-1?n.pop():n.splice(e,1)[0]}function hf(n,e){const t=[];for(let i=0;i<n;i++)t.push(e);return t}function ks(n,e,t){let i=jh(n,e);return i>=0?n[1|i]=t:(i=~i,function ty(n,e,t,i){let r=n.length;if(r==e)n.push(t,i);else if(1===r)n.push(i,n[0]),n[0]=t;else{for(r--,n.push(n[r-1],n[r]);r>e;)n[r]=n[r-2],r--;n[e]=t,n[e+1]=i}}(n,i,e,t)),i}function pf(n,e){const t=jh(n,e);if(t>=0)return n[1|t]}function jh(n,e){return function Ww(n,e,t){let i=0,r=n.length>>t;for(;r!==i;){const s=i+(r-i>>1),c=n[s<<t];if(e===c)return s<<t;c>e?r=s:i=s+1}return~(r<<t)}(n,e,1)}const dc={},k0="__NG_DI_FLAG__",ny="ngTempTokenPath",iT=/\n/gm,Xm="__source";let xa;function mf(n){const e=xa;return xa=n,e}function rT(n,e=Hn.Default){if(void 0===xa)throw new bt(-203,!1);return null===xa?Tm(n,void 0,e):xa.get(n,e&Hn.Optional?null:void 0,e)}function Xe(n,e=Hn.Default){return(function $p(){return Th}()||rT)(Xt(n),e)}function xr(n,e=Hn.Default){return"number"!=typeof e&&(e=0|(e.optional&&8)|(e.host&&1)|(e.self&&2)|(e.skipSelf&&4)),Xe(n,e)}function gf(n){const e=[];for(let t=0;t<n.length;t++){const i=Xt(n[t]);if(Array.isArray(i)){if(0===i.length)throw new bt(900,!1);let r,s=Hn.Default;for(let c=0;c<i.length;c++){const d=i[c],m=Zw(d);"number"==typeof m?-1===m?r=d.token:s|=m:r=d}e.push(Xe(r,s))}else e.push(Xe(i))}return e}function Ii(n,e){return n[k0]=e,n.prototype[k0]=e,n}function Zw(n){return n[k0]}const ls=Ii(_o("Optional"),8),$r=Ii(_o("SkipSelf"),4);let ly;class Ko{constructor(e){this.changingThisBreaksApplicationSecurity=e}toString(){return`SafeValue must use [property]=binding: ${this.changingThisBreaksApplicationSecurity} (see https://g.co/ng/security#xss)`}}function Qo(n){return n instanceof Ko?n.changingThisBreaksApplicationSecurity:n}const Jm=/^(?:(?:https?|mailto|data|ftp|tel|file|sms):|[^&:/?#]*(?:[/?#]|$))/gi;var br=(()=>((br=br||{})[br.NONE=0]="NONE",br[br.HTML=1]="HTML",br[br.STYLE=2]="STYLE",br[br.SCRIPT=3]="SCRIPT",br[br.URL=4]="URL",br[br.RESOURCE_URL=5]="RESOURCE_URL",br))();function fy(n){const e=function Yh(){const n=Rt();return n&&n[12]}();return e?e.sanitize(br.URL,n)||"":function pc(n,e){const t=function t1(n){return n instanceof Ko&&n.getTypeName()||null}(n);if(null!=t&&t!==e){if("ResourceURL"===t&&"URL"===e)return!0;throw new Error(`Required a safe ${e}, got a ${t} (see https://g.co/ng/security#xss)`)}return t===e}(n,"URL")?Qo(n):function Jo(n){return(n=String(n)).match(Jm)?n:"unsafe:"+n}(bn(n))}const X0=new Vt("ENVIRONMENT_INITIALIZER"),m1=new Vt("INJECTOR",-1),g1=new Vt("INJECTOR_DEF_TYPES");class Mf{get(e,t=dc){if(t===dc){const i=new Error(`NullInjectorError: No provider for ${vn(e)}!`);throw i.name="NullInjectorError",i}return t}}function my(...n){return{\u0275providers:Y0(0,n)}}function Y0(n,...e){const t=[],i=new Set;let r;return Wu(e,s=>{const c=s;Kh(c,t,[],i)&&(r||(r=[]),r.push(c))}),void 0!==r&&zd(r,t),t}function zd(n,e){for(let t=0;t<n.length;t++){const{providers:r}=n[t];Wu(r,s=>{e.push(s)})}}function Kh(n,e,t,i){if(!(n=Xt(n)))return!1;let r=null,s=T_(n);const c=!s&&yr(n);if(s||c){if(c&&!c.standalone)return!1;r=n}else{const m=n.ngModule;if(s=T_(m),!s)return!1;r=m}const d=i.has(r);if(c){if(d)return!1;if(i.add(r),c.dependencies){const m="function"==typeof c.dependencies?c.dependencies():c.dependencies;for(const y of m)Kh(y,e,t,i)}}else{if(!s)return!1;{if(null!=s.imports&&!d){let y;i.add(r);try{Wu(s.imports,w=>{Kh(w,e,t,i)&&(y||(y=[]),y.push(w))})}finally{}void 0!==y&&zd(y,e)}if(!d){const y=rl(r)||(()=>new r);e.push({provide:r,useFactory:y,deps:er},{provide:g1,useValue:r,multi:!0},{provide:X0,useValue:()=>Xe(r),multi:!0})}const m=s.providers;null==m||d||Wu(m,w=>{e.push(w)})}}return r!==n&&void 0!==n.providers}const hT=ar({provide:String,useValue:ar});function K0(n){return null!==n&&"object"==typeof n&&hT in n}function Qh(n){return"function"==typeof n}const tg=new Vt("Set Injector scope."),gy={},Cf={};let Q0;function Xr(){return void 0===Q0&&(Q0=new Mf),Q0}class fc{}class J0 extends fc{constructor(e,t,i,r){super(),this.parent=t,this.source=i,this.scopes=r,this.records=new Map,this._ngOnDestroyHooks=new Set,this._onDestroyHooks=[],this._destroyed=!1,yy(e,c=>this.processProvider(c)),this.records.set(m1,Jh(void 0,this)),r.has("environment")&&this.records.set(fc,Jh(void 0,this));const s=this.records.get(tg);null!=s&&"string"==typeof s.value&&this.scopes.add(s.value),this.injectorDefTypes=new Set(this.get(g1.multi,er,Hn.Self))}get destroyed(){return this._destroyed}destroy(){this.assertNotDestroyed(),this._destroyed=!0;try{for(const e of this._ngOnDestroyHooks)e.ngOnDestroy();for(const e of this._onDestroyHooks)e()}finally{this.records.clear(),this._ngOnDestroyHooks.clear(),this.injectorDefTypes.clear(),this._onDestroyHooks.length=0}}onDestroy(e){this._onDestroyHooks.push(e)}runInContext(e){this.assertNotDestroyed();const t=mf(this),i=gs(void 0);try{return e()}finally{mf(t),gs(i)}}get(e,t=dc,i=Hn.Default){this.assertNotDestroyed();const r=mf(this),s=gs(void 0);try{if(!(i&Hn.SkipSelf)){let d=this.records.get(e);if(void 0===d){const m=function nx(n){return"function"==typeof n||"object"==typeof n&&n instanceof Vt}(e)&&nl(e);d=m&&this.injectableDefInScope(m)?Jh(Sf(e),gy):null,this.records.set(e,d)}if(null!=d)return this.hydrate(e,d)}return(i&Hn.Self?Xr():this.parent).get(e,t=i&Hn.Optional&&t===dc?null:t)}catch(c){if("NullInjectorError"===c.name){if((c[ny]=c[ny]||[]).unshift(vn(e)),r)throw c;return function L0(n,e,t,i){const r=n[ny];throw e[Xm]&&r.unshift(e[Xm]),n.message=function qc(n,e,t,i=null){n=n&&"\n"===n.charAt(0)&&"\u0275"==n.charAt(1)?n.slice(2):n;let r=vn(e);if(Array.isArray(e))r=e.map(vn).join(" -> ");else if("object"==typeof e){let s=[];for(let c in e)if(e.hasOwnProperty(c)){let d=e[c];s.push(c+":"+("string"==typeof d?JSON.stringify(d):vn(d)))}r=`{${s.join(", ")}}`}return`${t}${i?"("+i+")":""}[${r}]: ${n.replace(iT,"\n  ")}`}("\n"+n.message,r,t,i),n.ngTokenPath=r,n[ny]=null,n}(c,e,"R3InjectorError",this.source)}throw c}finally{gs(s),mf(r)}}resolveInjectorInitializers(){const e=mf(this),t=gs(void 0);try{const i=this.get(X0.multi,er,Hn.Self);for(const r of i)r()}finally{mf(e),gs(t)}}toString(){const e=[],t=this.records;for(const i of t.keys())e.push(vn(i));return`R3Injector[${e.join(", ")}]`}assertNotDestroyed(){if(this._destroyed)throw new bt(205,!1)}processProvider(e){let t=Qh(e=Xt(e))?e:Xt(e&&e.provide);const i=function ng(n){return K0(n)?Jh(void 0,n.useValue):Jh(ex(n),gy)}(e);if(Qh(e)||!0!==e.multi)this.records.get(t);else{let r=this.records.get(t);r||(r=Jh(void 0,gy,!0),r.factory=()=>gf(r.multi),this.records.set(t,r)),t=e,r.multi.push(e)}this.records.set(t,i)}hydrate(e,t){return t.value===gy&&(t.value=Cf,t.value=t.factory()),"object"==typeof t.value&&t.value&&function tx(n){return null!==n&&"object"==typeof n&&"function"==typeof n.ngOnDestroy}(t.value)&&this._ngOnDestroyHooks.add(t.value),t.value}injectableDefInScope(e){if(!e.providedIn)return!1;const t=Xt(e.providedIn);return"string"==typeof t?"any"===t||this.scopes.has(t):this.injectorDefTypes.has(t)}}function Sf(n){const e=nl(n),t=null!==e?e.factory:rl(n);if(null!==t)return t;if(n instanceof Vt)throw new bt(204,!1);if(n instanceof Function)return function _y(n){const e=n.length;if(e>0)throw hf(e,"?"),new bt(204,!1);const t=function Em(n){const e=n&&(n[Eh]||n[La]);if(e){const t=function Ed(n){if(n.hasOwnProperty("name"))return n.name;const e=(""+n).match(/^function\s*([^\s(]+)/);return null===e?"":e[1]}(n);return console.warn(`DEPRECATED: DI is instantiating a token "${t}" that inherits its @Injectable decorator but does not provide one itself.\nThis will become an error in a future version of Angular. Please add @Injectable() to the "${t}" class.`),e}return null}(n);return null!==t?()=>t.factory(n):()=>new n}(n);throw new bt(204,!1)}function ex(n,e,t){let i;if(Qh(n)){const r=Xt(n);return rl(r)||Sf(r)}if(K0(n))i=()=>Xt(n.useValue);else if(function y1(n){return!(!n||!n.useFactory)}(n))i=()=>n.useFactory(...gf(n.deps||[]));else if(function _1(n){return!(!n||!n.useExisting)}(n))i=()=>Xe(Xt(n.useExisting));else{const r=Xt(n&&(n.useClass||n.provide));if(!function ig(n){return!!n.deps}(n))return rl(r)||Sf(r);i=()=>new r(...gf(n.deps))}return i}function Jh(n,e,t=!1){return{factory:n,value:e,multi:t?[]:void 0}}function fT(n){return!!n.\u0275providers}function yy(n,e){for(const t of n)Array.isArray(t)?yy(t,e):fT(t)?yy(t.\u0275providers,e):e(t)}class v1{}class rx{resolveComponentFactory(e){throw function ix(n){const e=Error(`No component factory found for ${vn(n)}. Did you add it to @NgModule.entryComponents?`);return e.ngComponent=n,e}(e)}}let Kc=(()=>{class n{}return n.NULL=new rx,n})();function mT(){return Ef(Is(),Rt())}function Ef(n,e){return new wr(Zr(n,e))}let wr=(()=>{class n{constructor(t){this.nativeElement=t}}return n.__NG_ELEMENT_ID__=mT,n})();function gT(n){return n instanceof wr?n.nativeElement:n}class sg{}let Ul=(()=>{class n{}return n.__NG_ELEMENT_ID__=()=>function _T(){const n=Rt(),t=Fo(Is().index,n);return(Ds(t)?t:n)[11]}(),n})(),w1=(()=>{class n{}return n.\u0275prov=Yt({token:n,providedIn:"root",factory:()=>null}),n})();class Hl{constructor(e){this.full=e,this.major=e.split(".")[0],this.minor=e.split(".")[1],this.patch=e.split(".").slice(2).join(".")}}const yT=new Hl("14.2.10"),sx={};function wy(n){return n.ngOriginalError}class Ku{constructor(){this._console=console}handleError(e){const t=this._findOriginalError(e);this._console.error("ERROR",e),t&&this._console.error("ORIGINAL ERROR",t)}_findOriginalError(e){let t=e&&wy(e);for(;t&&wy(t);)t=wy(t);return t||null}}const ep=new Map;let Af=0;const hx="__ngContext__";function Xs(n,e){Ds(e)?(n[hx]=e[20],function R1(n){ep.set(n[20],n)}(e)):n[hx]=e}function ja(n){return n instanceof Function?n():n}var Ma=(()=>((Ma=Ma||{})[Ma.Important=1]="Important",Ma[Ma.DashCase=2]="DashCase",Ma))();function mr(n,e){return undefined(n,e)}function hl(n){const e=n[3];return il(e)?e[3]:e}function _x(n){return G1(n[13])}function yx(n){return G1(n[4])}function G1(n){for(;null!==n&&!il(n);)n=n[4];return n}function Pf(n,e,t,i,r){if(null!=i){let s,c=!1;il(i)?s=i:Ds(i)&&(c=!0,i=i[0]);const d=es(i);0===n&&null!==t?null==r?wx(e,t,d):tp(e,t,d,r||null,!0):1===n&&null!==t?tp(e,t,d,r||null,!0):2===n?function q1(n,e,t){const i=hg(n,e);i&&function RT(n,e,t,i){n.removeChild(e,t,i)}(n,i,e,t)}(e,d,c):3===n&&e.destroyNode(d),null!=s&&function X1(n,e,t,i,r){const s=t[7];s!==es(t)&&Pf(e,n,i,s,r);for(let d=10;d<t.length;d++){const m=t[d];Lf(m[1],m,n,e,i,s)}}(e,n,s,t,r)}}function xx(n,e,t){return n.createElement(e,t)}function Dy(n,e){const t=n[9],i=t.indexOf(e),r=e[3];512&e[2]&&(e[2]&=-513,tf(r,-1)),t.splice(i,1)}function cg(n,e){if(n.length<=10)return;const t=10+e,i=n[t];if(i){const r=i[17];null!==r&&r!==n&&Dy(r,i),e>0&&(n[t-1][4]=i[4]);const s=Wm(n,10+e);!function Ty(n,e){Lf(n,e,e[11],2,null,null),e[0]=null,e[6]=null}(i[1],i);const c=s[19];null!==c&&c.detachView(s[1]),i[3]=null,i[4]=null,i[2]&=-65}return i}function bx(n,e){if(!(128&e[2])){const t=e[11];t.destroyNode&&Lf(n,e,t,3,null,null),function AT(n){let e=n[13];if(!e)return Ca(n[1],n);for(;e;){let t=null;if(Ds(e))t=e[13];else{const i=e[10];i&&(t=i)}if(!t){for(;e&&!e[4]&&e!==n;)Ds(e)&&Ca(e[1],e),e=e[3];null===e&&(e=n),Ds(e)&&Ca(e[1],e),t=e&&e[4]}e=t}}(e)}}function Ca(n,e){if(!(128&e[2])){e[2]&=-65,e[2]|=128,function kf(n,e){let t;if(null!=n&&null!=(t=n.destroyHooks))for(let i=0;i<t.length;i+=2){const r=e[t[i]];if(!(r instanceof Z)){const s=t[i+1];if(Array.isArray(s))for(let c=0;c<s.length;c+=2){const d=r[s[c]],m=s[c+1];try{m.call(d)}finally{}}else try{s.call(r)}finally{}}}}(n,e),function ug(n,e){const t=n.cleanup,i=e[7];let r=-1;if(null!==t)for(let s=0;s<t.length-1;s+=2)if("string"==typeof t[s]){const c=t[s+1],d="function"==typeof c?c(e):es(e[c]),m=i[r=t[s+2]],y=t[s+3];"boolean"==typeof y?d.removeEventListener(t[s],m,y):y>=0?i[r=y]():i[r=-y].unsubscribe(),s+=2}else{const c=i[r=t[s+1]];t[s].call(c)}if(null!==i){for(let s=r+1;s<i.length;s++)(0,i[s])();e[7]=null}}(n,e),1===e[1].type&&e[11].destroy();const t=e[17];if(null!==t&&il(e[3])){t!==e[3]&&Dy(t,e);const i=e[19];null!==i&&i.detachView(n)}!function bT(n){ep.delete(n[20])}(e)}}function Ay(n,e,t){return function dg(n,e,t){let i=e;for(;null!==i&&40&i.type;)i=(e=i).parent;if(null===i)return t[0];if(2&i.flags){const r=n.data[i.directiveStart].encapsulation;if(r===pa.None||r===pa.Emulated)return null}return Zr(i,t)}(n,e.parent,t)}function tp(n,e,t,i,r){n.insertBefore(e,t,i,r)}function wx(n,e,t){n.appendChild(e,t)}function Mx(n,e,t,i,r){null!==i?tp(n,e,t,i,r):wx(n,e,t)}function hg(n,e){return n.parentNode(e)}function Iy(n,e,t){return W1(n,e,t)}let W1=function Sx(n,e,t){return 40&n.type?Zr(n,t):null};function pg(n,e,t,i){const r=Ay(n,i,e),s=e[11],d=Iy(i.parent||e[6],i,e);if(null!=r)if(Array.isArray(t))for(let m=0;m<t.length;m++)Mx(s,r,t[m],d,!1);else Mx(s,r,t,d,!1)}function fg(n,e){if(null!==e){const t=e.type;if(3&t)return Zr(e,n);if(4&t)return Ry(-1,n[e.index]);if(8&t){const i=e.child;if(null!==i)return fg(n,i);{const r=n[e.index];return il(r)?Ry(-1,r):es(r)}}if(32&t)return mr(e,n)()||es(n[e.index]);{const i=Ex(n,e);return null!==i?Array.isArray(i)?i[0]:fg(hl(n[16]),i):fg(n,e.next)}}return null}function Ex(n,e){return null!==e?n[16][6].projection[e.projection]:null}function Ry(n,e){const t=10+n+1;if(t<e.length){const i=e[t],r=i[1].firstChild;if(null!==r)return fg(i,r)}return e[7]}function Tx(n,e,t,i,r,s,c){for(;null!=t;){const d=i[t.index],m=t.type;if(c&&0===e&&(d&&Xs(es(d),i),t.flags|=4),64!=(64&t.flags))if(8&m)Tx(n,e,t.child,i,r,s,!1),Pf(e,n,r,d,s);else if(32&m){const y=mr(t,i);let w;for(;w=y();)Pf(e,n,r,w,s);Pf(e,n,r,d,s)}else 16&m?Of(n,e,i,t,r,s):Pf(e,n,r,d,s);t=c?t.projectionNext:t.next}}function Lf(n,e,t,i,r,s){Tx(t,i,n.firstChild,e,r,s,!1)}function Of(n,e,t,i,r,s){const c=t[16],m=c[6].projection[i.projection];if(Array.isArray(m))for(let y=0;y<m.length;y++)Pf(e,n,r,m[y],s);else Tx(n,e,m,c[3],r,s,!0)}function ky(n,e,t){n.setAttribute(e,"style",t)}function Vd(n,e,t){""===t?n.removeAttribute(e,"class"):n.setAttribute(e,"class",t)}function Dx(n,e,t){let i=n.length;for(;;){const r=n.indexOf(e,t);if(-1===r)return r;if(0===r||n.charCodeAt(r-1)<=32){const s=e.length;if(r+s===i||n.charCodeAt(r+s)<=32)return r}t=r+1}}const Ix="ng-template";function Ly(n,e,t){let i=0;for(;i<n.length;){let r=n[i++];if(t&&"class"===r){if(r=n[i],-1!==Dx(r.toLowerCase(),e,0))return!0}else if(1===r){for(;i<n.length&&"string"==typeof(r=n[i++]);)if(r.toLowerCase()===e)return!0;return!1}}return!1}function mg(n){return 4===n.type&&n.value!==Ix}function LT(n,e,t){return e===(4!==n.type||t?n.value:Ix)}function OT(n,e,t){let i=4;const r=n.attrs||[],s=function Px(n){for(let e=0;e<n.length;e++)if(Se(n[e]))return e;return n.length}(r);let c=!1;for(let d=0;d<e.length;d++){const m=e[d];if("number"!=typeof m){if(!c)if(4&i){if(i=2|1&i,""!==m&&!LT(n,m,t)||""===m&&1===e.length){if(mc(i))return!1;c=!0}}else{const y=8&i?m:e[++d];if(8&i&&null!==n.attrs){if(!Ly(n.attrs,y,t)){if(mc(i))return!1;c=!0}continue}const S=FT(8&i?"class":m,r,mg(n),t);if(-1===S){if(mc(i))return!1;c=!0;continue}if(""!==y){let T;T=S>s?"":r[S+1].toLowerCase();const I=8&i?T:null;if(I&&-1!==Dx(I,y,0)||2&i&&y!==T){if(mc(i))return!1;c=!0}}}}else{if(!c&&!mc(i)&&!mc(m))return!1;if(c&&mc(m))continue;c=!1,i=m|1&i}}return mc(i)||c}function mc(n){return 0==(1&n)}function FT(n,e,t,i){if(null===e)return-1;let r=0;if(i||!t){let s=!1;for(;r<e.length;){const c=e[r];if(c===n)return r;if(3===c||6===c)s=!0;else{if(1===c||2===c){let d=e[++r];for(;"string"==typeof d;)d=e[++r];continue}if(4===c)break;if(0===c){r+=4;continue}}r+=s?1:2}return-1}return function NT(n,e){let t=n.indexOf(4);if(t>-1)for(t++;t<n.length;){const i=n[t];if("number"==typeof i)return-1;if(i===e)return t;t++}return-1}(e,n)}function K1(n,e,t=!1){for(let i=0;i<e.length;i++)if(OT(n,e[i],t))return!0;return!1}function Q1(n,e){e:for(let t=0;t<e.length;t++){const i=e[t];if(n.length===i.length){for(let r=0;r<n.length;r++)if(n[r]!==i[r])continue e;return!0}}return!1}function J1(n,e){return n?":not("+e.trim()+")":e}function Rx(n){let e=n[0],t=1,i=2,r="",s=!1;for(;t<n.length;){let c=n[t];if("string"==typeof c)if(2&i){const d=n[++t];r+="["+c+(d.length>0?'="'+d+'"':"")+"]"}else 8&i?r+="."+c:4&i&&(r+=" "+c);else""!==r&&!mc(c)&&(e+=J1(s,r),r=""),i=c,s=s||!mc(i);t++}return""!==r&&(e+=J1(s,r)),e}const Ci={};function Et(n){gg(ai(),Rt(),fo()+n,!1)}function gg(n,e,t,i){if(!i)if(3==(3&e[2])){const s=n.preOrderCheckHooks;null!==s&&E(e,s,t)}else{const s=n.preOrderHooks;null!==s&&P(e,s,0,t)}Bl(t)}function np(n,e=null,t=null,i){const r=Gl(n,e,t,i);return r.resolveInjectorInitializers(),r}function Gl(n,e=null,t=null,i,r=new Set){const s=[t||er,my(n)];return i=i||("object"==typeof n?void 0:vn(n)),new J0(s,e||Xr(),i||null,r)}let Yr=(()=>{class n{static create(t,i){if(Array.isArray(t))return np({name:""},i,t,"");{const r=t.name??"";return np({name:r},t.parent,t.providers,r)}}}return n.THROW_IF_NOT_FOUND=dc,n.NULL=new Mf,n.\u0275prov=Yt({token:n,providedIn:"any",factory:()=>Xe(m1)}),n.__NG_ELEMENT_ID__=-1,n})();function Ie(n,e=Hn.Default){const t=Rt();return null===t?Xe(n,e):dr(Is(),t,Xt(n),e)}function eu(){throw new Error("invalid")}function By(n,e){return n<<17|e<<2}function _c(n){return n>>17&32767}function Gx(n){return 2|n}function tu(n){return(131068&n)>>2}function Vy(n,e){return-131069&n|e<<2}function Uy(n){return 1|n}function eb(n,e){const t=n.contentQueries;if(null!==t)for(let i=0;i<t.length;i+=2){const r=t[i],s=t[i+1];if(-1!==s){const c=n.data[s];Od(r),c.contentQueries(2,e[s],s)}}}function Mg(n,e,t,i,r,s,c,d,m,y,w){const S=e.blueprint.slice();return S[0]=r,S[2]=76|i,(null!==w||n&&1024&n[2])&&(S[2]|=1024),Fm(S),S[3]=S[15]=n,S[8]=t,S[10]=c||n&&n[10],S[11]=d||n&&n[11],S[12]=m||n&&n[12]||null,S[9]=y||n&&n[9]||null,S[6]=s,S[20]=function ag(){return Af++}(),S[21]=w,S[16]=2==e.type?n[16]:S,S}function pl(n,e,t,i,r){let s=n.data[e];if(null===s)s=function Wy(n,e,t,i,r){const s=q_(),c=Wc(),m=n.data[e]=function Yy(n,e,t,i,r,s){return{type:t,index:i,insertBeforeIndex:null,injectorIndex:e?e.injectorIndex:-1,directiveStart:-1,directiveEnd:-1,directiveStylingLast:-1,propertyBindings:null,flags:0,providerIndexes:0,value:r,attrs:s,mergedAttrs:null,localNames:null,initialInputs:void 0,inputs:null,outputs:null,tViews:null,next:null,projectionNext:null,child:null,parent:e,projection:null,styles:null,stylesWithoutHost:null,residualStyles:void 0,classes:null,classesWithoutHost:null,residualClasses:void 0,classBindings:0,styleBindings:0}}(0,c?s:s&&s.parent,t,e,i,r);return null===n.firstChild&&(n.firstChild=m),null!==s&&(c?null==s.child&&null!==m.parent&&(s.child=m):null===s.next&&(s.next=m)),m}(n,e,t,i,r),function Z_(){return ui.lFrame.inI18n}()&&(s.flags|=64);else if(64&s.type){s.type=t,s.value=i,s.attrs=r;const c=function _a(){const n=ui.lFrame,e=n.currentTNode;return n.isParent?e:e.parent}();s.injectorIndex=null===c?-1:c.injectorIndex}return Va(s,!0),s}function nd(n,e,t,i){if(0===t)return-1;const r=e.length;for(let s=0;s<t;s++)e.push(i),n.blueprint.push(i),n.data.push(null);return r}function tb(n,e,t){af(e);try{const i=n.viewQuery;null!==i&&mt(1,i,t);const r=n.template;null!==r&&qy(n,e,r,1,t),n.firstCreatePass&&(n.firstCreatePass=!1),n.staticContentQueries&&eb(n,e),n.staticViewQueries&&mt(2,n.viewQuery,t);const s=n.components;null!==s&&function yM(n,e){for(let t=0;t<e.length;t++)Te(n,e[t])}(e,s)}catch(i){throw n.firstCreatePass&&(n.incompleteFirstPass=!0,n.firstCreatePass=!1),i}finally{e[2]&=-5,Fd()}}function id(n,e,t,i){const r=e[2];if(128!=(128&r)){af(e);try{Fm(e),function Um(n){return ui.lFrame.bindingIndex=n}(n.bindingStartIndex),null!==t&&qy(n,e,t,2,i);const c=3==(3&r);if(c){const y=n.preOrderCheckHooks;null!==y&&E(e,y,null)}else{const y=n.preOrderHooks;null!==y&&P(e,y,0,null),O(e,0)}if(function fe(n){for(let e=_x(n);null!==e;e=yx(e)){if(!e[2])continue;const t=e[9];for(let i=0;i<t.length;i++){const r=t[i],s=r[3];0==(512&r[2])&&tf(s,1),r[2]|=512}}}(e),function Ce(n){for(let e=_x(n);null!==e;e=yx(e))for(let t=10;t<e.length;t++){const i=e[t],r=i[1];Uu(i)&&id(r,i,r.template,i[8])}}(e),null!==n.contentQueries&&eb(n,e),c){const y=n.contentCheckHooks;null!==y&&E(e,y)}else{const y=n.contentHooks;null!==y&&P(e,y,1),O(e,1)}!function gM(n,e){const t=n.hostBindingOpCodes;if(null!==t)try{for(let i=0;i<t.length;i++){const r=t[i];if(r<0)Bl(~r);else{const s=r,c=t[++i],d=t[++i];X_(c,s),d(2,e[s])}}}finally{Bl(-1)}}(n,e);const d=n.components;null!==d&&function _M(n,e){for(let t=0;t<e.length;t++)be(n,e[t])}(e,d);const m=n.viewQuery;if(null!==m&&mt(2,m,i),c){const y=n.viewCheckHooks;null!==y&&E(e,y)}else{const y=n.viewHooks;null!==y&&P(e,y,2),O(e,2)}!0===n.firstUpdatePass&&(n.firstUpdatePass=!1),e[2]&=-41,512&e[2]&&(e[2]&=-513,tf(e[3],-1))}finally{Fd()}}}function qy(n,e,t,i,r){const s=fo(),c=2&i;try{Bl(-1),c&&e.length>22&&gg(n,e,22,!1),t(i,r)}finally{Bl(s)}}function Zy(n,e,t){if(Pm(e)){const r=e.directiveEnd;for(let s=e.directiveStart;s<r;s++){const c=n.data[s];c.contentQueries&&c.contentQueries(1,t[s],s)}}}function $l(n,e,t){!Rd()||(function l(n,e,t,i){const r=t.directiveStart,s=t.directiveEnd;n.firstCreatePass||un(t,e),Xs(i,e);const c=t.initialInputs;for(let d=r;d<s;d++){const m=n.data[d],y=Na(m);y&&B(e,t,m);const w=Yo(e,n,d,t);Xs(w,e),null!==c&&$(0,d-r,w,m,0,c),y&&(Fo(t.index,e)[8]=w)}}(n,e,t,Zr(t,e)),128==(128&t.flags)&&function h(n,e,t){const i=t.directiveStart,r=t.directiveEnd,s=t.index,c=function Hm(){return ui.lFrame.currentDirectiveIndex}();try{Bl(s);for(let d=i;d<r;d++){const m=n.data[d],y=e[d];ju(d),(null!==m.hostBindings||0!==m.hostVars||null!==m.hostAttrs)&&f(m,y)}}finally{Bl(-1),ju(c)}}(n,e,t))}function Cg(n,e,t=Zr){const i=e.localNames;if(null!==i){let r=e.index+1;for(let s=0;s<i.length;s+=2){const c=i[s+1],d=-1===c?t(e,n):n[c];n[r++]=d}}}function Xy(n){const e=n.tView;return null===e||e.incompleteFirstPass?n.tView=fl(1,null,n.template,n.decls,n.vars,n.directiveDefs,n.pipeDefs,n.viewQuery,n.schemas,n.consts):e}function fl(n,e,t,i,r,s,c,d,m,y){const w=22+i,S=w+r,T=function op(n,e){const t=[];for(let i=0;i<e;i++)t.push(i<n?null:Ci);return t}(w,S),I="function"==typeof y?y():y;return T[1]={type:n,blueprint:T,template:t,queries:null,viewQuery:d,declTNode:e,data:T.slice().fill(null,w),bindingStartIndex:w,expandoStartIndex:S,hostBindingOpCodes:null,firstCreatePass:!0,firstUpdatePass:!0,staticViewQueries:!1,staticContentQueries:!1,preOrderHooks:null,preOrderCheckHooks:null,contentHooks:null,contentCheckHooks:null,viewHooks:null,viewCheckHooks:null,destroyHooks:null,cleanup:null,contentQueries:null,components:null,directiveRegistry:"function"==typeof s?s():s,pipeRegistry:"function"==typeof c?c():c,firstChild:null,schemas:m,consts:I,incompleteFirstPass:!1}}function jf(n,e,t,i){const r=wt(e);null===t?r.push(i):(r.push(t),n.firstCreatePass&&It(n).push(i,r.length-1))}function nb(n,e,t){for(let i in n)if(n.hasOwnProperty(i)){const r=n[i];(t=null===t?{}:t).hasOwnProperty(i)?t[i].push(e,r):t[i]=[e,r]}return t}function ib(n,e){const i=e.directiveEnd,r=n.data,s=e.attrs,c=[];let d=null,m=null;for(let y=e.directiveStart;y<i;y++){const w=r[y],S=w.inputs,T=null===s||mg(e)?null:Y(S,s);c.push(T),d=nb(S,y,d),m=nb(w.outputs,y,m)}null!==d&&(d.hasOwnProperty("class")&&(e.flags|=16),d.hasOwnProperty("style")&&(e.flags|=32)),e.initialInputs=c,e.inputs=d,e.outputs=m}function $a(n,e,t,i,r,s,c,d){const m=Zr(e,t);let w,y=e.inputs;!d&&null!=y&&(w=y[i])?(zn(n,t,w,i,r),kh(e)&&rb(t,e.index)):3&e.type&&(i=function XT(n){return"class"===n?"className":"for"===n?"htmlFor":"formaction"===n?"formAction":"innerHtml"===n?"innerHTML":"readonly"===n?"readOnly":"tabindex"===n?"tabIndex":n}(i),r=null!=c?c(r,e.value||"",i):r,s.setProperty(m,i,r))}function rb(n,e){const t=Fo(e,n);16&t[2]||(t[2]|=32)}function Ky(n,e,t,i){let r=!1;if(Rd()){const s=function v(n,e,t){const i=n.directiveRegistry;let r=null;if(i)for(let s=0;s<i.length;s++){const c=i[s];K1(t,c.selectors,!1)&&(r||(r=[]),Lt(un(t,e),n,c.type),Na(c)?(b(n,t),r.unshift(c)):r.push(c))}return r}(n,e,t),c=null===i?null:{"":-1};if(null!==s){r=!0,A(t,n.data.length,s.length);for(let w=0;w<s.length;w++){const S=s[w];S.providersResolver&&S.providersResolver(S)}let d=!1,m=!1,y=nd(n,e,s.length,null);for(let w=0;w<s.length;w++){const S=s[w];t.mergedAttrs=De(t.mergedAttrs,S.hostAttrs),L(n,t,e,y,S),D(y,S,c),null!==S.contentQueries&&(t.flags|=8),(null!==S.hostBindings||null!==S.hostAttrs||0!==S.hostVars)&&(t.flags|=128);const T=S.type.prototype;!d&&(T.ngOnChanges||T.ngOnInit||T.ngDoCheck)&&((n.preOrderHooks||(n.preOrderHooks=[])).push(t.index),d=!0),!m&&(T.ngOnChanges||T.ngDoCheck)&&((n.preOrderCheckHooks||(n.preOrderCheckHooks=[])).push(t.index),m=!0),y++}ib(n,t)}c&&function C(n,e,t){if(e){const i=n.localNames=[];for(let r=0;r<e.length;r+=2){const s=t[e[r+1]];if(null==s)throw new bt(-301,!1);i.push(e[r],s)}}}(t,i,c)}return t.mergedAttrs=De(t.mergedAttrs,t.attrs),r}function a(n,e,t,i,r,s){const c=s.hostBindings;if(c){let d=n.hostBindingOpCodes;null===d&&(d=n.hostBindingOpCodes=[]);const m=~e.index;(function o(n){let e=n.length;for(;e>0;){const t=n[--e];if("number"==typeof t&&t<0)return t}return 0})(d)!=m&&d.push(m),d.push(i,r,c)}}function f(n,e){null!==n.hostBindings&&n.hostBindings(1,e)}function b(n,e){e.flags|=2,(n.components||(n.components=[])).push(e.index)}function D(n,e,t){if(t){if(e.exportAs)for(let i=0;i<e.exportAs.length;i++)t[e.exportAs[i]]=n;Na(e)&&(t[""]=n)}}function A(n,e,t){n.flags|=1,n.directiveStart=e,n.directiveEnd=e+t,n.providerIndexes=e}function L(n,e,t,i,r){n.data[i]=r;const s=r.factory||(r.factory=rl(r.type)),c=new Z(s,Na(r),Ie);n.blueprint[i]=c,t[i]=c,a(n,e,0,i,nd(n,t,r.hostVars,Ci),r)}function B(n,e,t){const i=Zr(e,n),r=Xy(t),s=n[10],c=$e(n,Mg(n,r,null,t.onPush?32:16,i,e,s,s.createRenderer(i,t),null,null,null));n[e.index]=c}function z(n,e,t,i,r,s){const c=Zr(n,e);!function j(n,e,t,i,r,s,c){if(null==s)n.removeAttribute(e,r,t);else{const d=null==c?bn(s):c(s,i||"",r);n.setAttribute(e,r,d,t)}}(e[11],c,s,n.value,t,i,r)}function $(n,e,t,i,r,s){const c=s[e];if(null!==c){const d=i.setInput;for(let m=0;m<c.length;){const y=c[m++],w=c[m++],S=c[m++];null!==d?i.setInput(t,S,y,w):t[w]=S}}}function Y(n,e){let t=null,i=0;for(;i<e.length;){const r=e[i];if(0!==r)if(5!==r){if("number"==typeof r)break;n.hasOwnProperty(r)&&(null===t&&(t=[]),t.push(r,n[r],e[i+1])),i+=2}else i+=2;else i+=4}return t}function me(n,e,t,i){return new Array(n,!0,!1,e,null,0,i,t,null,null)}function be(n,e){const t=Fo(e,n);if(Uu(t)){const i=t[1];48&t[2]?id(i,t,i.template,t[8]):t[5]>0&&Pe(t)}}function Pe(n){for(let i=_x(n);null!==i;i=yx(i))for(let r=10;r<i.length;r++){const s=i[r];if(Uu(s))if(512&s[2]){const c=s[1];id(c,s,c.template,s[8])}else s[5]>0&&Pe(s)}const t=n[1].components;if(null!==t)for(let i=0;i<t.length;i++){const r=Fo(t[i],n);Uu(r)&&r[5]>0&&Pe(r)}}function Te(n,e){const t=Fo(e,n),i=t[1];(function Ze(n,e){for(let t=e.length;t<n.blueprint.length;t++)e.push(n.blueprint[t])})(i,t),tb(i,t,t[8])}function $e(n,e){return n[13]?n[14][4]=e:n[13]=e,n[14]=e,e}function ct(n){for(;n;){n[2]|=32;const e=hl(n);if(Rm(n)&&!e)return n;n=e}return null}function Tt(n,e,t,i=!0){const r=e[10];r.begin&&r.begin();try{id(n,e,n.template,t)}catch(c){throw i&&nn(e,c),c}finally{r.end&&r.end()}}function mt(n,e,t){Od(0),e(n,t)}function wt(n){return n[7]||(n[7]=[])}function It(n){return n.cleanup||(n.cleanup=[])}function nn(n,e){const t=n[9],i=t?t.get(Ku,null):null;i&&i.handleError(e)}function zn(n,e,t,i,r){for(let s=0;s<t.length;){const c=t[s++],d=t[s++],m=e[c],y=n.data[c];null!==y.setInput?y.setInput(m,r,i,d):m[d]=r}}function on(n,e,t){const i=Ba(e,n);!function j1(n,e,t){n.setValue(e,t)}(n[11],i,t)}function ln(n,e,t){let i=t?n.styles:null,r=t?n.classes:null,s=0;if(null!==e)for(let c=0;c<e.length;c++){const d=e[c];"number"==typeof d?s=d:1==s?r=_i(r,d):2==s&&(i=_i(i,d+": "+e[++c]+";"))}t?n.styles=i:n.stylesWithoutHost=i,t?n.classes=r:n.classesWithoutHost=r}function qt(n,e,t,i,r=!1){for(;null!==t;){const s=e[t.index];if(null!==s&&i.push(es(s)),il(s))for(let d=10;d<s.length;d++){const m=s[d],y=m[1].firstChild;null!==y&&qt(m[1],m,y,i)}const c=t.type;if(8&c)qt(n,e,t.child,i);else if(32&c){const d=mr(t,e);let m;for(;m=d();)i.push(m)}else if(16&c){const d=Ex(e,t);if(Array.isArray(d))i.push(...d);else{const m=hl(e[16]);qt(m[1],m,d,i,!0)}}t=r?t.projectionNext:t.next}return i}class Rn{constructor(e,t){this._lView=e,this._cdRefInjectingView=t,this._appRef=null,this._attachedToViewContainer=!1}get rootNodes(){const e=this._lView,t=e[1];return qt(t,e,t.firstChild,[])}get context(){return this._lView[8]}set context(e){this._lView[8]=e}get destroyed(){return 128==(128&this._lView[2])}destroy(){if(this._appRef)this._appRef.detachView(this);else if(this._attachedToViewContainer){const e=this._lView[3];if(il(e)){const t=e[8],i=t?t.indexOf(this):-1;i>-1&&(cg(e,i),Wm(t,i))}this._attachedToViewContainer=!1}bx(this._lView[1],this._lView)}onDestroy(e){jf(this._lView[1],this._lView,null,e)}markForCheck(){ct(this._cdRefInjectingView||this._lView)}detach(){this._lView[2]&=-65}reattach(){this._lView[2]|=64}detectChanges(){Tt(this._lView[1],this._lView,this.context)}checkNoChanges(){}attachToViewContainerRef(){if(this._appRef)throw new bt(902,!1);this._attachedToViewContainer=!0}detachFromAppRef(){this._appRef=null,function $1(n,e){Lf(n,e,e[11],2,null,null)}(this._lView[1],this._lView)}attachToAppRef(e){if(this._attachedToViewContainer)throw new bt(902,!1);this._appRef=e}}class li extends Rn{constructor(e){super(e),this._view=e}detectChanges(){const e=this._view;Tt(e[1],e,e[8],!1)}checkNoChanges(){}get context(){return null}}class ti extends Kc{constructor(e){super(),this.ngModule=e}resolveComponentFactory(e){const t=yr(e);return new ni(t,this.ngModule)}}function Fi(n){const e=[];for(let t in n)n.hasOwnProperty(t)&&e.push({propName:n[t],templateName:t});return e}class Br{constructor(e,t){this.injector=e,this.parentInjector=t}get(e,t,i){const r=this.injector.get(e,sx,i);return r!==sx||t===sx?r:this.parentInjector.get(e,t,i)}}class ni extends v1{constructor(e,t){super(),this.componentDef=e,this.ngModule=t,this.componentType=e.type,this.selector=function BT(n){return n.map(Rx).join(",")}(e.selectors),this.ngContentSelectors=e.ngContentSelectors?e.ngContentSelectors:[],this.isBoundToModule=!!t}get inputs(){return Fi(this.componentDef.inputs)}get outputs(){return Fi(this.componentDef.outputs)}create(e,t,i,r){let s=(r=r||this.ngModule)instanceof fc?r:r?.injector;s&&null!==this.componentDef.getStandaloneInjector&&(s=this.componentDef.getStandaloneInjector(s)||s);const c=s?new Br(e,s):e,d=c.get(sg,null);if(null===d)throw new bt(407,!1);const m=c.get(w1,null),y=d.createRenderer(null,this.componentDef),w=this.componentDef.selectors[0][0]||"div",S=i?function vM(n,e,t){return n.selectRootElement(e,t===pa.ShadowDom)}(y,i,this.componentDef.encapsulation):xx(y,w,function Xn(n){const e=n.toLowerCase();return"svg"===e?"svg":"math"===e?"math":null}(w)),T=this.componentDef.onPush?288:272,I=fl(0,null,null,1,0,null,null,null,null,null),R=Mg(null,I,null,T,null,null,d,y,m,c,null);let k,F;af(R);try{const G=function Or(n,e,t,i,r,s){const c=t[1];t[22]=n;const m=pl(c,22,2,"#host",null),y=m.mergedAttrs=e.hostAttrs;null!==y&&(ln(m,y,!0),null!==n&&(Me(r,n,y),null!==m.classes&&Vd(r,n,m.classes),null!==m.styles&&ky(r,n,m.styles)));const w=i.createRenderer(n,e),S=Mg(t,Xy(e),null,e.onPush?32:16,t[22],m,i,w,s||null,null,null);return c.firstCreatePass&&(Lt(un(m,t),c,e.type),b(c,m),A(m,t.length,1)),$e(t,S),t[22]=S}(S,this.componentDef,R,d,y);if(S)if(i)Me(y,S,["ng-version",yT.full]);else{const{attrs:W,classes:V}=function Ud(n){const e=[],t=[];let i=1,r=2;for(;i<n.length;){let s=n[i];if("string"==typeof s)2===r?""!==s&&e.push(s,n[++i]):8===r&&t.push(s);else{if(!mc(r))break;r=s}i++}return{attrs:e,classes:t}}(this.componentDef.selectors[0]);W&&Me(y,S,W),V&&V.length>0&&Vd(y,S,V.join(" "))}if(F=Jp(I,22),void 0!==t){const W=F.projection=[];for(let V=0;V<this.ngContentSelectors.length;V++){const X=t[V];W.push(null!=X?Array.from(X):null)}}k=function zr(n,e,t,i){const r=t[1],s=function bM(n,e,t){const i=Is();n.firstCreatePass&&(t.providersResolver&&t.providersResolver(t),L(n,i,e,nd(n,e,1,null),t),ib(n,i));const r=Yo(e,n,i.directiveStart,i);Xs(r,e);const s=Zr(i,e);return s&&Xs(s,e),r}(r,t,e);if(n[8]=t[8]=s,null!==i)for(const d of i)d(s,e);if(e.contentQueries){const d=Is();e.contentQueries(1,s,d.directiveStart)}const c=Is();return!r.firstCreatePass||null===e.hostBindings&&null===e.hostAttrs||(Bl(c.index),a(t[1],c,0,c.directiveStart,c.directiveEnd,e),f(e,s)),s}(G,this.componentDef,R,[is]),tb(I,R,null)}finally{Fd()}return new kr(this.componentType,k,Ef(F,R),R,F)}}class kr extends class rg{}{constructor(e,t,i,r,s){super(),this.location=i,this._rootLView=r,this._tNode=s,this.instance=t,this.hostView=this.changeDetectorRef=new li(r),this.componentType=e}setInput(e,t){const i=this._tNode.inputs;let r;if(null!==i&&(r=i[e])){const s=this._rootLView;zn(s[1],s,r,e,t),rb(s,this._tNode.index)}}get injector(){return new jr(this._tNode,this._rootLView)}destroy(){this.hostView.destroy()}onDestroy(e){this.hostView.onDestroy(e)}}function is(){const n=Is();M(Rt()[1],n)}function dn(n){let e=function $s(n){return Object.getPrototypeOf(n.prototype).constructor}(n.type),t=!0;const i=[n];for(;e;){let r;if(Na(n))r=e.\u0275cmp||e.\u0275dir;else{if(e.\u0275cmp)throw new bt(903,!1);r=e.\u0275dir}if(r){if(t){i.push(r);const c=n;c.inputs=rs(n.inputs),c.declaredInputs=rs(n.declaredInputs),c.outputs=rs(n.outputs);const d=r.hostBindings;d&&Ls(n,d);const m=r.viewQuery,y=r.contentQueries;if(m&&zi(n,m),y&&Wr(n,y),Zt(n.inputs,r.inputs),Zt(n.declaredInputs,r.declaredInputs),Zt(n.outputs,r.outputs),Na(r)&&r.data.animation){const w=n.data;w.animation=(w.animation||[]).concat(r.data.animation)}}const s=r.features;if(s)for(let c=0;c<s.length;c++){const d=s[c];d&&d.ngInherit&&d(n),d===dn&&(t=!1)}}e=Object.getPrototypeOf(e)}!function Ms(n){let e=0,t=null;for(let i=n.length-1;i>=0;i--){const r=n[i];r.hostVars=e+=r.hostVars,r.hostAttrs=De(r.hostAttrs,t=De(t,r.hostAttrs))}}(i)}function rs(n){return n===ic?{}:n===er?[]:n}function zi(n,e){const t=n.viewQuery;n.viewQuery=t?(i,r)=>{e(i,r),t(i,r)}:e}function Wr(n,e){const t=n.contentQueries;n.contentQueries=t?(i,r,s)=>{e(i,r,s),t(i,r,s)}:e}function Ls(n,e){const t=n.hostBindings;n.hostBindings=t?(i,r)=>{e(i,r),t(i,r)}:e}let Cs=null;function ss(){if(!Cs){const n=cr.Symbol;if(n&&n.iterator)Cs=n.iterator;else{const e=Object.getOwnPropertyNames(Map.prototype);for(let t=0;t<e.length;++t){const i=e[t];"entries"!==i&&"size"!==i&&Map.prototype[i]===Map.prototype.entries&&(Cs=i)}}}return Cs}function ys(n){return!!ap(n)&&(Array.isArray(n)||!(n instanceof Map)&&ss()in n)}function ap(n){return null!==n&&("function"==typeof n||"object"==typeof n)}function Bo(n,e,t){return!Object.is(n[e],t)&&(n[e]=t,!0)}function sd(n,e,t,i){const r=Bo(n,e,t);return Bo(n,e+1,i)||r}function tr(n,e,t,i){const r=Rt();return Bo(r,Gu(),e)&&(ai(),z(ts(),r,n,e,t,i)),tr}function Wd(n,e,t,i){return Bo(n,Gu(),t)?e+bn(t)+i:Ci}function Zf(n,e,t,i,r,s,c,d,m,y,w,S){const T=function po(){return ui.lFrame.bindingIndex}();let I=function Os(n,e,t,i,r,s){const c=sd(n,e,t,i);return sd(n,e+2,r,s)||c}(n,T,t,r,c,m);return I=Bo(n,T+4,w)||I,ya(5),I?e+bn(t)+i+bn(r)+s+bn(c)+d+bn(m)+y+bn(w)+S:Ci}function Di(n,e,t,i,r,s,c,d){const m=Rt(),y=ai(),w=n+22,S=y.firstCreatePass?function w5(n,e,t,i,r,s,c,d,m){const y=e.consts,w=pl(e,n,4,c||null,za(y,d));Ky(e,t,w,za(y,m)),M(e,w);const S=w.tViews=fl(2,w,i,r,s,e.directiveRegistry,e.pipeRegistry,null,e.schemas,y);return null!==e.queries&&(e.queries.template(e,w),S.queries=e.queries.embeddedTView(w)),w}(w,y,m,e,t,i,r,s,c):y.data[w];Va(S,!1);const T=m[11].createComment("");pg(y,m,T,S),Xs(T,m),$e(m,m[w]=me(T,m,T,S)),Lh(S)&&$l(y,m,S),null!=c&&Cg(m,S,d)}function ob(n){return cc(function tn(){return ui.lFrame.contextLView}(),22+n)}function Kt(n,e,t){const i=Rt();return Bo(i,Gu(),e)&&$a(ai(),ts(),i,n,e,i[11],t,!1),Kt}function KT(n,e,t,i,r){const c=r?"class":"style";zn(n,t,e.inputs[c],c,i)}function Ae(n,e,t,i){const r=Rt(),s=ai(),c=22+n,d=r[11],m=r[c]=xx(d,e,function p(){return ui.lFrame.currentNamespace}()),y=s.firstCreatePass?function C5(n,e,t,i,r,s,c){const d=e.consts,y=pl(e,n,2,r,za(d,s));return Ky(e,t,y,za(d,c)),null!==y.attrs&&ln(y,y.attrs,!1),null!==y.mergedAttrs&&ln(y,y.mergedAttrs,!0),null!==e.queries&&e.queries.elementStart(e,y),y}(c,s,r,0,e,t,i):s.data[c];Va(y,!0);const w=y.mergedAttrs;null!==w&&Me(d,m,w);const S=y.classes;null!==S&&Vd(d,m,S);const T=y.styles;return null!==T&&ky(d,m,T),64!=(64&y.flags)&&pg(s,r,m,y),0===function Hu(){return ui.lFrame.elementDepthCount}()&&Xs(m,r),function $_(){ui.lFrame.elementDepthCount++}(),Lh(y)&&($l(s,r,y),Zy(s,y,r)),null!==i&&Cg(r,y),Ae}function xe(){let n=Is();Wc()?Ua():(n=n.parent,Va(n,!1));const e=n;!function nf(){ui.lFrame.elementDepthCount--}();const t=ai();return t.firstCreatePass&&(M(t,n),Pm(n)&&t.queries.elementEnd(n)),null!=e.classesWithoutHost&&function re(n){return 0!=(16&n.flags)}(e)&&KT(t,e,Rt(),e.classesWithoutHost,!0),null!=e.stylesWithoutHost&&function ne(n){return 0!=(32&n.flags)}(e)&&KT(t,e,Rt(),e.stylesWithoutHost,!1),xe}function jt(n,e,t,i){return Ae(n,e,t,i),xe(),jt}function ab(n,e,t){const i=Rt(),r=ai(),s=n+22,c=r.firstCreatePass?function S5(n,e,t,i,r){const s=e.consts,c=za(s,i),d=pl(e,n,8,"ng-container",c);return null!==c&&ln(d,c,!0),Ky(e,t,d,za(s,r)),null!==e.queries&&e.queries.elementStart(e,d),d}(s,r,i,e,t):r.data[s];Va(c,!0);const d=i[s]=i[11].createComment("");return pg(r,i,d,c),Xs(d,i),Lh(c)&&($l(r,i,c),Zy(r,c,i)),null!=t&&Cg(i,c),ab}function lb(){let n=Is();const e=ai();return Wc()?Ua():(n=n.parent,Va(n,!1)),e.firstCreatePass&&(M(e,n),Pm(n)&&e.queries.elementEnd(n)),lb}function Yd(){return Rt()}function cb(n){return!!n&&"function"==typeof n.then}const QT=function PR(n){return!!n&&"function"==typeof n.subscribe};function gi(n,e,t,i){const r=Rt(),s=ai(),c=Is();return function kR(n,e,t,i,r,s,c,d){const m=Lh(i),w=n.firstCreatePass&&It(n),S=e[8],T=wt(e);let I=!0;if(3&i.type||d){const F=Zr(i,e),G=d?d(F):F,W=T.length,V=d?ee=>d(es(ee[i.index])):i.index;let X=null;if(!d&&m&&(X=function E5(n,e,t,i){const r=n.cleanup;if(null!=r)for(let s=0;s<r.length-1;s+=2){const c=r[s];if(c===t&&r[s+1]===i){const d=e[7],m=r[s+2];return d.length>m?d[m]:null}"string"==typeof c&&(s+=2)}return null}(n,e,r,i.index)),null!==X)(X.__ngLastListenerFn__||X).__ngNextListenerFn__=s,X.__ngLastListenerFn__=s,I=!1;else{s=OR(i,e,S,s,!1);const ee=t.listen(G,r,s);T.push(s,ee),w&&w.push(r,V,W,W+1)}}else s=OR(i,e,S,s,!1);const R=i.outputs;let k;if(I&&null!==R&&(k=R[r])){const F=k.length;if(F)for(let G=0;G<F;G+=2){const ae=e[k[G]][k[G+1]].subscribe(s),Ee=T.length;T.push(s,ae),w&&w.push(r,i.index,Ee,-(Ee+1))}}}(s,r,r[11],c,n,e,0,i),gi}function LR(n,e,t,i){try{return!1!==t(i)}catch(r){return nn(n,r),!1}}function OR(n,e,t,i,r){return function s(c){if(c===Function)return i;ct(2&n.flags?Fo(n.index,e):e);let m=LR(e,0,i,c),y=s.__ngNextListenerFn__;for(;y;)m=LR(e,0,y,c)&&m,y=y.__ngNextListenerFn__;return r&&!1===m&&(c.preventDefault(),c.returnValue=!1),m}}function ki(n=1){return function Y_(n){return(ui.lFrame.contextLView=function K_(n,e){for(;n>0;)e=e[15],n--;return e}(n,ui.lFrame.contextLView))[8]}(n)}function T5(n,e){let t=null;const i=function Ff(n){const e=n.attrs;if(null!=e){const t=e.indexOf(5);if(0==(1&t))return e[t+1]}return null}(n);for(let r=0;r<e.length;r++){const s=e[r];if("*"!==s){if(null===i?K1(n,s,!0):Q1(i,s))return r}else t=r}return t}function iu(n){const e=Rt()[16][6];if(!e.projection){const i=e.projection=hf(n?n.length:1,null),r=i.slice();let s=e.child;for(;null!==s;){const c=n?T5(s,n):0;null!==c&&(r[c]?r[c].projectionNext=s:i[c]=s,r[c]=s),s=s.next}}}function us(n,e=0,t){const i=Rt(),r=ai(),s=pl(r,22+n,16,null,t||null);null===s.projection&&(s.projection=e),Ua(),64!=(64&s.flags)&&function Z1(n,e,t){Of(e[11],0,e,t,Ay(n,t,e),Iy(t.parent||e[6],t,e))}(r,i,s)}function JT(n,e,t){return eD(n,"",e,"",t),JT}function eD(n,e,t,i,r){const s=Rt(),c=Wd(s,e,t,i);return c!==Ci&&$a(ai(),ts(),s,n,c,s[11],r,!1),eD}function jR(n,e,t,i,r){const s=n[t+1],c=null===e;let d=i?_c(s):tu(s),m=!1;for(;0!==d&&(!1===m||c);){const w=n[d+1];I5(n[d],e)&&(m=!0,n[d+1]=i?Uy(w):Gx(w)),d=i?_c(w):tu(w)}m&&(n[t+1]=i?Gx(s):Uy(s))}function I5(n,e){return null===n||null==e||(Array.isArray(n)?n[1]:n)===e||!(!Array.isArray(n)||"string"!=typeof e)&&jh(n,e)>=0}const zo={textEnd:0,key:0,keyEnd:0,value:0,valueEnd:0};function $R(n){return n.substring(zo.key,zo.keyEnd)}function WR(n,e){const t=zo.textEnd;return t===e?-1:(e=zo.keyEnd=function L5(n,e,t){for(;e<t&&n.charCodeAt(e)>32;)e++;return e}(n,zo.key=e,t),Jy(n,e,t))}function Jy(n,e,t){for(;e<t&&n.charCodeAt(e)<=32;)e++;return e}function Eg(n,e,t){return od(n,e,t,!1),Eg}function ds(n,e){return od(n,e,null,!0),ds}function Qd(n,e){for(let t=function R5(n){return function ZR(n){zo.key=0,zo.keyEnd=0,zo.value=0,zo.valueEnd=0,zo.textEnd=n.length}(n),WR(n,Jy(n,0,zo.textEnd))}(e);t>=0;t=WR(e,t))ks(n,$R(e),!0)}function od(n,e,t,i){const r=Rt(),s=ai(),c=ya(2);s.firstUpdatePass&&QR(s,n,c,i),e!==Ci&&Bo(r,c,e)&&ek(s,s.data[fo()],r,r[11],n,r[c+1]=function $5(n,e){return null==n||("string"==typeof e?n+=e:"object"==typeof n&&(n=vn(Qo(n)))),n}(e,t),i,c)}function KR(n,e){return e>=n.expandoStartIndex}function QR(n,e,t,i){const r=n.data;if(null===r[t+1]){const s=r[fo()],c=KR(n,t);nk(s,i)&&null===e&&!c&&(e=!1),e=function z5(n,e,t,i){const r=function kd(n){const e=ui.lFrame.currentDirectiveIndex;return-1===e?null:n[e]}(n);let s=i?e.residualClasses:e.residualStyles;if(null===r)0===(i?e.classBindings:e.styleBindings)&&(t=ub(t=tD(null,n,e,t,i),e.attrs,i),s=null);else{const c=e.directiveStylingLast;if(-1===c||n[c]!==r)if(t=tD(r,n,e,t,i),null===s){let m=function V5(n,e,t){const i=t?e.classBindings:e.styleBindings;if(0!==tu(i))return n[_c(i)]}(n,e,i);void 0!==m&&Array.isArray(m)&&(m=tD(null,n,e,m[1],i),m=ub(m,e.attrs,i),function U5(n,e,t,i){n[_c(t?e.classBindings:e.styleBindings)]=i}(n,e,i,m))}else s=function H5(n,e,t){let i;const r=e.directiveEnd;for(let s=1+e.directiveStylingLast;s<r;s++)i=ub(i,n[s].hostAttrs,t);return ub(i,e.attrs,t)}(n,e,i)}return void 0!==s&&(i?e.residualClasses=s:e.residualStyles=s),t}(r,s,e,i),function D5(n,e,t,i,r,s){let c=s?e.classBindings:e.styleBindings,d=_c(c),m=tu(c);n[i]=t;let w,y=!1;if(Array.isArray(t)){const S=t;w=S[1],(null===w||jh(S,w)>0)&&(y=!0)}else w=t;if(r)if(0!==m){const T=_c(n[d+1]);n[i+1]=By(T,d),0!==T&&(n[T+1]=Vy(n[T+1],i)),n[d+1]=function zy(n,e){return 131071&n|e<<17}(n[d+1],i)}else n[i+1]=By(d,0),0!==d&&(n[d+1]=Vy(n[d+1],i)),d=i;else n[i+1]=By(m,0),0===d?d=i:n[m+1]=Vy(n[m+1],i),m=i;y&&(n[i+1]=Gx(n[i+1])),jR(n,w,i,!0),jR(n,w,i,!1),function A5(n,e,t,i,r){const s=r?n.residualClasses:n.residualStyles;null!=s&&"string"==typeof e&&jh(s,e)>=0&&(t[i+1]=Uy(t[i+1]))}(e,w,n,i,s),c=By(d,m),s?e.classBindings=c:e.styleBindings=c}(r,s,e,t,c,i)}}function tD(n,e,t,i,r){let s=null;const c=t.directiveEnd;let d=t.directiveStylingLast;for(-1===d?d=t.directiveStart:d++;d<c&&(s=e[d],i=ub(i,s.hostAttrs,r),s!==n);)d++;return null!==n&&(t.directiveStylingLast=d),i}function ub(n,e,t){const i=t?1:2;let r=-1;if(null!==e)for(let s=0;s<e.length;s++){const c=e[s];"number"==typeof c?r=c:r===i&&(Array.isArray(n)||(n=void 0===n?[]:["",n]),ks(n,c,!!t||e[++s]))}return void 0===n?null:n}function ek(n,e,t,i,r,s,c,d){if(!(3&e.type))return;const m=n.data,y=m[d+1];wM(function lM(n){return 1==(1&n)}(y)?tk(m,e,t,r,tu(y),c):void 0)||(wM(s)||function sp(n){return 2==(2&n)}(y)&&(s=tk(m,null,t,r,d,c)),function Y1(n,e,t,i,r){if(e)r?n.addClass(t,i):n.removeClass(t,i);else{let s=-1===i.indexOf("-")?void 0:Ma.DashCase;null==r?n.removeStyle(t,i,s):("string"==typeof r&&r.endsWith("!important")&&(r=r.slice(0,-10),s|=Ma.Important),n.setStyle(t,i,r,s))}}(i,c,Ba(fo(),t),r,s))}function tk(n,e,t,i,r,s){const c=null===e;let d;for(;r>0;){const m=n[r],y=Array.isArray(m),w=y?m[1]:m,S=null===w;let T=t[r+1];T===Ci&&(T=S?er:void 0);let I=S?pf(T,i):w===i?T:void 0;if(y&&!wM(I)&&(I=pf(m,i)),wM(I)&&(d=I,c))return d;const R=n[r+1];r=c?_c(R):tu(R)}if(null!==e){let m=s?e.residualClasses:e.residualStyles;null!=m&&(d=pf(m,i))}return d}function wM(n){return void 0!==n}function nk(n,e){return 0!=(n.flags&(e?16:32))}function it(n,e=""){const t=Rt(),i=ai(),r=n+22,s=i.firstCreatePass?pl(i,r,1,e,null):i.data[r],c=t[r]=function vx(n,e){return n.createText(e)}(t[11],e);pg(i,t,c,s),Va(s,!1)}function Qs(n){return Vo("",n,""),Qs}function Vo(n,e,t){const i=Rt(),r=Wd(i,n,e,t);return r!==Ci&&on(i,fo(),r),Vo}function MM(n,e,t,i,r,s,c,d,m,y,w){const S=Rt(),T=Zf(S,n,e,t,i,r,s,c,d,m,y,w);return T!==Ci&&on(S,fo(),T),MM}function uk(n,e,t){!function ad(n,e,t,i){const r=ai(),s=ya(2);r.firstUpdatePass&&QR(r,null,s,i);const c=Rt();if(t!==Ci&&Bo(c,s,t)){const d=r.data[fo()];if(nk(d,i)&&!KR(r,s)){let m=i?d.classesWithoutHost:d.stylesWithoutHost;null!==m&&(t=_i(m,t||"")),KT(r,d,c,t,i)}else!function j5(n,e,t,i,r,s,c,d){r===Ci&&(r=er);let m=0,y=0,w=0<r.length?r[0]:null,S=0<s.length?s[0]:null;for(;null!==w||null!==S;){const T=m<r.length?r[m+1]:void 0,I=y<s.length?s[y+1]:void 0;let k,R=null;w===S?(m+=2,y+=2,T!==I&&(R=S,k=I)):null===S||null!==w&&w<S?(m+=2,R=w):(y+=2,R=S,k=I),null!==R&&ek(n,e,t,i,R,k,c,d),w=m<r.length?r[m]:null,S=y<s.length?s[y]:null}}(r,d,c,c[11],c[s+1],c[s+1]=function G5(n,e,t){if(null==t||""===t)return er;const i=[],r=Qo(t);if(Array.isArray(r))for(let s=0;s<r.length;s++)n(i,r[s],!0);else if("object"==typeof r)for(const s in r)r.hasOwnProperty(s)&&n(i,s,r[s]);else"string"==typeof r&&e(i,r);return i}(n,e,t),i,s)}}(ks,Qd,Wd(Rt(),n,e,t),!0)}function ev(n,e,t){const i=Rt();return Bo(i,Gu(),e)&&$a(ai(),ts(),i,n,e,i[11],t,!0),ev}const Tg=void 0;var uH=["en",[["a","p"],["AM","PM"],Tg],[["AM","PM"],Tg,Tg],[["S","M","T","W","T","F","S"],["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],["Su","Mo","Tu","We","Th","Fr","Sa"]],Tg,[["J","F","M","A","M","J","J","A","S","O","N","D"],["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],["January","February","March","April","May","June","July","August","September","October","November","December"]],Tg,[["B","A"],["BC","AD"],["Before Christ","Anno Domini"]],0,[6,0],["M/d/yy","MMM d, y","MMMM d, y","EEEE, MMMM d, y"],["h:mm a","h:mm:ss a","h:mm:ss a z","h:mm:ss a zzzz"],["{1}, {0}",Tg,"{1} 'at' {0}",Tg],[".",",",";","%","+","-","E","\xd7","\u2030","\u221e","NaN",":"],["#,##0.###","#,##0%","\xa4#,##0.00","#E0"],"USD","$","US Dollar",{},"ltr",function cH(n){const t=Math.floor(Math.abs(n)),i=n.toString().replace(/^[^.]*\.?/,"").length;return 1===t&&0===i?1:5}];let tv={};function gl(n){const e=function dH(n){return n.toLowerCase().replace(/_/g,"-")}(n);let t=wk(e);if(t)return t;const i=e.split("-")[0];if(t=wk(i),t)return t;if("en"===i)return uH;throw new bt(701,!1)}function wk(n){return n in tv||(tv[n]=cr.ng&&cr.ng.common&&cr.ng.common.locales&&cr.ng.common.locales[n]),tv[n]}var Cn=(()=>((Cn=Cn||{})[Cn.LocaleId=0]="LocaleId",Cn[Cn.DayPeriodsFormat=1]="DayPeriodsFormat",Cn[Cn.DayPeriodsStandalone=2]="DayPeriodsStandalone",Cn[Cn.DaysFormat=3]="DaysFormat",Cn[Cn.DaysStandalone=4]="DaysStandalone",Cn[Cn.MonthsFormat=5]="MonthsFormat",Cn[Cn.MonthsStandalone=6]="MonthsStandalone",Cn[Cn.Eras=7]="Eras",Cn[Cn.FirstDayOfWeek=8]="FirstDayOfWeek",Cn[Cn.WeekendRange=9]="WeekendRange",Cn[Cn.DateFormat=10]="DateFormat",Cn[Cn.TimeFormat=11]="TimeFormat",Cn[Cn.DateTimeFormat=12]="DateTimeFormat",Cn[Cn.NumberSymbols=13]="NumberSymbols",Cn[Cn.NumberFormats=14]="NumberFormats",Cn[Cn.CurrencyCode=15]="CurrencyCode",Cn[Cn.CurrencySymbol=16]="CurrencySymbol",Cn[Cn.CurrencyName=17]="CurrencyName",Cn[Cn.Currencies=18]="Currencies",Cn[Cn.Directionality=19]="Directionality",Cn[Cn.PluralCase=20]="PluralCase",Cn[Cn.ExtraData=21]="ExtraData",Cn))();const nv="en-US";let Mk=nv;function rD(n,e,t,i,r){if(n=Xt(n),Array.isArray(n))for(let s=0;s<n.length;s++)rD(n[s],e,t,i,r);else{const s=ai(),c=Rt();let d=Qh(n)?n:Xt(n.provide),m=ex(n);const y=Is(),w=1048575&y.providerIndexes,S=y.directiveStart,T=y.providerIndexes>>20;if(Qh(n)||!n.multi){const I=new Z(m,r,Ie),R=oD(d,e,r?w:w+T,S);-1===R?(Lt(un(y,c),s,d),sD(s,n,e.length),e.push(d),y.directiveStart++,y.directiveEnd++,r&&(y.providerIndexes+=1048576),t.push(I),c.push(I)):(t[R]=I,c[R]=I)}else{const I=oD(d,e,w+T,S),R=oD(d,e,w,w+T),k=I>=0&&t[I],F=R>=0&&t[R];if(r&&!F||!r&&!k){Lt(un(y,c),s,d);const G=function c6(n,e,t,i,r){const s=new Z(n,t,Ie);return s.multi=[],s.index=e,s.componentProviders=0,Zk(s,r,i&&!t),s}(r?l6:a6,t.length,r,i,m);!r&&F&&(t[R].providerFactory=G),sD(s,n,e.length,0),e.push(d),y.directiveStart++,y.directiveEnd++,r&&(y.providerIndexes+=1048576),t.push(G),c.push(G)}else sD(s,n,I>-1?I:R,Zk(t[r?R:I],m,!r&&i));!r&&i&&F&&t[R].componentProviders++}}}function sD(n,e,t,i){const r=Qh(e),s=function pT(n){return!!n.useClass}(e);if(r||s){const m=(s?Xt(e.useClass):e).prototype.ngOnDestroy;if(m){const y=n.destroyHooks||(n.destroyHooks=[]);if(!r&&e.multi){const w=y.indexOf(t);-1===w?y.push(t,[i,m]):y[w+1].push(i,m)}else y.push(t,m)}}}function Zk(n,e,t){return t&&n.componentProviders++,n.multi.push(e)-1}function oD(n,e,t,i){for(let r=t;r<i;r++)if(e[r]===n)return r;return-1}function a6(n,e,t,i){return aD(this.multi,[])}function l6(n,e,t,i){const r=this.multi;let s;if(this.providerFactory){const c=this.providerFactory.componentProviders,d=Yo(t,t[1],this.providerFactory.index,i);s=d.slice(0,c),aD(r,s);for(let m=c;m<d.length;m++)s.push(d[m])}else s=[],aD(r,s);return s}function aD(n,e){for(let t=0;t<n.length;t++)e.push((0,n[t])());return e}function hr(n,e=[]){return t=>{t.providersResolver=(i,r)=>function o6(n,e,t){const i=ai();if(i.firstCreatePass){const r=Na(n);rD(t,i.data,i.blueprint,r,!0),rD(e,i.data,i.blueprint,r,!1)}}(i,r?r(n):n,e)}}class Dg{}class Xk{}class Yk extends Dg{constructor(e,t){super(),this._parent=t,this._bootstrapComponents=[],this.destroyCbs=[],this.componentFactoryResolver=new ti(this);const i=Xo(e);this._bootstrapComponents=ja(i.bootstrap),this._r3Injector=Gl(e,t,[{provide:Dg,useValue:this},{provide:Kc,useValue:this.componentFactoryResolver}],vn(e),new Set(["environment"])),this._r3Injector.resolveInjectorInitializers(),this.instance=this._r3Injector.get(e)}get injector(){return this._r3Injector}destroy(){const e=this._r3Injector;!e.destroyed&&e.destroy(),this.destroyCbs.forEach(t=>t()),this.destroyCbs=null}onDestroy(e){this.destroyCbs.push(e)}}class lD extends Xk{constructor(e){super(),this.moduleType=e}create(e){return new Yk(this.moduleType,e)}}class d6 extends Dg{constructor(e,t,i){super(),this.componentFactoryResolver=new ti(this),this.instance=null;const r=new J0([...e,{provide:Dg,useValue:this},{provide:Kc,useValue:this.componentFactoryResolver}],t||Xr(),i,new Set(["environment"]));this.injector=r,r.resolveInjectorInitializers()}destroy(){this.injector.destroy()}onDestroy(e){this.injector.onDestroy(e)}}function DM(n,e,t=null){return new d6(n,e,t).injector}let h6=(()=>{class n{constructor(t){this._injector=t,this.cachedInjectors=new Map}getOrCreateStandaloneInjector(t){if(!t.standalone)return null;if(!this.cachedInjectors.has(t.id)){const i=Y0(0,t.type),r=i.length>0?DM([i],this._injector,`Standalone[${t.type.name}]`):null;this.cachedInjectors.set(t.id,r)}return this.cachedInjectors.get(t.id)}ngOnDestroy(){try{for(const t of this.cachedInjectors.values())null!==t&&t.destroy()}finally{this.cachedInjectors.clear()}}}return n.\u0275prov=Yt({token:n,providedIn:"environment",factory:()=>new n(Xe(fc))}),n})();function Kk(n){n.getStandaloneInjector=e=>e.get(h6).getOrCreateStandaloneInjector(n)}function uD(n,e,t,i){return rL(Rt(),Ps(),n,e,t,i)}function rL(n,e,t,i,r,s){const c=e+t;return Bo(n,c,r)?function vc(n,e,t){return n[e]=t}(n,c+1,s?i.call(s,r):i(r)):function gb(n,e){const t=n[e];return t===Ci?void 0:t}(n,c+1)}function dD(n,e){const t=ai();let i;const r=n+22;t.firstCreatePass?(i=function I6(n,e){if(e)for(let t=e.length-1;t>=0;t--){const i=e[t];if(n===i.name)return i}}(e,t.pipeRegistry),t.data[r]=i,i.onDestroy&&(t.destroyHooks||(t.destroyHooks=[])).push(r,i.onDestroy)):i=t.data[r];const s=i.factory||(i.factory=rl(i.type)),c=gs(Ie);try{const d=ht(!1),m=s();return ht(d),function M5(n,e,t,i){t>=n.data.length&&(n.data[t]=null,n.blueprint[t]=null),e[t]=i}(t,Rt(),r,m),m}finally{gs(c)}}function hD(n,e,t){const i=n+22,r=Rt(),s=cc(r,i);return function _b(n,e){return n[1].data[e].pure}(r,i)?rL(r,Ps(),e,s.transform,t,s):s.transform(t)}function pD(n){return e=>{setTimeout(n,void 0,e)}}const Dn=class O6 extends si{constructor(e=!1){super(),this.__isAsync=e}emit(e){super.next(e)}subscribe(e,t,i){let r=e,s=t||(()=>null),c=i;if(e&&"object"==typeof e){const m=e;r=m.next?.bind(m),s=m.error?.bind(m),c=m.complete?.bind(m)}this.__isAsync&&(s=pD(s),r&&(r=pD(r)),c&&(c=pD(c)));const d=super.subscribe({next:r,error:s,complete:c});return e instanceof lt&&e.add(d),d}};function F6(){return this._results[ss()]()}class iv{constructor(e=!1){this._emitDistinctChangesOnly=e,this.dirty=!0,this._results=[],this._changesDetected=!1,this._changes=null,this.length=0,this.first=void 0,this.last=void 0;const t=ss(),i=iv.prototype;i[t]||(i[t]=F6)}get changes(){return this._changes||(this._changes=new Dn)}get(e){return this._results[e]}map(e){return this._results.map(e)}filter(e){return this._results.filter(e)}find(e){return this._results.find(e)}reduce(e,t){return this._results.reduce(e,t)}forEach(e){this._results.forEach(e)}some(e){return this._results.some(e)}toArray(){return this._results.slice()}toString(){return this._results.toString()}reset(e,t){const i=this;i.dirty=!1;const r=al(e);(this._changesDetected=!function jw(n,e,t){if(n.length!==e.length)return!1;for(let i=0;i<n.length;i++){let r=n[i],s=e[i];if(t&&(r=t(r),s=t(s)),s!==r)return!1}return!0}(i._results,r,t))&&(i._results=r,i.length=r.length,i.last=r[this.length-1],i.first=r[0])}notifyOnChanges(){this._changes&&(this._changesDetected||!this._emitDistinctChangesOnly)&&this._changes.emit(this)}setDirty(){this.dirty=!0}destroy(){this.changes.complete(),this.changes.unsubscribe()}}let ld=(()=>{class n{}return n.__NG_ELEMENT_ID__=z6,n})();const N6=ld,B6=class extends N6{constructor(e,t,i){super(),this._declarationLView=e,this._declarationTContainer=t,this.elementRef=i}createEmbeddedView(e,t){const i=this._declarationTContainer.tViews,r=Mg(this._declarationLView,i,e,16,null,i.declTNode,null,null,null,null,t||null);r[17]=this._declarationLView[this._declarationTContainer.index];const c=this._declarationLView[19];return null!==c&&(r[19]=c.createEmbeddedView(i)),tb(i,r,e),new Rn(r)}};function z6(){return AM(Is(),Rt())}function AM(n,e){return 4&n.type?new B6(e,n,Ef(n,e)):null}let ql=(()=>{class n{}return n.__NG_ELEMENT_ID__=V6,n})();function V6(){return dL(Is(),Rt())}const U6=ql,cL=class extends U6{constructor(e,t,i){super(),this._lContainer=e,this._hostTNode=t,this._hostLView=i}get element(){return Ef(this._hostTNode,this._hostLView)}get injector(){return new jr(this._hostTNode,this._hostLView)}get parentInjector(){const e=mn(this._hostTNode,this._hostLView);if(Ke(e)){const t=Ne(e,this._hostLView),i=je(e);return new jr(t[1].data[i+8],t)}return new jr(null,this._hostLView)}clear(){for(;this.length>0;)this.remove(this.length-1)}get(e){const t=uL(this._lContainer);return null!==t&&t[e]||null}get length(){return this._lContainer.length-10}createEmbeddedView(e,t,i){let r,s;"number"==typeof i?r=i:null!=i&&(r=i.index,s=i.injector);const c=e.createEmbeddedView(t||{},s);return this.insert(c,r),c}createComponent(e,t,i,r,s){const c=e&&!function df(n){return"function"==typeof n}(e);let d;if(c)d=t;else{const S=t||{};d=S.index,i=S.injector,r=S.projectableNodes,s=S.environmentInjector||S.ngModuleRef}const m=c?e:new ni(yr(e)),y=i||this.parentInjector;if(!s&&null==m.ngModule){const T=(c?y:this.parentInjector).get(fc,null);T&&(s=T)}const w=m.create(y,r,void 0,s);return this.insert(w.hostView,d),w}insert(e,t){const i=e._lView,r=i[1];if(function ef(n){return il(n[3])}(i)){const w=this.indexOf(e);if(-1!==w)this.detach(w);else{const S=i[3],T=new cL(S,S[6],S[3]);T.detach(T.indexOf(e))}}const s=this._adjustIndex(t),c=this._lContainer;!function IT(n,e,t,i){const r=10+i,s=t.length;i>0&&(t[r-1][4]=e),i<s-10?(e[4]=t[r],Gh(t,10+i,e)):(t.push(e),e[4]=null),e[3]=t;const c=e[17];null!==c&&t!==c&&function PT(n,e){const t=n[9];e[16]!==e[3][3][16]&&(n[2]=!0),null===t?n[9]=[e]:t.push(e)}(c,e);const d=e[19];null!==d&&d.insertView(n),e[2]|=64}(r,i,c,s);const d=Ry(s,c),m=i[11],y=hg(m,c[7]);return null!==y&&function Rf(n,e,t,i,r,s){i[0]=r,i[6]=e,Lf(n,i,t,1,r,s)}(r,c[6],m,i,y,d),e.attachToViewContainerRef(),Gh(fD(c),s,e),e}move(e,t){return this.insert(e,t)}indexOf(e){const t=uL(this._lContainer);return null!==t?t.indexOf(e):-1}remove(e){const t=this._adjustIndex(e,-1),i=cg(this._lContainer,t);i&&(Wm(fD(this._lContainer),t),bx(i[1],i))}detach(e){const t=this._adjustIndex(e,-1),i=cg(this._lContainer,t);return i&&null!=Wm(fD(this._lContainer),t)?new Rn(i):null}_adjustIndex(e,t=0){return e??this.length+t}};function uL(n){return n[8]}function fD(n){return n[8]||(n[8]=[])}function dL(n,e){let t;const i=e[n.index];if(il(i))t=i;else{let r;if(8&n.type)r=es(i);else{const s=e[11];r=s.createComment("");const c=Zr(n,e);tp(s,hg(s,c),r,function Cx(n,e){return n.nextSibling(e)}(s,c),!1)}e[n.index]=t=me(i,e,r,n),$e(e,t)}return new cL(t,n,e)}class mD{constructor(e){this.queryList=e,this.matches=null}clone(){return new mD(this.queryList)}setDirty(){this.queryList.setDirty()}}class gD{constructor(e=[]){this.queries=e}createEmbeddedView(e){const t=e.queries;if(null!==t){const i=null!==e.contentQueries?e.contentQueries[0]:t.length,r=[];for(let s=0;s<i;s++){const c=t.getByIndex(s);r.push(this.queries[c.indexInDeclarationView].clone())}return new gD(r)}return null}insertView(e){this.dirtyQueriesWithMatches(e)}detachView(e){this.dirtyQueriesWithMatches(e)}dirtyQueriesWithMatches(e){for(let t=0;t<this.queries.length;t++)null!==gL(e,t).matches&&this.queries[t].setDirty()}}class hL{constructor(e,t,i=null){this.predicate=e,this.flags=t,this.read=i}}class _D{constructor(e=[]){this.queries=e}elementStart(e,t){for(let i=0;i<this.queries.length;i++)this.queries[i].elementStart(e,t)}elementEnd(e){for(let t=0;t<this.queries.length;t++)this.queries[t].elementEnd(e)}embeddedTView(e){let t=null;for(let i=0;i<this.length;i++){const r=null!==t?t.length:0,s=this.getByIndex(i).embeddedTView(e,r);s&&(s.indexInDeclarationView=i,null!==t?t.push(s):t=[s])}return null!==t?new _D(t):null}template(e,t){for(let i=0;i<this.queries.length;i++)this.queries[i].template(e,t)}getByIndex(e){return this.queries[e]}get length(){return this.queries.length}track(e){this.queries.push(e)}}class yD{constructor(e,t=-1){this.metadata=e,this.matches=null,this.indexInDeclarationView=-1,this.crossesNgTemplate=!1,this._appliesToNextNode=!0,this._declarationNodeIndex=t}elementStart(e,t){this.isApplyingToNode(t)&&this.matchTNode(e,t)}elementEnd(e){this._declarationNodeIndex===e.index&&(this._appliesToNextNode=!1)}template(e,t){this.elementStart(e,t)}embeddedTView(e,t){return this.isApplyingToNode(e)?(this.crossesNgTemplate=!0,this.addMatch(-e.index,t),new yD(this.metadata)):null}isApplyingToNode(e){if(this._appliesToNextNode&&1!=(1&this.metadata.flags)){const t=this._declarationNodeIndex;let i=e.parent;for(;null!==i&&8&i.type&&i.index!==t;)i=i.parent;return t===(null!==i?i.index:-1)}return this._appliesToNextNode}matchTNode(e,t){const i=this.metadata.predicate;if(Array.isArray(i))for(let r=0;r<i.length;r++){const s=i[r];this.matchTNodeWithReadOption(e,t,j6(t,s)),this.matchTNodeWithReadOption(e,t,Hs(t,e,s,!1,!1))}else i===ld?4&t.type&&this.matchTNodeWithReadOption(e,t,-1):this.matchTNodeWithReadOption(e,t,Hs(t,e,i,!1,!1))}matchTNodeWithReadOption(e,t,i){if(null!==i){const r=this.metadata.read;if(null!==r)if(r===wr||r===ql||r===ld&&4&t.type)this.addMatch(t.index,-2);else{const s=Hs(t,e,r,!1,!1);null!==s&&this.addMatch(t.index,s)}else this.addMatch(t.index,i)}}addMatch(e,t){null===this.matches?this.matches=[e,t]:this.matches.push(e,t)}}function j6(n,e){const t=n.localNames;if(null!==t)for(let i=0;i<t.length;i+=2)if(t[i]===e)return t[i+1];return null}function W6(n,e,t,i){return-1===t?function $6(n,e){return 11&n.type?Ef(n,e):4&n.type?AM(n,e):null}(e,n):-2===t?function q6(n,e,t){return t===wr?Ef(e,n):t===ld?AM(e,n):t===ql?dL(e,n):void 0}(n,e,i):Yo(n,n[1],t,e)}function pL(n,e,t,i){const r=e[19].queries[i];if(null===r.matches){const s=n.data,c=t.matches,d=[];for(let m=0;m<c.length;m+=2){const y=c[m];d.push(y<0?null:W6(e,s[y],c[m+1],t.metadata.read))}r.matches=d}return r.matches}function vD(n,e,t,i){const r=n.queries.getByIndex(t),s=r.matches;if(null!==s){const c=pL(n,e,r,t);for(let d=0;d<s.length;d+=2){const m=s[d];if(m>0)i.push(c[d/2]);else{const y=s[d+1],w=e[-m];for(let S=10;S<w.length;S++){const T=w[S];T[17]===T[3]&&vD(T[1],T,y,i)}if(null!==w[9]){const S=w[9];for(let T=0;T<S.length;T++){const I=S[T];vD(I[1],I,y,i)}}}}}return i}function Gi(n){const e=Rt(),t=ai(),i=Ld();Od(i+1);const r=gL(t,i);if(n.dirty&&function G_(n){return 4==(4&n[2])}(e)===(2==(2&r.metadata.flags))){if(null===r.matches)n.reset([]);else{const s=r.crossesNgTemplate?vD(t,e,i,[]):pL(t,e,r,i);n.reset(s,gT),n.notifyOnChanges()}return!0}return!1}function Uo(n,e,t){const i=ai();i.firstCreatePass&&(mL(i,new hL(n,e,t),-1),2==(2&e)&&(i.staticViewQueries=!0)),fL(i,Rt(),e)}function Js(n,e,t,i){const r=ai();if(r.firstCreatePass){const s=Is();mL(r,new hL(e,t,i),s.index),function X6(n,e){const t=n.contentQueries||(n.contentQueries=[]);e!==(t.length?t[t.length-1]:-1)&&t.push(n.queries.length-1,e)}(r,n),2==(2&t)&&(r.staticContentQueries=!0)}fL(r,Rt(),t)}function ji(){return function Z6(n,e){return n[19].queries[e].queryList}(Rt(),Ld())}function fL(n,e,t){const i=new iv(4==(4&t));jf(n,e,i,i.destroy),null===e[19]&&(e[19]=new gD),e[19].queries.push(new mD(i))}function mL(n,e,t){null===n.queries&&(n.queries=new _D),n.queries.track(new yD(e,t))}function gL(n,e){return n.queries.getByIndex(e)}function _L(n,e){return AM(n,e)}function PM(...n){}const RM=new Vt("Application Initializer");let kM=(()=>{class n{constructor(t){this.appInits=t,this.resolve=PM,this.reject=PM,this.initialized=!1,this.done=!1,this.donePromise=new Promise((i,r)=>{this.resolve=i,this.reject=r})}runInitializers(){if(this.initialized)return;const t=[],i=()=>{this.done=!0,this.resolve()};if(this.appInits)for(let r=0;r<this.appInits.length;r++){const s=this.appInits[r]();if(cb(s))t.push(s);else if(QT(s)){const c=new Promise((d,m)=>{s.subscribe({complete:d,error:m})});t.push(c)}}Promise.all(t).then(()=>{i()}).catch(r=>{this.reject(r)}),0===t.length&&i(),this.initialized=!0}}return n.\u0275fac=function(t){return new(t||n)(Xe(RM,8))},n.\u0275prov=Yt({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();const vb=new Vt("AppId",{providedIn:"root",factory:function FL(){return`${CD()}${CD()}${CD()}`}});function CD(){return String.fromCharCode(97+Math.floor(25*Math.random()))}const NL=new Vt("Platform Initializer"),LM=new Vt("Platform ID",{providedIn:"platform",factory:()=>"unknown"}),BL=new Vt("appBootstrapListener"),ru=new Vt("AnimationModuleType");let mG=(()=>{class n{log(t){console.log(t)}warn(t){console.warn(t)}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=Yt({token:n,factory:n.\u0275fac,providedIn:"platform"}),n})();const Jd=new Vt("LocaleId",{providedIn:"root",factory:()=>xr(Jd,Hn.Optional|Hn.SkipSelf)||function gG(){return typeof $localize<"u"&&$localize.locale||nv}()});class yG{constructor(e,t){this.ngModuleFactory=e,this.componentFactories=t}}let SD=(()=>{class n{compileModuleSync(t){return new lD(t)}compileModuleAsync(t){return Promise.resolve(this.compileModuleSync(t))}compileModuleAndAllComponentsSync(t){const i=this.compileModuleSync(t),s=ja(Xo(t).declarations).reduce((c,d)=>{const m=yr(d);return m&&c.push(new ni(m)),c},[]);return new yG(i,s)}compileModuleAndAllComponentsAsync(t){return Promise.resolve(this.compileModuleAndAllComponentsSync(t))}clearCache(){}clearCacheFor(t){}getModuleId(t){}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=Yt({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();const bG=(()=>Promise.resolve(0))();function ED(n){typeof Zone>"u"?bG.then(()=>{n&&n.apply(null,null)}):Zone.current.scheduleMicroTask("scheduleMicrotask",n)}class nr{constructor({enableLongStackTrace:e=!1,shouldCoalesceEventChangeDetection:t=!1,shouldCoalesceRunChangeDetection:i=!1}){if(this.hasPendingMacrotasks=!1,this.hasPendingMicrotasks=!1,this.isStable=!0,this.onUnstable=new Dn(!1),this.onMicrotaskEmpty=new Dn(!1),this.onStable=new Dn(!1),this.onError=new Dn(!1),typeof Zone>"u")throw new bt(908,!1);Zone.assertZonePatched();const r=this;if(r._nesting=0,r._outer=r._inner=Zone.current,Zone.AsyncStackTaggingZoneSpec){const s=Zone.AsyncStackTaggingZoneSpec;r._inner=r._inner.fork(new s("Angular"))}Zone.TaskTrackingZoneSpec&&(r._inner=r._inner.fork(new Zone.TaskTrackingZoneSpec)),e&&Zone.longStackTraceZoneSpec&&(r._inner=r._inner.fork(Zone.longStackTraceZoneSpec)),r.shouldCoalesceEventChangeDetection=!i&&t,r.shouldCoalesceRunChangeDetection=i,r.lastRequestAnimationFrameId=-1,r.nativeRequestAnimationFrame=function wG(){let n=cr.requestAnimationFrame,e=cr.cancelAnimationFrame;if(typeof Zone<"u"&&n&&e){const t=n[Zone.__symbol__("OriginalDelegate")];t&&(n=t);const i=e[Zone.__symbol__("OriginalDelegate")];i&&(e=i)}return{nativeRequestAnimationFrame:n,nativeCancelAnimationFrame:e}}().nativeRequestAnimationFrame,function SG(n){const e=()=>{!function CG(n){n.isCheckStableRunning||-1!==n.lastRequestAnimationFrameId||(n.lastRequestAnimationFrameId=n.nativeRequestAnimationFrame.call(cr,()=>{n.fakeTopEventTask||(n.fakeTopEventTask=Zone.root.scheduleEventTask("fakeTopEventTask",()=>{n.lastRequestAnimationFrameId=-1,DD(n),n.isCheckStableRunning=!0,TD(n),n.isCheckStableRunning=!1},void 0,()=>{},()=>{})),n.fakeTopEventTask.invoke()}),DD(n))}(n)};n._inner=n._inner.fork({name:"angular",properties:{isAngularZone:!0},onInvokeTask:(t,i,r,s,c,d)=>{try{return UL(n),t.invokeTask(r,s,c,d)}finally{(n.shouldCoalesceEventChangeDetection&&"eventTask"===s.type||n.shouldCoalesceRunChangeDetection)&&e(),HL(n)}},onInvoke:(t,i,r,s,c,d,m)=>{try{return UL(n),t.invoke(r,s,c,d,m)}finally{n.shouldCoalesceRunChangeDetection&&e(),HL(n)}},onHasTask:(t,i,r,s)=>{t.hasTask(r,s),i===r&&("microTask"==s.change?(n._hasPendingMicrotasks=s.microTask,DD(n),TD(n)):"macroTask"==s.change&&(n.hasPendingMacrotasks=s.macroTask))},onHandleError:(t,i,r,s)=>(t.handleError(r,s),n.runOutsideAngular(()=>n.onError.emit(s)),!1)})}(r)}static isInAngularZone(){return typeof Zone<"u"&&!0===Zone.current.get("isAngularZone")}static assertInAngularZone(){if(!nr.isInAngularZone())throw new bt(909,!1)}static assertNotInAngularZone(){if(nr.isInAngularZone())throw new bt(909,!1)}run(e,t,i){return this._inner.run(e,t,i)}runTask(e,t,i,r){const s=this._inner,c=s.scheduleEventTask("NgZoneEvent: "+r,e,MG,PM,PM);try{return s.runTask(c,t,i)}finally{s.cancelTask(c)}}runGuarded(e,t,i){return this._inner.runGuarded(e,t,i)}runOutsideAngular(e){return this._outer.run(e)}}const MG={};function TD(n){if(0==n._nesting&&!n.hasPendingMicrotasks&&!n.isStable)try{n._nesting++,n.onMicrotaskEmpty.emit(null)}finally{if(n._nesting--,!n.hasPendingMicrotasks)try{n.runOutsideAngular(()=>n.onStable.emit(null))}finally{n.isStable=!0}}}function DD(n){n.hasPendingMicrotasks=!!(n._hasPendingMicrotasks||(n.shouldCoalesceEventChangeDetection||n.shouldCoalesceRunChangeDetection)&&-1!==n.lastRequestAnimationFrameId)}function UL(n){n._nesting++,n.isStable&&(n.isStable=!1,n.onUnstable.emit(null))}function HL(n){n._nesting--,TD(n)}class EG{constructor(){this.hasPendingMicrotasks=!1,this.hasPendingMacrotasks=!1,this.isStable=!0,this.onUnstable=new Dn,this.onMicrotaskEmpty=new Dn,this.onStable=new Dn,this.onError=new Dn}run(e,t,i){return e.apply(t,i)}runGuarded(e,t,i){return e.apply(t,i)}runOutsideAngular(e){return e()}runTask(e,t,i,r){return e.apply(t,i)}}const GL=new Vt(""),OM=new Vt("");let PD,AD=(()=>{class n{constructor(t,i,r){this._ngZone=t,this.registry=i,this._pendingCount=0,this._isZoneStable=!0,this._didWork=!1,this._callbacks=[],this.taskTrackingZone=null,PD||(function TG(n){PD=n}(r),r.addToWindow(i)),this._watchAngularEvents(),t.run(()=>{this.taskTrackingZone=typeof Zone>"u"?null:Zone.current.get("TaskTrackingZone")})}_watchAngularEvents(){this._ngZone.onUnstable.subscribe({next:()=>{this._didWork=!0,this._isZoneStable=!1}}),this._ngZone.runOutsideAngular(()=>{this._ngZone.onStable.subscribe({next:()=>{nr.assertNotInAngularZone(),ED(()=>{this._isZoneStable=!0,this._runCallbacksIfReady()})}})})}increasePendingRequestCount(){return this._pendingCount+=1,this._didWork=!0,this._pendingCount}decreasePendingRequestCount(){if(this._pendingCount-=1,this._pendingCount<0)throw new Error("pending async requests below zero");return this._runCallbacksIfReady(),this._pendingCount}isStable(){return this._isZoneStable&&0===this._pendingCount&&!this._ngZone.hasPendingMacrotasks}_runCallbacksIfReady(){if(this.isStable())ED(()=>{for(;0!==this._callbacks.length;){let t=this._callbacks.pop();clearTimeout(t.timeoutId),t.doneCb(this._didWork)}this._didWork=!1});else{let t=this.getPendingTasks();this._callbacks=this._callbacks.filter(i=>!i.updateCb||!i.updateCb(t)||(clearTimeout(i.timeoutId),!1)),this._didWork=!0}}getPendingTasks(){return this.taskTrackingZone?this.taskTrackingZone.macroTasks.map(t=>({source:t.source,creationLocation:t.creationLocation,data:t.data})):[]}addCallback(t,i,r){let s=-1;i&&i>0&&(s=setTimeout(()=>{this._callbacks=this._callbacks.filter(c=>c.timeoutId!==s),t(this._didWork,this.getPendingTasks())},i)),this._callbacks.push({doneCb:t,timeoutId:s,updateCb:r})}whenStable(t,i,r){if(r&&!this.taskTrackingZone)throw new Error('Task tracking zone is required when passing an update callback to whenStable(). Is "zone.js/plugins/task-tracking" loaded?');this.addCallback(t,i,r),this._runCallbacksIfReady()}getPendingRequestCount(){return this._pendingCount}registerApplication(t){this.registry.registerApplication(t,this)}unregisterApplication(t){this.registry.unregisterApplication(t)}findProviders(t,i,r){return[]}}return n.\u0275fac=function(t){return new(t||n)(Xe(nr),Xe(ID),Xe(OM))},n.\u0275prov=Yt({token:n,factory:n.\u0275fac}),n})(),ID=(()=>{class n{constructor(){this._applications=new Map}registerApplication(t,i){this._applications.set(t,i)}unregisterApplication(t){this._applications.delete(t)}unregisterAllApplications(){this._applications.clear()}getTestability(t){return this._applications.get(t)||null}getAllTestabilities(){return Array.from(this._applications.values())}getAllRootElements(){return Array.from(this._applications.keys())}findTestabilityInTree(t,i=!0){return PD?.findTestabilityInTree(this,t,i)??null}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=Yt({token:n,factory:n.\u0275fac,providedIn:"platform"}),n})(),Xf=null;const jL=new Vt("AllowMultipleToken"),RD=new Vt("PlatformDestroyListeners");class $L{constructor(e,t){this.name=e,this.token=t}}function qL(n,e,t=[]){const i=`Platform: ${e}`,r=new Vt(i);return(s=[])=>{let c=kD();if(!c||c.injector.get(jL,!1)){const d=[...t,...s,{provide:r,useValue:!0}];n?n(d):function IG(n){if(Xf&&!Xf.get(jL,!1))throw new bt(400,!1);Xf=n;const e=n.get(XL);(function WL(n){const e=n.get(NL,null);e&&e.forEach(t=>t())})(n)}(function ZL(n=[],e){return Yr.create({name:e,providers:[{provide:tg,useValue:"platform"},{provide:RD,useValue:new Set([()=>Xf=null])},...n]})}(d,i))}return function RG(n){const e=kD();if(!e)throw new bt(401,!1);return e}()}}function kD(){return Xf?.get(XL)??null}let XL=(()=>{class n{constructor(t){this._injector=t,this._modules=[],this._destroyListeners=[],this._destroyed=!1}bootstrapModuleFactory(t,i){const r=function KL(n,e){let t;return t="noop"===n?new EG:("zone.js"===n?void 0:n)||new nr(e),t}(i?.ngZone,function YL(n){return{enableLongStackTrace:!1,shouldCoalesceEventChangeDetection:!(!n||!n.ngZoneEventCoalescing)||!1,shouldCoalesceRunChangeDetection:!(!n||!n.ngZoneRunCoalescing)||!1}}(i)),s=[{provide:nr,useValue:r}];return r.run(()=>{const c=Yr.create({providers:s,parent:this.injector,name:t.moduleType.name}),d=t.create(c),m=d.injector.get(Ku,null);if(!m)throw new bt(402,!1);return r.runOutsideAngular(()=>{const y=r.onError.subscribe({next:w=>{m.handleError(w)}});d.onDestroy(()=>{FM(this._modules,d),y.unsubscribe()})}),function QL(n,e,t){try{const i=t();return cb(i)?i.catch(r=>{throw e.runOutsideAngular(()=>n.handleError(r)),r}):i}catch(i){throw e.runOutsideAngular(()=>n.handleError(i)),i}}(m,r,()=>{const y=d.injector.get(kM);return y.runInitializers(),y.donePromise.then(()=>(function Ck(n){lr(n,"Expected localeId to be defined"),"string"==typeof n&&(Mk=n.toLowerCase().replace(/_/g,"-"))}(d.injector.get(Jd,nv)||nv),this._moduleDoBootstrap(d),d))})})}bootstrapModule(t,i=[]){const r=JL({},i);return function DG(n,e,t){const i=new lD(t);return Promise.resolve(i)}(0,0,t).then(s=>this.bootstrapModuleFactory(s,r))}_moduleDoBootstrap(t){const i=t.injector.get(ov);if(t._bootstrapComponents.length>0)t._bootstrapComponents.forEach(r=>i.bootstrap(r));else{if(!t.instance.ngDoBootstrap)throw new bt(403,!1);t.instance.ngDoBootstrap(i)}this._modules.push(t)}onDestroy(t){this._destroyListeners.push(t)}get injector(){return this._injector}destroy(){if(this._destroyed)throw new bt(404,!1);this._modules.slice().forEach(i=>i.destroy()),this._destroyListeners.forEach(i=>i());const t=this._injector.get(RD,null);t&&(t.forEach(i=>i()),t.clear()),this._destroyed=!0}get destroyed(){return this._destroyed}}return n.\u0275fac=function(t){return new(t||n)(Xe(Yr))},n.\u0275prov=Yt({token:n,factory:n.\u0275fac,providedIn:"platform"}),n})();function JL(n,e){return Array.isArray(e)?e.reduce(JL,n):{...n,...e}}let ov=(()=>{class n{constructor(t,i,r){this._zone=t,this._injector=i,this._exceptionHandler=r,this._bootstrapListeners=[],this._views=[],this._runningTick=!1,this._stable=!0,this._destroyed=!1,this._destroyListeners=[],this.componentTypes=[],this.components=[],this._onMicrotaskEmptySubscription=this._zone.onMicrotaskEmpty.subscribe({next:()=>{this._zone.run(()=>{this.tick()})}});const s=new ci(d=>{this._stable=this._zone.isStable&&!this._zone.hasPendingMacrotasks&&!this._zone.hasPendingMicrotasks,this._zone.runOutsideAngular(()=>{d.next(this._stable),d.complete()})}),c=new ci(d=>{let m;this._zone.runOutsideAngular(()=>{m=this._zone.onStable.subscribe(()=>{nr.assertNotInAngularZone(),ED(()=>{!this._stable&&!this._zone.hasPendingMacrotasks&&!this._zone.hasPendingMicrotasks&&(this._stable=!0,d.next(!0))})})});const y=this._zone.onUnstable.subscribe(()=>{nr.assertInAngularZone(),this._stable&&(this._stable=!1,this._zone.runOutsideAngular(()=>{d.next(!1)}))});return()=>{m.unsubscribe(),y.unsubscribe()}});this.isStable=so(s,c.pipe(function Ru(n={}){const{connector:e=(()=>new si),resetOnError:t=!0,resetOnComplete:i=!0,resetOnRefCountZero:r=!0}=n;return s=>{let c,d,m,y=0,w=!1,S=!1;const T=()=>{d?.unsubscribe(),d=void 0},I=()=>{T(),c=m=void 0,w=S=!1},R=()=>{const k=c;I(),k?.unsubscribe()};return Dr((k,F)=>{y++,!S&&!w&&T();const G=m=m??e();F.add(()=>{y--,0===y&&!S&&!w&&(d=Vp(R,r))}),G.subscribe(F),!c&&y>0&&(c=new xu({next:W=>G.next(W),error:W=>{S=!0,T(),d=Vp(I,t,W),G.error(W)},complete:()=>{w=!0,T(),d=Vp(I,i),G.complete()}}),ws(k).subscribe(c))})(s)}}()))}get destroyed(){return this._destroyed}get injector(){return this._injector}bootstrap(t,i){const r=t instanceof v1;if(!this._injector.get(kM).done)throw!r&&function Ou(n){const e=yr(n)||uo(n)||Bs(n);return null!==e&&e.standalone}(t),new bt(405,false);let c;c=r?t:this._injector.get(Kc).resolveComponentFactory(t),this.componentTypes.push(c.componentType);const d=function AG(n){return n.isBoundToModule}(c)?void 0:this._injector.get(Dg),y=c.create(Yr.NULL,[],i||c.selector,d),w=y.location.nativeElement,S=y.injector.get(GL,null);return S?.registerApplication(w),y.onDestroy(()=>{this.detachView(y.hostView),FM(this.components,y),S?.unregisterApplication(w)}),this._loadComponent(y),y}tick(){if(this._runningTick)throw new bt(101,!1);try{this._runningTick=!0;for(let t of this._views)t.detectChanges()}catch(t){this._zone.runOutsideAngular(()=>this._exceptionHandler.handleError(t))}finally{this._runningTick=!1}}attachView(t){const i=t;this._views.push(i),i.attachToAppRef(this)}detachView(t){const i=t;FM(this._views,i),i.detachFromAppRef()}_loadComponent(t){this.attachView(t.hostView),this.tick(),this.components.push(t),this._injector.get(BL,[]).concat(this._bootstrapListeners).forEach(r=>r(t))}ngOnDestroy(){if(!this._destroyed)try{this._destroyListeners.forEach(t=>t()),this._views.slice().forEach(t=>t.destroy()),this._onMicrotaskEmptySubscription.unsubscribe()}finally{this._destroyed=!0,this._views=[],this._bootstrapListeners=[],this._destroyListeners=[]}}onDestroy(t){return this._destroyListeners.push(t),()=>FM(this._destroyListeners,t)}destroy(){if(this._destroyed)throw new bt(406,!1);const t=this._injector;t.destroy&&!t.destroyed&&t.destroy()}get viewCount(){return this._views.length}warnIfDestroyed(){}}return n.\u0275fac=function(t){return new(t||n)(Xe(nr),Xe(fc),Xe(Ku))},n.\u0275prov=Yt({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();function FM(n,e){const t=n.indexOf(e);t>-1&&n.splice(t,1)}let tO=!0,Ho=(()=>{class n{}return n.__NG_ELEMENT_ID__=OG,n})();function OG(n){return function FG(n,e,t){if(kh(n)&&!t){const i=Fo(n.index,e);return new Rn(i,i)}return 47&n.type?new Rn(e[16],e):null}(Is(),Rt(),16==(16&n))}class oO{constructor(){}supports(e){return ys(e)}create(e){return new HG(e)}}const UG=(n,e)=>e;class HG{constructor(e){this.length=0,this._linkedRecords=null,this._unlinkedRecords=null,this._previousItHead=null,this._itHead=null,this._itTail=null,this._additionsHead=null,this._additionsTail=null,this._movesHead=null,this._movesTail=null,this._removalsHead=null,this._removalsTail=null,this._identityChangesHead=null,this._identityChangesTail=null,this._trackByFn=e||UG}forEachItem(e){let t;for(t=this._itHead;null!==t;t=t._next)e(t)}forEachOperation(e){let t=this._itHead,i=this._removalsHead,r=0,s=null;for(;t||i;){const c=!i||t&&t.currentIndex<lO(i,r,s)?t:i,d=lO(c,r,s),m=c.currentIndex;if(c===i)r--,i=i._nextRemoved;else if(t=t._next,null==c.previousIndex)r++;else{s||(s=[]);const y=d-r,w=m-r;if(y!=w){for(let T=0;T<y;T++){const I=T<s.length?s[T]:s[T]=0,R=I+T;w<=R&&R<y&&(s[T]=I+1)}s[c.previousIndex]=w-y}}d!==m&&e(c,d,m)}}forEachPreviousItem(e){let t;for(t=this._previousItHead;null!==t;t=t._nextPrevious)e(t)}forEachAddedItem(e){let t;for(t=this._additionsHead;null!==t;t=t._nextAdded)e(t)}forEachMovedItem(e){let t;for(t=this._movesHead;null!==t;t=t._nextMoved)e(t)}forEachRemovedItem(e){let t;for(t=this._removalsHead;null!==t;t=t._nextRemoved)e(t)}forEachIdentityChange(e){let t;for(t=this._identityChangesHead;null!==t;t=t._nextIdentityChange)e(t)}diff(e){if(null==e&&(e=[]),!ys(e))throw new bt(900,!1);return this.check(e)?this:null}onDestroy(){}check(e){this._reset();let r,s,c,t=this._itHead,i=!1;if(Array.isArray(e)){this.length=e.length;for(let d=0;d<this.length;d++)s=e[d],c=this._trackByFn(d,s),null!==t&&Object.is(t.trackById,c)?(i&&(t=this._verifyReinsertion(t,s,c,d)),Object.is(t.item,s)||this._addIdentityChange(t,s)):(t=this._mismatch(t,s,c,d),i=!0),t=t._next}else r=0,function $f(n,e){if(Array.isArray(n))for(let t=0;t<n.length;t++)e(n[t]);else{const t=n[ss()]();let i;for(;!(i=t.next()).done;)e(i.value)}}(e,d=>{c=this._trackByFn(r,d),null!==t&&Object.is(t.trackById,c)?(i&&(t=this._verifyReinsertion(t,d,c,r)),Object.is(t.item,d)||this._addIdentityChange(t,d)):(t=this._mismatch(t,d,c,r),i=!0),t=t._next,r++}),this.length=r;return this._truncate(t),this.collection=e,this.isDirty}get isDirty(){return null!==this._additionsHead||null!==this._movesHead||null!==this._removalsHead||null!==this._identityChangesHead}_reset(){if(this.isDirty){let e;for(e=this._previousItHead=this._itHead;null!==e;e=e._next)e._nextPrevious=e._next;for(e=this._additionsHead;null!==e;e=e._nextAdded)e.previousIndex=e.currentIndex;for(this._additionsHead=this._additionsTail=null,e=this._movesHead;null!==e;e=e._nextMoved)e.previousIndex=e.currentIndex;this._movesHead=this._movesTail=null,this._removalsHead=this._removalsTail=null,this._identityChangesHead=this._identityChangesTail=null}}_mismatch(e,t,i,r){let s;return null===e?s=this._itTail:(s=e._prev,this._remove(e)),null!==(e=null===this._unlinkedRecords?null:this._unlinkedRecords.get(i,null))?(Object.is(e.item,t)||this._addIdentityChange(e,t),this._reinsertAfter(e,s,r)):null!==(e=null===this._linkedRecords?null:this._linkedRecords.get(i,r))?(Object.is(e.item,t)||this._addIdentityChange(e,t),this._moveAfter(e,s,r)):e=this._addAfter(new GG(t,i),s,r),e}_verifyReinsertion(e,t,i,r){let s=null===this._unlinkedRecords?null:this._unlinkedRecords.get(i,null);return null!==s?e=this._reinsertAfter(s,e._prev,r):e.currentIndex!=r&&(e.currentIndex=r,this._addToMoves(e,r)),e}_truncate(e){for(;null!==e;){const t=e._next;this._addToRemovals(this._unlink(e)),e=t}null!==this._unlinkedRecords&&this._unlinkedRecords.clear(),null!==this._additionsTail&&(this._additionsTail._nextAdded=null),null!==this._movesTail&&(this._movesTail._nextMoved=null),null!==this._itTail&&(this._itTail._next=null),null!==this._removalsTail&&(this._removalsTail._nextRemoved=null),null!==this._identityChangesTail&&(this._identityChangesTail._nextIdentityChange=null)}_reinsertAfter(e,t,i){null!==this._unlinkedRecords&&this._unlinkedRecords.remove(e);const r=e._prevRemoved,s=e._nextRemoved;return null===r?this._removalsHead=s:r._nextRemoved=s,null===s?this._removalsTail=r:s._prevRemoved=r,this._insertAfter(e,t,i),this._addToMoves(e,i),e}_moveAfter(e,t,i){return this._unlink(e),this._insertAfter(e,t,i),this._addToMoves(e,i),e}_addAfter(e,t,i){return this._insertAfter(e,t,i),this._additionsTail=null===this._additionsTail?this._additionsHead=e:this._additionsTail._nextAdded=e,e}_insertAfter(e,t,i){const r=null===t?this._itHead:t._next;return e._next=r,e._prev=t,null===r?this._itTail=e:r._prev=e,null===t?this._itHead=e:t._next=e,null===this._linkedRecords&&(this._linkedRecords=new aO),this._linkedRecords.put(e),e.currentIndex=i,e}_remove(e){return this._addToRemovals(this._unlink(e))}_unlink(e){null!==this._linkedRecords&&this._linkedRecords.remove(e);const t=e._prev,i=e._next;return null===t?this._itHead=i:t._next=i,null===i?this._itTail=t:i._prev=t,e}_addToMoves(e,t){return e.previousIndex===t||(this._movesTail=null===this._movesTail?this._movesHead=e:this._movesTail._nextMoved=e),e}_addToRemovals(e){return null===this._unlinkedRecords&&(this._unlinkedRecords=new aO),this._unlinkedRecords.put(e),e.currentIndex=null,e._nextRemoved=null,null===this._removalsTail?(this._removalsTail=this._removalsHead=e,e._prevRemoved=null):(e._prevRemoved=this._removalsTail,this._removalsTail=this._removalsTail._nextRemoved=e),e}_addIdentityChange(e,t){return e.item=t,this._identityChangesTail=null===this._identityChangesTail?this._identityChangesHead=e:this._identityChangesTail._nextIdentityChange=e,e}}class GG{constructor(e,t){this.item=e,this.trackById=t,this.currentIndex=null,this.previousIndex=null,this._nextPrevious=null,this._prev=null,this._next=null,this._prevDup=null,this._nextDup=null,this._prevRemoved=null,this._nextRemoved=null,this._nextAdded=null,this._nextMoved=null,this._nextIdentityChange=null}}class jG{constructor(){this._head=null,this._tail=null}add(e){null===this._head?(this._head=this._tail=e,e._nextDup=null,e._prevDup=null):(this._tail._nextDup=e,e._prevDup=this._tail,e._nextDup=null,this._tail=e)}get(e,t){let i;for(i=this._head;null!==i;i=i._nextDup)if((null===t||t<=i.currentIndex)&&Object.is(i.trackById,e))return i;return null}remove(e){const t=e._prevDup,i=e._nextDup;return null===t?this._head=i:t._nextDup=i,null===i?this._tail=t:i._prevDup=t,null===this._head}}class aO{constructor(){this.map=new Map}put(e){const t=e.trackById;let i=this.map.get(t);i||(i=new jG,this.map.set(t,i)),i.add(e)}get(e,t){const r=this.map.get(e);return r?r.get(e,t):null}remove(e){const t=e.trackById;return this.map.get(t).remove(e)&&this.map.delete(t),e}get isEmpty(){return 0===this.map.size}clear(){this.map.clear()}}function lO(n,e,t){const i=n.previousIndex;if(null===i)return i;let r=0;return t&&i<t.length&&(r=t[i]),i+e+r}class cO{constructor(){}supports(e){return e instanceof Map||ap(e)}create(){return new $G}}class $G{constructor(){this._records=new Map,this._mapHead=null,this._appendAfter=null,this._previousMapHead=null,this._changesHead=null,this._changesTail=null,this._additionsHead=null,this._additionsTail=null,this._removalsHead=null,this._removalsTail=null}get isDirty(){return null!==this._additionsHead||null!==this._changesHead||null!==this._removalsHead}forEachItem(e){let t;for(t=this._mapHead;null!==t;t=t._next)e(t)}forEachPreviousItem(e){let t;for(t=this._previousMapHead;null!==t;t=t._nextPrevious)e(t)}forEachChangedItem(e){let t;for(t=this._changesHead;null!==t;t=t._nextChanged)e(t)}forEachAddedItem(e){let t;for(t=this._additionsHead;null!==t;t=t._nextAdded)e(t)}forEachRemovedItem(e){let t;for(t=this._removalsHead;null!==t;t=t._nextRemoved)e(t)}diff(e){if(e){if(!(e instanceof Map||ap(e)))throw new bt(900,!1)}else e=new Map;return this.check(e)?this:null}onDestroy(){}check(e){this._reset();let t=this._mapHead;if(this._appendAfter=null,this._forEach(e,(i,r)=>{if(t&&t.key===r)this._maybeAddToChanges(t,i),this._appendAfter=t,t=t._next;else{const s=this._getOrCreateRecordForKey(r,i);t=this._insertBeforeOrAppend(t,s)}}),t){t._prev&&(t._prev._next=null),this._removalsHead=t;for(let i=t;null!==i;i=i._nextRemoved)i===this._mapHead&&(this._mapHead=null),this._records.delete(i.key),i._nextRemoved=i._next,i.previousValue=i.currentValue,i.currentValue=null,i._prev=null,i._next=null}return this._changesTail&&(this._changesTail._nextChanged=null),this._additionsTail&&(this._additionsTail._nextAdded=null),this.isDirty}_insertBeforeOrAppend(e,t){if(e){const i=e._prev;return t._next=e,t._prev=i,e._prev=t,i&&(i._next=t),e===this._mapHead&&(this._mapHead=t),this._appendAfter=e,e}return this._appendAfter?(this._appendAfter._next=t,t._prev=this._appendAfter):this._mapHead=t,this._appendAfter=t,null}_getOrCreateRecordForKey(e,t){if(this._records.has(e)){const r=this._records.get(e);this._maybeAddToChanges(r,t);const s=r._prev,c=r._next;return s&&(s._next=c),c&&(c._prev=s),r._next=null,r._prev=null,r}const i=new WG(e);return this._records.set(e,i),i.currentValue=t,this._addToAdditions(i),i}_reset(){if(this.isDirty){let e;for(this._previousMapHead=this._mapHead,e=this._previousMapHead;null!==e;e=e._next)e._nextPrevious=e._next;for(e=this._changesHead;null!==e;e=e._nextChanged)e.previousValue=e.currentValue;for(e=this._additionsHead;null!=e;e=e._nextAdded)e.previousValue=e.currentValue;this._changesHead=this._changesTail=null,this._additionsHead=this._additionsTail=null,this._removalsHead=null}}_maybeAddToChanges(e,t){Object.is(t,e.currentValue)||(e.previousValue=e.currentValue,e.currentValue=t,this._addToChanges(e))}_addToAdditions(e){null===this._additionsHead?this._additionsHead=this._additionsTail=e:(this._additionsTail._nextAdded=e,this._additionsTail=e)}_addToChanges(e){null===this._changesHead?this._changesHead=this._changesTail=e:(this._changesTail._nextChanged=e,this._changesTail=e)}_forEach(e,t){e instanceof Map?e.forEach(t):Object.keys(e).forEach(i=>t(e[i],i))}}class WG{constructor(e){this.key=e,this.previousValue=null,this.currentValue=null,this._nextPrevious=null,this._next=null,this._prev=null,this._nextAdded=null,this._nextRemoved=null,this._nextChanged=null}}function uO(){return new zM([new oO])}let zM=(()=>{class n{constructor(t){this.factories=t}static create(t,i){if(null!=i){const r=i.factories.slice();t=t.concat(r)}return new n(t)}static extend(t){return{provide:n,useFactory:i=>n.create(t,i||uO()),deps:[[n,new $r,new ls]]}}find(t){const i=this.factories.find(r=>r.supports(t));if(null!=i)return i;throw new bt(901,!1)}}return n.\u0275prov=Yt({token:n,providedIn:"root",factory:uO}),n})();function dO(){return new xb([new cO])}let xb=(()=>{class n{constructor(t){this.factories=t}static create(t,i){if(i){const r=i.factories.slice();t=t.concat(r)}return new n(t)}static extend(t){return{provide:n,useFactory:i=>n.create(t,i||dO()),deps:[[n,new $r,new ls]]}}find(t){const i=this.factories.find(r=>r.supports(t));if(i)return i;throw new bt(901,!1)}}return n.\u0275prov=Yt({token:n,providedIn:"root",factory:dO}),n})();const XG=qL(null,"core",[]);let YG=(()=>{class n{constructor(t){}}return n.\u0275fac=function(t){return new(t||n)(Xe(ov))},n.\u0275mod=Gn({type:n}),n.\u0275inj=Bn({}),n})();function cp(n){return"boolean"==typeof n?n:null!=n&&"false"!==n}let VM=null;function eh(){return VM}const Vi=new Vt("DocumentToken");let BD=(()=>{class n{historyGo(t){throw new Error("Not implemented")}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=Yt({token:n,factory:function(){return function ej(){return Xe(hO)}()},providedIn:"platform"}),n})();const tj=new Vt("Location Initialized");let hO=(()=>{class n extends BD{constructor(t){super(),this._doc=t,this._init()}_init(){this.location=window.location,this._history=window.history}getBaseHrefFromDOM(){return eh().getBaseHref(this._doc)}onPopState(t){const i=eh().getGlobalEventTarget(this._doc,"window");return i.addEventListener("popstate",t,!1),()=>i.removeEventListener("popstate",t)}onHashChange(t){const i=eh().getGlobalEventTarget(this._doc,"window");return i.addEventListener("hashchange",t,!1),()=>i.removeEventListener("hashchange",t)}get href(){return this.location.href}get protocol(){return this.location.protocol}get hostname(){return this.location.hostname}get port(){return this.location.port}get pathname(){return this.location.pathname}get search(){return this.location.search}get hash(){return this.location.hash}set pathname(t){this.location.pathname=t}pushState(t,i,r){pO()?this._history.pushState(t,i,r):this.location.hash=r}replaceState(t,i,r){pO()?this._history.replaceState(t,i,r):this.location.hash=r}forward(){this._history.forward()}back(){this._history.back()}historyGo(t=0){this._history.go(t)}getState(){return this._history.state}}return n.\u0275fac=function(t){return new(t||n)(Xe(Vi))},n.\u0275prov=Yt({token:n,factory:function(){return function nj(){return new hO(Xe(Vi))}()},providedIn:"platform"}),n})();function pO(){return!!window.history.pushState}function zD(n,e){if(0==n.length)return e;if(0==e.length)return n;let t=0;return n.endsWith("/")&&t++,e.startsWith("/")&&t++,2==t?n+e.substring(1):1==t?n+e:n+"/"+e}function fO(n){const e=n.match(/#|\?|$/),t=e&&e.index||n.length;return n.slice(0,t-("/"===n[t-1]?1:0))+n.slice(t)}function up(n){return n&&"?"!==n[0]?"?"+n:n}let Ig=(()=>{class n{historyGo(t){throw new Error("Not implemented")}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=Yt({token:n,factory:function(){return xr(gO)},providedIn:"root"}),n})();const mO=new Vt("appBaseHref");let gO=(()=>{class n extends Ig{constructor(t,i){super(),this._platformLocation=t,this._removeListenerFns=[],this._baseHref=i??this._platformLocation.getBaseHrefFromDOM()??xr(Vi).location?.origin??""}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(t){this._removeListenerFns.push(this._platformLocation.onPopState(t),this._platformLocation.onHashChange(t))}getBaseHref(){return this._baseHref}prepareExternalUrl(t){return zD(this._baseHref,t)}path(t=!1){const i=this._platformLocation.pathname+up(this._platformLocation.search),r=this._platformLocation.hash;return r&&t?`${i}${r}`:i}pushState(t,i,r,s){const c=this.prepareExternalUrl(r+up(s));this._platformLocation.pushState(t,i,c)}replaceState(t,i,r,s){const c=this.prepareExternalUrl(r+up(s));this._platformLocation.replaceState(t,i,c)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(t=0){this._platformLocation.historyGo?.(t)}}return n.\u0275fac=function(t){return new(t||n)(Xe(BD),Xe(mO,8))},n.\u0275prov=Yt({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),ij=(()=>{class n extends Ig{constructor(t,i){super(),this._platformLocation=t,this._baseHref="",this._removeListenerFns=[],null!=i&&(this._baseHref=i)}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(t){this._removeListenerFns.push(this._platformLocation.onPopState(t),this._platformLocation.onHashChange(t))}getBaseHref(){return this._baseHref}path(t=!1){let i=this._platformLocation.hash;return null==i&&(i="#"),i.length>0?i.substring(1):i}prepareExternalUrl(t){const i=zD(this._baseHref,t);return i.length>0?"#"+i:i}pushState(t,i,r,s){let c=this.prepareExternalUrl(r+up(s));0==c.length&&(c=this._platformLocation.pathname),this._platformLocation.pushState(t,i,c)}replaceState(t,i,r,s){let c=this.prepareExternalUrl(r+up(s));0==c.length&&(c=this._platformLocation.pathname),this._platformLocation.replaceState(t,i,c)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(t=0){this._platformLocation.historyGo?.(t)}}return n.\u0275fac=function(t){return new(t||n)(Xe(BD),Xe(mO,8))},n.\u0275prov=Yt({token:n,factory:n.\u0275fac}),n})(),UM=(()=>{class n{constructor(t){this._subject=new Dn,this._urlChangeListeners=[],this._urlChangeSubscription=null,this._locationStrategy=t;const i=this._locationStrategy.getBaseHref();this._baseHref=fO(_O(i)),this._locationStrategy.onPopState(r=>{this._subject.emit({url:this.path(!0),pop:!0,state:r.state,type:r.type})})}ngOnDestroy(){this._urlChangeSubscription?.unsubscribe(),this._urlChangeListeners=[]}path(t=!1){return this.normalize(this._locationStrategy.path(t))}getState(){return this._locationStrategy.getState()}isCurrentPathEqualTo(t,i=""){return this.path()==this.normalize(t+up(i))}normalize(t){return n.stripTrailingSlash(function sj(n,e){return n&&e.startsWith(n)?e.substring(n.length):e}(this._baseHref,_O(t)))}prepareExternalUrl(t){return t&&"/"!==t[0]&&(t="/"+t),this._locationStrategy.prepareExternalUrl(t)}go(t,i="",r=null){this._locationStrategy.pushState(r,"",t,i),this._notifyUrlChangeListeners(this.prepareExternalUrl(t+up(i)),r)}replaceState(t,i="",r=null){this._locationStrategy.replaceState(r,"",t,i),this._notifyUrlChangeListeners(this.prepareExternalUrl(t+up(i)),r)}forward(){this._locationStrategy.forward()}back(){this._locationStrategy.back()}historyGo(t=0){this._locationStrategy.historyGo?.(t)}onUrlChange(t){return this._urlChangeListeners.push(t),this._urlChangeSubscription||(this._urlChangeSubscription=this.subscribe(i=>{this._notifyUrlChangeListeners(i.url,i.state)})),()=>{const i=this._urlChangeListeners.indexOf(t);this._urlChangeListeners.splice(i,1),0===this._urlChangeListeners.length&&(this._urlChangeSubscription?.unsubscribe(),this._urlChangeSubscription=null)}}_notifyUrlChangeListeners(t="",i){this._urlChangeListeners.forEach(r=>r(t,i))}subscribe(t,i,r){return this._subject.subscribe({next:t,error:i,complete:r})}}return n.normalizeQueryParams=up,n.joinWithSlash=zD,n.stripTrailingSlash=fO,n.\u0275fac=function(t){return new(t||n)(Xe(Ig))},n.\u0275prov=Yt({token:n,factory:function(){return function rj(){return new UM(Xe(Ig))}()},providedIn:"root"}),n})();function _O(n){return n.replace(/\/index.html$/,"")}var eo=(()=>((eo=eo||{})[eo.Format=0]="Format",eo[eo.Standalone=1]="Standalone",eo))(),ir=(()=>((ir=ir||{})[ir.Narrow=0]="Narrow",ir[ir.Abbreviated=1]="Abbreviated",ir[ir.Wide=2]="Wide",ir[ir.Short=3]="Short",ir))(),Fs=(()=>((Fs=Fs||{})[Fs.Short=0]="Short",Fs[Fs.Medium=1]="Medium",Fs[Fs.Long=2]="Long",Fs[Fs.Full=3]="Full",Fs))(),pi=(()=>((pi=pi||{})[pi.Decimal=0]="Decimal",pi[pi.Group=1]="Group",pi[pi.List=2]="List",pi[pi.PercentSign=3]="PercentSign",pi[pi.PlusSign=4]="PlusSign",pi[pi.MinusSign=5]="MinusSign",pi[pi.Exponential=6]="Exponential",pi[pi.SuperscriptingExponent=7]="SuperscriptingExponent",pi[pi.PerMille=8]="PerMille",pi[pi.Infinity=9]="Infinity",pi[pi.NaN=10]="NaN",pi[pi.TimeSeparator=11]="TimeSeparator",pi[pi.CurrencyDecimal=12]="CurrencyDecimal",pi[pi.CurrencyGroup=13]="CurrencyGroup",pi))();function HM(n,e){return ou(gl(n)[Cn.DateFormat],e)}function GM(n,e){return ou(gl(n)[Cn.TimeFormat],e)}function jM(n,e){return ou(gl(n)[Cn.DateTimeFormat],e)}function su(n,e){const t=gl(n),i=t[Cn.NumberSymbols][e];if(typeof i>"u"){if(e===pi.CurrencyDecimal)return t[Cn.NumberSymbols][pi.Decimal];if(e===pi.CurrencyGroup)return t[Cn.NumberSymbols][pi.Group]}return i}function vO(n){if(!n[Cn.ExtraData])throw new Error(`Missing extra locale data for the locale "${n[Cn.LocaleId]}". Use "registerLocaleData" to load new data. See the "I18n guide" on angular.io to know more.`)}function ou(n,e){for(let t=e;t>-1;t--)if(typeof n[t]<"u")return n[t];throw new Error("Locale data API: locale data undefined")}function UD(n){const[e,t]=n.split(":");return{hours:+e,minutes:+t}}const yj=/^(\d{4,})-?(\d\d)-?(\d\d)(?:T(\d\d)(?::?(\d\d)(?::?(\d\d)(?:\.(\d+))?)?)?(Z|([+-])(\d\d):?(\d\d))?)?$/,bb={},vj=/((?:[^BEGHLMOSWYZabcdhmswyz']+)|(?:'(?:[^']|'')*')|(?:G{1,5}|y{1,4}|Y{1,4}|M{1,5}|L{1,5}|w{1,2}|W{1}|d{1,2}|E{1,6}|c{1,6}|a{1,5}|b{1,5}|B{1,5}|h{1,2}|H{1,2}|m{1,2}|s{1,2}|S{1,3}|z{1,4}|Z{1,5}|O{1,4}))([\s\S]*)/;var Go=(()=>((Go=Go||{})[Go.Short=0]="Short",Go[Go.ShortGMT=1]="ShortGMT",Go[Go.Long=2]="Long",Go[Go.Extended=3]="Extended",Go))(),vi=(()=>((vi=vi||{})[vi.FullYear=0]="FullYear",vi[vi.Month=1]="Month",vi[vi.Date=2]="Date",vi[vi.Hours=3]="Hours",vi[vi.Minutes=4]="Minutes",vi[vi.Seconds=5]="Seconds",vi[vi.FractionalSeconds=6]="FractionalSeconds",vi[vi.Day=7]="Day",vi))(),Ni=(()=>((Ni=Ni||{})[Ni.DayPeriods=0]="DayPeriods",Ni[Ni.Days=1]="Days",Ni[Ni.Months=2]="Months",Ni[Ni.Eras=3]="Eras",Ni))();function xj(n,e,t,i){let r=function Aj(n){if(wO(n))return n;if("number"==typeof n&&!isNaN(n))return new Date(n);if("string"==typeof n){if(n=n.trim(),/^(\d{4}(-\d{1,2}(-\d{1,2})?)?)$/.test(n)){const[r,s=1,c=1]=n.split("-").map(d=>+d);return $M(r,s-1,c)}const t=parseFloat(n);if(!isNaN(n-t))return new Date(t);let i;if(i=n.match(yj))return function Ij(n){const e=new Date(0);let t=0,i=0;const r=n[8]?e.setUTCFullYear:e.setFullYear,s=n[8]?e.setUTCHours:e.setHours;n[9]&&(t=Number(n[9]+n[10]),i=Number(n[9]+n[11])),r.call(e,Number(n[1]),Number(n[2])-1,Number(n[3]));const c=Number(n[4]||0)-t,d=Number(n[5]||0)-i,m=Number(n[6]||0),y=Math.floor(1e3*parseFloat("0."+(n[7]||0)));return s.call(e,c,d,m,y),e}(i)}const e=new Date(n);if(!wO(e))throw new Error(`Unable to convert "${n}" into a date`);return e}(n);e=dp(t,e)||e;let d,c=[];for(;e;){if(d=vj.exec(e),!d){c.push(e);break}{c=c.concat(d.slice(1));const w=c.pop();if(!w)break;e=w}}let m=r.getTimezoneOffset();i&&(m=bO(i,m),r=function Dj(n,e,t){const i=t?-1:1,r=n.getTimezoneOffset();return function Tj(n,e){return(n=new Date(n.getTime())).setMinutes(n.getMinutes()+e),n}(n,i*(bO(e,r)-r))}(r,i,!0));let y="";return c.forEach(w=>{const S=function Ej(n){if(GD[n])return GD[n];let e;switch(n){case"G":case"GG":case"GGG":e=hs(Ni.Eras,ir.Abbreviated);break;case"GGGG":e=hs(Ni.Eras,ir.Wide);break;case"GGGGG":e=hs(Ni.Eras,ir.Narrow);break;case"y":e=xo(vi.FullYear,1,0,!1,!0);break;case"yy":e=xo(vi.FullYear,2,0,!0,!0);break;case"yyy":e=xo(vi.FullYear,3,0,!1,!0);break;case"yyyy":e=xo(vi.FullYear,4,0,!1,!0);break;case"Y":e=XM(1);break;case"YY":e=XM(2,!0);break;case"YYY":e=XM(3);break;case"YYYY":e=XM(4);break;case"M":case"L":e=xo(vi.Month,1,1);break;case"MM":case"LL":e=xo(vi.Month,2,1);break;case"MMM":e=hs(Ni.Months,ir.Abbreviated);break;case"MMMM":e=hs(Ni.Months,ir.Wide);break;case"MMMMM":e=hs(Ni.Months,ir.Narrow);break;case"LLL":e=hs(Ni.Months,ir.Abbreviated,eo.Standalone);break;case"LLLL":e=hs(Ni.Months,ir.Wide,eo.Standalone);break;case"LLLLL":e=hs(Ni.Months,ir.Narrow,eo.Standalone);break;case"w":e=HD(1);break;case"ww":e=HD(2);break;case"W":e=HD(1,!0);break;case"d":e=xo(vi.Date,1);break;case"dd":e=xo(vi.Date,2);break;case"c":case"cc":e=xo(vi.Day,1);break;case"ccc":e=hs(Ni.Days,ir.Abbreviated,eo.Standalone);break;case"cccc":e=hs(Ni.Days,ir.Wide,eo.Standalone);break;case"ccccc":e=hs(Ni.Days,ir.Narrow,eo.Standalone);break;case"cccccc":e=hs(Ni.Days,ir.Short,eo.Standalone);break;case"E":case"EE":case"EEE":e=hs(Ni.Days,ir.Abbreviated);break;case"EEEE":e=hs(Ni.Days,ir.Wide);break;case"EEEEE":e=hs(Ni.Days,ir.Narrow);break;case"EEEEEE":e=hs(Ni.Days,ir.Short);break;case"a":case"aa":case"aaa":e=hs(Ni.DayPeriods,ir.Abbreviated);break;case"aaaa":e=hs(Ni.DayPeriods,ir.Wide);break;case"aaaaa":e=hs(Ni.DayPeriods,ir.Narrow);break;case"b":case"bb":case"bbb":e=hs(Ni.DayPeriods,ir.Abbreviated,eo.Standalone,!0);break;case"bbbb":e=hs(Ni.DayPeriods,ir.Wide,eo.Standalone,!0);break;case"bbbbb":e=hs(Ni.DayPeriods,ir.Narrow,eo.Standalone,!0);break;case"B":case"BB":case"BBB":e=hs(Ni.DayPeriods,ir.Abbreviated,eo.Format,!0);break;case"BBBB":e=hs(Ni.DayPeriods,ir.Wide,eo.Format,!0);break;case"BBBBB":e=hs(Ni.DayPeriods,ir.Narrow,eo.Format,!0);break;case"h":e=xo(vi.Hours,1,-12);break;case"hh":e=xo(vi.Hours,2,-12);break;case"H":e=xo(vi.Hours,1);break;case"HH":e=xo(vi.Hours,2);break;case"m":e=xo(vi.Minutes,1);break;case"mm":e=xo(vi.Minutes,2);break;case"s":e=xo(vi.Seconds,1);break;case"ss":e=xo(vi.Seconds,2);break;case"S":e=xo(vi.FractionalSeconds,1);break;case"SS":e=xo(vi.FractionalSeconds,2);break;case"SSS":e=xo(vi.FractionalSeconds,3);break;case"Z":case"ZZ":case"ZZZ":e=qM(Go.Short);break;case"ZZZZZ":e=qM(Go.Extended);break;case"O":case"OO":case"OOO":case"z":case"zz":case"zzz":e=qM(Go.ShortGMT);break;case"OOOO":case"ZZZZ":case"zzzz":e=qM(Go.Long);break;default:return null}return GD[n]=e,e}(w);y+=S?S(r,t,m):"''"===w?"'":w.replace(/(^'|'$)/g,"").replace(/''/g,"'")}),y}function $M(n,e,t){const i=new Date(0);return i.setFullYear(n,e,t),i.setHours(0,0,0),i}function dp(n,e){const t=function oj(n){return gl(n)[Cn.LocaleId]}(n);if(bb[t]=bb[t]||{},bb[t][e])return bb[t][e];let i="";switch(e){case"shortDate":i=HM(n,Fs.Short);break;case"mediumDate":i=HM(n,Fs.Medium);break;case"longDate":i=HM(n,Fs.Long);break;case"fullDate":i=HM(n,Fs.Full);break;case"shortTime":i=GM(n,Fs.Short);break;case"mediumTime":i=GM(n,Fs.Medium);break;case"longTime":i=GM(n,Fs.Long);break;case"fullTime":i=GM(n,Fs.Full);break;case"short":const r=dp(n,"shortTime"),s=dp(n,"shortDate");i=WM(jM(n,Fs.Short),[r,s]);break;case"medium":const c=dp(n,"mediumTime"),d=dp(n,"mediumDate");i=WM(jM(n,Fs.Medium),[c,d]);break;case"long":const m=dp(n,"longTime"),y=dp(n,"longDate");i=WM(jM(n,Fs.Long),[m,y]);break;case"full":const w=dp(n,"fullTime"),S=dp(n,"fullDate");i=WM(jM(n,Fs.Full),[w,S])}return i&&(bb[t][e]=i),i}function WM(n,e){return e&&(n=n.replace(/\{([^}]+)}/g,function(t,i){return null!=e&&i in e?e[i]:t})),n}function ud(n,e,t="-",i,r){let s="";(n<0||r&&n<=0)&&(r?n=1-n:(n=-n,s=t));let c=String(n);for(;c.length<e;)c="0"+c;return i&&(c=c.slice(c.length-e)),s+c}function xo(n,e,t=0,i=!1,r=!1){return function(s,c){let d=function wj(n,e){switch(n){case vi.FullYear:return e.getFullYear();case vi.Month:return e.getMonth();case vi.Date:return e.getDate();case vi.Hours:return e.getHours();case vi.Minutes:return e.getMinutes();case vi.Seconds:return e.getSeconds();case vi.FractionalSeconds:return e.getMilliseconds();case vi.Day:return e.getDay();default:throw new Error(`Unknown DateType value "${n}".`)}}(n,s);if((t>0||d>-t)&&(d+=t),n===vi.Hours)0===d&&-12===t&&(d=12);else if(n===vi.FractionalSeconds)return function bj(n,e){return ud(n,3).substring(0,e)}(d,e);const m=su(c,pi.MinusSign);return ud(d,e,m,i,r)}}function hs(n,e,t=eo.Format,i=!1){return function(r,s){return function Mj(n,e,t,i,r,s){switch(t){case Ni.Months:return function cj(n,e,t){const i=gl(n),s=ou([i[Cn.MonthsFormat],i[Cn.MonthsStandalone]],e);return ou(s,t)}(e,r,i)[n.getMonth()];case Ni.Days:return function lj(n,e,t){const i=gl(n),s=ou([i[Cn.DaysFormat],i[Cn.DaysStandalone]],e);return ou(s,t)}(e,r,i)[n.getDay()];case Ni.DayPeriods:const c=n.getHours(),d=n.getMinutes();if(s){const y=function pj(n){const e=gl(n);return vO(e),(e[Cn.ExtraData][2]||[]).map(i=>"string"==typeof i?UD(i):[UD(i[0]),UD(i[1])])}(e),w=function fj(n,e,t){const i=gl(n);vO(i);const s=ou([i[Cn.ExtraData][0],i[Cn.ExtraData][1]],e)||[];return ou(s,t)||[]}(e,r,i),S=y.findIndex(T=>{if(Array.isArray(T)){const[I,R]=T,k=c>=I.hours&&d>=I.minutes,F=c<R.hours||c===R.hours&&d<R.minutes;if(I.hours<R.hours){if(k&&F)return!0}else if(k||F)return!0}else if(T.hours===c&&T.minutes===d)return!0;return!1});if(-1!==S)return w[S]}return function aj(n,e,t){const i=gl(n),s=ou([i[Cn.DayPeriodsFormat],i[Cn.DayPeriodsStandalone]],e);return ou(s,t)}(e,r,i)[c<12?0:1];case Ni.Eras:return function uj(n,e){return ou(gl(n)[Cn.Eras],e)}(e,i)[n.getFullYear()<=0?0:1];default:throw new Error(`unexpected translation type ${t}`)}}(r,s,n,e,t,i)}}function qM(n){return function(e,t,i){const r=-1*i,s=su(t,pi.MinusSign),c=r>0?Math.floor(r/60):Math.ceil(r/60);switch(n){case Go.Short:return(r>=0?"+":"")+ud(c,2,s)+ud(Math.abs(r%60),2,s);case Go.ShortGMT:return"GMT"+(r>=0?"+":"")+ud(c,1,s);case Go.Long:return"GMT"+(r>=0?"+":"")+ud(c,2,s)+":"+ud(Math.abs(r%60),2,s);case Go.Extended:return 0===i?"Z":(r>=0?"+":"")+ud(c,2,s)+":"+ud(Math.abs(r%60),2,s);default:throw new Error(`Unknown zone width "${n}"`)}}}function xO(n){return $M(n.getFullYear(),n.getMonth(),n.getDate()+(4-n.getDay()))}function HD(n,e=!1){return function(t,i){let r;if(e){const s=new Date(t.getFullYear(),t.getMonth(),1).getDay()-1,c=t.getDate();r=1+Math.floor((c+s)/7)}else{const s=xO(t),c=function Sj(n){const e=$M(n,0,1).getDay();return $M(n,0,1+(e<=4?4:11)-e)}(s.getFullYear()),d=s.getTime()-c.getTime();r=1+Math.round(d/6048e5)}return ud(r,n,su(i,pi.MinusSign))}}function XM(n,e=!1){return function(t,i){return ud(xO(t).getFullYear(),n,su(i,pi.MinusSign),e)}}const GD={};function bO(n,e){n=n.replace(/:/g,"");const t=Date.parse("Jan 01, 1970 00:00:00 "+n)/6e4;return isNaN(t)?e:t}function wO(n){return n instanceof Date&&!isNaN(n.valueOf())}function EO(n,e){e=encodeURIComponent(e);for(const t of n.split(";")){const i=t.indexOf("="),[r,s]=-1==i?[t,""]:[t.slice(0,i),t.slice(i+1)];if(r.trim()===e)return decodeURIComponent(s)}return null}let KM=(()=>{class n{constructor(t,i,r,s){this._iterableDiffers=t,this._keyValueDiffers=i,this._ngEl=r,this._renderer=s,this._iterableDiffer=null,this._keyValueDiffer=null,this._initialClasses=[],this._rawClass=null}set klass(t){this._removeClasses(this._initialClasses),this._initialClasses="string"==typeof t?t.split(/\s+/):[],this._applyClasses(this._initialClasses),this._applyClasses(this._rawClass)}set ngClass(t){this._removeClasses(this._rawClass),this._applyClasses(this._initialClasses),this._iterableDiffer=null,this._keyValueDiffer=null,this._rawClass="string"==typeof t?t.split(/\s+/):t,this._rawClass&&(ys(this._rawClass)?this._iterableDiffer=this._iterableDiffers.find(this._rawClass).create():this._keyValueDiffer=this._keyValueDiffers.find(this._rawClass).create())}ngDoCheck(){if(this._iterableDiffer){const t=this._iterableDiffer.diff(this._rawClass);t&&this._applyIterableChanges(t)}else if(this._keyValueDiffer){const t=this._keyValueDiffer.diff(this._rawClass);t&&this._applyKeyValueChanges(t)}}_applyKeyValueChanges(t){t.forEachAddedItem(i=>this._toggleClass(i.key,i.currentValue)),t.forEachChangedItem(i=>this._toggleClass(i.key,i.currentValue)),t.forEachRemovedItem(i=>{i.previousValue&&this._toggleClass(i.key,!1)})}_applyIterableChanges(t){t.forEachAddedItem(i=>{if("string"!=typeof i.item)throw new Error(`NgClass can only toggle CSS classes expressed as strings, got ${vn(i.item)}`);this._toggleClass(i.item,!0)}),t.forEachRemovedItem(i=>this._toggleClass(i.item,!1))}_applyClasses(t){t&&(Array.isArray(t)||t instanceof Set?t.forEach(i=>this._toggleClass(i,!0)):Object.keys(t).forEach(i=>this._toggleClass(i,!!t[i])))}_removeClasses(t){t&&(Array.isArray(t)||t instanceof Set?t.forEach(i=>this._toggleClass(i,!1)):Object.keys(t).forEach(i=>this._toggleClass(i,!1)))}_toggleClass(t,i){(t=t.trim())&&t.split(/\s+/g).forEach(r=>{i?this._renderer.addClass(this._ngEl.nativeElement,r):this._renderer.removeClass(this._ngEl.nativeElement,r)})}}return n.\u0275fac=function(t){return new(t||n)(Ie(zM),Ie(xb),Ie(wr),Ie(Ul))},n.\u0275dir=an({type:n,selectors:[["","ngClass",""]],inputs:{klass:["class","klass"],ngClass:"ngClass"},standalone:!0}),n})();class Gj{constructor(e,t,i,r){this.$implicit=e,this.ngForOf=t,this.index=i,this.count=r}get first(){return 0===this.index}get last(){return this.index===this.count-1}get even(){return this.index%2==0}get odd(){return!this.even}}let hp=(()=>{class n{constructor(t,i,r){this._viewContainer=t,this._template=i,this._differs=r,this._ngForOf=null,this._ngForOfDirty=!0,this._differ=null}set ngForOf(t){this._ngForOf=t,this._ngForOfDirty=!0}set ngForTrackBy(t){this._trackByFn=t}get ngForTrackBy(){return this._trackByFn}set ngForTemplate(t){t&&(this._template=t)}ngDoCheck(){if(this._ngForOfDirty){this._ngForOfDirty=!1;const t=this._ngForOf;!this._differ&&t&&(this._differ=this._differs.find(t).create(this.ngForTrackBy))}if(this._differ){const t=this._differ.diff(this._ngForOf);t&&this._applyChanges(t)}}_applyChanges(t){const i=this._viewContainer;t.forEachOperation((r,s,c)=>{if(null==r.previousIndex)i.createEmbeddedView(this._template,new Gj(r.item,this._ngForOf,-1,-1),null===c?void 0:c);else if(null==c)i.remove(null===s?void 0:s);else if(null!==s){const d=i.get(s);i.move(d,c),AO(d,r)}});for(let r=0,s=i.length;r<s;r++){const d=i.get(r).context;d.index=r,d.count=s,d.ngForOf=this._ngForOf}t.forEachIdentityChange(r=>{AO(i.get(r.currentIndex),r)})}static ngTemplateContextGuard(t,i){return!0}}return n.\u0275fac=function(t){return new(t||n)(Ie(ql),Ie(ld),Ie(zM))},n.\u0275dir=an({type:n,selectors:[["","ngFor","","ngForOf",""]],inputs:{ngForOf:"ngForOf",ngForTrackBy:"ngForTrackBy",ngForTemplate:"ngForTemplate"},standalone:!0}),n})();function AO(n,e){n.context.$implicit=e.item}let Yf=(()=>{class n{constructor(t,i){this._viewContainer=t,this._context=new $j,this._thenTemplateRef=null,this._elseTemplateRef=null,this._thenViewRef=null,this._elseViewRef=null,this._thenTemplateRef=i}set ngIf(t){this._context.$implicit=this._context.ngIf=t,this._updateView()}set ngIfThen(t){IO("ngIfThen",t),this._thenTemplateRef=t,this._thenViewRef=null,this._updateView()}set ngIfElse(t){IO("ngIfElse",t),this._elseTemplateRef=t,this._elseViewRef=null,this._updateView()}_updateView(){this._context.$implicit?this._thenViewRef||(this._viewContainer.clear(),this._elseViewRef=null,this._thenTemplateRef&&(this._thenViewRef=this._viewContainer.createEmbeddedView(this._thenTemplateRef,this._context))):this._elseViewRef||(this._viewContainer.clear(),this._thenViewRef=null,this._elseTemplateRef&&(this._elseViewRef=this._viewContainer.createEmbeddedView(this._elseTemplateRef,this._context)))}static ngTemplateContextGuard(t,i){return!0}}return n.\u0275fac=function(t){return new(t||n)(Ie(ql),Ie(ld))},n.\u0275dir=an({type:n,selectors:[["","ngIf",""]],inputs:{ngIf:"ngIf",ngIfThen:"ngIfThen",ngIfElse:"ngIfElse"},standalone:!0}),n})();class $j{constructor(){this.$implicit=null,this.ngIf=null}}function IO(n,e){if(e&&!e.createEmbeddedView)throw new Error(`${n} must be a TemplateRef, but received '${vn(e)}'.`)}class XD{constructor(e,t){this._viewContainerRef=e,this._templateRef=t,this._created=!1}create(){this._created=!0,this._viewContainerRef.createEmbeddedView(this._templateRef)}destroy(){this._created=!1,this._viewContainerRef.clear()}enforceState(e){e&&!this._created?this.create():!e&&this._created&&this.destroy()}}let av=(()=>{class n{constructor(){this._defaultUsed=!1,this._caseCount=0,this._lastCaseCheckIndex=0,this._lastCasesMatched=!1}set ngSwitch(t){this._ngSwitch=t,0===this._caseCount&&this._updateDefaultCases(!0)}_addCase(){return this._caseCount++}_addDefault(t){this._defaultViews||(this._defaultViews=[]),this._defaultViews.push(t)}_matchCase(t){const i=t==this._ngSwitch;return this._lastCasesMatched=this._lastCasesMatched||i,this._lastCaseCheckIndex++,this._lastCaseCheckIndex===this._caseCount&&(this._updateDefaultCases(!this._lastCasesMatched),this._lastCaseCheckIndex=0,this._lastCasesMatched=!1),i}_updateDefaultCases(t){if(this._defaultViews&&t!==this._defaultUsed){this._defaultUsed=t;for(let i=0;i<this._defaultViews.length;i++)this._defaultViews[i].enforceState(t)}}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275dir=an({type:n,selectors:[["","ngSwitch",""]],inputs:{ngSwitch:"ngSwitch"},standalone:!0}),n})(),QM=(()=>{class n{constructor(t,i,r){this.ngSwitch=r,r._addCase(),this._view=new XD(t,i)}ngDoCheck(){this._view.enforceState(this.ngSwitch._matchCase(this.ngSwitchCase))}}return n.\u0275fac=function(t){return new(t||n)(Ie(ql),Ie(ld),Ie(av,9))},n.\u0275dir=an({type:n,selectors:[["","ngSwitchCase",""]],inputs:{ngSwitchCase:"ngSwitchCase"},standalone:!0}),n})(),PO=(()=>{class n{constructor(t,i,r){r._addDefault(new XD(t,i))}}return n.\u0275fac=function(t){return new(t||n)(Ie(ql),Ie(ld),Ie(av,9))},n.\u0275dir=an({type:n,selectors:[["","ngSwitchDefault",""]],standalone:!0}),n})(),kO=(()=>{class n{constructor(t,i,r){this._ngEl=t,this._differs=i,this._renderer=r,this._ngStyle=null,this._differ=null}set ngStyle(t){this._ngStyle=t,!this._differ&&t&&(this._differ=this._differs.find(t).create())}ngDoCheck(){if(this._differ){const t=this._differ.diff(this._ngStyle);t&&this._applyChanges(t)}}_setStyle(t,i){const[r,s]=t.split("."),c=-1===r.indexOf("-")?void 0:Ma.DashCase;null!=i?this._renderer.setStyle(this._ngEl.nativeElement,r,s?`${i}${s}`:i,c):this._renderer.removeStyle(this._ngEl.nativeElement,r,c)}_applyChanges(t){t.forEachRemovedItem(i=>this._setStyle(i.key,null)),t.forEachAddedItem(i=>this._setStyle(i.key,i.currentValue)),t.forEachChangedItem(i=>this._setStyle(i.key,i.currentValue))}}return n.\u0275fac=function(t){return new(t||n)(Ie(wr),Ie(xb),Ie(Ul))},n.\u0275dir=an({type:n,selectors:[["","ngStyle",""]],inputs:{ngStyle:"ngStyle"},standalone:!0}),n})();const i8=new Vt("DATE_PIPE_DEFAULT_TIMEZONE");let YD=(()=>{class n{constructor(t,i){this.locale=t,this.defaultTimezone=i}transform(t,i="mediumDate",r,s){if(null==t||""===t||t!=t)return null;try{return xj(t,i,s||this.locale,r??this.defaultTimezone??void 0)}catch(c){throw function dd(n,e){return new bt(2100,!1)}()}}}return n.\u0275fac=function(t){return new(t||n)(Ie(Jd,16),Ie(i8,24))},n.\u0275pipe=co({name:"date",type:n,pure:!0,standalone:!0}),n})(),au=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=Gn({type:n}),n.\u0275inj=Bn({}),n})();const OO="browser";let y8=(()=>{class n{}return n.\u0275prov=Yt({token:n,providedIn:"root",factory:()=>new v8(Xe(Vi),window)}),n})();class v8{constructor(e,t){this.document=e,this.window=t,this.offset=()=>[0,0]}setOffset(e){this.offset=Array.isArray(e)?()=>e:e}getScrollPosition(){return this.supportsScrolling()?[this.window.pageXOffset,this.window.pageYOffset]:[0,0]}scrollToPosition(e){this.supportsScrolling()&&this.window.scrollTo(e[0],e[1])}scrollToAnchor(e){if(!this.supportsScrolling())return;const t=function x8(n,e){const t=n.getElementById(e)||n.getElementsByName(e)[0];if(t)return t;if("function"==typeof n.createTreeWalker&&n.body&&(n.body.createShadowRoot||n.body.attachShadow)){const i=n.createTreeWalker(n.body,NodeFilter.SHOW_ELEMENT);let r=i.currentNode;for(;r;){const s=r.shadowRoot;if(s){const c=s.getElementById(e)||s.querySelector(`[name="${e}"]`);if(c)return c}r=i.nextNode()}}return null}(this.document,e);t&&(this.scrollToElement(t),t.focus())}setHistoryScrollRestoration(e){if(this.supportScrollRestoration()){const t=this.window.history;t&&t.scrollRestoration&&(t.scrollRestoration=e)}}scrollToElement(e){const t=e.getBoundingClientRect(),i=t.left+this.window.pageXOffset,r=t.top+this.window.pageYOffset,s=this.offset();this.window.scrollTo(i-s[0],r-s[1])}supportScrollRestoration(){try{if(!this.supportsScrolling())return!1;const e=FO(this.window.history)||FO(Object.getPrototypeOf(this.window.history));return!(!e||!e.writable&&!e.set)}catch{return!1}}supportsScrolling(){try{return!!this.window&&!!this.window.scrollTo&&"pageXOffset"in this.window}catch{return!1}}}function FO(n){return Object.getOwnPropertyDescriptor(n,"scrollRestoration")}class NO{}class tA extends class B8 extends class JG{}{constructor(){super(...arguments),this.supportsDOMEvents=!0}}{static makeCurrent(){!function QG(n){VM||(VM=n)}(new tA)}onAndCancel(e,t,i){return e.addEventListener(t,i,!1),()=>{e.removeEventListener(t,i,!1)}}dispatchEvent(e,t){e.dispatchEvent(t)}remove(e){e.parentNode&&e.parentNode.removeChild(e)}createElement(e,t){return(t=t||this.getDefaultDocument()).createElement(e)}createHtmlDocument(){return document.implementation.createHTMLDocument("fakeTitle")}getDefaultDocument(){return document}isElementNode(e){return e.nodeType===Node.ELEMENT_NODE}isShadowRoot(e){return e instanceof DocumentFragment}getGlobalEventTarget(e,t){return"window"===t?window:"document"===t?e:"body"===t?e.body:null}getBaseHref(e){const t=function z8(){return Cb=Cb||document.querySelector("base"),Cb?Cb.getAttribute("href"):null}();return null==t?null:function V8(n){eC=eC||document.createElement("a"),eC.setAttribute("href",n);const e=eC.pathname;return"/"===e.charAt(0)?e:`/${e}`}(t)}resetBaseElement(){Cb=null}getUserAgent(){return window.navigator.userAgent}getCookie(e){return EO(document.cookie,e)}}let eC,Cb=null;const UO=new Vt("TRANSITION_ID"),H8=[{provide:RM,useFactory:function U8(n,e,t){return()=>{t.get(kM).donePromise.then(()=>{const i=eh(),r=e.querySelectorAll(`style[ng-transition="${n}"]`);for(let s=0;s<r.length;s++)i.remove(r[s])})}},deps:[UO,Vi,Yr],multi:!0}];let j8=(()=>{class n{build(){return new XMLHttpRequest}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=Yt({token:n,factory:n.\u0275fac}),n})();const tC=new Vt("EventManagerPlugins");let nC=(()=>{class n{constructor(t,i){this._zone=i,this._eventNameToPlugin=new Map,t.forEach(r=>r.manager=this),this._plugins=t.slice().reverse()}addEventListener(t,i,r){return this._findPluginFor(i).addEventListener(t,i,r)}addGlobalEventListener(t,i,r){return this._findPluginFor(i).addGlobalEventListener(t,i,r)}getZone(){return this._zone}_findPluginFor(t){const i=this._eventNameToPlugin.get(t);if(i)return i;const r=this._plugins;for(let s=0;s<r.length;s++){const c=r[s];if(c.supports(t))return this._eventNameToPlugin.set(t,c),c}throw new Error(`No event manager plugin found for event ${t}`)}}return n.\u0275fac=function(t){return new(t||n)(Xe(tC),Xe(nr))},n.\u0275prov=Yt({token:n,factory:n.\u0275fac}),n})();class HO{constructor(e){this._doc=e}addGlobalEventListener(e,t,i){const r=eh().getGlobalEventTarget(this._doc,e);if(!r)throw new Error(`Unsupported event target ${r} for event ${t}`);return this.addEventListener(r,t,i)}}let GO=(()=>{class n{constructor(){this._stylesSet=new Set}addStyles(t){const i=new Set;t.forEach(r=>{this._stylesSet.has(r)||(this._stylesSet.add(r),i.add(r))}),this.onStylesAdded(i)}onStylesAdded(t){}getAllStyles(){return Array.from(this._stylesSet)}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=Yt({token:n,factory:n.\u0275fac}),n})(),Sb=(()=>{class n extends GO{constructor(t){super(),this._doc=t,this._hostNodes=new Map,this._hostNodes.set(t.head,[])}_addStylesToHost(t,i,r){t.forEach(s=>{const c=this._doc.createElement("style");c.textContent=s,r.push(i.appendChild(c))})}addHost(t){const i=[];this._addStylesToHost(this._stylesSet,t,i),this._hostNodes.set(t,i)}removeHost(t){const i=this._hostNodes.get(t);i&&i.forEach(jO),this._hostNodes.delete(t)}onStylesAdded(t){this._hostNodes.forEach((i,r)=>{this._addStylesToHost(t,r,i)})}ngOnDestroy(){this._hostNodes.forEach(t=>t.forEach(jO))}}return n.\u0275fac=function(t){return new(t||n)(Xe(Vi))},n.\u0275prov=Yt({token:n,factory:n.\u0275fac}),n})();function jO(n){eh().remove(n)}const nA={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/",math:"http://www.w3.org/1998/MathML/"},iA=/%COMP%/g;function iC(n,e,t){for(let i=0;i<e.length;i++){let r=e[i];Array.isArray(r)?iC(n,r,t):(r=r.replace(iA,n),t.push(r))}return t}function qO(n){return e=>{if("__ngUnwrap__"===e)return n;!1===n(e)&&(e.preventDefault(),e.returnValue=!1)}}let rC=(()=>{class n{constructor(t,i,r){this.eventManager=t,this.sharedStylesHost=i,this.appId=r,this.rendererByCompId=new Map,this.defaultRenderer=new rA(t)}createRenderer(t,i){if(!t||!i)return this.defaultRenderer;switch(i.encapsulation){case pa.Emulated:{let r=this.rendererByCompId.get(i.id);return r||(r=new Y8(this.eventManager,this.sharedStylesHost,i,this.appId),this.rendererByCompId.set(i.id,r)),r.applyToHost(t),r}case 1:case pa.ShadowDom:return new K8(this.eventManager,this.sharedStylesHost,t,i);default:if(!this.rendererByCompId.has(i.id)){const r=iC(i.id,i.styles,[]);this.sharedStylesHost.addStyles(r),this.rendererByCompId.set(i.id,this.defaultRenderer)}return this.defaultRenderer}}begin(){}end(){}}return n.\u0275fac=function(t){return new(t||n)(Xe(nC),Xe(Sb),Xe(vb))},n.\u0275prov=Yt({token:n,factory:n.\u0275fac}),n})();class rA{constructor(e){this.eventManager=e,this.data=Object.create(null),this.destroyNode=null}destroy(){}createElement(e,t){return t?document.createElementNS(nA[t]||t,e):document.createElement(e)}createComment(e){return document.createComment(e)}createText(e){return document.createTextNode(e)}appendChild(e,t){(XO(e)?e.content:e).appendChild(t)}insertBefore(e,t,i){e&&(XO(e)?e.content:e).insertBefore(t,i)}removeChild(e,t){e&&e.removeChild(t)}selectRootElement(e,t){let i="string"==typeof e?document.querySelector(e):e;if(!i)throw new Error(`The selector "${e}" did not match any elements`);return t||(i.textContent=""),i}parentNode(e){return e.parentNode}nextSibling(e){return e.nextSibling}setAttribute(e,t,i,r){if(r){t=r+":"+t;const s=nA[r];s?e.setAttributeNS(s,t,i):e.setAttribute(t,i)}else e.setAttribute(t,i)}removeAttribute(e,t,i){if(i){const r=nA[i];r?e.removeAttributeNS(r,t):e.removeAttribute(`${i}:${t}`)}else e.removeAttribute(t)}addClass(e,t){e.classList.add(t)}removeClass(e,t){e.classList.remove(t)}setStyle(e,t,i,r){r&(Ma.DashCase|Ma.Important)?e.style.setProperty(t,i,r&Ma.Important?"important":""):e.style[t]=i}removeStyle(e,t,i){i&Ma.DashCase?e.style.removeProperty(t):e.style[t]=""}setProperty(e,t,i){e[t]=i}setValue(e,t){e.nodeValue=t}listen(e,t,i){return"string"==typeof e?this.eventManager.addGlobalEventListener(e,t,qO(i)):this.eventManager.addEventListener(e,t,qO(i))}}function XO(n){return"TEMPLATE"===n.tagName&&void 0!==n.content}class Y8 extends rA{constructor(e,t,i,r){super(e),this.component=i;const s=iC(r+"-"+i.id,i.styles,[]);t.addStyles(s),this.contentAttr=function q8(n){return"_ngcontent-%COMP%".replace(iA,n)}(r+"-"+i.id),this.hostAttr=function Z8(n){return"_nghost-%COMP%".replace(iA,n)}(r+"-"+i.id)}applyToHost(e){super.setAttribute(e,this.hostAttr,"")}createElement(e,t){const i=super.createElement(e,t);return super.setAttribute(i,this.contentAttr,""),i}}class K8 extends rA{constructor(e,t,i,r){super(e),this.sharedStylesHost=t,this.hostEl=i,this.shadowRoot=i.attachShadow({mode:"open"}),this.sharedStylesHost.addHost(this.shadowRoot);const s=iC(r.id,r.styles,[]);for(let c=0;c<s.length;c++){const d=document.createElement("style");d.textContent=s[c],this.shadowRoot.appendChild(d)}}nodeOrShadowRoot(e){return e===this.hostEl?this.shadowRoot:e}destroy(){this.sharedStylesHost.removeHost(this.shadowRoot)}appendChild(e,t){return super.appendChild(this.nodeOrShadowRoot(e),t)}insertBefore(e,t,i){return super.insertBefore(this.nodeOrShadowRoot(e),t,i)}removeChild(e,t){return super.removeChild(this.nodeOrShadowRoot(e),t)}parentNode(e){return this.nodeOrShadowRoot(super.parentNode(this.nodeOrShadowRoot(e)))}}let Q8=(()=>{class n extends HO{constructor(t){super(t)}supports(t){return!0}addEventListener(t,i,r){return t.addEventListener(i,r,!1),()=>this.removeEventListener(t,i,r)}removeEventListener(t,i,r){return t.removeEventListener(i,r)}}return n.\u0275fac=function(t){return new(t||n)(Xe(Vi))},n.\u0275prov=Yt({token:n,factory:n.\u0275fac}),n})();const YO=["alt","control","meta","shift"],J8={"\b":"Backspace","\t":"Tab","\x7f":"Delete","\x1b":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},e$={alt:n=>n.altKey,control:n=>n.ctrlKey,meta:n=>n.metaKey,shift:n=>n.shiftKey};let t$=(()=>{class n extends HO{constructor(t){super(t)}supports(t){return null!=n.parseEventName(t)}addEventListener(t,i,r){const s=n.parseEventName(i),c=n.eventCallback(s.fullKey,r,this.manager.getZone());return this.manager.getZone().runOutsideAngular(()=>eh().onAndCancel(t,s.domEventName,c))}static parseEventName(t){const i=t.toLowerCase().split("."),r=i.shift();if(0===i.length||"keydown"!==r&&"keyup"!==r)return null;const s=n._normalizeKey(i.pop());let c="",d=i.indexOf("code");if(d>-1&&(i.splice(d,1),c="code."),YO.forEach(y=>{const w=i.indexOf(y);w>-1&&(i.splice(w,1),c+=y+".")}),c+=s,0!=i.length||0===s.length)return null;const m={};return m.domEventName=r,m.fullKey=c,m}static matchEventFullKeyCode(t,i){let r=J8[t.key]||t.key,s="";return i.indexOf("code.")>-1&&(r=t.code,s="code."),!(null==r||!r)&&(r=r.toLowerCase()," "===r?r="space":"."===r&&(r="dot"),YO.forEach(c=>{c!==r&&(0,e$[c])(t)&&(s+=c+".")}),s+=r,s===i)}static eventCallback(t,i,r){return s=>{n.matchEventFullKeyCode(s,t)&&r.runGuarded(()=>i(s))}}static _normalizeKey(t){return"esc"===t?"escape":t}}return n.\u0275fac=function(t){return new(t||n)(Xe(Vi))},n.\u0275prov=Yt({token:n,factory:n.\u0275fac}),n})();const s$=qL(XG,"browser",[{provide:LM,useValue:OO},{provide:NL,useValue:function n$(){tA.makeCurrent()},multi:!0},{provide:Vi,useFactory:function r$(){return function Zh(n){ly=n}(document),document},deps:[]}]),JO=new Vt(""),eF=[{provide:OM,useClass:class G8{addToWindow(e){cr.getAngularTestability=(i,r=!0)=>{const s=e.findTestabilityInTree(i,r);if(null==s)throw new Error("Could not find testability for element.");return s},cr.getAllAngularTestabilities=()=>e.getAllTestabilities(),cr.getAllAngularRootElements=()=>e.getAllRootElements(),cr.frameworkStabilizers||(cr.frameworkStabilizers=[]),cr.frameworkStabilizers.push(i=>{const r=cr.getAllAngularTestabilities();let s=r.length,c=!1;const d=function(m){c=c||m,s--,0==s&&i(c)};r.forEach(function(m){m.whenStable(d)})})}findTestabilityInTree(e,t,i){return null==t?null:e.getTestability(t)??(i?eh().isShadowRoot(t)?this.findTestabilityInTree(e,t.host,!0):this.findTestabilityInTree(e,t.parentElement,!0):null)}},deps:[]},{provide:GL,useClass:AD,deps:[nr,ID,OM]},{provide:AD,useClass:AD,deps:[nr,ID,OM]}],tF=[{provide:tg,useValue:"root"},{provide:Ku,useFactory:function i$(){return new Ku},deps:[]},{provide:tC,useClass:Q8,multi:!0,deps:[Vi,nr,LM]},{provide:tC,useClass:t$,multi:!0,deps:[Vi]},{provide:rC,useClass:rC,deps:[nC,Sb,vb]},{provide:sg,useExisting:rC},{provide:GO,useExisting:Sb},{provide:Sb,useClass:Sb,deps:[Vi]},{provide:nC,useClass:nC,deps:[tC,nr]},{provide:NO,useClass:j8,deps:[]},[]];let lA,nF=(()=>{class n{constructor(t){}static withServerTransition(t){return{ngModule:n,providers:[{provide:vb,useValue:t.appId},{provide:UO,useExisting:vb},H8]}}}return n.\u0275fac=function(t){return new(t||n)(Xe(JO,12))},n.\u0275mod=Gn({type:n}),n.\u0275inj=Bn({providers:[...tF,...eF],imports:[au,YG]}),n})(),iF=(()=>{class n{constructor(t){this._doc=t}getTitle(){return this._doc.title}setTitle(t){this._doc.title=t||""}}return n.\u0275fac=function(t){return new(t||n)(Xe(Vi))},n.\u0275prov=Yt({token:n,factory:function(t){let i=null;return i=t?new t:function a$(){return new iF(Xe(Vi))}(),i},providedIn:"root"}),n})();typeof window<"u"&&window;try{lA=typeof Intl<"u"&&Intl.v8BreakIterator}catch{lA=!1}let Eb,Pg,cA,lu=(()=>{class n{constructor(t){this._platformId=t,this.isBrowser=this._platformId?function _8(n){return n===OO}(this._platformId):"object"==typeof document&&!!document,this.EDGE=this.isBrowser&&/(edge)/i.test(navigator.userAgent),this.TRIDENT=this.isBrowser&&/(msie|trident)/i.test(navigator.userAgent),this.BLINK=this.isBrowser&&!(!window.chrome&&!lA)&&typeof CSS<"u"&&!this.EDGE&&!this.TRIDENT,this.WEBKIT=this.isBrowser&&/AppleWebKit/i.test(navigator.userAgent)&&!this.BLINK&&!this.EDGE&&!this.TRIDENT,this.IOS=this.isBrowser&&/iPad|iPhone|iPod/.test(navigator.userAgent)&&!("MSStream"in window),this.FIREFOX=this.isBrowser&&/(firefox|minefield)/i.test(navigator.userAgent),this.ANDROID=this.isBrowser&&/android/i.test(navigator.userAgent)&&!this.TRIDENT,this.SAFARI=this.isBrowser&&/safari/i.test(navigator.userAgent)&&this.WEBKIT}}return n.\u0275fac=function(t){return new(t||n)(Xe(LM))},n.\u0275prov=Yt({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();function cv(n){return function m$(){if(null==Eb&&typeof window<"u")try{window.addEventListener("test",null,Object.defineProperty({},"passive",{get:()=>Eb=!0}))}finally{Eb=Eb||!1}return Eb}()?n:!!n.capture}function g$(){if(null==Pg){if("object"!=typeof document||!document||"function"!=typeof Element||!Element)return Pg=!1,Pg;if("scrollBehavior"in document.documentElement.style)Pg=!0;else{const n=Element.prototype.scrollTo;Pg=!!n&&!/\{\s*\[native code\]\s*\}/.test(n.toString())}}return Pg}function Rg(n){return n.composedPath?n.composedPath()[0]:n.target}function uA(){return typeof __karma__<"u"&&!!__karma__||typeof jasmine<"u"&&!!jasmine||typeof jest<"u"&&!!jest||typeof Mocha<"u"&&!!Mocha}class cu extends si{constructor(e){super(),this._value=e}get value(){return this.getValue()}_subscribe(e){const t=super._subscribe(e);return!t.closed&&e.next(this._value),t}getValue(){const{hasError:e,thrownError:t,_value:i}=this;if(e)throw t;return this._throwIfClosed(),i}next(e){super.next(this._value=e)}}function jn(...n){return fs(n,oi(n))}function th(n,...e){return e.length?e.some(t=>n[t]):n.altKey||n.shiftKey||n.ctrlKey||n.metaKey}function bo(n,e,t){const i=sr(n)||e||t?{next:n,error:e,complete:t}:n;return i?Dr((r,s)=>{var c;null===(c=i.subscribe)||void 0===c||c.call(i);let d=!0;r.subscribe(Pr(s,m=>{var y;null===(y=i.next)||void 0===y||y.call(i,m),s.next(m)},()=>{var m;d=!1,null===(m=i.complete)||void 0===m||m.call(i),s.complete()},m=>{var y;d=!1,null===(y=i.error)||void 0===y||y.call(i,m),s.error(m)},()=>{var m,y;d&&(null===(m=i.unsubscribe)||void 0===m||m.call(i)),null===(y=i.finalize)||void 0===y||y.call(i)}))}):Wo}class D$ extends lt{constructor(e,t){super()}schedule(e,t=0){return this}}const lC={setInterval(n,e,...t){const{delegate:i}=lC;return i?.setInterval?i.setInterval(n,e,...t):setInterval(n,e,...t)},clearInterval(n){const{delegate:e}=lC;return(e?.clearInterval||clearInterval)(n)},delegate:void 0};class hA extends D${constructor(e,t){super(e,t),this.scheduler=e,this.work=t,this.pending=!1}schedule(e,t=0){var i;if(this.closed)return this;this.state=e;const r=this.id,s=this.scheduler;return null!=r&&(this.id=this.recycleAsyncId(s,r,t)),this.pending=!0,this.delay=t,this.id=null!==(i=this.id)&&void 0!==i?i:this.requestAsyncId(s,this.id,t),this}requestAsyncId(e,t,i=0){return lC.setInterval(e.flush.bind(e,this),i)}recycleAsyncId(e,t,i=0){if(null!=i&&this.delay===i&&!1===this.pending)return t;null!=t&&lC.clearInterval(t)}execute(e,t){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;const i=this._execute(e,t);if(i)return i;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))}_execute(e,t){let r,i=!1;try{this.work(e)}catch(s){i=!0,r=s||new Error("Scheduled action threw falsy error")}if(i)return this.unsubscribe(),r}unsubscribe(){if(!this.closed){const{id:e,scheduler:t}=this,{actions:i}=t;this.work=this.state=this.scheduler=null,this.pending=!1,g(i,this),null!=e&&(this.id=this.recycleAsyncId(t,e,null)),this.delay=null,super.unsubscribe()}}}const cF={now:()=>(cF.delegate||Date).now(),delegate:void 0};class Ab{constructor(e,t=Ab.now){this.schedulerActionCtor=e,this.now=t}schedule(e,t=0,i){return new this.schedulerActionCtor(this,e).schedule(i,t)}}Ab.now=cF.now;class pA extends Ab{constructor(e,t=Ab.now){super(e,t),this.actions=[],this._active=!1}flush(e){const{actions:t}=this;if(this._active)return void t.push(e);let i;this._active=!0;do{if(i=e.execute(e.state,e.delay))break}while(e=t.shift());if(this._active=!1,i){for(;e=t.shift();)e.unsubscribe();throw i}}}const fA=new pA(hA),A$=fA;function mA(n,e=fA){return Dr((t,i)=>{let r=null,s=null,c=null;const d=()=>{if(r){r.unsubscribe(),r=null;const y=s;s=null,i.next(y)}};function m(){const y=c+n,w=e.now();if(w<y)return r=this.schedule(void 0,y-w),void i.add(r);d()}t.subscribe(Pr(i,y=>{s=y,c=e.now(),r||(r=e.schedule(m,n),i.add(r))},()=>{d(),i.complete()},void 0,()=>{s=r=null}))})}function na(n,e){return Dr((t,i)=>{let r=0;t.subscribe(Pr(i,s=>n.call(e,s,r++)&&i.next(s)))})}function uF(n){return na((e,t)=>n<=t)}function gA(n,e=Wo){return n=n??I$,Dr((t,i)=>{let r,s=!0;t.subscribe(Pr(i,c=>{const d=e(c);(s||!n(r,d))&&(s=!1,r=d,i.next(c))}))})}function I$(n,e){return n===e}function ia(n){return Dr((e,t)=>{ws(n).subscribe(Pr(t,()=>t.complete(),Ja)),!t.closed&&e.subscribe(t)})}function Kr(n){return null!=n&&"false"!=`${n}`}function Jf(n,e=0){return function P$(n){return!isNaN(parseFloat(n))&&!isNaN(Number(n))}(n)?Number(n):e}function cC(n){return Array.isArray(n)?n:[n]}function wo(n){return null==n?"":"string"==typeof n?n:`${n}px`}function kg(n){return n instanceof wr?n.nativeElement:n}let dF=(()=>{class n{create(t){return typeof MutationObserver>"u"?null:new MutationObserver(t)}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=Yt({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),R$=(()=>{class n{constructor(t){this._mutationObserverFactory=t,this._observedElements=new Map}ngOnDestroy(){this._observedElements.forEach((t,i)=>this._cleanupObserver(i))}observe(t){const i=kg(t);return new ci(r=>{const c=this._observeElement(i).subscribe(r);return()=>{c.unsubscribe(),this._unobserveElement(i)}})}_observeElement(t){if(this._observedElements.has(t))this._observedElements.get(t).count++;else{const i=new si,r=this._mutationObserverFactory.create(s=>i.next(s));r&&r.observe(t,{characterData:!0,childList:!0,subtree:!0}),this._observedElements.set(t,{observer:r,stream:i,count:1})}return this._observedElements.get(t).stream}_unobserveElement(t){this._observedElements.has(t)&&(this._observedElements.get(t).count--,this._observedElements.get(t).count||this._cleanupObserver(t))}_cleanupObserver(t){if(this._observedElements.has(t)){const{observer:i,stream:r}=this._observedElements.get(t);i&&i.disconnect(),r.complete(),this._observedElements.delete(t)}}}return n.\u0275fac=function(t){return new(t||n)(Xe(dF))},n.\u0275prov=Yt({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),hF=(()=>{class n{constructor(t,i,r){this._contentObserver=t,this._elementRef=i,this._ngZone=r,this.event=new Dn,this._disabled=!1,this._currentSubscription=null}get disabled(){return this._disabled}set disabled(t){this._disabled=Kr(t),this._disabled?this._unsubscribe():this._subscribe()}get debounce(){return this._debounce}set debounce(t){this._debounce=Jf(t),this._subscribe()}ngAfterContentInit(){!this._currentSubscription&&!this.disabled&&this._subscribe()}ngOnDestroy(){this._unsubscribe()}_subscribe(){this._unsubscribe();const t=this._contentObserver.observe(this._elementRef);this._ngZone.runOutsideAngular(()=>{this._currentSubscription=(this.debounce?t.pipe(mA(this.debounce)):t).subscribe(this.event)})}_unsubscribe(){this._currentSubscription?.unsubscribe()}}return n.\u0275fac=function(t){return new(t||n)(Ie(R$),Ie(wr),Ie(nr))},n.\u0275dir=an({type:n,selectors:[["","cdkObserveContent",""]],inputs:{disabled:["cdkObserveContentDisabled","disabled"],debounce:"debounce"},outputs:{event:"cdkObserveContent"},exportAs:["cdkObserveContent"]}),n})(),_A=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=Gn({type:n}),n.\u0275inj=Bn({providers:[dF]}),n})();const{isArray:k$}=Array,{getPrototypeOf:L$,prototype:O$,keys:F$}=Object;function pF(n){if(1===n.length){const e=n[0];if(k$(e))return{args:e,keys:null};if(function N$(n){return n&&"object"==typeof n&&L$(n)===O$}(e)){const t=F$(e);return{args:t.map(i=>e[i]),keys:t}}}return{args:n,keys:null}}const{isArray:B$}=Array;function yA(n){return ei(e=>function z$(n,e){return B$(e)?n(...e):n(e)}(n,e))}function fF(n,e){return n.reduce((t,i,r)=>(t[i]=e[r],t),{})}function vA(...n){const e=oi(n),t=Vn(n),{args:i,keys:r}=pF(n);if(0===i.length)return fs([],e);const s=new ci(function V$(n,e,t=Wo){return i=>{mF(e,()=>{const{length:r}=n,s=new Array(r);let c=r,d=r;for(let m=0;m<r;m++)mF(e,()=>{const y=fs(n[m],e);let w=!1;y.subscribe(Pr(i,S=>{s[m]=S,w||(w=!0,d--),d||i.next(t(s.slice()))},()=>{--c||i.complete()}))},i)},i)}}(i,e,r?c=>fF(r,c):Wo));return t?s.pipe(yA(t)):s}function mF(n,e,t){n?Be(t,n,e):e()}function uC(...n){return function U$(){return _t(1)}()(fs(n,oi(n)))}function xc(n){return n<=0?()=>Gt:Dr((e,t)=>{let i=0;e.subscribe(Pr(t,r=>{++i<=n&&(t.next(r),n<=i&&t.complete())}))})}function Xl(...n){const e=oi(n);return Dr((t,i)=>{(e?uC(n,t,e):uC(n,t)).subscribe(i)})}const gF=new Set;let hv,H$=(()=>{class n{constructor(t){this._platform=t,this._matchMedia=this._platform.isBrowser&&window.matchMedia?window.matchMedia.bind(window):j$}matchMedia(t){return(this._platform.WEBKIT||this._platform.BLINK)&&function G$(n){if(!gF.has(n))try{hv||(hv=document.createElement("style"),hv.setAttribute("type","text/css"),document.head.appendChild(hv)),hv.sheet&&(hv.sheet.insertRule(`@media ${n} {body{ }}`,0),gF.add(n))}catch(e){console.error(e)}}(t),this._matchMedia(t)}}return n.\u0275fac=function(t){return new(t||n)(Xe(lu))},n.\u0275prov=Yt({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();function j$(n){return{matches:"all"===n||""===n,media:n,addListener:()=>{},removeListener:()=>{}}}let $$=(()=>{class n{constructor(t,i){this._mediaMatcher=t,this._zone=i,this._queries=new Map,this._destroySubject=new si}ngOnDestroy(){this._destroySubject.next(),this._destroySubject.complete()}isMatched(t){return _F(cC(t)).some(r=>this._registerQuery(r).mql.matches)}observe(t){let s=vA(_F(cC(t)).map(c=>this._registerQuery(c).observable));return s=uC(s.pipe(xc(1)),s.pipe(uF(1),mA(0))),s.pipe(ei(c=>{const d={matches:!1,breakpoints:{}};return c.forEach(({matches:m,query:y})=>{d.matches=d.matches||m,d.breakpoints[y]=m}),d}))}_registerQuery(t){if(this._queries.has(t))return this._queries.get(t);const i=this._mediaMatcher.matchMedia(t),s={observable:new ci(c=>{const d=m=>this._zone.run(()=>c.next(m));return i.addListener(d),()=>{i.removeListener(d)}}).pipe(Xl(i),ei(({matches:c})=>({query:t,matches:c})),ia(this._destroySubject)),mql:i};return this._queries.set(t,s),s}}return n.\u0275fac=function(t){return new(t||n)(Xe(H$),Xe(nr))},n.\u0275prov=Yt({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();function _F(n){return n.map(e=>e.split(",")).reduce((e,t)=>e.concat(t)).map(e=>e.trim())}class xF{constructor(e){this._items=e,this._activeItemIndex=-1,this._activeItem=null,this._wrap=!1,this._letterKeyStream=new si,this._typeaheadSubscription=lt.EMPTY,this._vertical=!0,this._allowedModifierKeys=[],this._homeAndEnd=!1,this._skipPredicateFn=t=>t.disabled,this._pressedLetters=[],this.tabOut=new si,this.change=new si,e instanceof iv&&e.changes.subscribe(t=>{if(this._activeItem){const r=t.toArray().indexOf(this._activeItem);r>-1&&r!==this._activeItemIndex&&(this._activeItemIndex=r)}})}skipPredicate(e){return this._skipPredicateFn=e,this}withWrap(e=!0){return this._wrap=e,this}withVerticalOrientation(e=!0){return this._vertical=e,this}withHorizontalOrientation(e){return this._horizontal=e,this}withAllowedModifierKeys(e){return this._allowedModifierKeys=e,this}withTypeAhead(e=200){return this._typeaheadSubscription.unsubscribe(),this._typeaheadSubscription=this._letterKeyStream.pipe(bo(t=>this._pressedLetters.push(t)),mA(e),na(()=>this._pressedLetters.length>0),ei(()=>this._pressedLetters.join(""))).subscribe(t=>{const i=this._getItemsArray();for(let r=1;r<i.length+1;r++){const s=(this._activeItemIndex+r)%i.length,c=i[s];if(!this._skipPredicateFn(c)&&0===c.getLabel().toUpperCase().trim().indexOf(t)){this.setActiveItem(s);break}}this._pressedLetters=[]}),this}withHomeAndEnd(e=!0){return this._homeAndEnd=e,this}setActiveItem(e){const t=this._activeItem;this.updateActiveItem(e),this._activeItem!==t&&this.change.next(this._activeItemIndex)}onKeydown(e){const t=e.keyCode,r=["altKey","ctrlKey","metaKey","shiftKey"].every(s=>!e[s]||this._allowedModifierKeys.indexOf(s)>-1);switch(t){case 9:return void this.tabOut.next();case 40:if(this._vertical&&r){this.setNextItemActive();break}return;case 38:if(this._vertical&&r){this.setPreviousItemActive();break}return;case 39:if(this._horizontal&&r){"rtl"===this._horizontal?this.setPreviousItemActive():this.setNextItemActive();break}return;case 37:if(this._horizontal&&r){"rtl"===this._horizontal?this.setNextItemActive():this.setPreviousItemActive();break}return;case 36:if(this._homeAndEnd&&r){this.setFirstItemActive();break}return;case 35:if(this._homeAndEnd&&r){this.setLastItemActive();break}return;default:return void((r||th(e,"shiftKey"))&&(e.key&&1===e.key.length?this._letterKeyStream.next(e.key.toLocaleUpperCase()):(t>=65&&t<=90||t>=48&&t<=57)&&this._letterKeyStream.next(String.fromCharCode(t))))}this._pressedLetters=[],e.preventDefault()}get activeItemIndex(){return this._activeItemIndex}get activeItem(){return this._activeItem}isTyping(){return this._pressedLetters.length>0}setFirstItemActive(){this._setActiveItemByIndex(0,1)}setLastItemActive(){this._setActiveItemByIndex(this._items.length-1,-1)}setNextItemActive(){this._activeItemIndex<0?this.setFirstItemActive():this._setActiveItemByDelta(1)}setPreviousItemActive(){this._activeItemIndex<0&&this._wrap?this.setLastItemActive():this._setActiveItemByDelta(-1)}updateActiveItem(e){const t=this._getItemsArray(),i="number"==typeof e?e:t.indexOf(e);this._activeItem=t[i]??null,this._activeItemIndex=i}_setActiveItemByDelta(e){this._wrap?this._setActiveInWrapMode(e):this._setActiveInDefaultMode(e)}_setActiveInWrapMode(e){const t=this._getItemsArray();for(let i=1;i<=t.length;i++){const r=(this._activeItemIndex+e*i+t.length)%t.length;if(!this._skipPredicateFn(t[r]))return void this.setActiveItem(r)}}_setActiveInDefaultMode(e){this._setActiveItemByIndex(this._activeItemIndex+e,e)}_setActiveItemByIndex(e,t){const i=this._getItemsArray();if(i[e]){for(;this._skipPredicateFn(i[e]);)if(!i[e+=t])return;this.setActiveItem(e)}}_getItemsArray(){return this._items instanceof iv?this._items.toArray():this._items}}class Z$ extends xF{setActiveItem(e){this.activeItem&&this.activeItem.setInactiveStyles(),super.setActiveItem(e),this.activeItem&&this.activeItem.setActiveStyles()}}class bF extends xF{constructor(){super(...arguments),this._origin="program"}setFocusOrigin(e){return this._origin=e,this}setActiveItem(e){super.setActiveItem(e),this.activeItem&&this.activeItem.focus(this._origin)}}function MF(n){return 0===n.buttons||0===n.offsetX&&0===n.offsetY}function CF(n){const e=n.touches&&n.touches[0]||n.changedTouches&&n.changedTouches[0];return!(!e||-1!==e.identifier||null!=e.radiusX&&1!==e.radiusX||null!=e.radiusY&&1!==e.radiusY)}const eW=new Vt("cdk-input-modality-detector-options"),tW={ignoreKeys:[18,17,224,91,16]},pv=cv({passive:!0,capture:!0});let nW=(()=>{class n{constructor(t,i,r,s){this._platform=t,this._mostRecentTarget=null,this._modality=new cu(null),this._lastTouchMs=0,this._onKeydown=c=>{this._options?.ignoreKeys?.some(d=>d===c.keyCode)||(this._modality.next("keyboard"),this._mostRecentTarget=Rg(c))},this._onMousedown=c=>{Date.now()-this._lastTouchMs<650||(this._modality.next(MF(c)?"keyboard":"mouse"),this._mostRecentTarget=Rg(c))},this._onTouchstart=c=>{CF(c)?this._modality.next("keyboard"):(this._lastTouchMs=Date.now(),this._modality.next("touch"),this._mostRecentTarget=Rg(c))},this._options={...tW,...s},this.modalityDetected=this._modality.pipe(uF(1)),this.modalityChanged=this.modalityDetected.pipe(gA()),t.isBrowser&&i.runOutsideAngular(()=>{r.addEventListener("keydown",this._onKeydown,pv),r.addEventListener("mousedown",this._onMousedown,pv),r.addEventListener("touchstart",this._onTouchstart,pv)})}get mostRecentModality(){return this._modality.value}ngOnDestroy(){this._modality.complete(),this._platform.isBrowser&&(document.removeEventListener("keydown",this._onKeydown,pv),document.removeEventListener("mousedown",this._onMousedown,pv),document.removeEventListener("touchstart",this._onTouchstart,pv))}}return n.\u0275fac=function(t){return new(t||n)(Xe(lu),Xe(nr),Xe(Vi),Xe(eW,8))},n.\u0275prov=Yt({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();const iW=new Vt("liveAnnouncerElement",{providedIn:"root",factory:function rW(){return null}}),sW=new Vt("LIVE_ANNOUNCER_DEFAULT_OPTIONS");let oW=(()=>{class n{constructor(t,i,r,s){this._ngZone=i,this._defaultOptions=s,this._document=r,this._liveElement=t||this._createLiveElement()}announce(t,...i){const r=this._defaultOptions;let s,c;return 1===i.length&&"number"==typeof i[0]?c=i[0]:[s,c]=i,this.clear(),clearTimeout(this._previousTimeout),s||(s=r&&r.politeness?r.politeness:"polite"),null==c&&r&&(c=r.duration),this._liveElement.setAttribute("aria-live",s),this._ngZone.runOutsideAngular(()=>(this._currentPromise||(this._currentPromise=new Promise(d=>this._currentResolve=d)),clearTimeout(this._previousTimeout),this._previousTimeout=setTimeout(()=>{this._liveElement.textContent=t,"number"==typeof c&&(this._previousTimeout=setTimeout(()=>this.clear(),c)),this._currentResolve(),this._currentPromise=this._currentResolve=void 0},100),this._currentPromise))}clear(){this._liveElement&&(this._liveElement.textContent="")}ngOnDestroy(){clearTimeout(this._previousTimeout),this._liveElement?.remove(),this._liveElement=null,this._currentResolve?.(),this._currentPromise=this._currentResolve=void 0}_createLiveElement(){const t="cdk-live-announcer-element",i=this._document.getElementsByClassName(t),r=this._document.createElement("div");for(let s=0;s<i.length;s++)i[s].remove();return r.classList.add(t),r.classList.add("cdk-visually-hidden"),r.setAttribute("aria-atomic","true"),r.setAttribute("aria-live","polite"),this._document.body.appendChild(r),r}}return n.\u0275fac=function(t){return new(t||n)(Xe(iW,8),Xe(nr),Xe(Vi),Xe(sW,8))},n.\u0275prov=Yt({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();const aW=new Vt("cdk-focus-monitor-default-options"),dC=cv({passive:!0,capture:!0});let fv=(()=>{class n{constructor(t,i,r,s,c){this._ngZone=t,this._platform=i,this._inputModalityDetector=r,this._origin=null,this._windowFocused=!1,this._originFromTouchInteraction=!1,this._elementInfo=new Map,this._monitoredElementCount=0,this._rootNodeFocusListenerCount=new Map,this._windowFocusListener=()=>{this._windowFocused=!0,this._windowFocusTimeoutId=window.setTimeout(()=>this._windowFocused=!1)},this._stopInputModalityDetector=new si,this._rootNodeFocusAndBlurListener=d=>{for(let y=Rg(d);y;y=y.parentElement)"focus"===d.type?this._onFocus(d,y):this._onBlur(d,y)},this._document=s,this._detectionMode=c?.detectionMode||0}monitor(t,i=!1){const r=kg(t);if(!this._platform.isBrowser||1!==r.nodeType)return jn(null);const s=function y$(n){if(function _$(){if(null==cA){const n=typeof document<"u"?document.head:null;cA=!(!n||!n.createShadowRoot&&!n.attachShadow)}return cA}()){const e=n.getRootNode?n.getRootNode():null;if(typeof ShadowRoot<"u"&&ShadowRoot&&e instanceof ShadowRoot)return e}return null}(r)||this._getDocument(),c=this._elementInfo.get(r);if(c)return i&&(c.checkChildren=!0),c.subject;const d={checkChildren:i,subject:new si,rootNode:s};return this._elementInfo.set(r,d),this._registerGlobalListeners(d),d.subject}stopMonitoring(t){const i=kg(t),r=this._elementInfo.get(i);r&&(r.subject.complete(),this._setClasses(i),this._elementInfo.delete(i),this._removeGlobalListeners(r))}focusVia(t,i,r){const s=kg(t);s===this._getDocument().activeElement?this._getClosestElementsInfo(s).forEach(([d,m])=>this._originChanged(d,i,m)):(this._setOrigin(i),"function"==typeof s.focus&&s.focus(r))}ngOnDestroy(){this._elementInfo.forEach((t,i)=>this.stopMonitoring(i))}_getDocument(){return this._document||document}_getWindow(){return this._getDocument().defaultView||window}_getFocusOrigin(t){return this._origin?this._originFromTouchInteraction?this._shouldBeAttributedToTouch(t)?"touch":"program":this._origin:this._windowFocused&&this._lastFocusOrigin?this._lastFocusOrigin:t&&this._isLastInteractionFromInputLabel(t)?"mouse":"program"}_shouldBeAttributedToTouch(t){return 1===this._detectionMode||!!t?.contains(this._inputModalityDetector._mostRecentTarget)}_setClasses(t,i){t.classList.toggle("cdk-focused",!!i),t.classList.toggle("cdk-touch-focused","touch"===i),t.classList.toggle("cdk-keyboard-focused","keyboard"===i),t.classList.toggle("cdk-mouse-focused","mouse"===i),t.classList.toggle("cdk-program-focused","program"===i)}_setOrigin(t,i=!1){this._ngZone.runOutsideAngular(()=>{this._origin=t,this._originFromTouchInteraction="touch"===t&&i,0===this._detectionMode&&(clearTimeout(this._originTimeoutId),this._originTimeoutId=setTimeout(()=>this._origin=null,this._originFromTouchInteraction?650:1))})}_onFocus(t,i){const r=this._elementInfo.get(i),s=Rg(t);!r||!r.checkChildren&&i!==s||this._originChanged(i,this._getFocusOrigin(s),r)}_onBlur(t,i){const r=this._elementInfo.get(i);!r||r.checkChildren&&t.relatedTarget instanceof Node&&i.contains(t.relatedTarget)||(this._setClasses(i),this._emitOrigin(r,null))}_emitOrigin(t,i){t.subject.observers.length&&this._ngZone.run(()=>t.subject.next(i))}_registerGlobalListeners(t){if(!this._platform.isBrowser)return;const i=t.rootNode,r=this._rootNodeFocusListenerCount.get(i)||0;r||this._ngZone.runOutsideAngular(()=>{i.addEventListener("focus",this._rootNodeFocusAndBlurListener,dC),i.addEventListener("blur",this._rootNodeFocusAndBlurListener,dC)}),this._rootNodeFocusListenerCount.set(i,r+1),1==++this._monitoredElementCount&&(this._ngZone.runOutsideAngular(()=>{this._getWindow().addEventListener("focus",this._windowFocusListener)}),this._inputModalityDetector.modalityDetected.pipe(ia(this._stopInputModalityDetector)).subscribe(s=>{this._setOrigin(s,!0)}))}_removeGlobalListeners(t){const i=t.rootNode;if(this._rootNodeFocusListenerCount.has(i)){const r=this._rootNodeFocusListenerCount.get(i);r>1?this._rootNodeFocusListenerCount.set(i,r-1):(i.removeEventListener("focus",this._rootNodeFocusAndBlurListener,dC),i.removeEventListener("blur",this._rootNodeFocusAndBlurListener,dC),this._rootNodeFocusListenerCount.delete(i))}--this._monitoredElementCount||(this._getWindow().removeEventListener("focus",this._windowFocusListener),this._stopInputModalityDetector.next(),clearTimeout(this._windowFocusTimeoutId),clearTimeout(this._originTimeoutId))}_originChanged(t,i,r){this._setClasses(t,i),this._emitOrigin(r,i),this._lastFocusOrigin=i}_getClosestElementsInfo(t){const i=[];return this._elementInfo.forEach((r,s)=>{(s===t||r.checkChildren&&s.contains(t))&&i.push([s,r])}),i}_isLastInteractionFromInputLabel(t){const{_mostRecentTarget:i,mostRecentModality:r}=this._inputModalityDetector;if("mouse"!==r||!i||i===t||"INPUT"!==t.nodeName&&"TEXTAREA"!==t.nodeName||t.disabled)return!1;const s=t.labels;if(s)for(let c=0;c<s.length;c++)if(s[c].contains(i))return!0;return!1}}return n.\u0275fac=function(t){return new(t||n)(Xe(nr),Xe(lu),Xe(nW),Xe(Vi,8),Xe(aW,8))},n.\u0275prov=Yt({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),lW=(()=>{class n{constructor(t,i){this._elementRef=t,this._focusMonitor=i,this._focusOrigin=null,this.cdkFocusChange=new Dn}get focusOrigin(){return this._focusOrigin}ngAfterViewInit(){const t=this._elementRef.nativeElement;this._monitorSubscription=this._focusMonitor.monitor(t,1===t.nodeType&&t.hasAttribute("cdkMonitorSubtreeFocus")).subscribe(i=>{this._focusOrigin=i,this.cdkFocusChange.emit(i)})}ngOnDestroy(){this._focusMonitor.stopMonitoring(this._elementRef),this._monitorSubscription&&this._monitorSubscription.unsubscribe()}}return n.\u0275fac=function(t){return new(t||n)(Ie(wr),Ie(fv))},n.\u0275dir=an({type:n,selectors:[["","cdkMonitorElementFocus",""],["","cdkMonitorSubtreeFocus",""]],outputs:{cdkFocusChange:"cdkFocusChange"},exportAs:["cdkMonitorFocus"]}),n})();const EF="cdk-high-contrast-black-on-white",TF="cdk-high-contrast-white-on-black",xA="cdk-high-contrast-active";let DF=(()=>{class n{constructor(t,i){this._platform=t,this._document=i,this._breakpointSubscription=xr($$).observe("(forced-colors: active)").subscribe(()=>{this._hasCheckedHighContrastMode&&(this._hasCheckedHighContrastMode=!1,this._applyBodyHighContrastModeCssClasses())})}getHighContrastMode(){if(!this._platform.isBrowser)return 0;const t=this._document.createElement("div");t.style.backgroundColor="rgb(1,2,3)",t.style.position="absolute",this._document.body.appendChild(t);const i=this._document.defaultView||window,r=i&&i.getComputedStyle?i.getComputedStyle(t):null,s=(r&&r.backgroundColor||"").replace(/ /g,"");switch(t.remove(),s){case"rgb(0,0,0)":case"rgb(45,50,54)":case"rgb(32,32,32)":return 2;case"rgb(255,255,255)":case"rgb(255,250,239)":return 1}return 0}ngOnDestroy(){this._breakpointSubscription.unsubscribe()}_applyBodyHighContrastModeCssClasses(){if(!this._hasCheckedHighContrastMode&&this._platform.isBrowser&&this._document.body){const t=this._document.body.classList;t.remove(xA,EF,TF),this._hasCheckedHighContrastMode=!0;const i=this.getHighContrastMode();1===i?t.add(xA,EF):2===i&&t.add(xA,TF)}}}return n.\u0275fac=function(t){return new(t||n)(Xe(lu),Xe(Vi))},n.\u0275prov=Yt({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),AF=(()=>{class n{constructor(t){t._applyBodyHighContrastModeCssClasses()}}return n.\u0275fac=function(t){return new(t||n)(Xe(DF))},n.\u0275mod=Gn({type:n}),n.\u0275inj=Bn({imports:[_A]}),n})();const cW=new Vt("cdk-dir-doc",{providedIn:"root",factory:function uW(){return xr(Vi)}}),dW=/^(ar|ckb|dv|he|iw|fa|nqo|ps|sd|ug|ur|yi|.*[-_](Adlm|Arab|Hebr|Nkoo|Rohg|Thaa))(?!.*[-_](Latn|Cyrl)($|-|_))($|-|_)/i;let em=(()=>{class n{constructor(t){if(this.value="ltr",this.change=new Dn,t){const r=t.documentElement?t.documentElement.dir:null;this.value=function hW(n){const e=n?.toLowerCase()||"";return"auto"===e&&typeof navigator<"u"&&navigator?.language?dW.test(navigator.language)?"rtl":"ltr":"rtl"===e?"rtl":"ltr"}((t.body?t.body.dir:null)||r||"ltr")}}ngOnDestroy(){this.change.complete()}}return n.\u0275fac=function(t){return new(t||n)(Xe(cW,8))},n.\u0275prov=Yt({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),mv=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=Gn({type:n}),n.\u0275inj=Bn({}),n})();function pW(n,e){if(1&n&&jt(0,"mat-pseudo-checkbox",4),2&n){const t=ki();Kt("state",t.selected?"checked":"unchecked")("disabled",t.disabled)}}function fW(n,e){if(1&n&&(Ae(0,"span",5),it(1),xe()),2&n){const t=ki();Et(1),Vo("(",t.group.label,")")}}const mW=["*"],_W=new Vt("mat-sanity-checks",{providedIn:"root",factory:function gW(){return!0}});let Ki=(()=>{class n{constructor(t,i,r){this._sanityChecks=i,this._document=r,this._hasDoneGlobalChecks=!1,t._applyBodyHighContrastModeCssClasses(),this._hasDoneGlobalChecks||(this._hasDoneGlobalChecks=!0)}_checkIsEnabled(t){return!uA()&&("boolean"==typeof this._sanityChecks?this._sanityChecks:!!this._sanityChecks[t])}}return n.\u0275fac=function(t){return new(t||n)(Xe(DF),Xe(_W,8),Xe(Vi))},n.\u0275mod=Gn({type:n}),n.\u0275inj=Bn({imports:[mv,mv]}),n})();function hC(n){return class extends n{constructor(...e){super(...e),this._disabled=!1}get disabled(){return this._disabled}set disabled(e){this._disabled=Kr(e)}}}function pC(n,e){return class extends n{constructor(...t){super(...t),this.defaultColor=e,this.color=e}get color(){return this._color}set color(t){const i=t||this.defaultColor;i!==this._color&&(this._color&&this._elementRef.nativeElement.classList.remove(`mat-${this._color}`),i&&this._elementRef.nativeElement.classList.add(`mat-${i}`),this._color=i)}}}function Ib(n){return class extends n{constructor(...e){super(...e),this._disableRipple=!1}get disableRipple(){return this._disableRipple}set disableRipple(e){this._disableRipple=Kr(e)}}}function fC(n,e=0){return class extends n{constructor(...t){super(...t),this._tabIndex=e,this.defaultTabIndex=e}get tabIndex(){return this.disabled?-1:this._tabIndex}set tabIndex(t){this._tabIndex=null!=t?Jf(t):this.defaultTabIndex}}}function yW(n){return class extends n{constructor(...e){super(...e),this.errorState=!1}updateErrorState(){const e=this.errorState,s=(this.errorStateMatcher||this._defaultErrorStateMatcher).isErrorState(this.ngControl?this.ngControl.control:null,this._parentFormGroup||this._parentForm);s!==e&&(this.errorState=s,this.stateChanges.next())}}}const vW=new Vt("MAT_DATE_LOCALE",{providedIn:"root",factory:function xW(){return xr(Jd)}});class yl{constructor(){this._localeChanges=new si,this.localeChanges=this._localeChanges}getValidDateOrNull(e){return this.isDateInstance(e)&&this.isValid(e)?e:null}deserialize(e){return null==e||this.isDateInstance(e)&&this.isValid(e)?e:this.invalid()}setLocale(e){this.locale=e,this._localeChanges.next()}compareDate(e,t){return this.getYear(e)-this.getYear(t)||this.getMonth(e)-this.getMonth(t)||this.getDate(e)-this.getDate(t)}sameDate(e,t){if(e&&t){let i=this.isValid(e),r=this.isValid(t);return i&&r?!this.compareDate(e,t):i==r}return e==t}clampDate(e,t,i){return t&&this.compareDate(e,t)<0?t:i&&this.compareDate(e,i)>0?i:e}}const Lg=new Vt("mat-date-formats"),bW=/^\d{4}-\d{2}-\d{2}(?:T\d{2}:\d{2}:\d{2}(?:\.\d+)?(?:Z|(?:(?:\+|-)\d{2}:\d{2}))?)?$/;function bA(n,e){const t=Array(n);for(let i=0;i<n;i++)t[i]=e(i);return t}let wW=(()=>{class n extends yl{constructor(t,i){super(),this.useUtcForDisplay=!1,super.setLocale(t)}getYear(t){return t.getFullYear()}getMonth(t){return t.getMonth()}getDate(t){return t.getDate()}getDayOfWeek(t){return t.getDay()}getMonthNames(t){const i=new Intl.DateTimeFormat(this.locale,{month:t,timeZone:"utc"});return bA(12,r=>this._format(i,new Date(2017,r,1)))}getDateNames(){const t=new Intl.DateTimeFormat(this.locale,{day:"numeric",timeZone:"utc"});return bA(31,i=>this._format(t,new Date(2017,0,i+1)))}getDayOfWeekNames(t){const i=new Intl.DateTimeFormat(this.locale,{weekday:t,timeZone:"utc"});return bA(7,r=>this._format(i,new Date(2017,0,r+1)))}getYearName(t){const i=new Intl.DateTimeFormat(this.locale,{year:"numeric",timeZone:"utc"});return this._format(i,t)}getFirstDayOfWeek(){return 0}getNumDaysInMonth(t){return this.getDate(this._createDateWithOverflow(this.getYear(t),this.getMonth(t)+1,0))}clone(t){return new Date(t.getTime())}createDate(t,i,r){let s=this._createDateWithOverflow(t,i,r);return s.getMonth(),s}today(){return new Date}parse(t,i){return"number"==typeof t?new Date(t):t?new Date(Date.parse(t)):null}format(t,i){if(!this.isValid(t))throw Error("NativeDateAdapter: Cannot format invalid date.");const r=new Intl.DateTimeFormat(this.locale,{...i,timeZone:"utc"});return this._format(r,t)}addCalendarYears(t,i){return this.addCalendarMonths(t,12*i)}addCalendarMonths(t,i){let r=this._createDateWithOverflow(this.getYear(t),this.getMonth(t)+i,this.getDate(t));return this.getMonth(r)!=((this.getMonth(t)+i)%12+12)%12&&(r=this._createDateWithOverflow(this.getYear(r),this.getMonth(r),0)),r}addCalendarDays(t,i){return this._createDateWithOverflow(this.getYear(t),this.getMonth(t),this.getDate(t)+i)}toIso8601(t){return[t.getUTCFullYear(),this._2digit(t.getUTCMonth()+1),this._2digit(t.getUTCDate())].join("-")}deserialize(t){if("string"==typeof t){if(!t)return null;if(bW.test(t)){let i=new Date(t);if(this.isValid(i))return i}}return super.deserialize(t)}isDateInstance(t){return t instanceof Date}isValid(t){return!isNaN(t.getTime())}invalid(){return new Date(NaN)}_createDateWithOverflow(t,i,r){const s=new Date;return s.setFullYear(t,i,r),s.setHours(0,0,0,0),s}_2digit(t){return("00"+t).slice(-2)}_format(t,i){const r=new Date;return r.setUTCFullYear(i.getFullYear(),i.getMonth(),i.getDate()),r.setUTCHours(i.getHours(),i.getMinutes(),i.getSeconds(),i.getMilliseconds()),t.format(r)}}return n.\u0275fac=function(t){return new(t||n)(Xe(vW,8),Xe(lu))},n.\u0275prov=Yt({token:n,factory:n.\u0275fac}),n})();const MW={parse:{dateInput:null},display:{dateInput:{year:"numeric",month:"numeric",day:"numeric"},monthYearLabel:{year:"numeric",month:"short"},dateA11yLabel:{year:"numeric",month:"long",day:"numeric"},monthYearA11yLabel:{year:"numeric",month:"long"}}};let CW=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=Gn({type:n}),n.\u0275inj=Bn({providers:[{provide:yl,useClass:wW}]}),n})(),SW=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=Gn({type:n}),n.\u0275inj=Bn({providers:[{provide:Lg,useValue:MW}],imports:[CW]}),n})(),wA=(()=>{class n{isErrorState(t,i){return!!(t&&t.invalid&&(t.touched||i&&i.submitted))}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=Yt({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),mC=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=Gn({type:n}),n.\u0275inj=Bn({imports:[Ki,Ki]}),n})();class DW{constructor(e,t,i,r=!1){this._renderer=e,this.element=t,this.config=i,this._animationForciblyDisabledThroughCss=r,this.state=3}fadeOut(){this._renderer.fadeOutRipple(this)}}const RF={enterDuration:225,exitDuration:150},MA=cv({passive:!0}),kF=["mousedown","touchstart"],LF=["mouseup","mouseleave","touchend","touchcancel"];class IW{constructor(e,t,i,r){this._target=e,this._ngZone=t,this._isPointerDown=!1,this._activeRipples=new Map,this._pointerUpEventsRegistered=!1,r.isBrowser&&(this._containerElement=kg(i))}fadeInRipple(e,t,i={}){const r=this._containerRect=this._containerRect||this._containerElement.getBoundingClientRect(),s={...RF,...i.animation};i.centered&&(e=r.left+r.width/2,t=r.top+r.height/2);const c=i.radius||function PW(n,e,t){const i=Math.max(Math.abs(n-t.left),Math.abs(n-t.right)),r=Math.max(Math.abs(e-t.top),Math.abs(e-t.bottom));return Math.sqrt(i*i+r*r)}(e,t,r),d=e-r.left,m=t-r.top,y=s.enterDuration,w=document.createElement("div");w.classList.add("mat-ripple-element"),w.style.left=d-c+"px",w.style.top=m-c+"px",w.style.height=2*c+"px",w.style.width=2*c+"px",null!=i.color&&(w.style.backgroundColor=i.color),w.style.transitionDuration=`${y}ms`,this._containerElement.appendChild(w);const S=window.getComputedStyle(w),I=S.transitionDuration,R="none"===S.transitionProperty||"0s"===I||"0s, 0s"===I,k=new DW(this,w,i,R);w.style.transform="scale3d(1, 1, 1)",k.state=0,i.persistent||(this._mostRecentTransientRipple=k);let F=null;return!R&&(y||s.exitDuration)&&this._ngZone.runOutsideAngular(()=>{const G=()=>this._finishRippleTransition(k),W=()=>this._destroyRipple(k);w.addEventListener("transitionend",G),w.addEventListener("transitioncancel",W),F={onTransitionEnd:G,onTransitionCancel:W}}),this._activeRipples.set(k,F),(R||!y)&&this._finishRippleTransition(k),k}fadeOutRipple(e){if(2===e.state||3===e.state)return;const t=e.element,i={...RF,...e.config.animation};t.style.transitionDuration=`${i.exitDuration}ms`,t.style.opacity="0",e.state=2,(e._animationForciblyDisabledThroughCss||!i.exitDuration)&&this._finishRippleTransition(e)}fadeOutAll(){this._getActiveRipples().forEach(e=>e.fadeOut())}fadeOutAllNonPersistent(){this._getActiveRipples().forEach(e=>{e.config.persistent||e.fadeOut()})}setupTriggerEvents(e){const t=kg(e);!t||t===this._triggerElement||(this._removeTriggerEvents(),this._triggerElement=t,this._registerEvents(kF))}handleEvent(e){"mousedown"===e.type?this._onMousedown(e):"touchstart"===e.type?this._onTouchStart(e):this._onPointerUp(),this._pointerUpEventsRegistered||(this._registerEvents(LF),this._pointerUpEventsRegistered=!0)}_finishRippleTransition(e){0===e.state?this._startFadeOutTransition(e):2===e.state&&this._destroyRipple(e)}_startFadeOutTransition(e){const t=e===this._mostRecentTransientRipple,{persistent:i}=e.config;e.state=1,!i&&(!t||!this._isPointerDown)&&e.fadeOut()}_destroyRipple(e){const t=this._activeRipples.get(e)??null;this._activeRipples.delete(e),this._activeRipples.size||(this._containerRect=null),e===this._mostRecentTransientRipple&&(this._mostRecentTransientRipple=null),e.state=3,null!==t&&(e.element.removeEventListener("transitionend",t.onTransitionEnd),e.element.removeEventListener("transitioncancel",t.onTransitionCancel)),e.element.remove()}_onMousedown(e){const t=MF(e),i=this._lastTouchStartEvent&&Date.now()<this._lastTouchStartEvent+800;!this._target.rippleDisabled&&!t&&!i&&(this._isPointerDown=!0,this.fadeInRipple(e.clientX,e.clientY,this._target.rippleConfig))}_onTouchStart(e){if(!this._target.rippleDisabled&&!CF(e)){this._lastTouchStartEvent=Date.now(),this._isPointerDown=!0;const t=e.changedTouches;for(let i=0;i<t.length;i++)this.fadeInRipple(t[i].clientX,t[i].clientY,this._target.rippleConfig)}}_onPointerUp(){!this._isPointerDown||(this._isPointerDown=!1,this._getActiveRipples().forEach(e=>{!e.config.persistent&&(1===e.state||e.config.terminateOnPointerUp&&0===e.state)&&e.fadeOut()}))}_registerEvents(e){this._ngZone.runOutsideAngular(()=>{e.forEach(t=>{this._triggerElement.addEventListener(t,this,MA)})})}_getActiveRipples(){return Array.from(this._activeRipples.keys())}_removeTriggerEvents(){this._triggerElement&&(kF.forEach(e=>{this._triggerElement.removeEventListener(e,this,MA)}),this._pointerUpEventsRegistered&&LF.forEach(e=>{this._triggerElement.removeEventListener(e,this,MA)}))}}const RW=new Vt("mat-ripple-global-options");let Rb=(()=>{class n{constructor(t,i,r,s,c){this._elementRef=t,this._animationMode=c,this.radius=0,this._disabled=!1,this._isInitialized=!1,this._globalOptions=s||{},this._rippleRenderer=new IW(this,i,t,r)}get disabled(){return this._disabled}set disabled(t){t&&this.fadeOutAllNonPersistent(),this._disabled=t,this._setupTriggerEventsIfEnabled()}get trigger(){return this._trigger||this._elementRef.nativeElement}set trigger(t){this._trigger=t,this._setupTriggerEventsIfEnabled()}ngOnInit(){this._isInitialized=!0,this._setupTriggerEventsIfEnabled()}ngOnDestroy(){this._rippleRenderer._removeTriggerEvents()}fadeOutAll(){this._rippleRenderer.fadeOutAll()}fadeOutAllNonPersistent(){this._rippleRenderer.fadeOutAllNonPersistent()}get rippleConfig(){return{centered:this.centered,radius:this.radius,color:this.color,animation:{...this._globalOptions.animation,..."NoopAnimations"===this._animationMode?{enterDuration:0,exitDuration:0}:{},...this.animation},terminateOnPointerUp:this._globalOptions.terminateOnPointerUp}}get rippleDisabled(){return this.disabled||!!this._globalOptions.disabled}_setupTriggerEventsIfEnabled(){!this.disabled&&this._isInitialized&&this._rippleRenderer.setupTriggerEvents(this.trigger)}launch(t,i=0,r){return"number"==typeof t?this._rippleRenderer.fadeInRipple(t,i,{...this.rippleConfig,...r}):this._rippleRenderer.fadeInRipple(0,0,{...this.rippleConfig,...t})}}return n.\u0275fac=function(t){return new(t||n)(Ie(wr),Ie(nr),Ie(lu),Ie(RW,8),Ie(ru,8))},n.\u0275dir=an({type:n,selectors:[["","mat-ripple",""],["","matRipple",""]],hostAttrs:[1,"mat-ripple"],hostVars:2,hostBindings:function(t,i){2&t&&ds("mat-ripple-unbounded",i.unbounded)},inputs:{color:["matRippleColor","color"],unbounded:["matRippleUnbounded","unbounded"],centered:["matRippleCentered","centered"],radius:["matRippleRadius","radius"],animation:["matRippleAnimation","animation"],disabled:["matRippleDisabled","disabled"],trigger:["matRippleTrigger","trigger"]},exportAs:["matRipple"]}),n})(),kb=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=Gn({type:n}),n.\u0275inj=Bn({imports:[Ki,Ki]}),n})(),OF=(()=>{class n{constructor(t){this._animationMode=t,this.state="unchecked",this.disabled=!1}}return n.\u0275fac=function(t){return new(t||n)(Ie(ru,8))},n.\u0275cmp=Qn({type:n,selectors:[["mat-pseudo-checkbox"]],hostAttrs:[1,"mat-pseudo-checkbox"],hostVars:8,hostBindings:function(t,i){2&t&&ds("mat-pseudo-checkbox-indeterminate","indeterminate"===i.state)("mat-pseudo-checkbox-checked","checked"===i.state)("mat-pseudo-checkbox-disabled",i.disabled)("_mat-animation-noopable","NoopAnimations"===i._animationMode)},inputs:{state:"state",disabled:"disabled"},decls:0,vars:0,template:function(t,i){},styles:['.mat-pseudo-checkbox{width:16px;height:16px;border:2px solid;border-radius:2px;cursor:pointer;display:inline-block;vertical-align:middle;box-sizing:border-box;position:relative;flex-shrink:0;transition:border-color 90ms cubic-bezier(0, 0, 0.2, 0.1),background-color 90ms cubic-bezier(0, 0, 0.2, 0.1)}.mat-pseudo-checkbox::after{position:absolute;opacity:0;content:"";border-bottom:2px solid currentColor;transition:opacity 90ms cubic-bezier(0, 0, 0.2, 0.1)}.mat-pseudo-checkbox.mat-pseudo-checkbox-checked,.mat-pseudo-checkbox.mat-pseudo-checkbox-indeterminate{border-color:rgba(0,0,0,0)}.mat-pseudo-checkbox._mat-animation-noopable{transition:none !important;animation:none !important}.mat-pseudo-checkbox._mat-animation-noopable::after{transition:none}.mat-pseudo-checkbox-disabled{cursor:default}.mat-pseudo-checkbox-indeterminate::after{top:5px;left:1px;width:10px;opacity:1;border-radius:2px}.mat-pseudo-checkbox-checked::after{top:2.4px;left:1px;width:8px;height:3px;border-left:2px solid currentColor;transform:rotate(-45deg);opacity:1;box-sizing:content-box}'],encapsulation:2,changeDetection:0}),n})(),CA=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=Gn({type:n}),n.\u0275inj=Bn({imports:[Ki]}),n})();const FF=new Vt("MAT_OPTION_PARENT_COMPONENT"),NF=new Vt("MatOptgroup");let kW=0;class LW{constructor(e,t=!1){this.source=e,this.isUserInput=t}}let OW=(()=>{class n{constructor(t,i,r,s){this._element=t,this._changeDetectorRef=i,this._parent=r,this.group=s,this._selected=!1,this._active=!1,this._disabled=!1,this._mostRecentViewValue="",this.id="mat-option-"+kW++,this.onSelectionChange=new Dn,this._stateChanges=new si}get multiple(){return this._parent&&this._parent.multiple}get selected(){return this._selected}get disabled(){return this.group&&this.group.disabled||this._disabled}set disabled(t){this._disabled=Kr(t)}get disableRipple(){return!(!this._parent||!this._parent.disableRipple)}get active(){return this._active}get viewValue(){return(this._getHostElement().textContent||"").trim()}select(){this._selected||(this._selected=!0,this._changeDetectorRef.markForCheck(),this._emitSelectionChangeEvent())}deselect(){this._selected&&(this._selected=!1,this._changeDetectorRef.markForCheck(),this._emitSelectionChangeEvent())}focus(t,i){const r=this._getHostElement();"function"==typeof r.focus&&r.focus(i)}setActiveStyles(){this._active||(this._active=!0,this._changeDetectorRef.markForCheck())}setInactiveStyles(){this._active&&(this._active=!1,this._changeDetectorRef.markForCheck())}getLabel(){return this.viewValue}_handleKeydown(t){(13===t.keyCode||32===t.keyCode)&&!th(t)&&(this._selectViaInteraction(),t.preventDefault())}_selectViaInteraction(){this.disabled||(this._selected=!this.multiple||!this._selected,this._changeDetectorRef.markForCheck(),this._emitSelectionChangeEvent(!0))}_getAriaSelected(){return this.selected||!this.multiple&&null}_getTabIndex(){return this.disabled?"-1":"0"}_getHostElement(){return this._element.nativeElement}ngAfterViewChecked(){if(this._selected){const t=this.viewValue;t!==this._mostRecentViewValue&&(this._mostRecentViewValue=t,this._stateChanges.next())}}ngOnDestroy(){this._stateChanges.complete()}_emitSelectionChangeEvent(t=!1){this.onSelectionChange.emit(new LW(this,t))}}return n.\u0275fac=function(t){eu()},n.\u0275dir=an({type:n,inputs:{value:"value",id:"id",disabled:"disabled"},outputs:{onSelectionChange:"onSelectionChange"}}),n})(),BF=(()=>{class n extends OW{constructor(t,i,r,s){super(t,i,r,s)}}return n.\u0275fac=function(t){return new(t||n)(Ie(wr),Ie(Ho),Ie(FF,8),Ie(NF,8))},n.\u0275cmp=Qn({type:n,selectors:[["mat-option"]],hostAttrs:["role","option",1,"mat-option","mat-focus-indicator"],hostVars:12,hostBindings:function(t,i){1&t&&gi("click",function(){return i._selectViaInteraction()})("keydown",function(s){return i._handleKeydown(s)}),2&t&&(ev("id",i.id),tr("tabindex",i._getTabIndex())("aria-selected",i._getAriaSelected())("aria-disabled",i.disabled.toString()),ds("mat-selected",i.selected)("mat-option-multiple",i.multiple)("mat-active",i.active)("mat-option-disabled",i.disabled))},exportAs:["matOption"],features:[dn],ngContentSelectors:mW,decls:5,vars:4,consts:[["class","mat-option-pseudo-checkbox",3,"state","disabled",4,"ngIf"],[1,"mat-option-text"],["class","cdk-visually-hidden",4,"ngIf"],["mat-ripple","",1,"mat-option-ripple",3,"matRippleTrigger","matRippleDisabled"],[1,"mat-option-pseudo-checkbox",3,"state","disabled"],[1,"cdk-visually-hidden"]],template:function(t,i){1&t&&(iu(),Di(0,pW,1,2,"mat-pseudo-checkbox",0),Ae(1,"span",1),us(2),xe(),Di(3,fW,2,1,"span",2),jt(4,"div",3)),2&t&&(Kt("ngIf",i.multiple),Et(3),Kt("ngIf",i.group&&i.group._inert),Et(1),Kt("matRippleTrigger",i._getHostElement())("matRippleDisabled",i.disabled||i.disableRipple))},dependencies:[Rb,Yf,OF],styles:['.mat-option{white-space:nowrap;overflow:hidden;text-overflow:ellipsis;display:block;line-height:48px;height:48px;padding:0 16px;text-align:left;text-decoration:none;max-width:100%;position:relative;cursor:pointer;outline:none;display:flex;flex-direction:row;max-width:100%;box-sizing:border-box;align-items:center;-webkit-tap-highlight-color:rgba(0,0,0,0)}.mat-option[disabled]{cursor:default}[dir=rtl] .mat-option{text-align:right}.mat-option .mat-icon{margin-right:16px;vertical-align:middle}.mat-option .mat-icon svg{vertical-align:top}[dir=rtl] .mat-option .mat-icon{margin-left:16px;margin-right:0}.mat-option[aria-disabled=true]{-webkit-user-select:none;user-select:none;cursor:default}.mat-optgroup .mat-option:not(.mat-option-multiple){padding-left:32px}[dir=rtl] .mat-optgroup .mat-option:not(.mat-option-multiple){padding-left:16px;padding-right:32px}.mat-option.mat-active::before{content:""}.cdk-high-contrast-active .mat-option[aria-disabled=true]{opacity:.5}.cdk-high-contrast-active .mat-option.mat-selected:not(.mat-option-multiple)::after{content:"";position:absolute;top:50%;right:16px;transform:translateY(-50%);width:10px;height:0;border-bottom:solid 10px;border-radius:10px}[dir=rtl] .cdk-high-contrast-active .mat-option.mat-selected:not(.mat-option-multiple)::after{right:auto;left:16px}.mat-option-text{display:inline-block;flex-grow:1;overflow:hidden;text-overflow:ellipsis}.mat-option .mat-option-ripple{top:0;left:0;right:0;bottom:0;position:absolute;pointer-events:none}.mat-option-pseudo-checkbox{margin-right:8px}[dir=rtl] .mat-option-pseudo-checkbox{margin-left:8px;margin-right:0}'],encapsulation:2,changeDetection:0}),n})();function zF(n,e,t){if(t.length){let i=e.toArray(),r=t.toArray(),s=0;for(let c=0;c<n+1;c++)i[c].group&&i[c].group===r[s]&&s++;return s}return 0}let VF=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=Gn({type:n}),n.\u0275inj=Bn({imports:[kb,au,Ki,CA]}),n})(),NW=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=Gn({type:n}),n.\u0275inj=Bn({imports:[Ki,Ki]}),n})();class SA{constructor(e=!1,t,i=!0,r){this._multiple=e,this._emitChanges=i,this.compareWith=r,this._selection=new Set,this._deselectedToEmit=[],this._selectedToEmit=[],this.changed=new si,t&&t.length&&(e?t.forEach(s=>this._markSelected(s)):this._markSelected(t[0]),this._selectedToEmit.length=0)}get selected(){return this._selected||(this._selected=Array.from(this._selection.values())),this._selected}select(...e){this._verifyValueAssignment(e),e.forEach(i=>this._markSelected(i));const t=this._hasQueuedChanges();return this._emitChangeEvent(),t}deselect(...e){this._verifyValueAssignment(e),e.forEach(i=>this._unmarkSelected(i));const t=this._hasQueuedChanges();return this._emitChangeEvent(),t}setSelection(...e){this._verifyValueAssignment(e);const t=this.selected,i=new Set(e);e.forEach(s=>this._markSelected(s)),t.filter(s=>!i.has(s)).forEach(s=>this._unmarkSelected(s));const r=this._hasQueuedChanges();return this._emitChangeEvent(),r}toggle(e){return this.isSelected(e)?this.deselect(e):this.select(e)}clear(e=!0){this._unmarkAll();const t=this._hasQueuedChanges();return e&&this._emitChangeEvent(),t}isSelected(e){if(this.compareWith){for(const t of this._selection)if(this.compareWith(t,e))return!0;return!1}return this._selection.has(e)}isEmpty(){return 0===this._selection.size}hasValue(){return!this.isEmpty()}sort(e){this._multiple&&this.selected&&this._selected.sort(e)}isMultipleSelection(){return this._multiple}_emitChangeEvent(){this._selected=null,(this._selectedToEmit.length||this._deselectedToEmit.length)&&(this.changed.next({source:this,added:this._selectedToEmit,removed:this._deselectedToEmit}),this._deselectedToEmit=[],this._selectedToEmit=[])}_markSelected(e){this.isSelected(e)||(this._multiple||this._unmarkAll(),this.isSelected(e)||this._selection.add(e),this._emitChanges&&this._selectedToEmit.push(e))}_unmarkSelected(e){this.isSelected(e)&&(this._selection.delete(e),this._emitChanges&&this._deselectedToEmit.push(e))}_unmarkAll(){this.isEmpty()||this._selection.forEach(e=>this._unmarkSelected(e))}_verifyValueAssignment(e){}_hasQueuedChanges(){return!(!this._deselectedToEmit.length&&!this._selectedToEmit.length)}}let UF=(()=>{class n{constructor(){this._listeners=[]}notify(t,i){for(let r of this._listeners)r(t,i)}listen(t){return this._listeners.push(t),()=>{this._listeners=this._listeners.filter(i=>t!==i)}}ngOnDestroy(){this._listeners=[]}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=Yt({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),BW=0;const EA=new Vt("CdkAccordion");let zW=(()=>{class n{constructor(){this._stateChanges=new si,this._openCloseAllActions=new si,this.id="cdk-accordion-"+BW++,this._multi=!1}get multi(){return this._multi}set multi(t){this._multi=Kr(t)}openAll(){this._multi&&this._openCloseAllActions.next(!0)}closeAll(){this._openCloseAllActions.next(!1)}ngOnChanges(t){this._stateChanges.next(t)}ngOnDestroy(){this._stateChanges.complete(),this._openCloseAllActions.complete()}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275dir=an({type:n,selectors:[["cdk-accordion"],["","cdkAccordion",""]],inputs:{multi:"multi"},exportAs:["cdkAccordion"],features:[hr([{provide:EA,useExisting:n}]),Nr]}),n})(),VW=0,UW=(()=>{class n{constructor(t,i,r){this.accordion=t,this._changeDetectorRef=i,this._expansionDispatcher=r,this._openCloseAllSubscription=lt.EMPTY,this.closed=new Dn,this.opened=new Dn,this.destroyed=new Dn,this.expandedChange=new Dn,this.id="cdk-accordion-child-"+VW++,this._expanded=!1,this._disabled=!1,this._removeUniqueSelectionListener=()=>{},this._removeUniqueSelectionListener=r.listen((s,c)=>{this.accordion&&!this.accordion.multi&&this.accordion.id===c&&this.id!==s&&(this.expanded=!1)}),this.accordion&&(this._openCloseAllSubscription=this._subscribeToOpenCloseAllActions())}get expanded(){return this._expanded}set expanded(t){t=Kr(t),this._expanded!==t&&(this._expanded=t,this.expandedChange.emit(t),t?(this.opened.emit(),this._expansionDispatcher.notify(this.id,this.accordion?this.accordion.id:this.id)):this.closed.emit(),this._changeDetectorRef.markForCheck())}get disabled(){return this._disabled}set disabled(t){this._disabled=Kr(t)}ngOnDestroy(){this.opened.complete(),this.closed.complete(),this.destroyed.emit(),this.destroyed.complete(),this._removeUniqueSelectionListener(),this._openCloseAllSubscription.unsubscribe()}toggle(){this.disabled||(this.expanded=!this.expanded)}close(){this.disabled||(this.expanded=!1)}open(){this.disabled||(this.expanded=!0)}_subscribeToOpenCloseAllActions(){return this.accordion._openCloseAllActions.subscribe(t=>{this.disabled||(this.expanded=t)})}}return n.\u0275fac=function(t){return new(t||n)(Ie(EA,12),Ie(Ho),Ie(UF))},n.\u0275dir=an({type:n,selectors:[["cdk-accordion-item"],["","cdkAccordionItem",""]],inputs:{expanded:"expanded",disabled:"disabled"},outputs:{closed:"closed",opened:"opened",destroyed:"destroyed",expandedChange:"expandedChange"},exportAs:["cdkAccordionItem"],features:[hr([{provide:EA,useValue:void 0}])]}),n})(),HW=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=Gn({type:n}),n.\u0275inj=Bn({}),n})();class TA{attach(e){return this._attachedHost=e,e.attach(this)}detach(){let e=this._attachedHost;null!=e&&(this._attachedHost=null,e.detach())}get isAttached(){return null!=this._attachedHost}setAttachedHost(e){this._attachedHost=e}}class HF extends TA{constructor(e,t,i,r){super(),this.component=e,this.viewContainerRef=t,this.injector=i,this.componentFactoryResolver=r}}class DA extends TA{constructor(e,t,i,r){super(),this.templateRef=e,this.viewContainerRef=t,this.context=i,this.injector=r}get origin(){return this.templateRef.elementRef}attach(e,t=this.context){return this.context=t,super.attach(e)}detach(){return this.context=void 0,super.detach()}}class GW extends TA{constructor(e){super(),this.element=e instanceof wr?e.nativeElement:e}}class GF{constructor(){this._isDisposed=!1,this.attachDomPortal=null}hasAttached(){return!!this._attachedPortal}attach(e){return e instanceof HF?(this._attachedPortal=e,this.attachComponentPortal(e)):e instanceof DA?(this._attachedPortal=e,this.attachTemplatePortal(e)):this.attachDomPortal&&e instanceof GW?(this._attachedPortal=e,this.attachDomPortal(e)):void 0}detach(){this._attachedPortal&&(this._attachedPortal.setAttachedHost(null),this._attachedPortal=null),this._invokeDisposeFn()}dispose(){this.hasAttached()&&this.detach(),this._invokeDisposeFn(),this._isDisposed=!0}setDisposeFn(e){this._disposeFn=e}_invokeDisposeFn(){this._disposeFn&&(this._disposeFn(),this._disposeFn=null)}}class jW extends GF{constructor(e,t,i,r,s){super(),this.outletElement=e,this._componentFactoryResolver=t,this._appRef=i,this._defaultInjector=r,this.attachDomPortal=c=>{const d=c.element,m=this._document.createComment("dom-portal");d.parentNode.insertBefore(m,d),this.outletElement.appendChild(d),this._attachedPortal=c,super.setDisposeFn(()=>{m.parentNode&&m.parentNode.replaceChild(d,m)})},this._document=s}attachComponentPortal(e){const i=(e.componentFactoryResolver||this._componentFactoryResolver).resolveComponentFactory(e.component);let r;return e.viewContainerRef?(r=e.viewContainerRef.createComponent(i,e.viewContainerRef.length,e.injector||e.viewContainerRef.injector),this.setDisposeFn(()=>r.destroy())):(r=i.create(e.injector||this._defaultInjector||Yr.NULL),this._appRef.attachView(r.hostView),this.setDisposeFn(()=>{this._appRef.viewCount>0&&this._appRef.detachView(r.hostView),r.destroy()})),this.outletElement.appendChild(this._getComponentRootNode(r)),this._attachedPortal=e,r}attachTemplatePortal(e){let t=e.viewContainerRef,i=t.createEmbeddedView(e.templateRef,e.context,{injector:e.injector});return i.rootNodes.forEach(r=>this.outletElement.appendChild(r)),i.detectChanges(),this.setDisposeFn(()=>{let r=t.indexOf(i);-1!==r&&t.remove(r)}),this._attachedPortal=e,i}dispose(){super.dispose(),this.outletElement.remove()}_getComponentRootNode(e){return e.hostView.rootNodes[0]}}let jF=(()=>{class n extends GF{constructor(t,i,r){super(),this._componentFactoryResolver=t,this._viewContainerRef=i,this._isInitialized=!1,this.attached=new Dn,this.attachDomPortal=s=>{const c=s.element,d=this._document.createComment("dom-portal");s.setAttachedHost(this),c.parentNode.insertBefore(d,c),this._getRootNode().appendChild(c),this._attachedPortal=s,super.setDisposeFn(()=>{d.parentNode&&d.parentNode.replaceChild(c,d)})},this._document=r}get portal(){return this._attachedPortal}set portal(t){this.hasAttached()&&!t&&!this._isInitialized||(this.hasAttached()&&super.detach(),t&&super.attach(t),this._attachedPortal=t||null)}get attachedRef(){return this._attachedRef}ngOnInit(){this._isInitialized=!0}ngOnDestroy(){super.dispose(),this._attachedPortal=null,this._attachedRef=null}attachComponentPortal(t){t.setAttachedHost(this);const i=null!=t.viewContainerRef?t.viewContainerRef:this._viewContainerRef,s=(t.componentFactoryResolver||this._componentFactoryResolver).resolveComponentFactory(t.component),c=i.createComponent(s,i.length,t.injector||i.injector);return i!==this._viewContainerRef&&this._getRootNode().appendChild(c.hostView.rootNodes[0]),super.setDisposeFn(()=>c.destroy()),this._attachedPortal=t,this._attachedRef=c,this.attached.emit(c),c}attachTemplatePortal(t){t.setAttachedHost(this);const i=this._viewContainerRef.createEmbeddedView(t.templateRef,t.context,{injector:t.injector});return super.setDisposeFn(()=>this._viewContainerRef.clear()),this._attachedPortal=t,this._attachedRef=i,this.attached.emit(i),i}_getRootNode(){const t=this._viewContainerRef.element.nativeElement;return t.nodeType===t.ELEMENT_NODE?t:t.parentNode}}return n.\u0275fac=function(t){return new(t||n)(Ie(Kc),Ie(ql),Ie(Vi))},n.\u0275dir=an({type:n,selectors:[["","cdkPortalOutlet",""]],inputs:{portal:["cdkPortalOutlet","portal"]},outputs:{attached:"attached"},exportAs:["cdkPortalOutlet"],features:[dn]}),n})(),Lb=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=Gn({type:n}),n.\u0275inj=Bn({}),n})();class $F{}const fp="*";function fd(n,e){return{type:7,name:n,definitions:e,options:{}}}function vl(n,e=null){return{type:4,styles:e,timings:n}}function WF(n,e=null){return{type:2,steps:n,options:e}}function Cr(n){return{type:6,styles:n,offset:null}}function Mo(n,e,t){return{type:0,name:n,styles:e,options:t}}function qa(n,e,t=null){return{type:1,expr:n,animation:e,options:t}}function WW(n=null){return{type:9,options:n}}function qW(n,e,t=null){return{type:11,selector:n,animation:e,options:t}}function qF(n){Promise.resolve().then(n)}class Ob{constructor(e=0,t=0){this._onDoneFns=[],this._onStartFns=[],this._onDestroyFns=[],this._originalOnDoneFns=[],this._originalOnStartFns=[],this._started=!1,this._destroyed=!1,this._finished=!1,this._position=0,this.parentPlayer=null,this.totalTime=e+t}_onFinish(){this._finished||(this._finished=!0,this._onDoneFns.forEach(e=>e()),this._onDoneFns=[])}onStart(e){this._originalOnStartFns.push(e),this._onStartFns.push(e)}onDone(e){this._originalOnDoneFns.push(e),this._onDoneFns.push(e)}onDestroy(e){this._onDestroyFns.push(e)}hasStarted(){return this._started}init(){}play(){this.hasStarted()||(this._onStart(),this.triggerMicrotask()),this._started=!0}triggerMicrotask(){qF(()=>this._onFinish())}_onStart(){this._onStartFns.forEach(e=>e()),this._onStartFns=[]}pause(){}restart(){}finish(){this._onFinish()}destroy(){this._destroyed||(this._destroyed=!0,this.hasStarted()||this._onStart(),this.finish(),this._onDestroyFns.forEach(e=>e()),this._onDestroyFns=[])}reset(){this._started=!1,this._finished=!1,this._onStartFns=this._originalOnStartFns,this._onDoneFns=this._originalOnDoneFns}setPosition(e){this._position=this.totalTime?e*this.totalTime:1}getPosition(){return this.totalTime?this._position/this.totalTime:1}triggerCallback(e){const t="start"==e?this._onStartFns:this._onDoneFns;t.forEach(i=>i()),t.length=0}}class ZF{constructor(e){this._onDoneFns=[],this._onStartFns=[],this._finished=!1,this._started=!1,this._destroyed=!1,this._onDestroyFns=[],this.parentPlayer=null,this.totalTime=0,this.players=e;let t=0,i=0,r=0;const s=this.players.length;0==s?qF(()=>this._onFinish()):this.players.forEach(c=>{c.onDone(()=>{++t==s&&this._onFinish()}),c.onDestroy(()=>{++i==s&&this._onDestroy()}),c.onStart(()=>{++r==s&&this._onStart()})}),this.totalTime=this.players.reduce((c,d)=>Math.max(c,d.totalTime),0)}_onFinish(){this._finished||(this._finished=!0,this._onDoneFns.forEach(e=>e()),this._onDoneFns=[])}init(){this.players.forEach(e=>e.init())}onStart(e){this._onStartFns.push(e)}_onStart(){this.hasStarted()||(this._started=!0,this._onStartFns.forEach(e=>e()),this._onStartFns=[])}onDone(e){this._onDoneFns.push(e)}onDestroy(e){this._onDestroyFns.push(e)}hasStarted(){return this._started}play(){this.parentPlayer||this.init(),this._onStart(),this.players.forEach(e=>e.play())}pause(){this.players.forEach(e=>e.pause())}restart(){this.players.forEach(e=>e.restart())}finish(){this._onFinish(),this.players.forEach(e=>e.finish())}destroy(){this._onDestroy()}_onDestroy(){this._destroyed||(this._destroyed=!0,this._onFinish(),this.players.forEach(e=>e.destroy()),this._onDestroyFns.forEach(e=>e()),this._onDestroyFns=[])}reset(){this.players.forEach(e=>e.reset()),this._destroyed=!1,this._finished=!1,this._started=!1}setPosition(e){const t=e*this.totalTime;this.players.forEach(i=>{const r=i.totalTime?Math.min(1,t/i.totalTime):1;i.setPosition(r)})}getPosition(){const e=this.players.reduce((t,i)=>null===t||i.totalTime>t.totalTime?i:t,null);return null!=e?e.getPosition():0}beforeDestroy(){this.players.forEach(e=>{e.beforeDestroy&&e.beforeDestroy()})}triggerCallback(e){const t="start"==e?this._onStartFns:this._onDoneFns;t.forEach(i=>i()),t.length=0}}const ZW=["body"];function XW(n,e){}const YW=[[["mat-expansion-panel-header"]],"*",[["mat-action-row"]]],KW=["mat-expansion-panel-header","*","mat-action-row"];function QW(n,e){1&n&&jt(0,"span",2),2&n&&Kt("@indicatorRotate",ki()._getExpandedState())}const JW=[[["mat-panel-title"]],[["mat-panel-description"]],"*"],eq=["mat-panel-title","mat-panel-description","*"],PA=new Vt("MAT_ACCORDION"),XF="225ms cubic-bezier(0.4,0.0,0.2,1)",YF={indicatorRotate:fd("indicatorRotate",[Mo("collapsed, void",Cr({transform:"rotate(0deg)"})),Mo("expanded",Cr({transform:"rotate(180deg)"})),qa("expanded <=> collapsed, void => collapsed",vl(XF))]),bodyExpansion:fd("bodyExpansion",[Mo("collapsed, void",Cr({height:"0px",visibility:"hidden"})),Mo("expanded",Cr({height:"*",visibility:"visible"})),qa("expanded <=> collapsed, void => collapsed",vl(XF))])},KF=new Vt("MAT_EXPANSION_PANEL");let tq=(()=>{class n{constructor(t,i){this._template=t,this._expansionPanel=i}}return n.\u0275fac=function(t){return new(t||n)(Ie(ld),Ie(KF,8))},n.\u0275dir=an({type:n,selectors:[["ng-template","matExpansionPanelContent",""]]}),n})(),nq=0;const QF=new Vt("MAT_EXPANSION_PANEL_DEFAULT_OPTIONS");let JF=(()=>{class n extends UW{constructor(t,i,r,s,c,d,m){super(t,i,r),this._viewContainerRef=s,this._animationMode=d,this._hideToggle=!1,this.afterExpand=new Dn,this.afterCollapse=new Dn,this._inputChanges=new si,this._headerId="mat-expansion-panel-header-"+nq++,this._bodyAnimationDone=new si,this.accordion=t,this._document=c,this._bodyAnimationDone.pipe(gA((y,w)=>y.fromState===w.fromState&&y.toState===w.toState)).subscribe(y=>{"void"!==y.fromState&&("expanded"===y.toState?this.afterExpand.emit():"collapsed"===y.toState&&this.afterCollapse.emit())}),m&&(this.hideToggle=m.hideToggle)}get hideToggle(){return this._hideToggle||this.accordion&&this.accordion.hideToggle}set hideToggle(t){this._hideToggle=Kr(t)}get togglePosition(){return this._togglePosition||this.accordion&&this.accordion.togglePosition}set togglePosition(t){this._togglePosition=t}_hasSpacing(){return!!this.accordion&&this.expanded&&"default"===this.accordion.displayMode}_getExpandedState(){return this.expanded?"expanded":"collapsed"}toggle(){this.expanded=!this.expanded}close(){this.expanded=!1}open(){this.expanded=!0}ngAfterContentInit(){this._lazyContent&&this._lazyContent._expansionPanel===this&&this.opened.pipe(Xl(null),na(()=>this.expanded&&!this._portal),xc(1)).subscribe(()=>{this._portal=new DA(this._lazyContent._template,this._viewContainerRef)})}ngOnChanges(t){this._inputChanges.next(t)}ngOnDestroy(){super.ngOnDestroy(),this._bodyAnimationDone.complete(),this._inputChanges.complete()}_containsFocus(){if(this._body){const t=this._document.activeElement,i=this._body.nativeElement;return t===i||i.contains(t)}return!1}}return n.\u0275fac=function(t){return new(t||n)(Ie(PA,12),Ie(Ho),Ie(UF),Ie(ql),Ie(Vi),Ie(ru,8),Ie(QF,8))},n.\u0275cmp=Qn({type:n,selectors:[["mat-expansion-panel"]],contentQueries:function(t,i,r){if(1&t&&Js(r,tq,5),2&t){let s;Gi(s=ji())&&(i._lazyContent=s.first)}},viewQuery:function(t,i){if(1&t&&Uo(ZW,5),2&t){let r;Gi(r=ji())&&(i._body=r.first)}},hostAttrs:[1,"mat-expansion-panel"],hostVars:6,hostBindings:function(t,i){2&t&&ds("mat-expanded",i.expanded)("_mat-animation-noopable","NoopAnimations"===i._animationMode)("mat-expansion-panel-spacing",i._hasSpacing())},inputs:{disabled:"disabled",expanded:"expanded",hideToggle:"hideToggle",togglePosition:"togglePosition"},outputs:{opened:"opened",closed:"closed",expandedChange:"expandedChange",afterExpand:"afterExpand",afterCollapse:"afterCollapse"},exportAs:["matExpansionPanel"],features:[hr([{provide:PA,useValue:void 0},{provide:KF,useExisting:n}]),dn,Nr],ngContentSelectors:KW,decls:7,vars:4,consts:[["role","region",1,"mat-expansion-panel-content",3,"id"],["body",""],[1,"mat-expansion-panel-body"],[3,"cdkPortalOutlet"]],template:function(t,i){1&t&&(iu(YW),us(0),Ae(1,"div",0,1),gi("@bodyExpansion.done",function(s){return i._bodyAnimationDone.next(s)}),Ae(3,"div",2),us(4,1),Di(5,XW,0,0,"ng-template",3),xe(),us(6,2),xe()),2&t&&(Et(1),Kt("@bodyExpansion",i._getExpandedState())("id",i.id),tr("aria-labelledby",i._headerId),Et(4),Kt("cdkPortalOutlet",i._portal))},dependencies:[jF],styles:['.mat-expansion-panel{box-sizing:content-box;display:block;margin:0;border-radius:4px;overflow:hidden;transition:margin 225ms cubic-bezier(0.4, 0, 0.2, 1),box-shadow 280ms cubic-bezier(0.4, 0, 0.2, 1);position:relative}.mat-accordion .mat-expansion-panel:not(.mat-expanded),.mat-accordion .mat-expansion-panel:not(.mat-expansion-panel-spacing){border-radius:0}.mat-accordion .mat-expansion-panel:first-of-type{border-top-right-radius:4px;border-top-left-radius:4px}.mat-accordion .mat-expansion-panel:last-of-type{border-bottom-right-radius:4px;border-bottom-left-radius:4px}.cdk-high-contrast-active .mat-expansion-panel{outline:solid 1px}.mat-expansion-panel.ng-animate-disabled,.ng-animate-disabled .mat-expansion-panel,.mat-expansion-panel._mat-animation-noopable{transition:none}.mat-expansion-panel-content{display:flex;flex-direction:column;overflow:visible}.mat-expansion-panel-content[style*="visibility: hidden"] *{visibility:hidden !important}.mat-expansion-panel-body{padding:0 24px 16px}.mat-expansion-panel-spacing{margin:16px 0}.mat-accordion>.mat-expansion-panel-spacing:first-child,.mat-accordion>*:first-child:not(.mat-expansion-panel) .mat-expansion-panel-spacing{margin-top:0}.mat-accordion>.mat-expansion-panel-spacing:last-child,.mat-accordion>*:last-child:not(.mat-expansion-panel) .mat-expansion-panel-spacing{margin-bottom:0}.mat-action-row{border-top-style:solid;border-top-width:1px;display:flex;flex-direction:row;justify-content:flex-end;padding:16px 8px 16px 24px}.mat-action-row .mat-button-base,.mat-action-row .mat-mdc-button-base{margin-left:8px}[dir=rtl] .mat-action-row .mat-button-base,[dir=rtl] .mat-action-row .mat-mdc-button-base{margin-left:0;margin-right:8px}'],encapsulation:2,data:{animation:[YF.bodyExpansion]},changeDetection:0}),n})();class iq{}const rq=fC(iq);let e3=(()=>{class n extends rq{constructor(t,i,r,s,c,d,m){super(),this.panel=t,this._element=i,this._focusMonitor=r,this._changeDetectorRef=s,this._animationMode=d,this._parentChangeSubscription=lt.EMPTY;const y=t.accordion?t.accordion._stateChanges.pipe(na(w=>!(!w.hideToggle&&!w.togglePosition))):Gt;this.tabIndex=parseInt(m||"")||0,this._parentChangeSubscription=so(t.opened,t.closed,y,t._inputChanges.pipe(na(w=>!!(w.hideToggle||w.disabled||w.togglePosition)))).subscribe(()=>this._changeDetectorRef.markForCheck()),t.closed.pipe(na(()=>t._containsFocus())).subscribe(()=>r.focusVia(i,"program")),c&&(this.expandedHeight=c.expandedHeight,this.collapsedHeight=c.collapsedHeight)}get disabled(){return this.panel.disabled}_toggle(){this.disabled||this.panel.toggle()}_isExpanded(){return this.panel.expanded}_getExpandedState(){return this.panel._getExpandedState()}_getPanelId(){return this.panel.id}_getTogglePosition(){return this.panel.togglePosition}_showToggle(){return!this.panel.hideToggle&&!this.panel.disabled}_getHeaderHeight(){const t=this._isExpanded();return t&&this.expandedHeight?this.expandedHeight:!t&&this.collapsedHeight?this.collapsedHeight:null}_keydown(t){switch(t.keyCode){case 32:case 13:th(t)||(t.preventDefault(),this._toggle());break;default:return void(this.panel.accordion&&this.panel.accordion._handleHeaderKeydown(t))}}focus(t,i){t?this._focusMonitor.focusVia(this._element,t,i):this._element.nativeElement.focus(i)}ngAfterViewInit(){this._focusMonitor.monitor(this._element).subscribe(t=>{t&&this.panel.accordion&&this.panel.accordion._handleHeaderFocus(this)})}ngOnDestroy(){this._parentChangeSubscription.unsubscribe(),this._focusMonitor.stopMonitoring(this._element)}}return n.\u0275fac=function(t){return new(t||n)(Ie(JF,1),Ie(wr),Ie(fv),Ie(Ho),Ie(QF,8),Ie(ru,8),ns("tabindex"))},n.\u0275cmp=Qn({type:n,selectors:[["mat-expansion-panel-header"]],hostAttrs:["role","button",1,"mat-expansion-panel-header","mat-focus-indicator"],hostVars:15,hostBindings:function(t,i){1&t&&gi("click",function(){return i._toggle()})("keydown",function(s){return i._keydown(s)}),2&t&&(tr("id",i.panel._headerId)("tabindex",i.tabIndex)("aria-controls",i._getPanelId())("aria-expanded",i._isExpanded())("aria-disabled",i.panel.disabled),Eg("height",i._getHeaderHeight()),ds("mat-expanded",i._isExpanded())("mat-expansion-toggle-indicator-after","after"===i._getTogglePosition())("mat-expansion-toggle-indicator-before","before"===i._getTogglePosition())("_mat-animation-noopable","NoopAnimations"===i._animationMode))},inputs:{tabIndex:"tabIndex",expandedHeight:"expandedHeight",collapsedHeight:"collapsedHeight"},features:[dn],ngContentSelectors:eq,decls:5,vars:3,consts:[[1,"mat-content"],["class","mat-expansion-indicator",4,"ngIf"],[1,"mat-expansion-indicator"]],template:function(t,i){1&t&&(iu(JW),Ae(0,"span",0),us(1),us(2,1),us(3,2),xe(),Di(4,QW,1,1,"span",1)),2&t&&(ds("mat-content-hide-toggle",!i._showToggle()),Et(4),Kt("ngIf",i._showToggle()))},dependencies:[Yf],styles:['.mat-expansion-panel-header{display:flex;flex-direction:row;align-items:center;padding:0 24px;border-radius:inherit;transition:height 225ms cubic-bezier(0.4, 0, 0.2, 1)}.mat-expansion-panel-header._mat-animation-noopable{transition:none}.mat-expansion-panel-header:focus,.mat-expansion-panel-header:hover{outline:none}.mat-expansion-panel-header.mat-expanded:focus,.mat-expansion-panel-header.mat-expanded:hover{background:inherit}.mat-expansion-panel-header:not([aria-disabled=true]){cursor:pointer}.mat-expansion-panel-header.mat-expansion-toggle-indicator-before{flex-direction:row-reverse}.mat-expansion-panel-header.mat-expansion-toggle-indicator-before .mat-expansion-indicator{margin:0 16px 0 0}[dir=rtl] .mat-expansion-panel-header.mat-expansion-toggle-indicator-before .mat-expansion-indicator{margin:0 0 0 16px}.mat-content{display:flex;flex:1;flex-direction:row;overflow:hidden}.mat-content.mat-content-hide-toggle{margin-right:8px}[dir=rtl] .mat-content.mat-content-hide-toggle{margin-right:0;margin-left:8px}.mat-expansion-toggle-indicator-before .mat-content.mat-content-hide-toggle{margin-left:24px;margin-right:0}[dir=rtl] .mat-expansion-toggle-indicator-before .mat-content.mat-content-hide-toggle{margin-right:24px;margin-left:0}.mat-expansion-panel-header-title,.mat-expansion-panel-header-description{display:flex;flex-grow:1;flex-basis:0;margin-right:16px;align-items:center}[dir=rtl] .mat-expansion-panel-header-title,[dir=rtl] .mat-expansion-panel-header-description{margin-right:0;margin-left:16px}.mat-expansion-panel-header-description{flex-grow:2}.mat-expansion-indicator::after{border-style:solid;border-width:0 2px 2px 0;content:"";display:inline-block;padding:3px;transform:rotate(45deg);vertical-align:middle}.cdk-high-contrast-active .mat-expansion-panel-content{border-top:1px solid;border-top-left-radius:0;border-top-right-radius:0}'],encapsulation:2,data:{animation:[YF.indicatorRotate]},changeDetection:0}),n})(),sq=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275dir=an({type:n,selectors:[["mat-panel-title"]],hostAttrs:[1,"mat-expansion-panel-header-title"]}),n})(),oq=(()=>{class n extends zW{constructor(){super(...arguments),this._ownHeaders=new iv,this._hideToggle=!1,this.displayMode="default",this.togglePosition="after"}get hideToggle(){return this._hideToggle}set hideToggle(t){this._hideToggle=Kr(t)}ngAfterContentInit(){this._headers.changes.pipe(Xl(this._headers)).subscribe(t=>{this._ownHeaders.reset(t.filter(i=>i.panel.accordion===this)),this._ownHeaders.notifyOnChanges()}),this._keyManager=new bF(this._ownHeaders).withWrap().withHomeAndEnd()}_handleHeaderKeydown(t){this._keyManager.onKeydown(t)}_handleHeaderFocus(t){this._keyManager.updateActiveItem(t)}ngOnDestroy(){super.ngOnDestroy(),this._ownHeaders.destroy()}}return n.\u0275fac=function(){let e;return function(i){return(e||(e=hi(n)))(i||n)}}(),n.\u0275dir=an({type:n,selectors:[["mat-accordion"]],contentQueries:function(t,i,r){if(1&t&&Js(r,e3,5),2&t){let s;Gi(s=ji())&&(i._headers=s)}},hostAttrs:[1,"mat-accordion"],hostVars:2,hostBindings:function(t,i){2&t&&ds("mat-accordion-multi",i.multi)},inputs:{multi:"multi",hideToggle:"hideToggle",displayMode:"displayMode",togglePosition:"togglePosition"},exportAs:["matAccordion"],features:[hr([{provide:PA,useExisting:n}]),dn]}),n})(),aq=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=Gn({type:n}),n.\u0275inj=Bn({imports:[au,Ki,HW,Lb]}),n})();const lq=["addListener","removeListener"],cq=["addEventListener","removeEventListener"],uq=["on","off"];function gC(n,e,t,i){if(sr(t)&&(i=t,t=void 0),i)return gC(n,e,t).pipe(yA(i));const[r,s]=function pq(n){return sr(n.addEventListener)&&sr(n.removeEventListener)}(n)?cq.map(c=>d=>n[c](e,d,t)):function dq(n){return sr(n.addListener)&&sr(n.removeListener)}(n)?lq.map(t3(n,e)):function hq(n){return sr(n.on)&&sr(n.off)}(n)?uq.map(t3(n,e)):[];if(!r&&Nc(n))return ze(c=>gC(c,e,t))(ws(n));if(!r)throw new TypeError("Invalid event target");return new ci(c=>{const d=(...m)=>c.next(1<m.length?m:m[0]);return r(d),()=>s(d)})}function t3(n,e){return t=>i=>n[t](e,i)}const fq=["connectionContainer"],mq=["inputContainer"],gq=["label"];function _q(n,e){1&n&&(ab(0),Ae(1,"div",14),jt(2,"div",15)(3,"div",16)(4,"div",17),xe(),Ae(5,"div",18),jt(6,"div",15)(7,"div",16)(8,"div",17),xe(),lb())}function yq(n,e){if(1&n){const t=Yd();Ae(0,"div",19),gi("cdkObserveContent",function(){return As(t),Us(ki().updateOutlineGap())}),us(1,1),xe()}2&n&&Kt("cdkObserveContentDisabled","outline"!=ki().appearance)}function vq(n,e){if(1&n&&(ab(0),us(1,2),Ae(2,"span"),it(3),xe(),lb()),2&n){const t=ki(2);Et(3),Qs(t._control.placeholder)}}function xq(n,e){1&n&&us(0,3,["*ngSwitchCase","true"])}function bq(n,e){1&n&&(Ae(0,"span",23),it(1," *"),xe())}function wq(n,e){if(1&n){const t=Yd();Ae(0,"label",20,21),gi("cdkObserveContent",function(){return As(t),Us(ki().updateOutlineGap())}),Di(2,vq,4,1,"ng-container",12),Di(3,xq,1,0,"ng-content",12),Di(4,bq,2,0,"span",22),xe()}if(2&n){const t=ki();ds("mat-empty",t._control.empty&&!t._shouldAlwaysFloat())("mat-form-field-empty",t._control.empty&&!t._shouldAlwaysFloat())("mat-accent","accent"==t.color)("mat-warn","warn"==t.color),Kt("cdkObserveContentDisabled","outline"!=t.appearance)("id",t._labelId)("ngSwitch",t._hasLabel()),tr("for",t._control.id)("aria-owns",t._control.id),Et(2),Kt("ngSwitchCase",!1),Et(1),Kt("ngSwitchCase",!0),Et(1),Kt("ngIf",!t.hideRequiredMarker&&t._control.required&&!t._control.disabled)}}function Mq(n,e){1&n&&(Ae(0,"div",24),us(1,4),xe())}function Cq(n,e){if(1&n&&(Ae(0,"div",25),jt(1,"span",26),xe()),2&n){const t=ki();Et(1),ds("mat-accent","accent"==t.color)("mat-warn","warn"==t.color)}}function Sq(n,e){1&n&&(Ae(0,"div"),us(1,5),xe()),2&n&&Kt("@transitionMessages",ki()._subscriptAnimationState)}function Eq(n,e){if(1&n&&(Ae(0,"div",30),it(1),xe()),2&n){const t=ki(2);Kt("id",t._hintLabelId),Et(1),Qs(t.hintLabel)}}function Tq(n,e){if(1&n&&(Ae(0,"div",27),Di(1,Eq,2,2,"div",28),us(2,6),jt(3,"div",29),us(4,7),xe()),2&n){const t=ki();Kt("@transitionMessages",t._subscriptAnimationState),Et(1),Kt("ngIf",t.hintLabel)}}const Dq=["*",[["","matPrefix",""]],[["mat-placeholder"]],[["mat-label"]],[["","matSuffix",""]],[["mat-error"]],[["mat-hint",3,"align","end"]],[["mat-hint","align","end"]]],Aq=["*","[matPrefix]","mat-placeholder","mat-label","[matSuffix]","mat-error","mat-hint:not([align='end'])","mat-hint[align='end']"],Iq=new Vt("MatError"),Pq={transitionMessages:fd("transitionMessages",[Mo("enter",Cr({opacity:1,transform:"translateY(0%)"})),qa("void => enter",[Cr({opacity:0,transform:"translateY(-5px)"}),vl("300ms cubic-bezier(0.55, 0, 0.55, 0.2)")])])};let RA=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275dir=an({type:n}),n})();const Rq=new Vt("MatHint");let kA=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275dir=an({type:n,selectors:[["mat-label"]]}),n})(),kq=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275dir=an({type:n,selectors:[["mat-placeholder"]]}),n})();const Lq=new Vt("MatPrefix"),Oq=new Vt("MatSuffix");let n3=0;const Nq=pC(class{constructor(n){this._elementRef=n}},"primary"),Bq=new Vt("MAT_FORM_FIELD_DEFAULT_OPTIONS"),LA=new Vt("MatFormField");let zq=(()=>{class n extends Nq{constructor(t,i,r,s,c,d,m){super(t),this._changeDetectorRef=i,this._dir=r,this._defaults=s,this._platform=c,this._ngZone=d,this._outlineGapCalculationNeededImmediately=!1,this._outlineGapCalculationNeededOnStable=!1,this._destroyed=new si,this._hideRequiredMarker=!1,this._showAlwaysAnimate=!1,this._subscriptAnimationState="",this._hintLabel="",this._hintLabelId="mat-hint-"+n3++,this._labelId="mat-form-field-label-"+n3++,this.floatLabel=this._getDefaultFloatLabelState(),this._animationsEnabled="NoopAnimations"!==m,this.appearance=s?.appearance||"legacy",s&&(this._hideRequiredMarker=Boolean(s.hideRequiredMarker),s.color&&(this.color=this.defaultColor=s.color))}get appearance(){return this._appearance}set appearance(t){const i=this._appearance;this._appearance=t||this._defaults?.appearance||"legacy","outline"===this._appearance&&i!==t&&(this._outlineGapCalculationNeededOnStable=!0)}get hideRequiredMarker(){return this._hideRequiredMarker}set hideRequiredMarker(t){this._hideRequiredMarker=Kr(t)}_shouldAlwaysFloat(){return"always"===this.floatLabel&&!this._showAlwaysAnimate}_canLabelFloat(){return"never"!==this.floatLabel}get hintLabel(){return this._hintLabel}set hintLabel(t){this._hintLabel=t,this._processHints()}get floatLabel(){return"legacy"!==this.appearance&&"never"===this._floatLabel?"auto":this._floatLabel}set floatLabel(t){t!==this._floatLabel&&(this._floatLabel=t||this._getDefaultFloatLabelState(),this._changeDetectorRef.markForCheck())}get _control(){return this._explicitFormFieldControl||this._controlNonStatic||this._controlStatic}set _control(t){this._explicitFormFieldControl=t}getLabelId(){return this._hasFloatingLabel()?this._labelId:null}getConnectedOverlayOrigin(){return this._connectionContainerRef||this._elementRef}ngAfterContentInit(){this._validateControlChild();const t=this._control;t.controlType&&this._elementRef.nativeElement.classList.add(`mat-form-field-type-${t.controlType}`),t.stateChanges.pipe(Xl(null)).subscribe(()=>{this._validatePlaceholders(),this._syncDescribedByIds(),this._changeDetectorRef.markForCheck()}),t.ngControl&&t.ngControl.valueChanges&&t.ngControl.valueChanges.pipe(ia(this._destroyed)).subscribe(()=>this._changeDetectorRef.markForCheck()),this._ngZone.runOutsideAngular(()=>{this._ngZone.onStable.pipe(ia(this._destroyed)).subscribe(()=>{this._outlineGapCalculationNeededOnStable&&this.updateOutlineGap()})}),so(this._prefixChildren.changes,this._suffixChildren.changes).subscribe(()=>{this._outlineGapCalculationNeededOnStable=!0,this._changeDetectorRef.markForCheck()}),this._hintChildren.changes.pipe(Xl(null)).subscribe(()=>{this._processHints(),this._changeDetectorRef.markForCheck()}),this._errorChildren.changes.pipe(Xl(null)).subscribe(()=>{this._syncDescribedByIds(),this._changeDetectorRef.markForCheck()}),this._dir&&this._dir.change.pipe(ia(this._destroyed)).subscribe(()=>{"function"==typeof requestAnimationFrame?this._ngZone.runOutsideAngular(()=>{requestAnimationFrame(()=>this.updateOutlineGap())}):this.updateOutlineGap()})}ngAfterContentChecked(){this._validateControlChild(),this._outlineGapCalculationNeededImmediately&&this.updateOutlineGap()}ngAfterViewInit(){this._subscriptAnimationState="enter",this._changeDetectorRef.detectChanges()}ngOnDestroy(){this._destroyed.next(),this._destroyed.complete()}_shouldForward(t){const i=this._control?this._control.ngControl:null;return i&&i[t]}_hasPlaceholder(){return!!(this._control&&this._control.placeholder||this._placeholderChild)}_hasLabel(){return!(!this._labelChildNonStatic&&!this._labelChildStatic)}_shouldLabelFloat(){return this._canLabelFloat()&&(this._control&&this._control.shouldLabelFloat||this._shouldAlwaysFloat())}_hideControlPlaceholder(){return"legacy"===this.appearance&&!this._hasLabel()||this._hasLabel()&&!this._shouldLabelFloat()}_hasFloatingLabel(){return this._hasLabel()||"legacy"===this.appearance&&this._hasPlaceholder()}_getDisplayedMessages(){return this._errorChildren&&this._errorChildren.length>0&&this._control.errorState?"error":"hint"}_animateAndLockLabel(){this._hasFloatingLabel()&&this._canLabelFloat()&&(this._animationsEnabled&&this._label&&(this._showAlwaysAnimate=!0,gC(this._label.nativeElement,"transitionend").pipe(xc(1)).subscribe(()=>{this._showAlwaysAnimate=!1})),this.floatLabel="always",this._changeDetectorRef.markForCheck())}_validatePlaceholders(){}_processHints(){this._validateHints(),this._syncDescribedByIds()}_validateHints(){}_getDefaultFloatLabelState(){return this._defaults&&this._defaults.floatLabel||"auto"}_syncDescribedByIds(){if(this._control){let t=[];if(this._control.userAriaDescribedBy&&"string"==typeof this._control.userAriaDescribedBy&&t.push(...this._control.userAriaDescribedBy.split(" ")),"hint"===this._getDisplayedMessages()){const i=this._hintChildren?this._hintChildren.find(s=>"start"===s.align):null,r=this._hintChildren?this._hintChildren.find(s=>"end"===s.align):null;i?t.push(i.id):this._hintLabel&&t.push(this._hintLabelId),r&&t.push(r.id)}else this._errorChildren&&t.push(...this._errorChildren.map(i=>i.id));this._control.setDescribedByIds(t)}}_validateControlChild(){}updateOutlineGap(){const t=this._label?this._label.nativeElement:null,i=this._connectionContainerRef.nativeElement,r=".mat-form-field-outline-start",s=".mat-form-field-outline-gap";if("outline"!==this.appearance||!this._platform.isBrowser)return;if(!t||!t.children.length||!t.textContent.trim()){const w=i.querySelectorAll(`${r}, ${s}`);for(let S=0;S<w.length;S++)w[S].style.width="0";return}if(!this._isAttachedToDOM())return void(this._outlineGapCalculationNeededImmediately=!0);let c=0,d=0;const m=i.querySelectorAll(r),y=i.querySelectorAll(s);if(this._label&&this._label.nativeElement.children.length){const w=i.getBoundingClientRect();if(0===w.width&&0===w.height)return this._outlineGapCalculationNeededOnStable=!0,void(this._outlineGapCalculationNeededImmediately=!1);const S=this._getStartEnd(w),T=t.children,I=this._getStartEnd(T[0].getBoundingClientRect());let R=0;for(let k=0;k<T.length;k++)R+=T[k].offsetWidth;c=Math.abs(I-S)-5,d=R>0?.75*R+10:0}for(let w=0;w<m.length;w++)m[w].style.width=`${c}px`;for(let w=0;w<y.length;w++)y[w].style.width=`${d}px`;this._outlineGapCalculationNeededOnStable=this._outlineGapCalculationNeededImmediately=!1}_getStartEnd(t){return this._dir&&"rtl"===this._dir.value?t.right:t.left}_isAttachedToDOM(){const t=this._elementRef.nativeElement;if(t.getRootNode){const i=t.getRootNode();return i&&i!==t}return document.documentElement.contains(t)}}return n.\u0275fac=function(t){return new(t||n)(Ie(wr),Ie(Ho),Ie(em,8),Ie(Bq,8),Ie(lu),Ie(nr),Ie(ru,8))},n.\u0275cmp=Qn({type:n,selectors:[["mat-form-field"]],contentQueries:function(t,i,r){if(1&t&&(Js(r,RA,5),Js(r,RA,7),Js(r,kA,5),Js(r,kA,7),Js(r,kq,5),Js(r,Iq,5),Js(r,Rq,5),Js(r,Lq,5),Js(r,Oq,5)),2&t){let s;Gi(s=ji())&&(i._controlNonStatic=s.first),Gi(s=ji())&&(i._controlStatic=s.first),Gi(s=ji())&&(i._labelChildNonStatic=s.first),Gi(s=ji())&&(i._labelChildStatic=s.first),Gi(s=ji())&&(i._placeholderChild=s.first),Gi(s=ji())&&(i._errorChildren=s),Gi(s=ji())&&(i._hintChildren=s),Gi(s=ji())&&(i._prefixChildren=s),Gi(s=ji())&&(i._suffixChildren=s)}},viewQuery:function(t,i){if(1&t&&(Uo(fq,7),Uo(mq,5),Uo(gq,5)),2&t){let r;Gi(r=ji())&&(i._connectionContainerRef=r.first),Gi(r=ji())&&(i._inputContainerRef=r.first),Gi(r=ji())&&(i._label=r.first)}},hostAttrs:[1,"mat-form-field"],hostVars:40,hostBindings:function(t,i){2&t&&ds("mat-form-field-appearance-standard","standard"==i.appearance)("mat-form-field-appearance-fill","fill"==i.appearance)("mat-form-field-appearance-outline","outline"==i.appearance)("mat-form-field-appearance-legacy","legacy"==i.appearance)("mat-form-field-invalid",i._control.errorState)("mat-form-field-can-float",i._canLabelFloat())("mat-form-field-should-float",i._shouldLabelFloat())("mat-form-field-has-label",i._hasFloatingLabel())("mat-form-field-hide-placeholder",i._hideControlPlaceholder())("mat-form-field-disabled",i._control.disabled)("mat-form-field-autofilled",i._control.autofilled)("mat-focused",i._control.focused)("ng-untouched",i._shouldForward("untouched"))("ng-touched",i._shouldForward("touched"))("ng-pristine",i._shouldForward("pristine"))("ng-dirty",i._shouldForward("dirty"))("ng-valid",i._shouldForward("valid"))("ng-invalid",i._shouldForward("invalid"))("ng-pending",i._shouldForward("pending"))("_mat-animation-noopable",!i._animationsEnabled)},inputs:{color:"color",appearance:"appearance",hideRequiredMarker:"hideRequiredMarker",hintLabel:"hintLabel",floatLabel:"floatLabel"},exportAs:["matFormField"],features:[hr([{provide:LA,useExisting:n}]),dn],ngContentSelectors:Aq,decls:15,vars:8,consts:[[1,"mat-form-field-wrapper"],[1,"mat-form-field-flex",3,"click"],["connectionContainer",""],[4,"ngIf"],["class","mat-form-field-prefix",3,"cdkObserveContentDisabled","cdkObserveContent",4,"ngIf"],[1,"mat-form-field-infix"],["inputContainer",""],[1,"mat-form-field-label-wrapper"],["class","mat-form-field-label",3,"cdkObserveContentDisabled","id","mat-empty","mat-form-field-empty","mat-accent","mat-warn","ngSwitch","cdkObserveContent",4,"ngIf"],["class","mat-form-field-suffix",4,"ngIf"],["class","mat-form-field-underline",4,"ngIf"],[1,"mat-form-field-subscript-wrapper",3,"ngSwitch"],[4,"ngSwitchCase"],["class","mat-form-field-hint-wrapper",4,"ngSwitchCase"],[1,"mat-form-field-outline"],[1,"mat-form-field-outline-start"],[1,"mat-form-field-outline-gap"],[1,"mat-form-field-outline-end"],[1,"mat-form-field-outline","mat-form-field-outline-thick"],[1,"mat-form-field-prefix",3,"cdkObserveContentDisabled","cdkObserveContent"],[1,"mat-form-field-label",3,"cdkObserveContentDisabled","id","ngSwitch","cdkObserveContent"],["label",""],["class","mat-placeholder-required mat-form-field-required-marker","aria-hidden","true",4,"ngIf"],["aria-hidden","true",1,"mat-placeholder-required","mat-form-field-required-marker"],[1,"mat-form-field-suffix"],[1,"mat-form-field-underline"],[1,"mat-form-field-ripple"],[1,"mat-form-field-hint-wrapper"],["class","mat-hint",3,"id",4,"ngIf"],[1,"mat-form-field-hint-spacer"],[1,"mat-hint",3,"id"]],template:function(t,i){1&t&&(iu(Dq),Ae(0,"div",0)(1,"div",1,2),gi("click",function(s){return i._control.onContainerClick&&i._control.onContainerClick(s)}),Di(3,_q,9,0,"ng-container",3),Di(4,yq,2,1,"div",4),Ae(5,"div",5,6),us(7),Ae(8,"span",7),Di(9,wq,5,16,"label",8),xe()(),Di(10,Mq,2,0,"div",9),xe(),Di(11,Cq,2,4,"div",10),Ae(12,"div",11),Di(13,Sq,2,1,"div",12),Di(14,Tq,5,2,"div",13),xe()()),2&t&&(Et(3),Kt("ngIf","outline"==i.appearance),Et(1),Kt("ngIf",i._prefixChildren.length),Et(5),Kt("ngIf",i._hasFloatingLabel()),Et(1),Kt("ngIf",i._suffixChildren.length),Et(1),Kt("ngIf","outline"!=i.appearance),Et(1),Kt("ngSwitch",i._getDisplayedMessages()),Et(1),Kt("ngSwitchCase","error"),Et(1),Kt("ngSwitchCase","hint"))},dependencies:[Yf,av,QM,hF],styles:[".mat-form-field{display:inline-block;position:relative;text-align:left}[dir=rtl] .mat-form-field{text-align:right}.mat-form-field-wrapper{position:relative}.mat-form-field-flex{display:inline-flex;align-items:baseline;box-sizing:border-box;width:100%}.mat-form-field-prefix,.mat-form-field-suffix{white-space:nowrap;flex:none;position:relative}.mat-form-field-infix{display:block;position:relative;flex:auto;min-width:0;width:180px}.cdk-high-contrast-active .mat-form-field-infix{border-image:linear-gradient(transparent, transparent)}.mat-form-field-label-wrapper{position:absolute;left:0;box-sizing:content-box;width:100%;height:100%;overflow:hidden;pointer-events:none}[dir=rtl] .mat-form-field-label-wrapper{left:auto;right:0}.mat-form-field-label{position:absolute;left:0;font:inherit;pointer-events:none;width:100%;white-space:nowrap;text-overflow:ellipsis;overflow:hidden;transform-origin:0 0;transition:transform 400ms cubic-bezier(0.25, 0.8, 0.25, 1),color 400ms cubic-bezier(0.25, 0.8, 0.25, 1),width 400ms cubic-bezier(0.25, 0.8, 0.25, 1);display:none}[dir=rtl] .mat-form-field-label{transform-origin:100% 0;left:auto;right:0}.cdk-high-contrast-active .mat-form-field-disabled .mat-form-field-label{color:GrayText}.mat-form-field-empty.mat-form-field-label,.mat-form-field-can-float.mat-form-field-should-float .mat-form-field-label{display:block}.mat-form-field-autofill-control:-webkit-autofill+.mat-form-field-label-wrapper .mat-form-field-label{display:none}.mat-form-field-can-float .mat-form-field-autofill-control:-webkit-autofill+.mat-form-field-label-wrapper .mat-form-field-label{display:block;transition:none}.mat-input-server:focus+.mat-form-field-label-wrapper .mat-form-field-label,.mat-input-server[placeholder]:not(:placeholder-shown)+.mat-form-field-label-wrapper .mat-form-field-label{display:none}.mat-form-field-can-float .mat-input-server:focus+.mat-form-field-label-wrapper .mat-form-field-label,.mat-form-field-can-float .mat-input-server[placeholder]:not(:placeholder-shown)+.mat-form-field-label-wrapper .mat-form-field-label{display:block}.mat-form-field-label:not(.mat-form-field-empty){transition:none}.mat-form-field-underline{position:absolute;width:100%;pointer-events:none;transform:scale3d(1, 1.0001, 1)}.mat-form-field-ripple{position:absolute;left:0;width:100%;transform-origin:50%;transform:scaleX(0.5);opacity:0;transition:background-color 300ms cubic-bezier(0.55, 0, 0.55, 0.2)}.mat-form-field.mat-focused .mat-form-field-ripple,.mat-form-field.mat-form-field-invalid .mat-form-field-ripple{opacity:1;transform:none;transition:transform 300ms cubic-bezier(0.25, 0.8, 0.25, 1),opacity 100ms cubic-bezier(0.25, 0.8, 0.25, 1),background-color 300ms cubic-bezier(0.25, 0.8, 0.25, 1)}.mat-form-field-subscript-wrapper{position:absolute;box-sizing:border-box;width:100%;overflow:hidden}.mat-form-field-subscript-wrapper .mat-icon,.mat-form-field-label-wrapper .mat-icon{width:1em;height:1em;font-size:inherit;vertical-align:baseline}.mat-form-field-hint-wrapper{display:flex}.mat-form-field-hint-spacer{flex:1 0 1em}.mat-error{display:block}.mat-form-field-control-wrapper{position:relative}.mat-form-field-hint-end{order:1}.mat-form-field._mat-animation-noopable .mat-form-field-label,.mat-form-field._mat-animation-noopable .mat-form-field-ripple{transition:none}",'.mat-form-field-appearance-fill .mat-form-field-flex{border-radius:4px 4px 0 0;padding:.75em .75em 0 .75em}.cdk-high-contrast-active .mat-form-field-appearance-fill .mat-form-field-flex{outline:solid 1px}.cdk-high-contrast-active .mat-form-field-appearance-fill.mat-form-field-disabled .mat-form-field-flex{outline-color:GrayText}.cdk-high-contrast-active .mat-form-field-appearance-fill.mat-focused .mat-form-field-flex{outline:dashed 3px}.mat-form-field-appearance-fill .mat-form-field-underline::before{content:"";display:block;position:absolute;bottom:0;height:1px;width:100%}.mat-form-field-appearance-fill .mat-form-field-ripple{bottom:0;height:2px}.cdk-high-contrast-active .mat-form-field-appearance-fill .mat-form-field-ripple{height:0}.mat-form-field-appearance-fill:not(.mat-form-field-disabled) .mat-form-field-flex:hover~.mat-form-field-underline .mat-form-field-ripple{opacity:1;transform:none;transition:opacity 600ms cubic-bezier(0.25, 0.8, 0.25, 1)}.mat-form-field-appearance-fill._mat-animation-noopable:not(.mat-form-field-disabled) .mat-form-field-flex:hover~.mat-form-field-underline .mat-form-field-ripple{transition:none}.mat-form-field-appearance-fill .mat-form-field-subscript-wrapper{padding:0 1em}','.mat-input-element{font:inherit;background:rgba(0,0,0,0);color:currentColor;border:none;outline:none;padding:0;margin:0;width:100%;max-width:100%;vertical-align:bottom;text-align:inherit;box-sizing:content-box}.mat-input-element:-moz-ui-invalid{box-shadow:none}.mat-input-element,.mat-input-element::-webkit-search-cancel-button,.mat-input-element::-webkit-search-decoration,.mat-input-element::-webkit-search-results-button,.mat-input-element::-webkit-search-results-decoration{-webkit-appearance:none}.mat-input-element::-webkit-contacts-auto-fill-button,.mat-input-element::-webkit-caps-lock-indicator,.mat-input-element:not([type=password])::-webkit-credentials-auto-fill-button{visibility:hidden}.mat-input-element[type=date],.mat-input-element[type=datetime],.mat-input-element[type=datetime-local],.mat-input-element[type=month],.mat-input-element[type=week],.mat-input-element[type=time]{line-height:1}.mat-input-element[type=date]::after,.mat-input-element[type=datetime]::after,.mat-input-element[type=datetime-local]::after,.mat-input-element[type=month]::after,.mat-input-element[type=week]::after,.mat-input-element[type=time]::after{content:" ";white-space:pre;width:1px}.mat-input-element::-webkit-inner-spin-button,.mat-input-element::-webkit-calendar-picker-indicator,.mat-input-element::-webkit-clear-button{font-size:.75em}.mat-input-element::placeholder{-webkit-user-select:none;user-select:none;transition:color 400ms 133.3333333333ms cubic-bezier(0.25, 0.8, 0.25, 1)}.mat-input-element::-moz-placeholder{-webkit-user-select:none;user-select:none;transition:color 400ms 133.3333333333ms cubic-bezier(0.25, 0.8, 0.25, 1)}.mat-input-element::-webkit-input-placeholder{-webkit-user-select:none;user-select:none;transition:color 400ms 133.3333333333ms cubic-bezier(0.25, 0.8, 0.25, 1)}.mat-input-element:-ms-input-placeholder{-webkit-user-select:none;user-select:none;transition:color 400ms 133.3333333333ms cubic-bezier(0.25, 0.8, 0.25, 1)}.mat-form-field-hide-placeholder .mat-input-element::placeholder{color:rgba(0,0,0,0) !important;-webkit-text-fill-color:rgba(0,0,0,0);transition:none}.cdk-high-contrast-active .mat-form-field-hide-placeholder .mat-input-element::placeholder{opacity:0}.mat-form-field-hide-placeholder .mat-input-element::-moz-placeholder{color:rgba(0,0,0,0) !important;-webkit-text-fill-color:rgba(0,0,0,0);transition:none}.cdk-high-contrast-active .mat-form-field-hide-placeholder .mat-input-element::-moz-placeholder{opacity:0}.mat-form-field-hide-placeholder .mat-input-element::-webkit-input-placeholder{color:rgba(0,0,0,0) !important;-webkit-text-fill-color:rgba(0,0,0,0);transition:none}.cdk-high-contrast-active .mat-form-field-hide-placeholder .mat-input-element::-webkit-input-placeholder{opacity:0}.mat-form-field-hide-placeholder .mat-input-element:-ms-input-placeholder{color:rgba(0,0,0,0) !important;-webkit-text-fill-color:rgba(0,0,0,0);transition:none}.cdk-high-contrast-active .mat-form-field-hide-placeholder .mat-input-element:-ms-input-placeholder{opacity:0}._mat-animation-noopable .mat-input-element::placeholder{transition:none}._mat-animation-noopable .mat-input-element::-moz-placeholder{transition:none}._mat-animation-noopable .mat-input-element::-webkit-input-placeholder{transition:none}._mat-animation-noopable .mat-input-element:-ms-input-placeholder{transition:none}textarea.mat-input-element{resize:vertical;overflow:auto}textarea.mat-input-element.cdk-textarea-autosize{resize:none}textarea.mat-input-element{padding:2px 0;margin:-2px 0}select.mat-input-element{-moz-appearance:none;-webkit-appearance:none;position:relative;background-color:rgba(0,0,0,0);display:inline-flex;box-sizing:border-box;padding-top:1em;top:-1em;margin-bottom:-1em}select.mat-input-element::-moz-focus-inner{border:0}select.mat-input-element:not(:disabled){cursor:pointer}.mat-form-field-type-mat-native-select .mat-form-field-infix::after{content:"";width:0;height:0;border-left:5px solid rgba(0,0,0,0);border-right:5px solid rgba(0,0,0,0);border-top:5px solid;position:absolute;top:50%;right:0;margin-top:-2.5px;pointer-events:none}[dir=rtl] .mat-form-field-type-mat-native-select .mat-form-field-infix::after{right:auto;left:0}.mat-form-field-type-mat-native-select .mat-input-element{padding-right:15px}[dir=rtl] .mat-form-field-type-mat-native-select .mat-input-element{padding-right:0;padding-left:15px}.mat-form-field-type-mat-native-select .mat-form-field-label-wrapper{max-width:calc(100% - 10px)}.mat-form-field-type-mat-native-select.mat-form-field-appearance-outline .mat-form-field-infix::after{margin-top:-5px}.mat-form-field-type-mat-native-select.mat-form-field-appearance-fill .mat-form-field-infix::after{margin-top:-10px}',".mat-form-field-appearance-legacy .mat-form-field-label{transform:perspective(100px)}.mat-form-field-appearance-legacy .mat-form-field-prefix .mat-icon,.mat-form-field-appearance-legacy .mat-form-field-suffix .mat-icon{width:1em}.mat-form-field-appearance-legacy .mat-form-field-prefix .mat-icon-button,.mat-form-field-appearance-legacy .mat-form-field-suffix .mat-icon-button{font:inherit;vertical-align:baseline}.mat-form-field-appearance-legacy .mat-form-field-prefix .mat-icon-button .mat-icon,.mat-form-field-appearance-legacy .mat-form-field-suffix .mat-icon-button .mat-icon{font-size:inherit}.mat-form-field-appearance-legacy .mat-form-field-underline{height:1px}.cdk-high-contrast-active .mat-form-field-appearance-legacy .mat-form-field-underline{height:0;border-top:solid 1px}.mat-form-field-appearance-legacy .mat-form-field-ripple{top:0;height:2px;overflow:hidden}.cdk-high-contrast-active .mat-form-field-appearance-legacy .mat-form-field-ripple{height:0;border-top:solid 2px}.mat-form-field-appearance-legacy.mat-form-field-disabled .mat-form-field-underline{background-position:0;background-color:rgba(0,0,0,0)}.cdk-high-contrast-active .mat-form-field-appearance-legacy.mat-form-field-disabled .mat-form-field-underline{border-top-style:dotted;border-top-width:2px;border-top-color:GrayText}.mat-form-field-appearance-legacy.mat-form-field-invalid:not(.mat-focused) .mat-form-field-ripple{height:1px}",".mat-form-field-appearance-outline .mat-form-field-wrapper{margin:.25em 0}.mat-form-field-appearance-outline .mat-form-field-flex{padding:0 .75em 0 .75em;margin-top:-0.25em;position:relative}.mat-form-field-appearance-outline .mat-form-field-prefix,.mat-form-field-appearance-outline .mat-form-field-suffix{top:.25em}.mat-form-field-appearance-outline .mat-form-field-outline{display:flex;position:absolute;top:.25em;left:0;right:0;bottom:0;pointer-events:none}.mat-form-field-appearance-outline .mat-form-field-outline-start,.mat-form-field-appearance-outline .mat-form-field-outline-end{border:1px solid currentColor;min-width:5px}.mat-form-field-appearance-outline .mat-form-field-outline-start{border-radius:5px 0 0 5px;border-right-style:none}[dir=rtl] .mat-form-field-appearance-outline .mat-form-field-outline-start{border-right-style:solid;border-left-style:none;border-radius:0 5px 5px 0}.mat-form-field-appearance-outline .mat-form-field-outline-end{border-radius:0 5px 5px 0;border-left-style:none;flex-grow:1}[dir=rtl] .mat-form-field-appearance-outline .mat-form-field-outline-end{border-left-style:solid;border-right-style:none;border-radius:5px 0 0 5px}.mat-form-field-appearance-outline .mat-form-field-outline-gap{border-radius:.000001px;border:1px solid currentColor;border-left-style:none;border-right-style:none}.mat-form-field-appearance-outline.mat-form-field-can-float.mat-form-field-should-float .mat-form-field-outline-gap{border-top-color:rgba(0,0,0,0)}.mat-form-field-appearance-outline .mat-form-field-outline-thick{opacity:0}.mat-form-field-appearance-outline .mat-form-field-outline-thick .mat-form-field-outline-start,.mat-form-field-appearance-outline .mat-form-field-outline-thick .mat-form-field-outline-end,.mat-form-field-appearance-outline .mat-form-field-outline-thick .mat-form-field-outline-gap{border-width:2px}.mat-form-field-appearance-outline.mat-focused .mat-form-field-outline,.mat-form-field-appearance-outline.mat-form-field-invalid .mat-form-field-outline{opacity:0;transition:opacity 100ms cubic-bezier(0.25, 0.8, 0.25, 1)}.mat-form-field-appearance-outline.mat-focused .mat-form-field-outline-thick,.mat-form-field-appearance-outline.mat-form-field-invalid .mat-form-field-outline-thick{opacity:1}.cdk-high-contrast-active .mat-form-field-appearance-outline.mat-focused .mat-form-field-outline-thick{border:3px dashed}.mat-form-field-appearance-outline:not(.mat-form-field-disabled) .mat-form-field-flex:hover .mat-form-field-outline{opacity:0;transition:opacity 600ms cubic-bezier(0.25, 0.8, 0.25, 1)}.mat-form-field-appearance-outline:not(.mat-form-field-disabled) .mat-form-field-flex:hover .mat-form-field-outline-thick{opacity:1}.mat-form-field-appearance-outline .mat-form-field-subscript-wrapper{padding:0 1em}.cdk-high-contrast-active .mat-form-field-appearance-outline.mat-form-field-disabled .mat-form-field-outline{color:GrayText}.mat-form-field-appearance-outline._mat-animation-noopable:not(.mat-form-field-disabled) .mat-form-field-flex:hover~.mat-form-field-outline,.mat-form-field-appearance-outline._mat-animation-noopable .mat-form-field-outline,.mat-form-field-appearance-outline._mat-animation-noopable .mat-form-field-outline-start,.mat-form-field-appearance-outline._mat-animation-noopable .mat-form-field-outline-end,.mat-form-field-appearance-outline._mat-animation-noopable .mat-form-field-outline-gap{transition:none}",".mat-form-field-appearance-standard .mat-form-field-flex{padding-top:.75em}.mat-form-field-appearance-standard .mat-form-field-underline{height:1px}.cdk-high-contrast-active .mat-form-field-appearance-standard .mat-form-field-underline{height:0;border-top:solid 1px}.mat-form-field-appearance-standard .mat-form-field-ripple{bottom:0;height:2px}.cdk-high-contrast-active .mat-form-field-appearance-standard .mat-form-field-ripple{height:0;border-top:solid 2px}.mat-form-field-appearance-standard.mat-form-field-disabled .mat-form-field-underline{background-position:0;background-color:rgba(0,0,0,0)}.cdk-high-contrast-active .mat-form-field-appearance-standard.mat-form-field-disabled .mat-form-field-underline{border-top-style:dotted;border-top-width:2px}.mat-form-field-appearance-standard:not(.mat-form-field-disabled) .mat-form-field-flex:hover~.mat-form-field-underline .mat-form-field-ripple{opacity:1;transform:none;transition:opacity 600ms cubic-bezier(0.25, 0.8, 0.25, 1)}.mat-form-field-appearance-standard._mat-animation-noopable:not(.mat-form-field-disabled) .mat-form-field-flex:hover~.mat-form-field-underline .mat-form-field-ripple{transition:none}"],encapsulation:2,data:{animation:[Pq.transitionMessages]},changeDetection:0}),n})(),_C=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=Gn({type:n}),n.\u0275inj=Bn({imports:[au,Ki,_A,Ki]}),n})(),Vq=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=Gn({type:n}),n.\u0275inj=Bn({imports:[mv]}),n})();const Uq=["mat-button",""],Hq=["*"],jq=["mat-button","mat-flat-button","mat-icon-button","mat-raised-button","mat-stroked-button","mat-mini-fab","mat-fab"],$q=pC(hC(Ib(class{constructor(n){this._elementRef=n}})));let Wq=(()=>{class n extends $q{constructor(t,i,r){super(t),this._focusMonitor=i,this._animationMode=r,this.isRoundButton=this._hasHostAttributes("mat-fab","mat-mini-fab"),this.isIconButton=this._hasHostAttributes("mat-icon-button");for(const s of jq)this._hasHostAttributes(s)&&this._getHostElement().classList.add(s);t.nativeElement.classList.add("mat-button-base"),this.isRoundButton&&(this.color="accent")}ngAfterViewInit(){this._focusMonitor.monitor(this._elementRef,!0)}ngOnDestroy(){this._focusMonitor.stopMonitoring(this._elementRef)}focus(t,i){t?this._focusMonitor.focusVia(this._getHostElement(),t,i):this._getHostElement().focus(i)}_getHostElement(){return this._elementRef.nativeElement}_isRippleDisabled(){return this.disableRipple||this.disabled}_hasHostAttributes(...t){return t.some(i=>this._getHostElement().hasAttribute(i))}}return n.\u0275fac=function(t){return new(t||n)(Ie(wr),Ie(fv),Ie(ru,8))},n.\u0275cmp=Qn({type:n,selectors:[["button","mat-button",""],["button","mat-raised-button",""],["button","mat-icon-button",""],["button","mat-fab",""],["button","mat-mini-fab",""],["button","mat-stroked-button",""],["button","mat-flat-button",""]],viewQuery:function(t,i){if(1&t&&Uo(Rb,5),2&t){let r;Gi(r=ji())&&(i.ripple=r.first)}},hostAttrs:[1,"mat-focus-indicator"],hostVars:5,hostBindings:function(t,i){2&t&&(tr("disabled",i.disabled||null),ds("_mat-animation-noopable","NoopAnimations"===i._animationMode)("mat-button-disabled",i.disabled))},inputs:{disabled:"disabled",disableRipple:"disableRipple",color:"color"},exportAs:["matButton"],features:[dn],attrs:Uq,ngContentSelectors:Hq,decls:4,vars:5,consts:[[1,"mat-button-wrapper"],["matRipple","",1,"mat-button-ripple",3,"matRippleDisabled","matRippleCentered","matRippleTrigger"],[1,"mat-button-focus-overlay"]],template:function(t,i){1&t&&(iu(),Ae(0,"span",0),us(1),xe(),jt(2,"span",1)(3,"span",2)),2&t&&(Et(2),ds("mat-button-ripple-round",i.isRoundButton||i.isIconButton),Kt("matRippleDisabled",i._isRippleDisabled())("matRippleCentered",i.isIconButton)("matRippleTrigger",i._getHostElement()))},dependencies:[Rb],styles:[".mat-button .mat-button-focus-overlay,.mat-icon-button .mat-button-focus-overlay{opacity:0}.mat-button:hover:not(.mat-button-disabled) .mat-button-focus-overlay,.mat-stroked-button:hover:not(.mat-button-disabled) .mat-button-focus-overlay{opacity:.04}@media(hover: none){.mat-button:hover:not(.mat-button-disabled) .mat-button-focus-overlay,.mat-stroked-button:hover:not(.mat-button-disabled) .mat-button-focus-overlay{opacity:0}}.mat-button,.mat-icon-button,.mat-stroked-button,.mat-flat-button{box-sizing:border-box;position:relative;-webkit-user-select:none;user-select:none;cursor:pointer;outline:none;border:none;-webkit-tap-highlight-color:rgba(0,0,0,0);display:inline-block;white-space:nowrap;text-decoration:none;vertical-align:baseline;text-align:center;margin:0;min-width:64px;line-height:36px;padding:0 16px;border-radius:4px;overflow:visible}.mat-button::-moz-focus-inner,.mat-icon-button::-moz-focus-inner,.mat-stroked-button::-moz-focus-inner,.mat-flat-button::-moz-focus-inner{border:0}.mat-button.mat-button-disabled,.mat-icon-button.mat-button-disabled,.mat-stroked-button.mat-button-disabled,.mat-flat-button.mat-button-disabled{cursor:default}.mat-button.cdk-keyboard-focused .mat-button-focus-overlay,.mat-button.cdk-program-focused .mat-button-focus-overlay,.mat-icon-button.cdk-keyboard-focused .mat-button-focus-overlay,.mat-icon-button.cdk-program-focused .mat-button-focus-overlay,.mat-stroked-button.cdk-keyboard-focused .mat-button-focus-overlay,.mat-stroked-button.cdk-program-focused .mat-button-focus-overlay,.mat-flat-button.cdk-keyboard-focused .mat-button-focus-overlay,.mat-flat-button.cdk-program-focused .mat-button-focus-overlay{opacity:.12}.mat-button::-moz-focus-inner,.mat-icon-button::-moz-focus-inner,.mat-stroked-button::-moz-focus-inner,.mat-flat-button::-moz-focus-inner{border:0}.mat-raised-button{box-sizing:border-box;position:relative;-webkit-user-select:none;user-select:none;cursor:pointer;outline:none;border:none;-webkit-tap-highlight-color:rgba(0,0,0,0);display:inline-block;white-space:nowrap;text-decoration:none;vertical-align:baseline;text-align:center;margin:0;min-width:64px;line-height:36px;padding:0 16px;border-radius:4px;overflow:visible;transform:translate3d(0, 0, 0);transition:background 400ms cubic-bezier(0.25, 0.8, 0.25, 1),box-shadow 280ms cubic-bezier(0.4, 0, 0.2, 1)}.mat-raised-button::-moz-focus-inner{border:0}.mat-raised-button.mat-button-disabled{cursor:default}.mat-raised-button.cdk-keyboard-focused .mat-button-focus-overlay,.mat-raised-button.cdk-program-focused .mat-button-focus-overlay{opacity:.12}.mat-raised-button::-moz-focus-inner{border:0}.mat-raised-button._mat-animation-noopable{transition:none !important;animation:none !important}.mat-stroked-button{border:1px solid currentColor;padding:0 15px;line-height:34px}.mat-stroked-button .mat-button-ripple.mat-ripple,.mat-stroked-button .mat-button-focus-overlay{top:-1px;left:-1px;right:-1px;bottom:-1px}.mat-fab{box-sizing:border-box;position:relative;-webkit-user-select:none;user-select:none;cursor:pointer;outline:none;border:none;-webkit-tap-highlight-color:rgba(0,0,0,0);display:inline-block;white-space:nowrap;text-decoration:none;vertical-align:baseline;text-align:center;margin:0;min-width:64px;line-height:36px;padding:0 16px;border-radius:4px;overflow:visible;transform:translate3d(0, 0, 0);transition:background 400ms cubic-bezier(0.25, 0.8, 0.25, 1),box-shadow 280ms cubic-bezier(0.4, 0, 0.2, 1);min-width:0;border-radius:50%;width:56px;height:56px;padding:0;flex-shrink:0}.mat-fab::-moz-focus-inner{border:0}.mat-fab.mat-button-disabled{cursor:default}.mat-fab.cdk-keyboard-focused .mat-button-focus-overlay,.mat-fab.cdk-program-focused .mat-button-focus-overlay{opacity:.12}.mat-fab::-moz-focus-inner{border:0}.mat-fab._mat-animation-noopable{transition:none !important;animation:none !important}.mat-fab .mat-button-wrapper{padding:16px 0;display:inline-block;line-height:24px}.mat-mini-fab{box-sizing:border-box;position:relative;-webkit-user-select:none;user-select:none;cursor:pointer;outline:none;border:none;-webkit-tap-highlight-color:rgba(0,0,0,0);display:inline-block;white-space:nowrap;text-decoration:none;vertical-align:baseline;text-align:center;margin:0;min-width:64px;line-height:36px;padding:0 16px;border-radius:4px;overflow:visible;transform:translate3d(0, 0, 0);transition:background 400ms cubic-bezier(0.25, 0.8, 0.25, 1),box-shadow 280ms cubic-bezier(0.4, 0, 0.2, 1);min-width:0;border-radius:50%;width:40px;height:40px;padding:0;flex-shrink:0}.mat-mini-fab::-moz-focus-inner{border:0}.mat-mini-fab.mat-button-disabled{cursor:default}.mat-mini-fab.cdk-keyboard-focused .mat-button-focus-overlay,.mat-mini-fab.cdk-program-focused .mat-button-focus-overlay{opacity:.12}.mat-mini-fab::-moz-focus-inner{border:0}.mat-mini-fab._mat-animation-noopable{transition:none !important;animation:none !important}.mat-mini-fab .mat-button-wrapper{padding:8px 0;display:inline-block;line-height:24px}.mat-icon-button{padding:0;min-width:0;width:40px;height:40px;flex-shrink:0;line-height:40px;border-radius:50%}.mat-icon-button i,.mat-icon-button .mat-icon{line-height:24px}.mat-button-ripple.mat-ripple,.mat-button-focus-overlay{top:0;left:0;right:0;bottom:0;position:absolute;pointer-events:none;border-radius:inherit}.mat-button-ripple.mat-ripple:not(:empty){transform:translateZ(0)}.mat-button-focus-overlay{opacity:0;transition:opacity 200ms cubic-bezier(0.35, 0, 0.25, 1),background-color 200ms cubic-bezier(0.35, 0, 0.25, 1)}._mat-animation-noopable .mat-button-focus-overlay{transition:none}.mat-button-ripple-round{border-radius:50%;z-index:1}.mat-button .mat-button-wrapper>*,.mat-flat-button .mat-button-wrapper>*,.mat-stroked-button .mat-button-wrapper>*,.mat-raised-button .mat-button-wrapper>*,.mat-icon-button .mat-button-wrapper>*,.mat-fab .mat-button-wrapper>*,.mat-mini-fab .mat-button-wrapper>*{vertical-align:middle}.mat-form-field:not(.mat-form-field-appearance-legacy) .mat-form-field-prefix .mat-icon-button,.mat-form-field:not(.mat-form-field-appearance-legacy) .mat-form-field-suffix .mat-icon-button{display:inline-flex;justify-content:center;align-items:center;font-size:inherit;width:2.5em;height:2.5em}.mat-flat-button::before,.mat-raised-button::before,.mat-fab::before,.mat-mini-fab::before{margin:calc(calc(var(--mat-focus-indicator-border-width, 3px) + 2px) * -1)}.mat-stroked-button::before{margin:calc(calc(var(--mat-focus-indicator-border-width, 3px) + 3px) * -1)}.cdk-high-contrast-active .mat-button,.cdk-high-contrast-active .mat-flat-button,.cdk-high-contrast-active .mat-raised-button,.cdk-high-contrast-active .mat-icon-button,.cdk-high-contrast-active .mat-fab,.cdk-high-contrast-active .mat-mini-fab{outline:solid 1px}"],encapsulation:2,changeDetection:0}),n})(),Fb=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=Gn({type:n}),n.\u0275inj=Bn({imports:[kb,Ki,Ki]}),n})();function gv(n,e){const t=sr(n)?n:()=>n,i=r=>r.error(t());return new ci(e?r=>e.schedule(i,0,r):i)}function mp(n){return Dr((e,t)=>{let s,i=null,r=!1;i=e.subscribe(Pr(t,void 0,void 0,c=>{s=ws(n(c,mp(n)(e))),i?(i.unsubscribe(),i=null,s.subscribe(t)):r=!0})),r&&(i.unsubscribe(),i=null,s.subscribe(t))})}function yC(n){return Dr((e,t)=>{try{e.subscribe(t)}finally{t.add(n)}})}function tm(n,e){return sr(e)?ze(n,e,1):ze(n,1)}class o3{}class a3{}class gp{constructor(e){this.normalizedNames=new Map,this.lazyUpdate=null,e?this.lazyInit="string"==typeof e?()=>{this.headers=new Map,e.split("\n").forEach(t=>{const i=t.indexOf(":");if(i>0){const r=t.slice(0,i),s=r.toLowerCase(),c=t.slice(i+1).trim();this.maybeSetNormalizedName(r,s),this.headers.has(s)?this.headers.get(s).push(c):this.headers.set(s,[c])}})}:()=>{this.headers=new Map,Object.keys(e).forEach(t=>{let i=e[t];const r=t.toLowerCase();"string"==typeof i&&(i=[i]),i.length>0&&(this.headers.set(r,i),this.maybeSetNormalizedName(t,r))})}:this.headers=new Map}has(e){return this.init(),this.headers.has(e.toLowerCase())}get(e){this.init();const t=this.headers.get(e.toLowerCase());return t&&t.length>0?t[0]:null}keys(){return this.init(),Array.from(this.normalizedNames.values())}getAll(e){return this.init(),this.headers.get(e.toLowerCase())||null}append(e,t){return this.clone({name:e,value:t,op:"a"})}set(e,t){return this.clone({name:e,value:t,op:"s"})}delete(e,t){return this.clone({name:e,value:t,op:"d"})}maybeSetNormalizedName(e,t){this.normalizedNames.has(t)||this.normalizedNames.set(t,e)}init(){this.lazyInit&&(this.lazyInit instanceof gp?this.copyFrom(this.lazyInit):this.lazyInit(),this.lazyInit=null,this.lazyUpdate&&(this.lazyUpdate.forEach(e=>this.applyUpdate(e)),this.lazyUpdate=null))}copyFrom(e){e.init(),Array.from(e.headers.keys()).forEach(t=>{this.headers.set(t,e.headers.get(t)),this.normalizedNames.set(t,e.normalizedNames.get(t))})}clone(e){const t=new gp;return t.lazyInit=this.lazyInit&&this.lazyInit instanceof gp?this.lazyInit:this,t.lazyUpdate=(this.lazyUpdate||[]).concat([e]),t}applyUpdate(e){const t=e.name.toLowerCase();switch(e.op){case"a":case"s":let i=e.value;if("string"==typeof i&&(i=[i]),0===i.length)return;this.maybeSetNormalizedName(e.name,t);const r=("a"===e.op?this.headers.get(t):void 0)||[];r.push(...i),this.headers.set(t,r);break;case"d":const s=e.value;if(s){let c=this.headers.get(t);if(!c)return;c=c.filter(d=>-1===s.indexOf(d)),0===c.length?(this.headers.delete(t),this.normalizedNames.delete(t)):this.headers.set(t,c)}else this.headers.delete(t),this.normalizedNames.delete(t)}}forEach(e){this.init(),Array.from(this.normalizedNames.keys()).forEach(t=>e(this.normalizedNames.get(t),this.headers.get(t)))}}class qq{encodeKey(e){return l3(e)}encodeValue(e){return l3(e)}decodeKey(e){return decodeURIComponent(e)}decodeValue(e){return decodeURIComponent(e)}}const Xq=/%(\d[a-f0-9])/gi,Yq={40:"@","3A":":",24:"$","2C":",","3B":";","3D":"=","3F":"?","2F":"/"};function l3(n){return encodeURIComponent(n).replace(Xq,(e,t)=>Yq[t]??e)}function vC(n){return`${n}`}class nm{constructor(e={}){if(this.updates=null,this.cloneFrom=null,this.encoder=e.encoder||new qq,e.fromString){if(e.fromObject)throw new Error("Cannot specify both fromString and fromObject.");this.map=function Zq(n,e){const t=new Map;return n.length>0&&n.replace(/^\?/,"").split("&").forEach(r=>{const s=r.indexOf("="),[c,d]=-1==s?[e.decodeKey(r),""]:[e.decodeKey(r.slice(0,s)),e.decodeValue(r.slice(s+1))],m=t.get(c)||[];m.push(d),t.set(c,m)}),t}(e.fromString,this.encoder)}else e.fromObject?(this.map=new Map,Object.keys(e.fromObject).forEach(t=>{const i=e.fromObject[t],r=Array.isArray(i)?i.map(vC):[vC(i)];this.map.set(t,r)})):this.map=null}has(e){return this.init(),this.map.has(e)}get(e){this.init();const t=this.map.get(e);return t?t[0]:null}getAll(e){return this.init(),this.map.get(e)||null}keys(){return this.init(),Array.from(this.map.keys())}append(e,t){return this.clone({param:e,value:t,op:"a"})}appendAll(e){const t=[];return Object.keys(e).forEach(i=>{const r=e[i];Array.isArray(r)?r.forEach(s=>{t.push({param:i,value:s,op:"a"})}):t.push({param:i,value:r,op:"a"})}),this.clone(t)}set(e,t){return this.clone({param:e,value:t,op:"s"})}delete(e,t){return this.clone({param:e,value:t,op:"d"})}toString(){return this.init(),this.keys().map(e=>{const t=this.encoder.encodeKey(e);return this.map.get(e).map(i=>t+"="+this.encoder.encodeValue(i)).join("&")}).filter(e=>""!==e).join("&")}clone(e){const t=new nm({encoder:this.encoder});return t.cloneFrom=this.cloneFrom||this,t.updates=(this.updates||[]).concat(e),t}init(){null===this.map&&(this.map=new Map),null!==this.cloneFrom&&(this.cloneFrom.init(),this.cloneFrom.keys().forEach(e=>this.map.set(e,this.cloneFrom.map.get(e))),this.updates.forEach(e=>{switch(e.op){case"a":case"s":const t=("a"===e.op?this.map.get(e.param):void 0)||[];t.push(vC(e.value)),this.map.set(e.param,t);break;case"d":if(void 0===e.value){this.map.delete(e.param);break}{let i=this.map.get(e.param)||[];const r=i.indexOf(vC(e.value));-1!==r&&i.splice(r,1),i.length>0?this.map.set(e.param,i):this.map.delete(e.param)}}}),this.cloneFrom=this.updates=null)}}class Kq{constructor(){this.map=new Map}set(e,t){return this.map.set(e,t),this}get(e){return this.map.has(e)||this.map.set(e,e.defaultValue()),this.map.get(e)}delete(e){return this.map.delete(e),this}has(e){return this.map.has(e)}keys(){return this.map.keys()}}function c3(n){return typeof ArrayBuffer<"u"&&n instanceof ArrayBuffer}function u3(n){return typeof Blob<"u"&&n instanceof Blob}function d3(n){return typeof FormData<"u"&&n instanceof FormData}class Nb{constructor(e,t,i,r){let s;if(this.url=t,this.body=null,this.reportProgress=!1,this.withCredentials=!1,this.responseType="json",this.method=e.toUpperCase(),function Qq(n){switch(n){case"DELETE":case"GET":case"HEAD":case"OPTIONS":case"JSONP":return!1;default:return!0}}(this.method)||r?(this.body=void 0!==i?i:null,s=r):s=i,s&&(this.reportProgress=!!s.reportProgress,this.withCredentials=!!s.withCredentials,s.responseType&&(this.responseType=s.responseType),s.headers&&(this.headers=s.headers),s.context&&(this.context=s.context),s.params&&(this.params=s.params)),this.headers||(this.headers=new gp),this.context||(this.context=new Kq),this.params){const c=this.params.toString();if(0===c.length)this.urlWithParams=t;else{const d=t.indexOf("?");this.urlWithParams=t+(-1===d?"?":d<t.length-1?"&":"")+c}}else this.params=new nm,this.urlWithParams=t}serializeBody(){return null===this.body?null:c3(this.body)||u3(this.body)||d3(this.body)||function Jq(n){return typeof URLSearchParams<"u"&&n instanceof URLSearchParams}(this.body)||"string"==typeof this.body?this.body:this.body instanceof nm?this.body.toString():"object"==typeof this.body||"boolean"==typeof this.body||Array.isArray(this.body)?JSON.stringify(this.body):this.body.toString()}detectContentTypeHeader(){return null===this.body||d3(this.body)?null:u3(this.body)?this.body.type||null:c3(this.body)?null:"string"==typeof this.body?"text/plain":this.body instanceof nm?"application/x-www-form-urlencoded;charset=UTF-8":"object"==typeof this.body||"number"==typeof this.body||"boolean"==typeof this.body?"application/json":null}clone(e={}){const t=e.method||this.method,i=e.url||this.url,r=e.responseType||this.responseType,s=void 0!==e.body?e.body:this.body,c=void 0!==e.withCredentials?e.withCredentials:this.withCredentials,d=void 0!==e.reportProgress?e.reportProgress:this.reportProgress;let m=e.headers||this.headers,y=e.params||this.params;const w=e.context??this.context;return void 0!==e.setHeaders&&(m=Object.keys(e.setHeaders).reduce((S,T)=>S.set(T,e.setHeaders[T]),m)),e.setParams&&(y=Object.keys(e.setParams).reduce((S,T)=>S.set(T,e.setParams[T]),y)),new Nb(t,i,s,{params:y,headers:m,context:w,reportProgress:d,responseType:r,withCredentials:c})}}var Co=(()=>((Co=Co||{})[Co.Sent=0]="Sent",Co[Co.UploadProgress=1]="UploadProgress",Co[Co.ResponseHeader=2]="ResponseHeader",Co[Co.DownloadProgress=3]="DownloadProgress",Co[Co.Response=4]="Response",Co[Co.User=5]="User",Co))();class OA{constructor(e,t=200,i="OK"){this.headers=e.headers||new gp,this.status=void 0!==e.status?e.status:t,this.statusText=e.statusText||i,this.url=e.url||null,this.ok=this.status>=200&&this.status<300}}class FA extends OA{constructor(e={}){super(e),this.type=Co.ResponseHeader}clone(e={}){return new FA({headers:e.headers||this.headers,status:void 0!==e.status?e.status:this.status,statusText:e.statusText||this.statusText,url:e.url||this.url||void 0})}}class xC extends OA{constructor(e={}){super(e),this.type=Co.Response,this.body=void 0!==e.body?e.body:null}clone(e={}){return new xC({body:void 0!==e.body?e.body:this.body,headers:e.headers||this.headers,status:void 0!==e.status?e.status:this.status,statusText:e.statusText||this.statusText,url:e.url||this.url||void 0})}}class h3 extends OA{constructor(e){super(e,0,"Unknown Error"),this.name="HttpErrorResponse",this.ok=!1,this.message=this.status>=200&&this.status<300?`Http failure during parsing for ${e.url||"(unknown url)"}`:`Http failure response for ${e.url||"(unknown url)"}: ${e.status} ${e.statusText}`,this.error=e.error||null}}function NA(n,e){return{body:e,headers:n.headers,context:n.context,observe:n.observe,params:n.params,reportProgress:n.reportProgress,responseType:n.responseType,withCredentials:n.withCredentials}}let _v=(()=>{class n{constructor(t){this.handler=t}request(t,i,r={}){let s;if(t instanceof Nb)s=t;else{let m,y;m=r.headers instanceof gp?r.headers:new gp(r.headers),r.params&&(y=r.params instanceof nm?r.params:new nm({fromObject:r.params})),s=new Nb(t,i,void 0!==r.body?r.body:null,{headers:m,context:r.context,params:y,reportProgress:r.reportProgress,responseType:r.responseType||"json",withCredentials:r.withCredentials})}const c=jn(s).pipe(tm(m=>this.handler.handle(m)));if(t instanceof Nb||"events"===r.observe)return c;const d=c.pipe(na(m=>m instanceof xC));switch(r.observe||"body"){case"body":switch(s.responseType){case"arraybuffer":return d.pipe(ei(m=>{if(null!==m.body&&!(m.body instanceof ArrayBuffer))throw new Error("Response is not an ArrayBuffer.");return m.body}));case"blob":return d.pipe(ei(m=>{if(null!==m.body&&!(m.body instanceof Blob))throw new Error("Response is not a Blob.");return m.body}));case"text":return d.pipe(ei(m=>{if(null!==m.body&&"string"!=typeof m.body)throw new Error("Response is not a string.");return m.body}));default:return d.pipe(ei(m=>m.body))}case"response":return d;default:throw new Error(`Unreachable: unhandled observe type ${r.observe}}`)}}delete(t,i={}){return this.request("DELETE",t,i)}get(t,i={}){return this.request("GET",t,i)}head(t,i={}){return this.request("HEAD",t,i)}jsonp(t,i){return this.request("JSONP",t,{params:(new nm).append(i,"JSONP_CALLBACK"),observe:"body",responseType:"json"})}options(t,i={}){return this.request("OPTIONS",t,i)}patch(t,i,r={}){return this.request("PATCH",t,NA(r,i))}post(t,i,r={}){return this.request("POST",t,NA(r,i))}put(t,i,r={}){return this.request("PUT",t,NA(r,i))}}return n.\u0275fac=function(t){return new(t||n)(Xe(o3))},n.\u0275prov=Yt({token:n,factory:n.\u0275fac}),n})();class p3{constructor(e,t){this.next=e,this.interceptor=t}handle(e){return this.interceptor.intercept(e,this.next)}}const f3=new Vt("HTTP_INTERCEPTORS");let e9=(()=>{class n{intercept(t,i){return i.handle(t)}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=Yt({token:n,factory:n.\u0275fac}),n})();const t9=/^\)\]\}',?\n/;let m3=(()=>{class n{constructor(t){this.xhrFactory=t}handle(t){if("JSONP"===t.method)throw new Error("Attempted to construct Jsonp request without HttpClientJsonpModule installed.");return new ci(i=>{const r=this.xhrFactory.build();if(r.open(t.method,t.urlWithParams),t.withCredentials&&(r.withCredentials=!0),t.headers.forEach((I,R)=>r.setRequestHeader(I,R.join(","))),t.headers.has("Accept")||r.setRequestHeader("Accept","application/json, text/plain, */*"),!t.headers.has("Content-Type")){const I=t.detectContentTypeHeader();null!==I&&r.setRequestHeader("Content-Type",I)}if(t.responseType){const I=t.responseType.toLowerCase();r.responseType="json"!==I?I:"text"}const s=t.serializeBody();let c=null;const d=()=>{if(null!==c)return c;const I=r.statusText||"OK",R=new gp(r.getAllResponseHeaders()),k=function n9(n){return"responseURL"in n&&n.responseURL?n.responseURL:/^X-Request-URL:/m.test(n.getAllResponseHeaders())?n.getResponseHeader("X-Request-URL"):null}(r)||t.url;return c=new FA({headers:R,status:r.status,statusText:I,url:k}),c},m=()=>{let{headers:I,status:R,statusText:k,url:F}=d(),G=null;204!==R&&(G=typeof r.response>"u"?r.responseText:r.response),0===R&&(R=G?200:0);let W=R>=200&&R<300;if("json"===t.responseType&&"string"==typeof G){const V=G;G=G.replace(t9,"");try{G=""!==G?JSON.parse(G):null}catch(X){G=V,W&&(W=!1,G={error:X,text:G})}}W?(i.next(new xC({body:G,headers:I,status:R,statusText:k,url:F||void 0})),i.complete()):i.error(new h3({error:G,headers:I,status:R,statusText:k,url:F||void 0}))},y=I=>{const{url:R}=d(),k=new h3({error:I,status:r.status||0,statusText:r.statusText||"Unknown Error",url:R||void 0});i.error(k)};let w=!1;const S=I=>{w||(i.next(d()),w=!0);let R={type:Co.DownloadProgress,loaded:I.loaded};I.lengthComputable&&(R.total=I.total),"text"===t.responseType&&!!r.responseText&&(R.partialText=r.responseText),i.next(R)},T=I=>{let R={type:Co.UploadProgress,loaded:I.loaded};I.lengthComputable&&(R.total=I.total),i.next(R)};return r.addEventListener("load",m),r.addEventListener("error",y),r.addEventListener("timeout",y),r.addEventListener("abort",y),t.reportProgress&&(r.addEventListener("progress",S),null!==s&&r.upload&&r.upload.addEventListener("progress",T)),r.send(s),i.next({type:Co.Sent}),()=>{r.removeEventListener("error",y),r.removeEventListener("abort",y),r.removeEventListener("load",m),r.removeEventListener("timeout",y),t.reportProgress&&(r.removeEventListener("progress",S),null!==s&&r.upload&&r.upload.removeEventListener("progress",T)),r.readyState!==r.DONE&&r.abort()}})}}return n.\u0275fac=function(t){return new(t||n)(Xe(NO))},n.\u0275prov=Yt({token:n,factory:n.\u0275fac}),n})();const BA=new Vt("XSRF_COOKIE_NAME"),zA=new Vt("XSRF_HEADER_NAME");class g3{}let r9=(()=>{class n{constructor(t,i,r){this.doc=t,this.platform=i,this.cookieName=r,this.lastCookieString="",this.lastToken=null,this.parseCount=0}getToken(){if("server"===this.platform)return null;const t=this.doc.cookie||"";return t!==this.lastCookieString&&(this.parseCount++,this.lastToken=EO(t,this.cookieName),this.lastCookieString=t),this.lastToken}}return n.\u0275fac=function(t){return new(t||n)(Xe(Vi),Xe(LM),Xe(BA))},n.\u0275prov=Yt({token:n,factory:n.\u0275fac}),n})(),VA=(()=>{class n{constructor(t,i){this.tokenService=t,this.headerName=i}intercept(t,i){const r=t.url.toLowerCase();if("GET"===t.method||"HEAD"===t.method||r.startsWith("http://")||r.startsWith("https://"))return i.handle(t);const s=this.tokenService.getToken();return null!==s&&!t.headers.has(this.headerName)&&(t=t.clone({headers:t.headers.set(this.headerName,s)})),i.handle(t)}}return n.\u0275fac=function(t){return new(t||n)(Xe(g3),Xe(zA))},n.\u0275prov=Yt({token:n,factory:n.\u0275fac}),n})(),s9=(()=>{class n{constructor(t,i){this.backend=t,this.injector=i,this.chain=null}handle(t){if(null===this.chain){const i=this.injector.get(f3,[]);this.chain=i.reduceRight((r,s)=>new p3(r,s),this.backend)}return this.chain.handle(t)}}return n.\u0275fac=function(t){return new(t||n)(Xe(a3),Xe(Yr))},n.\u0275prov=Yt({token:n,factory:n.\u0275fac}),n})(),o9=(()=>{class n{static disable(){return{ngModule:n,providers:[{provide:VA,useClass:e9}]}}static withOptions(t={}){return{ngModule:n,providers:[t.cookieName?{provide:BA,useValue:t.cookieName}:[],t.headerName?{provide:zA,useValue:t.headerName}:[]]}}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=Gn({type:n}),n.\u0275inj=Bn({providers:[VA,{provide:f3,useExisting:VA,multi:!0},{provide:g3,useClass:r9},{provide:BA,useValue:"XSRF-TOKEN"},{provide:zA,useValue:"X-XSRF-TOKEN"}]}),n})(),a9=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=Gn({type:n}),n.\u0275inj=Bn({providers:[_v,{provide:o3,useClass:s9},m3,{provide:a3,useExisting:m3}],imports:[o9.withOptions({cookieName:"XSRF-TOKEN",headerName:"X-XSRF-TOKEN"})]}),n})(),b3=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=Gn({type:n}),n.\u0275inj=Bn({imports:[Ki,Ki]}),n})(),HA=(()=>{class n{constructor(){this.changes=new si,this.optionalLabel="Optional",this.completedLabel="Completed",this.editableLabel="Editable"}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=Yt({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();const M9={provide:HA,deps:[[new ls,new $r,HA]],useFactory:function w9(n){return n||new HA}};let C9=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=Gn({type:n}),n.\u0275inj=Bn({providers:[M9,wA],imports:[Ki,au,Lb,Fb,Vq,b3,kb,Ki]}),n})(),S3=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=Gn({type:n}),n.\u0275inj=Bn({}),n})(),E9=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=Gn({type:n}),n.\u0275inj=Bn({providers:[wA],imports:[S3,_C,Ki,S3,_C]}),n})();const zb={schedule(n){let e=requestAnimationFrame,t=cancelAnimationFrame;const{delegate:i}=zb;i&&(e=i.requestAnimationFrame,t=i.cancelAnimationFrame);const r=e(s=>{t=void 0,n(s)});return new lt(()=>t?.(r))},requestAnimationFrame(...n){const{delegate:e}=zb;return(e?.requestAnimationFrame||requestAnimationFrame)(...n)},cancelAnimationFrame(...n){const{delegate:e}=zb;return(e?.cancelAnimationFrame||cancelAnimationFrame)(...n)},delegate:void 0};new class D9 extends pA{flush(e){this._active=!0;const t=this._scheduled;this._scheduled=void 0;const{actions:i}=this;let r;e=e||i.shift();do{if(r=e.execute(e.state,e.delay))break}while((e=i[0])&&e.id===t&&i.shift());if(this._active=!1,r){for(;(e=i[0])&&e.id===t&&i.shift();)e.unsubscribe();throw r}}}(class T9 extends hA{constructor(e,t){super(e,t),this.scheduler=e,this.work=t}requestAsyncId(e,t,i=0){return null!==i&&i>0?super.requestAsyncId(e,t,i):(e.actions.push(this),e._scheduled||(e._scheduled=zb.requestAnimationFrame(()=>e.flush(void 0))))}recycleAsyncId(e,t,i=0){var r;if(null!=i?i>0:this.delay>0)return super.recycleAsyncId(e,t,i);const{actions:s}=e;null!=t&&(null===(r=s[s.length-1])||void 0===r?void 0:r.id)!==t&&(zb.cancelAnimationFrame(t),e._scheduled=void 0)}});let GA,I9=1;const MC={};function E3(n){return n in MC&&(delete MC[n],!0)}const P9={setImmediate(n){const e=I9++;return MC[e]=!0,GA||(GA=Promise.resolve()),GA.then(()=>E3(e)&&n()),e},clearImmediate(n){E3(n)}},{setImmediate:R9,clearImmediate:k9}=P9,CC={setImmediate(...n){const{delegate:e}=CC;return(e?.setImmediate||R9)(...n)},clearImmediate(n){const{delegate:e}=CC;return(e?.clearImmediate||k9)(n)},delegate:void 0};new class O9 extends pA{flush(e){this._active=!0;const t=this._scheduled;this._scheduled=void 0;const{actions:i}=this;let r;e=e||i.shift();do{if(r=e.execute(e.state,e.delay))break}while((e=i[0])&&e.id===t&&i.shift());if(this._active=!1,r){for(;(e=i[0])&&e.id===t&&i.shift();)e.unsubscribe();throw r}}}(class L9 extends hA{constructor(e,t){super(e,t),this.scheduler=e,this.work=t}requestAsyncId(e,t,i=0){return null!==i&&i>0?super.requestAsyncId(e,t,i):(e.actions.push(this),e._scheduled||(e._scheduled=CC.setImmediate(e.flush.bind(e,void 0))))}recycleAsyncId(e,t,i=0){var r;if(null!=i?i>0:this.delay>0)return super.recycleAsyncId(e,t,i);const{actions:s}=e;null!=t&&(null===(r=s[s.length-1])||void 0===r?void 0:r.id)!==t&&(CC.clearImmediate(t),e._scheduled=void 0)}});function T3(n,e=fA){return function N9(n){return Dr((e,t)=>{let i=!1,r=null,s=null,c=!1;const d=()=>{if(s?.unsubscribe(),s=null,i){i=!1;const y=r;r=null,t.next(y)}c&&t.complete()},m=()=>{s=null,c&&t.complete()};e.subscribe(Pr(t,y=>{i=!0,r=y,s||ws(n(y)).subscribe(s=Pr(t,d,m))},()=>{c=!0,(!i||!s||s.closed)&&t.complete()}))})}(()=>function z9(n=0,e,t=A$){let i=-1;return null!=e&&(Sn(e)?t=e:i=e),new ci(r=>{let s=function B9(n){return n instanceof Date&&!isNaN(n)}(n)?+n-t.now():n;s<0&&(s=0);let c=0;return t.schedule(function(){r.closed||(r.next(c++),0<=i?this.schedule(void 0,i):r.complete())},s)})}(n,e))}let U9=(()=>{class n{constructor(t,i,r){this._ngZone=t,this._platform=i,this._scrolled=new si,this._globalSubscription=null,this._scrolledCount=0,this.scrollContainers=new Map,this._document=r}register(t){this.scrollContainers.has(t)||this.scrollContainers.set(t,t.elementScrolled().subscribe(()=>this._scrolled.next(t)))}deregister(t){const i=this.scrollContainers.get(t);i&&(i.unsubscribe(),this.scrollContainers.delete(t))}scrolled(t=20){return this._platform.isBrowser?new ci(i=>{this._globalSubscription||this._addGlobalListener();const r=t>0?this._scrolled.pipe(T3(t)).subscribe(i):this._scrolled.subscribe(i);return this._scrolledCount++,()=>{r.unsubscribe(),this._scrolledCount--,this._scrolledCount||this._removeGlobalListener()}}):jn()}ngOnDestroy(){this._removeGlobalListener(),this.scrollContainers.forEach((t,i)=>this.deregister(i)),this._scrolled.complete()}ancestorScrolled(t,i){const r=this.getAncestorScrollContainers(t);return this.scrolled(i).pipe(na(s=>!s||r.indexOf(s)>-1))}getAncestorScrollContainers(t){const i=[];return this.scrollContainers.forEach((r,s)=>{this._scrollableContainsElement(s,t)&&i.push(s)}),i}_getWindow(){return this._document.defaultView||window}_scrollableContainsElement(t,i){let r=kg(i),s=t.getElementRef().nativeElement;do{if(r==s)return!0}while(r=r.parentElement);return!1}_addGlobalListener(){this._globalSubscription=this._ngZone.runOutsideAngular(()=>gC(this._getWindow().document,"scroll").subscribe(()=>this._scrolled.next()))}_removeGlobalListener(){this._globalSubscription&&(this._globalSubscription.unsubscribe(),this._globalSubscription=null)}}return n.\u0275fac=function(t){return new(t||n)(Xe(nr),Xe(lu),Xe(Vi,8))},n.\u0275prov=Yt({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),jA=(()=>{class n{constructor(t,i,r){this._platform=t,this._change=new si,this._changeListener=s=>{this._change.next(s)},this._document=r,i.runOutsideAngular(()=>{if(t.isBrowser){const s=this._getWindow();s.addEventListener("resize",this._changeListener),s.addEventListener("orientationchange",this._changeListener)}this.change().subscribe(()=>this._viewportSize=null)})}ngOnDestroy(){if(this._platform.isBrowser){const t=this._getWindow();t.removeEventListener("resize",this._changeListener),t.removeEventListener("orientationchange",this._changeListener)}this._change.complete()}getViewportSize(){this._viewportSize||this._updateViewportSize();const t={width:this._viewportSize.width,height:this._viewportSize.height};return this._platform.isBrowser||(this._viewportSize=null),t}getViewportRect(){const t=this.getViewportScrollPosition(),{width:i,height:r}=this.getViewportSize();return{top:t.top,left:t.left,bottom:t.top+r,right:t.left+i,height:r,width:i}}getViewportScrollPosition(){if(!this._platform.isBrowser)return{top:0,left:0};const t=this._document,i=this._getWindow(),r=t.documentElement,s=r.getBoundingClientRect();return{top:-s.top||t.body.scrollTop||i.scrollY||r.scrollTop||0,left:-s.left||t.body.scrollLeft||i.scrollX||r.scrollLeft||0}}change(t=20){return t>0?this._change.pipe(T3(t)):this._change}_getWindow(){return this._document.defaultView||window}_updateViewportSize(){const t=this._getWindow();this._viewportSize=this._platform.isBrowser?{width:t.innerWidth,height:t.innerHeight}:{width:0,height:0}}}return n.\u0275fac=function(t){return new(t||n)(Xe(lu),Xe(nr),Xe(Vi,8))},n.\u0275prov=Yt({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),Vb=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=Gn({type:n}),n.\u0275inj=Bn({}),n})(),D3=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=Gn({type:n}),n.\u0275inj=Bn({imports:[mv,Vb,mv,Vb]}),n})();function A3(n,e=!1){return Dr((t,i)=>{let r=0;t.subscribe(Pr(i,s=>{const c=n(s,r++);(c||e)&&i.next(s),!c&&i.complete()}))})}const I3=g$();class G9{constructor(e,t){this._viewportRuler=e,this._previousHTMLStyles={top:"",left:""},this._isEnabled=!1,this._document=t}attach(){}enable(){if(this._canBeEnabled()){const e=this._document.documentElement;this._previousScrollPosition=this._viewportRuler.getViewportScrollPosition(),this._previousHTMLStyles.left=e.style.left||"",this._previousHTMLStyles.top=e.style.top||"",e.style.left=wo(-this._previousScrollPosition.left),e.style.top=wo(-this._previousScrollPosition.top),e.classList.add("cdk-global-scrollblock"),this._isEnabled=!0}}disable(){if(this._isEnabled){const e=this._document.documentElement,i=e.style,r=this._document.body.style,s=i.scrollBehavior||"",c=r.scrollBehavior||"";this._isEnabled=!1,i.left=this._previousHTMLStyles.left,i.top=this._previousHTMLStyles.top,e.classList.remove("cdk-global-scrollblock"),I3&&(i.scrollBehavior=r.scrollBehavior="auto"),window.scroll(this._previousScrollPosition.left,this._previousScrollPosition.top),I3&&(i.scrollBehavior=s,r.scrollBehavior=c)}}_canBeEnabled(){if(this._document.documentElement.classList.contains("cdk-global-scrollblock")||this._isEnabled)return!1;const t=this._document.body,i=this._viewportRuler.getViewportSize();return t.scrollHeight>i.height||t.scrollWidth>i.width}}class j9{constructor(e,t,i,r){this._scrollDispatcher=e,this._ngZone=t,this._viewportRuler=i,this._config=r,this._scrollSubscription=null,this._detach=()=>{this.disable(),this._overlayRef.hasAttached()&&this._ngZone.run(()=>this._overlayRef.detach())}}attach(e){this._overlayRef=e}enable(){if(this._scrollSubscription)return;const e=this._scrollDispatcher.scrolled(0);this._config&&this._config.threshold&&this._config.threshold>1?(this._initialScrollPosition=this._viewportRuler.getViewportScrollPosition().top,this._scrollSubscription=e.subscribe(()=>{const t=this._viewportRuler.getViewportScrollPosition().top;Math.abs(t-this._initialScrollPosition)>this._config.threshold?this._detach():this._overlayRef.updatePosition()})):this._scrollSubscription=e.subscribe(this._detach)}disable(){this._scrollSubscription&&(this._scrollSubscription.unsubscribe(),this._scrollSubscription=null)}detach(){this.disable(),this._overlayRef=null}}class P3{enable(){}disable(){}attach(){}}function $A(n,e){return e.some(t=>n.bottom<t.top||n.top>t.bottom||n.right<t.left||n.left>t.right)}function R3(n,e){return e.some(t=>n.top<t.top||n.bottom>t.bottom||n.left<t.left||n.right>t.right)}class $9{constructor(e,t,i,r){this._scrollDispatcher=e,this._viewportRuler=t,this._ngZone=i,this._config=r,this._scrollSubscription=null}attach(e){this._overlayRef=e}enable(){this._scrollSubscription||(this._scrollSubscription=this._scrollDispatcher.scrolled(this._config?this._config.scrollThrottle:0).subscribe(()=>{if(this._overlayRef.updatePosition(),this._config&&this._config.autoClose){const t=this._overlayRef.overlayElement.getBoundingClientRect(),{width:i,height:r}=this._viewportRuler.getViewportSize();$A(t,[{width:i,height:r,bottom:r,right:i,top:0,left:0}])&&(this.disable(),this._ngZone.run(()=>this._overlayRef.detach()))}}))}disable(){this._scrollSubscription&&(this._scrollSubscription.unsubscribe(),this._scrollSubscription=null)}detach(){this.disable(),this._overlayRef=null}}let W9=(()=>{class n{constructor(t,i,r,s){this._scrollDispatcher=t,this._viewportRuler=i,this._ngZone=r,this.noop=()=>new P3,this.close=c=>new j9(this._scrollDispatcher,this._ngZone,this._viewportRuler,c),this.block=()=>new G9(this._viewportRuler,this._document),this.reposition=c=>new $9(this._scrollDispatcher,this._viewportRuler,this._ngZone,c),this._document=s}}return n.\u0275fac=function(t){return new(t||n)(Xe(U9),Xe(jA),Xe(nr),Xe(Vi))},n.\u0275prov=Yt({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();class k3{constructor(e){if(this.scrollStrategy=new P3,this.panelClass="",this.hasBackdrop=!1,this.backdropClass="cdk-overlay-dark-backdrop",this.disposeOnNavigation=!1,e){const t=Object.keys(e);for(const i of t)void 0!==e[i]&&(this[i]=e[i])}}}class q9{constructor(e,t){this.connectionPair=e,this.scrollableViewProperties=t}}let L3=(()=>{class n{constructor(t){this._attachedOverlays=[],this._document=t}ngOnDestroy(){this.detach()}add(t){this.remove(t),this._attachedOverlays.push(t)}remove(t){const i=this._attachedOverlays.indexOf(t);i>-1&&this._attachedOverlays.splice(i,1),0===this._attachedOverlays.length&&this.detach()}}return n.\u0275fac=function(t){return new(t||n)(Xe(Vi))},n.\u0275prov=Yt({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),Z9=(()=>{class n extends L3{constructor(t,i){super(t),this._ngZone=i,this._keydownListener=r=>{const s=this._attachedOverlays;for(let c=s.length-1;c>-1;c--)if(s[c]._keydownEvents.observers.length>0){const d=s[c]._keydownEvents;this._ngZone?this._ngZone.run(()=>d.next(r)):d.next(r);break}}}add(t){super.add(t),this._isAttached||(this._ngZone?this._ngZone.runOutsideAngular(()=>this._document.body.addEventListener("keydown",this._keydownListener)):this._document.body.addEventListener("keydown",this._keydownListener),this._isAttached=!0)}detach(){this._isAttached&&(this._document.body.removeEventListener("keydown",this._keydownListener),this._isAttached=!1)}}return n.\u0275fac=function(t){return new(t||n)(Xe(Vi),Xe(nr,8))},n.\u0275prov=Yt({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),X9=(()=>{class n extends L3{constructor(t,i,r){super(t),this._platform=i,this._ngZone=r,this._cursorStyleIsSet=!1,this._pointerDownListener=s=>{this._pointerDownEventTarget=Rg(s)},this._clickListener=s=>{const c=Rg(s),d="click"===s.type&&this._pointerDownEventTarget?this._pointerDownEventTarget:c;this._pointerDownEventTarget=null;const m=this._attachedOverlays.slice();for(let y=m.length-1;y>-1;y--){const w=m[y];if(w._outsidePointerEvents.observers.length<1||!w.hasAttached())continue;if(w.overlayElement.contains(c)||w.overlayElement.contains(d))break;const S=w._outsidePointerEvents;this._ngZone?this._ngZone.run(()=>S.next(s)):S.next(s)}}}add(t){if(super.add(t),!this._isAttached){const i=this._document.body;this._ngZone?this._ngZone.runOutsideAngular(()=>this._addEventListeners(i)):this._addEventListeners(i),this._platform.IOS&&!this._cursorStyleIsSet&&(this._cursorOriginalValue=i.style.cursor,i.style.cursor="pointer",this._cursorStyleIsSet=!0),this._isAttached=!0}}detach(){if(this._isAttached){const t=this._document.body;t.removeEventListener("pointerdown",this._pointerDownListener,!0),t.removeEventListener("click",this._clickListener,!0),t.removeEventListener("auxclick",this._clickListener,!0),t.removeEventListener("contextmenu",this._clickListener,!0),this._platform.IOS&&this._cursorStyleIsSet&&(t.style.cursor=this._cursorOriginalValue,this._cursorStyleIsSet=!1),this._isAttached=!1}}_addEventListeners(t){t.addEventListener("pointerdown",this._pointerDownListener,!0),t.addEventListener("click",this._clickListener,!0),t.addEventListener("auxclick",this._clickListener,!0),t.addEventListener("contextmenu",this._clickListener,!0)}}return n.\u0275fac=function(t){return new(t||n)(Xe(Vi),Xe(lu),Xe(nr,8))},n.\u0275prov=Yt({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),O3=(()=>{class n{constructor(t,i){this._platform=i,this._document=t}ngOnDestroy(){this._containerElement?.remove()}getContainerElement(){return this._containerElement||this._createContainer(),this._containerElement}_createContainer(){const t="cdk-overlay-container";if(this._platform.isBrowser||uA()){const r=this._document.querySelectorAll(`.${t}[platform="server"], .${t}[platform="test"]`);for(let s=0;s<r.length;s++)r[s].remove()}const i=this._document.createElement("div");i.classList.add(t),uA()?i.setAttribute("platform","test"):this._platform.isBrowser||i.setAttribute("platform","server"),this._document.body.appendChild(i),this._containerElement=i}}return n.\u0275fac=function(t){return new(t||n)(Xe(Vi),Xe(lu))},n.\u0275prov=Yt({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();class Y9{constructor(e,t,i,r,s,c,d,m,y,w=!1){this._portalOutlet=e,this._host=t,this._pane=i,this._config=r,this._ngZone=s,this._keyboardDispatcher=c,this._document=d,this._location=m,this._outsideClickDispatcher=y,this._animationsDisabled=w,this._backdropElement=null,this._backdropClick=new si,this._attachments=new si,this._detachments=new si,this._locationChanges=lt.EMPTY,this._backdropClickHandler=S=>this._backdropClick.next(S),this._backdropTransitionendHandler=S=>{this._disposeBackdrop(S.target)},this._keydownEvents=new si,this._outsidePointerEvents=new si,r.scrollStrategy&&(this._scrollStrategy=r.scrollStrategy,this._scrollStrategy.attach(this)),this._positionStrategy=r.positionStrategy}get overlayElement(){return this._pane}get backdropElement(){return this._backdropElement}get hostElement(){return this._host}attach(e){!this._host.parentElement&&this._previousHostParent&&this._previousHostParent.appendChild(this._host);const t=this._portalOutlet.attach(e);return this._positionStrategy&&this._positionStrategy.attach(this),this._updateStackingOrder(),this._updateElementSize(),this._updateElementDirection(),this._scrollStrategy&&this._scrollStrategy.enable(),this._ngZone.onStable.pipe(xc(1)).subscribe(()=>{this.hasAttached()&&this.updatePosition()}),this._togglePointerEvents(!0),this._config.hasBackdrop&&this._attachBackdrop(),this._config.panelClass&&this._toggleClasses(this._pane,this._config.panelClass,!0),this._attachments.next(),this._keyboardDispatcher.add(this),this._config.disposeOnNavigation&&(this._locationChanges=this._location.subscribe(()=>this.dispose())),this._outsideClickDispatcher.add(this),"function"==typeof t?.onDestroy&&t.onDestroy(()=>{this.hasAttached()&&this._ngZone.runOutsideAngular(()=>Promise.resolve().then(()=>this.detach()))}),t}detach(){if(!this.hasAttached())return;this.detachBackdrop(),this._togglePointerEvents(!1),this._positionStrategy&&this._positionStrategy.detach&&this._positionStrategy.detach(),this._scrollStrategy&&this._scrollStrategy.disable();const e=this._portalOutlet.detach();return this._detachments.next(),this._keyboardDispatcher.remove(this),this._detachContentWhenStable(),this._locationChanges.unsubscribe(),this._outsideClickDispatcher.remove(this),e}dispose(){const e=this.hasAttached();this._positionStrategy&&this._positionStrategy.dispose(),this._disposeScrollStrategy(),this._disposeBackdrop(this._backdropElement),this._locationChanges.unsubscribe(),this._keyboardDispatcher.remove(this),this._portalOutlet.dispose(),this._attachments.complete(),this._backdropClick.complete(),this._keydownEvents.complete(),this._outsidePointerEvents.complete(),this._outsideClickDispatcher.remove(this),this._host?.remove(),this._previousHostParent=this._pane=this._host=null,e&&this._detachments.next(),this._detachments.complete()}hasAttached(){return this._portalOutlet.hasAttached()}backdropClick(){return this._backdropClick}attachments(){return this._attachments}detachments(){return this._detachments}keydownEvents(){return this._keydownEvents}outsidePointerEvents(){return this._outsidePointerEvents}getConfig(){return this._config}updatePosition(){this._positionStrategy&&this._positionStrategy.apply()}updatePositionStrategy(e){e!==this._positionStrategy&&(this._positionStrategy&&this._positionStrategy.dispose(),this._positionStrategy=e,this.hasAttached()&&(e.attach(this),this.updatePosition()))}updateSize(e){this._config={...this._config,...e},this._updateElementSize()}setDirection(e){this._config={...this._config,direction:e},this._updateElementDirection()}addPanelClass(e){this._pane&&this._toggleClasses(this._pane,e,!0)}removePanelClass(e){this._pane&&this._toggleClasses(this._pane,e,!1)}getDirection(){const e=this._config.direction;return e?"string"==typeof e?e:e.value:"ltr"}updateScrollStrategy(e){e!==this._scrollStrategy&&(this._disposeScrollStrategy(),this._scrollStrategy=e,this.hasAttached()&&(e.attach(this),e.enable()))}_updateElementDirection(){this._host.setAttribute("dir",this.getDirection())}_updateElementSize(){if(!this._pane)return;const e=this._pane.style;e.width=wo(this._config.width),e.height=wo(this._config.height),e.minWidth=wo(this._config.minWidth),e.minHeight=wo(this._config.minHeight),e.maxWidth=wo(this._config.maxWidth),e.maxHeight=wo(this._config.maxHeight)}_togglePointerEvents(e){this._pane.style.pointerEvents=e?"":"none"}_attachBackdrop(){const e="cdk-overlay-backdrop-showing";this._backdropElement=this._document.createElement("div"),this._backdropElement.classList.add("cdk-overlay-backdrop"),this._animationsDisabled&&this._backdropElement.classList.add("cdk-overlay-backdrop-noop-animation"),this._config.backdropClass&&this._toggleClasses(this._backdropElement,this._config.backdropClass,!0),this._host.parentElement.insertBefore(this._backdropElement,this._host),this._backdropElement.addEventListener("click",this._backdropClickHandler),!this._animationsDisabled&&typeof requestAnimationFrame<"u"?this._ngZone.runOutsideAngular(()=>{requestAnimationFrame(()=>{this._backdropElement&&this._backdropElement.classList.add(e)})}):this._backdropElement.classList.add(e)}_updateStackingOrder(){this._host.nextSibling&&this._host.parentNode.appendChild(this._host)}detachBackdrop(){const e=this._backdropElement;if(e){if(this._animationsDisabled)return void this._disposeBackdrop(e);e.classList.remove("cdk-overlay-backdrop-showing"),this._ngZone.runOutsideAngular(()=>{e.addEventListener("transitionend",this._backdropTransitionendHandler)}),e.style.pointerEvents="none",this._backdropTimeout=this._ngZone.runOutsideAngular(()=>setTimeout(()=>{this._disposeBackdrop(e)},500))}}_toggleClasses(e,t,i){const r=cC(t||[]).filter(s=>!!s);r.length&&(i?e.classList.add(...r):e.classList.remove(...r))}_detachContentWhenStable(){this._ngZone.runOutsideAngular(()=>{const e=this._ngZone.onStable.pipe(ia(so(this._attachments,this._detachments))).subscribe(()=>{(!this._pane||!this._host||0===this._pane.children.length)&&(this._pane&&this._config.panelClass&&this._toggleClasses(this._pane,this._config.panelClass,!1),this._host&&this._host.parentElement&&(this._previousHostParent=this._host.parentElement,this._host.remove()),e.unsubscribe())})})}_disposeScrollStrategy(){const e=this._scrollStrategy;e&&(e.disable(),e.detach&&e.detach())}_disposeBackdrop(e){e&&(e.removeEventListener("click",this._backdropClickHandler),e.removeEventListener("transitionend",this._backdropTransitionendHandler),e.remove(),this._backdropElement===e&&(this._backdropElement=null)),this._backdropTimeout&&(clearTimeout(this._backdropTimeout),this._backdropTimeout=void 0)}}const F3="cdk-overlay-connected-position-bounding-box",K9=/([A-Za-z%]+)$/;class Q9{constructor(e,t,i,r,s){this._viewportRuler=t,this._document=i,this._platform=r,this._overlayContainer=s,this._lastBoundingBoxSize={width:0,height:0},this._isPushed=!1,this._canPush=!0,this._growAfterOpen=!1,this._hasFlexibleDimensions=!0,this._positionLocked=!1,this._viewportMargin=0,this._scrollables=[],this._preferredPositions=[],this._positionChanges=new si,this._resizeSubscription=lt.EMPTY,this._offsetX=0,this._offsetY=0,this._appliedPanelClasses=[],this.positionChanges=this._positionChanges,this.setOrigin(e)}get positions(){return this._preferredPositions}attach(e){this._validatePositions(),e.hostElement.classList.add(F3),this._overlayRef=e,this._boundingBox=e.hostElement,this._pane=e.overlayElement,this._isDisposed=!1,this._isInitialRender=!0,this._lastPosition=null,this._resizeSubscription.unsubscribe(),this._resizeSubscription=this._viewportRuler.change().subscribe(()=>{this._isInitialRender=!0,this.apply()})}apply(){if(this._isDisposed||!this._platform.isBrowser)return;if(!this._isInitialRender&&this._positionLocked&&this._lastPosition)return void this.reapplyLastPosition();this._clearPanelClasses(),this._resetOverlayElementStyles(),this._resetBoundingBoxStyles(),this._viewportRect=this._getNarrowedViewportRect(),this._originRect=this._getOriginRect(),this._overlayRect=this._pane.getBoundingClientRect(),this._containerRect=this._overlayContainer.getContainerElement().getBoundingClientRect();const e=this._originRect,t=this._overlayRect,i=this._viewportRect,r=this._containerRect,s=[];let c;for(let d of this._preferredPositions){let m=this._getOriginPoint(e,r,d),y=this._getOverlayPoint(m,t,d),w=this._getOverlayFit(y,t,i,d);if(w.isCompletelyWithinViewport)return this._isPushed=!1,void this._applyPosition(d,m);this._canFitWithFlexibleDimensions(w,y,i)?s.push({position:d,origin:m,overlayRect:t,boundingBoxRect:this._calculateBoundingBoxRect(m,d)}):(!c||c.overlayFit.visibleArea<w.visibleArea)&&(c={overlayFit:w,overlayPoint:y,originPoint:m,position:d,overlayRect:t})}if(s.length){let d=null,m=-1;for(const y of s){const w=y.boundingBoxRect.width*y.boundingBoxRect.height*(y.position.weight||1);w>m&&(m=w,d=y)}return this._isPushed=!1,void this._applyPosition(d.position,d.origin)}if(this._canPush)return this._isPushed=!0,void this._applyPosition(c.position,c.originPoint);this._applyPosition(c.position,c.originPoint)}detach(){this._clearPanelClasses(),this._lastPosition=null,this._previousPushAmount=null,this._resizeSubscription.unsubscribe()}dispose(){this._isDisposed||(this._boundingBox&&Fg(this._boundingBox.style,{top:"",left:"",right:"",bottom:"",height:"",width:"",alignItems:"",justifyContent:""}),this._pane&&this._resetOverlayElementStyles(),this._overlayRef&&this._overlayRef.hostElement.classList.remove(F3),this.detach(),this._positionChanges.complete(),this._overlayRef=this._boundingBox=null,this._isDisposed=!0)}reapplyLastPosition(){if(this._isDisposed||!this._platform.isBrowser)return;const e=this._lastPosition;if(e){this._originRect=this._getOriginRect(),this._overlayRect=this._pane.getBoundingClientRect(),this._viewportRect=this._getNarrowedViewportRect(),this._containerRect=this._overlayContainer.getContainerElement().getBoundingClientRect();const t=this._getOriginPoint(this._originRect,this._containerRect,e);this._applyPosition(e,t)}else this.apply()}withScrollableContainers(e){return this._scrollables=e,this}withPositions(e){return this._preferredPositions=e,-1===e.indexOf(this._lastPosition)&&(this._lastPosition=null),this._validatePositions(),this}withViewportMargin(e){return this._viewportMargin=e,this}withFlexibleDimensions(e=!0){return this._hasFlexibleDimensions=e,this}withGrowAfterOpen(e=!0){return this._growAfterOpen=e,this}withPush(e=!0){return this._canPush=e,this}withLockedPosition(e=!0){return this._positionLocked=e,this}setOrigin(e){return this._origin=e,this}withDefaultOffsetX(e){return this._offsetX=e,this}withDefaultOffsetY(e){return this._offsetY=e,this}withTransformOriginOn(e){return this._transformOriginSelector=e,this}_getOriginPoint(e,t,i){let r,s;if("center"==i.originX)r=e.left+e.width/2;else{const c=this._isRtl()?e.right:e.left,d=this._isRtl()?e.left:e.right;r="start"==i.originX?c:d}return t.left<0&&(r-=t.left),s="center"==i.originY?e.top+e.height/2:"top"==i.originY?e.top:e.bottom,t.top<0&&(s-=t.top),{x:r,y:s}}_getOverlayPoint(e,t,i){let r,s;return r="center"==i.overlayX?-t.width/2:"start"===i.overlayX?this._isRtl()?-t.width:0:this._isRtl()?0:-t.width,s="center"==i.overlayY?-t.height/2:"top"==i.overlayY?0:-t.height,{x:e.x+r,y:e.y+s}}_getOverlayFit(e,t,i,r){const s=B3(t);let{x:c,y:d}=e,m=this._getOffset(r,"x"),y=this._getOffset(r,"y");m&&(c+=m),y&&(d+=y);let T=0-d,I=d+s.height-i.height,R=this._subtractOverflows(s.width,0-c,c+s.width-i.width),k=this._subtractOverflows(s.height,T,I),F=R*k;return{visibleArea:F,isCompletelyWithinViewport:s.width*s.height===F,fitsInViewportVertically:k===s.height,fitsInViewportHorizontally:R==s.width}}_canFitWithFlexibleDimensions(e,t,i){if(this._hasFlexibleDimensions){const r=i.bottom-t.y,s=i.right-t.x,c=N3(this._overlayRef.getConfig().minHeight),d=N3(this._overlayRef.getConfig().minWidth),y=e.fitsInViewportHorizontally||null!=d&&d<=s;return(e.fitsInViewportVertically||null!=c&&c<=r)&&y}return!1}_pushOverlayOnScreen(e,t,i){if(this._previousPushAmount&&this._positionLocked)return{x:e.x+this._previousPushAmount.x,y:e.y+this._previousPushAmount.y};const r=B3(t),s=this._viewportRect,c=Math.max(e.x+r.width-s.width,0),d=Math.max(e.y+r.height-s.height,0),m=Math.max(s.top-i.top-e.y,0),y=Math.max(s.left-i.left-e.x,0);let w=0,S=0;return w=r.width<=s.width?y||-c:e.x<this._viewportMargin?s.left-i.left-e.x:0,S=r.height<=s.height?m||-d:e.y<this._viewportMargin?s.top-i.top-e.y:0,this._previousPushAmount={x:w,y:S},{x:e.x+w,y:e.y+S}}_applyPosition(e,t){if(this._setTransformOrigin(e),this._setOverlayElementStyles(t,e),this._setBoundingBoxStyles(t,e),e.panelClass&&this._addPanelClasses(e.panelClass),this._lastPosition=e,this._positionChanges.observers.length){const i=this._getScrollVisibility(),r=new q9(e,i);this._positionChanges.next(r)}this._isInitialRender=!1}_setTransformOrigin(e){if(!this._transformOriginSelector)return;const t=this._boundingBox.querySelectorAll(this._transformOriginSelector);let i,r=e.overlayY;i="center"===e.overlayX?"center":this._isRtl()?"start"===e.overlayX?"right":"left":"start"===e.overlayX?"left":"right";for(let s=0;s<t.length;s++)t[s].style.transformOrigin=`${i} ${r}`}_calculateBoundingBoxRect(e,t){const i=this._viewportRect,r=this._isRtl();let s,c,d,w,S,T;if("top"===t.overlayY)c=e.y,s=i.height-c+this._viewportMargin;else if("bottom"===t.overlayY)d=i.height-e.y+2*this._viewportMargin,s=i.height-d+this._viewportMargin;else{const I=Math.min(i.bottom-e.y+i.top,e.y),R=this._lastBoundingBoxSize.height;s=2*I,c=e.y-I,s>R&&!this._isInitialRender&&!this._growAfterOpen&&(c=e.y-R/2)}if("end"===t.overlayX&&!r||"start"===t.overlayX&&r)T=i.width-e.x+this._viewportMargin,w=e.x-this._viewportMargin;else if("start"===t.overlayX&&!r||"end"===t.overlayX&&r)S=e.x,w=i.right-e.x;else{const I=Math.min(i.right-e.x+i.left,e.x),R=this._lastBoundingBoxSize.width;w=2*I,S=e.x-I,w>R&&!this._isInitialRender&&!this._growAfterOpen&&(S=e.x-R/2)}return{top:c,left:S,bottom:d,right:T,width:w,height:s}}_setBoundingBoxStyles(e,t){const i=this._calculateBoundingBoxRect(e,t);!this._isInitialRender&&!this._growAfterOpen&&(i.height=Math.min(i.height,this._lastBoundingBoxSize.height),i.width=Math.min(i.width,this._lastBoundingBoxSize.width));const r={};if(this._hasExactPosition())r.top=r.left="0",r.bottom=r.right=r.maxHeight=r.maxWidth="",r.width=r.height="100%";else{const s=this._overlayRef.getConfig().maxHeight,c=this._overlayRef.getConfig().maxWidth;r.height=wo(i.height),r.top=wo(i.top),r.bottom=wo(i.bottom),r.width=wo(i.width),r.left=wo(i.left),r.right=wo(i.right),r.alignItems="center"===t.overlayX?"center":"end"===t.overlayX?"flex-end":"flex-start",r.justifyContent="center"===t.overlayY?"center":"bottom"===t.overlayY?"flex-end":"flex-start",s&&(r.maxHeight=wo(s)),c&&(r.maxWidth=wo(c))}this._lastBoundingBoxSize=i,Fg(this._boundingBox.style,r)}_resetBoundingBoxStyles(){Fg(this._boundingBox.style,{top:"0",left:"0",right:"0",bottom:"0",height:"",width:"",alignItems:"",justifyContent:""})}_resetOverlayElementStyles(){Fg(this._pane.style,{top:"",left:"",bottom:"",right:"",position:"",transform:""})}_setOverlayElementStyles(e,t){const i={},r=this._hasExactPosition(),s=this._hasFlexibleDimensions,c=this._overlayRef.getConfig();if(r){const w=this._viewportRuler.getViewportScrollPosition();Fg(i,this._getExactOverlayY(t,e,w)),Fg(i,this._getExactOverlayX(t,e,w))}else i.position="static";let d="",m=this._getOffset(t,"x"),y=this._getOffset(t,"y");m&&(d+=`translateX(${m}px) `),y&&(d+=`translateY(${y}px)`),i.transform=d.trim(),c.maxHeight&&(r?i.maxHeight=wo(c.maxHeight):s&&(i.maxHeight="")),c.maxWidth&&(r?i.maxWidth=wo(c.maxWidth):s&&(i.maxWidth="")),Fg(this._pane.style,i)}_getExactOverlayY(e,t,i){let r={top:"",bottom:""},s=this._getOverlayPoint(t,this._overlayRect,e);return this._isPushed&&(s=this._pushOverlayOnScreen(s,this._overlayRect,i)),"bottom"===e.overlayY?r.bottom=this._document.documentElement.clientHeight-(s.y+this._overlayRect.height)+"px":r.top=wo(s.y),r}_getExactOverlayX(e,t,i){let c,r={left:"",right:""},s=this._getOverlayPoint(t,this._overlayRect,e);return this._isPushed&&(s=this._pushOverlayOnScreen(s,this._overlayRect,i)),c=this._isRtl()?"end"===e.overlayX?"left":"right":"end"===e.overlayX?"right":"left","right"===c?r.right=this._document.documentElement.clientWidth-(s.x+this._overlayRect.width)+"px":r.left=wo(s.x),r}_getScrollVisibility(){const e=this._getOriginRect(),t=this._pane.getBoundingClientRect(),i=this._scrollables.map(r=>r.getElementRef().nativeElement.getBoundingClientRect());return{isOriginClipped:R3(e,i),isOriginOutsideView:$A(e,i),isOverlayClipped:R3(t,i),isOverlayOutsideView:$A(t,i)}}_subtractOverflows(e,...t){return t.reduce((i,r)=>i-Math.max(r,0),e)}_getNarrowedViewportRect(){const e=this._document.documentElement.clientWidth,t=this._document.documentElement.clientHeight,i=this._viewportRuler.getViewportScrollPosition();return{top:i.top+this._viewportMargin,left:i.left+this._viewportMargin,right:i.left+e-this._viewportMargin,bottom:i.top+t-this._viewportMargin,width:e-2*this._viewportMargin,height:t-2*this._viewportMargin}}_isRtl(){return"rtl"===this._overlayRef.getDirection()}_hasExactPosition(){return!this._hasFlexibleDimensions||this._isPushed}_getOffset(e,t){return"x"===t?e.offsetX??this._offsetX:e.offsetY??this._offsetY}_validatePositions(){}_addPanelClasses(e){this._pane&&cC(e).forEach(t=>{""!==t&&-1===this._appliedPanelClasses.indexOf(t)&&(this._appliedPanelClasses.push(t),this._pane.classList.add(t))})}_clearPanelClasses(){this._pane&&(this._appliedPanelClasses.forEach(e=>{this._pane.classList.remove(e)}),this._appliedPanelClasses=[])}_getOriginRect(){const e=this._origin;if(e instanceof wr)return e.nativeElement.getBoundingClientRect();if(e instanceof Element)return e.getBoundingClientRect();const t=e.width||0,i=e.height||0;return{top:e.y,bottom:e.y+i,left:e.x,right:e.x+t,height:i,width:t}}}function Fg(n,e){for(let t in e)e.hasOwnProperty(t)&&(n[t]=e[t]);return n}function N3(n){if("number"!=typeof n&&null!=n){const[e,t]=n.split(K9);return t&&"px"!==t?null:parseFloat(e)}return n||null}function B3(n){return{top:Math.floor(n.top),right:Math.floor(n.right),bottom:Math.floor(n.bottom),left:Math.floor(n.left),width:Math.floor(n.width),height:Math.floor(n.height)}}const z3="cdk-global-overlay-wrapper";class J9{constructor(){this._cssPosition="static",this._topOffset="",this._bottomOffset="",this._alignItems="",this._xPosition="",this._xOffset="",this._width="",this._height="",this._isDisposed=!1}attach(e){const t=e.getConfig();this._overlayRef=e,this._width&&!t.width&&e.updateSize({width:this._width}),this._height&&!t.height&&e.updateSize({height:this._height}),e.hostElement.classList.add(z3),this._isDisposed=!1}top(e=""){return this._bottomOffset="",this._topOffset=e,this._alignItems="flex-start",this}left(e=""){return this._xOffset=e,this._xPosition="left",this}bottom(e=""){return this._topOffset="",this._bottomOffset=e,this._alignItems="flex-end",this}right(e=""){return this._xOffset=e,this._xPosition="right",this}start(e=""){return this._xOffset=e,this._xPosition="start",this}end(e=""){return this._xOffset=e,this._xPosition="end",this}width(e=""){return this._overlayRef?this._overlayRef.updateSize({width:e}):this._width=e,this}height(e=""){return this._overlayRef?this._overlayRef.updateSize({height:e}):this._height=e,this}centerHorizontally(e=""){return this.left(e),this._xPosition="center",this}centerVertically(e=""){return this.top(e),this._alignItems="center",this}apply(){if(!this._overlayRef||!this._overlayRef.hasAttached())return;const e=this._overlayRef.overlayElement.style,t=this._overlayRef.hostElement.style,i=this._overlayRef.getConfig(),{width:r,height:s,maxWidth:c,maxHeight:d}=i,m=!("100%"!==r&&"100vw"!==r||c&&"100%"!==c&&"100vw"!==c),y=!("100%"!==s&&"100vh"!==s||d&&"100%"!==d&&"100vh"!==d),w=this._xPosition,S=this._xOffset,T="rtl"===this._overlayRef.getConfig().direction;let I="",R="",k="";m?k="flex-start":"center"===w?(k="center",T?R=S:I=S):T?"left"===w||"end"===w?(k="flex-end",I=S):("right"===w||"start"===w)&&(k="flex-start",R=S):"left"===w||"start"===w?(k="flex-start",I=S):("right"===w||"end"===w)&&(k="flex-end",R=S),e.position=this._cssPosition,e.marginLeft=m?"0":I,e.marginTop=y?"0":this._topOffset,e.marginBottom=this._bottomOffset,e.marginRight=m?"0":R,t.justifyContent=k,t.alignItems=y?"flex-start":this._alignItems}dispose(){if(this._isDisposed||!this._overlayRef)return;const e=this._overlayRef.overlayElement.style,t=this._overlayRef.hostElement,i=t.style;t.classList.remove(z3),i.justifyContent=i.alignItems=e.marginTop=e.marginBottom=e.marginLeft=e.marginRight=e.position="",this._overlayRef=null,this._isDisposed=!0}}let e7=(()=>{class n{constructor(t,i,r,s){this._viewportRuler=t,this._document=i,this._platform=r,this._overlayContainer=s}global(){return new J9}flexibleConnectedTo(t){return new Q9(t,this._viewportRuler,this._document,this._platform,this._overlayContainer)}}return n.\u0275fac=function(t){return new(t||n)(Xe(jA),Xe(Vi),Xe(lu),Xe(O3))},n.\u0275prov=Yt({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),t7=0,yv=(()=>{class n{constructor(t,i,r,s,c,d,m,y,w,S,T,I){this.scrollStrategies=t,this._overlayContainer=i,this._componentFactoryResolver=r,this._positionBuilder=s,this._keyboardDispatcher=c,this._injector=d,this._ngZone=m,this._document=y,this._directionality=w,this._location=S,this._outsideClickDispatcher=T,this._animationsModuleType=I}create(t){const i=this._createHostElement(),r=this._createPaneElement(i),s=this._createPortalOutlet(r),c=new k3(t);return c.direction=c.direction||this._directionality.value,new Y9(s,i,r,c,this._ngZone,this._keyboardDispatcher,this._document,this._location,this._outsideClickDispatcher,"NoopAnimations"===this._animationsModuleType)}position(){return this._positionBuilder}_createPaneElement(t){const i=this._document.createElement("div");return i.id="cdk-overlay-"+t7++,i.classList.add("cdk-overlay-pane"),t.appendChild(i),i}_createHostElement(){const t=this._document.createElement("div");return this._overlayContainer.getContainerElement().appendChild(t),t}_createPortalOutlet(t){return this._appRef||(this._appRef=this._injector.get(ov)),new jW(t,this._componentFactoryResolver,this._appRef,this._injector,this._document)}}return n.\u0275fac=function(t){return new(t||n)(Xe(W9),Xe(O3),Xe(Kc),Xe(e7),Xe(Z9),Xe(Yr),Xe(nr),Xe(Vi),Xe(em),Xe(UM),Xe(X9),Xe(ru,8))},n.\u0275prov=Yt({token:n,factory:n.\u0275fac}),n})();const n7=[{originX:"start",originY:"bottom",overlayX:"start",overlayY:"top"},{originX:"start",originY:"top",overlayX:"start",overlayY:"bottom"},{originX:"end",originY:"top",overlayX:"end",overlayY:"bottom"},{originX:"end",originY:"bottom",overlayX:"end",overlayY:"top"}],V3=new Vt("cdk-connected-overlay-scroll-strategy");let U3=(()=>{class n{constructor(t){this.elementRef=t}}return n.\u0275fac=function(t){return new(t||n)(Ie(wr))},n.\u0275dir=an({type:n,selectors:[["","cdk-overlay-origin",""],["","overlay-origin",""],["","cdkOverlayOrigin",""]],exportAs:["cdkOverlayOrigin"]}),n})(),H3=(()=>{class n{constructor(t,i,r,s,c){this._overlay=t,this._dir=c,this._hasBackdrop=!1,this._lockPosition=!1,this._growAfterOpen=!1,this._flexibleDimensions=!1,this._push=!1,this._backdropSubscription=lt.EMPTY,this._attachSubscription=lt.EMPTY,this._detachSubscription=lt.EMPTY,this._positionSubscription=lt.EMPTY,this.viewportMargin=0,this.open=!1,this.disableClose=!1,this.backdropClick=new Dn,this.positionChange=new Dn,this.attach=new Dn,this.detach=new Dn,this.overlayKeydown=new Dn,this.overlayOutsideClick=new Dn,this._templatePortal=new DA(i,r),this._scrollStrategyFactory=s,this.scrollStrategy=this._scrollStrategyFactory()}get offsetX(){return this._offsetX}set offsetX(t){this._offsetX=t,this._position&&this._updatePositionStrategy(this._position)}get offsetY(){return this._offsetY}set offsetY(t){this._offsetY=t,this._position&&this._updatePositionStrategy(this._position)}get hasBackdrop(){return this._hasBackdrop}set hasBackdrop(t){this._hasBackdrop=Kr(t)}get lockPosition(){return this._lockPosition}set lockPosition(t){this._lockPosition=Kr(t)}get flexibleDimensions(){return this._flexibleDimensions}set flexibleDimensions(t){this._flexibleDimensions=Kr(t)}get growAfterOpen(){return this._growAfterOpen}set growAfterOpen(t){this._growAfterOpen=Kr(t)}get push(){return this._push}set push(t){this._push=Kr(t)}get overlayRef(){return this._overlayRef}get dir(){return this._dir?this._dir.value:"ltr"}ngOnDestroy(){this._attachSubscription.unsubscribe(),this._detachSubscription.unsubscribe(),this._backdropSubscription.unsubscribe(),this._positionSubscription.unsubscribe(),this._overlayRef&&this._overlayRef.dispose()}ngOnChanges(t){this._position&&(this._updatePositionStrategy(this._position),this._overlayRef.updateSize({width:this.width,minWidth:this.minWidth,height:this.height,minHeight:this.minHeight}),t.origin&&this.open&&this._position.apply()),t.open&&(this.open?this._attachOverlay():this._detachOverlay())}_createOverlay(){(!this.positions||!this.positions.length)&&(this.positions=n7);const t=this._overlayRef=this._overlay.create(this._buildConfig());this._attachSubscription=t.attachments().subscribe(()=>this.attach.emit()),this._detachSubscription=t.detachments().subscribe(()=>this.detach.emit()),t.keydownEvents().subscribe(i=>{this.overlayKeydown.next(i),27===i.keyCode&&!this.disableClose&&!th(i)&&(i.preventDefault(),this._detachOverlay())}),this._overlayRef.outsidePointerEvents().subscribe(i=>{this.overlayOutsideClick.next(i)})}_buildConfig(){const t=this._position=this.positionStrategy||this._createPositionStrategy(),i=new k3({direction:this._dir,positionStrategy:t,scrollStrategy:this.scrollStrategy,hasBackdrop:this.hasBackdrop});return(this.width||0===this.width)&&(i.width=this.width),(this.height||0===this.height)&&(i.height=this.height),(this.minWidth||0===this.minWidth)&&(i.minWidth=this.minWidth),(this.minHeight||0===this.minHeight)&&(i.minHeight=this.minHeight),this.backdropClass&&(i.backdropClass=this.backdropClass),this.panelClass&&(i.panelClass=this.panelClass),i}_updatePositionStrategy(t){const i=this.positions.map(r=>({originX:r.originX,originY:r.originY,overlayX:r.overlayX,overlayY:r.overlayY,offsetX:r.offsetX||this.offsetX,offsetY:r.offsetY||this.offsetY,panelClass:r.panelClass||void 0}));return t.setOrigin(this._getFlexibleConnectedPositionStrategyOrigin()).withPositions(i).withFlexibleDimensions(this.flexibleDimensions).withPush(this.push).withGrowAfterOpen(this.growAfterOpen).withViewportMargin(this.viewportMargin).withLockedPosition(this.lockPosition).withTransformOriginOn(this.transformOriginSelector)}_createPositionStrategy(){const t=this._overlay.position().flexibleConnectedTo(this._getFlexibleConnectedPositionStrategyOrigin());return this._updatePositionStrategy(t),t}_getFlexibleConnectedPositionStrategyOrigin(){return this.origin instanceof U3?this.origin.elementRef:this.origin}_attachOverlay(){this._overlayRef?this._overlayRef.getConfig().hasBackdrop=this.hasBackdrop:this._createOverlay(),this._overlayRef.hasAttached()||this._overlayRef.attach(this._templatePortal),this.hasBackdrop?this._backdropSubscription=this._overlayRef.backdropClick().subscribe(t=>{this.backdropClick.emit(t)}):this._backdropSubscription.unsubscribe(),this._positionSubscription.unsubscribe(),this.positionChange.observers.length>0&&(this._positionSubscription=this._position.positionChanges.pipe(A3(()=>this.positionChange.observers.length>0)).subscribe(t=>{this.positionChange.emit(t),0===this.positionChange.observers.length&&this._positionSubscription.unsubscribe()}))}_detachOverlay(){this._overlayRef&&this._overlayRef.detach(),this._backdropSubscription.unsubscribe(),this._positionSubscription.unsubscribe()}}return n.\u0275fac=function(t){return new(t||n)(Ie(yv),Ie(ld),Ie(ql),Ie(V3),Ie(em,8))},n.\u0275dir=an({type:n,selectors:[["","cdk-connected-overlay",""],["","connected-overlay",""],["","cdkConnectedOverlay",""]],inputs:{origin:["cdkConnectedOverlayOrigin","origin"],positions:["cdkConnectedOverlayPositions","positions"],positionStrategy:["cdkConnectedOverlayPositionStrategy","positionStrategy"],offsetX:["cdkConnectedOverlayOffsetX","offsetX"],offsetY:["cdkConnectedOverlayOffsetY","offsetY"],width:["cdkConnectedOverlayWidth","width"],height:["cdkConnectedOverlayHeight","height"],minWidth:["cdkConnectedOverlayMinWidth","minWidth"],minHeight:["cdkConnectedOverlayMinHeight","minHeight"],backdropClass:["cdkConnectedOverlayBackdropClass","backdropClass"],panelClass:["cdkConnectedOverlayPanelClass","panelClass"],viewportMargin:["cdkConnectedOverlayViewportMargin","viewportMargin"],scrollStrategy:["cdkConnectedOverlayScrollStrategy","scrollStrategy"],open:["cdkConnectedOverlayOpen","open"],disableClose:["cdkConnectedOverlayDisableClose","disableClose"],transformOriginSelector:["cdkConnectedOverlayTransformOriginOn","transformOriginSelector"],hasBackdrop:["cdkConnectedOverlayHasBackdrop","hasBackdrop"],lockPosition:["cdkConnectedOverlayLockPosition","lockPosition"],flexibleDimensions:["cdkConnectedOverlayFlexibleDimensions","flexibleDimensions"],growAfterOpen:["cdkConnectedOverlayGrowAfterOpen","growAfterOpen"],push:["cdkConnectedOverlayPush","push"]},outputs:{backdropClick:"backdropClick",positionChange:"positionChange",attach:"attach",detach:"detach",overlayKeydown:"overlayKeydown",overlayOutsideClick:"overlayOutsideClick"},exportAs:["cdkConnectedOverlay"],features:[Nr]}),n})();const s7={provide:V3,deps:[yv],useFactory:function r7(n){return()=>n.scrollStrategies.reposition()}};let SC=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=Gn({type:n}),n.\u0275inj=Bn({providers:[yv,s7],imports:[mv,Lb,D3,D3]}),n})(),G3=(()=>{class n{constructor(t,i){this._renderer=t,this._elementRef=i,this.onChange=r=>{},this.onTouched=()=>{}}setProperty(t,i){this._renderer.setProperty(this._elementRef.nativeElement,t,i)}registerOnTouched(t){this.onTouched=t}registerOnChange(t){this.onChange=t}setDisabledState(t){this.setProperty("disabled",t)}}return n.\u0275fac=function(t){return new(t||n)(Ie(Ul),Ie(wr))},n.\u0275dir=an({type:n}),n})(),Ng=(()=>{class n extends G3{}return n.\u0275fac=function(){let e;return function(i){return(e||(e=hi(n)))(i||n)}}(),n.\u0275dir=an({type:n,features:[dn]}),n})();const Yl=new Vt("NgValueAccessor"),a7={provide:Yl,useExisting:Ai(()=>WA),multi:!0},c7=new Vt("CompositionEventMode");let WA=(()=>{class n extends G3{constructor(t,i,r){super(t,i),this._compositionMode=r,this._composing=!1,null==this._compositionMode&&(this._compositionMode=!function l7(){const n=eh()?eh().getUserAgent():"";return/android (\d+)/.test(n.toLowerCase())}())}writeValue(t){this.setProperty("value",t??"")}_handleInput(t){(!this._compositionMode||this._compositionMode&&!this._composing)&&this.onChange(t)}_compositionStart(){this._composing=!0}_compositionEnd(t){this._composing=!1,this._compositionMode&&this.onChange(t)}}return n.\u0275fac=function(t){return new(t||n)(Ie(Ul),Ie(wr),Ie(c7,8))},n.\u0275dir=an({type:n,selectors:[["input","formControlName","",3,"type","checkbox"],["textarea","formControlName",""],["input","formControl","",3,"type","checkbox"],["textarea","formControl",""],["input","ngModel","",3,"type","checkbox"],["textarea","ngModel",""],["","ngDefaultControl",""]],hostBindings:function(t,i){1&t&&gi("input",function(s){return i._handleInput(s.target.value)})("blur",function(){return i.onTouched()})("compositionstart",function(){return i._compositionStart()})("compositionend",function(s){return i._compositionEnd(s.target.value)})},features:[hr([a7]),dn]}),n})();function im(n){return null==n||("string"==typeof n||Array.isArray(n))&&0===n.length}function $3(n){return null!=n&&"number"==typeof n.length}const ra=new Vt("NgValidators"),rm=new Vt("NgAsyncValidators"),d7=/^(?=.{1,254}$)(?=.{1,64}@)[a-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+)*@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/;class W3{static min(e){return function q3(n){return e=>{if(im(e.value)||im(n))return null;const t=parseFloat(e.value);return!isNaN(t)&&t<n?{min:{min:n,actual:e.value}}:null}}(e)}static max(e){return function Z3(n){return e=>{if(im(e.value)||im(n))return null;const t=parseFloat(e.value);return!isNaN(t)&&t>n?{max:{max:n,actual:e.value}}:null}}(e)}static required(e){return function X3(n){return im(n.value)?{required:!0}:null}(e)}static requiredTrue(e){return function Y3(n){return!0===n.value?null:{required:!0}}(e)}static email(e){return function K3(n){return im(n.value)||d7.test(n.value)?null:{email:!0}}(e)}static minLength(e){return function Q3(n){return e=>im(e.value)||!$3(e.value)?null:e.value.length<n?{minlength:{requiredLength:n,actualLength:e.value.length}}:null}(e)}static maxLength(e){return function J3(n){return e=>$3(e.value)&&e.value.length>n?{maxlength:{requiredLength:n,actualLength:e.value.length}}:null}(e)}static pattern(e){return function eN(n){if(!n)return EC;let e,t;return"string"==typeof n?(t="","^"!==n.charAt(0)&&(t+="^"),t+=n,"$"!==n.charAt(n.length-1)&&(t+="$"),e=new RegExp(t)):(t=n.toString(),e=n),i=>{if(im(i.value))return null;const r=i.value;return e.test(r)?null:{pattern:{requiredPattern:t,actualValue:r}}}}(e)}static nullValidator(e){return null}static compose(e){return oN(e)}static composeAsync(e){return aN(e)}}function EC(n){return null}function tN(n){return null!=n}function nN(n){return cb(n)?fs(n):n}function iN(n){let e={};return n.forEach(t=>{e=null!=t?{...e,...t}:e}),0===Object.keys(e).length?null:e}function rN(n,e){return e.map(t=>t(n))}function sN(n){return n.map(e=>function h7(n){return!n.validate}(e)?e:t=>e.validate(t))}function oN(n){if(!n)return null;const e=n.filter(tN);return 0==e.length?null:function(t){return iN(rN(t,e))}}function qA(n){return null!=n?oN(sN(n)):null}function aN(n){if(!n)return null;const e=n.filter(tN);return 0==e.length?null:function(t){return function s3(...n){const e=Vn(n),{args:t,keys:i}=pF(n),r=new ci(s=>{const{length:c}=t;if(!c)return void s.complete();const d=new Array(c);let m=c,y=c;for(let w=0;w<c;w++){let S=!1;ws(t[w]).subscribe(Pr(s,T=>{S||(S=!0,y--),d[w]=T},()=>m--,void 0,()=>{(!m||!S)&&(y||s.next(i?fF(i,d):d),s.complete())}))}});return e?r.pipe(yA(e)):r}(rN(t,e).map(nN)).pipe(ei(iN))}}function ZA(n){return null!=n?aN(sN(n)):null}function lN(n,e){return null===n?[e]:Array.isArray(n)?[...n,e]:[n,e]}function cN(n){return n._rawValidators}function uN(n){return n._rawAsyncValidators}function XA(n){return n?Array.isArray(n)?n:[n]:[]}function TC(n,e){return Array.isArray(n)?n.includes(e):n===e}function dN(n,e){const t=XA(e);return XA(n).forEach(r=>{TC(t,r)||t.push(r)}),t}function hN(n,e){return XA(e).filter(t=>!TC(n,t))}class pN{constructor(){this._rawValidators=[],this._rawAsyncValidators=[],this._onDestroyCallbacks=[]}get value(){return this.control?this.control.value:null}get valid(){return this.control?this.control.valid:null}get invalid(){return this.control?this.control.invalid:null}get pending(){return this.control?this.control.pending:null}get disabled(){return this.control?this.control.disabled:null}get enabled(){return this.control?this.control.enabled:null}get errors(){return this.control?this.control.errors:null}get pristine(){return this.control?this.control.pristine:null}get dirty(){return this.control?this.control.dirty:null}get touched(){return this.control?this.control.touched:null}get status(){return this.control?this.control.status:null}get untouched(){return this.control?this.control.untouched:null}get statusChanges(){return this.control?this.control.statusChanges:null}get valueChanges(){return this.control?this.control.valueChanges:null}get path(){return null}_setValidators(e){this._rawValidators=e||[],this._composedValidatorFn=qA(this._rawValidators)}_setAsyncValidators(e){this._rawAsyncValidators=e||[],this._composedAsyncValidatorFn=ZA(this._rawAsyncValidators)}get validator(){return this._composedValidatorFn||null}get asyncValidator(){return this._composedAsyncValidatorFn||null}_registerOnDestroy(e){this._onDestroyCallbacks.push(e)}_invokeOnDestroyCallbacks(){this._onDestroyCallbacks.forEach(e=>e()),this._onDestroyCallbacks=[]}reset(e){this.control&&this.control.reset(e)}hasError(e,t){return!!this.control&&this.control.hasError(e,t)}getError(e,t){return this.control?this.control.getError(e,t):null}}class xl extends pN{get formDirective(){return null}get path(){return null}}class _p extends pN{constructor(){super(...arguments),this._parent=null,this.name=null,this.valueAccessor=null}}class fN{constructor(e){this._cd=e}get isTouched(){return!!this._cd?.control?.touched}get isUntouched(){return!!this._cd?.control?.untouched}get isPristine(){return!!this._cd?.control?.pristine}get isDirty(){return!!this._cd?.control?.dirty}get isValid(){return!!this._cd?.control?.valid}get isInvalid(){return!!this._cd?.control?.invalid}get isPending(){return!!this._cd?.control?.pending}get isSubmitted(){return!!this._cd?.submitted}}let YA=(()=>{class n extends fN{constructor(t){super(t)}}return n.\u0275fac=function(t){return new(t||n)(Ie(_p,2))},n.\u0275dir=an({type:n,selectors:[["","formControlName",""],["","ngModel",""],["","formControl",""]],hostVars:14,hostBindings:function(t,i){2&t&&ds("ng-untouched",i.isUntouched)("ng-touched",i.isTouched)("ng-pristine",i.isPristine)("ng-dirty",i.isDirty)("ng-valid",i.isValid)("ng-invalid",i.isInvalid)("ng-pending",i.isPending)},features:[dn]}),n})(),vv=(()=>{class n extends fN{constructor(t){super(t)}}return n.\u0275fac=function(t){return new(t||n)(Ie(xl,10))},n.\u0275dir=an({type:n,selectors:[["","formGroupName",""],["","formArrayName",""],["","ngModelGroup",""],["","formGroup",""],["form",3,"ngNoForm",""],["","ngForm",""]],hostVars:16,hostBindings:function(t,i){2&t&&ds("ng-untouched",i.isUntouched)("ng-touched",i.isTouched)("ng-pristine",i.isPristine)("ng-dirty",i.isDirty)("ng-valid",i.isValid)("ng-invalid",i.isInvalid)("ng-pending",i.isPending)("ng-submitted",i.isSubmitted)},features:[dn]}),n})();const Ub="VALID",AC="INVALID",xv="PENDING",Hb="DISABLED";function eI(n){return(IC(n)?n.validators:n)||null}function gN(n){return Array.isArray(n)?qA(n):n||null}function tI(n,e){return(IC(e)?e.asyncValidators:n)||null}function _N(n){return Array.isArray(n)?ZA(n):n||null}function IC(n){return null!=n&&!Array.isArray(n)&&"object"==typeof n}class xN{constructor(e,t){this._pendingDirty=!1,this._hasOwnPendingAsyncValidator=!1,this._pendingTouched=!1,this._onCollectionChange=()=>{},this._parent=null,this.pristine=!0,this.touched=!1,this._onDisabledChange=[],this._rawValidators=e,this._rawAsyncValidators=t,this._composedValidatorFn=gN(this._rawValidators),this._composedAsyncValidatorFn=_N(this._rawAsyncValidators)}get validator(){return this._composedValidatorFn}set validator(e){this._rawValidators=this._composedValidatorFn=e}get asyncValidator(){return this._composedAsyncValidatorFn}set asyncValidator(e){this._rawAsyncValidators=this._composedAsyncValidatorFn=e}get parent(){return this._parent}get valid(){return this.status===Ub}get invalid(){return this.status===AC}get pending(){return this.status==xv}get disabled(){return this.status===Hb}get enabled(){return this.status!==Hb}get dirty(){return!this.pristine}get untouched(){return!this.touched}get updateOn(){return this._updateOn?this._updateOn:this.parent?this.parent.updateOn:"change"}setValidators(e){this._rawValidators=e,this._composedValidatorFn=gN(e)}setAsyncValidators(e){this._rawAsyncValidators=e,this._composedAsyncValidatorFn=_N(e)}addValidators(e){this.setValidators(dN(e,this._rawValidators))}addAsyncValidators(e){this.setAsyncValidators(dN(e,this._rawAsyncValidators))}removeValidators(e){this.setValidators(hN(e,this._rawValidators))}removeAsyncValidators(e){this.setAsyncValidators(hN(e,this._rawAsyncValidators))}hasValidator(e){return TC(this._rawValidators,e)}hasAsyncValidator(e){return TC(this._rawAsyncValidators,e)}clearValidators(){this.validator=null}clearAsyncValidators(){this.asyncValidator=null}markAsTouched(e={}){this.touched=!0,this._parent&&!e.onlySelf&&this._parent.markAsTouched(e)}markAllAsTouched(){this.markAsTouched({onlySelf:!0}),this._forEachChild(e=>e.markAllAsTouched())}markAsUntouched(e={}){this.touched=!1,this._pendingTouched=!1,this._forEachChild(t=>{t.markAsUntouched({onlySelf:!0})}),this._parent&&!e.onlySelf&&this._parent._updateTouched(e)}markAsDirty(e={}){this.pristine=!1,this._parent&&!e.onlySelf&&this._parent.markAsDirty(e)}markAsPristine(e={}){this.pristine=!0,this._pendingDirty=!1,this._forEachChild(t=>{t.markAsPristine({onlySelf:!0})}),this._parent&&!e.onlySelf&&this._parent._updatePristine(e)}markAsPending(e={}){this.status=xv,!1!==e.emitEvent&&this.statusChanges.emit(this.status),this._parent&&!e.onlySelf&&this._parent.markAsPending(e)}disable(e={}){const t=this._parentMarkedDirty(e.onlySelf);this.status=Hb,this.errors=null,this._forEachChild(i=>{i.disable({...e,onlySelf:!0})}),this._updateValue(),!1!==e.emitEvent&&(this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._updateAncestors({...e,skipPristineCheck:t}),this._onDisabledChange.forEach(i=>i(!0))}enable(e={}){const t=this._parentMarkedDirty(e.onlySelf);this.status=Ub,this._forEachChild(i=>{i.enable({...e,onlySelf:!0})}),this.updateValueAndValidity({onlySelf:!0,emitEvent:e.emitEvent}),this._updateAncestors({...e,skipPristineCheck:t}),this._onDisabledChange.forEach(i=>i(!1))}_updateAncestors(e){this._parent&&!e.onlySelf&&(this._parent.updateValueAndValidity(e),e.skipPristineCheck||this._parent._updatePristine(),this._parent._updateTouched())}setParent(e){this._parent=e}getRawValue(){return this.value}updateValueAndValidity(e={}){this._setInitialStatus(),this._updateValue(),this.enabled&&(this._cancelExistingSubscription(),this.errors=this._runValidator(),this.status=this._calculateStatus(),(this.status===Ub||this.status===xv)&&this._runAsyncValidator(e.emitEvent)),!1!==e.emitEvent&&(this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._parent&&!e.onlySelf&&this._parent.updateValueAndValidity(e)}_updateTreeValidity(e={emitEvent:!0}){this._forEachChild(t=>t._updateTreeValidity(e)),this.updateValueAndValidity({onlySelf:!0,emitEvent:e.emitEvent})}_setInitialStatus(){this.status=this._allControlsDisabled()?Hb:Ub}_runValidator(){return this.validator?this.validator(this):null}_runAsyncValidator(e){if(this.asyncValidator){this.status=xv,this._hasOwnPendingAsyncValidator=!0;const t=nN(this.asyncValidator(this));this._asyncValidationSubscription=t.subscribe(i=>{this._hasOwnPendingAsyncValidator=!1,this.setErrors(i,{emitEvent:e})})}}_cancelExistingSubscription(){this._asyncValidationSubscription&&(this._asyncValidationSubscription.unsubscribe(),this._hasOwnPendingAsyncValidator=!1)}setErrors(e,t={}){this.errors=e,this._updateControlsErrors(!1!==t.emitEvent)}get(e){let t=e;return null==t||(Array.isArray(t)||(t=t.split(".")),0===t.length)?null:t.reduce((i,r)=>i&&i._find(r),this)}getError(e,t){const i=t?this.get(t):this;return i&&i.errors?i.errors[e]:null}hasError(e,t){return!!this.getError(e,t)}get root(){let e=this;for(;e._parent;)e=e._parent;return e}_updateControlsErrors(e){this.status=this._calculateStatus(),e&&this.statusChanges.emit(this.status),this._parent&&this._parent._updateControlsErrors(e)}_initObservables(){this.valueChanges=new Dn,this.statusChanges=new Dn}_calculateStatus(){return this._allControlsDisabled()?Hb:this.errors?AC:this._hasOwnPendingAsyncValidator||this._anyControlsHaveStatus(xv)?xv:this._anyControlsHaveStatus(AC)?AC:Ub}_anyControlsHaveStatus(e){return this._anyControls(t=>t.status===e)}_anyControlsDirty(){return this._anyControls(e=>e.dirty)}_anyControlsTouched(){return this._anyControls(e=>e.touched)}_updatePristine(e={}){this.pristine=!this._anyControlsDirty(),this._parent&&!e.onlySelf&&this._parent._updatePristine(e)}_updateTouched(e={}){this.touched=this._anyControlsTouched(),this._parent&&!e.onlySelf&&this._parent._updateTouched(e)}_registerOnCollectionChange(e){this._onCollectionChange=e}_setUpdateStrategy(e){IC(e)&&null!=e.updateOn&&(this._updateOn=e.updateOn)}_parentMarkedDirty(e){return!e&&!(!this._parent||!this._parent.dirty)&&!this._parent._anyControlsDirty()}_find(e){return null}}class nI extends xN{constructor(e,t,i){super(eI(t),tI(i,t)),this.controls=e,this._initObservables(),this._setUpdateStrategy(t),this._setUpControls(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator})}registerControl(e,t){return this.controls[e]?this.controls[e]:(this.controls[e]=t,t.setParent(this),t._registerOnCollectionChange(this._onCollectionChange),t)}addControl(e,t,i={}){this.registerControl(e,t),this.updateValueAndValidity({emitEvent:i.emitEvent}),this._onCollectionChange()}removeControl(e,t={}){this.controls[e]&&this.controls[e]._registerOnCollectionChange(()=>{}),delete this.controls[e],this.updateValueAndValidity({emitEvent:t.emitEvent}),this._onCollectionChange()}setControl(e,t,i={}){this.controls[e]&&this.controls[e]._registerOnCollectionChange(()=>{}),delete this.controls[e],t&&this.registerControl(e,t),this.updateValueAndValidity({emitEvent:i.emitEvent}),this._onCollectionChange()}contains(e){return this.controls.hasOwnProperty(e)&&this.controls[e].enabled}setValue(e,t={}){(function vN(n,e,t){n._forEachChild((i,r)=>{if(void 0===t[r])throw new bt(1002,"")})})(this,0,e),Object.keys(e).forEach(i=>{(function yN(n,e,t){const i=n.controls;if(!(e?Object.keys(i):i).length)throw new bt(1e3,"");if(!i[t])throw new bt(1001,"")})(this,!0,i),this.controls[i].setValue(e[i],{onlySelf:!0,emitEvent:t.emitEvent})}),this.updateValueAndValidity(t)}patchValue(e,t={}){null!=e&&(Object.keys(e).forEach(i=>{const r=this.controls[i];r&&r.patchValue(e[i],{onlySelf:!0,emitEvent:t.emitEvent})}),this.updateValueAndValidity(t))}reset(e={},t={}){this._forEachChild((i,r)=>{i.reset(e[r],{onlySelf:!0,emitEvent:t.emitEvent})}),this._updatePristine(t),this._updateTouched(t),this.updateValueAndValidity(t)}getRawValue(){return this._reduceChildren({},(e,t,i)=>(e[i]=t.getRawValue(),e))}_syncPendingControls(){let e=this._reduceChildren(!1,(t,i)=>!!i._syncPendingControls()||t);return e&&this.updateValueAndValidity({onlySelf:!0}),e}_forEachChild(e){Object.keys(this.controls).forEach(t=>{const i=this.controls[t];i&&e(i,t)})}_setUpControls(){this._forEachChild(e=>{e.setParent(this),e._registerOnCollectionChange(this._onCollectionChange)})}_updateValue(){this.value=this._reduceValue()}_anyControls(e){for(const[t,i]of Object.entries(this.controls))if(this.contains(t)&&e(i))return!0;return!1}_reduceValue(){return this._reduceChildren({},(t,i,r)=>((i.enabled||this.disabled)&&(t[r]=i.value),t))}_reduceChildren(e,t){let i=e;return this._forEachChild((r,s)=>{i=t(i,r,s)}),i}_allControlsDisabled(){for(const e of Object.keys(this.controls))if(this.controls[e].enabled)return!1;return Object.keys(this.controls).length>0||this.disabled}_find(e){return this.controls.hasOwnProperty(e)?this.controls[e]:null}}function Gb(n,e){iI(n,e),e.valueAccessor.writeValue(n.value),n.disabled&&e.valueAccessor.setDisabledState?.(!0),function b7(n,e){e.valueAccessor.registerOnChange(t=>{n._pendingValue=t,n._pendingChange=!0,n._pendingDirty=!0,"change"===n.updateOn&&bN(n,e)})}(n,e),function M7(n,e){const t=(i,r)=>{e.valueAccessor.writeValue(i),r&&e.viewToModelUpdate(i)};n.registerOnChange(t),e._registerOnDestroy(()=>{n._unregisterOnChange(t)})}(n,e),function w7(n,e){e.valueAccessor.registerOnTouched(()=>{n._pendingTouched=!0,"blur"===n.updateOn&&n._pendingChange&&bN(n,e),"submit"!==n.updateOn&&n.markAsTouched()})}(n,e),function x7(n,e){if(e.valueAccessor.setDisabledState){const t=i=>{e.valueAccessor.setDisabledState(i)};n.registerOnDisabledChange(t),e._registerOnDestroy(()=>{n._unregisterOnDisabledChange(t)})}}(n,e)}function RC(n,e,t=!0){const i=()=>{};e.valueAccessor&&(e.valueAccessor.registerOnChange(i),e.valueAccessor.registerOnTouched(i)),LC(n,e),n&&(e._invokeOnDestroyCallbacks(),n._registerOnCollectionChange(()=>{}))}function kC(n,e){n.forEach(t=>{t.registerOnValidatorChange&&t.registerOnValidatorChange(e)})}function iI(n,e){const t=cN(n);null!==e.validator?n.setValidators(lN(t,e.validator)):"function"==typeof t&&n.setValidators([t]);const i=uN(n);null!==e.asyncValidator?n.setAsyncValidators(lN(i,e.asyncValidator)):"function"==typeof i&&n.setAsyncValidators([i]);const r=()=>n.updateValueAndValidity();kC(e._rawValidators,r),kC(e._rawAsyncValidators,r)}function LC(n,e){let t=!1;if(null!==n){if(null!==e.validator){const r=cN(n);if(Array.isArray(r)&&r.length>0){const s=r.filter(c=>c!==e.validator);s.length!==r.length&&(t=!0,n.setValidators(s))}}if(null!==e.asyncValidator){const r=uN(n);if(Array.isArray(r)&&r.length>0){const s=r.filter(c=>c!==e.asyncValidator);s.length!==r.length&&(t=!0,n.setAsyncValidators(s))}}}const i=()=>{};return kC(e._rawValidators,i),kC(e._rawAsyncValidators,i),t}function bN(n,e){n._pendingDirty&&n.markAsDirty(),n.setValue(n._pendingValue,{emitModelToViewChange:!1}),e.viewToModelUpdate(n._pendingValue),n._pendingChange=!1}function wN(n,e){iI(n,e)}function CN(n,e){n._syncPendingControls(),e.forEach(t=>{const i=t.control;"submit"===i.updateOn&&i._pendingChange&&(t.viewToModelUpdate(i._pendingValue),i._pendingChange=!1)})}const D7={provide:xl,useExisting:Ai(()=>yp)},jb=(()=>Promise.resolve())();let yp=(()=>{class n extends xl{constructor(t,i){super(),this.submitted=!1,this._directives=new Set,this.ngSubmit=new Dn,this.form=new nI({},qA(t),ZA(i))}ngAfterViewInit(){this._setUpdateStrategy()}get formDirective(){return this}get control(){return this.form}get path(){return[]}get controls(){return this.form.controls}addControl(t){jb.then(()=>{const i=this._findContainer(t.path);t.control=i.registerControl(t.name,t.control),Gb(t.control,t),t.control.updateValueAndValidity({emitEvent:!1}),this._directives.add(t)})}getControl(t){return this.form.get(t.path)}removeControl(t){jb.then(()=>{const i=this._findContainer(t.path);i&&i.removeControl(t.name),this._directives.delete(t)})}addFormGroup(t){jb.then(()=>{const i=this._findContainer(t.path),r=new nI({});wN(r,t),i.registerControl(t.name,r),r.updateValueAndValidity({emitEvent:!1})})}removeFormGroup(t){jb.then(()=>{const i=this._findContainer(t.path);i&&i.removeControl(t.name)})}getFormGroup(t){return this.form.get(t.path)}updateModel(t,i){jb.then(()=>{this.form.get(t.path).setValue(i)})}setValue(t){this.control.setValue(t)}onSubmit(t){return this.submitted=!0,CN(this.form,this._directives),this.ngSubmit.emit(t),"dialog"===t?.target?.method}onReset(){this.resetForm()}resetForm(t){this.form.reset(t),this.submitted=!1}_setUpdateStrategy(){this.options&&null!=this.options.updateOn&&(this.form._updateOn=this.options.updateOn)}_findContainer(t){return t.pop(),t.length?this.form.get(t):this.form}}return n.\u0275fac=function(t){return new(t||n)(Ie(ra,10),Ie(rm,10))},n.\u0275dir=an({type:n,selectors:[["form",3,"ngNoForm","",3,"formGroup",""],["ng-form"],["","ngForm",""]],hostBindings:function(t,i){1&t&&gi("submit",function(s){return i.onSubmit(s)})("reset",function(){return i.onReset()})},inputs:{options:["ngFormOptions","options"]},outputs:{ngSubmit:"ngSubmit"},exportAs:["ngForm"],features:[hr([D7]),dn]}),n})();function SN(n,e){const t=n.indexOf(e);t>-1&&n.splice(t,1)}function EN(n){return"object"==typeof n&&null!==n&&2===Object.keys(n).length&&"value"in n&&"disabled"in n}const TN=class extends xN{constructor(e=null,t,i){super(eI(t),tI(i,t)),this.defaultValue=null,this._onChange=[],this._pendingChange=!1,this._applyFormState(e),this._setUpdateStrategy(t),this._initObservables(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator}),IC(t)&&(t.nonNullable||t.initialValueIsDefault)&&(this.defaultValue=EN(e)?e.value:e)}setValue(e,t={}){this.value=this._pendingValue=e,this._onChange.length&&!1!==t.emitModelToViewChange&&this._onChange.forEach(i=>i(this.value,!1!==t.emitViewToModelChange)),this.updateValueAndValidity(t)}patchValue(e,t={}){this.setValue(e,t)}reset(e=this.defaultValue,t={}){this._applyFormState(e),this.markAsPristine(t),this.markAsUntouched(t),this.setValue(this.value,t),this._pendingChange=!1}_updateValue(){}_anyControls(e){return!1}_allControlsDisabled(){return this.disabled}registerOnChange(e){this._onChange.push(e)}_unregisterOnChange(e){SN(this._onChange,e)}registerOnDisabledChange(e){this._onDisabledChange.push(e)}_unregisterOnDisabledChange(e){SN(this._onDisabledChange,e)}_forEachChild(e){}_syncPendingControls(){return!("submit"!==this.updateOn||(this._pendingDirty&&this.markAsDirty(),this._pendingTouched&&this.markAsTouched(),!this._pendingChange)||(this.setValue(this._pendingValue,{onlySelf:!0,emitModelToViewChange:!1}),0))}_applyFormState(e){EN(e)?(this.value=this._pendingValue=e.value,e.disabled?this.disable({onlySelf:!0,emitEvent:!1}):this.enable({onlySelf:!0,emitEvent:!1})):this.value=this._pendingValue=e}},P7={provide:_p,useExisting:Ai(()=>OC)},IN=(()=>Promise.resolve())();let OC=(()=>{class n extends _p{constructor(t,i,r,s,c){super(),this._changeDetectorRef=c,this.control=new TN,this._registered=!1,this.update=new Dn,this._parent=t,this._setValidators(i),this._setAsyncValidators(r),this.valueAccessor=function sI(n,e){if(!e)return null;let t,i,r;return Array.isArray(e),e.forEach(s=>{s.constructor===WA?t=s:function E7(n){return Object.getPrototypeOf(n.constructor)===Ng}(s)?i=s:r=s}),r||i||t||null}(0,s)}ngOnChanges(t){if(this._checkForErrors(),!this._registered||"name"in t){if(this._registered&&(this._checkName(),this.formDirective)){const i=t.name.previousValue;this.formDirective.removeControl({name:i,path:this._getPath(i)})}this._setUpControl()}"isDisabled"in t&&this._updateDisabled(t),function rI(n,e){if(!n.hasOwnProperty("model"))return!1;const t=n.model;return!!t.isFirstChange()||!Object.is(e,t.currentValue)}(t,this.viewModel)&&(this._updateValue(this.model),this.viewModel=this.model)}ngOnDestroy(){this.formDirective&&this.formDirective.removeControl(this)}get path(){return this._getPath(this.name)}get formDirective(){return this._parent?this._parent.formDirective:null}viewToModelUpdate(t){this.viewModel=t,this.update.emit(t)}_setUpControl(){this._setUpdateStrategy(),this._isStandalone()?this._setUpStandalone():this.formDirective.addControl(this),this._registered=!0}_setUpdateStrategy(){this.options&&null!=this.options.updateOn&&(this.control._updateOn=this.options.updateOn)}_isStandalone(){return!this._parent||!(!this.options||!this.options.standalone)}_setUpStandalone(){Gb(this.control,this),this.control.updateValueAndValidity({emitEvent:!1})}_checkForErrors(){this._isStandalone()||this._checkParentType(),this._checkName()}_checkParentType(){}_checkName(){this.options&&this.options.name&&(this.name=this.options.name),this._isStandalone()}_updateValue(t){IN.then(()=>{this.control.setValue(t,{emitViewToModelChange:!1}),this._changeDetectorRef?.markForCheck()})}_updateDisabled(t){const i=t.isDisabled.currentValue,r=0!==i&&cp(i);IN.then(()=>{r&&!this.control.disabled?this.control.disable():!r&&this.control.disabled&&this.control.enable(),this._changeDetectorRef?.markForCheck()})}_getPath(t){return this._parent?function PC(n,e){return[...e.path,n]}(t,this._parent):[t]}}return n.\u0275fac=function(t){return new(t||n)(Ie(xl,9),Ie(ra,10),Ie(rm,10),Ie(Yl,10),Ie(Ho,8))},n.\u0275dir=an({type:n,selectors:[["","ngModel","",3,"formControlName","",3,"formControl",""]],inputs:{name:"name",isDisabled:["disabled","isDisabled"],model:["ngModel","model"],options:["ngModelOptions","options"]},outputs:{update:"ngModelChange"},exportAs:["ngModel"],features:[hr([P7]),dn,Nr]}),n})(),bv=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275dir=an({type:n,selectors:[["form",3,"ngNoForm","",3,"ngNativeValidate",""]],hostAttrs:["novalidate",""]}),n})(),RN=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=Gn({type:n}),n.\u0275inj=Bn({}),n})();const N7={provide:xl,useExisting:Ai(()=>FC)};let FC=(()=>{class n extends xl{constructor(t,i){super(),this.submitted=!1,this._onCollectionChange=()=>this._updateDomValue(),this.directives=[],this.form=null,this.ngSubmit=new Dn,this._setValidators(t),this._setAsyncValidators(i)}ngOnChanges(t){this._checkFormPresent(),t.hasOwnProperty("form")&&(this._updateValidators(),this._updateDomValue(),this._updateRegistrations(),this._oldForm=this.form)}ngOnDestroy(){this.form&&(LC(this.form,this),this.form._onCollectionChange===this._onCollectionChange&&this.form._registerOnCollectionChange(()=>{}))}get formDirective(){return this}get control(){return this.form}get path(){return[]}addControl(t){const i=this.form.get(t.path);return Gb(i,t),i.updateValueAndValidity({emitEvent:!1}),this.directives.push(t),i}getControl(t){return this.form.get(t.path)}removeControl(t){RC(t.control||null,t,!1),function T7(n,e){const t=n.indexOf(e);t>-1&&n.splice(t,1)}(this.directives,t)}addFormGroup(t){this._setUpFormContainer(t)}removeFormGroup(t){this._cleanUpFormContainer(t)}getFormGroup(t){return this.form.get(t.path)}addFormArray(t){this._setUpFormContainer(t)}removeFormArray(t){this._cleanUpFormContainer(t)}getFormArray(t){return this.form.get(t.path)}updateModel(t,i){this.form.get(t.path).setValue(i)}onSubmit(t){return this.submitted=!0,CN(this.form,this.directives),this.ngSubmit.emit(t),"dialog"===t?.target?.method}onReset(){this.resetForm()}resetForm(t){this.form.reset(t),this.submitted=!1}_updateDomValue(){this.directives.forEach(t=>{const i=t.control,r=this.form.get(t.path);i!==r&&(RC(i||null,t),(n=>n instanceof TN)(r)&&(Gb(r,t),t.control=r))}),this.form._updateTreeValidity({emitEvent:!1})}_setUpFormContainer(t){const i=this.form.get(t.path);wN(i,t),i.updateValueAndValidity({emitEvent:!1})}_cleanUpFormContainer(t){if(this.form){const i=this.form.get(t.path);i&&function C7(n,e){return LC(n,e)}(i,t)&&i.updateValueAndValidity({emitEvent:!1})}}_updateRegistrations(){this.form._registerOnCollectionChange(this._onCollectionChange),this._oldForm&&this._oldForm._registerOnCollectionChange(()=>{})}_updateValidators(){iI(this.form,this),this._oldForm&&LC(this._oldForm,this)}_checkFormPresent(){}}return n.\u0275fac=function(t){return new(t||n)(Ie(ra,10),Ie(rm,10))},n.\u0275dir=an({type:n,selectors:[["","formGroup",""]],hostBindings:function(t,i){1&t&&gi("submit",function(s){return i.onSubmit(s)})("reset",function(){return i.onReset()})},inputs:{form:["formGroup","form"]},outputs:{ngSubmit:"ngSubmit"},exportAs:["ngForm"],features:[hr([N7]),dn,Nr]}),n})();const U7={provide:Yl,useExisting:Ai(()=>NC),multi:!0};function zN(n,e){return null==n?`${e}`:(e&&"object"==typeof e&&(e="Object"),`${n}: ${e}`.slice(0,50))}let NC=(()=>{class n extends Ng{constructor(){super(...arguments),this._optionMap=new Map,this._idCounter=0,this._compareWith=Object.is}set compareWith(t){this._compareWith=t}writeValue(t){this.value=t;const r=zN(this._getOptionId(t),t);this.setProperty("value",r)}registerOnChange(t){this.onChange=i=>{this.value=this._getOptionValue(i),t(this.value)}}_registerOption(){return(this._idCounter++).toString()}_getOptionId(t){for(const i of Array.from(this._optionMap.keys()))if(this._compareWith(this._optionMap.get(i),t))return i;return null}_getOptionValue(t){const i=function H7(n){return n.split(":")[0]}(t);return this._optionMap.has(i)?this._optionMap.get(i):t}}return n.\u0275fac=function(){let e;return function(i){return(e||(e=hi(n)))(i||n)}}(),n.\u0275dir=an({type:n,selectors:[["select","formControlName","",3,"multiple",""],["select","formControl","",3,"multiple",""],["select","ngModel","",3,"multiple",""]],hostBindings:function(t,i){1&t&&gi("change",function(s){return i.onChange(s.target.value)})("blur",function(){return i.onTouched()})},inputs:{compareWith:"compareWith"},features:[hr([U7]),dn]}),n})(),VN=(()=>{class n{constructor(t,i,r){this._element=t,this._renderer=i,this._select=r,this._select&&(this.id=this._select._registerOption())}set ngValue(t){null!=this._select&&(this._select._optionMap.set(this.id,t),this._setElementValue(zN(this.id,t)),this._select.writeValue(this._select.value))}set value(t){this._setElementValue(t),this._select&&this._select.writeValue(this._select.value)}_setElementValue(t){this._renderer.setProperty(this._element.nativeElement,"value",t)}ngOnDestroy(){this._select&&(this._select._optionMap.delete(this.id),this._select.writeValue(this._select.value))}}return n.\u0275fac=function(t){return new(t||n)(Ie(wr),Ie(Ul),Ie(NC,9))},n.\u0275dir=an({type:n,selectors:[["option"]],inputs:{ngValue:"ngValue",value:"value"}}),n})();const G7={provide:Yl,useExisting:Ai(()=>lI),multi:!0};function UN(n,e){return null==n?`${e}`:("string"==typeof e&&(e=`'${e}'`),e&&"object"==typeof e&&(e="Object"),`${n}: ${e}`.slice(0,50))}let lI=(()=>{class n extends Ng{constructor(){super(...arguments),this._optionMap=new Map,this._idCounter=0,this._compareWith=Object.is}set compareWith(t){this._compareWith=t}writeValue(t){let i;if(this.value=t,Array.isArray(t)){const r=t.map(s=>this._getOptionId(s));i=(s,c)=>{s._setSelected(r.indexOf(c.toString())>-1)}}else i=(r,s)=>{r._setSelected(!1)};this._optionMap.forEach(i)}registerOnChange(t){this.onChange=i=>{const r=[],s=i.selectedOptions;if(void 0!==s){const c=s;for(let d=0;d<c.length;d++){const y=this._getOptionValue(c[d].value);r.push(y)}}else{const c=i.options;for(let d=0;d<c.length;d++){const m=c[d];if(m.selected){const y=this._getOptionValue(m.value);r.push(y)}}}this.value=r,t(r)}}_registerOption(t){const i=(this._idCounter++).toString();return this._optionMap.set(i,t),i}_getOptionId(t){for(const i of Array.from(this._optionMap.keys()))if(this._compareWith(this._optionMap.get(i)._value,t))return i;return null}_getOptionValue(t){const i=function j7(n){return n.split(":")[0]}(t);return this._optionMap.has(i)?this._optionMap.get(i)._value:t}}return n.\u0275fac=function(){let e;return function(i){return(e||(e=hi(n)))(i||n)}}(),n.\u0275dir=an({type:n,selectors:[["select","multiple","","formControlName",""],["select","multiple","","formControl",""],["select","multiple","","ngModel",""]],hostBindings:function(t,i){1&t&&gi("change",function(s){return i.onChange(s.target)})("blur",function(){return i.onTouched()})},inputs:{compareWith:"compareWith"},features:[hr([G7]),dn]}),n})(),HN=(()=>{class n{constructor(t,i,r){this._element=t,this._renderer=i,this._select=r,this._select&&(this.id=this._select._registerOption(this))}set ngValue(t){null!=this._select&&(this._value=t,this._setElementValue(UN(this.id,t)),this._select.writeValue(this._select.value))}set value(t){this._select?(this._value=t,this._setElementValue(UN(this.id,t)),this._select.writeValue(this._select.value)):this._setElementValue(t)}_setElementValue(t){this._renderer.setProperty(this._element.nativeElement,"value",t)}_setSelected(t){this._renderer.setProperty(this._element.nativeElement,"selected",t)}ngOnDestroy(){this._select&&(this._select._optionMap.delete(this.id),this._select.writeValue(this._select.value))}}return n.\u0275fac=function(t){return new(t||n)(Ie(wr),Ie(Ul),Ie(lI,9))},n.\u0275dir=an({type:n,selectors:[["option"]],inputs:{ngValue:"ngValue",value:"value"}}),n})(),J7=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=Gn({type:n}),n.\u0275inj=Bn({imports:[RN]}),n})(),eZ=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=Gn({type:n}),n.\u0275inj=Bn({imports:[J7]}),n})();function dI(n){return new ci(e=>{ws(n()).subscribe(e)})}function uu(n,e){return Dr((t,i)=>{let r=null,s=0,c=!1;const d=()=>c&&!r&&i.complete();t.subscribe(Pr(i,m=>{r?.unsubscribe();let y=0;const w=s++;ws(n(m,w)).subscribe(r=Pr(i,S=>i.next(e?e(m,S,w,y++):S),()=>{r=null,d()}))},()=>{c=!0,d()}))})}const nZ=["trigger"],iZ=["panel"];function rZ(n,e){if(1&n&&(Ae(0,"span",8),it(1),xe()),2&n){const t=ki();Et(1),Qs(t.placeholder)}}function sZ(n,e){if(1&n&&(Ae(0,"span",12),it(1),xe()),2&n){const t=ki(2);Et(1),Qs(t.triggerValue)}}function oZ(n,e){1&n&&us(0,0,["*ngSwitchCase","true"])}function aZ(n,e){1&n&&(Ae(0,"span",9),Di(1,sZ,2,1,"span",10),Di(2,oZ,1,0,"ng-content",11),xe()),2&n&&(Kt("ngSwitch",!!ki().customTrigger),Et(2),Kt("ngSwitchCase",!0))}function lZ(n,e){if(1&n){const t=Yd();Ae(0,"div",13)(1,"div",14,15),gi("@transformPanel.done",function(r){return As(t),Us(ki()._panelDoneAnimatingStream.next(r.toState))})("keydown",function(r){return As(t),Us(ki()._handleKeydown(r))}),us(3,1),xe()()}if(2&n){const t=ki();Kt("@transformPanelWrap",void 0),Et(1),uk("mat-select-panel ",t._getPanelTheme(),""),Eg("transform-origin",t._transformOrigin)("font-size",t._triggerFontSize,"px"),Kt("ngClass",t.panelClass)("@transformPanel",t.multiple?"showing-multiple":"showing"),tr("id",t.id+"-panel")("aria-multiselectable",t.multiple)("aria-label",t.ariaLabel||null)("aria-labelledby",t._getPanelAriaLabelledby())}}const cZ=[[["mat-select-trigger"]],"*"],uZ=["mat-select-trigger","*"],KN={transformPanelWrap:fd("transformPanelWrap",[qa("* => void",qW("@transformPanel",[WW()],{optional:!0}))]),transformPanel:fd("transformPanel",[Mo("void",Cr({transform:"scaleY(0.8)",minWidth:"100%",opacity:0})),Mo("showing",Cr({opacity:1,minWidth:"calc(100% + 32px)",transform:"scaleY(1)"})),Mo("showing-multiple",Cr({opacity:1,minWidth:"calc(100% + 64px)",transform:"scaleY(1)"})),qa("void => *",vl("120ms cubic-bezier(0, 0, 0.2, 1)")),qa("* => void",vl("100ms 25ms linear",Cr({opacity:0})))])};let QN=0;const eB=new Vt("mat-select-scroll-strategy"),fZ=new Vt("MAT_SELECT_CONFIG"),mZ={provide:eB,deps:[yv],useFactory:function pZ(n){return()=>n.scrollStrategies.reposition()}};class gZ{constructor(e,t){this.source=e,this.value=t}}const _Z=Ib(fC(hC(yW(class{constructor(n,e,t,i,r){this._elementRef=n,this._defaultErrorStateMatcher=e,this._parentForm=t,this._parentFormGroup=i,this.ngControl=r,this.stateChanges=new si}})))),yZ=new Vt("MatSelectTrigger");let vZ=(()=>{class n extends _Z{constructor(t,i,r,s,c,d,m,y,w,S,T,I,R,k){super(c,s,m,y,S),this._viewportRuler=t,this._changeDetectorRef=i,this._ngZone=r,this._dir=d,this._parentFormField=w,this._liveAnnouncer=R,this._defaultOptions=k,this._panelOpen=!1,this._compareWith=(F,G)=>F===G,this._uid="mat-select-"+QN++,this._triggerAriaLabelledBy=null,this._destroy=new si,this._onChange=()=>{},this._onTouched=()=>{},this._valueId="mat-select-value-"+QN++,this._panelDoneAnimatingStream=new si,this._overlayPanelClass=this._defaultOptions?.overlayPanelClass||"",this._focused=!1,this.controlType="mat-select",this._multiple=!1,this._disableOptionCentering=this._defaultOptions?.disableOptionCentering??!1,this.ariaLabel="",this.optionSelectionChanges=dI(()=>{const F=this.options;return F?F.changes.pipe(Xl(F),uu(()=>so(...F.map(G=>G.onSelectionChange)))):this._ngZone.onStable.pipe(xc(1),uu(()=>this.optionSelectionChanges))}),this.openedChange=new Dn,this._openedStream=this.openedChange.pipe(na(F=>F),ei(()=>{})),this._closedStream=this.openedChange.pipe(na(F=>!F),ei(()=>{})),this.selectionChange=new Dn,this.valueChange=new Dn,this.ngControl&&(this.ngControl.valueAccessor=this),null!=k?.typeaheadDebounceInterval&&(this._typeaheadDebounceInterval=k.typeaheadDebounceInterval),this._scrollStrategyFactory=I,this._scrollStrategy=this._scrollStrategyFactory(),this.tabIndex=parseInt(T)||0,this.id=this.id}get focused(){return this._focused||this._panelOpen}get placeholder(){return this._placeholder}set placeholder(t){this._placeholder=t,this.stateChanges.next()}get required(){return this._required??this.ngControl?.control?.hasValidator(W3.required)??!1}set required(t){this._required=Kr(t),this.stateChanges.next()}get multiple(){return this._multiple}set multiple(t){this._multiple=Kr(t)}get disableOptionCentering(){return this._disableOptionCentering}set disableOptionCentering(t){this._disableOptionCentering=Kr(t)}get compareWith(){return this._compareWith}set compareWith(t){this._compareWith=t,this._selectionModel&&this._initializeSelection()}get value(){return this._value}set value(t){this._assignValue(t)&&this._onChange(t)}get typeaheadDebounceInterval(){return this._typeaheadDebounceInterval}set typeaheadDebounceInterval(t){this._typeaheadDebounceInterval=Jf(t)}get id(){return this._id}set id(t){this._id=t||this._uid,this.stateChanges.next()}ngOnInit(){this._selectionModel=new SA(this.multiple),this.stateChanges.next(),this._panelDoneAnimatingStream.pipe(gA(),ia(this._destroy)).subscribe(()=>this._panelDoneAnimating(this.panelOpen))}ngAfterContentInit(){this._initKeyManager(),this._selectionModel.changed.pipe(ia(this._destroy)).subscribe(t=>{t.added.forEach(i=>i.select()),t.removed.forEach(i=>i.deselect())}),this.options.changes.pipe(Xl(null),ia(this._destroy)).subscribe(()=>{this._resetOptions(),this._initializeSelection()})}ngDoCheck(){const t=this._getTriggerAriaLabelledby(),i=this.ngControl;if(t!==this._triggerAriaLabelledBy){const r=this._elementRef.nativeElement;this._triggerAriaLabelledBy=t,t?r.setAttribute("aria-labelledby",t):r.removeAttribute("aria-labelledby")}i&&(this._previousControl!==i.control&&(void 0!==this._previousControl&&null!==i.disabled&&i.disabled!==this.disabled&&(this.disabled=i.disabled),this._previousControl=i.control),this.updateErrorState())}ngOnChanges(t){(t.disabled||t.userAriaDescribedBy)&&this.stateChanges.next(),t.typeaheadDebounceInterval&&this._keyManager&&this._keyManager.withTypeAhead(this._typeaheadDebounceInterval)}ngOnDestroy(){this._destroy.next(),this._destroy.complete(),this.stateChanges.complete()}toggle(){this.panelOpen?this.close():this.open()}open(){this._canOpen()&&(this._panelOpen=!0,this._keyManager.withHorizontalOrientation(null),this._highlightCorrectOption(),this._changeDetectorRef.markForCheck())}close(){this._panelOpen&&(this._panelOpen=!1,this._keyManager.withHorizontalOrientation(this._isRtl()?"rtl":"ltr"),this._changeDetectorRef.markForCheck(),this._onTouched())}writeValue(t){this._assignValue(t)}registerOnChange(t){this._onChange=t}registerOnTouched(t){this._onTouched=t}setDisabledState(t){this.disabled=t,this._changeDetectorRef.markForCheck(),this.stateChanges.next()}get panelOpen(){return this._panelOpen}get selected(){return this.multiple?this._selectionModel?.selected||[]:this._selectionModel?.selected[0]}get triggerValue(){if(this.empty)return"";if(this._multiple){const t=this._selectionModel.selected.map(i=>i.viewValue);return this._isRtl()&&t.reverse(),t.join(", ")}return this._selectionModel.selected[0].viewValue}_isRtl(){return!!this._dir&&"rtl"===this._dir.value}_handleKeydown(t){this.disabled||(this.panelOpen?this._handleOpenKeydown(t):this._handleClosedKeydown(t))}_handleClosedKeydown(t){const i=t.keyCode,r=40===i||38===i||37===i||39===i,s=13===i||32===i,c=this._keyManager;if(!c.isTyping()&&s&&!th(t)||(this.multiple||t.altKey)&&r)t.preventDefault(),this.open();else if(!this.multiple){const d=this.selected;c.onKeydown(t);const m=this.selected;m&&d!==m&&this._liveAnnouncer.announce(m.viewValue,1e4)}}_handleOpenKeydown(t){const i=this._keyManager,r=t.keyCode,s=40===r||38===r,c=i.isTyping();if(s&&t.altKey)t.preventDefault(),this.close();else if(c||13!==r&&32!==r||!i.activeItem||th(t))if(!c&&this._multiple&&65===r&&t.ctrlKey){t.preventDefault();const d=this.options.some(m=>!m.disabled&&!m.selected);this.options.forEach(m=>{m.disabled||(d?m.select():m.deselect())})}else{const d=i.activeItemIndex;i.onKeydown(t),this._multiple&&s&&t.shiftKey&&i.activeItem&&i.activeItemIndex!==d&&i.activeItem._selectViaInteraction()}else t.preventDefault(),i.activeItem._selectViaInteraction()}_onFocus(){this.disabled||(this._focused=!0,this.stateChanges.next())}_onBlur(){this._focused=!1,!this.disabled&&!this.panelOpen&&(this._onTouched(),this._changeDetectorRef.markForCheck(),this.stateChanges.next())}_onAttached(){this._overlayDir.positionChange.pipe(xc(1)).subscribe(()=>{this._changeDetectorRef.detectChanges(),this._positioningSettled()})}_getPanelTheme(){return this._parentFormField?`mat-${this._parentFormField.color}`:""}get empty(){return!this._selectionModel||this._selectionModel.isEmpty()}_initializeSelection(){Promise.resolve().then(()=>{this.ngControl&&(this._value=this.ngControl.value),this._setSelectionByValue(this._value),this.stateChanges.next()})}_setSelectionByValue(t){if(this._selectionModel.selected.forEach(i=>i.setInactiveStyles()),this._selectionModel.clear(),this.multiple&&t)Array.isArray(t),t.forEach(i=>this._selectOptionByValue(i)),this._sortValues();else{const i=this._selectOptionByValue(t);i?this._keyManager.updateActiveItem(i):this.panelOpen||this._keyManager.updateActiveItem(-1)}this._changeDetectorRef.markForCheck()}_selectOptionByValue(t){const i=this.options.find(r=>{if(this._selectionModel.isSelected(r))return!1;try{return null!=r.value&&this._compareWith(r.value,t)}catch{return!1}});return i&&this._selectionModel.select(i),i}_assignValue(t){return!!(t!==this._value||this._multiple&&Array.isArray(t))&&(this.options&&this._setSelectionByValue(t),this._value=t,!0)}_initKeyManager(){this._keyManager=new Z$(this.options).withTypeAhead(this._typeaheadDebounceInterval).withVerticalOrientation().withHorizontalOrientation(this._isRtl()?"rtl":"ltr").withHomeAndEnd().withAllowedModifierKeys(["shiftKey"]),this._keyManager.tabOut.pipe(ia(this._destroy)).subscribe(()=>{this.panelOpen&&(!this.multiple&&this._keyManager.activeItem&&this._keyManager.activeItem._selectViaInteraction(),this.focus(),this.close())}),this._keyManager.change.pipe(ia(this._destroy)).subscribe(()=>{this._panelOpen&&this.panel?this._scrollOptionIntoView(this._keyManager.activeItemIndex||0):!this._panelOpen&&!this.multiple&&this._keyManager.activeItem&&this._keyManager.activeItem._selectViaInteraction()})}_resetOptions(){const t=so(this.options.changes,this._destroy);this.optionSelectionChanges.pipe(ia(t)).subscribe(i=>{this._onSelect(i.source,i.isUserInput),i.isUserInput&&!this.multiple&&this._panelOpen&&(this.close(),this.focus())}),so(...this.options.map(i=>i._stateChanges)).pipe(ia(t)).subscribe(()=>{this._changeDetectorRef.markForCheck(),this.stateChanges.next()})}_onSelect(t,i){const r=this._selectionModel.isSelected(t);null!=t.value||this._multiple?(r!==t.selected&&(t.selected?this._selectionModel.select(t):this._selectionModel.deselect(t)),i&&this._keyManager.setActiveItem(t),this.multiple&&(this._sortValues(),i&&this.focus())):(t.deselect(),this._selectionModel.clear(),null!=this.value&&this._propagateChanges(t.value)),r!==this._selectionModel.isSelected(t)&&this._propagateChanges(),this.stateChanges.next()}_sortValues(){if(this.multiple){const t=this.options.toArray();this._selectionModel.sort((i,r)=>this.sortComparator?this.sortComparator(i,r,t):t.indexOf(i)-t.indexOf(r)),this.stateChanges.next()}}_propagateChanges(t){let i=null;i=this.multiple?this.selected.map(r=>r.value):this.selected?this.selected.value:t,this._value=i,this.valueChange.emit(i),this._onChange(i),this.selectionChange.emit(this._getChangeEvent(i)),this._changeDetectorRef.markForCheck()}_highlightCorrectOption(){this._keyManager&&(this.empty?this._keyManager.setFirstItemActive():this._keyManager.setActiveItem(this._selectionModel.selected[0]))}_canOpen(){return!this._panelOpen&&!this.disabled&&this.options?.length>0}focus(t){this._elementRef.nativeElement.focus(t)}_getPanelAriaLabelledby(){if(this.ariaLabel)return null;const t=this._parentFormField?.getLabelId();return this.ariaLabelledby?(t?t+" ":"")+this.ariaLabelledby:t}_getAriaActiveDescendant(){return this.panelOpen&&this._keyManager&&this._keyManager.activeItem?this._keyManager.activeItem.id:null}_getTriggerAriaLabelledby(){if(this.ariaLabel)return null;const t=this._parentFormField?.getLabelId();let i=(t?t+" ":"")+this._valueId;return this.ariaLabelledby&&(i+=" "+this.ariaLabelledby),i}_panelDoneAnimating(t){this.openedChange.emit(t)}setDescribedByIds(t){t.length?this._elementRef.nativeElement.setAttribute("aria-describedby",t.join(" ")):this._elementRef.nativeElement.removeAttribute("aria-describedby")}onContainerClick(){this.focus(),this.open()}get shouldLabelFloat(){return this._panelOpen||!this.empty||this._focused&&!!this._placeholder}}return n.\u0275fac=function(t){return new(t||n)(Ie(jA),Ie(Ho),Ie(nr),Ie(wA),Ie(wr),Ie(em,8),Ie(yp,8),Ie(FC,8),Ie(LA,8),Ie(_p,10),ns("tabindex"),Ie(eB),Ie(oW),Ie(fZ,8))},n.\u0275dir=an({type:n,viewQuery:function(t,i){if(1&t&&(Uo(nZ,5),Uo(iZ,5),Uo(H3,5)),2&t){let r;Gi(r=ji())&&(i.trigger=r.first),Gi(r=ji())&&(i.panel=r.first),Gi(r=ji())&&(i._overlayDir=r.first)}},inputs:{userAriaDescribedBy:["aria-describedby","userAriaDescribedBy"],panelClass:"panelClass",placeholder:"placeholder",required:"required",multiple:"multiple",disableOptionCentering:"disableOptionCentering",compareWith:"compareWith",value:"value",ariaLabel:["aria-label","ariaLabel"],ariaLabelledby:["aria-labelledby","ariaLabelledby"],errorStateMatcher:"errorStateMatcher",typeaheadDebounceInterval:"typeaheadDebounceInterval",sortComparator:"sortComparator",id:"id"},outputs:{openedChange:"openedChange",_openedStream:"opened",_closedStream:"closed",selectionChange:"selectionChange",valueChange:"valueChange"},features:[dn,Nr]}),n})(),xZ=(()=>{class n extends vZ{constructor(){super(...arguments),this._scrollTop=0,this._triggerFontSize=0,this._transformOrigin="top",this._offsetY=0,this._positions=[{originX:"start",originY:"top",overlayX:"start",overlayY:"top"},{originX:"start",originY:"bottom",overlayX:"start",overlayY:"bottom"}]}_calculateOverlayScroll(t,i,r){const s=this._getItemHeight();return Math.min(Math.max(0,s*t-i+s/2),r)}ngOnInit(){super.ngOnInit(),this._viewportRuler.change().pipe(ia(this._destroy)).subscribe(()=>{this.panelOpen&&(this._triggerRect=this.trigger.nativeElement.getBoundingClientRect(),this._changeDetectorRef.markForCheck())})}open(){super._canOpen()&&(super.open(),this._triggerRect=this.trigger.nativeElement.getBoundingClientRect(),this._triggerFontSize=parseInt(getComputedStyle(this.trigger.nativeElement).fontSize||"0"),this._calculateOverlayPosition(),this._ngZone.onStable.pipe(xc(1)).subscribe(()=>{this._triggerFontSize&&this._overlayDir.overlayRef&&this._overlayDir.overlayRef.overlayElement&&(this._overlayDir.overlayRef.overlayElement.style.fontSize=`${this._triggerFontSize}px`)}))}_scrollOptionIntoView(t){const i=zF(t,this.options,this.optionGroups),r=this._getItemHeight();this.panel.nativeElement.scrollTop=0===t&&1===i?0:function FW(n,e,t,i){return n<t?n:n+e>t+i?Math.max(0,n-i+e):t}((t+i)*r,r,this.panel.nativeElement.scrollTop,256)}_positioningSettled(){this._calculateOverlayOffsetX(),this.panel.nativeElement.scrollTop=this._scrollTop}_panelDoneAnimating(t){this.panelOpen?this._scrollTop=0:(this._overlayDir.offsetX=0,this._changeDetectorRef.markForCheck()),super._panelDoneAnimating(t)}_getChangeEvent(t){return new gZ(this,t)}_calculateOverlayOffsetX(){const t=this._overlayDir.overlayRef.overlayElement.getBoundingClientRect(),i=this._viewportRuler.getViewportSize(),r=this._isRtl(),s=this.multiple?56:32;let c;if(this.multiple)c=40;else if(this.disableOptionCentering)c=16;else{let y=this._selectionModel.selected[0]||this.options.first;c=y&&y.group?32:16}r||(c*=-1);const d=0-(t.left+c-(r?s:0)),m=t.right+c-i.width+(r?0:s);d>0?c+=d+8:m>0&&(c-=m+8),this._overlayDir.offsetX=Math.round(c),this._overlayDir.overlayRef.updatePosition()}_calculateOverlayOffsetY(t,i,r){const s=this._getItemHeight(),c=(s-this._triggerRect.height)/2,d=Math.floor(256/s);let m;return this.disableOptionCentering?0:(m=0===this._scrollTop?t*s:this._scrollTop===r?(t-(this._getItemCount()-d))*s+(s-(this._getItemCount()*s-256)%s):i-s/2,Math.round(-1*m-c))}_checkOverlayWithinViewport(t){const i=this._getItemHeight(),r=this._viewportRuler.getViewportSize(),s=this._triggerRect.top-8,c=r.height-this._triggerRect.bottom-8,d=Math.abs(this._offsetY),y=Math.min(this._getItemCount()*i,256)-d-this._triggerRect.height;y>c?this._adjustPanelUp(y,c):d>s?this._adjustPanelDown(d,s,t):this._transformOrigin=this._getOriginBasedOnOption()}_adjustPanelUp(t,i){const r=Math.round(t-i);this._scrollTop-=r,this._offsetY-=r,this._transformOrigin=this._getOriginBasedOnOption(),this._scrollTop<=0&&(this._scrollTop=0,this._offsetY=0,this._transformOrigin="50% bottom 0px")}_adjustPanelDown(t,i,r){const s=Math.round(t-i);if(this._scrollTop+=s,this._offsetY+=s,this._transformOrigin=this._getOriginBasedOnOption(),this._scrollTop>=r)return this._scrollTop=r,this._offsetY=0,void(this._transformOrigin="50% top 0px")}_calculateOverlayPosition(){const t=this._getItemHeight(),i=this._getItemCount(),r=Math.min(i*t,256),c=i*t-r;let d;d=this.empty?0:Math.max(this.options.toArray().indexOf(this._selectionModel.selected[0]),0),d+=zF(d,this.options,this.optionGroups);const m=r/2;this._scrollTop=this._calculateOverlayScroll(d,m,c),this._offsetY=this._calculateOverlayOffsetY(d,m,c),this._checkOverlayWithinViewport(c)}_getOriginBasedOnOption(){const t=this._getItemHeight(),i=(t-this._triggerRect.height)/2;return`50% ${Math.abs(this._offsetY)-i+t/2}px 0px`}_getItemHeight(){return 3*this._triggerFontSize}_getItemCount(){return this.options.length+this.optionGroups.length}}return n.\u0275fac=function(){let e;return function(i){return(e||(e=hi(n)))(i||n)}}(),n.\u0275cmp=Qn({type:n,selectors:[["mat-select"]],contentQueries:function(t,i,r){if(1&t&&(Js(r,yZ,5),Js(r,BF,5),Js(r,NF,5)),2&t){let s;Gi(s=ji())&&(i.customTrigger=s.first),Gi(s=ji())&&(i.options=s),Gi(s=ji())&&(i.optionGroups=s)}},hostAttrs:["role","combobox","aria-autocomplete","none","aria-haspopup","true",1,"mat-select"],hostVars:19,hostBindings:function(t,i){1&t&&gi("keydown",function(s){return i._handleKeydown(s)})("focus",function(){return i._onFocus()})("blur",function(){return i._onBlur()}),2&t&&(tr("id",i.id)("tabindex",i.tabIndex)("aria-controls",i.panelOpen?i.id+"-panel":null)("aria-expanded",i.panelOpen)("aria-label",i.ariaLabel||null)("aria-required",i.required.toString())("aria-disabled",i.disabled.toString())("aria-invalid",i.errorState)("aria-activedescendant",i._getAriaActiveDescendant()),ds("mat-select-disabled",i.disabled)("mat-select-invalid",i.errorState)("mat-select-required",i.required)("mat-select-empty",i.empty)("mat-select-multiple",i.multiple))},inputs:{disabled:"disabled",disableRipple:"disableRipple",tabIndex:"tabIndex"},exportAs:["matSelect"],features:[hr([{provide:RA,useExisting:n},{provide:FF,useExisting:n}]),dn],ngContentSelectors:uZ,decls:9,vars:12,consts:[["cdk-overlay-origin","",1,"mat-select-trigger",3,"click"],["origin","cdkOverlayOrigin","trigger",""],[1,"mat-select-value",3,"ngSwitch"],["class","mat-select-placeholder mat-select-min-line",4,"ngSwitchCase"],["class","mat-select-value-text",3,"ngSwitch",4,"ngSwitchCase"],[1,"mat-select-arrow-wrapper"],[1,"mat-select-arrow"],["cdk-connected-overlay","","cdkConnectedOverlayLockPosition","","cdkConnectedOverlayHasBackdrop","","cdkConnectedOverlayBackdropClass","cdk-overlay-transparent-backdrop",3,"cdkConnectedOverlayPanelClass","cdkConnectedOverlayScrollStrategy","cdkConnectedOverlayOrigin","cdkConnectedOverlayOpen","cdkConnectedOverlayPositions","cdkConnectedOverlayMinWidth","cdkConnectedOverlayOffsetY","backdropClick","attach","detach"],[1,"mat-select-placeholder","mat-select-min-line"],[1,"mat-select-value-text",3,"ngSwitch"],["class","mat-select-min-line",4,"ngSwitchDefault"],[4,"ngSwitchCase"],[1,"mat-select-min-line"],[1,"mat-select-panel-wrap"],["role","listbox","tabindex","-1",3,"ngClass","keydown"],["panel",""]],template:function(t,i){if(1&t&&(iu(cZ),Ae(0,"div",0,1),gi("click",function(){return i.toggle()}),Ae(3,"div",2),Di(4,rZ,2,1,"span",3),Di(5,aZ,3,2,"span",4),xe(),Ae(6,"div",5),jt(7,"div",6),xe()(),Di(8,lZ,4,14,"ng-template",7),gi("backdropClick",function(){return i.close()})("attach",function(){return i._onAttached()})("detach",function(){return i.close()})),2&t){const r=ob(1);tr("aria-owns",i.panelOpen?i.id+"-panel":null),Et(3),Kt("ngSwitch",i.empty),tr("id",i._valueId),Et(1),Kt("ngSwitchCase",!0),Et(1),Kt("ngSwitchCase",!1),Et(3),Kt("cdkConnectedOverlayPanelClass",i._overlayPanelClass)("cdkConnectedOverlayScrollStrategy",i._scrollStrategy)("cdkConnectedOverlayOrigin",r)("cdkConnectedOverlayOpen",i.panelOpen)("cdkConnectedOverlayPositions",i._positions)("cdkConnectedOverlayMinWidth",null==i._triggerRect?null:i._triggerRect.width)("cdkConnectedOverlayOffsetY",i._offsetY)}},dependencies:[KM,av,QM,PO,H3,U3],styles:['.mat-select{display:inline-block;width:100%;outline:none}.mat-select-trigger{display:inline-flex;align-items:center;cursor:pointer;position:relative;box-sizing:border-box;width:100%}.mat-select-disabled .mat-select-trigger{-webkit-user-select:none;user-select:none;cursor:default}.mat-select-value{width:100%;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.mat-select-value-text{white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.mat-select-arrow-wrapper{height:16px;flex-shrink:0;display:inline-flex;align-items:center}.mat-form-field-appearance-fill .mat-select-arrow-wrapper{transform:translateY(-50%)}.mat-form-field-appearance-outline .mat-select-arrow-wrapper{transform:translateY(-25%)}.mat-form-field-appearance-standard.mat-form-field-has-label .mat-select:not(.mat-select-empty) .mat-select-arrow-wrapper{transform:translateY(-50%)}.mat-form-field-appearance-standard .mat-select.mat-select-empty .mat-select-arrow-wrapper{transition:transform 400ms cubic-bezier(0.25, 0.8, 0.25, 1)}._mat-animation-noopable.mat-form-field-appearance-standard .mat-select.mat-select-empty .mat-select-arrow-wrapper{transition:none}.mat-select-arrow{width:0;height:0;border-left:5px solid rgba(0,0,0,0);border-right:5px solid rgba(0,0,0,0);border-top:5px solid;margin:0 4px}.mat-form-field.mat-focused .mat-select-arrow{transform:translateX(0)}.mat-select-panel-wrap{flex-basis:100%}.mat-select-panel{min-width:112px;max-width:280px;overflow:auto;-webkit-overflow-scrolling:touch;padding-top:0;padding-bottom:0;max-height:256px;min-width:100%;border-radius:4px;outline:0}.cdk-high-contrast-active .mat-select-panel{outline:solid 1px}.mat-select-panel .mat-optgroup-label,.mat-select-panel .mat-option{font-size:inherit;line-height:3em;height:3em}.mat-form-field-type-mat-select:not(.mat-form-field-disabled) .mat-form-field-flex{cursor:pointer}.mat-form-field-type-mat-select .mat-form-field-label{width:calc(100% - 18px)}.mat-select-placeholder{transition:color 400ms 133.3333333333ms cubic-bezier(0.25, 0.8, 0.25, 1)}._mat-animation-noopable .mat-select-placeholder{transition:none}.mat-form-field-hide-placeholder .mat-select-placeholder{color:rgba(0,0,0,0);-webkit-text-fill-color:rgba(0,0,0,0);transition:none;display:block}.mat-select-min-line:empty::before{content:" ";white-space:pre;width:1px;display:inline-block;visibility:hidden}'],encapsulation:2,data:{animation:[KN.transformPanelWrap,KN.transformPanel]},changeDetection:0}),n})(),tB=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=Gn({type:n}),n.\u0275inj=Bn({providers:[mZ],imports:[au,SC,VF,Ki,Vb,_C,VF,Ki]}),n})();const bZ=["*",[["mat-card-footer"]]],wZ=["*","mat-card-footer"];let MZ=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275dir=an({type:n,selectors:[["mat-card-title"],["","mat-card-title",""],["","matCardTitle",""]],hostAttrs:[1,"mat-card-title"]}),n})(),CZ=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275dir=an({type:n,selectors:[["mat-card-subtitle"],["","mat-card-subtitle",""],["","matCardSubtitle",""]],hostAttrs:[1,"mat-card-subtitle"]}),n})(),nB=(()=>{class n{constructor(t){this._animationMode=t}}return n.\u0275fac=function(t){return new(t||n)(Ie(ru,8))},n.\u0275cmp=Qn({type:n,selectors:[["mat-card"]],hostAttrs:[1,"mat-card","mat-focus-indicator"],hostVars:2,hostBindings:function(t,i){2&t&&ds("_mat-animation-noopable","NoopAnimations"===i._animationMode)},exportAs:["matCard"],ngContentSelectors:wZ,decls:2,vars:0,template:function(t,i){1&t&&(iu(bZ),us(0),us(1,1))},styles:[".mat-card{transition:box-shadow 280ms cubic-bezier(0.4, 0, 0.2, 1);display:block;position:relative;padding:16px;border-radius:4px}.mat-card._mat-animation-noopable{transition:none !important;animation:none !important}.mat-card>.mat-divider-horizontal{position:absolute;left:0;width:100%}[dir=rtl] .mat-card>.mat-divider-horizontal{left:auto;right:0}.mat-card>.mat-divider-horizontal.mat-divider-inset{position:static;margin:0}[dir=rtl] .mat-card>.mat-divider-horizontal.mat-divider-inset{margin-right:0}.cdk-high-contrast-active .mat-card{outline:solid 1px}.mat-card-actions,.mat-card-subtitle,.mat-card-content{display:block;margin-bottom:16px}.mat-card-title{display:block;margin-bottom:8px}.mat-card-actions{margin-left:-8px;margin-right:-8px;padding:8px 0}.mat-card-actions-align-end{display:flex;justify-content:flex-end}.mat-card-image{width:calc(100% + 32px);margin:0 -16px 16px -16px;display:block;overflow:hidden}.mat-card-image img{width:100%}.mat-card-footer{display:block;margin:0 -16px -16px -16px}.mat-card-actions .mat-button,.mat-card-actions .mat-raised-button,.mat-card-actions .mat-stroked-button{margin:0 8px}.mat-card-header{display:flex;flex-direction:row}.mat-card-header .mat-card-title{margin-bottom:12px}.mat-card-header-text{margin:0 16px}.mat-card-avatar{height:40px;width:40px;border-radius:50%;flex-shrink:0;object-fit:cover}.mat-card-title-group{display:flex;justify-content:space-between}.mat-card-sm-image{width:80px;height:80px}.mat-card-md-image{width:112px;height:112px}.mat-card-lg-image{width:152px;height:152px}.mat-card-xl-image{width:240px;height:240px;margin:-8px}.mat-card-title-group>.mat-card-xl-image{margin:-8px 0 8px}@media(max-width: 599px){.mat-card-title-group{margin:0}.mat-card-xl-image{margin-left:0;margin-right:0}}.mat-card>:first-child,.mat-card-content>:first-child{margin-top:0}.mat-card>:last-child:not(.mat-card-footer),.mat-card-content>:last-child:not(.mat-card-footer){margin-bottom:0}.mat-card-image:first-child{margin-top:-16px;border-top-left-radius:inherit;border-top-right-radius:inherit}.mat-card>.mat-card-actions:last-child{margin-bottom:-8px;padding-bottom:0}.mat-card-actions:not(.mat-card-actions-align-end) .mat-button:first-child,.mat-card-actions:not(.mat-card-actions-align-end) .mat-raised-button:first-child,.mat-card-actions:not(.mat-card-actions-align-end) .mat-stroked-button:first-child{margin-left:0;margin-right:0}.mat-card-actions-align-end .mat-button:last-child,.mat-card-actions-align-end .mat-raised-button:last-child,.mat-card-actions-align-end .mat-stroked-button:last-child{margin-left:0;margin-right:0}.mat-card-title:not(:first-child),.mat-card-subtitle:not(:first-child){margin-top:-4px}.mat-card-header .mat-card-subtitle:not(:first-child){margin-top:-8px}.mat-card>.mat-card-xl-image:first-child{margin-top:-8px}.mat-card>.mat-card-xl-image:last-child{margin-bottom:-8px}"],encapsulation:2,changeDetection:0}),n})(),SZ=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=Gn({type:n}),n.\u0275inj=Bn({imports:[Ki,Ki]}),n})();const EZ=["input"],TZ=function(n){return{enterDuration:n}},DZ=["*"],AZ=new Vt("mat-slide-toggle-default-options",{providedIn:"root",factory:()=>({disableToggleValue:!1})});let IZ=0;const PZ={provide:Yl,useExisting:Ai(()=>iB),multi:!0};class RZ{constructor(e,t){this.source=e,this.checked=t}}const kZ=fC(pC(Ib(hC(class{constructor(n){this._elementRef=n}}))));let LZ=(()=>{class n extends kZ{constructor(t,i,r,s,c,d,m){super(t),this._focusMonitor=i,this._changeDetectorRef=r,this.defaults=c,this._onChange=y=>{},this._onTouched=()=>{},this._required=!1,this._checked=!1,this.name=null,this.labelPosition="after",this.ariaLabel=null,this.ariaLabelledby=null,this.change=new Dn,this.toggleChange=new Dn,this.tabIndex=parseInt(s)||0,this.color=this.defaultColor=c.color||"accent",this._noopAnimations="NoopAnimations"===d,this.id=this._uniqueId=`${m}${++IZ}`}get required(){return this._required}set required(t){this._required=Kr(t)}get checked(){return this._checked}set checked(t){this._checked=Kr(t),this._changeDetectorRef.markForCheck()}get inputId(){return`${this.id||this._uniqueId}-input`}ngAfterContentInit(){this._focusMonitor.monitor(this._elementRef,!0).subscribe(t=>{"keyboard"===t||"program"===t?this._focused=!0:t||Promise.resolve().then(()=>{this._focused=!1,this._onTouched(),this._changeDetectorRef.markForCheck()})})}ngOnDestroy(){this._focusMonitor.stopMonitoring(this._elementRef)}writeValue(t){this.checked=!!t}registerOnChange(t){this._onChange=t}registerOnTouched(t){this._onTouched=t}setDisabledState(t){this.disabled=t,this._changeDetectorRef.markForCheck()}toggle(){this.checked=!this.checked,this._onChange(this.checked)}_emitChangeEvent(){this._onChange(this.checked),this.change.emit(this._createChangeEvent(this.checked))}}return n.\u0275fac=function(t){eu()},n.\u0275dir=an({type:n,inputs:{name:"name",id:"id",labelPosition:"labelPosition",ariaLabel:["aria-label","ariaLabel"],ariaLabelledby:["aria-labelledby","ariaLabelledby"],ariaDescribedby:["aria-describedby","ariaDescribedby"],required:"required",checked:"checked"},outputs:{change:"change",toggleChange:"toggleChange"},features:[dn]}),n})(),iB=(()=>{class n extends LZ{constructor(t,i,r,s,c,d){super(t,i,r,s,c,d,"mat-slide-toggle-")}_createChangeEvent(t){return new RZ(this,t)}_onChangeEvent(t){t.stopPropagation(),this.toggleChange.emit(),this.defaults.disableToggleValue?this._inputElement.nativeElement.checked=this.checked:(this.checked=this._inputElement.nativeElement.checked,this._emitChangeEvent())}_onInputClick(t){t.stopPropagation()}focus(t,i){i?this._focusMonitor.focusVia(this._inputElement,i,t):this._inputElement.nativeElement.focus(t)}_onLabelTextChange(){this._changeDetectorRef.detectChanges()}}return n.\u0275fac=function(t){return new(t||n)(Ie(wr),Ie(fv),Ie(Ho),ns("tabindex"),Ie(AZ),Ie(ru,8))},n.\u0275cmp=Qn({type:n,selectors:[["mat-slide-toggle"]],viewQuery:function(t,i){if(1&t&&Uo(EZ,5),2&t){let r;Gi(r=ji())&&(i._inputElement=r.first)}},hostAttrs:[1,"mat-slide-toggle"],hostVars:13,hostBindings:function(t,i){2&t&&(ev("id",i.id),tr("tabindex",null)("aria-label",null)("aria-labelledby",null)("name",null),ds("mat-checked",i.checked)("mat-disabled",i.disabled)("mat-slide-toggle-label-before","before"==i.labelPosition)("_mat-animation-noopable",i._noopAnimations))},inputs:{disabled:"disabled",disableRipple:"disableRipple",color:"color",tabIndex:"tabIndex"},exportAs:["matSlideToggle"],features:[hr([PZ]),dn],ngContentSelectors:DZ,decls:14,vars:20,consts:[[1,"mat-slide-toggle-label"],["label",""],[1,"mat-slide-toggle-bar"],["type","checkbox","role","switch",1,"mat-slide-toggle-input","cdk-visually-hidden",3,"id","required","tabIndex","checked","disabled","change","click"],["input",""],[1,"mat-slide-toggle-thumb-container"],[1,"mat-slide-toggle-thumb"],["mat-ripple","",1,"mat-slide-toggle-ripple","mat-focus-indicator",3,"matRippleTrigger","matRippleDisabled","matRippleCentered","matRippleRadius","matRippleAnimation"],[1,"mat-ripple-element","mat-slide-toggle-persistent-ripple"],[1,"mat-slide-toggle-content",3,"cdkObserveContent"],["labelContent",""],[2,"display","none"]],template:function(t,i){if(1&t&&(iu(),Ae(0,"label",0,1)(2,"span",2)(3,"input",3,4),gi("change",function(s){return i._onChangeEvent(s)})("click",function(s){return i._onInputClick(s)}),xe(),Ae(5,"span",5),jt(6,"span",6),Ae(7,"span",7),jt(8,"span",8),xe()()(),Ae(9,"span",9,10),gi("cdkObserveContent",function(){return i._onLabelTextChange()}),Ae(11,"span",11),it(12,"\xa0"),xe(),us(13),xe()()),2&t){const r=ob(1),s=ob(10);tr("for",i.inputId),Et(2),ds("mat-slide-toggle-bar-no-side-margin",!s.textContent||!s.textContent.trim()),Et(1),Kt("id",i.inputId)("required",i.required)("tabIndex",i.tabIndex)("checked",i.checked)("disabled",i.disabled),tr("name",i.name)("aria-checked",i.checked)("aria-label",i.ariaLabel)("aria-labelledby",i.ariaLabelledby)("aria-describedby",i.ariaDescribedby),Et(4),Kt("matRippleTrigger",r)("matRippleDisabled",i.disableRipple||i.disabled)("matRippleCentered",!0)("matRippleRadius",20)("matRippleAnimation",uD(18,TZ,i._noopAnimations?0:150))}},dependencies:[Rb,hF],styles:['.mat-slide-toggle{display:inline-block;height:24px;max-width:100%;line-height:24px;white-space:nowrap;outline:none;-webkit-tap-highlight-color:rgba(0,0,0,0)}.mat-slide-toggle.mat-checked .mat-slide-toggle-thumb-container{transform:translate3d(16px, 0, 0)}[dir=rtl] .mat-slide-toggle.mat-checked .mat-slide-toggle-thumb-container{transform:translate3d(-16px, 0, 0)}.mat-slide-toggle.mat-disabled{opacity:.38}.mat-slide-toggle.mat-disabled .mat-slide-toggle-label,.mat-slide-toggle.mat-disabled .mat-slide-toggle-thumb-container{cursor:default}.mat-slide-toggle-label{-webkit-user-select:none;user-select:none;display:flex;flex:1;flex-direction:row;align-items:center;height:inherit;cursor:pointer}.mat-slide-toggle-content{white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.mat-slide-toggle-label-before .mat-slide-toggle-label{order:1}.mat-slide-toggle-label-before .mat-slide-toggle-bar{order:2}[dir=rtl] .mat-slide-toggle-label-before .mat-slide-toggle-bar,.mat-slide-toggle-bar{margin-right:8px;margin-left:0}[dir=rtl] .mat-slide-toggle-bar,.mat-slide-toggle-label-before .mat-slide-toggle-bar{margin-left:8px;margin-right:0}.mat-slide-toggle-bar-no-side-margin{margin-left:0;margin-right:0}.mat-slide-toggle-thumb-container{position:absolute;z-index:1;width:20px;height:20px;top:-3px;left:0;transform:translate3d(0, 0, 0);transition:all 80ms linear;transition-property:transform}._mat-animation-noopable .mat-slide-toggle-thumb-container{transition:none}[dir=rtl] .mat-slide-toggle-thumb-container{left:auto;right:0}.mat-slide-toggle-thumb{height:20px;width:20px;border-radius:50%;display:block}.mat-slide-toggle-bar{position:relative;width:36px;height:14px;flex-shrink:0;border-radius:8px}.mat-slide-toggle-input{bottom:0;left:10px}[dir=rtl] .mat-slide-toggle-input{left:auto;right:10px}.mat-slide-toggle-bar,.mat-slide-toggle-thumb{transition:all 80ms linear;transition-property:background-color;transition-delay:50ms}._mat-animation-noopable .mat-slide-toggle-bar,._mat-animation-noopable .mat-slide-toggle-thumb{transition:none}.mat-slide-toggle .mat-slide-toggle-ripple{position:absolute;top:calc(50% - 20px);left:calc(50% - 20px);height:40px;width:40px;z-index:1;pointer-events:none}.mat-slide-toggle .mat-slide-toggle-ripple .mat-ripple-element:not(.mat-slide-toggle-persistent-ripple){opacity:.12}.mat-slide-toggle-persistent-ripple{width:100%;height:100%;transform:none}.mat-slide-toggle-bar:hover .mat-slide-toggle-persistent-ripple{opacity:.04}.mat-slide-toggle:not(.mat-disabled).cdk-keyboard-focused .mat-slide-toggle-persistent-ripple{opacity:.12}.mat-slide-toggle-persistent-ripple,.mat-slide-toggle.mat-disabled .mat-slide-toggle-bar:hover .mat-slide-toggle-persistent-ripple{opacity:0}@media(hover: none){.mat-slide-toggle-bar:hover .mat-slide-toggle-persistent-ripple{display:none}}.mat-slide-toggle-input:focus~.mat-slide-toggle-thumb-container .mat-focus-indicator::before{content:""}.cdk-high-contrast-active .mat-slide-toggle-thumb,.cdk-high-contrast-active .mat-slide-toggle-bar{border:1px solid}'],encapsulation:2,changeDetection:0}),n})(),rB=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=Gn({type:n}),n.\u0275inj=Bn({}),n})(),NZ=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=Gn({type:n}),n.\u0275inj=Bn({imports:[rB,kb,Ki,_A,rB,Ki]}),n})();const zC=wm(n=>function(){n(this),this.name="EmptyError",this.message="no elements in sequence"});function hI(){return Dr((n,e)=>{let t=null;n._refCount++;const i=Pr(e,void 0,void 0,void 0,()=>{if(!n||n._refCount<=0||0<--n._refCount)return void(t=null);const r=n._connection,s=t;t=null,r&&(!s||r===s)&&r.unsubscribe(),e.unsubscribe()});n.subscribe(i),i.closed||(t=n.connect())})}class sB extends ci{constructor(e,t){super(),this.source=e,this.subjectFactory=t,this._subject=null,this._refCount=0,this._connection=null,ca(e)&&(this.lift=e.lift)}_subscribe(e){return this.getSubject().subscribe(e)}getSubject(){const e=this._subject;return(!e||e.isStopped)&&(this._subject=this.subjectFactory()),this._subject}_teardown(){this._refCount=0;const{_connection:e}=this;this._subject=this._connection=null,e?.unsubscribe()}connect(){let e=this._connection;if(!e){e=this._connection=new lt;const t=this.getSubject();e.add(this.source.subscribe(Pr(t,void 0,()=>{this._teardown(),t.complete()},i=>{this._teardown(),t.error(i)},()=>this._teardown()))),e.closed&&(this._connection=null,e=lt.EMPTY)}return e}refCount(){return hI()(this)}}function VC(n){return Dr((e,t)=>{let i=!1;e.subscribe(Pr(t,r=>{i=!0,t.next(r)},()=>{i||t.next(n),t.complete()}))})}function oB(n=BZ){return Dr((e,t)=>{let i=!1;e.subscribe(Pr(t,r=>{i=!0,t.next(r)},()=>i?t.complete():t.error(n())))})}function BZ(){return new zC}function sm(n,e){const t=arguments.length>=2;return i=>i.pipe(n?na((r,s)=>n(r,s,i)):Wo,xc(1),t?VC(e):oB(()=>new zC))}function zZ(n,e,t,i,r){return(s,c)=>{let d=t,m=e,y=0;s.subscribe(Pr(c,w=>{const S=y++;m=d?n(m,w,S):(d=!0,w),i&&c.next(m)},r&&(()=>{d&&c.next(m),c.complete()})))}}function aB(n,e){return Dr(zZ(n,e,arguments.length>=2,!0))}function pI(n){return n<=0?()=>Gt:Dr((e,t)=>{let i=[];e.subscribe(Pr(t,r=>{i.push(r),n<i.length&&i.shift()},()=>{for(const r of i)t.next(r);t.complete()},void 0,()=>{i=null}))})}function lB(n,e){const t=arguments.length>=2;return i=>i.pipe(n?na((r,s)=>n(r,s,i)):Wo,pI(1),t?VC(e):oB(()=>new zC))}const $i="primary",Wb=Symbol("RouteTitle");class UZ{constructor(e){this.params=e||{}}has(e){return Object.prototype.hasOwnProperty.call(this.params,e)}get(e){if(this.has(e)){const t=this.params[e];return Array.isArray(t)?t[0]:t}return null}getAll(e){if(this.has(e)){const t=this.params[e];return Array.isArray(t)?t:[t]}return[]}get keys(){return Object.keys(this.params)}}function Mv(n){return new UZ(n)}function HZ(n,e,t){const i=t.path.split("/");if(i.length>n.length||"full"===t.pathMatch&&(e.hasChildren()||i.length<n.length))return null;const r={};for(let s=0;s<i.length;s++){const c=i[s],d=n[s];if(c.startsWith(":"))r[c.substring(1)]=d;else if(c!==d.path)return null}return{consumed:n.slice(0,i.length),posParams:r}}function nh(n,e){const t=n?Object.keys(n):void 0,i=e?Object.keys(e):void 0;if(!t||!i||t.length!=i.length)return!1;let r;for(let s=0;s<t.length;s++)if(r=t[s],!cB(n[r],e[r]))return!1;return!0}function cB(n,e){if(Array.isArray(n)&&Array.isArray(e)){if(n.length!==e.length)return!1;const t=[...n].sort(),i=[...e].sort();return t.every((r,s)=>i[s]===r)}return n===e}function uB(n){return Array.prototype.concat.apply([],n)}function dB(n){return n.length>0?n[n.length-1]:null}function Ta(n,e){for(const t in n)n.hasOwnProperty(t)&&e(n[t],t)}function om(n){return QT(n)?n:cb(n)?fs(Promise.resolve(n)):jn(n)}const $Z={exact:function fB(n,e,t){if(!Vg(n.segments,e.segments)||!UC(n.segments,e.segments,t)||n.numberOfChildren!==e.numberOfChildren)return!1;for(const i in e.children)if(!n.children[i]||!fB(n.children[i],e.children[i],t))return!1;return!0},subset:mB},hB={exact:function WZ(n,e){return nh(n,e)},subset:function qZ(n,e){return Object.keys(e).length<=Object.keys(n).length&&Object.keys(e).every(t=>cB(n[t],e[t]))},ignored:()=>!0};function pB(n,e,t){return $Z[t.paths](n.root,e.root,t.matrixParams)&&hB[t.queryParams](n.queryParams,e.queryParams)&&!("exact"===t.fragment&&n.fragment!==e.fragment)}function mB(n,e,t){return gB(n,e,e.segments,t)}function gB(n,e,t,i){if(n.segments.length>t.length){const r=n.segments.slice(0,t.length);return!(!Vg(r,t)||e.hasChildren()||!UC(r,t,i))}if(n.segments.length===t.length){if(!Vg(n.segments,t)||!UC(n.segments,t,i))return!1;for(const r in e.children)if(!n.children[r]||!mB(n.children[r],e.children[r],i))return!1;return!0}{const r=t.slice(0,n.segments.length),s=t.slice(n.segments.length);return!!(Vg(n.segments,r)&&UC(n.segments,r,i)&&n.children[$i])&&gB(n.children[$i],e,s,i)}}function UC(n,e,t){return e.every((i,r)=>hB[t](n[r].parameters,i.parameters))}class zg{constructor(e,t,i){this.root=e,this.queryParams=t,this.fragment=i}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=Mv(this.queryParams)),this._queryParamMap}toString(){return YZ.serialize(this)}}class Qi{constructor(e,t){this.segments=e,this.children=t,this.parent=null,Ta(t,(i,r)=>i.parent=this)}hasChildren(){return this.numberOfChildren>0}get numberOfChildren(){return Object.keys(this.children).length}toString(){return HC(this)}}class qb{constructor(e,t){this.path=e,this.parameters=t}get parameterMap(){return this._parameterMap||(this._parameterMap=Mv(this.parameters)),this._parameterMap}toString(){return xB(this)}}function Vg(n,e){return n.length===e.length&&n.every((t,i)=>t.path===e[i].path)}let _B=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=Yt({token:n,factory:function(){return new mI},providedIn:"root"}),n})();class mI{parse(e){const t=new sX(e);return new zg(t.parseRootSegment(),t.parseQueryParams(),t.parseFragment())}serialize(e){const t=`/${Zb(e.root,!0)}`,i=function JZ(n){const e=Object.keys(n).map(t=>{const i=n[t];return Array.isArray(i)?i.map(r=>`${GC(t)}=${GC(r)}`).join("&"):`${GC(t)}=${GC(i)}`}).filter(t=>!!t);return e.length?`?${e.join("&")}`:""}(e.queryParams);return`${t}${i}${"string"==typeof e.fragment?`#${function KZ(n){return encodeURI(n)}(e.fragment)}`:""}`}}const YZ=new mI;function HC(n){return n.segments.map(e=>xB(e)).join("/")}function Zb(n,e){if(!n.hasChildren())return HC(n);if(e){const t=n.children[$i]?Zb(n.children[$i],!1):"",i=[];return Ta(n.children,(r,s)=>{s!==$i&&i.push(`${s}:${Zb(r,!1)}`)}),i.length>0?`${t}(${i.join("//")})`:t}{const t=function XZ(n,e){let t=[];return Ta(n.children,(i,r)=>{r===$i&&(t=t.concat(e(i,r)))}),Ta(n.children,(i,r)=>{r!==$i&&(t=t.concat(e(i,r)))}),t}(n,(i,r)=>r===$i?[Zb(n.children[$i],!1)]:[`${r}:${Zb(i,!1)}`]);return 1===Object.keys(n.children).length&&null!=n.children[$i]?`${HC(n)}/${t[0]}`:`${HC(n)}/(${t.join("//")})`}}function yB(n){return encodeURIComponent(n).replace(/%40/g,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",")}function GC(n){return yB(n).replace(/%3B/gi,";")}function gI(n){return yB(n).replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/%26/gi,"&")}function jC(n){return decodeURIComponent(n)}function vB(n){return jC(n.replace(/\+/g,"%20"))}function xB(n){return`${gI(n.path)}${function QZ(n){return Object.keys(n).map(e=>`;${gI(e)}=${gI(n[e])}`).join("")}(n.parameters)}`}const eX=/^[^\/()?;=#]+/;function $C(n){const e=n.match(eX);return e?e[0]:""}const tX=/^[^=?&#]+/,iX=/^[^&#]+/;class sX{constructor(e){this.url=e,this.remaining=e}parseRootSegment(){return this.consumeOptional("/"),""===this.remaining||this.peekStartsWith("?")||this.peekStartsWith("#")?new Qi([],{}):new Qi([],this.parseChildren())}parseQueryParams(){const e={};if(this.consumeOptional("?"))do{this.parseQueryParam(e)}while(this.consumeOptional("&"));return e}parseFragment(){return this.consumeOptional("#")?decodeURIComponent(this.remaining):null}parseChildren(){if(""===this.remaining)return{};this.consumeOptional("/");const e=[];for(this.peekStartsWith("(")||e.push(this.parseSegment());this.peekStartsWith("/")&&!this.peekStartsWith("//")&&!this.peekStartsWith("/(");)this.capture("/"),e.push(this.parseSegment());let t={};this.peekStartsWith("/(")&&(this.capture("/"),t=this.parseParens(!0));let i={};return this.peekStartsWith("(")&&(i=this.parseParens(!1)),(e.length>0||Object.keys(t).length>0)&&(i[$i]=new Qi(e,t)),i}parseSegment(){const e=$C(this.remaining);if(""===e&&this.peekStartsWith(";"))throw new bt(4009,!1);return this.capture(e),new qb(jC(e),this.parseMatrixParams())}parseMatrixParams(){const e={};for(;this.consumeOptional(";");)this.parseParam(e);return e}parseParam(e){const t=$C(this.remaining);if(!t)return;this.capture(t);let i="";if(this.consumeOptional("=")){const r=$C(this.remaining);r&&(i=r,this.capture(i))}e[jC(t)]=jC(i)}parseQueryParam(e){const t=function nX(n){const e=n.match(tX);return e?e[0]:""}(this.remaining);if(!t)return;this.capture(t);let i="";if(this.consumeOptional("=")){const c=function rX(n){const e=n.match(iX);return e?e[0]:""}(this.remaining);c&&(i=c,this.capture(i))}const r=vB(t),s=vB(i);if(e.hasOwnProperty(r)){let c=e[r];Array.isArray(c)||(c=[c],e[r]=c),c.push(s)}else e[r]=s}parseParens(e){const t={};for(this.capture("(");!this.consumeOptional(")")&&this.remaining.length>0;){const i=$C(this.remaining),r=this.remaining[i.length];if("/"!==r&&")"!==r&&";"!==r)throw new bt(4010,!1);let s;i.indexOf(":")>-1?(s=i.slice(0,i.indexOf(":")),this.capture(s),this.capture(":")):e&&(s=$i);const c=this.parseChildren();t[s]=1===Object.keys(c).length?c[$i]:new Qi([],c),this.consumeOptional("//")}return t}peekStartsWith(e){return this.remaining.startsWith(e)}consumeOptional(e){return!!this.peekStartsWith(e)&&(this.remaining=this.remaining.substring(e.length),!0)}capture(e){if(!this.consumeOptional(e))throw new bt(4011,!1)}}function _I(n){return n.segments.length>0?new Qi([],{[$i]:n}):n}function WC(n){const e={};for(const i of Object.keys(n.children)){const s=WC(n.children[i]);(s.segments.length>0||s.hasChildren())&&(e[i]=s)}return function oX(n){if(1===n.numberOfChildren&&n.children[$i]){const e=n.children[$i];return new Qi(n.segments.concat(e.segments),e.children)}return n}(new Qi(n.segments,e))}function Ug(n){return n instanceof zg}function cX(n,e,t,i,r){if(0===t.length)return Cv(e.root,e.root,e.root,i,r);const s=function MB(n){if("string"==typeof n[0]&&1===n.length&&"/"===n[0])return new wB(!0,0,n);let e=0,t=!1;const i=n.reduce((r,s,c)=>{if("object"==typeof s&&null!=s){if(s.outlets){const d={};return Ta(s.outlets,(m,y)=>{d[y]="string"==typeof m?m.split("/"):m}),[...r,{outlets:d}]}if(s.segmentPath)return[...r,s.segmentPath]}return"string"!=typeof s?[...r,s]:0===c?(s.split("/").forEach((d,m)=>{0==m&&"."===d||(0==m&&""===d?t=!0:".."===d?e++:""!=d&&r.push(d))}),r):[...r,s]},[]);return new wB(t,e,i)}(t);return s.toRoot()?Cv(e.root,e.root,new Qi([],{}),i,r):function c(m){const y=function dX(n,e,t,i){if(n.isAbsolute)return new Sv(e.root,!0,0);if(-1===i)return new Sv(t,t===e.root,0);return function CB(n,e,t){let i=n,r=e,s=t;for(;s>r;){if(s-=r,i=i.parent,!i)throw new bt(4005,!1);r=i.segments.length}return new Sv(i,!1,r-s)}(t,i+(Xb(n.commands[0])?0:1),n.numberOfDoubleDots)}(s,e,n.snapshot?._urlSegment,m),w=y.processChildren?Kb(y.segmentGroup,y.index,s.commands):vI(y.segmentGroup,y.index,s.commands);return Cv(e.root,y.segmentGroup,w,i,r)}(n.snapshot?._lastPathIndex)}function Xb(n){return"object"==typeof n&&null!=n&&!n.outlets&&!n.segmentPath}function Yb(n){return"object"==typeof n&&null!=n&&n.outlets}function Cv(n,e,t,i,r){let c,s={};i&&Ta(i,(m,y)=>{s[y]=Array.isArray(m)?m.map(w=>`${w}`):`${m}`}),c=n===e?t:bB(n,e,t);const d=_I(WC(c));return new zg(d,s,r)}function bB(n,e,t){const i={};return Ta(n.children,(r,s)=>{i[s]=r===e?t:bB(r,e,t)}),new Qi(n.segments,i)}class wB{constructor(e,t,i){if(this.isAbsolute=e,this.numberOfDoubleDots=t,this.commands=i,e&&i.length>0&&Xb(i[0]))throw new bt(4003,!1);const r=i.find(Yb);if(r&&r!==dB(i))throw new bt(4004,!1)}toRoot(){return this.isAbsolute&&1===this.commands.length&&"/"==this.commands[0]}}class Sv{constructor(e,t,i){this.segmentGroup=e,this.processChildren=t,this.index=i}}function vI(n,e,t){if(n||(n=new Qi([],{})),0===n.segments.length&&n.hasChildren())return Kb(n,e,t);const i=function pX(n,e,t){let i=0,r=e;const s={match:!1,pathIndex:0,commandIndex:0};for(;r<n.segments.length;){if(i>=t.length)return s;const c=n.segments[r],d=t[i];if(Yb(d))break;const m=`${d}`,y=i<t.length-1?t[i+1]:null;if(r>0&&void 0===m)break;if(m&&y&&"object"==typeof y&&void 0===y.outlets){if(!EB(m,y,c))return s;i+=2}else{if(!EB(m,{},c))return s;i++}r++}return{match:!0,pathIndex:r,commandIndex:i}}(n,e,t),r=t.slice(i.commandIndex);if(i.match&&i.pathIndex<n.segments.length){const s=new Qi(n.segments.slice(0,i.pathIndex),{});return s.children[$i]=new Qi(n.segments.slice(i.pathIndex),n.children),Kb(s,0,r)}return i.match&&0===r.length?new Qi(n.segments,{}):i.match&&!n.hasChildren()?xI(n,e,t):i.match?Kb(n,0,r):xI(n,e,t)}function Kb(n,e,t){if(0===t.length)return new Qi(n.segments,{});{const i=function hX(n){return Yb(n[0])?n[0].outlets:{[$i]:n}}(t),r={};return Ta(i,(s,c)=>{"string"==typeof s&&(s=[s]),null!==s&&(r[c]=vI(n.children[c],e,s))}),Ta(n.children,(s,c)=>{void 0===i[c]&&(r[c]=s)}),new Qi(n.segments,r)}}function xI(n,e,t){const i=n.segments.slice(0,e);let r=0;for(;r<t.length;){const s=t[r];if(Yb(s)){const m=fX(s.outlets);return new Qi(i,m)}if(0===r&&Xb(t[0])){i.push(new qb(n.segments[e].path,SB(t[0]))),r++;continue}const c=Yb(s)?s.outlets[$i]:`${s}`,d=r<t.length-1?t[r+1]:null;c&&d&&Xb(d)?(i.push(new qb(c,SB(d))),r+=2):(i.push(new qb(c,{})),r++)}return new Qi(i,{})}function fX(n){const e={};return Ta(n,(t,i)=>{"string"==typeof t&&(t=[t]),null!==t&&(e[i]=xI(new Qi([],{}),0,t))}),e}function SB(n){const e={};return Ta(n,(t,i)=>e[i]=`${t}`),e}function EB(n,e,t){return n==t.path&&nh(e,t.parameters)}class vp{constructor(e,t){this.id=e,this.url=t}}class bI extends vp{constructor(e,t,i="imperative",r=null){super(e,t),this.type=0,this.navigationTrigger=i,this.restoredState=r}toString(){return`NavigationStart(id: ${this.id}, url: '${this.url}')`}}class Hg extends vp{constructor(e,t,i){super(e,t),this.urlAfterRedirects=i,this.type=1}toString(){return`NavigationEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}')`}}class qC extends vp{constructor(e,t,i,r){super(e,t),this.reason=i,this.code=r,this.type=2}toString(){return`NavigationCancel(id: ${this.id}, url: '${this.url}')`}}class TB extends vp{constructor(e,t,i,r){super(e,t),this.error=i,this.target=r,this.type=3}toString(){return`NavigationError(id: ${this.id}, url: '${this.url}', error: ${this.error})`}}class mX extends vp{constructor(e,t,i,r){super(e,t),this.urlAfterRedirects=i,this.state=r,this.type=4}toString(){return`RoutesRecognized(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class gX extends vp{constructor(e,t,i,r){super(e,t),this.urlAfterRedirects=i,this.state=r,this.type=7}toString(){return`GuardsCheckStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class _X extends vp{constructor(e,t,i,r,s){super(e,t),this.urlAfterRedirects=i,this.state=r,this.shouldActivate=s,this.type=8}toString(){return`GuardsCheckEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state}, shouldActivate: ${this.shouldActivate})`}}class yX extends vp{constructor(e,t,i,r){super(e,t),this.urlAfterRedirects=i,this.state=r,this.type=5}toString(){return`ResolveStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class vX extends vp{constructor(e,t,i,r){super(e,t),this.urlAfterRedirects=i,this.state=r,this.type=6}toString(){return`ResolveEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class xX{constructor(e){this.route=e,this.type=9}toString(){return`RouteConfigLoadStart(path: ${this.route.path})`}}class bX{constructor(e){this.route=e,this.type=10}toString(){return`RouteConfigLoadEnd(path: ${this.route.path})`}}class wX{constructor(e){this.snapshot=e,this.type=11}toString(){return`ChildActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class MX{constructor(e){this.snapshot=e,this.type=12}toString(){return`ChildActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class CX{constructor(e){this.snapshot=e,this.type=13}toString(){return`ActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class SX{constructor(e){this.snapshot=e,this.type=14}toString(){return`ActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class DB{constructor(e,t,i){this.routerEvent=e,this.position=t,this.anchor=i,this.type=15}toString(){return`Scroll(anchor: '${this.anchor}', position: '${this.position?`${this.position[0]}, ${this.position[1]}`:null}')`}}class AB{constructor(e){this._root=e}get root(){return this._root.value}parent(e){const t=this.pathFromRoot(e);return t.length>1?t[t.length-2]:null}children(e){const t=wI(e,this._root);return t?t.children.map(i=>i.value):[]}firstChild(e){const t=wI(e,this._root);return t&&t.children.length>0?t.children[0].value:null}siblings(e){const t=MI(e,this._root);return t.length<2?[]:t[t.length-2].children.map(r=>r.value).filter(r=>r!==e)}pathFromRoot(e){return MI(e,this._root).map(t=>t.value)}}function wI(n,e){if(n===e.value)return e;for(const t of e.children){const i=wI(n,t);if(i)return i}return null}function MI(n,e){if(n===e.value)return[e];for(const t of e.children){const i=MI(n,t);if(i.length)return i.unshift(e),i}return[]}class xp{constructor(e,t){this.value=e,this.children=t}toString(){return`TreeNode(${this.value})`}}function Ev(n){const e={};return n&&n.children.forEach(t=>e[t.value.outlet]=t),e}class IB extends AB{constructor(e,t){super(e),this.snapshot=t,CI(this,e)}toString(){return this.snapshot.toString()}}function PB(n,e){const t=function TX(n,e){const c=new ZC([],{},{},"",{},$i,e,null,n.root,-1,{});return new kB("",new xp(c,[]))}(n,e),i=new cu([new qb("",{})]),r=new cu({}),s=new cu({}),c=new cu({}),d=new cu(""),m=new md(i,r,c,d,s,$i,e,t.root);return m.snapshot=t.root,new IB(new xp(m,[]),t)}class md{constructor(e,t,i,r,s,c,d,m){this.url=e,this.params=t,this.queryParams=i,this.fragment=r,this.data=s,this.outlet=c,this.component=d,this.title=this.data?.pipe(ei(y=>y[Wb]))??jn(void 0),this._futureSnapshot=m}get routeConfig(){return this._futureSnapshot.routeConfig}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=this.params.pipe(ei(e=>Mv(e)))),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=this.queryParams.pipe(ei(e=>Mv(e)))),this._queryParamMap}toString(){return this.snapshot?this.snapshot.toString():`Future(${this._futureSnapshot})`}}function RB(n,e="emptyOnly"){const t=n.pathFromRoot;let i=0;if("always"!==e)for(i=t.length-1;i>=1;){const r=t[i],s=t[i-1];if(r.routeConfig&&""===r.routeConfig.path)i--;else{if(s.component)break;i--}}return function DX(n){return n.reduce((e,t)=>({params:{...e.params,...t.params},data:{...e.data,...t.data},resolve:{...t.data,...e.resolve,...t.routeConfig?.data,...t._resolvedData}}),{params:{},data:{},resolve:{}})}(t.slice(i))}class ZC{constructor(e,t,i,r,s,c,d,m,y,w,S,T){this.url=e,this.params=t,this.queryParams=i,this.fragment=r,this.data=s,this.outlet=c,this.component=d,this.title=this.data?.[Wb],this.routeConfig=m,this._urlSegment=y,this._lastPathIndex=w,this._correctedLastPathIndex=T??w,this._resolve=S}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=Mv(this.params)),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=Mv(this.queryParams)),this._queryParamMap}toString(){return`Route(url:'${this.url.map(i=>i.toString()).join("/")}', path:'${this.routeConfig?this.routeConfig.path:""}')`}}class kB extends AB{constructor(e,t){super(t),this.url=e,CI(this,t)}toString(){return LB(this._root)}}function CI(n,e){e.value._routerState=n,e.children.forEach(t=>CI(n,t))}function LB(n){const e=n.children.length>0?` { ${n.children.map(LB).join(", ")} } `:"";return`${n.value}${e}`}function SI(n){if(n.snapshot){const e=n.snapshot,t=n._futureSnapshot;n.snapshot=t,nh(e.queryParams,t.queryParams)||n.queryParams.next(t.queryParams),e.fragment!==t.fragment&&n.fragment.next(t.fragment),nh(e.params,t.params)||n.params.next(t.params),function GZ(n,e){if(n.length!==e.length)return!1;for(let t=0;t<n.length;++t)if(!nh(n[t],e[t]))return!1;return!0}(e.url,t.url)||n.url.next(t.url),nh(e.data,t.data)||n.data.next(t.data)}else n.snapshot=n._futureSnapshot,n.data.next(n._futureSnapshot.data)}function EI(n,e){const t=nh(n.params,e.params)&&function ZZ(n,e){return Vg(n,e)&&n.every((t,i)=>nh(t.parameters,e[i].parameters))}(n.url,e.url);return t&&!(!n.parent!=!e.parent)&&(!n.parent||EI(n.parent,e.parent))}function Qb(n,e,t){if(t&&n.shouldReuseRoute(e.value,t.value.snapshot)){const i=t.value;i._futureSnapshot=e.value;const r=function IX(n,e,t){return e.children.map(i=>{for(const r of t.children)if(n.shouldReuseRoute(i.value,r.value.snapshot))return Qb(n,i,r);return Qb(n,i)})}(n,e,t);return new xp(i,r)}{if(n.shouldAttach(e.value)){const s=n.retrieve(e.value);if(null!==s){const c=s.route;return c.value._futureSnapshot=e.value,c.children=e.children.map(d=>Qb(n,d)),c}}const i=function PX(n){return new md(new cu(n.url),new cu(n.params),new cu(n.queryParams),new cu(n.fragment),new cu(n.data),n.outlet,n.component,n)}(e.value),r=e.children.map(s=>Qb(n,s));return new xp(i,r)}}const TI="ngNavigationCancelingError";function OB(n,e){const{redirectTo:t,navigationBehaviorOptions:i}=Ug(e)?{redirectTo:e,navigationBehaviorOptions:void 0}:e,r=FB(!1,0,e);return r.url=t,r.navigationBehaviorOptions=i,r}function FB(n,e,t){const i=new Error("NavigationCancelingError: "+(n||""));return i[TI]=!0,i.cancellationCode=e,t&&(i.url=t),i}function NB(n){return BB(n)&&Ug(n.url)}function BB(n){return n&&n[TI]}class RX{constructor(){this.outlet=null,this.route=null,this.resolver=null,this.injector=null,this.children=new Jb,this.attachRef=null}}let Jb=(()=>{class n{constructor(){this.contexts=new Map}onChildOutletCreated(t,i){const r=this.getOrCreateContext(t);r.outlet=i,this.contexts.set(t,r)}onChildOutletDestroyed(t){const i=this.getContext(t);i&&(i.outlet=null,i.attachRef=null)}onOutletDeactivated(){const t=this.contexts;return this.contexts=new Map,t}onOutletReAttached(t){this.contexts=t}getOrCreateContext(t){let i=this.getContext(t);return i||(i=new RX,this.contexts.set(t,i)),i}getContext(t){return this.contexts.get(t)||null}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=Yt({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();const XC=!1;let DI=(()=>{class n{constructor(t,i,r,s,c){this.parentContexts=t,this.location=i,this.changeDetector=s,this.environmentInjector=c,this.activated=null,this._activatedRoute=null,this.activateEvents=new Dn,this.deactivateEvents=new Dn,this.attachEvents=new Dn,this.detachEvents=new Dn,this.name=r||$i,t.onChildOutletCreated(this.name,this)}ngOnDestroy(){this.parentContexts.getContext(this.name)?.outlet===this&&this.parentContexts.onChildOutletDestroyed(this.name)}ngOnInit(){if(!this.activated){const t=this.parentContexts.getContext(this.name);t&&t.route&&(t.attachRef?this.attach(t.attachRef,t.route):this.activateWith(t.route,t.injector))}}get isActivated(){return!!this.activated}get component(){if(!this.activated)throw new bt(4012,XC);return this.activated.instance}get activatedRoute(){if(!this.activated)throw new bt(4012,XC);return this._activatedRoute}get activatedRouteData(){return this._activatedRoute?this._activatedRoute.snapshot.data:{}}detach(){if(!this.activated)throw new bt(4012,XC);this.location.detach();const t=this.activated;return this.activated=null,this._activatedRoute=null,this.detachEvents.emit(t.instance),t}attach(t,i){this.activated=t,this._activatedRoute=i,this.location.insert(t.hostView),this.attachEvents.emit(t.instance)}deactivate(){if(this.activated){const t=this.component;this.activated.destroy(),this.activated=null,this._activatedRoute=null,this.deactivateEvents.emit(t)}}activateWith(t,i){if(this.isActivated)throw new bt(4013,XC);this._activatedRoute=t;const r=this.location,c=t._futureSnapshot.component,d=this.parentContexts.getOrCreateContext(this.name).children,m=new kX(t,d,r.injector);if(i&&function LX(n){return!!n.resolveComponentFactory}(i)){const y=i.resolveComponentFactory(c);this.activated=r.createComponent(y,r.length,m)}else this.activated=r.createComponent(c,{index:r.length,injector:m,environmentInjector:i??this.environmentInjector});this.changeDetector.markForCheck(),this.activateEvents.emit(this.activated.instance)}}return n.\u0275fac=function(t){return new(t||n)(Ie(Jb),Ie(ql),ns("name"),Ie(Ho),Ie(fc))},n.\u0275dir=an({type:n,selectors:[["router-outlet"]],outputs:{activateEvents:"activate",deactivateEvents:"deactivate",attachEvents:"attach",detachEvents:"detach"},exportAs:["outlet"],standalone:!0}),n})();class kX{constructor(e,t,i){this.route=e,this.childContexts=t,this.parent=i}get(e,t){return e===md?this.route:e===Jb?this.childContexts:this.parent.get(e,t)}}let AI=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275cmp=Qn({type:n,selectors:[["ng-component"]],standalone:!0,features:[Kk],decls:1,vars:0,template:function(t,i){1&t&&jt(0,"router-outlet")},dependencies:[DI],encapsulation:2}),n})();function zB(n,e){return n.providers&&!n._injector&&(n._injector=DM(n.providers,e,`Route: ${n.path}`)),n._injector??e}function PI(n){const e=n.children&&n.children.map(PI),t=e?{...n,children:e}:{...n};return!t.component&&!t.loadComponent&&(e||t.loadChildren)&&t.outlet&&t.outlet!==$i&&(t.component=AI),t}function du(n){return n.outlet||$i}function VB(n,e){const t=n.filter(i=>du(i)===e);return t.push(...n.filter(i=>du(i)!==e)),t}function ew(n){if(!n)return null;if(n.routeConfig?._injector)return n.routeConfig._injector;for(let e=n.parent;e;e=e.parent){const t=e.routeConfig;if(t?._loadedInjector)return t._loadedInjector;if(t?._injector)return t._injector}return null}class zX{constructor(e,t,i,r){this.routeReuseStrategy=e,this.futureState=t,this.currState=i,this.forwardEvent=r}activate(e){const t=this.futureState._root,i=this.currState?this.currState._root:null;this.deactivateChildRoutes(t,i,e),SI(this.futureState.root),this.activateChildRoutes(t,i,e)}deactivateChildRoutes(e,t,i){const r=Ev(t);e.children.forEach(s=>{const c=s.value.outlet;this.deactivateRoutes(s,r[c],i),delete r[c]}),Ta(r,(s,c)=>{this.deactivateRouteAndItsChildren(s,i)})}deactivateRoutes(e,t,i){const r=e.value,s=t?t.value:null;if(r===s)if(r.component){const c=i.getContext(r.outlet);c&&this.deactivateChildRoutes(e,t,c.children)}else this.deactivateChildRoutes(e,t,i);else s&&this.deactivateRouteAndItsChildren(t,i)}deactivateRouteAndItsChildren(e,t){e.value.component&&this.routeReuseStrategy.shouldDetach(e.value.snapshot)?this.detachAndStoreRouteSubtree(e,t):this.deactivateRouteAndOutlet(e,t)}detachAndStoreRouteSubtree(e,t){const i=t.getContext(e.value.outlet),r=i&&e.value.component?i.children:t,s=Ev(e);for(const c of Object.keys(s))this.deactivateRouteAndItsChildren(s[c],r);if(i&&i.outlet){const c=i.outlet.detach(),d=i.children.onOutletDeactivated();this.routeReuseStrategy.store(e.value.snapshot,{componentRef:c,route:e,contexts:d})}}deactivateRouteAndOutlet(e,t){const i=t.getContext(e.value.outlet),r=i&&e.value.component?i.children:t,s=Ev(e);for(const c of Object.keys(s))this.deactivateRouteAndItsChildren(s[c],r);i&&i.outlet&&(i.outlet.deactivate(),i.children.onOutletDeactivated(),i.attachRef=null,i.resolver=null,i.route=null)}activateChildRoutes(e,t,i){const r=Ev(t);e.children.forEach(s=>{this.activateRoutes(s,r[s.value.outlet],i),this.forwardEvent(new SX(s.value.snapshot))}),e.children.length&&this.forwardEvent(new MX(e.value.snapshot))}activateRoutes(e,t,i){const r=e.value,s=t?t.value:null;if(SI(r),r===s)if(r.component){const c=i.getOrCreateContext(r.outlet);this.activateChildRoutes(e,t,c.children)}else this.activateChildRoutes(e,t,i);else if(r.component){const c=i.getOrCreateContext(r.outlet);if(this.routeReuseStrategy.shouldAttach(r.snapshot)){const d=this.routeReuseStrategy.retrieve(r.snapshot);this.routeReuseStrategy.store(r.snapshot,null),c.children.onOutletReAttached(d.contexts),c.attachRef=d.componentRef,c.route=d.route.value,c.outlet&&c.outlet.attach(d.componentRef,d.route.value),SI(d.route.value),this.activateChildRoutes(e,null,c.children)}else{const d=ew(r.snapshot),m=d?.get(Kc)??null;c.attachRef=null,c.route=r,c.resolver=m,c.injector=d,c.outlet&&c.outlet.activateWith(r,c.injector),this.activateChildRoutes(e,null,c.children)}}else this.activateChildRoutes(e,null,i)}}class UB{constructor(e){this.path=e,this.route=this.path[this.path.length-1]}}class YC{constructor(e,t){this.component=e,this.route=t}}function VX(n,e,t){const i=n._root;return tw(i,e?e._root:null,t,[i.value])}function Tv(n,e){const t=Symbol(),i=e.get(n,t);return i===t?"function"!=typeof n||function Gp(n){return null!==nl(n)}(n)?e.get(n):n:i}function tw(n,e,t,i,r={canDeactivateChecks:[],canActivateChecks:[]}){const s=Ev(e);return n.children.forEach(c=>{(function HX(n,e,t,i,r={canDeactivateChecks:[],canActivateChecks:[]}){const s=n.value,c=e?e.value:null,d=t?t.getContext(n.value.outlet):null;if(c&&s.routeConfig===c.routeConfig){const m=function GX(n,e,t){if("function"==typeof t)return t(n,e);switch(t){case"pathParamsChange":return!Vg(n.url,e.url);case"pathParamsOrQueryParamsChange":return!Vg(n.url,e.url)||!nh(n.queryParams,e.queryParams);case"always":return!0;case"paramsOrQueryParamsChange":return!EI(n,e)||!nh(n.queryParams,e.queryParams);default:return!EI(n,e)}}(c,s,s.routeConfig.runGuardsAndResolvers);m?r.canActivateChecks.push(new UB(i)):(s.data=c.data,s._resolvedData=c._resolvedData),tw(n,e,s.component?d?d.children:null:t,i,r),m&&d&&d.outlet&&d.outlet.isActivated&&r.canDeactivateChecks.push(new YC(d.outlet.component,c))}else c&&nw(e,d,r),r.canActivateChecks.push(new UB(i)),tw(n,null,s.component?d?d.children:null:t,i,r)})(c,s[c.value.outlet],t,i.concat([c.value]),r),delete s[c.value.outlet]}),Ta(s,(c,d)=>nw(c,t.getContext(d),r)),r}function nw(n,e,t){const i=Ev(n),r=n.value;Ta(i,(s,c)=>{nw(s,r.component?e?e.children.getContext(c):null:e,t)}),t.canDeactivateChecks.push(new YC(r.component&&e&&e.outlet&&e.outlet.isActivated?e.outlet.component:null,r))}function iw(n){return"function"==typeof n}function RI(n){return n instanceof zC||"EmptyError"===n?.name}const KC=Symbol("INITIAL_VALUE");function Dv(){return uu(n=>vA(n.map(e=>e.pipe(xc(1),Xl(KC)))).pipe(ei(e=>{for(const t of e)if(!0!==t){if(t===KC)return KC;if(!1===t||t instanceof zg)return t}return!0}),na(e=>e!==KC),xc(1)))}function HB(n){return function Rc(...n){return kc(n)}(bo(e=>{if(Ug(e))throw OB(0,e)}),ei(e=>!0===e))}const kI={matched:!1,consumedSegments:[],remainingSegments:[],parameters:{},positionalParamSegments:{}};function GB(n,e,t,i,r){const s=LI(n,e,t);return s.matched?function oY(n,e,t,i){const r=e.canMatch;return r&&0!==r.length?jn(r.map(c=>{const d=Tv(c,n);return om(function XX(n){return n&&iw(n.canMatch)}(d)?d.canMatch(e,t):n.runInContext(()=>d(e,t)))})).pipe(Dv(),HB()):jn(!0)}(i=zB(e,i),e,t).pipe(ei(c=>!0===c?s:{...kI})):jn(s)}function LI(n,e,t){if(""===e.path)return"full"===e.pathMatch&&(n.hasChildren()||t.length>0)?{...kI}:{matched:!0,consumedSegments:[],remainingSegments:t,parameters:{},positionalParamSegments:{}};const r=(e.matcher||HZ)(t,n,e);if(!r)return{...kI};const s={};Ta(r.posParams,(d,m)=>{s[m]=d.path});const c=r.consumed.length>0?{...s,...r.consumed[r.consumed.length-1].parameters}:s;return{matched:!0,consumedSegments:r.consumed,remainingSegments:t.slice(r.consumed.length),parameters:c,positionalParamSegments:r.posParams??{}}}function QC(n,e,t,i,r="corrected"){if(t.length>0&&function cY(n,e,t){return t.some(i=>JC(n,e,i)&&du(i)!==$i)}(n,t,i)){const c=new Qi(e,function lY(n,e,t,i){const r={};r[$i]=i,i._sourceSegment=n,i._segmentIndexShift=e.length;for(const s of t)if(""===s.path&&du(s)!==$i){const c=new Qi([],{});c._sourceSegment=n,c._segmentIndexShift=e.length,r[du(s)]=c}return r}(n,e,i,new Qi(t,n.children)));return c._sourceSegment=n,c._segmentIndexShift=e.length,{segmentGroup:c,slicedSegments:[]}}if(0===t.length&&function uY(n,e,t){return t.some(i=>JC(n,e,i))}(n,t,i)){const c=new Qi(n.segments,function aY(n,e,t,i,r,s){const c={};for(const d of i)if(JC(n,t,d)&&!r[du(d)]){const m=new Qi([],{});m._sourceSegment=n,m._segmentIndexShift="legacy"===s?n.segments.length:e.length,c[du(d)]=m}return{...r,...c}}(n,e,t,i,n.children,r));return c._sourceSegment=n,c._segmentIndexShift=e.length,{segmentGroup:c,slicedSegments:t}}const s=new Qi(n.segments,n.children);return s._sourceSegment=n,s._segmentIndexShift=e.length,{segmentGroup:s,slicedSegments:t}}function JC(n,e,t){return(!(n.hasChildren()||e.length>0)||"full"!==t.pathMatch)&&""===t.path}function jB(n,e,t,i){return!!(du(n)===i||i!==$i&&JC(e,t,n))&&("**"===n.path||LI(e,n,t).matched)}function $B(n,e,t){return 0===e.length&&!n.children[t]}const eS=!1;class tS{constructor(e){this.segmentGroup=e||null}}class WB{constructor(e){this.urlTree=e}}function rw(n){return gv(new tS(n))}function qB(n){return gv(new WB(n))}class fY{constructor(e,t,i,r,s){this.injector=e,this.configLoader=t,this.urlSerializer=i,this.urlTree=r,this.config=s,this.allowRedirects=!0}apply(){const e=QC(this.urlTree.root,[],[],this.config).segmentGroup,t=new Qi(e.segments,e.children);return this.expandSegmentGroup(this.injector,this.config,t,$i).pipe(ei(s=>this.createUrlTree(WC(s),this.urlTree.queryParams,this.urlTree.fragment))).pipe(mp(s=>{if(s instanceof WB)return this.allowRedirects=!1,this.match(s.urlTree);throw s instanceof tS?this.noMatchError(s):s}))}match(e){return this.expandSegmentGroup(this.injector,this.config,e.root,$i).pipe(ei(r=>this.createUrlTree(WC(r),e.queryParams,e.fragment))).pipe(mp(r=>{throw r instanceof tS?this.noMatchError(r):r}))}noMatchError(e){return new bt(4002,eS)}createUrlTree(e,t,i){const r=_I(e);return new zg(r,t,i)}expandSegmentGroup(e,t,i,r){return 0===i.segments.length&&i.hasChildren()?this.expandChildren(e,t,i).pipe(ei(s=>new Qi([],s))):this.expandSegment(e,i,t,i.segments,r,!0)}expandChildren(e,t,i){const r=[];for(const s of Object.keys(i.children))"primary"===s?r.unshift(s):r.push(s);return fs(r).pipe(tm(s=>{const c=i.children[s],d=VB(t,s);return this.expandSegmentGroup(e,d,c,s).pipe(ei(m=>({segment:m,outlet:s})))}),aB((s,c)=>(s[c.outlet]=c.segment,s),{}),lB())}expandSegment(e,t,i,r,s,c){return fs(i).pipe(tm(d=>this.expandSegmentAgainstRoute(e,t,i,d,r,s,c).pipe(mp(y=>{if(y instanceof tS)return jn(null);throw y}))),sm(d=>!!d),mp((d,m)=>{if(RI(d))return $B(t,r,s)?jn(new Qi([],{})):rw(t);throw d}))}expandSegmentAgainstRoute(e,t,i,r,s,c,d){return jB(r,t,s,c)?void 0===r.redirectTo?this.matchSegmentAgainstRoute(e,t,r,s,c):d&&this.allowRedirects?this.expandSegmentAgainstRouteUsingRedirect(e,t,i,r,s,c):rw(t):rw(t)}expandSegmentAgainstRouteUsingRedirect(e,t,i,r,s,c){return"**"===r.path?this.expandWildCardWithParamsAgainstRouteUsingRedirect(e,i,r,c):this.expandRegularSegmentAgainstRouteUsingRedirect(e,t,i,r,s,c)}expandWildCardWithParamsAgainstRouteUsingRedirect(e,t,i,r){const s=this.applyRedirectCommands([],i.redirectTo,{});return i.redirectTo.startsWith("/")?qB(s):this.lineralizeSegments(i,s).pipe(ze(c=>{const d=new Qi(c,{});return this.expandSegment(e,d,t,c,r,!1)}))}expandRegularSegmentAgainstRouteUsingRedirect(e,t,i,r,s,c){const{matched:d,consumedSegments:m,remainingSegments:y,positionalParamSegments:w}=LI(t,r,s);if(!d)return rw(t);const S=this.applyRedirectCommands(m,r.redirectTo,w);return r.redirectTo.startsWith("/")?qB(S):this.lineralizeSegments(r,S).pipe(ze(T=>this.expandSegment(e,t,i,T.concat(y),c,!1)))}matchSegmentAgainstRoute(e,t,i,r,s){return"**"===i.path?(e=zB(i,e),i.loadChildren?(i._loadedRoutes?jn({routes:i._loadedRoutes,injector:i._loadedInjector}):this.configLoader.loadChildren(e,i)).pipe(ei(d=>(i._loadedRoutes=d.routes,i._loadedInjector=d.injector,new Qi(r,{})))):jn(new Qi(r,{}))):GB(t,i,r,e).pipe(uu(({matched:c,consumedSegments:d,remainingSegments:m})=>c?this.getChildConfig(e=i._injector??e,i,r).pipe(ze(w=>{const S=w.injector??e,T=w.routes,{segmentGroup:I,slicedSegments:R}=QC(t,d,m,T),k=new Qi(I.segments,I.children);if(0===R.length&&k.hasChildren())return this.expandChildren(S,T,k).pipe(ei(V=>new Qi(d,V)));if(0===T.length&&0===R.length)return jn(new Qi(d,{}));const F=du(i)===s;return this.expandSegment(S,k,T,R,F?$i:s,!0).pipe(ei(W=>new Qi(d.concat(W.segments),W.children)))})):rw(t)))}getChildConfig(e,t,i){return t.children?jn({routes:t.children,injector:e}):t.loadChildren?void 0!==t._loadedRoutes?jn({routes:t._loadedRoutes,injector:t._loadedInjector}):function sY(n,e,t,i){const r=e.canLoad;return void 0===r||0===r.length?jn(!0):jn(r.map(c=>{const d=Tv(c,n);return om(function $X(n){return n&&iw(n.canLoad)}(d)?d.canLoad(e,t):n.runInContext(()=>d(e,t)))})).pipe(Dv(),HB())}(e,t,i).pipe(ze(r=>r?this.configLoader.loadChildren(e,t).pipe(bo(s=>{t._loadedRoutes=s.routes,t._loadedInjector=s.injector})):function hY(n){return gv(FB(eS,3))}())):jn({routes:[],injector:e})}lineralizeSegments(e,t){let i=[],r=t.root;for(;;){if(i=i.concat(r.segments),0===r.numberOfChildren)return jn(i);if(r.numberOfChildren>1||!r.children[$i])return gv(new bt(4e3,eS));r=r.children[$i]}}applyRedirectCommands(e,t,i){return this.applyRedirectCreateUrlTree(t,this.urlSerializer.parse(t),e,i)}applyRedirectCreateUrlTree(e,t,i,r){const s=this.createSegmentGroup(e,t.root,i,r);return new zg(s,this.createQueryParams(t.queryParams,this.urlTree.queryParams),t.fragment)}createQueryParams(e,t){const i={};return Ta(e,(r,s)=>{if("string"==typeof r&&r.startsWith(":")){const d=r.substring(1);i[s]=t[d]}else i[s]=r}),i}createSegmentGroup(e,t,i,r){const s=this.createSegments(e,t.segments,i,r);let c={};return Ta(t.children,(d,m)=>{c[m]=this.createSegmentGroup(e,d,i,r)}),new Qi(s,c)}createSegments(e,t,i,r){return t.map(s=>s.path.startsWith(":")?this.findPosParam(e,s,r):this.findOrReturn(s,i))}findPosParam(e,t,i){const r=i[t.path.substring(1)];if(!r)throw new bt(4001,eS);return r}findOrReturn(e,t){let i=0;for(const r of t){if(r.path===e.path)return t.splice(i),r;i++}return e}}class gY{}class vY{constructor(e,t,i,r,s,c,d,m){this.injector=e,this.rootComponentType=t,this.config=i,this.urlTree=r,this.url=s,this.paramsInheritanceStrategy=c,this.relativeLinkResolution=d,this.urlSerializer=m}recognize(){const e=QC(this.urlTree.root,[],[],this.config.filter(t=>void 0===t.redirectTo),this.relativeLinkResolution).segmentGroup;return this.processSegmentGroup(this.injector,this.config,e,$i).pipe(ei(t=>{if(null===t)return null;const i=new ZC([],Object.freeze({}),Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,{},$i,this.rootComponentType,null,this.urlTree.root,-1,{}),r=new xp(i,t),s=new kB(this.url,r);return this.inheritParamsAndData(s._root),s}))}inheritParamsAndData(e){const t=e.value,i=RB(t,this.paramsInheritanceStrategy);t.params=Object.freeze(i.params),t.data=Object.freeze(i.data),e.children.forEach(r=>this.inheritParamsAndData(r))}processSegmentGroup(e,t,i,r){return 0===i.segments.length&&i.hasChildren()?this.processChildren(e,t,i):this.processSegment(e,t,i,i.segments,r)}processChildren(e,t,i){return fs(Object.keys(i.children)).pipe(tm(r=>{const s=i.children[r],c=VB(t,r);return this.processSegmentGroup(e,c,s,r)}),aB((r,s)=>r&&s?(r.push(...s),r):null),A3(r=>null!==r),VC(null),lB(),ei(r=>{if(null===r)return null;const s=ZB(r);return function xY(n){n.sort((e,t)=>e.value.outlet===$i?-1:t.value.outlet===$i?1:e.value.outlet.localeCompare(t.value.outlet))}(s),s}))}processSegment(e,t,i,r,s){return fs(t).pipe(tm(c=>this.processSegmentAgainstRoute(c._injector??e,c,i,r,s)),sm(c=>!!c),mp(c=>{if(RI(c))return $B(i,r,s)?jn([]):jn(null);throw c}))}processSegmentAgainstRoute(e,t,i,r,s){if(t.redirectTo||!jB(t,i,r,s))return jn(null);let c;if("**"===t.path){const d=r.length>0?dB(r).parameters:{},m=YB(i)+r.length;c=jn({snapshot:new ZC(r,d,Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,QB(t),du(t),t.component??t._loadedComponent??null,t,XB(i),m,JB(t),m),consumedSegments:[],remainingSegments:[]})}else c=GB(i,t,r,e).pipe(ei(({matched:d,consumedSegments:m,remainingSegments:y,parameters:w})=>{if(!d)return null;const S=YB(i)+m.length;return{snapshot:new ZC(m,w,Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,QB(t),du(t),t.component??t._loadedComponent??null,t,XB(i),S,JB(t),S),consumedSegments:m,remainingSegments:y}}));return c.pipe(uu(d=>{if(null===d)return jn(null);const{snapshot:m,consumedSegments:y,remainingSegments:w}=d;e=t._injector??e;const S=t._loadedInjector??e,T=function bY(n){return n.children?n.children:n.loadChildren?n._loadedRoutes:[]}(t),{segmentGroup:I,slicedSegments:R}=QC(i,y,w,T.filter(F=>void 0===F.redirectTo),this.relativeLinkResolution);if(0===R.length&&I.hasChildren())return this.processChildren(S,T,I).pipe(ei(F=>null===F?null:[new xp(m,F)]));if(0===T.length&&0===R.length)return jn([new xp(m,[])]);const k=du(t)===s;return this.processSegment(S,T,I,R,k?$i:s).pipe(ei(F=>null===F?null:[new xp(m,F)]))}))}}function wY(n){const e=n.value.routeConfig;return e&&""===e.path&&void 0===e.redirectTo}function ZB(n){const e=[],t=new Set;for(const i of n){if(!wY(i)){e.push(i);continue}const r=e.find(s=>i.value.routeConfig===s.value.routeConfig);void 0!==r?(r.children.push(...i.children),t.add(r)):e.push(i)}for(const i of t){const r=ZB(i.children);e.push(new xp(i.value,r))}return e.filter(i=>!t.has(i))}function XB(n){let e=n;for(;e._sourceSegment;)e=e._sourceSegment;return e}function YB(n){let e=n,t=e._segmentIndexShift??0;for(;e._sourceSegment;)e=e._sourceSegment,t+=e._segmentIndexShift??0;return t-1}function QB(n){return n.data||{}}function JB(n){return n.resolve||{}}function ez(n){return"string"==typeof n.title||null===n.title}function OI(n){return uu(e=>{const t=n(e);return t?fs(t).pipe(ei(()=>e)):jn(e)})}let tz=(()=>{class n{buildTitle(t){let i,r=t.root;for(;void 0!==r;)i=this.getResolvedTitleForRoute(r)??i,r=r.children.find(s=>s.outlet===$i);return i}getResolvedTitleForRoute(t){return t.data[Wb]}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=Yt({token:n,factory:function(){return xr(nz)},providedIn:"root"}),n})(),nz=(()=>{class n extends tz{constructor(t){super(),this.title=t}updateTitle(t){const i=this.buildTitle(t);void 0!==i&&this.title.setTitle(i)}}return n.\u0275fac=function(t){return new(t||n)(Xe(iF))},n.\u0275prov=Yt({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();class IY{}class RY extends class PY{shouldDetach(e){return!1}store(e,t){}shouldAttach(e){return!1}retrieve(e){return null}shouldReuseRoute(e,t){return e.routeConfig===t.routeConfig}}{}const iS=new Vt("",{providedIn:"root",factory:()=>({})}),FI=new Vt("ROUTES");let NI=(()=>{class n{constructor(t,i){this.injector=t,this.compiler=i,this.componentLoaders=new WeakMap,this.childrenLoaders=new WeakMap}loadComponent(t){if(this.componentLoaders.get(t))return this.componentLoaders.get(t);if(t._loadedComponent)return jn(t._loadedComponent);this.onLoadStartListener&&this.onLoadStartListener(t);const i=om(t.loadComponent()).pipe(bo(s=>{this.onLoadEndListener&&this.onLoadEndListener(t),t._loadedComponent=s}),yC(()=>{this.componentLoaders.delete(t)})),r=new sB(i,()=>new si).pipe(hI());return this.componentLoaders.set(t,r),r}loadChildren(t,i){if(this.childrenLoaders.get(i))return this.childrenLoaders.get(i);if(i._loadedRoutes)return jn({routes:i._loadedRoutes,injector:i._loadedInjector});this.onLoadStartListener&&this.onLoadStartListener(i);const s=this.loadModuleFactoryOrRoutes(i.loadChildren).pipe(ei(d=>{this.onLoadEndListener&&this.onLoadEndListener(i);let m,y,w=!1;Array.isArray(d)?y=d:(m=d.create(t).injector,y=uB(m.get(FI,[],Hn.Self|Hn.Optional)));return{routes:y.map(PI),injector:m}}),yC(()=>{this.childrenLoaders.delete(i)})),c=new sB(s,()=>new si).pipe(hI());return this.childrenLoaders.set(i,c),c}loadModuleFactoryOrRoutes(t){return om(t()).pipe(ze(i=>i instanceof Xk||Array.isArray(i)?jn(i):fs(this.compiler.compileModuleAsync(i))))}}return n.\u0275fac=function(t){return new(t||n)(Xe(Yr),Xe(SD))},n.\u0275prov=Yt({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();class LY{}class OY{shouldProcessUrl(e){return!0}extract(e){return e}merge(e,t){return e}}function FY(n){throw n}function NY(n,e,t){return e.parse("/")}const BY={paths:"exact",fragment:"ignored",matrixParams:"ignored",queryParams:"exact"},zY={paths:"subset",fragment:"ignored",matrixParams:"ignored",queryParams:"subset"};function rz(){const n=xr(_B),e=xr(Jb),t=xr(UM),i=xr(Yr),r=xr(SD),s=xr(FI,{optional:!0})??[],c=xr(iS,{optional:!0})??{},d=xr(nz),m=xr(tz,{optional:!0}),y=xr(LY,{optional:!0}),w=xr(IY,{optional:!0}),S=new qs(null,n,e,t,i,r,uB(s));return y&&(S.urlHandlingStrategy=y),w&&(S.routeReuseStrategy=w),S.titleStrategy=m??d,function VY(n,e){n.errorHandler&&(e.errorHandler=n.errorHandler),n.malformedUriErrorHandler&&(e.malformedUriErrorHandler=n.malformedUriErrorHandler),n.onSameUrlNavigation&&(e.onSameUrlNavigation=n.onSameUrlNavigation),n.paramsInheritanceStrategy&&(e.paramsInheritanceStrategy=n.paramsInheritanceStrategy),n.relativeLinkResolution&&(e.relativeLinkResolution=n.relativeLinkResolution),n.urlUpdateStrategy&&(e.urlUpdateStrategy=n.urlUpdateStrategy),n.canceledNavigationResolution&&(e.canceledNavigationResolution=n.canceledNavigationResolution)}(c,S),S}let qs=(()=>{class n{constructor(t,i,r,s,c,d,m){this.rootComponentType=t,this.urlSerializer=i,this.rootContexts=r,this.location=s,this.config=m,this.lastSuccessfulNavigation=null,this.currentNavigation=null,this.disposed=!1,this.navigationId=0,this.currentPageId=0,this.isNgZoneEnabled=!1,this.events=new si,this.errorHandler=FY,this.malformedUriErrorHandler=NY,this.navigated=!1,this.lastSuccessfulId=-1,this.afterPreactivation=()=>jn(void 0),this.urlHandlingStrategy=new OY,this.routeReuseStrategy=new RY,this.onSameUrlNavigation="ignore",this.paramsInheritanceStrategy="emptyOnly",this.urlUpdateStrategy="deferred",this.relativeLinkResolution="corrected",this.canceledNavigationResolution="replace",this.configLoader=c.get(NI),this.configLoader.onLoadEndListener=T=>this.triggerEvent(new bX(T)),this.configLoader.onLoadStartListener=T=>this.triggerEvent(new xX(T)),this.ngModule=c.get(Dg),this.console=c.get(mG);const S=c.get(nr);this.isNgZoneEnabled=S instanceof nr&&nr.isInAngularZone(),this.resetConfig(m),this.currentUrlTree=function jZ(){return new zg(new Qi([],{}),{},null)}(),this.rawUrlTree=this.currentUrlTree,this.browserUrlTree=this.currentUrlTree,this.routerState=PB(this.currentUrlTree,this.rootComponentType),this.transitions=new cu({id:0,targetPageId:0,currentUrlTree:this.currentUrlTree,currentRawUrl:this.currentUrlTree,extractedUrl:this.urlHandlingStrategy.extract(this.currentUrlTree),urlAfterRedirects:this.urlHandlingStrategy.extract(this.currentUrlTree),rawUrl:this.currentUrlTree,extras:{},resolve:null,reject:null,promise:Promise.resolve(!0),source:"imperative",restoredState:null,currentSnapshot:this.routerState.snapshot,targetSnapshot:null,currentRouterState:this.routerState,targetRouterState:null,guards:{canActivateChecks:[],canDeactivateChecks:[]},guardsResult:null}),this.navigations=this.setupNavigations(this.transitions),this.processNavigations()}get browserPageId(){return this.location.getState()?.\u0275routerPageId}setupNavigations(t){const i=this.events;return t.pipe(na(r=>0!==r.id),ei(r=>({...r,extractedUrl:this.urlHandlingStrategy.extract(r.rawUrl)})),uu(r=>{let s=!1,c=!1;return jn(r).pipe(bo(d=>{this.currentNavigation={id:d.id,initialUrl:d.rawUrl,extractedUrl:d.extractedUrl,trigger:d.source,extras:d.extras,previousNavigation:this.lastSuccessfulNavigation?{...this.lastSuccessfulNavigation,previousNavigation:null}:null}}),uu(d=>{const m=this.browserUrlTree.toString(),y=!this.navigated||d.extractedUrl.toString()!==m||m!==this.currentUrlTree.toString();if(("reload"===this.onSameUrlNavigation||y)&&this.urlHandlingStrategy.shouldProcessUrl(d.rawUrl))return sz(d.source)&&(this.browserUrlTree=d.extractedUrl),jn(d).pipe(uu(S=>{const T=this.transitions.getValue();return i.next(new bI(S.id,this.serializeUrl(S.extractedUrl),S.source,S.restoredState)),T!==this.transitions.getValue()?Gt:Promise.resolve(S)}),function mY(n,e,t,i){return uu(r=>function pY(n,e,t,i,r){return new fY(n,e,t,i,r).apply()}(n,e,t,r.extractedUrl,i).pipe(ei(s=>({...r,urlAfterRedirects:s}))))}(this.ngModule.injector,this.configLoader,this.urlSerializer,this.config),bo(S=>{this.currentNavigation={...this.currentNavigation,finalUrl:S.urlAfterRedirects},r.urlAfterRedirects=S.urlAfterRedirects}),function CY(n,e,t,i,r,s){return ze(c=>function yY(n,e,t,i,r,s,c="emptyOnly",d="legacy"){return new vY(n,e,t,i,r,c,d,s).recognize().pipe(uu(m=>null===m?function _Y(n){return new ci(e=>e.error(n))}(new gY):jn(m)))}(n,e,t,c.urlAfterRedirects,i.serialize(c.urlAfterRedirects),i,r,s).pipe(ei(d=>({...c,targetSnapshot:d}))))}(this.ngModule.injector,this.rootComponentType,this.config,this.urlSerializer,this.paramsInheritanceStrategy,this.relativeLinkResolution),bo(S=>{if(r.targetSnapshot=S.targetSnapshot,"eager"===this.urlUpdateStrategy){if(!S.extras.skipLocationChange){const I=this.urlHandlingStrategy.merge(S.urlAfterRedirects,S.rawUrl);this.setBrowserUrl(I,S)}this.browserUrlTree=S.urlAfterRedirects}const T=new mX(S.id,this.serializeUrl(S.extractedUrl),this.serializeUrl(S.urlAfterRedirects),S.targetSnapshot);i.next(T)}));if(y&&this.rawUrlTree&&this.urlHandlingStrategy.shouldProcessUrl(this.rawUrlTree)){const{id:T,extractedUrl:I,source:R,restoredState:k,extras:F}=d,G=new bI(T,this.serializeUrl(I),R,k);i.next(G);const W=PB(I,this.rootComponentType).snapshot;return jn(r={...d,targetSnapshot:W,urlAfterRedirects:I,extras:{...F,skipLocationChange:!1,replaceUrl:!1}})}return this.rawUrlTree=d.rawUrl,d.resolve(null),Gt}),bo(d=>{const m=new gX(d.id,this.serializeUrl(d.extractedUrl),this.serializeUrl(d.urlAfterRedirects),d.targetSnapshot);this.triggerEvent(m)}),ei(d=>r={...d,guards:VX(d.targetSnapshot,d.currentSnapshot,this.rootContexts)}),function KX(n,e){return ze(t=>{const{targetSnapshot:i,currentSnapshot:r,guards:{canActivateChecks:s,canDeactivateChecks:c}}=t;return 0===c.length&&0===s.length?jn({...t,guardsResult:!0}):function QX(n,e,t,i){return fs(n).pipe(ze(r=>function rY(n,e,t,i,r){const s=e&&e.routeConfig?e.routeConfig.canDeactivate:null;return s&&0!==s.length?jn(s.map(d=>{const m=ew(e)??r,y=Tv(d,m);return om(function ZX(n){return n&&iw(n.canDeactivate)}(y)?y.canDeactivate(n,e,t,i):m.runInContext(()=>y(n,e,t,i))).pipe(sm())})).pipe(Dv()):jn(!0)}(r.component,r.route,t,e,i)),sm(r=>!0!==r,!0))}(c,i,r,n).pipe(ze(d=>d&&function jX(n){return"boolean"==typeof n}(d)?function JX(n,e,t,i){return fs(e).pipe(tm(r=>uC(function tY(n,e){return null!==n&&e&&e(new wX(n)),jn(!0)}(r.route.parent,i),function eY(n,e){return null!==n&&e&&e(new CX(n)),jn(!0)}(r.route,i),function iY(n,e,t){const i=e[e.length-1],s=e.slice(0,e.length-1).reverse().map(c=>function UX(n){const e=n.routeConfig?n.routeConfig.canActivateChild:null;return e&&0!==e.length?{node:n,guards:e}:null}(c)).filter(c=>null!==c).map(c=>dI(()=>jn(c.guards.map(m=>{const y=ew(c.node)??t,w=Tv(m,y);return om(function qX(n){return n&&iw(n.canActivateChild)}(w)?w.canActivateChild(i,n):y.runInContext(()=>w(i,n))).pipe(sm())})).pipe(Dv())));return jn(s).pipe(Dv())}(n,r.path,t),function nY(n,e,t){const i=e.routeConfig?e.routeConfig.canActivate:null;if(!i||0===i.length)return jn(!0);const r=i.map(s=>dI(()=>{const c=ew(e)??t,d=Tv(s,c);return om(function WX(n){return n&&iw(n.canActivate)}(d)?d.canActivate(e,n):c.runInContext(()=>d(e,n))).pipe(sm())}));return jn(r).pipe(Dv())}(n,r.route,t))),sm(r=>!0!==r,!0))}(i,s,n,e):jn(d)),ei(d=>({...t,guardsResult:d})))})}(this.ngModule.injector,d=>this.triggerEvent(d)),bo(d=>{if(r.guardsResult=d.guardsResult,Ug(d.guardsResult))throw OB(0,d.guardsResult);const m=new _X(d.id,this.serializeUrl(d.extractedUrl),this.serializeUrl(d.urlAfterRedirects),d.targetSnapshot,!!d.guardsResult);this.triggerEvent(m)}),na(d=>!!d.guardsResult||(this.restoreHistory(d),this.cancelNavigationTransition(d,"",3),!1)),OI(d=>{if(d.guards.canActivateChecks.length)return jn(d).pipe(bo(m=>{const y=new yX(m.id,this.serializeUrl(m.extractedUrl),this.serializeUrl(m.urlAfterRedirects),m.targetSnapshot);this.triggerEvent(y)}),uu(m=>{let y=!1;return jn(m).pipe(function SY(n,e){return ze(t=>{const{targetSnapshot:i,guards:{canActivateChecks:r}}=t;if(!r.length)return jn(t);let s=0;return fs(r).pipe(tm(c=>function EY(n,e,t,i){const r=n.routeConfig,s=n._resolve;return void 0!==r?.title&&!ez(r)&&(s[Wb]=r.title),function TY(n,e,t,i){const r=function DY(n){return[...Object.keys(n),...Object.getOwnPropertySymbols(n)]}(n);if(0===r.length)return jn({});const s={};return fs(r).pipe(ze(c=>function AY(n,e,t,i){const r=ew(e)??i,s=Tv(n,r);return om(s.resolve?s.resolve(e,t):r.runInContext(()=>s(e,t)))}(n[c],e,t,i).pipe(sm(),bo(d=>{s[c]=d}))),pI(1),function VZ(n){return ei(()=>n)}(s),mp(c=>RI(c)?Gt:gv(c)))}(s,n,e,i).pipe(ei(c=>(n._resolvedData=c,n.data=RB(n,t).resolve,r&&ez(r)&&(n.data[Wb]=r.title),null)))}(c.route,i,n,e)),bo(()=>s++),pI(1),ze(c=>s===r.length?jn(t):Gt))})}(this.paramsInheritanceStrategy,this.ngModule.injector),bo({next:()=>y=!0,complete:()=>{y||(this.restoreHistory(m),this.cancelNavigationTransition(m,"",2))}}))}),bo(m=>{const y=new vX(m.id,this.serializeUrl(m.extractedUrl),this.serializeUrl(m.urlAfterRedirects),m.targetSnapshot);this.triggerEvent(y)}))}),OI(d=>{const m=y=>{const w=[];y.routeConfig?.loadComponent&&!y.routeConfig._loadedComponent&&w.push(this.configLoader.loadComponent(y.routeConfig).pipe(bo(S=>{y.component=S}),ei(()=>{})));for(const S of y.children)w.push(...m(S));return w};return vA(m(d.targetSnapshot.root)).pipe(VC(),xc(1))}),OI(()=>this.afterPreactivation()),ei(d=>{const m=function AX(n,e,t){const i=Qb(n,e._root,t?t._root:void 0);return new IB(i,e)}(this.routeReuseStrategy,d.targetSnapshot,d.currentRouterState);return r={...d,targetRouterState:m}}),bo(d=>{this.currentUrlTree=d.urlAfterRedirects,this.rawUrlTree=this.urlHandlingStrategy.merge(d.urlAfterRedirects,d.rawUrl),this.routerState=d.targetRouterState,"deferred"===this.urlUpdateStrategy&&(d.extras.skipLocationChange||this.setBrowserUrl(this.rawUrlTree,d),this.browserUrlTree=d.urlAfterRedirects)}),((n,e,t)=>ei(i=>(new zX(e,i.targetRouterState,i.currentRouterState,t).activate(n),i)))(this.rootContexts,this.routeReuseStrategy,d=>this.triggerEvent(d)),bo({next(){s=!0},complete(){s=!0}}),yC(()=>{s||c||this.cancelNavigationTransition(r,"",1),this.currentNavigation?.id===r.id&&(this.currentNavigation=null)}),mp(d=>{if(c=!0,BB(d)){NB(d)||(this.navigated=!0,this.restoreHistory(r,!0));const m=new qC(r.id,this.serializeUrl(r.extractedUrl),d.message,d.cancellationCode);if(i.next(m),NB(d)){const y=this.urlHandlingStrategy.merge(d.url,this.rawUrlTree),w={skipLocationChange:r.extras.skipLocationChange,replaceUrl:"eager"===this.urlUpdateStrategy||sz(r.source)};this.scheduleNavigation(y,"imperative",null,w,{resolve:r.resolve,reject:r.reject,promise:r.promise})}else r.resolve(!1)}else{this.restoreHistory(r,!0);const m=new TB(r.id,this.serializeUrl(r.extractedUrl),d,r.targetSnapshot??void 0);i.next(m);try{r.resolve(this.errorHandler(d))}catch(y){r.reject(y)}}return Gt}))}))}resetRootComponentType(t){this.rootComponentType=t,this.routerState.root.component=this.rootComponentType}setTransition(t){this.transitions.next({...this.transitions.value,...t})}initialNavigation(){this.setUpLocationChangeListener(),0===this.navigationId&&this.navigateByUrl(this.location.path(!0),{replaceUrl:!0})}setUpLocationChangeListener(){this.locationSubscription||(this.locationSubscription=this.location.subscribe(t=>{const i="popstate"===t.type?"popstate":"hashchange";"popstate"===i&&setTimeout(()=>{const r={replaceUrl:!0},s=t.state?.navigationId?t.state:null;if(s){const d={...s};delete d.navigationId,delete d.\u0275routerPageId,0!==Object.keys(d).length&&(r.state=d)}const c=this.parseUrl(t.url);this.scheduleNavigation(c,i,s,r)},0)}))}get url(){return this.serializeUrl(this.currentUrlTree)}getCurrentNavigation(){return this.currentNavigation}triggerEvent(t){this.events.next(t)}resetConfig(t){this.config=t.map(PI),this.navigated=!1,this.lastSuccessfulId=-1}ngOnDestroy(){this.dispose()}dispose(){this.transitions.complete(),this.locationSubscription&&(this.locationSubscription.unsubscribe(),this.locationSubscription=void 0),this.disposed=!0}createUrlTree(t,i={}){const{relativeTo:r,queryParams:s,fragment:c,queryParamsHandling:d,preserveFragment:m}=i,y=r||this.routerState.root,w=m?this.currentUrlTree.fragment:c;let S=null;switch(d){case"merge":S={...this.currentUrlTree.queryParams,...s};break;case"preserve":S=this.currentUrlTree.queryParams;break;default:S=s||null}return null!==S&&(S=this.removeEmptyProps(S)),cX(y,this.currentUrlTree,t,S,w??null)}navigateByUrl(t,i={skipLocationChange:!1}){const r=Ug(t)?t:this.parseUrl(t),s=this.urlHandlingStrategy.merge(r,this.rawUrlTree);return this.scheduleNavigation(s,"imperative",null,i)}navigate(t,i={skipLocationChange:!1}){return function UY(n){for(let e=0;e<n.length;e++){if(null==n[e])throw new bt(4008,false)}}(t),this.navigateByUrl(this.createUrlTree(t,i),i)}serializeUrl(t){return this.urlSerializer.serialize(t)}parseUrl(t){let i;try{i=this.urlSerializer.parse(t)}catch(r){i=this.malformedUriErrorHandler(r,this.urlSerializer,t)}return i}isActive(t,i){let r;if(r=!0===i?{...BY}:!1===i?{...zY}:i,Ug(t))return pB(this.currentUrlTree,t,r);const s=this.parseUrl(t);return pB(this.currentUrlTree,s,r)}removeEmptyProps(t){return Object.keys(t).reduce((i,r)=>{const s=t[r];return null!=s&&(i[r]=s),i},{})}processNavigations(){this.navigations.subscribe(t=>{this.navigated=!0,this.lastSuccessfulId=t.id,this.currentPageId=t.targetPageId,this.events.next(new Hg(t.id,this.serializeUrl(t.extractedUrl),this.serializeUrl(this.currentUrlTree))),this.lastSuccessfulNavigation=this.currentNavigation,this.titleStrategy?.updateTitle(this.routerState.snapshot),t.resolve(!0)},t=>{this.console.warn(`Unhandled Navigation Error: ${t}`)})}scheduleNavigation(t,i,r,s,c){if(this.disposed)return Promise.resolve(!1);let d,m,y;c?(d=c.resolve,m=c.reject,y=c.promise):y=new Promise((T,I)=>{d=T,m=I});const w=++this.navigationId;let S;return"computed"===this.canceledNavigationResolution?(0===this.currentPageId&&(r=this.location.getState()),S=r&&r.\u0275routerPageId?r.\u0275routerPageId:s.replaceUrl||s.skipLocationChange?this.browserPageId??0:(this.browserPageId??0)+1):S=0,this.setTransition({id:w,targetPageId:S,source:i,restoredState:r,currentUrlTree:this.currentUrlTree,currentRawUrl:this.rawUrlTree,rawUrl:t,extras:s,resolve:d,reject:m,promise:y,currentSnapshot:this.routerState.snapshot,currentRouterState:this.routerState}),y.catch(T=>Promise.reject(T))}setBrowserUrl(t,i){const r=this.urlSerializer.serialize(t),s={...i.extras.state,...this.generateNgRouterState(i.id,i.targetPageId)};this.location.isCurrentPathEqualTo(r)||i.extras.replaceUrl?this.location.replaceState(r,"",s):this.location.go(r,"",s)}restoreHistory(t,i=!1){if("computed"===this.canceledNavigationResolution){const r=this.currentPageId-t.targetPageId;"popstate"!==t.source&&"eager"!==this.urlUpdateStrategy&&this.currentUrlTree!==this.currentNavigation?.finalUrl||0===r?this.currentUrlTree===this.currentNavigation?.finalUrl&&0===r&&(this.resetState(t),this.browserUrlTree=t.currentUrlTree,this.resetUrlToCurrentUrlTree()):this.location.historyGo(r)}else"replace"===this.canceledNavigationResolution&&(i&&this.resetState(t),this.resetUrlToCurrentUrlTree())}resetState(t){this.routerState=t.currentRouterState,this.currentUrlTree=t.currentUrlTree,this.rawUrlTree=this.urlHandlingStrategy.merge(this.currentUrlTree,t.rawUrl)}resetUrlToCurrentUrlTree(){this.location.replaceState(this.urlSerializer.serialize(this.rawUrlTree),"",this.generateNgRouterState(this.lastSuccessfulId,this.currentPageId))}cancelNavigationTransition(t,i,r){const s=new qC(t.id,this.serializeUrl(t.extractedUrl),i,r);this.triggerEvent(s),t.resolve(!1)}generateNgRouterState(t,i){return"computed"===this.canceledNavigationResolution?{navigationId:t,\u0275routerPageId:i}:{navigationId:t}}}return n.\u0275fac=function(t){eu()},n.\u0275prov=Yt({token:n,factory:function(){return rz()},providedIn:"root"}),n})();function sz(n){return"imperative"!==n}let sS=(()=>{class n{constructor(t,i,r,s,c){this.router=t,this.route=i,this.tabIndexAttribute=r,this.renderer=s,this.el=c,this._preserveFragment=!1,this._skipLocationChange=!1,this._replaceUrl=!1,this.commands=null,this.onChanges=new si,this.setTabIndexIfNotOnNativeEl("0")}set preserveFragment(t){this._preserveFragment=cp(t)}get preserveFragment(){return this._preserveFragment}set skipLocationChange(t){this._skipLocationChange=cp(t)}get skipLocationChange(){return this._skipLocationChange}set replaceUrl(t){this._replaceUrl=cp(t)}get replaceUrl(){return this._replaceUrl}setTabIndexIfNotOnNativeEl(t){if(null!=this.tabIndexAttribute)return;const i=this.renderer,r=this.el.nativeElement;null!==t?i.setAttribute(r,"tabindex",t):i.removeAttribute(r,"tabindex")}ngOnChanges(t){this.onChanges.next(this)}set routerLink(t){null!=t?(this.commands=Array.isArray(t)?t:[t],this.setTabIndexIfNotOnNativeEl("0")):(this.commands=null,this.setTabIndexIfNotOnNativeEl(null))}onClick(){return null===this.urlTree||this.router.navigateByUrl(this.urlTree,{skipLocationChange:this.skipLocationChange,replaceUrl:this.replaceUrl,state:this.state}),!0}get urlTree(){return null===this.commands?null:this.router.createUrlTree(this.commands,{relativeTo:void 0!==this.relativeTo?this.relativeTo:this.route,queryParams:this.queryParams,fragment:this.fragment,queryParamsHandling:this.queryParamsHandling,preserveFragment:this.preserveFragment})}}return n.\u0275fac=function(t){return new(t||n)(Ie(qs),Ie(md),ns("tabindex"),Ie(Ul),Ie(wr))},n.\u0275dir=an({type:n,selectors:[["","routerLink","",5,"a",5,"area"]],hostBindings:function(t,i){1&t&&gi("click",function(){return i.onClick()})},inputs:{queryParams:"queryParams",fragment:"fragment",queryParamsHandling:"queryParamsHandling",state:"state",relativeTo:"relativeTo",preserveFragment:"preserveFragment",skipLocationChange:"skipLocationChange",replaceUrl:"replaceUrl",routerLink:"routerLink"},standalone:!0,features:[Nr]}),n})(),oS=(()=>{class n{constructor(t,i,r){this.router=t,this.route=i,this.locationStrategy=r,this._preserveFragment=!1,this._skipLocationChange=!1,this._replaceUrl=!1,this.commands=null,this.href=null,this.onChanges=new si,this.subscription=t.events.subscribe(s=>{s instanceof Hg&&this.updateTargetUrlAndHref()})}set preserveFragment(t){this._preserveFragment=cp(t)}get preserveFragment(){return this._preserveFragment}set skipLocationChange(t){this._skipLocationChange=cp(t)}get skipLocationChange(){return this._skipLocationChange}set replaceUrl(t){this._replaceUrl=cp(t)}get replaceUrl(){return this._replaceUrl}set routerLink(t){this.commands=null!=t?Array.isArray(t)?t:[t]:null}ngOnChanges(t){this.updateTargetUrlAndHref(),this.onChanges.next(this)}ngOnDestroy(){this.subscription.unsubscribe()}onClick(t,i,r,s,c){return!!(0!==t||i||r||s||c||"string"==typeof this.target&&"_self"!=this.target||null===this.urlTree)||(this.router.navigateByUrl(this.urlTree,{skipLocationChange:this.skipLocationChange,replaceUrl:this.replaceUrl,state:this.state}),!1)}updateTargetUrlAndHref(){this.href=null!==this.urlTree?this.locationStrategy.prepareExternalUrl(this.router.serializeUrl(this.urlTree)):null}get urlTree(){return null===this.commands?null:this.router.createUrlTree(this.commands,{relativeTo:void 0!==this.relativeTo?this.relativeTo:this.route,queryParams:this.queryParams,fragment:this.fragment,queryParamsHandling:this.queryParamsHandling,preserveFragment:this.preserveFragment})}}return n.\u0275fac=function(t){return new(t||n)(Ie(qs),Ie(md),Ie(Ig))},n.\u0275dir=an({type:n,selectors:[["a","routerLink",""],["area","routerLink",""]],hostVars:2,hostBindings:function(t,i){1&t&&gi("click",function(s){return i.onClick(s.button,s.ctrlKey,s.shiftKey,s.altKey,s.metaKey)}),2&t&&tr("target",i.target)("href",i.href,fy)},inputs:{target:"target",queryParams:"queryParams",fragment:"fragment",queryParamsHandling:"queryParamsHandling",state:"state",relativeTo:"relativeTo",preserveFragment:"preserveFragment",skipLocationChange:"skipLocationChange",replaceUrl:"replaceUrl",routerLink:"routerLink"},standalone:!0,features:[Nr]}),n})();class oz{}let jY=(()=>{class n{constructor(t,i,r,s,c){this.router=t,this.injector=r,this.preloadingStrategy=s,this.loader=c}setUpPreloading(){this.subscription=this.router.events.pipe(na(t=>t instanceof Hg),tm(()=>this.preload())).subscribe(()=>{})}preload(){return this.processRoutes(this.injector,this.router.config)}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe()}processRoutes(t,i){const r=[];for(const s of i){s.providers&&!s._injector&&(s._injector=DM(s.providers,t,`Route: ${s.path}`));const c=s._injector??t,d=s._loadedInjector??c;s.loadChildren&&!s._loadedRoutes&&void 0===s.canLoad||s.loadComponent&&!s._loadedComponent?r.push(this.preloadConfig(c,s)):(s.children||s._loadedRoutes)&&r.push(this.processRoutes(d,s.children??s._loadedRoutes))}return fs(r).pipe(_t())}preloadConfig(t,i){return this.preloadingStrategy.preload(i,()=>{let r;r=i.loadChildren&&void 0===i.canLoad?this.loader.loadChildren(t,i):jn(null);const s=r.pipe(ze(c=>null===c?jn(void 0):(i._loadedRoutes=c.routes,i._loadedInjector=c.injector,this.processRoutes(c.injector??t,c.routes))));return i.loadComponent&&!i._loadedComponent?fs([s,this.loader.loadComponent(i)]).pipe(_t()):s})}}return n.\u0275fac=function(t){return new(t||n)(Xe(qs),Xe(SD),Xe(fc),Xe(oz),Xe(NI))},n.\u0275prov=Yt({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();const BI=new Vt("");let az=(()=>{class n{constructor(t,i,r={}){this.router=t,this.viewportScroller=i,this.options=r,this.lastId=0,this.lastSource="imperative",this.restoredId=0,this.store={},r.scrollPositionRestoration=r.scrollPositionRestoration||"disabled",r.anchorScrolling=r.anchorScrolling||"disabled"}init(){"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.setHistoryScrollRestoration("manual"),this.routerEventsSubscription=this.createScrollEvents(),this.scrollEventsSubscription=this.consumeScrollEvents()}createScrollEvents(){return this.router.events.subscribe(t=>{t instanceof bI?(this.store[this.lastId]=this.viewportScroller.getScrollPosition(),this.lastSource=t.navigationTrigger,this.restoredId=t.restoredState?t.restoredState.navigationId:0):t instanceof Hg&&(this.lastId=t.id,this.scheduleScrollEvent(t,this.router.parseUrl(t.urlAfterRedirects).fragment))})}consumeScrollEvents(){return this.router.events.subscribe(t=>{t instanceof DB&&(t.position?"top"===this.options.scrollPositionRestoration?this.viewportScroller.scrollToPosition([0,0]):"enabled"===this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition(t.position):t.anchor&&"enabled"===this.options.anchorScrolling?this.viewportScroller.scrollToAnchor(t.anchor):"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition([0,0]))})}scheduleScrollEvent(t,i){this.router.triggerEvent(new DB(t,"popstate"===this.lastSource?this.store[this.restoredId]:null,i))}ngOnDestroy(){this.routerEventsSubscription&&this.routerEventsSubscription.unsubscribe(),this.scrollEventsSubscription&&this.scrollEventsSubscription.unsubscribe()}}return n.\u0275fac=function(t){eu()},n.\u0275prov=Yt({token:n,factory:n.\u0275fac}),n})();function Av(n,e){return{\u0275kind:n,\u0275providers:e}}function zI(n){return[{provide:FI,multi:!0,useValue:n}]}function cz(){const n=xr(Yr);return e=>{const t=n.get(ov);if(e!==t.components[0])return;const i=n.get(qs),r=n.get(uz);1===n.get(VI)&&i.initialNavigation(),n.get(dz,null,Hn.Optional)?.setUpPreloading(),n.get(BI,null,Hn.Optional)?.init(),i.resetRootComponentType(t.componentTypes[0]),r.next(),r.complete()}}const uz=new Vt("",{factory:()=>new si}),VI=new Vt("",{providedIn:"root",factory:()=>1});const dz=new Vt("");function ZY(n){return Av(0,[{provide:dz,useExisting:jY},{provide:oz,useExisting:n}])}const hz=new Vt("ROUTER_FORROOT_GUARD"),XY=[UM,{provide:_B,useClass:mI},{provide:qs,useFactory:rz},Jb,{provide:md,useFactory:function lz(n){return n.routerState.root},deps:[qs]},NI];function YY(){return new $L("Router",qs)}let pz=(()=>{class n{constructor(t){}static forRoot(t,i){return{ngModule:n,providers:[XY,[],zI(t),{provide:hz,useFactory:eK,deps:[[qs,new ls,new $r]]},{provide:iS,useValue:i||{}},i?.useHash?{provide:Ig,useClass:ij}:{provide:Ig,useClass:gO},{provide:BI,useFactory:()=>{const n=xr(qs),e=xr(y8),t=xr(iS);return t.scrollOffset&&e.setOffset(t.scrollOffset),new az(n,e,t)}},i?.preloadingStrategy?ZY(i.preloadingStrategy).\u0275providers:[],{provide:$L,multi:!0,useFactory:YY},i?.initialNavigation?tK(i):[],[{provide:fz,useFactory:cz},{provide:BL,multi:!0,useExisting:fz}]]}}static forChild(t){return{ngModule:n,providers:[zI(t)]}}}return n.\u0275fac=function(t){return new(t||n)(Xe(hz,8))},n.\u0275mod=Gn({type:n}),n.\u0275inj=Bn({imports:[AI]}),n})();function eK(n){return"guarded"}function tK(n){return["disabled"===n.initialNavigation?Av(3,[{provide:RM,multi:!0,useFactory:()=>{const e=xr(qs);return()=>{e.setUpLocationChangeListener()}}},{provide:VI,useValue:2}]).\u0275providers:[],"enabledBlocking"===n.initialNavigation?Av(2,[{provide:VI,useValue:0},{provide:RM,multi:!0,deps:[Yr],useFactory:e=>{const t=e.get(tj,Promise.resolve());let i=!1;return()=>t.then(()=>new Promise(s=>{const c=e.get(qs),d=e.get(uz);(function r(s){e.get(qs).events.pipe(na(d=>d instanceof Hg||d instanceof qC||d instanceof TB),ei(d=>d instanceof Hg||d instanceof qC&&(0===d.code||1===d.code)&&null),na(d=>null!==d),xc(1)).subscribe(()=>{s()})})(()=>{s(!0),i=!0}),c.afterPreactivation=()=>(s(!0),i||d.closed?jn(void 0):d),c.initialNavigation()}))}}]).\u0275providers:[]]}const fz=new Vt("");let mz=(()=>{class n{constructor(){}ngOnInit(){}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275cmp=Qn({type:n,selectors:[["app-login"]],decls:14,vars:0,consts:[[1,"login-form"],[1,"form-group"],["for","username"],["type","text","id","username","name","username","required",""],["for","password"],["type","password","id","password","name","password","required",""],["type","submit"]],template:function(t,i){1&t&&(Ae(0,"div",0)(1,"h2"),it(2,"Iniciar sesi\xf3n"),xe(),Ae(3,"form")(4,"div",1)(5,"label",2),it(6,"Nombre de usuario"),xe(),jt(7,"input",3),xe(),Ae(8,"div",1)(9,"label",4),it(10,"Contrase\xf1a"),xe(),jt(11,"input",5),xe(),Ae(12,"button",6),it(13,"Iniciar sesi\xf3n"),xe()()())},dependencies:[bv,vv,yp],styles:[".login-form[_ngcontent-%COMP%]{max-width:400px;margin:0 auto;padding:20px;background-color:#f2f2f2;border-radius:5px}.login-form[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{text-align:center}.login-form[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]{margin-bottom:15px}.login-form[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-weight:700}.login-form[_ngcontent-%COMP%]   input[type=text][_ngcontent-%COMP%], .login-form[_ngcontent-%COMP%]   input[type=password][_ngcontent-%COMP%]{width:100%;padding:10px;border-radius:5px;border:1px solid #ccc}.login-form[_ngcontent-%COMP%]   button[type=submit][_ngcontent-%COMP%]{width:100%;padding:10px;background-color:#4caf50;color:#fff;border:none;border-radius:5px;cursor:pointer}.login-form[_ngcontent-%COMP%]   button[type=submit][_ngcontent-%COMP%]:hover{background-color:#45a049}"]}),n})(),gz=(()=>{class n{constructor(){}ngOnInit(){}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275cmp=Qn({type:n,selectors:[["app-register"]],decls:37,vars:0,consts:[[1,"register-form"],[1,"row"],[1,"col-md-6"],[1,"form-group"],["for","first-name"],["type","text","id","first-name","name","first-name","required",""],["for","last-name"],["type","text","id","last-name","name","last-name","required",""],["for","email"],["type","email","id","email","name","email","required",""],["for","phone"],["type","tel","id","phone","name","phone","required",""],["for","password"],["type","password","id","password","name","password","required",""],["for","confirm-password"],["type","password","id","confirm-password","name","confirm-password","required",""],["for","rut"],["type","text","id","rut","name","rut","required",""],["type","submit"]],template:function(t,i){1&t&&(Ae(0,"div",0)(1,"h2"),it(2,"Registrarse"),xe(),Ae(3,"form")(4,"div",1)(5,"div",2)(6,"div",3)(7,"label",4),it(8,"Nombres"),xe(),jt(9,"input",5),xe()(),Ae(10,"div",2)(11,"div",3)(12,"label",6),it(13,"Apellidos"),xe(),jt(14,"input",7),xe()()(),Ae(15,"div",3)(16,"label",8),it(17,"Correo electr\xf3nico"),xe(),jt(18,"input",9),xe(),Ae(19,"div",3)(20,"label",10),it(21,"Tel\xe9fono"),xe(),jt(22,"input",11),xe(),Ae(23,"div",3)(24,"label",12),it(25,"Contrase\xf1a"),xe(),jt(26,"input",13),xe(),Ae(27,"div",3)(28,"label",14),it(29,"Confirmar contrase\xf1a"),xe(),jt(30,"input",15),xe(),Ae(31,"div",3)(32,"label",16),it(33,"RUT"),xe(),jt(34,"input",17),xe(),Ae(35,"button",18),it(36,"Registrarse"),xe()()())},dependencies:[bv,vv,yp],styles:[".register-form[_ngcontent-%COMP%]{max-width:400px;margin:0 auto;padding:20px;background-color:#f2f2f2;border-radius:5px}.register-form[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{text-align:center}.register-form[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]{margin-bottom:15px}.register-form[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-weight:700}.register-form[_ngcontent-%COMP%]   input[type=text][_ngcontent-%COMP%], .register-form[_ngcontent-%COMP%]   input[type=email][_ngcontent-%COMP%], .register-form[_ngcontent-%COMP%]   input[type=tel][_ngcontent-%COMP%], .register-form[_ngcontent-%COMP%]   input[type=password][_ngcontent-%COMP%]{width:100%;padding:10px;border-radius:5px;border:1px solid #ccc}.register-form[_ngcontent-%COMP%]   button[type=submit][_ngcontent-%COMP%]{width:100%;padding:10px;background-color:#4caf50;color:#fff;border:none;border-radius:5px;cursor:pointer}.register-form[_ngcontent-%COMP%]   button[type=submit][_ngcontent-%COMP%]:hover{background-color:#45a049}@media (max-width: 576px){.register-form[_ngcontent-%COMP%]   .row[_ngcontent-%COMP%]{flex-direction:column}.register-form[_ngcontent-%COMP%]   .col-md-6[_ngcontent-%COMP%]{width:100%}}"]}),n})(),cS=(()=>{class n{constructor(){}ngOnInit(){}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275cmp=Qn({type:n,selectors:[["app-toolbar"]],decls:33,vars:0,consts:[[1,"navbar","navbar-expand-lg"],[1,"container-fluid"],["href","/index",1,"navbar-brand"],["alt","Logo","width","30","height","30",1,"d-inline-block","align-top"],["type","button","data-bs-toggle","collapse","data-bs-target","#navbarNav","aria-controls","navbarNav","aria-expanded","false","aria-label","Toggle navigation",1,"navbar-toggler"],[1,"navbar-toggler-icon"],["id","navbarNav",1,"collapse","navbar-collapse","justify-content-end"],[1,"navbar-nav"],[1,"nav-item"],["data-bs-toggle","modal","data-bs-target","#loginSignupModal",1,"nav-link"],["routerLink","/help",1,"nav-link"],["id","loginSignupModal","tabindex","-1","aria-labelledby","loginSignupModalLabel","aria-hidden","true",1,"modal","fade"],[1,"modal-dialog"],[1,"modal-content"],[1,"modal-header"],["type","button","data-bs-dismiss","modal","aria-label","Close",1,"btn-close"],[1,"modal-body"],["id","loginSignupTabs","role","tablist",1,"nav","nav-tabs"],["role","presentation",1,"nav-item"],["id","login-tab","data-bs-toggle","tab","data-bs-target","#login","type","button","role","tab","aria-controls","login","aria-selected","true",1,"nav-link","active"],["id","signup-tab","data-bs-toggle","tab","data-bs-target","#signup","type","button","role","tab","aria-controls","signup","aria-selected","false",1,"nav-link"],["id","loginSignupContent",1,"tab-content"],["id","login","role","tabpanel","aria-labelledby","login-tab",1,"tab-pane","fade","show","active"],["id","signup","role","tabpanel","aria-labelledby","signup-tab",1,"tab-pane","fade"]],template:function(t,i){1&t&&(Ae(0,"header")(1,"nav",0)(2,"div",1)(3,"a",2),jt(4,"img",3),xe(),Ae(5,"button",4),jt(6,"span",5),xe(),Ae(7,"div",6)(8,"ul",7)(9,"li",8)(10,"a",9),it(11,"Ingresar"),xe()(),Ae(12,"li",8)(13,"a",10),it(14,"Ayuda"),xe()()()()()()(),Ae(15,"div",11)(16,"div",12)(17,"div",13)(18,"div",14),jt(19,"button",15),xe(),Ae(20,"div",16)(21,"ul",17)(22,"li",18)(23,"button",19),it(24,"Iniciar sesi\xf3n"),xe()(),Ae(25,"li",18)(26,"button",20),it(27,"Registrarse"),xe()()(),Ae(28,"div",21)(29,"div",22),jt(30,"app-login"),xe(),Ae(31,"div",23),jt(32,"app-register"),xe()()()()()())},dependencies:[oS,mz,gz],styles:[".navbar[_ngcontent-%COMP%]{background-color:#114358}.nav-link[_ngcontent-%COMP%]{color:#fff}.navbar[_ngcontent-%COMP%]{box-shadow:0 10px 5px #0000001a}.navbar-nav[_ngcontent-%COMP%]   .nav-item[_ngcontent-%COMP%]   .nav-link[_ngcontent-%COMP%]:hover{color:#114358;background-color:#f0f0f0;transition:background-color .2s ease;border-radius:10%}"]}),n})();class iK{constructor(e="",t="",i="",r=[]){this.comunas=[],this._id=e,this.id_region=t,this.nombre_region=i,this.comunas=r}}let _z=(()=>{class n{constructor(t){this.http=t,this.URL_API="http://127.0.0.1:3000/api/region",this.selectedRegion=new iK,this.regions=[]}getRegions(){return this.http.get(this.URL_API)}getRegion(t){return this.http.get(this.URL_API+`/${t}`)}postRegion(t){}putRegion(t){}deleteRegion(t){}}return n.\u0275fac=function(t){return new(t||n)(Xe(_v))},n.\u0275prov=Yt({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();class rK{constructor(e="",t="",i=0,r=0,s=null,c="",d=null,m="",y="",w="",S="",T="",I="",R=0,k=""){this._id=e,this.id_region=t,this.latitud=i,this.longitud=r,this.banio_compartido=s,this.descripcion=c,this.fecha_publicacion=d,this.region=m,this.ciudad=y,this.comuna=w,this.calle=S,this.numero=T,this.casa_depto=I,this.precio=R,this.url_image_cover=k}}let Iv=(()=>{class n{constructor(t){this.http=t,this.URL_API="http://127.0.0.1:3000/api",this.selectedRoom=new rK,this.rooms=[]}getRooms(){return this.http.get(this.URL_API)}getRoom(t){return this.http.get(this.URL_API+`/${t}`)}getRoomByFilter(t){let i={region:"",comuna:"",casa_depto:""};return void 0!==t.region&&(i.region=t.region),void 0!==t.comuna&&(i.comuna=t.comuna),void 0!==t.casa_depto&&(i.casa_depto=t.casa_depto),this.http.get(`${this.URL_API}/filterRooms/`,{params:i})}postRoom(t){}putRoom(t){}deleteRoom(t){}roomsIsVoid(){return 0===this.rooms.length}}return n.\u0275fac=function(t){return new(t||n)(Xe(_v))},n.\u0275prov=Yt({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();function sK(n,e){if(1&n&&(Ae(0,"option",8),it(1),xe()),2&n){const t=e.$implicit;Kt("value",t.nombre_region),Et(1),Qs(t.numero+"-"+t.nombre_region)}}function oK(n,e){if(1&n&&(Ae(0,"option",8),it(1),xe()),2&n){const t=e.$implicit;Kt("value",t),Et(1),Qs(t)}}let aK=(()=>{class n{constructor(t,i,r){this.RegionService=t,this.router=i,this.RoomService=r,this.comunasOptions=[],this.selectedRegion="",this.selectedComuna="",this.selectedTipoVivienda=""}ngOnInit(){this.getRegions()}getRegions(){this.RegionService.getRegions().subscribe(t=>{this.RegionService.regions=t})}onRegionSelected(t){this.selectedRegion=t.target.value;const i=this.RegionService.regions.find(r=>r.nombre_region===this.selectedRegion);this.comunasOptions=i?i.comunas.map(r=>r.nombre_comuna):[]}onComunaSelected(t){this.selectedComuna=t.target.value}onTipoViviendaSelected(t){this.selectedTipoVivienda=t.target.value}buscar(){this.RoomService.getRoomByFilter({region:this.selectedRegion,comuna:this.selectedComuna,casa_depto:this.selectedTipoVivienda}).subscribe(i=>{this.RoomService.rooms=i,this.router.navigate(["/results"]),console.log(this.RoomService.rooms)},i=>{console.error("Error al obtener los resultados de b\xfasqueda:",i)})}getRoomByFilterFront(t){this.RoomService.getRoomByFilter(t).subscribe(i=>{this.RoomService.rooms=i})}}return n.\u0275fac=function(t){return new(t||n)(Ie(_z),Ie(qs),Ie(Iv))},n.\u0275cmp=Qn({type:n,selectors:[["app-searcher"]],decls:19,vars:5,consts:[[1,"container"],[1,"select-group"],[1,"form-select",3,"ngModel","ngModelChange","change"],["value","","disabled","","selected","",1,"start-input-text"],[3,"value",4,"ngFor","ngForOf"],["value","depto"],["value","casa"],["type","button",1,"btn","btn-primary",3,"click"],[3,"value"]],template:function(t,i){1&t&&(Ae(0,"div",0)(1,"div",1)(2,"select",2),gi("ngModelChange",function(s){return i.selectedRegion=s})("change",function(s){return i.onRegionSelected(s)}),Ae(3,"option",3),it(4,"Seleccione una regi\xf3n"),xe(),Di(5,sK,2,2,"option",4),xe(),Ae(6,"select",2),gi("ngModelChange",function(s){return i.selectedComuna=s})("change",function(s){return i.onComunaSelected(s)}),Ae(7,"option",3),it(8,"Seleccione una comuna"),xe(),Di(9,oK,2,2,"option",4),xe(),Ae(10,"select",2),gi("ngModelChange",function(s){return i.selectedTipoVivienda=s})("change",function(s){return i.onTipoViviendaSelected(s)}),Ae(11,"option",3),it(12,"Seleccione un tipo de vivienda"),xe(),Ae(13,"option",5),it(14,"Departamento"),xe(),Ae(15,"option",6),it(16,"Casa"),xe()(),Ae(17,"button",7),gi("click",function(){return i.buscar()}),it(18,"Buscar"),xe()()()),2&t&&(Et(2),Kt("ngModel",i.selectedRegion),Et(3),Kt("ngForOf",i.RegionService.regions),Et(1),Kt("ngModel",i.selectedComuna),Et(3),Kt("ngForOf",i.comunasOptions),Et(1),Kt("ngModel",i.selectedTipoVivienda))},dependencies:[hp,VN,HN,NC,YA,OC],styles:[".container[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;border-radius:10px;max-width:80%;width:80%;height:20%;padding:0 20px;margin:20px auto;background-color:#fff;box-shadow:0 0 15px #0000004d}.select-group[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;width:100%}.form-select[_ngcontent-%COMP%], .btn[_ngcontent-%COMP%]{margin-right:15px}.start-input-text[_ngcontent-%COMP%]{text-decoration-color:#0ff}@media (max-width: 576px){.select-group[_ngcontent-%COMP%]{flex-direction:column;gap:7%}.btn[_ngcontent-%COMP%]{width:100%}}@media (min-width: 576px) and (max-width: 767.98px){.select-group[_ngcontent-%COMP%]{flex-direction:column;gap:7%}.btn[_ngcontent-%COMP%]{width:100%}}@media (min-width: 768px) and (max-width: 991.98px){.select-group[_ngcontent-%COMP%]{flex-direction:row}.container[_ngcontent-%COMP%]{height:10%}}@media (min-width: 992px) and (max-width: 1199.98px){.container[_ngcontent-%COMP%]{height:15%}}"]}),n})(),lK=(()=>{class n{constructor(){}ngOnInit(){const t=document.getElementById("carouselExample");new bootstrap.Carousel(t)}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275cmp=Qn({type:n,selectors:[["app-index-carrousel"]],decls:13,vars:0,consts:[["id","carouselExample","data-bs-ride","carousel",1,"carousel","slide"],[1,"carousel-inner"],[1,"carousel-item","active",2,"background-image","url('../assets/banner-images/hola.png')"],[1,"carousel-item",2,"background-image","url('../assets/banner-images/6271048.jpg')"],[1,"carousel-item",2,"background-image","url('../assets/banner-images/8047828.jpg')"],["type","button","data-bs-target","#carouselExample","data-bs-slide","prev",1,"carousel-control-prev"],["aria-hidden","true",1,"carousel-control-prev-icon"],[1,"visually-hidden"],["type","button","data-bs-target","#carouselExample","data-bs-slide","next",1,"carousel-control-next"],["aria-hidden","true",1,"carousel-control-next-icon"]],template:function(t,i){1&t&&(Ae(0,"div",0)(1,"div",1),jt(2,"div",2)(3,"div",3)(4,"div",4),Ae(5,"button",5),jt(6,"span",6),Ae(7,"span",7),it(8,"Anterior"),xe()(),Ae(9,"button",8),jt(10,"span",9),Ae(11,"span",7),it(12,"Siguiente"),xe()()()())},styles:[".carousel[_ngcontent-%COMP%]{height:30vh;width:100%;margin:0 auto;position:relative}.carousel-inner[_ngcontent-%COMP%]{height:100%;width:100%}.carousel-item[_ngcontent-%COMP%]{width:100%;height:100%;background-size:cover}.image-banner[_ngcontent-%COMP%]{width:100%;height:auto;object-fit:cover;object-position:center;position:relative}.carousel-control-prev[_ngcontent-%COMP%], .carousel-control-next[_ngcontent-%COMP%]{width:5%;background-color:#00000080;opacity:.5;transition:opacity .3s ease;top:50%;transform:translateY(-50%);transform-origin:center}.carousel-control-prev[_ngcontent-%COMP%]:hover, .carousel-control-next[_ngcontent-%COMP%]:hover{opacity:1}.carousel-control-prev-icon[_ngcontent-%COMP%], .carousel-control-next-icon[_ngcontent-%COMP%]{color:#fff}.carousel-indicators[_ngcontent-%COMP%]{bottom:10px}.carousel-indicators[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{background-color:#00000080;border-color:#00000080}.carousel-indicators[_ngcontent-%COMP%]   .active[_ngcontent-%COMP%]{background-color:#000;border-color:#000}@media (max-width: 575.98px){.carousel[_ngcontent-%COMP%]{height:15%}}@media (min-width: 576px) and (max-width: 767.98px){.carousel[_ngcontent-%COMP%]{height:20%}}@media (min-width: 768px) and (max-width: 991.98px){.carousel[_ngcontent-%COMP%]{height:25%}}@media (min-width: 992px){.carousel[_ngcontent-%COMP%]{height:50%}}"]}),n})(),yz=(()=>{class n{constructor(){}ngOnInit(){}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275cmp=Qn({type:n,selectors:[["app-footer"]],decls:9,vars:0,consts:[[1,"footer"],[1,"container"],[1,"row"],[1,"col"],[1,"d-flex","align-items-center"],[1,"btn","btn-transparent"]],template:function(t,i){1&t&&(Ae(0,"footer",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"div",4)(5,"button",5),it(6,"Terminos y condiciones"),xe(),Ae(7,"button",5),it(8,"Privacidad"),xe()()()()()())},styles:[".footer[_ngcontent-%COMP%]{position:fixed;bottom:0;left:0;width:100%;background-color:transparent;border-top:1px solid #ccc;padding:5px 0}.btn-transparent[_ngcontent-%COMP%]{background-color:transparent;border:none;color:#333;margin-right:10px;font-size:11px}.btn-transparent[_ngcontent-%COMP%]:focus, .btn-transparent[_ngcontent-%COMP%]:hover{color:#090909}"]}),n})(),cK=(()=>{class n{constructor(){}ngOnInit(){}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275cmp=Qn({type:n,selectors:[["app-index-component"]],decls:5,vars:0,template:function(t,i){1&t&&(Ae(0,"body"),jt(1,"app-toolbar")(2,"app-index-carrousel")(3,"app-searcher")(4,"app-footer"),xe())},dependencies:[cS,aK,lK,yz],styles:[".salto-linea[_ngcontent-%COMP%]{font-size:0;display:block}.image-slider[_ngcontent-%COMP%]{width:100%}body[_ngcontent-%COMP%]{background-color:#f1ece7}"]}),n})(),uK=(()=>{class n{constructor(t,i,r){this.activaterouter=t,this.router=i,this.roomService=r,this.room=null}ngOnInit(){this.activaterouter.snapshot.paramMap.get("id")}goToRoom(t){this.roomService.selectedRoom=this.room,this.router.navigateByUrl("/room/"+t)}}return n.\u0275fac=function(t){return new(t||n)(Ie(md),Ie(qs),Ie(Iv))},n.\u0275cmp=Qn({type:n,selectors:[["app-card-room"]],inputs:{room:"room"},decls:23,vars:12,consts:[[1,"card","mb-3"],[1,"row","g-0"],[1,"col-md-4","image-container"],["alt","...",1,"img-fluid","rounded-start",3,"src"],[1,"col-md-8"],[1,"card-body"],[1,"card-title"],[1,"precio-text"],[1,"card-text"],[1,"footer-container","row","justify-content-between"],[1,"col-4"],[1,"text-muted"],[1,"col-4","button-container"],["type","button",1,"btn","btn-light",3,"click"]],template:function(t,i){1&t&&(Ae(0,"div",0)(1,"div",1)(2,"div",2),jt(3,"img",3),xe(),Ae(4,"div",4)(5,"div",5)(6,"h4",6),it(7),xe(),Ae(8,"h5"),it(9),xe(),Ae(10,"h5",7),it(11),xe(),Ae(12,"p",8),it(13),xe(),Ae(14,"div",9)(15,"div",10)(16,"p",8)(17,"small",11),it(18),dD(19,"date"),xe()()(),Ae(20,"div",12)(21,"button",13),gi("click",function(){return i.goToRoom(i.room._id)}),it(22,"Ver"),xe()()()()()()()),2&t&&(Et(3),JT("src",i.room.url_image_cover,fy),Et(4),MM("",i.room.ciudad,"",", ","",i.room.comuna,"",", ","",i.room.calle,""),Et(2),Vo(" ",i.room.region," "),Et(2),Vo(" ",i.room.precio," "),Et(2),Vo(" ",i.room.descripcion," "),Et(5),Qs(hD(19,10,i.room.fecha_publicacion)))},dependencies:[YD],styles:[".precio-text[_ngcontent-%COMP%], .card-title[_ngcontent-%COMP%]{font-weight:700}.button-container[_ngcontent-%COMP%]{display:flex;align-items:flex-end;justify-content:flex-end}.image-container[_ngcontent-%COMP%]{padding:20px}"]}),n})();const dK=["sliderWrapper"],hu=cv({passive:!1}),gK={provide:Yl,useExisting:Ai(()=>vz),multi:!0};class _K{}const yK=fC(pC(hC(class{constructor(n){this._elementRef=n}}),"accent"));let vz=(()=>{class n extends yK{constructor(t,i,r,s,c,d,m,y){super(t),this._focusMonitor=i,this._changeDetectorRef=r,this._dir=s,this._ngZone=d,this._animationMode=y,this._invert=!1,this._max=100,this._min=0,this._step=1,this._thumbLabel=!1,this._tickInterval=0,this._value=null,this._vertical=!1,this.change=new Dn,this.input=new Dn,this.valueChange=new Dn,this.onTouched=()=>{},this._percent=0,this._isSliding=null,this._isActive=!1,this._tickIntervalPercent=0,this._sliderDimensions=null,this._controlValueAccessorChangeFn=()=>{},this._dirChangeSubscription=lt.EMPTY,this._pointerDown=w=>{this.disabled||this._isSliding||!sw(w)&&0!==w.button||this._ngZone.run(()=>{this._touchId=sw(w)?function vK(n,e){for(let t=0;t<n.touches.length;t++){const i=n.touches[t].target;if(e===i||e.contains(i))return n.touches[t].identifier}}(w,this._elementRef.nativeElement):void 0;const S=bz(w,this._touchId);if(S){const T=this.value;this._isSliding="pointer",this._lastPointerEvent=w,this._focusHostElement(),this._onMouseenter(),this._bindGlobalEvents(w),this._focusHostElement(),this._updateValueFromPosition(S),this._valueOnSlideStart=T,w.cancelable&&w.preventDefault(),T!=this.value&&this._emitInputEvent()}})},this._pointerMove=w=>{if("pointer"===this._isSliding){const S=bz(w,this._touchId);if(S){w.cancelable&&w.preventDefault();const T=this.value;this._lastPointerEvent=w,this._updateValueFromPosition(S),T!=this.value&&this._emitInputEvent()}}},this._pointerUp=w=>{"pointer"===this._isSliding&&(!sw(w)||"number"!=typeof this._touchId||UI(w.changedTouches,this._touchId))&&(w.cancelable&&w.preventDefault(),this._removeGlobalEvents(),this._isSliding=null,this._touchId=void 0,this._valueOnSlideStart!=this.value&&!this.disabled&&this._emitChangeEvent(),this._valueOnSlideStart=this._lastPointerEvent=null)},this._windowBlur=()=>{this._lastPointerEvent&&this._pointerUp(this._lastPointerEvent)},this._document=m,this.tabIndex=parseInt(c)||0,d.runOutsideAngular(()=>{const w=t.nativeElement;w.addEventListener("mousedown",this._pointerDown,hu),w.addEventListener("touchstart",this._pointerDown,hu)})}get invert(){return this._invert}set invert(t){this._invert=Kr(t)}get max(){return this._max}set max(t){this._max=Jf(t,this._max),this._percent=this._calculatePercentage(this._value),this._changeDetectorRef.markForCheck()}get min(){return this._min}set min(t){this._min=Jf(t,this._min),this._percent=this._calculatePercentage(this._value),this._changeDetectorRef.markForCheck()}get step(){return this._step}set step(t){this._step=Jf(t,this._step),this._step%1!=0&&(this._roundToDecimal=this._step.toString().split(".").pop().length),this._changeDetectorRef.markForCheck()}get thumbLabel(){return this._thumbLabel}set thumbLabel(t){this._thumbLabel=Kr(t)}get tickInterval(){return this._tickInterval}set tickInterval(t){this._tickInterval="auto"===t?"auto":"number"==typeof t||"string"==typeof t?Jf(t,this._tickInterval):0}get value(){return null===this._value&&(this.value=this._min),this._value}set value(t){if(t!==this._value){let i=Jf(t,0);this._roundToDecimal&&i!==this.min&&i!==this.max&&(i=parseFloat(i.toFixed(this._roundToDecimal))),this._value=i,this._percent=this._calculatePercentage(this._value),this._changeDetectorRef.markForCheck()}}get vertical(){return this._vertical}set vertical(t){this._vertical=Kr(t)}get displayValue(){return this.displayWith?this.displayWith(this.value):this._roundToDecimal&&this.value&&this.value%1!=0?this.value.toFixed(this._roundToDecimal):this.value||0}focus(t){this._focusHostElement(t)}blur(){this._blurHostElement()}get percent(){return this._clamp(this._percent)}_shouldInvertAxis(){return this.vertical?!this.invert:this.invert}_isMinValue(){return 0===this.percent}_getThumbGap(){return this.disabled?7:this._isMinValue()&&!this.thumbLabel?this._isActive?10:7:0}_getTrackBackgroundStyles(){const i=this.vertical?`1, ${1-this.percent}, 1`:1-this.percent+", 1, 1";return{transform:`translate${this.vertical?"Y":"X"}(${this._shouldInvertMouseCoords()?"-":""}${this._getThumbGap()}px) scale3d(${i})`}}_getTrackFillStyles(){const t=this.percent,r=this.vertical?`1, ${t}, 1`:`${t}, 1, 1`;return{transform:`translate${this.vertical?"Y":"X"}(${this._shouldInvertMouseCoords()?"":"-"}${this._getThumbGap()}px) scale3d(${r})`,display:0===t?"none":""}}_getTicksContainerStyles(){return{transform:`translate${this.vertical?"Y":"X"}(${this.vertical||"rtl"!=this._getDirection()?"-":""}${this._tickIntervalPercent/2*100}%)`}}_getTicksStyles(){let t=100*this._tickIntervalPercent,d={backgroundSize:this.vertical?`2px ${t}%`:`${t}% 2px`,transform:`translateZ(0) translate${this.vertical?"Y":"X"}(${this.vertical||"rtl"!=this._getDirection()?"":"-"}${t/2}%)${this.vertical||"rtl"!=this._getDirection()?"":" rotate(180deg)"}`};if(this._isMinValue()&&this._getThumbGap()){const m=this._shouldInvertAxis();let y;y=this.vertical?m?"Bottom":"Top":m?"Right":"Left",d[`padding${y}`]=`${this._getThumbGap()}px`}return d}_getThumbContainerStyles(){const t=this._shouldInvertAxis();return{transform:`translate${this.vertical?"Y":"X"}(-${100*(("rtl"!=this._getDirection()||this.vertical?t:!t)?this.percent:1-this.percent)}%)`}}_shouldInvertMouseCoords(){const t=this._shouldInvertAxis();return"rtl"!=this._getDirection()||this.vertical?t:!t}_getDirection(){return this._dir&&"rtl"==this._dir.value?"rtl":"ltr"}ngAfterViewInit(){this._focusMonitor.monitor(this._elementRef,!0).subscribe(t=>{this._isActive=!!t&&"keyboard"!==t,this._changeDetectorRef.detectChanges()}),this._dir&&(this._dirChangeSubscription=this._dir.change.subscribe(()=>{this._changeDetectorRef.markForCheck()}))}ngOnDestroy(){const t=this._elementRef.nativeElement;t.removeEventListener("mousedown",this._pointerDown,hu),t.removeEventListener("touchstart",this._pointerDown,hu),this._lastPointerEvent=null,this._removeGlobalEvents(),this._focusMonitor.stopMonitoring(this._elementRef),this._dirChangeSubscription.unsubscribe()}_onMouseenter(){this.disabled||(this._sliderDimensions=this._getSliderDimensions(),this._updateTickIntervalPercent())}_onFocus(){this._sliderDimensions=this._getSliderDimensions(),this._updateTickIntervalPercent()}_onBlur(){this.onTouched()}_onKeydown(t){if(this.disabled||th(t)||this._isSliding&&"keyboard"!==this._isSliding)return;const i=this.value;switch(t.keyCode){case 33:this._increment(10);break;case 34:this._increment(-10);break;case 35:this.value=this.max;break;case 36:this.value=this.min;break;case 37:this._increment("rtl"==this._getDirection()?1:-1);break;case 38:this._increment(1);break;case 39:this._increment("rtl"==this._getDirection()?-1:1);break;case 40:this._increment(-1);break;default:return}i!=this.value&&(this._emitInputEvent(),this._emitChangeEvent()),this._isSliding="keyboard",t.preventDefault()}_onKeyup(){"keyboard"===this._isSliding&&(this._isSliding=null)}_getWindow(){return this._document.defaultView||window}_bindGlobalEvents(t){const i=this._document,r=sw(t),c=r?"touchend":"mouseup";i.addEventListener(r?"touchmove":"mousemove",this._pointerMove,hu),i.addEventListener(c,this._pointerUp,hu),r&&i.addEventListener("touchcancel",this._pointerUp,hu);const d=this._getWindow();typeof d<"u"&&d&&d.addEventListener("blur",this._windowBlur)}_removeGlobalEvents(){const t=this._document;t.removeEventListener("mousemove",this._pointerMove,hu),t.removeEventListener("mouseup",this._pointerUp,hu),t.removeEventListener("touchmove",this._pointerMove,hu),t.removeEventListener("touchend",this._pointerUp,hu),t.removeEventListener("touchcancel",this._pointerUp,hu);const i=this._getWindow();typeof i<"u"&&i&&i.removeEventListener("blur",this._windowBlur)}_increment(t){const i=this._clamp(this.value||0,this.min,this.max);this.value=this._clamp(i+this.step*t,this.min,this.max)}_updateValueFromPosition(t){if(!this._sliderDimensions)return;let c=this._clamp(((this.vertical?t.y:t.x)-(this.vertical?this._sliderDimensions.top:this._sliderDimensions.left))/(this.vertical?this._sliderDimensions.height:this._sliderDimensions.width));if(this._shouldInvertMouseCoords()&&(c=1-c),0===c)this.value=this.min;else if(1===c)this.value=this.max;else{const d=this._calculateValue(c),m=Math.round((d-this.min)/this.step)*this.step+this.min;this.value=this._clamp(m,this.min,this.max)}}_emitChangeEvent(){this._controlValueAccessorChangeFn(this.value),this.valueChange.emit(this.value),this.change.emit(this._createChangeEvent())}_emitInputEvent(){this.input.emit(this._createChangeEvent())}_updateTickIntervalPercent(){if(!this.tickInterval||!this._sliderDimensions)return;let t;if("auto"==this.tickInterval){let i=this.vertical?this._sliderDimensions.height:this._sliderDimensions.width;t=Math.ceil(30/(i*this.step/(this.max-this.min)))*this.step/i}else t=this.tickInterval*this.step/(this.max-this.min);this._tickIntervalPercent=xz(t)?t:0}_createChangeEvent(t=this.value){let i=new _K;return i.source=this,i.value=t,i}_calculatePercentage(t){const i=((t||0)-this.min)/(this.max-this.min);return xz(i)?i:0}_calculateValue(t){return this.min+t*(this.max-this.min)}_clamp(t,i=0,r=1){return Math.max(i,Math.min(t,r))}_getSliderDimensions(){return this._sliderWrapper?this._sliderWrapper.nativeElement.getBoundingClientRect():null}_focusHostElement(t){this._elementRef.nativeElement.focus(t)}_blurHostElement(){this._elementRef.nativeElement.blur()}writeValue(t){this.value=t}registerOnChange(t){this._controlValueAccessorChangeFn=t}registerOnTouched(t){this.onTouched=t}setDisabledState(t){this.disabled=t}}return n.\u0275fac=function(t){return new(t||n)(Ie(wr),Ie(fv),Ie(Ho),Ie(em,8),ns("tabindex"),Ie(nr),Ie(Vi),Ie(ru,8))},n.\u0275cmp=Qn({type:n,selectors:[["mat-slider"]],viewQuery:function(t,i){if(1&t&&Uo(dK,5),2&t){let r;Gi(r=ji())&&(i._sliderWrapper=r.first)}},hostAttrs:["role","slider",1,"mat-slider","mat-focus-indicator"],hostVars:29,hostBindings:function(t,i){1&t&&gi("focus",function(){return i._onFocus()})("blur",function(){return i._onBlur()})("keydown",function(s){return i._onKeydown(s)})("keyup",function(){return i._onKeyup()})("mouseenter",function(){return i._onMouseenter()})("selectstart",function(s){return s.preventDefault()}),2&t&&(ev("tabIndex",i.tabIndex),tr("aria-disabled",i.disabled)("aria-valuemax",i.max)("aria-valuemin",i.min)("aria-valuenow",i.value)("aria-valuetext",i.valueText??i.displayValue)("aria-orientation",i.vertical?"vertical":"horizontal"),ds("mat-slider-disabled",i.disabled)("mat-slider-has-ticks",i.tickInterval)("mat-slider-horizontal",!i.vertical)("mat-slider-axis-inverted",i._shouldInvertAxis())("mat-slider-invert-mouse-coords",i._shouldInvertMouseCoords())("mat-slider-sliding",i._isSliding)("mat-slider-thumb-label-showing",i.thumbLabel)("mat-slider-vertical",i.vertical)("mat-slider-min-value",i._isMinValue())("mat-slider-hide-last-tick",i.disabled||i._isMinValue()&&i._getThumbGap()&&i._shouldInvertAxis())("_mat-animation-noopable","NoopAnimations"===i._animationMode))},inputs:{disabled:"disabled",color:"color",tabIndex:"tabIndex",invert:"invert",max:"max",min:"min",step:"step",thumbLabel:"thumbLabel",tickInterval:"tickInterval",value:"value",displayWith:"displayWith",valueText:"valueText",vertical:"vertical"},outputs:{change:"change",input:"input",valueChange:"valueChange"},exportAs:["matSlider"],features:[hr([gK]),dn],decls:13,vars:6,consts:[[1,"mat-slider-wrapper"],["sliderWrapper",""],[1,"mat-slider-track-wrapper"],[1,"mat-slider-track-background",3,"ngStyle"],[1,"mat-slider-track-fill",3,"ngStyle"],[1,"mat-slider-ticks-container",3,"ngStyle"],[1,"mat-slider-ticks",3,"ngStyle"],[1,"mat-slider-thumb-container",3,"ngStyle"],[1,"mat-slider-focus-ring"],[1,"mat-slider-thumb"],[1,"mat-slider-thumb-label"],[1,"mat-slider-thumb-label-text"]],template:function(t,i){1&t&&(Ae(0,"div",0,1)(2,"div",2),jt(3,"div",3)(4,"div",4),xe(),Ae(5,"div",5),jt(6,"div",6),xe(),Ae(7,"div",7),jt(8,"div",8)(9,"div",9),Ae(10,"div",10)(11,"span",11),it(12),xe()()()()),2&t&&(Et(3),Kt("ngStyle",i._getTrackBackgroundStyles()),Et(1),Kt("ngStyle",i._getTrackFillStyles()),Et(1),Kt("ngStyle",i._getTicksContainerStyles()),Et(1),Kt("ngStyle",i._getTicksStyles()),Et(1),Kt("ngStyle",i._getThumbContainerStyles()),Et(5),Qs(i.displayValue))},dependencies:[kO],styles:['.mat-slider{display:inline-block;position:relative;box-sizing:border-box;padding:8px;outline:none;vertical-align:middle}.mat-slider:not(.mat-slider-disabled):active,.mat-slider.mat-slider-sliding:not(.mat-slider-disabled){cursor:grabbing}.mat-slider-wrapper{-webkit-print-color-adjust:exact;color-adjust:exact;position:absolute}.mat-slider-track-wrapper{position:absolute;top:0;left:0;overflow:hidden}.mat-slider-track-fill{position:absolute;transform-origin:0 0;transition:transform 400ms cubic-bezier(0.25, 0.8, 0.25, 1),background-color 400ms cubic-bezier(0.25, 0.8, 0.25, 1)}.mat-slider-track-background{position:absolute;transform-origin:100% 100%;transition:transform 400ms cubic-bezier(0.25, 0.8, 0.25, 1),background-color 400ms cubic-bezier(0.25, 0.8, 0.25, 1)}.mat-slider-ticks-container{position:absolute;left:0;top:0;overflow:hidden}.mat-slider-ticks{-webkit-background-clip:content-box;background-clip:content-box;background-repeat:repeat;box-sizing:border-box;opacity:0;transition:opacity 400ms cubic-bezier(0.25, 0.8, 0.25, 1)}.mat-slider-thumb-container{position:absolute;z-index:1;transition:transform 400ms cubic-bezier(0.25, 0.8, 0.25, 1)}.mat-slider-focus-ring{position:absolute;width:30px;height:30px;border-radius:50%;transform:scale(0);opacity:0;transition:transform 400ms cubic-bezier(0.25, 0.8, 0.25, 1),background-color 400ms cubic-bezier(0.25, 0.8, 0.25, 1),opacity 400ms cubic-bezier(0.25, 0.8, 0.25, 1)}.mat-slider.cdk-keyboard-focused .mat-slider-focus-ring,.mat-slider.cdk-program-focused .mat-slider-focus-ring{transform:scale(1);opacity:1}.mat-slider:not(.mat-slider-disabled):not(.mat-slider-sliding) .mat-slider-thumb-label,.mat-slider:not(.mat-slider-disabled):not(.mat-slider-sliding) .mat-slider-thumb{cursor:grab}.mat-slider-thumb{position:absolute;right:-10px;bottom:-10px;box-sizing:border-box;width:20px;height:20px;border:3px solid rgba(0,0,0,0);border-radius:50%;transform:scale(0.7);transition:transform 400ms cubic-bezier(0.25, 0.8, 0.25, 1),background-color 400ms cubic-bezier(0.25, 0.8, 0.25, 1),border-color 400ms cubic-bezier(0.25, 0.8, 0.25, 1)}.mat-slider-thumb-label{display:none;align-items:center;justify-content:center;position:absolute;width:28px;height:28px;border-radius:50%;transition:transform 400ms cubic-bezier(0.25, 0.8, 0.25, 1),border-radius 400ms cubic-bezier(0.25, 0.8, 0.25, 1),background-color 400ms cubic-bezier(0.25, 0.8, 0.25, 1)}.cdk-high-contrast-active .mat-slider-thumb-label{outline:solid 1px}.mat-slider-thumb-label-text{z-index:1;opacity:0;transition:opacity 400ms cubic-bezier(0.25, 0.8, 0.25, 1)}.mat-slider-sliding .mat-slider-track-fill,.mat-slider-sliding .mat-slider-track-background,.mat-slider-sliding .mat-slider-thumb-container{transition-duration:0ms}.mat-slider-has-ticks .mat-slider-wrapper::after{content:"";position:absolute;border-width:0;border-style:solid;opacity:0;transition:opacity 400ms cubic-bezier(0.25, 0.8, 0.25, 1)}.mat-slider-has-ticks.cdk-focused:not(.mat-slider-hide-last-tick) .mat-slider-wrapper::after,.mat-slider-has-ticks:hover:not(.mat-slider-hide-last-tick) .mat-slider-wrapper::after{opacity:1}.mat-slider-has-ticks.cdk-focused:not(.mat-slider-disabled) .mat-slider-ticks,.mat-slider-has-ticks:hover:not(.mat-slider-disabled) .mat-slider-ticks{opacity:1}.mat-slider-thumb-label-showing .mat-slider-focus-ring{display:none}.mat-slider-thumb-label-showing .mat-slider-thumb-label{display:flex}.mat-slider-axis-inverted .mat-slider-track-fill{transform-origin:100% 100%}.mat-slider-axis-inverted .mat-slider-track-background{transform-origin:0 0}.mat-slider:not(.mat-slider-disabled).cdk-focused.mat-slider-thumb-label-showing .mat-slider-thumb{transform:scale(0)}.mat-slider:not(.mat-slider-disabled).cdk-focused .mat-slider-thumb-label{border-radius:50% 50% 0}.mat-slider:not(.mat-slider-disabled).cdk-focused .mat-slider-thumb-label-text{opacity:1}.mat-slider:not(.mat-slider-disabled).cdk-mouse-focused .mat-slider-thumb,.mat-slider:not(.mat-slider-disabled).cdk-touch-focused .mat-slider-thumb,.mat-slider:not(.mat-slider-disabled).cdk-program-focused .mat-slider-thumb{border-width:2px;transform:scale(1)}.mat-slider-disabled .mat-slider-focus-ring{transform:scale(0);opacity:0}.mat-slider-disabled .mat-slider-thumb{border-width:4px;transform:scale(0.5)}.mat-slider-disabled .mat-slider-thumb-label{display:none}.mat-slider-horizontal{height:48px;min-width:128px}.mat-slider-horizontal .mat-slider-wrapper{height:2px;top:23px;left:8px;right:8px}.mat-slider-horizontal .mat-slider-wrapper::after{height:2px;border-left-width:2px;right:0;top:0}.mat-slider-horizontal .mat-slider-track-wrapper{height:2px;width:100%}.mat-slider-horizontal .mat-slider-track-fill{height:2px;width:100%;transform:scaleX(0)}.mat-slider-horizontal .mat-slider-track-background{height:2px;width:100%;transform:scaleX(1)}.mat-slider-horizontal .mat-slider-ticks-container{height:2px;width:100%}.cdk-high-contrast-active .mat-slider-horizontal .mat-slider-ticks-container{height:0;outline:solid 2px;top:1px}.mat-slider-horizontal .mat-slider-ticks{height:2px;width:100%}.mat-slider-horizontal .mat-slider-thumb-container{width:100%;height:0;top:50%}.mat-slider-horizontal .mat-slider-focus-ring{top:-15px;right:-15px}.mat-slider-horizontal .mat-slider-thumb-label{right:-14px;top:-40px;transform:translateY(26px) scale(0.01) rotate(45deg)}.mat-slider-horizontal .mat-slider-thumb-label-text{transform:rotate(-45deg)}.mat-slider-horizontal.cdk-focused .mat-slider-thumb-label{transform:rotate(45deg)}.cdk-high-contrast-active .mat-slider-horizontal.cdk-focused .mat-slider-thumb-label,.cdk-high-contrast-active .mat-slider-horizontal.cdk-focused .mat-slider-thumb-label-text{transform:none}.mat-slider-vertical{width:48px;min-height:128px}.mat-slider-vertical .mat-slider-wrapper{width:2px;top:8px;bottom:8px;left:23px}.mat-slider-vertical .mat-slider-wrapper::after{width:2px;border-top-width:2px;bottom:0;left:0}.mat-slider-vertical .mat-slider-track-wrapper{height:100%;width:2px}.mat-slider-vertical .mat-slider-track-fill{height:100%;width:2px;transform:scaleY(0)}.mat-slider-vertical .mat-slider-track-background{height:100%;width:2px;transform:scaleY(1)}.mat-slider-vertical .mat-slider-ticks-container{width:2px;height:100%}.cdk-high-contrast-active .mat-slider-vertical .mat-slider-ticks-container{width:0;outline:solid 2px;left:1px}.mat-slider-vertical .mat-slider-focus-ring{bottom:-15px;left:-15px}.mat-slider-vertical .mat-slider-ticks{width:2px;height:100%}.mat-slider-vertical .mat-slider-thumb-container{height:100%;width:0;left:50%}.mat-slider-vertical .mat-slider-thumb{-webkit-backface-visibility:hidden;backface-visibility:hidden}.mat-slider-vertical .mat-slider-thumb-label{bottom:-14px;left:-40px;transform:translateX(26px) scale(0.01) rotate(-45deg)}.mat-slider-vertical .mat-slider-thumb-label-text{transform:rotate(45deg)}.mat-slider-vertical.cdk-focused .mat-slider-thumb-label{transform:rotate(-45deg)}[dir=rtl] .mat-slider-wrapper::after{left:0;right:auto}[dir=rtl] .mat-slider-horizontal .mat-slider-track-fill{transform-origin:100% 100%}[dir=rtl] .mat-slider-horizontal .mat-slider-track-background{transform-origin:0 0}[dir=rtl] .mat-slider-horizontal.mat-slider-axis-inverted .mat-slider-track-fill{transform-origin:0 0}[dir=rtl] .mat-slider-horizontal.mat-slider-axis-inverted .mat-slider-track-background{transform-origin:100% 100%}.mat-slider._mat-animation-noopable .mat-slider-track-fill,.mat-slider._mat-animation-noopable .mat-slider-track-background,.mat-slider._mat-animation-noopable .mat-slider-ticks,.mat-slider._mat-animation-noopable .mat-slider-thumb-container,.mat-slider._mat-animation-noopable .mat-slider-focus-ring,.mat-slider._mat-animation-noopable .mat-slider-thumb,.mat-slider._mat-animation-noopable .mat-slider-thumb-label,.mat-slider._mat-animation-noopable .mat-slider-thumb-label-text,.mat-slider._mat-animation-noopable .mat-slider-has-ticks .mat-slider-wrapper::after{transition:none}'],encapsulation:2,changeDetection:0}),n})();function xz(n){return!isNaN(n)&&isFinite(n)}function sw(n){return"t"===n.type[0]}function bz(n,e){let t;return t=sw(n)?"number"==typeof e?UI(n.touches,e)||UI(n.changedTouches,e):n.touches[0]||n.changedTouches[0]:n,t?{x:t.clientX,y:t.clientY}:void 0}function UI(n,e){for(let t=0;t<n.length;t++)if(n[t].identifier===e)return n[t]}let xK=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=Gn({type:n}),n.\u0275inj=Bn({imports:[au,Ki,Ki]}),n})();function bK(n,e){if(1&n&&(Ae(0,"mat-option",9),it(1),xe()),2&n){const t=e.$implicit;Kt("value",t),Et(1),Vo(" ",t.nombre_region," ")}}function wK(n,e){if(1&n&&(Ae(0,"mat-option",9),it(1),xe()),2&n){const t=e.$implicit;Kt("value",t),Et(1),Vo(" ",t," ")}}let MK=(()=>{class n{constructor(t){this.RegionService=t,this.filteredContent=[],this.regiones=[],this.originalContent=[],this.comunas=[]}ngOnInit(){}getRegions(){}onRegionSelected(t){}onComunaSelected(t){}applyFilter(){}}return n.\u0275fac=function(t){return new(t||n)(Ie(_z))},n.\u0275cmp=Qn({type:n,selectors:[["app-filter-result"]],decls:30,vars:4,consts:[[1,"container"],[1,"mat-card-container"],[1,"filter-element-container"],["min","200","max","500"],["value","10","matSliderStartThumb",""],["value","","matSliderEndThumb",""],["appearance","fill"],[3,"ngModel","ngModelChange","selectionChange"],[3,"value",4,"ngFor","ngForOf"],[3,"value"]],template:function(t,i){1&t&&(Ae(0,"div",0)(1,"mat-card",1)(2,"mat-card-title"),it(3,"Filtro"),xe(),Ae(4,"div",2)(5,"mat-card-subtitle"),it(6,"Precio"),xe(),Ae(7,"mat-slider",3),jt(8,"input",4)(9,"input",5),xe()(),Ae(10,"div",2)(11,"mat-card-subtitle"),it(12,"Ba\xf1o compartido"),xe(),jt(13,"mat-slide-toggle"),xe(),Ae(14,"div",2)(15,"mat-card-subtitle"),it(16,"Regi\xf3n"),xe(),Ae(17,"mat-form-field",6)(18,"mat-label"),it(19,"Escoge una regi\xf3n"),xe(),Ae(20,"mat-select",7),gi("ngModelChange",function(s){return i.selectedRegion=s})("selectionChange",function(s){return i.onRegionSelected(s)}),Di(21,bK,2,2,"mat-option",8),xe()()(),Ae(22,"div",2)(23,"mat-card-subtitle"),it(24,"Comuna"),xe(),Ae(25,"mat-form-field",6)(26,"mat-label"),it(27,"Escoge una Comuna"),xe(),Ae(28,"mat-select",7),gi("ngModelChange",function(s){return i.selectedComuna=s})("selectionChange",function(s){return i.onComunaSelected(s)}),Di(29,wK,2,2,"mat-option",8),xe()()()()()),2&t&&(Et(20),Kt("ngModel",i.selectedRegion),Et(1),Kt("ngForOf",i.regiones),Et(7),Kt("ngModel",i.selectedComuna),Et(1),Kt("ngForOf",i.comunas))},dependencies:[hp,zq,kA,xZ,BF,nB,MZ,CZ,YA,OC,vz,iB],styles:[".mat-card-title[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center}mat-slider[_ngcontent-%COMP%]{width:100%}.filter-element-container[_ngcontent-%COMP%]{padding:10px}"]}),n})(),CK=(()=>{class n{constructor(){this.title="",this.message=""}ngOnInit(){}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275cmp=Qn({type:n,selectors:[["app-error-view"]],inputs:{title:"title",message:"message"},decls:5,vars:2,consts:[[1,"error-message"]],template:function(t,i){1&t&&(Ae(0,"div",0)(1,"h2"),it(2),xe(),Ae(3,"p"),it(4),xe()()),2&t&&(Et(2),Qs(i.title),Et(2),Qs(i.message))},styles:[".error-message[_ngcontent-%COMP%]{border:2px solid red;border-radius:5px;background-color:#f8d7da;color:#721c24;padding:10px;margin-bottom:20px}.error-message[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin-top:0;font-size:24px}.error-message[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin-bottom:0}"]}),n})();function SK(n,e){if(1&n&&(Ae(0,"div",0),jt(1,"app-card-room",7),Ae(2,"span",8),it(3," - "),xe()()),2&n){const t=e.$implicit;Et(1),Kt("room",t)}}function EK(n,e){if(1&n&&(Ae(0,"div"),Di(1,SK,4,1,"div",6),xe()),2&n){const t=ki();Et(1),Kt("ngForOf",t.roomService.rooms)}}function TK(n,e){1&n&&jt(0,"app-error-view",9)}let DK=(()=>{class n{constructor(t,i){this.roomService=t,this.activatedRoute=i,this.isRoomServiceVoid=!1}ngOnInit(){this.isRoomServiceVoid=this.roomService.roomsIsVoid(),console.log(this.isRoomServiceVoid)}}return n.\u0275fac=function(t){return new(t||n)(Ie(Iv),Ie(md))},n.\u0275cmp=Qn({type:n,selectors:[["app-results-component"]],decls:12,vars:2,consts:[[1,"container"],[1,"row"],[1,"col-3"],[1,"col-9"],[4,"ngIf","ngIfElse"],["noRooms",""],["class","container",4,"ngFor","ngForOf"],[3,"room"],[1,"salto-linea"],["title","No se encontraron resultados","message","Pruebe con otra busqueda"]],template:function(t,i){if(1&t&&(Ae(0,"body"),jt(1,"app-toolbar"),Ae(2,"div",0)(3,"div",1)(4,"div",2),jt(5,"app-filter-result"),xe(),Ae(6,"div",3),Di(7,EK,2,1,"div",4),Di(8,TK,1,0,"ng-template",null,5,_L),xe()()()(),Ae(10,"footer"),jt(11,"app-footer"),xe()),2&t){const r=ob(9);Et(7),Kt("ngIf",!i.isRoomServiceVoid)("ngIfElse",r)}},dependencies:[hp,Yf,cS,uK,MK,CK,yz],styles:[".salto-linea[_ngcontent-%COMP%]{font-size:0;display:block}.mat-paginator[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center}"]}),n})();const AK=["mat-calendar-body",""];function IK(n,e){if(1&n&&(Ae(0,"tr",2)(1,"td",3),it(2),xe()()),2&n){const t=ki();Et(1),Eg("padding-top",t._cellPadding)("padding-bottom",t._cellPadding),tr("colspan",t.numCols),Et(1),Vo(" ",t.label," ")}}function PK(n,e){if(1&n&&(Ae(0,"td",3),it(1),xe()),2&n){const t=ki(2);Eg("padding-top",t._cellPadding)("padding-bottom",t._cellPadding),tr("colspan",t._firstRowOffset),Et(1),Vo(" ",t._firstRowOffset>=t.labelMinRequiredCells?t.label:""," ")}}function RK(n,e){if(1&n){const t=Yd();Ae(0,"td",7)(1,"button",8),gi("click",function(r){const c=As(t).$implicit;return Us(ki(2)._cellClicked(c,r))})("focus",function(r){const c=As(t).$implicit;return Us(ki(2)._emitActiveDateChange(c,r))}),Ae(2,"div",9),it(3),xe(),jt(4,"div",10),xe()()}if(2&n){const t=e.$implicit,i=e.index,r=ki().index,s=ki();Eg("width",s._cellWidth)("padding-top",s._cellPadding)("padding-bottom",s._cellPadding),tr("data-mat-row",r)("data-mat-col",i),Et(1),ds("mat-calendar-body-disabled",!t.enabled)("mat-calendar-body-active",s._isActiveCell(r,i))("mat-calendar-body-range-start",s._isRangeStart(t.compareValue))("mat-calendar-body-range-end",s._isRangeEnd(t.compareValue))("mat-calendar-body-in-range",s._isInRange(t.compareValue))("mat-calendar-body-comparison-bridge-start",s._isComparisonBridgeStart(t.compareValue,r,i))("mat-calendar-body-comparison-bridge-end",s._isComparisonBridgeEnd(t.compareValue,r,i))("mat-calendar-body-comparison-start",s._isComparisonStart(t.compareValue))("mat-calendar-body-comparison-end",s._isComparisonEnd(t.compareValue))("mat-calendar-body-in-comparison-range",s._isInComparisonRange(t.compareValue))("mat-calendar-body-preview-start",s._isPreviewStart(t.compareValue))("mat-calendar-body-preview-end",s._isPreviewEnd(t.compareValue))("mat-calendar-body-in-preview",s._isInPreview(t.compareValue)),Kt("ngClass",t.cssClasses)("tabindex",s._isActiveCell(r,i)?0:-1),tr("aria-label",t.ariaLabel)("aria-disabled",!t.enabled||null)("aria-pressed",s._isSelected(t.compareValue))("aria-current",s.todayValue===t.compareValue?"date":null),Et(1),ds("mat-calendar-body-selected",s._isSelected(t.compareValue))("mat-calendar-body-comparison-identical",s._isComparisonIdentical(t.compareValue))("mat-calendar-body-today",s.todayValue===t.compareValue),Et(1),Vo(" ",t.displayValue," ")}}function kK(n,e){if(1&n&&(Ae(0,"tr",4),Di(1,PK,2,6,"td",5),Di(2,RK,5,47,"td",6),xe()),2&n){const t=e.$implicit,i=e.index,r=ki();Et(1),Kt("ngIf",0===i&&r._firstRowOffset),Et(1),Kt("ngForOf",t)}}function LK(n,e){if(1&n&&(Ae(0,"th",5)(1,"span",6),it(2),xe(),Ae(3,"span",7),it(4),xe()()),2&n){const t=e.$implicit;Et(2),Qs(t.long),Et(2),Qs(t.narrow)}}const OK=["*"];function FK(n,e){}function NK(n,e){if(1&n){const t=Yd();Ae(0,"mat-month-view",5),gi("activeDateChange",function(r){return As(t),Us(ki().activeDate=r)})("_userSelection",function(r){return As(t),Us(ki()._dateSelected(r))}),xe()}if(2&n){const t=ki();Kt("activeDate",t.activeDate)("selected",t.selected)("dateFilter",t.dateFilter)("maxDate",t.maxDate)("minDate",t.minDate)("dateClass",t.dateClass)("comparisonStart",t.comparisonStart)("comparisonEnd",t.comparisonEnd)}}function BK(n,e){if(1&n){const t=Yd();Ae(0,"mat-year-view",6),gi("activeDateChange",function(r){return As(t),Us(ki().activeDate=r)})("monthSelected",function(r){return As(t),Us(ki()._monthSelectedInYearView(r))})("selectedChange",function(r){return As(t),Us(ki()._goToDateInView(r,"month"))}),xe()}if(2&n){const t=ki();Kt("activeDate",t.activeDate)("selected",t.selected)("dateFilter",t.dateFilter)("maxDate",t.maxDate)("minDate",t.minDate)("dateClass",t.dateClass)}}function zK(n,e){if(1&n){const t=Yd();Ae(0,"mat-multi-year-view",7),gi("activeDateChange",function(r){return As(t),Us(ki().activeDate=r)})("yearSelected",function(r){return As(t),Us(ki()._yearSelectedInMultiYearView(r))})("selectedChange",function(r){return As(t),Us(ki()._goToDateInView(r,"year"))}),xe()}if(2&n){const t=ki();Kt("activeDate",t.activeDate)("selected",t.selected)("dateFilter",t.dateFilter)("maxDate",t.maxDate)("minDate",t.minDate)("dateClass",t.dateClass)}}let HI=(()=>{class n{constructor(){this.changes=new si,this.calendarLabel="Calendar",this.openCalendarLabel="Open calendar",this.closeCalendarLabel="Close calendar",this.prevMonthLabel="Previous month",this.nextMonthLabel="Next month",this.prevYearLabel="Previous year",this.nextYearLabel="Next year",this.prevMultiYearLabel="Previous 24 years",this.nextMultiYearLabel="Next 24 years",this.switchToMonthViewLabel="Choose date",this.switchToMultiYearViewLabel="Choose month and year",this.startDateLabel="Start date",this.endDateLabel="End date"}formatYearRange(t,i){return`${t} \u2013 ${i}`}formatYearRangeLabel(t,i){return`${t} to ${i}`}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=Yt({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();class GI{constructor(e,t,i,r,s={},c=e,d){this.value=e,this.displayValue=t,this.ariaLabel=i,this.enabled=r,this.cssClasses=s,this.compareValue=c,this.rawValue=d}}let Pv=(()=>{class n{constructor(t,i){this._elementRef=t,this._ngZone=i,this._focusActiveCellAfterViewChecked=!1,this.numCols=7,this.activeCell=0,this.isRange=!1,this.cellAspectRatio=1,this.previewStart=null,this.previewEnd=null,this.selectedValueChange=new Dn,this.previewChange=new Dn,this.activeDateChange=new Dn,this._enterHandler=r=>{if(this._skipNextFocus&&"focus"===r.type)this._skipNextFocus=!1;else if(r.target&&this.isRange){const s=this._getCellFromElement(r.target);s&&this._ngZone.run(()=>this.previewChange.emit({value:s.enabled?s:null,event:r}))}},this._leaveHandler=r=>{null!==this.previewEnd&&this.isRange&&r.target&&this._getCellFromElement(r.target)&&this._ngZone.run(()=>this.previewChange.emit({value:null,event:r}))},i.runOutsideAngular(()=>{const r=t.nativeElement;r.addEventListener("mouseenter",this._enterHandler,!0),r.addEventListener("focus",this._enterHandler,!0),r.addEventListener("mouseleave",this._leaveHandler,!0),r.addEventListener("blur",this._leaveHandler,!0)})}ngAfterViewChecked(){this._focusActiveCellAfterViewChecked&&(this._focusActiveCell(),this._focusActiveCellAfterViewChecked=!1)}_cellClicked(t,i){t.enabled&&this.selectedValueChange.emit({value:t.value,event:i})}_emitActiveDateChange(t,i){t.enabled&&this.activeDateChange.emit({value:t.value,event:i})}_isSelected(t){return this.startValue===t||this.endValue===t}ngOnChanges(t){const i=t.numCols,{rows:r,numCols:s}=this;(t.rows||i)&&(this._firstRowOffset=r&&r.length&&r[0].length?s-r[0].length:0),(t.cellAspectRatio||i||!this._cellPadding)&&(this._cellPadding=50*this.cellAspectRatio/s+"%"),(i||!this._cellWidth)&&(this._cellWidth=100/s+"%")}ngOnDestroy(){const t=this._elementRef.nativeElement;t.removeEventListener("mouseenter",this._enterHandler,!0),t.removeEventListener("focus",this._enterHandler,!0),t.removeEventListener("mouseleave",this._leaveHandler,!0),t.removeEventListener("blur",this._leaveHandler,!0)}_isActiveCell(t,i){let r=t*this.numCols+i;return t&&(r-=this._firstRowOffset),r==this.activeCell}_focusActiveCell(t=!0){this._ngZone.runOutsideAngular(()=>{this._ngZone.onStable.pipe(xc(1)).subscribe(()=>{setTimeout(()=>{const i=this._elementRef.nativeElement.querySelector(".mat-calendar-body-active");i&&(t||(this._skipNextFocus=!0),i.focus())})})})}_scheduleFocusActiveCellAfterViewChecked(){this._focusActiveCellAfterViewChecked=!0}_isRangeStart(t){return jI(t,this.startValue,this.endValue)}_isRangeEnd(t){return $I(t,this.startValue,this.endValue)}_isInRange(t){return WI(t,this.startValue,this.endValue,this.isRange)}_isComparisonStart(t){return jI(t,this.comparisonStart,this.comparisonEnd)}_isComparisonBridgeStart(t,i,r){if(!this._isComparisonStart(t)||this._isRangeStart(t)||!this._isInRange(t))return!1;let s=this.rows[i][r-1];if(!s){const c=this.rows[i-1];s=c&&c[c.length-1]}return s&&!this._isRangeEnd(s.compareValue)}_isComparisonBridgeEnd(t,i,r){if(!this._isComparisonEnd(t)||this._isRangeEnd(t)||!this._isInRange(t))return!1;let s=this.rows[i][r+1];if(!s){const c=this.rows[i+1];s=c&&c[0]}return s&&!this._isRangeStart(s.compareValue)}_isComparisonEnd(t){return $I(t,this.comparisonStart,this.comparisonEnd)}_isInComparisonRange(t){return WI(t,this.comparisonStart,this.comparisonEnd,this.isRange)}_isComparisonIdentical(t){return this.comparisonStart===this.comparisonEnd&&t===this.comparisonStart}_isPreviewStart(t){return jI(t,this.previewStart,this.previewEnd)}_isPreviewEnd(t){return $I(t,this.previewStart,this.previewEnd)}_isInPreview(t){return WI(t,this.previewStart,this.previewEnd,this.isRange)}_getCellFromElement(t){let i;if(wz(t)?i=t:wz(t.parentNode)&&(i=t.parentNode),i){const r=i.getAttribute("data-mat-row"),s=i.getAttribute("data-mat-col");if(r&&s)return this.rows[parseInt(r)][parseInt(s)]}return null}}return n.\u0275fac=function(t){return new(t||n)(Ie(wr),Ie(nr))},n.\u0275cmp=Qn({type:n,selectors:[["","mat-calendar-body",""]],hostAttrs:[1,"mat-calendar-body"],inputs:{label:"label",rows:"rows",todayValue:"todayValue",startValue:"startValue",endValue:"endValue",labelMinRequiredCells:"labelMinRequiredCells",numCols:"numCols",activeCell:"activeCell",isRange:"isRange",cellAspectRatio:"cellAspectRatio",comparisonStart:"comparisonStart",comparisonEnd:"comparisonEnd",previewStart:"previewStart",previewEnd:"previewEnd"},outputs:{selectedValueChange:"selectedValueChange",previewChange:"previewChange",activeDateChange:"activeDateChange"},exportAs:["matCalendarBody"],features:[Nr],attrs:AK,decls:2,vars:2,consts:[["aria-hidden","true",4,"ngIf"],["role","row",4,"ngFor","ngForOf"],["aria-hidden","true"],[1,"mat-calendar-body-label"],["role","row"],["class","mat-calendar-body-label",3,"paddingTop","paddingBottom",4,"ngIf"],["role","gridcell","class","mat-calendar-body-cell-container",3,"width","paddingTop","paddingBottom",4,"ngFor","ngForOf"],["role","gridcell",1,"mat-calendar-body-cell-container"],["type","button",1,"mat-calendar-body-cell",3,"ngClass","tabindex","click","focus"],[1,"mat-calendar-body-cell-content","mat-focus-indicator"],["aria-hidden","true",1,"mat-calendar-body-cell-preview"]],template:function(t,i){1&t&&(Di(0,IK,3,6,"tr",0),Di(1,kK,3,2,"tr",1)),2&t&&(Kt("ngIf",i._firstRowOffset<i.labelMinRequiredCells),Et(1),Kt("ngForOf",i.rows))},dependencies:[KM,hp,Yf],styles:['.mat-calendar-body{min-width:224px}.mat-calendar-body-label{height:0;line-height:0;text-align:left;padding-left:4.7142857143%;padding-right:4.7142857143%}.mat-calendar-body-cell-container{position:relative;height:0;line-height:0}.mat-calendar-body-cell{-webkit-user-select:none;user-select:none;cursor:pointer;outline:none;border:none;-webkit-tap-highlight-color:rgba(0,0,0,0);position:absolute;top:0;left:0;width:100%;height:100%;background:none;text-align:center;outline:none;font-family:inherit;margin:0}.mat-calendar-body-cell::-moz-focus-inner{border:0}.mat-calendar-body-cell::before,.mat-calendar-body-cell::after,.mat-calendar-body-cell-preview{content:"";position:absolute;top:5%;left:0;z-index:0;box-sizing:border-box;height:90%;width:100%}.mat-calendar-body-range-start:not(.mat-calendar-body-in-comparison-range)::before,.mat-calendar-body-range-start::after,.mat-calendar-body-comparison-start:not(.mat-calendar-body-comparison-bridge-start)::before,.mat-calendar-body-comparison-start::after,.mat-calendar-body-preview-start .mat-calendar-body-cell-preview{left:5%;width:95%;border-top-left-radius:999px;border-bottom-left-radius:999px}[dir=rtl] .mat-calendar-body-range-start:not(.mat-calendar-body-in-comparison-range)::before,[dir=rtl] .mat-calendar-body-range-start::after,[dir=rtl] .mat-calendar-body-comparison-start:not(.mat-calendar-body-comparison-bridge-start)::before,[dir=rtl] .mat-calendar-body-comparison-start::after,[dir=rtl] .mat-calendar-body-preview-start .mat-calendar-body-cell-preview{left:0;border-radius:0;border-top-right-radius:999px;border-bottom-right-radius:999px}.mat-calendar-body-range-end:not(.mat-calendar-body-in-comparison-range)::before,.mat-calendar-body-range-end::after,.mat-calendar-body-comparison-end:not(.mat-calendar-body-comparison-bridge-end)::before,.mat-calendar-body-comparison-end::after,.mat-calendar-body-preview-end .mat-calendar-body-cell-preview{width:95%;border-top-right-radius:999px;border-bottom-right-radius:999px}[dir=rtl] .mat-calendar-body-range-end:not(.mat-calendar-body-in-comparison-range)::before,[dir=rtl] .mat-calendar-body-range-end::after,[dir=rtl] .mat-calendar-body-comparison-end:not(.mat-calendar-body-comparison-bridge-end)::before,[dir=rtl] .mat-calendar-body-comparison-end::after,[dir=rtl] .mat-calendar-body-preview-end .mat-calendar-body-cell-preview{left:5%;border-radius:0;border-top-left-radius:999px;border-bottom-left-radius:999px}[dir=rtl] .mat-calendar-body-comparison-bridge-start.mat-calendar-body-range-end::after,[dir=rtl] .mat-calendar-body-comparison-bridge-end.mat-calendar-body-range-start::after{width:95%;border-top-right-radius:999px;border-bottom-right-radius:999px}.mat-calendar-body-comparison-start.mat-calendar-body-range-end::after,[dir=rtl] .mat-calendar-body-comparison-start.mat-calendar-body-range-end::after,.mat-calendar-body-comparison-end.mat-calendar-body-range-start::after,[dir=rtl] .mat-calendar-body-comparison-end.mat-calendar-body-range-start::after{width:90%}.mat-calendar-body-in-preview .mat-calendar-body-cell-preview{border-top:dashed 1px;border-bottom:dashed 1px}.mat-calendar-body-preview-start .mat-calendar-body-cell-preview{border-left:dashed 1px}[dir=rtl] .mat-calendar-body-preview-start .mat-calendar-body-cell-preview{border-left:0;border-right:dashed 1px}.mat-calendar-body-preview-end .mat-calendar-body-cell-preview{border-right:dashed 1px}[dir=rtl] .mat-calendar-body-preview-end .mat-calendar-body-cell-preview{border-right:0;border-left:dashed 1px}.mat-calendar-body-disabled{cursor:default}.cdk-high-contrast-active .mat-calendar-body-disabled{opacity:.5}.mat-calendar-body-cell-content{top:5%;left:5%;z-index:1;display:flex;align-items:center;justify-content:center;box-sizing:border-box;width:90%;height:90%;line-height:1;border-width:1px;border-style:solid;border-radius:999px}.mat-calendar-body-cell-content.mat-focus-indicator{position:absolute}.cdk-high-contrast-active .mat-calendar-body-cell-content{border:none}.cdk-high-contrast-active .mat-datepicker-popup:not(:empty),.cdk-high-contrast-active .mat-calendar-body-cell:not(.mat-calendar-body-in-range) .mat-calendar-body-selected{outline:solid 1px}.cdk-high-contrast-active .mat-calendar-body-today{outline:dotted 1px}.cdk-high-contrast-active .mat-calendar-body-cell::before,.cdk-high-contrast-active .mat-calendar-body-cell::after,.cdk-high-contrast-active .mat-calendar-body-selected{background:none}.cdk-high-contrast-active .mat-calendar-body-in-range::before,.cdk-high-contrast-active .mat-calendar-body-comparison-bridge-start::before,.cdk-high-contrast-active .mat-calendar-body-comparison-bridge-end::before{border-top:solid 1px;border-bottom:solid 1px}.cdk-high-contrast-active .mat-calendar-body-range-start::before{border-left:solid 1px}[dir=rtl] .cdk-high-contrast-active .mat-calendar-body-range-start::before{border-left:0;border-right:solid 1px}.cdk-high-contrast-active .mat-calendar-body-range-end::before{border-right:solid 1px}[dir=rtl] .cdk-high-contrast-active .mat-calendar-body-range-end::before{border-right:0;border-left:solid 1px}.cdk-high-contrast-active .mat-calendar-body-in-comparison-range::before{border-top:dashed 1px;border-bottom:dashed 1px}.cdk-high-contrast-active .mat-calendar-body-comparison-start::before{border-left:dashed 1px}[dir=rtl] .cdk-high-contrast-active .mat-calendar-body-comparison-start::before{border-left:0;border-right:dashed 1px}.cdk-high-contrast-active .mat-calendar-body-comparison-end::before{border-right:dashed 1px}[dir=rtl] .cdk-high-contrast-active .mat-calendar-body-comparison-end::before{border-right:0;border-left:dashed 1px}[dir=rtl] .mat-calendar-body-label{text-align:right}'],encapsulation:2,changeDetection:0}),n})();function wz(n){return"TD"===n.nodeName}function jI(n,e,t){return null!==t&&e!==t&&n<t&&n===e}function $I(n,e,t){return null!==e&&e!==t&&n>=e&&n===t}function WI(n,e,t,i){return i&&null!==e&&null!==t&&e!==t&&n>=e&&n<=t}class bc{constructor(e,t){this.start=e,this.end=t}}let Rv=(()=>{class n{constructor(t,i){this.selection=t,this._adapter=i,this._selectionChanged=new si,this.selectionChanged=this._selectionChanged,this.selection=t}updateSelection(t,i){const r=this.selection;this.selection=t,this._selectionChanged.next({selection:t,source:i,oldValue:r})}ngOnDestroy(){this._selectionChanged.complete()}_isValidDateInstance(t){return this._adapter.isDateInstance(t)&&this._adapter.isValid(t)}}return n.\u0275fac=function(t){eu()},n.\u0275prov=Yt({token:n,factory:n.\u0275fac}),n})(),VK=(()=>{class n extends Rv{constructor(t){super(null,t)}add(t){super.updateSelection(t,this)}isValid(){return null!=this.selection&&this._isValidDateInstance(this.selection)}isComplete(){return null!=this.selection}clone(){const t=new n(this._adapter);return t.updateSelection(this.selection,this),t}}return n.\u0275fac=function(t){return new(t||n)(Xe(yl))},n.\u0275prov=Yt({token:n,factory:n.\u0275fac}),n})();const GK={provide:Rv,deps:[[new ls,new $r,Rv],yl],useFactory:function HK(n,e){return n||new VK(e)}},qI=new Vt("MAT_DATE_RANGE_SELECTION_STRATEGY");let Mz=(()=>{class n{constructor(t,i,r,s,c){this._changeDetectorRef=t,this._dateFormats=i,this._dateAdapter=r,this._dir=s,this._rangeStrategy=c,this._rerenderSubscription=lt.EMPTY,this.selectedChange=new Dn,this._userSelection=new Dn,this.activeDateChange=new Dn,this._activeDate=this._dateAdapter.today()}get activeDate(){return this._activeDate}set activeDate(t){const i=this._activeDate,r=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(t))||this._dateAdapter.today();this._activeDate=this._dateAdapter.clampDate(r,this.minDate,this.maxDate),this._hasSameMonthAndYear(i,this._activeDate)||this._init()}get selected(){return this._selected}set selected(t){this._selected=t instanceof bc?t:this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(t)),this._setRanges(this._selected)}get minDate(){return this._minDate}set minDate(t){this._minDate=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(t))}get maxDate(){return this._maxDate}set maxDate(t){this._maxDate=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(t))}ngAfterContentInit(){this._rerenderSubscription=this._dateAdapter.localeChanges.pipe(Xl(null)).subscribe(()=>this._init())}ngOnChanges(t){const i=t.comparisonStart||t.comparisonEnd;i&&!i.firstChange&&this._setRanges(this.selected)}ngOnDestroy(){this._rerenderSubscription.unsubscribe()}_dateSelected(t){const i=t.value,r=this._getDateFromDayOfMonth(i);let s,c;this._selected instanceof bc?(s=this._getDateInCurrentMonth(this._selected.start),c=this._getDateInCurrentMonth(this._selected.end)):s=c=this._getDateInCurrentMonth(this._selected),(s!==i||c!==i)&&this.selectedChange.emit(r),this._userSelection.emit({value:r,event:t.event}),this._previewStart=this._previewEnd=null,this._changeDetectorRef.markForCheck()}_updateActiveDate(t){const r=this._activeDate;this.activeDate=this._getDateFromDayOfMonth(t.value),this._dateAdapter.compareDate(r,this.activeDate)&&this.activeDateChange.emit(this._activeDate)}_handleCalendarBodyKeydown(t){const i=this._activeDate,r=this._isRtl();switch(t.keyCode){case 37:this.activeDate=this._dateAdapter.addCalendarDays(this._activeDate,r?1:-1);break;case 39:this.activeDate=this._dateAdapter.addCalendarDays(this._activeDate,r?-1:1);break;case 38:this.activeDate=this._dateAdapter.addCalendarDays(this._activeDate,-7);break;case 40:this.activeDate=this._dateAdapter.addCalendarDays(this._activeDate,7);break;case 36:this.activeDate=this._dateAdapter.addCalendarDays(this._activeDate,1-this._dateAdapter.getDate(this._activeDate));break;case 35:this.activeDate=this._dateAdapter.addCalendarDays(this._activeDate,this._dateAdapter.getNumDaysInMonth(this._activeDate)-this._dateAdapter.getDate(this._activeDate));break;case 33:this.activeDate=t.altKey?this._dateAdapter.addCalendarYears(this._activeDate,-1):this._dateAdapter.addCalendarMonths(this._activeDate,-1);break;case 34:this.activeDate=t.altKey?this._dateAdapter.addCalendarYears(this._activeDate,1):this._dateAdapter.addCalendarMonths(this._activeDate,1);break;case 13:case 32:return this._selectionKeyPressed=!0,void(this._canSelect(this._activeDate)&&t.preventDefault());case 27:return void(null!=this._previewEnd&&!th(t)&&(this._previewStart=this._previewEnd=null,this.selectedChange.emit(null),this._userSelection.emit({value:null,event:t}),t.preventDefault(),t.stopPropagation()));default:return}this._dateAdapter.compareDate(i,this.activeDate)&&(this.activeDateChange.emit(this.activeDate),this._focusActiveCellAfterViewChecked()),t.preventDefault()}_handleCalendarBodyKeyup(t){(32===t.keyCode||13===t.keyCode)&&(this._selectionKeyPressed&&this._canSelect(this._activeDate)&&this._dateSelected({value:this._dateAdapter.getDate(this._activeDate),event:t}),this._selectionKeyPressed=!1)}_init(){this._setRanges(this.selected),this._todayDate=this._getCellCompareValue(this._dateAdapter.today()),this._monthLabel=this._dateFormats.display.monthLabel?this._dateAdapter.format(this.activeDate,this._dateFormats.display.monthLabel):this._dateAdapter.getMonthNames("short")[this._dateAdapter.getMonth(this.activeDate)].toLocaleUpperCase();let t=this._dateAdapter.createDate(this._dateAdapter.getYear(this.activeDate),this._dateAdapter.getMonth(this.activeDate),1);this._firstWeekOffset=(7+this._dateAdapter.getDayOfWeek(t)-this._dateAdapter.getFirstDayOfWeek())%7,this._initWeekdays(),this._createWeekCells(),this._changeDetectorRef.markForCheck()}_focusActiveCell(t){this._matCalendarBody._focusActiveCell(t)}_focusActiveCellAfterViewChecked(){this._matCalendarBody._scheduleFocusActiveCellAfterViewChecked()}_previewChanged({event:t,value:i}){if(this._rangeStrategy){const s=this._rangeStrategy.createPreview(i?i.rawValue:null,this.selected,t);this._previewStart=this._getCellCompareValue(s.start),this._previewEnd=this._getCellCompareValue(s.end),this._changeDetectorRef.detectChanges()}}_getDateFromDayOfMonth(t){return this._dateAdapter.createDate(this._dateAdapter.getYear(this.activeDate),this._dateAdapter.getMonth(this.activeDate),t)}_initWeekdays(){const t=this._dateAdapter.getFirstDayOfWeek(),i=this._dateAdapter.getDayOfWeekNames("narrow");let s=this._dateAdapter.getDayOfWeekNames("long").map((c,d)=>({long:c,narrow:i[d]}));this._weekdays=s.slice(t).concat(s.slice(0,t))}_createWeekCells(){const t=this._dateAdapter.getNumDaysInMonth(this.activeDate),i=this._dateAdapter.getDateNames();this._weeks=[[]];for(let r=0,s=this._firstWeekOffset;r<t;r++,s++){7==s&&(this._weeks.push([]),s=0);const c=this._dateAdapter.createDate(this._dateAdapter.getYear(this.activeDate),this._dateAdapter.getMonth(this.activeDate),r+1),d=this._shouldEnableDate(c),m=this._dateAdapter.format(c,this._dateFormats.display.dateA11yLabel),y=this.dateClass?this.dateClass(c,"month"):void 0;this._weeks[this._weeks.length-1].push(new GI(r+1,i[r],m,d,y,this._getCellCompareValue(c),c))}}_shouldEnableDate(t){return!!t&&(!this.minDate||this._dateAdapter.compareDate(t,this.minDate)>=0)&&(!this.maxDate||this._dateAdapter.compareDate(t,this.maxDate)<=0)&&(!this.dateFilter||this.dateFilter(t))}_getDateInCurrentMonth(t){return t&&this._hasSameMonthAndYear(t,this.activeDate)?this._dateAdapter.getDate(t):null}_hasSameMonthAndYear(t,i){return!(!t||!i||this._dateAdapter.getMonth(t)!=this._dateAdapter.getMonth(i)||this._dateAdapter.getYear(t)!=this._dateAdapter.getYear(i))}_getCellCompareValue(t){if(t){const i=this._dateAdapter.getYear(t),r=this._dateAdapter.getMonth(t),s=this._dateAdapter.getDate(t);return new Date(i,r,s).getTime()}return null}_isRtl(){return this._dir&&"rtl"===this._dir.value}_setRanges(t){t instanceof bc?(this._rangeStart=this._getCellCompareValue(t.start),this._rangeEnd=this._getCellCompareValue(t.end),this._isRange=!0):(this._rangeStart=this._rangeEnd=this._getCellCompareValue(t),this._isRange=!1),this._comparisonRangeStart=this._getCellCompareValue(this.comparisonStart),this._comparisonRangeEnd=this._getCellCompareValue(this.comparisonEnd)}_canSelect(t){return!this.dateFilter||this.dateFilter(t)}}return n.\u0275fac=function(t){return new(t||n)(Ie(Ho),Ie(Lg,8),Ie(yl,8),Ie(em,8),Ie(qI,8))},n.\u0275cmp=Qn({type:n,selectors:[["mat-month-view"]],viewQuery:function(t,i){if(1&t&&Uo(Pv,5),2&t){let r;Gi(r=ji())&&(i._matCalendarBody=r.first)}},inputs:{activeDate:"activeDate",selected:"selected",minDate:"minDate",maxDate:"maxDate",dateFilter:"dateFilter",dateClass:"dateClass",comparisonStart:"comparisonStart",comparisonEnd:"comparisonEnd"},outputs:{selectedChange:"selectedChange",_userSelection:"_userSelection",activeDateChange:"activeDateChange"},exportAs:["matMonthView"],features:[Nr],decls:7,vars:13,consts:[["role","grid",1,"mat-calendar-table"],[1,"mat-calendar-table-header"],["scope","col",4,"ngFor","ngForOf"],["aria-hidden","true","colspan","7",1,"mat-calendar-table-header-divider"],["mat-calendar-body","",3,"label","rows","todayValue","startValue","endValue","comparisonStart","comparisonEnd","previewStart","previewEnd","isRange","labelMinRequiredCells","activeCell","selectedValueChange","activeDateChange","previewChange","keyup","keydown"],["scope","col"],[1,"cdk-visually-hidden"],["aria-hidden","true"]],template:function(t,i){1&t&&(Ae(0,"table",0)(1,"thead",1)(2,"tr"),Di(3,LK,5,2,"th",2),xe(),Ae(4,"tr"),jt(5,"th",3),xe()(),Ae(6,"tbody",4),gi("selectedValueChange",function(s){return i._dateSelected(s)})("activeDateChange",function(s){return i._updateActiveDate(s)})("previewChange",function(s){return i._previewChanged(s)})("keyup",function(s){return i._handleCalendarBodyKeyup(s)})("keydown",function(s){return i._handleCalendarBodyKeydown(s)}),xe()()),2&t&&(Et(3),Kt("ngForOf",i._weekdays),Et(3),Kt("label",i._monthLabel)("rows",i._weeks)("todayValue",i._todayDate)("startValue",i._rangeStart)("endValue",i._rangeEnd)("comparisonStart",i._comparisonRangeStart)("comparisonEnd",i._comparisonRangeEnd)("previewStart",i._previewStart)("previewEnd",i._previewEnd)("isRange",i._isRange)("labelMinRequiredCells",3)("activeCell",i._dateAdapter.getDate(i.activeDate)-1))},dependencies:[hp,Pv],encapsulation:2,changeDetection:0}),n})(),Cz=(()=>{class n{constructor(t,i,r){this._changeDetectorRef=t,this._dateAdapter=i,this._dir=r,this._rerenderSubscription=lt.EMPTY,this.selectedChange=new Dn,this.yearSelected=new Dn,this.activeDateChange=new Dn,this._activeDate=this._dateAdapter.today()}get activeDate(){return this._activeDate}set activeDate(t){let i=this._activeDate;const r=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(t))||this._dateAdapter.today();this._activeDate=this._dateAdapter.clampDate(r,this.minDate,this.maxDate),Sz(this._dateAdapter,i,this._activeDate,this.minDate,this.maxDate)||this._init()}get selected(){return this._selected}set selected(t){this._selected=t instanceof bc?t:this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(t)),this._setSelectedYear(t)}get minDate(){return this._minDate}set minDate(t){this._minDate=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(t))}get maxDate(){return this._maxDate}set maxDate(t){this._maxDate=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(t))}ngAfterContentInit(){this._rerenderSubscription=this._dateAdapter.localeChanges.pipe(Xl(null)).subscribe(()=>this._init())}ngOnDestroy(){this._rerenderSubscription.unsubscribe()}_init(){this._todayYear=this._dateAdapter.getYear(this._dateAdapter.today());const i=this._dateAdapter.getYear(this._activeDate)-ow(this._dateAdapter,this.activeDate,this.minDate,this.maxDate);this._years=[];for(let r=0,s=[];r<24;r++)s.push(i+r),4==s.length&&(this._years.push(s.map(c=>this._createCellForYear(c))),s=[]);this._changeDetectorRef.markForCheck()}_yearSelected(t){const i=t.value,r=this._dateAdapter.createDate(i,0,1),s=this._getDateFromYear(i);this.yearSelected.emit(r),this.selectedChange.emit(s)}_updateActiveDate(t){const r=this._activeDate;this.activeDate=this._getDateFromYear(t.value),this._dateAdapter.compareDate(r,this.activeDate)&&this.activeDateChange.emit(this.activeDate)}_handleCalendarBodyKeydown(t){const i=this._activeDate,r=this._isRtl();switch(t.keyCode){case 37:this.activeDate=this._dateAdapter.addCalendarYears(this._activeDate,r?1:-1);break;case 39:this.activeDate=this._dateAdapter.addCalendarYears(this._activeDate,r?-1:1);break;case 38:this.activeDate=this._dateAdapter.addCalendarYears(this._activeDate,-4);break;case 40:this.activeDate=this._dateAdapter.addCalendarYears(this._activeDate,4);break;case 36:this.activeDate=this._dateAdapter.addCalendarYears(this._activeDate,-ow(this._dateAdapter,this.activeDate,this.minDate,this.maxDate));break;case 35:this.activeDate=this._dateAdapter.addCalendarYears(this._activeDate,24-ow(this._dateAdapter,this.activeDate,this.minDate,this.maxDate)-1);break;case 33:this.activeDate=this._dateAdapter.addCalendarYears(this._activeDate,t.altKey?-240:-24);break;case 34:this.activeDate=this._dateAdapter.addCalendarYears(this._activeDate,t.altKey?240:24);break;case 13:case 32:this._selectionKeyPressed=!0;break;default:return}this._dateAdapter.compareDate(i,this.activeDate)&&this.activeDateChange.emit(this.activeDate),this._focusActiveCellAfterViewChecked(),t.preventDefault()}_handleCalendarBodyKeyup(t){(32===t.keyCode||13===t.keyCode)&&(this._selectionKeyPressed&&this._yearSelected({value:this._dateAdapter.getYear(this._activeDate),event:t}),this._selectionKeyPressed=!1)}_getActiveCell(){return ow(this._dateAdapter,this.activeDate,this.minDate,this.maxDate)}_focusActiveCell(){this._matCalendarBody._focusActiveCell()}_focusActiveCellAfterViewChecked(){this._matCalendarBody._scheduleFocusActiveCellAfterViewChecked()}_getDateFromYear(t){const i=this._dateAdapter.getMonth(this.activeDate),r=this._dateAdapter.getNumDaysInMonth(this._dateAdapter.createDate(t,i,1));return this._dateAdapter.createDate(t,i,Math.min(this._dateAdapter.getDate(this.activeDate),r))}_createCellForYear(t){const i=this._dateAdapter.createDate(t,0,1),r=this._dateAdapter.getYearName(i),s=this.dateClass?this.dateClass(i,"multi-year"):void 0;return new GI(t,r,r,this._shouldEnableYear(t),s)}_shouldEnableYear(t){if(null==t||this.maxDate&&t>this._dateAdapter.getYear(this.maxDate)||this.minDate&&t<this._dateAdapter.getYear(this.minDate))return!1;if(!this.dateFilter)return!0;for(let r=this._dateAdapter.createDate(t,0,1);this._dateAdapter.getYear(r)==t;r=this._dateAdapter.addCalendarDays(r,1))if(this.dateFilter(r))return!0;return!1}_isRtl(){return this._dir&&"rtl"===this._dir.value}_setSelectedYear(t){if(this._selectedYear=null,t instanceof bc){const i=t.start||t.end;i&&(this._selectedYear=this._dateAdapter.getYear(i))}else t&&(this._selectedYear=this._dateAdapter.getYear(t))}}return n.\u0275fac=function(t){return new(t||n)(Ie(Ho),Ie(yl,8),Ie(em,8))},n.\u0275cmp=Qn({type:n,selectors:[["mat-multi-year-view"]],viewQuery:function(t,i){if(1&t&&Uo(Pv,5),2&t){let r;Gi(r=ji())&&(i._matCalendarBody=r.first)}},inputs:{activeDate:"activeDate",selected:"selected",minDate:"minDate",maxDate:"maxDate",dateFilter:"dateFilter",dateClass:"dateClass"},outputs:{selectedChange:"selectedChange",yearSelected:"yearSelected",activeDateChange:"activeDateChange"},exportAs:["matMultiYearView"],decls:5,vars:7,consts:[["role","grid",1,"mat-calendar-table"],["aria-hidden","true",1,"mat-calendar-table-header"],["colspan","4",1,"mat-calendar-table-header-divider"],["mat-calendar-body","",3,"rows","todayValue","startValue","endValue","numCols","cellAspectRatio","activeCell","selectedValueChange","activeDateChange","keyup","keydown"]],template:function(t,i){1&t&&(Ae(0,"table",0)(1,"thead",1)(2,"tr"),jt(3,"th",2),xe()(),Ae(4,"tbody",3),gi("selectedValueChange",function(s){return i._yearSelected(s)})("activeDateChange",function(s){return i._updateActiveDate(s)})("keyup",function(s){return i._handleCalendarBodyKeyup(s)})("keydown",function(s){return i._handleCalendarBodyKeydown(s)}),xe()()),2&t&&(Et(4),Kt("rows",i._years)("todayValue",i._todayYear)("startValue",i._selectedYear)("endValue",i._selectedYear)("numCols",4)("cellAspectRatio",4/7)("activeCell",i._getActiveCell()))},dependencies:[Pv],encapsulation:2,changeDetection:0}),n})();function Sz(n,e,t,i,r){const s=n.getYear(e),c=n.getYear(t),d=Ez(n,i,r);return Math.floor((s-d)/24)===Math.floor((c-d)/24)}function ow(n,e,t,i){return function qK(n,e){return(n%e+e)%e}(n.getYear(e)-Ez(n,t,i),24)}function Ez(n,e,t){let i=0;return t?i=n.getYear(t)-24+1:e&&(i=n.getYear(e)),i}let Tz=(()=>{class n{constructor(t,i,r,s){this._changeDetectorRef=t,this._dateFormats=i,this._dateAdapter=r,this._dir=s,this._rerenderSubscription=lt.EMPTY,this.selectedChange=new Dn,this.monthSelected=new Dn,this.activeDateChange=new Dn,this._activeDate=this._dateAdapter.today()}get activeDate(){return this._activeDate}set activeDate(t){let i=this._activeDate;const r=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(t))||this._dateAdapter.today();this._activeDate=this._dateAdapter.clampDate(r,this.minDate,this.maxDate),this._dateAdapter.getYear(i)!==this._dateAdapter.getYear(this._activeDate)&&this._init()}get selected(){return this._selected}set selected(t){this._selected=t instanceof bc?t:this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(t)),this._setSelectedMonth(t)}get minDate(){return this._minDate}set minDate(t){this._minDate=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(t))}get maxDate(){return this._maxDate}set maxDate(t){this._maxDate=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(t))}ngAfterContentInit(){this._rerenderSubscription=this._dateAdapter.localeChanges.pipe(Xl(null)).subscribe(()=>this._init())}ngOnDestroy(){this._rerenderSubscription.unsubscribe()}_monthSelected(t){const i=t.value,r=this._dateAdapter.createDate(this._dateAdapter.getYear(this.activeDate),i,1);this.monthSelected.emit(r);const s=this._getDateFromMonth(i);this.selectedChange.emit(s)}_updateActiveDate(t){const r=this._activeDate;this.activeDate=this._getDateFromMonth(t.value),this._dateAdapter.compareDate(r,this.activeDate)&&this.activeDateChange.emit(this.activeDate)}_handleCalendarBodyKeydown(t){const i=this._activeDate,r=this._isRtl();switch(t.keyCode){case 37:this.activeDate=this._dateAdapter.addCalendarMonths(this._activeDate,r?1:-1);break;case 39:this.activeDate=this._dateAdapter.addCalendarMonths(this._activeDate,r?-1:1);break;case 38:this.activeDate=this._dateAdapter.addCalendarMonths(this._activeDate,-4);break;case 40:this.activeDate=this._dateAdapter.addCalendarMonths(this._activeDate,4);break;case 36:this.activeDate=this._dateAdapter.addCalendarMonths(this._activeDate,-this._dateAdapter.getMonth(this._activeDate));break;case 35:this.activeDate=this._dateAdapter.addCalendarMonths(this._activeDate,11-this._dateAdapter.getMonth(this._activeDate));break;case 33:this.activeDate=this._dateAdapter.addCalendarYears(this._activeDate,t.altKey?-10:-1);break;case 34:this.activeDate=this._dateAdapter.addCalendarYears(this._activeDate,t.altKey?10:1);break;case 13:case 32:this._selectionKeyPressed=!0;break;default:return}this._dateAdapter.compareDate(i,this.activeDate)&&(this.activeDateChange.emit(this.activeDate),this._focusActiveCellAfterViewChecked()),t.preventDefault()}_handleCalendarBodyKeyup(t){(32===t.keyCode||13===t.keyCode)&&(this._selectionKeyPressed&&this._monthSelected({value:this._dateAdapter.getMonth(this._activeDate),event:t}),this._selectionKeyPressed=!1)}_init(){this._setSelectedMonth(this.selected),this._todayMonth=this._getMonthInCurrentYear(this._dateAdapter.today()),this._yearLabel=this._dateAdapter.getYearName(this.activeDate);let t=this._dateAdapter.getMonthNames("short");this._months=[[0,1,2,3],[4,5,6,7],[8,9,10,11]].map(i=>i.map(r=>this._createCellForMonth(r,t[r]))),this._changeDetectorRef.markForCheck()}_focusActiveCell(){this._matCalendarBody._focusActiveCell()}_focusActiveCellAfterViewChecked(){this._matCalendarBody._scheduleFocusActiveCellAfterViewChecked()}_getMonthInCurrentYear(t){return t&&this._dateAdapter.getYear(t)==this._dateAdapter.getYear(this.activeDate)?this._dateAdapter.getMonth(t):null}_getDateFromMonth(t){const i=this._dateAdapter.createDate(this._dateAdapter.getYear(this.activeDate),t,1),r=this._dateAdapter.getNumDaysInMonth(i);return this._dateAdapter.createDate(this._dateAdapter.getYear(this.activeDate),t,Math.min(this._dateAdapter.getDate(this.activeDate),r))}_createCellForMonth(t,i){const r=this._dateAdapter.createDate(this._dateAdapter.getYear(this.activeDate),t,1),s=this._dateAdapter.format(r,this._dateFormats.display.monthYearA11yLabel),c=this.dateClass?this.dateClass(r,"year"):void 0;return new GI(t,i.toLocaleUpperCase(),s,this._shouldEnableMonth(t),c)}_shouldEnableMonth(t){const i=this._dateAdapter.getYear(this.activeDate);if(null==t||this._isYearAndMonthAfterMaxDate(i,t)||this._isYearAndMonthBeforeMinDate(i,t))return!1;if(!this.dateFilter)return!0;for(let s=this._dateAdapter.createDate(i,t,1);this._dateAdapter.getMonth(s)==t;s=this._dateAdapter.addCalendarDays(s,1))if(this.dateFilter(s))return!0;return!1}_isYearAndMonthAfterMaxDate(t,i){if(this.maxDate){const r=this._dateAdapter.getYear(this.maxDate),s=this._dateAdapter.getMonth(this.maxDate);return t>r||t===r&&i>s}return!1}_isYearAndMonthBeforeMinDate(t,i){if(this.minDate){const r=this._dateAdapter.getYear(this.minDate),s=this._dateAdapter.getMonth(this.minDate);return t<r||t===r&&i<s}return!1}_isRtl(){return this._dir&&"rtl"===this._dir.value}_setSelectedMonth(t){this._selectedMonth=t instanceof bc?this._getMonthInCurrentYear(t.start)||this._getMonthInCurrentYear(t.end):this._getMonthInCurrentYear(t)}}return n.\u0275fac=function(t){return new(t||n)(Ie(Ho),Ie(Lg,8),Ie(yl,8),Ie(em,8))},n.\u0275cmp=Qn({type:n,selectors:[["mat-year-view"]],viewQuery:function(t,i){if(1&t&&Uo(Pv,5),2&t){let r;Gi(r=ji())&&(i._matCalendarBody=r.first)}},inputs:{activeDate:"activeDate",selected:"selected",minDate:"minDate",maxDate:"maxDate",dateFilter:"dateFilter",dateClass:"dateClass"},outputs:{selectedChange:"selectedChange",monthSelected:"monthSelected",activeDateChange:"activeDateChange"},exportAs:["matYearView"],decls:5,vars:9,consts:[["role","grid",1,"mat-calendar-table"],["aria-hidden","true",1,"mat-calendar-table-header"],["colspan","4",1,"mat-calendar-table-header-divider"],["mat-calendar-body","",3,"label","rows","todayValue","startValue","endValue","labelMinRequiredCells","numCols","cellAspectRatio","activeCell","selectedValueChange","activeDateChange","keyup","keydown"]],template:function(t,i){1&t&&(Ae(0,"table",0)(1,"thead",1)(2,"tr"),jt(3,"th",2),xe()(),Ae(4,"tbody",3),gi("selectedValueChange",function(s){return i._monthSelected(s)})("activeDateChange",function(s){return i._updateActiveDate(s)})("keyup",function(s){return i._handleCalendarBodyKeyup(s)})("keydown",function(s){return i._handleCalendarBodyKeydown(s)}),xe()()),2&t&&(Et(4),Kt("label",i._yearLabel)("rows",i._months)("todayValue",i._todayMonth)("startValue",i._selectedMonth)("endValue",i._selectedMonth)("labelMinRequiredCells",2)("numCols",4)("cellAspectRatio",4/7)("activeCell",i._dateAdapter.getMonth(i.activeDate)))},dependencies:[Pv],encapsulation:2,changeDetection:0}),n})(),ZK=0,XK=(()=>{class n{constructor(t,i,r,s,c){this._intl=t,this.calendar=i,this._dateAdapter=r,this._dateFormats=s,this._buttonDescriptionId="mat-calendar-button-"+ZK++,this.calendar.stateChanges.subscribe(()=>c.markForCheck())}get periodButtonText(){if("month"==this.calendar.currentView)return this._dateAdapter.format(this.calendar.activeDate,this._dateFormats.display.monthYearLabel).toLocaleUpperCase();if("year"==this.calendar.currentView)return this._dateAdapter.getYearName(this.calendar.activeDate);const i=this._dateAdapter.getYear(this.calendar.activeDate)-ow(this._dateAdapter,this.calendar.activeDate,this.calendar.minDate,this.calendar.maxDate),r=i+24-1,s=this._dateAdapter.getYearName(this._dateAdapter.createDate(i,0,1)),c=this._dateAdapter.getYearName(this._dateAdapter.createDate(r,0,1));return this._intl.formatYearRange(s,c)}get periodButtonLabel(){return"month"==this.calendar.currentView?this._intl.switchToMultiYearViewLabel:this._intl.switchToMonthViewLabel}get prevButtonLabel(){return{month:this._intl.prevMonthLabel,year:this._intl.prevYearLabel,"multi-year":this._intl.prevMultiYearLabel}[this.calendar.currentView]}get nextButtonLabel(){return{month:this._intl.nextMonthLabel,year:this._intl.nextYearLabel,"multi-year":this._intl.nextMultiYearLabel}[this.calendar.currentView]}currentPeriodClicked(){this.calendar.currentView="month"==this.calendar.currentView?"multi-year":"month"}previousClicked(){this.calendar.activeDate="month"==this.calendar.currentView?this._dateAdapter.addCalendarMonths(this.calendar.activeDate,-1):this._dateAdapter.addCalendarYears(this.calendar.activeDate,"year"==this.calendar.currentView?-1:-24)}nextClicked(){this.calendar.activeDate="month"==this.calendar.currentView?this._dateAdapter.addCalendarMonths(this.calendar.activeDate,1):this._dateAdapter.addCalendarYears(this.calendar.activeDate,"year"==this.calendar.currentView?1:24)}previousEnabled(){return!this.calendar.minDate||!this.calendar.minDate||!this._isSameView(this.calendar.activeDate,this.calendar.minDate)}nextEnabled(){return!this.calendar.maxDate||!this._isSameView(this.calendar.activeDate,this.calendar.maxDate)}_isSameView(t,i){return"month"==this.calendar.currentView?this._dateAdapter.getYear(t)==this._dateAdapter.getYear(i)&&this._dateAdapter.getMonth(t)==this._dateAdapter.getMonth(i):"year"==this.calendar.currentView?this._dateAdapter.getYear(t)==this._dateAdapter.getYear(i):Sz(this._dateAdapter,t,i,this.calendar.minDate,this.calendar.maxDate)}}return n.\u0275fac=function(t){return new(t||n)(Ie(HI),Ie(Ai(()=>Dz)),Ie(yl,8),Ie(Lg,8),Ie(Ho))},n.\u0275cmp=Qn({type:n,selectors:[["mat-calendar-header"]],exportAs:["matCalendarHeader"],ngContentSelectors:OK,decls:11,vars:10,consts:[[1,"mat-calendar-header"],[1,"mat-calendar-controls"],["mat-button","","type","button","aria-live","polite",1,"mat-calendar-period-button",3,"click"],["viewBox","0 0 10 5","focusable","false",1,"mat-calendar-arrow"],["points","0,0 5,5 10,0"],[1,"mat-calendar-spacer"],["mat-icon-button","","type","button",1,"mat-calendar-previous-button",3,"disabled","click"],["mat-icon-button","","type","button",1,"mat-calendar-next-button",3,"disabled","click"]],template:function(t,i){1&t&&(iu(),Ae(0,"div",0)(1,"div",1)(2,"button",2),gi("click",function(){return i.currentPeriodClicked()}),Ae(3,"span"),it(4),xe(),function Uh(){ui.lFrame.currentNamespace="svg"}(),Ae(5,"svg",3),jt(6,"polygon",4),xe()(),function _(){!function u(){ui.lFrame.currentNamespace=null}()}(),jt(7,"div",5),us(8),Ae(9,"button",6),gi("click",function(){return i.previousClicked()}),xe(),Ae(10,"button",7),gi("click",function(){return i.nextClicked()}),xe()()()),2&t&&(Et(2),tr("aria-label",i.periodButtonLabel)("aria-describedby",i._buttonDescriptionId),Et(1),tr("id",i._buttonDescriptionId),Et(1),Qs(i.periodButtonText),Et(1),ds("mat-calendar-invert","month"!==i.calendar.currentView),Et(4),Kt("disabled",!i.previousEnabled()),tr("aria-label",i.prevButtonLabel),Et(1),Kt("disabled",!i.nextEnabled()),tr("aria-label",i.nextButtonLabel))},dependencies:[Wq],encapsulation:2,changeDetection:0}),n})(),Dz=(()=>{class n{constructor(t,i,r,s){this._dateAdapter=i,this._dateFormats=r,this._changeDetectorRef=s,this._moveFocusOnNextTick=!1,this.startView="month",this.selectedChange=new Dn,this.yearSelected=new Dn,this.monthSelected=new Dn,this.viewChanged=new Dn(!0),this._userSelection=new Dn,this.stateChanges=new si,this._intlChanges=t.changes.subscribe(()=>{s.markForCheck(),this.stateChanges.next()})}get startAt(){return this._startAt}set startAt(t){this._startAt=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(t))}get selected(){return this._selected}set selected(t){this._selected=t instanceof bc?t:this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(t))}get minDate(){return this._minDate}set minDate(t){this._minDate=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(t))}get maxDate(){return this._maxDate}set maxDate(t){this._maxDate=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(t))}get activeDate(){return this._clampedActiveDate}set activeDate(t){this._clampedActiveDate=this._dateAdapter.clampDate(t,this.minDate,this.maxDate),this.stateChanges.next(),this._changeDetectorRef.markForCheck()}get currentView(){return this._currentView}set currentView(t){const i=this._currentView!==t?t:null;this._currentView=t,this._moveFocusOnNextTick=!0,this._changeDetectorRef.markForCheck(),i&&this.viewChanged.emit(i)}ngAfterContentInit(){this._calendarHeaderPortal=new HF(this.headerComponent||XK),this.activeDate=this.startAt||this._dateAdapter.today(),this._currentView=this.startView}ngAfterViewChecked(){this._moveFocusOnNextTick&&(this._moveFocusOnNextTick=!1,this.focusActiveCell())}ngOnDestroy(){this._intlChanges.unsubscribe(),this.stateChanges.complete()}ngOnChanges(t){const i=t.minDate&&!this._dateAdapter.sameDate(t.minDate.previousValue,t.minDate.currentValue)?t.minDate:void 0,r=t.maxDate&&!this._dateAdapter.sameDate(t.maxDate.previousValue,t.maxDate.currentValue)?t.maxDate:void 0,s=i||r||t.dateFilter;if(s&&!s.firstChange){const c=this._getCurrentViewComponent();c&&(this._changeDetectorRef.detectChanges(),c._init())}this.stateChanges.next()}focusActiveCell(){this._getCurrentViewComponent()._focusActiveCell(!1)}updateTodaysDate(){this._getCurrentViewComponent()._init()}_dateSelected(t){const i=t.value;(this.selected instanceof bc||i&&!this._dateAdapter.sameDate(i,this.selected))&&this.selectedChange.emit(i),this._userSelection.emit(t)}_yearSelectedInMultiYearView(t){this.yearSelected.emit(t)}_monthSelectedInYearView(t){this.monthSelected.emit(t)}_goToDateInView(t,i){this.activeDate=t,this.currentView=i}_getCurrentViewComponent(){return this.monthView||this.yearView||this.multiYearView}}return n.\u0275fac=function(t){return new(t||n)(Ie(HI),Ie(yl,8),Ie(Lg,8),Ie(Ho))},n.\u0275cmp=Qn({type:n,selectors:[["mat-calendar"]],viewQuery:function(t,i){if(1&t&&(Uo(Mz,5),Uo(Tz,5),Uo(Cz,5)),2&t){let r;Gi(r=ji())&&(i.monthView=r.first),Gi(r=ji())&&(i.yearView=r.first),Gi(r=ji())&&(i.multiYearView=r.first)}},hostAttrs:[1,"mat-calendar"],inputs:{headerComponent:"headerComponent",startAt:"startAt",startView:"startView",selected:"selected",minDate:"minDate",maxDate:"maxDate",dateFilter:"dateFilter",dateClass:"dateClass",comparisonStart:"comparisonStart",comparisonEnd:"comparisonEnd"},outputs:{selectedChange:"selectedChange",yearSelected:"yearSelected",monthSelected:"monthSelected",viewChanged:"viewChanged",_userSelection:"_userSelection"},exportAs:["matCalendar"],features:[hr([GK]),Nr],decls:5,vars:5,consts:[[3,"cdkPortalOutlet"],["cdkMonitorSubtreeFocus","","tabindex","-1",1,"mat-calendar-content",3,"ngSwitch"],[3,"activeDate","selected","dateFilter","maxDate","minDate","dateClass","comparisonStart","comparisonEnd","activeDateChange","_userSelection",4,"ngSwitchCase"],[3,"activeDate","selected","dateFilter","maxDate","minDate","dateClass","activeDateChange","monthSelected","selectedChange",4,"ngSwitchCase"],[3,"activeDate","selected","dateFilter","maxDate","minDate","dateClass","activeDateChange","yearSelected","selectedChange",4,"ngSwitchCase"],[3,"activeDate","selected","dateFilter","maxDate","minDate","dateClass","comparisonStart","comparisonEnd","activeDateChange","_userSelection"],[3,"activeDate","selected","dateFilter","maxDate","minDate","dateClass","activeDateChange","monthSelected","selectedChange"],[3,"activeDate","selected","dateFilter","maxDate","minDate","dateClass","activeDateChange","yearSelected","selectedChange"]],template:function(t,i){1&t&&(Di(0,FK,0,0,"ng-template",0),Ae(1,"div",1),Di(2,NK,1,8,"mat-month-view",2),Di(3,BK,1,6,"mat-year-view",3),Di(4,zK,1,6,"mat-multi-year-view",4),xe()),2&t&&(Kt("cdkPortalOutlet",i._calendarHeaderPortal),Et(1),Kt("ngSwitch",i.currentView),Et(1),Kt("ngSwitchCase","month"),Et(1),Kt("ngSwitchCase","year"),Et(1),Kt("ngSwitchCase","multi-year"))},dependencies:[av,QM,lW,jF,Mz,Tz,Cz],styles:['.mat-calendar{display:block}.mat-calendar-header{padding:8px 8px 0 8px}.mat-calendar-content{padding:0 8px 8px 8px;outline:none}.mat-calendar-controls{display:flex;margin:5% calc(4.7142857143% - 16px)}.mat-calendar-controls .mat-icon-button:hover .mat-button-focus-overlay{opacity:.04}.mat-calendar-spacer{flex:1 1 auto}.mat-calendar-period-button{min-width:0}.mat-calendar-arrow{display:inline-block;width:10px;height:5px;margin:0 0 0 5px;vertical-align:middle}.mat-calendar-arrow.mat-calendar-invert{transform:rotate(180deg)}[dir=rtl] .mat-calendar-arrow{margin:0 5px 0 0}.cdk-high-contrast-active .mat-calendar-arrow{fill:CanvasText}.mat-calendar-previous-button,.mat-calendar-next-button{position:relative}.mat-calendar-previous-button::after,.mat-calendar-next-button::after{top:0;left:0;right:0;bottom:0;position:absolute;content:"";margin:15.5px;border:0 solid currentColor;border-top-width:2px}[dir=rtl] .mat-calendar-previous-button,[dir=rtl] .mat-calendar-next-button{transform:rotate(180deg)}.mat-calendar-previous-button::after{border-left-width:2px;transform:translateX(2px) rotate(-45deg)}.mat-calendar-next-button::after{border-right-width:2px;transform:translateX(-2px) rotate(45deg)}.mat-calendar-table{border-spacing:0;border-collapse:collapse;width:100%}.mat-calendar-table-header th{text-align:center;padding:0 0 8px 0}.mat-calendar-table-header-divider{position:relative;height:1px}.mat-calendar-table-header-divider::after{content:"";position:absolute;top:0;left:-8px;right:-8px;height:1px}.mat-calendar-body-cell-content::before{margin:calc(calc(var(--mat-focus-indicator-border-width, 3px) + 3px) * -1)}.mat-calendar-body-cell:focus .mat-focus-indicator::before{content:""}'],encapsulation:2,changeDetection:0}),n})();const QK={provide:new Vt("mat-datepicker-scroll-strategy"),deps:[yv],useFactory:function KK(n){return()=>n.scrollStrategies.reposition()}};let iQ=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=Gn({type:n}),n.\u0275inj=Bn({providers:[HI,QK],imports:[au,Fb,SC,AF,Lb,Ki,Vb]}),n})(),rQ=(()=>{class n{constructor(){this.selected=null}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275cmp=Qn({type:n,selectors:[["app-calendar"]],decls:4,vars:1,consts:[[1,"salto-linea"],[1,"demo-inline-calendar-card"],[3,"selected","selectedChange"]],template:function(t,i){1&t&&(Ae(0,"span",0),it(1," - "),xe(),Ae(2,"mat-card",1)(3,"mat-calendar",2),gi("selectedChange",function(s){return i.selected=s}),xe()()),2&t&&(Et(3),Kt("selected",i.selected))},dependencies:[nB,Dz],styles:[".demo-inline-calendar-card[_ngcontent-%COMP%], .mat-raised-button[_ngcontent-%COMP%]{width:100%}.salto-linea[_ngcontent-%COMP%]{font-size:0;display:block}"]}),n})(),sQ=(()=>{class n{constructor(t){this.roomService=t,this.banio_compartido=""}ngOnInit(){this.parserTipoBanio(this.roomService.selectedRoom.banio_compartido),console.log(this.roomService.selectedRoom)}parserTipoBanio(t){t&&(this.banio_compartido="Si"),this.banio_compartido="No"}}return n.\u0275fac=function(t){return new(t||n)(Ie(Iv))},n.\u0275cmp=Qn({type:n,selectors:[["app-data-room-container"]],decls:40,vars:14,consts:[[1,"card",2,"width","100%"],[1,"card-body"],[1,"card-title","texto-titulo"],[1,"card-text"],[1,"list-group","list-group-flush"],[1,"list-group-item"],[1,"salto-linea"]],template:function(t,i){1&t&&(Ae(0,"div",0)(1,"div",1)(2,"h4",2),it(3),xe(),Ae(4,"p",3),it(5),xe()(),Ae(6,"ul",4)(7,"li",5)(8,"p")(9,"b"),it(10,"Precio:"),xe(),it(11),xe()(),Ae(12,"li",5)(13,"p")(14,"b"),it(15,"Ba\xf1o compartido:"),xe(),it(16),xe()(),Ae(17,"li",5)(18,"p")(19,"b"),it(20,"Regi\xf3n:"),xe(),it(21),xe()(),Ae(22,"li",5)(23,"p")(24,"b"),it(25,"Comuna:"),xe(),it(26),xe()(),Ae(27,"li",5)(28,"p")(29,"b"),it(30,"Tipo de residencia:"),xe(),it(31),xe()(),Ae(32,"li",5)(33,"p")(34,"b"),it(35,"Fecha de publicaci\xf3n:"),xe(),it(36),dD(37,"date"),xe()()()(),Ae(38,"span",6),it(39," - "),xe()),2&t&&(Et(3),MM("",i.roomService.selectedRoom.ciudad,"",", ","",i.roomService.selectedRoom.comuna,"",", ","",i.roomService.selectedRoom.calle,""),Et(2),Qs(i.roomService.selectedRoom.descripcion),Et(6),Vo(" ",i.roomService.selectedRoom.precio,""),Et(5),Vo(" ",i.banio_compartido,""),Et(5),Vo(" ",i.roomService.selectedRoom.region,""),Et(5),Vo(" ",i.roomService.selectedRoom.comuna,""),Et(5),Vo(" ",i.roomService.selectedRoom.casa_depto,""),Et(5),Vo(" ",hD(37,12,i.roomService.selectedRoom.fecha_publicacion),""))},dependencies:[YD],styles:[".mat-raised-button[_ngcontent-%COMP%]{width:100%}.salto-linea[_ngcontent-%COMP%]{font-size:0;display:block}.mat-card-content[_ngcontent-%COMP%]{padding:7%}.icon-card[_ngcontent-%COMP%]{padding-top:5%}.footer-card[_ngcontent-%COMP%]{padding-right:5%;text-align:right;color:gray}.texto-titulo[_ngcontent-%COMP%]{font-weight:700}"]}),n})();var dS=Op(898);let oQ=(()=>{class n{constructor(t,i){this.activaterouter=t,this.roomService=i,this.longitud=0,this.latitud=0}ngOnInit(){this.latitud=Number(this.roomService.selectedRoom.latitud),this.longitud=Number(this.roomService.selectedRoom.longitud)}ngAfterViewInit(){dS.accessToken="pk.eyJ1IjoicGFuZGEyNjA5IiwiYSI6ImNsYjVoNmtybjAyd3Ezb3A1YXg5M2YyM2sifQ.JFMZFCHeS-X-lMj8SUsxzA",this.mapa=new dS.Map({container:"mapa_mapbox",style:"mapbox://styles/mapbox/streets-v10",center:[this.latitud,this.longitud],zoom:16}),this.mapa.addControl(new dS.NavigationControl),this.crearMarcador(this.latitud,this.longitud)}crearMarcador(t,i){new dS.Marker({draggable:!1}).setLngLat([t,i]).addTo(this.mapa)}}return n.\u0275fac=function(t){return new(t||n)(Ie(md),Ie(Iv))},n.\u0275cmp=Qn({type:n,selectors:[["app-map"]],decls:6,vars:0,consts:[["href","https://api.mapbox.com/mapbox-gl-js/v2.8.1/mapbox-gl.css","rel","stylesheet"],["id","mapa_mapbox"]],template:function(t,i){1&t&&(Ae(0,"head"),jt(1,"link",0),xe(),Ae(2,"body"),jt(3,"div",1),xe(),Ae(4,"span"),it(5," - "),xe())},styles:["#mapa_mapbox[_ngcontent-%COMP%]{width:100%;height:100%}"]}),n})();function Pz(n,e,t,i,r,s,c){try{var d=n[s](c),m=d.value}catch(y){return void t(y)}d.done?e(m):Promise.resolve(m).then(i,r)}const bl=1001,So=1003,Eo=1006,$g=1008,Wg=1009,qg=1014,um=1015,cw=1016,Nv=1020,pu=1023,Zg=1026,Bv=1027,Xg=3e3,vs=3001,ih="srgb",uw="srgb-linear",pV="display-p3";class Kg{addEventListener(e,t){void 0===this._listeners&&(this._listeners={});const i=this._listeners;void 0===i[e]&&(i[e]=[]),-1===i[e].indexOf(t)&&i[e].push(t)}hasEventListener(e,t){if(void 0===this._listeners)return!1;const i=this._listeners;return void 0!==i[e]&&-1!==i[e].indexOf(t)}removeEventListener(e,t){if(void 0===this._listeners)return;const r=this._listeners[e];if(void 0!==r){const s=r.indexOf(t);-1!==s&&r.splice(s,1)}}dispatchEvent(e){if(void 0===this._listeners)return;const i=this._listeners[e.type];if(void 0!==i){e.target=this;const r=i.slice(0);for(let s=0,c=r.length;s<c;s++)r[s].call(this,e);e.target=null}}}const Za=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"],Qg=Math.PI/180,dw=180/Math.PI;function Cc(){const n=4294967295*Math.random()|0,e=4294967295*Math.random()|0,t=4294967295*Math.random()|0,i=4294967295*Math.random()|0;return(Za[255&n]+Za[n>>8&255]+Za[n>>16&255]+Za[n>>24&255]+"-"+Za[255&e]+Za[e>>8&255]+"-"+Za[e>>16&15|64]+Za[e>>24&255]+"-"+Za[63&t|128]+Za[t>>8&255]+"-"+Za[t>>16&255]+Za[t>>24&255]+Za[255&i]+Za[i>>8&255]+Za[i>>16&255]+Za[i>>24&255]).toLowerCase()}function to(n,e,t){return Math.max(e,Math.min(t,n))}function hw(n,e,t){return(1-t)*n+t*e}function d2(n){return 0==(n&n-1)&&0!==n}function _V(n){return Math.pow(2,Math.floor(Math.log(n)/Math.LN2))}function wp(n,e){switch(e.constructor){case Float32Array:return n;case Uint16Array:return n/65535;case Uint8Array:return n/255;case Int16Array:return Math.max(n/32767,-1);case Int8Array:return Math.max(n/127,-1);default:throw new Error("Invalid component type.")}}function os(n,e){switch(e.constructor){case Float32Array:return n;case Uint16Array:return Math.round(65535*n);case Uint8Array:return Math.round(255*n);case Int16Array:return Math.round(32767*n);case Int8Array:return Math.round(127*n);default:throw new Error("Invalid component type.")}}class Pt{constructor(e=0,t=0){Pt.prototype.isVector2=!0,this.x=e,this.y=t}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,t){return this.x=e,this.y=t,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const t=this.x,i=this.y,r=e.elements;return this.x=r[0]*t+r[3]*i+r[6],this.y=r[1]*t+r[4]*i+r[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this}clampLength(e,t){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,i=this.y-e.y;return t*t+i*i}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this}rotateAround(e,t){const i=Math.cos(t),r=Math.sin(t),s=this.x-e.x,c=this.y-e.y;return this.x=s*i-c*r+e.x,this.y=s*r+c*i+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class Xa{constructor(){Xa.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1]}set(e,t,i,r,s,c,d,m,y){const w=this.elements;return w[0]=e,w[1]=r,w[2]=d,w[3]=t,w[4]=s,w[5]=m,w[6]=i,w[7]=c,w[8]=y,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const t=this.elements,i=e.elements;return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t[4]=i[4],t[5]=i[5],t[6]=i[6],t[7]=i[7],t[8]=i[8],this}extractBasis(e,t,i){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),i.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const i=e.elements,r=t.elements,s=this.elements,c=i[0],d=i[3],m=i[6],y=i[1],w=i[4],S=i[7],T=i[2],I=i[5],R=i[8],k=r[0],F=r[3],G=r[6],W=r[1],V=r[4],X=r[7],ee=r[2],ae=r[5],Ee=r[8];return s[0]=c*k+d*W+m*ee,s[3]=c*F+d*V+m*ae,s[6]=c*G+d*X+m*Ee,s[1]=y*k+w*W+S*ee,s[4]=y*F+w*V+S*ae,s[7]=y*G+w*X+S*Ee,s[2]=T*k+I*W+R*ee,s[5]=T*F+I*V+R*ae,s[8]=T*G+I*X+R*Ee,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}determinant(){const e=this.elements,t=e[0],i=e[1],r=e[2],s=e[3],c=e[4],d=e[5],m=e[6],y=e[7],w=e[8];return t*c*w-t*d*y-i*s*w+i*d*m+r*s*y-r*c*m}invert(){const e=this.elements,t=e[0],i=e[1],r=e[2],s=e[3],c=e[4],d=e[5],m=e[6],y=e[7],w=e[8],S=w*c-d*y,T=d*m-w*s,I=y*s-c*m,R=t*S+i*T+r*I;if(0===R)return this.set(0,0,0,0,0,0,0,0,0);const k=1/R;return e[0]=S*k,e[1]=(r*y-w*i)*k,e[2]=(d*i-r*c)*k,e[3]=T*k,e[4]=(w*t-r*m)*k,e[5]=(r*s-d*t)*k,e[6]=I*k,e[7]=(i*m-y*t)*k,e[8]=(c*t-i*s)*k,this}transpose(){let e;const t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}setUvTransform(e,t,i,r,s,c,d){const m=Math.cos(s),y=Math.sin(s);return this.set(i*m,i*y,-i*(m*c+y*d)+c+e,-r*y,r*m,-r*(-y*c+m*d)+d+t,0,0,1),this}scale(e,t){return this.premultiply(h2.makeScale(e,t)),this}rotate(e){return this.premultiply(h2.makeRotation(-e)),this}translate(e,t){return this.premultiply(h2.makeTranslation(e,t)),this}makeTranslation(e,t){return this.set(1,0,e,0,1,t,0,0,1),this}makeRotation(e){const t=Math.cos(e),i=Math.sin(e);return this.set(t,-i,0,i,t,0,0,0,1),this}makeScale(e,t){return this.set(e,0,0,0,t,0,0,0,1),this}equals(e){const t=this.elements,i=e.elements;for(let r=0;r<9;r++)if(t[r]!==i[r])return!1;return!0}fromArray(e,t=0){for(let i=0;i<9;i++)this.elements[i]=e[i+t];return this}toArray(e=[],t=0){const i=this.elements;return e[t]=i[0],e[t+1]=i[1],e[t+2]=i[2],e[t+3]=i[3],e[t+4]=i[4],e[t+5]=i[5],e[t+6]=i[6],e[t+7]=i[7],e[t+8]=i[8],e}clone(){return(new this.constructor).fromArray(this.elements)}}const h2=new Xa;function yV(n){for(let e=n.length-1;e>=0;--e)if(n[e]>=65535)return!0;return!1}function pw(n){return document.createElementNS("http://www.w3.org/1999/xhtml",n)}Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array;class wl{constructor(e=0,t=0,i=0,r=1){this.isQuaternion=!0,this._x=e,this._y=t,this._z=i,this._w=r}static slerpFlat(e,t,i,r,s,c,d){let m=i[r+0],y=i[r+1],w=i[r+2],S=i[r+3];const T=s[c+0],I=s[c+1],R=s[c+2],k=s[c+3];if(0===d)return e[t+0]=m,e[t+1]=y,e[t+2]=w,void(e[t+3]=S);if(1===d)return e[t+0]=T,e[t+1]=I,e[t+2]=R,void(e[t+3]=k);if(S!==k||m!==T||y!==I||w!==R){let F=1-d;const G=m*T+y*I+w*R+S*k,W=G>=0?1:-1,V=1-G*G;if(V>Number.EPSILON){const ee=Math.sqrt(V),ae=Math.atan2(ee,G*W);F=Math.sin(F*ae)/ee,d=Math.sin(d*ae)/ee}const X=d*W;if(m=m*F+T*X,y=y*F+I*X,w=w*F+R*X,S=S*F+k*X,F===1-d){const ee=1/Math.sqrt(m*m+y*y+w*w+S*S);m*=ee,y*=ee,w*=ee,S*=ee}}e[t]=m,e[t+1]=y,e[t+2]=w,e[t+3]=S}static multiplyQuaternionsFlat(e,t,i,r,s,c){const d=i[r],m=i[r+1],y=i[r+2],w=i[r+3],S=s[c],T=s[c+1],I=s[c+2],R=s[c+3];return e[t]=d*R+w*S+m*I-y*T,e[t+1]=m*R+w*T+y*S-d*I,e[t+2]=y*R+w*I+d*T-m*S,e[t+3]=w*R-d*S-m*T-y*I,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,t,i,r){return this._x=e,this._y=t,this._z=i,this._w=r,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,t){const i=e._x,r=e._y,s=e._z,c=e._order,d=Math.cos,m=Math.sin,y=d(i/2),w=d(r/2),S=d(s/2),T=m(i/2),I=m(r/2),R=m(s/2);switch(c){case"XYZ":this._x=T*w*S+y*I*R,this._y=y*I*S-T*w*R,this._z=y*w*R+T*I*S,this._w=y*w*S-T*I*R;break;case"YXZ":this._x=T*w*S+y*I*R,this._y=y*I*S-T*w*R,this._z=y*w*R-T*I*S,this._w=y*w*S+T*I*R;break;case"ZXY":this._x=T*w*S-y*I*R,this._y=y*I*S+T*w*R,this._z=y*w*R+T*I*S,this._w=y*w*S-T*I*R;break;case"ZYX":this._x=T*w*S-y*I*R,this._y=y*I*S+T*w*R,this._z=y*w*R-T*I*S,this._w=y*w*S+T*I*R;break;case"YZX":this._x=T*w*S+y*I*R,this._y=y*I*S+T*w*R,this._z=y*w*R-T*I*S,this._w=y*w*S-T*I*R;break;case"XZY":this._x=T*w*S-y*I*R,this._y=y*I*S-T*w*R,this._z=y*w*R+T*I*S,this._w=y*w*S+T*I*R;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+c)}return!1!==t&&this._onChangeCallback(),this}setFromAxisAngle(e,t){const i=t/2,r=Math.sin(i);return this._x=e.x*r,this._y=e.y*r,this._z=e.z*r,this._w=Math.cos(i),this._onChangeCallback(),this}setFromRotationMatrix(e){const t=e.elements,i=t[0],r=t[4],s=t[8],c=t[1],d=t[5],m=t[9],y=t[2],w=t[6],S=t[10],T=i+d+S;if(T>0){const I=.5/Math.sqrt(T+1);this._w=.25/I,this._x=(w-m)*I,this._y=(s-y)*I,this._z=(c-r)*I}else if(i>d&&i>S){const I=2*Math.sqrt(1+i-d-S);this._w=(w-m)/I,this._x=.25*I,this._y=(r+c)/I,this._z=(s+y)/I}else if(d>S){const I=2*Math.sqrt(1+d-i-S);this._w=(s-y)/I,this._x=(r+c)/I,this._y=.25*I,this._z=(m+w)/I}else{const I=2*Math.sqrt(1+S-i-d);this._w=(c-r)/I,this._x=(s+y)/I,this._y=(m+w)/I,this._z=.25*I}return this._onChangeCallback(),this}setFromUnitVectors(e,t){let i=e.dot(t)+1;return i<Number.EPSILON?(i=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=i):(this._x=0,this._y=-e.z,this._z=e.y,this._w=i)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=i),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(to(this.dot(e),-1,1)))}rotateTowards(e,t){const i=this.angleTo(e);if(0===i)return this;const r=Math.min(1,t/i);return this.slerp(e,r),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return 0===e?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e){return this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,t){const i=e._x,r=e._y,s=e._z,c=e._w,d=t._x,m=t._y,y=t._z,w=t._w;return this._x=i*w+c*d+r*y-s*m,this._y=r*w+c*m+s*d-i*y,this._z=s*w+c*y+i*m-r*d,this._w=c*w-i*d-r*m-s*y,this._onChangeCallback(),this}slerp(e,t){if(0===t)return this;if(1===t)return this.copy(e);const i=this._x,r=this._y,s=this._z,c=this._w;let d=c*e._w+i*e._x+r*e._y+s*e._z;if(d<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,d=-d):this.copy(e),d>=1)return this._w=c,this._x=i,this._y=r,this._z=s,this;const m=1-d*d;if(m<=Number.EPSILON){const I=1-t;return this._w=I*c+t*this._w,this._x=I*i+t*this._x,this._y=I*r+t*this._y,this._z=I*s+t*this._z,this.normalize(),this._onChangeCallback(),this}const y=Math.sqrt(m),w=Math.atan2(y,d),S=Math.sin((1-t)*w)/y,T=Math.sin(t*w)/y;return this._w=c*S+this._w*T,this._x=i*S+this._x*T,this._y=r*S+this._y*T,this._z=s*S+this._z*T,this._onChangeCallback(),this}slerpQuaternions(e,t,i){return this.copy(e).slerp(t,i)}random(){const e=Math.random(),t=Math.sqrt(1-e),i=Math.sqrt(e),r=2*Math.PI*Math.random(),s=2*Math.PI*Math.random();return this.set(t*Math.cos(r),i*Math.sin(s),i*Math.cos(s),t*Math.sin(r))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,t=0){return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}fromBufferAttribute(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class _e{constructor(e=0,t=0,i=0){_e.prototype.isVector3=!0,this.x=e,this.y=t,this.z=i}set(e,t,i){return void 0===i&&(i=this.z),this.x=e,this.y=t,this.z=i,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}applyEuler(e){return this.applyQuaternion(vV.setFromEuler(e))}applyAxisAngle(e,t){return this.applyQuaternion(vV.setFromAxisAngle(e,t))}applyMatrix3(e){const t=this.x,i=this.y,r=this.z,s=e.elements;return this.x=s[0]*t+s[3]*i+s[6]*r,this.y=s[1]*t+s[4]*i+s[7]*r,this.z=s[2]*t+s[5]*i+s[8]*r,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const t=this.x,i=this.y,r=this.z,s=e.elements,c=1/(s[3]*t+s[7]*i+s[11]*r+s[15]);return this.x=(s[0]*t+s[4]*i+s[8]*r+s[12])*c,this.y=(s[1]*t+s[5]*i+s[9]*r+s[13])*c,this.z=(s[2]*t+s[6]*i+s[10]*r+s[14])*c,this}applyQuaternion(e){const t=this.x,i=this.y,r=this.z,s=e.x,c=e.y,d=e.z,m=e.w,y=m*t+c*r-d*i,w=m*i+d*t-s*r,S=m*r+s*i-c*t,T=-s*t-c*i-d*r;return this.x=y*m+T*-s+w*-d-S*-c,this.y=w*m+T*-c+S*-s-y*-d,this.z=S*m+T*-d+y*-c-w*-s,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){const t=this.x,i=this.y,r=this.z,s=e.elements;return this.x=s[0]*t+s[4]*i+s[8]*r,this.y=s[1]*t+s[5]*i+s[9]*r,this.z=s[2]*t+s[6]*i+s[10]*r,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this}clampLength(e,t){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this.z=e.z+(t.z-e.z)*i,this}cross(e){return this.crossVectors(this,e)}crossVectors(e,t){const i=e.x,r=e.y,s=e.z,c=t.x,d=t.y,m=t.z;return this.x=r*m-s*d,this.y=s*c-i*m,this.z=i*d-r*c,this}projectOnVector(e){const t=e.lengthSq();if(0===t)return this.set(0,0,0);const i=e.dot(this)/t;return this.copy(e).multiplyScalar(i)}projectOnPlane(e){return p2.copy(this).projectOnVector(e),this.sub(p2)}reflect(e){return this.sub(p2.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(0===t)return Math.PI/2;const i=this.dot(e)/t;return Math.acos(to(i,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,i=this.y-e.y,r=this.z-e.z;return t*t+i*i+r*r}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,t,i){const r=Math.sin(t)*e;return this.x=r*Math.sin(i),this.y=Math.cos(t)*e,this.z=r*Math.cos(i),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,t,i){return this.x=e*Math.sin(t),this.y=i,this.z=e*Math.cos(t),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}setFromMatrixScale(e){const t=this.setFromMatrixColumn(e,0).length(),i=this.setFromMatrixColumn(e,1).length(),r=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=i,this.z=r,this}setFromMatrixColumn(e,t){return this.fromArray(e.elements,4*t)}setFromMatrix3Column(e,t){return this.fromArray(e.elements,3*t)}setFromEuler(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const e=2*(Math.random()-.5),t=Math.random()*Math.PI*2,i=Math.sqrt(1-e**2);return this.x=i*Math.cos(t),this.y=i*Math.sin(t),this.z=e,this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const p2=new _e,vV=new wl;function Hv(n){return n<.04045?.0773993808*n:Math.pow(.9478672986*n+.0521327014,2.4)}function f2(n){return n<.0031308?12.92*n:1.055*Math.pow(n,.41666)-.055}const vJ=(new Xa).fromArray([.8224621,.0331941,.0170827,.177538,.9668058,.0723974,-1e-7,1e-7,.9105199]),xJ=(new Xa).fromArray([1.2249401,-.0420569,-.0196376,-.2249404,1.0420571,-.0786361,1e-7,0,1.0982735]),dm=new _e,MJ={[uw]:n=>n,[ih]:n=>n.convertSRGBToLinear(),[pV]:function bJ(n){return n.convertSRGBToLinear(),dm.set(n.r,n.g,n.b).applyMatrix3(xJ),n.setRGB(dm.x,dm.y,dm.z)}},CJ={[uw]:n=>n,[ih]:n=>n.convertLinearToSRGB(),[pV]:function wJ(n){return dm.set(n.r,n.g,n.b).applyMatrix3(vJ),n.setRGB(dm.x,dm.y,dm.z).convertLinearToSRGB()}},Ml={enabled:!1,get legacyMode(){return console.warn("THREE.ColorManagement: .legacyMode=false renamed to .enabled=true in r150."),!this.enabled},set legacyMode(n){console.warn("THREE.ColorManagement: .legacyMode=false renamed to .enabled=true in r150."),this.enabled=!n},get workingColorSpace(){return uw},set workingColorSpace(n){console.warn("THREE.ColorManagement: .workingColorSpace is readonly.")},convert:function(n,e,t){if(!1===this.enabled||e===t||!e||!t)return n;const i=MJ[e],r=CJ[t];if(void 0===i||void 0===r)throw new Error(`Unsupported color space conversion, "${e}" to "${t}".`);return r(i(n))},fromWorkingColorSpace:function(n,e){return this.convert(n,this.workingColorSpace,e)},toWorkingColorSpace:function(n,e){return this.convert(n,e,this.workingColorSpace)}};let Gv;class xV{static getDataURL(e){if(/^data:/i.test(e.src)||typeof HTMLCanvasElement>"u")return e.src;let t;if(e instanceof HTMLCanvasElement)t=e;else{void 0===Gv&&(Gv=pw("canvas")),Gv.width=e.width,Gv.height=e.height;const i=Gv.getContext("2d");e instanceof ImageData?i.putImageData(e,0,0):i.drawImage(e,0,0,e.width,e.height),t=Gv}return t.width>2048||t.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",e),t.toDataURL("image/jpeg",.6)):t.toDataURL("image/png")}static sRGBToLinear(e){if(typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&e instanceof ImageBitmap){const t=pw("canvas");t.width=e.width,t.height=e.height;const i=t.getContext("2d");i.drawImage(e,0,0,e.width,e.height);const r=i.getImageData(0,0,e.width,e.height),s=r.data;for(let c=0;c<s.length;c++)s[c]=255*Hv(s[c]/255);return i.putImageData(r,0,0),t}if(e.data){const t=e.data.slice(0);for(let i=0;i<t.length;i++)t[i]=t instanceof Uint8Array||t instanceof Uint8ClampedArray?Math.floor(255*Hv(t[i]/255)):Hv(t[i]);return{data:t,width:e.width,height:e.height}}return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),e}}class jv{constructor(e=null){this.isSource=!0,this.uuid=Cc(),this.data=e,this.version=0}set needsUpdate(e){!0===e&&this.version++}toJSON(e){const t=void 0===e||"string"==typeof e;if(!t&&void 0!==e.images[this.uuid])return e.images[this.uuid];const i={uuid:this.uuid,url:""},r=this.data;if(null!==r){let s;if(Array.isArray(r)){s=[];for(let c=0,d=r.length;c<d;c++)s.push(m2(r[c].isDataTexture?r[c].image:r[c]))}else s=m2(r);i.url=s}return t||(e.images[this.uuid]=i),i}}function m2(n){return typeof HTMLImageElement<"u"&&n instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&n instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&n instanceof ImageBitmap?xV.getDataURL(n):n.data?{data:Array.from(n.data),width:n.width,height:n.height,type:n.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let SJ=0,hm=(()=>{class n extends Kg{constructor(t=n.DEFAULT_IMAGE,i=n.DEFAULT_MAPPING,r=bl,s=bl,c=Eo,d=$g,m=pu,y=Wg,w=n.DEFAULT_ANISOTROPY,S=Xg){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:SJ++}),this.uuid=Cc(),this.name="",this.source=new jv(t),this.mipmaps=[],this.mapping=i,this.wrapS=r,this.wrapT=s,this.magFilter=c,this.minFilter=d,this.anisotropy=w,this.format=m,this.internalFormat=null,this.type=y,this.offset=new Pt(0,0),this.repeat=new Pt(1,1),this.center=new Pt(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Xa,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=S,this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.needsPMREMUpdate=!1}get image(){return this.source.data}set image(t=null){this.source.data=t}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return(new this.constructor).copy(this)}copy(t){return this.name=t.name,this.source=t.source,this.mipmaps=t.mipmaps.slice(0),this.mapping=t.mapping,this.wrapS=t.wrapS,this.wrapT=t.wrapT,this.magFilter=t.magFilter,this.minFilter=t.minFilter,this.anisotropy=t.anisotropy,this.format=t.format,this.internalFormat=t.internalFormat,this.type=t.type,this.offset.copy(t.offset),this.repeat.copy(t.repeat),this.center.copy(t.center),this.rotation=t.rotation,this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrix.copy(t.matrix),this.generateMipmaps=t.generateMipmaps,this.premultiplyAlpha=t.premultiplyAlpha,this.flipY=t.flipY,this.unpackAlignment=t.unpackAlignment,this.encoding=t.encoding,this.userData=JSON.parse(JSON.stringify(t.userData)),this.needsUpdate=!0,this}toJSON(t){const i=void 0===t||"string"==typeof t;if(!i&&void 0!==t.textures[this.uuid])return t.textures[this.uuid];const r={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(t).uuid,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(r.userData=this.userData),i||(t.textures[this.uuid]=r),r}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(t){if(300!==this.mapping)return t;if(t.applyMatrix3(this.matrix),t.x<0||t.x>1)switch(this.wrapS){case 1e3:t.x=t.x-Math.floor(t.x);break;case bl:t.x=t.x<0?0:1;break;case 1002:t.x=1===Math.abs(Math.floor(t.x)%2)?Math.ceil(t.x)-t.x:t.x-Math.floor(t.x)}if(t.y<0||t.y>1)switch(this.wrapT){case 1e3:t.y=t.y-Math.floor(t.y);break;case bl:t.y=t.y<0?0:1;break;case 1002:t.y=1===Math.abs(Math.floor(t.y)%2)?Math.ceil(t.y)-t.y:t.y-Math.floor(t.y)}return this.flipY&&(t.y=1-t.y),t}set needsUpdate(t){!0===t&&(this.version++,this.source.needsUpdate=!0)}}return n.DEFAULT_IMAGE=null,n.DEFAULT_MAPPING=300,n.DEFAULT_ANISOTROPY=1,n})();class Qr{constructor(e=0,t=0,i=0,r=1){Qr.prototype.isVector4=!0,this.x=e,this.y=t,this.z=i,this.w=r}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,t,i,r){return this.x=e,this.y=t,this.z=i,this.w=r,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=void 0!==e.w?e.w:1,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){const t=this.x,i=this.y,r=this.z,s=this.w,c=e.elements;return this.x=c[0]*t+c[4]*i+c[8]*r+c[12]*s,this.y=c[1]*t+c[5]*i+c[9]*r+c[13]*s,this.z=c[2]*t+c[6]*i+c[10]*r+c[14]*s,this.w=c[3]*t+c[7]*i+c[11]*r+c[15]*s,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);const t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}setAxisAngleFromRotationMatrix(e){let t,i,r,s;const m=e.elements,y=m[0],w=m[4],S=m[8],T=m[1],I=m[5],R=m[9],k=m[2],F=m[6],G=m[10];if(Math.abs(w-T)<.01&&Math.abs(S-k)<.01&&Math.abs(R-F)<.01){if(Math.abs(w+T)<.1&&Math.abs(S+k)<.1&&Math.abs(R+F)<.1&&Math.abs(y+I+G-3)<.1)return this.set(1,0,0,0),this;t=Math.PI;const V=(y+1)/2,X=(I+1)/2,ee=(G+1)/2,ae=(w+T)/4,Ee=(S+k)/4,J=(R+F)/4;return V>X&&V>ee?V<.01?(i=0,r=.707106781,s=.707106781):(i=Math.sqrt(V),r=ae/i,s=Ee/i):X>ee?X<.01?(i=.707106781,r=0,s=.707106781):(r=Math.sqrt(X),i=ae/r,s=J/r):ee<.01?(i=.707106781,r=.707106781,s=0):(s=Math.sqrt(ee),i=Ee/s,r=J/s),this.set(i,r,s,t),this}let W=Math.sqrt((F-R)*(F-R)+(S-k)*(S-k)+(T-w)*(T-w));return Math.abs(W)<.001&&(W=1),this.x=(F-R)/W,this.y=(S-k)/W,this.z=(T-w)/W,this.w=Math.acos((y+I+G-1)/2),this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this.w=Math.max(e.w,Math.min(t.w,this.w)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this.w=Math.max(e,Math.min(t,this.w)),this}clampLength(e,t){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this.z=e.z+(t.z-e.z)*i,this.w=e.w+(t.w-e.w)*i,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class Jg extends Kg{constructor(e=1,t=1,i={}){super(),this.isWebGLRenderTarget=!0,this.width=e,this.height=t,this.depth=1,this.scissor=new Qr(0,0,e,t),this.scissorTest=!1,this.viewport=new Qr(0,0,e,t),this.texture=new hm({width:e,height:t,depth:1},i.mapping,i.wrapS,i.wrapT,i.magFilter,i.minFilter,i.format,i.type,i.anisotropy,i.encoding),this.texture.isRenderTargetTexture=!0,this.texture.flipY=!1,this.texture.generateMipmaps=void 0!==i.generateMipmaps&&i.generateMipmaps,this.texture.internalFormat=void 0!==i.internalFormat?i.internalFormat:null,this.texture.minFilter=void 0!==i.minFilter?i.minFilter:Eo,this.depthBuffer=void 0===i.depthBuffer||i.depthBuffer,this.stencilBuffer=void 0!==i.stencilBuffer&&i.stencilBuffer,this.depthTexture=void 0!==i.depthTexture?i.depthTexture:null,this.samples=void 0!==i.samples?i.samples:0}setSize(e,t,i=1){(this.width!==e||this.height!==t||this.depth!==i)&&(this.width=e,this.height=t,this.depth=i,this.texture.image.width=e,this.texture.image.height=t,this.texture.image.depth=i,this.dispose()),this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)}clone(){return(new this.constructor).copy(this)}copy(e){this.width=e.width,this.height=e.height,this.depth=e.depth,this.viewport.copy(e.viewport),this.texture=e.texture.clone(),this.texture.isRenderTargetTexture=!0;const t=Object.assign({},e.texture.image);return this.texture.source=new jv(t),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,null!==e.depthTexture&&(this.depthTexture=e.depthTexture.clone()),this.samples=e.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}class g2 extends hm{constructor(e=null,t=1,i=1,r=1){super(null),this.isDataArrayTexture=!0,this.image={data:e,width:t,height:i,depth:r},this.magFilter=So,this.minFilter=So,this.wrapR=bl,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class bV extends hm{constructor(e=null,t=1,i=1,r=1){super(null),this.isData3DTexture=!0,this.image={data:e,width:t,height:i,depth:r},this.magFilter=So,this.minFilter=So,this.wrapR=bl,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class $v{constructor(e=new _e(1/0,1/0,1/0),t=new _e(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromArray(e){let t=1/0,i=1/0,r=1/0,s=-1/0,c=-1/0,d=-1/0;for(let m=0,y=e.length;m<y;m+=3){const w=e[m],S=e[m+1],T=e[m+2];w<t&&(t=w),S<i&&(i=S),T<r&&(r=T),w>s&&(s=w),S>c&&(c=S),T>d&&(d=T)}return this.min.set(t,i,r),this.max.set(s,c,d),this}setFromBufferAttribute(e){let t=1/0,i=1/0,r=1/0,s=-1/0,c=-1/0,d=-1/0;for(let m=0,y=e.count;m<y;m++){const w=e.getX(m),S=e.getY(m),T=e.getZ(m);w<t&&(t=w),S<i&&(i=S),T<r&&(r=T),w>s&&(s=w),S>c&&(c=S),T>d&&(d=T)}return this.min.set(t,i,r),this.max.set(s,c,d),this}setFromPoints(e){this.makeEmpty();for(let t=0,i=e.length;t<i;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const i=e_.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(i),this.max.copy(e).add(i),this}setFromObject(e,t=!1){return this.makeEmpty(),this.expandByObject(e,t)}clone(){return(new this.constructor).copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e,t=!1){e.updateWorldMatrix(!1,!1);const i=e.geometry;if(void 0!==i)if(t&&null!=i.attributes&&void 0!==i.attributes.position){const s=i.attributes.position;for(let c=0,d=s.count;c<d;c++)e_.fromBufferAttribute(s,c).applyMatrix4(e.matrixWorld),this.expandByPoint(e_)}else null===i.boundingBox&&i.computeBoundingBox(),_2.copy(i.boundingBox),_2.applyMatrix4(e.matrixWorld),this.union(_2);const r=e.children;for(let s=0,c=r.length;s<c;s++)this.expandByObject(r[s],t);return this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)}intersectsSphere(e){return this.clampPoint(e.center,e_),e_.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let t,i;return e.normal.x>0?(t=e.normal.x*this.min.x,i=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,i=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,i+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,i+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,i+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,i+=e.normal.z*this.min.z),t<=-e.constant&&i>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(fw),wS.subVectors(this.max,fw),Wv.subVectors(e.a,fw),qv.subVectors(e.b,fw),Zv.subVectors(e.c,fw),pm.subVectors(qv,Wv),fm.subVectors(Zv,qv),t_.subVectors(Wv,Zv);let t=[0,-pm.z,pm.y,0,-fm.z,fm.y,0,-t_.z,t_.y,pm.z,0,-pm.x,fm.z,0,-fm.x,t_.z,0,-t_.x,-pm.y,pm.x,0,-fm.y,fm.x,0,-t_.y,t_.x,0];return!(!y2(t,Wv,qv,Zv,wS)||(t=[1,0,0,0,1,0,0,0,1],!y2(t,Wv,qv,Zv,wS)))&&(MS.crossVectors(pm,fm),t=[MS.x,MS.y,MS.z],y2(t,Wv,qv,Zv,wS))}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return this.clampPoint(e,e_).distanceTo(e)}getBoundingSphere(e){return this.isEmpty()?e.makeEmpty():(this.getCenter(e.center),e.radius=.5*this.getSize(e_).length()),e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()||(Mp[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),Mp[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),Mp[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),Mp[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),Mp[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),Mp[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),Mp[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),Mp[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(Mp)),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}const Mp=[new _e,new _e,new _e,new _e,new _e,new _e,new _e,new _e],e_=new _e,_2=new $v,Wv=new _e,qv=new _e,Zv=new _e,pm=new _e,fm=new _e,t_=new _e,fw=new _e,wS=new _e,MS=new _e,n_=new _e;function y2(n,e,t,i,r){for(let s=0,c=n.length-3;s<=c;s+=3){n_.fromArray(n,s);const d=r.x*Math.abs(n_.x)+r.y*Math.abs(n_.y)+r.z*Math.abs(n_.z),m=e.dot(n_),y=t.dot(n_),w=i.dot(n_);if(Math.max(-Math.max(m,y,w),Math.min(m,y,w))>d)return!1}return!0}const EJ=new $v,mw=new _e,v2=new _e;class Xv{constructor(e=new _e,t=-1){this.center=e,this.radius=t}set(e,t){return this.center.copy(e),this.radius=t,this}setFromPoints(e,t){const i=this.center;void 0!==t?i.copy(t):EJ.setFromPoints(e).getCenter(i);let r=0;for(let s=0,c=e.length;s<c;s++)r=Math.max(r,i.distanceToSquared(e[s]));return this.radius=Math.sqrt(r),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){const t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,t){const i=this.center.distanceToSquared(e);return t.copy(e),i>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}getBoundingBox(e){return this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){if(this.isEmpty())return this.center.copy(e),this.radius=0,this;mw.subVectors(e,this.center);const t=mw.lengthSq();if(t>this.radius*this.radius){const i=Math.sqrt(t),r=.5*(i-this.radius);this.center.addScaledVector(mw,r/i),this.radius+=r}return this}union(e){return e.isEmpty()?this:this.isEmpty()?(this.copy(e),this):(!0===this.center.equals(e.center)?this.radius=Math.max(this.radius,e.radius):(v2.subVectors(e.center,this.center).setLength(e.radius),this.expandByPoint(mw.copy(e.center).add(v2)),this.expandByPoint(mw.copy(e.center).sub(v2))),this)}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return(new this.constructor).copy(this)}}const Cp=new _e,x2=new _e,CS=new _e,mm=new _e,b2=new _e,SS=new _e,w2=new _e;class ES{constructor(e=new _e,t=new _e(0,0,-1)){this.origin=e,this.direction=t}set(e,t){return this.origin.copy(e),this.direction.copy(t),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,t){return t.copy(this.origin).addScaledVector(this.direction,e)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,Cp)),this}closestPointToPoint(e,t){t.subVectors(e,this.origin);const i=t.dot(this.direction);return i<0?t.copy(this.origin):t.copy(this.origin).addScaledVector(this.direction,i)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){const t=Cp.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(Cp.copy(this.origin).addScaledVector(this.direction,t),Cp.distanceToSquared(e))}distanceSqToSegment(e,t,i,r){x2.copy(e).add(t).multiplyScalar(.5),CS.copy(t).sub(e).normalize(),mm.copy(this.origin).sub(x2);const s=.5*e.distanceTo(t),c=-this.direction.dot(CS),d=mm.dot(this.direction),m=-mm.dot(CS),y=mm.lengthSq(),w=Math.abs(1-c*c);let S,T,I,R;if(w>0)if(S=c*m-d,T=c*d-m,R=s*w,S>=0)if(T>=-R)if(T<=R){const k=1/w;S*=k,T*=k,I=S*(S+c*T+2*d)+T*(c*S+T+2*m)+y}else T=s,S=Math.max(0,-(c*T+d)),I=-S*S+T*(T+2*m)+y;else T=-s,S=Math.max(0,-(c*T+d)),I=-S*S+T*(T+2*m)+y;else T<=-R?(S=Math.max(0,-(-c*s+d)),T=S>0?-s:Math.min(Math.max(-s,-m),s),I=-S*S+T*(T+2*m)+y):T<=R?(S=0,T=Math.min(Math.max(-s,-m),s),I=T*(T+2*m)+y):(S=Math.max(0,-(c*s+d)),T=S>0?s:Math.min(Math.max(-s,-m),s),I=-S*S+T*(T+2*m)+y);else T=c>0?-s:s,S=Math.max(0,-(c*T+d)),I=-S*S+T*(T+2*m)+y;return i&&i.copy(this.origin).addScaledVector(this.direction,S),r&&r.copy(x2).addScaledVector(CS,T),I}intersectSphere(e,t){Cp.subVectors(e.center,this.origin);const i=Cp.dot(this.direction),r=Cp.dot(Cp)-i*i,s=e.radius*e.radius;if(r>s)return null;const c=Math.sqrt(s-r),d=i-c,m=i+c;return m<0?null:this.at(d<0?m:d,t)}intersectsSphere(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){const t=e.normal.dot(this.direction);if(0===t)return 0===e.distanceToPoint(this.origin)?0:null;const i=-(this.origin.dot(e.normal)+e.constant)/t;return i>=0?i:null}intersectPlane(e,t){const i=this.distanceToPlane(e);return null===i?null:this.at(i,t)}intersectsPlane(e){const t=e.distanceToPoint(this.origin);return 0===t||e.normal.dot(this.direction)*t<0}intersectBox(e,t){let i,r,s,c,d,m;const y=1/this.direction.x,w=1/this.direction.y,S=1/this.direction.z,T=this.origin;return y>=0?(i=(e.min.x-T.x)*y,r=(e.max.x-T.x)*y):(i=(e.max.x-T.x)*y,r=(e.min.x-T.x)*y),w>=0?(s=(e.min.y-T.y)*w,c=(e.max.y-T.y)*w):(s=(e.max.y-T.y)*w,c=(e.min.y-T.y)*w),i>c||s>r||((s>i||isNaN(i))&&(i=s),(c<r||isNaN(r))&&(r=c),S>=0?(d=(e.min.z-T.z)*S,m=(e.max.z-T.z)*S):(d=(e.max.z-T.z)*S,m=(e.min.z-T.z)*S),i>m||d>r)||((d>i||i!=i)&&(i=d),(m<r||r!=r)&&(r=m),r<0)?null:this.at(i>=0?i:r,t)}intersectsBox(e){return null!==this.intersectBox(e,Cp)}intersectTriangle(e,t,i,r,s){b2.subVectors(t,e),SS.subVectors(i,e),w2.crossVectors(b2,SS);let d,c=this.direction.dot(w2);if(c>0){if(r)return null;d=1}else{if(!(c<0))return null;d=-1,c=-c}mm.subVectors(this.origin,e);const m=d*this.direction.dot(SS.crossVectors(mm,SS));if(m<0)return null;const y=d*this.direction.dot(b2.cross(mm));if(y<0||m+y>c)return null;const w=-d*mm.dot(w2);return w<0?null:this.at(w/c,s)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return(new this.constructor).copy(this)}}class Bi{constructor(){Bi.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}set(e,t,i,r,s,c,d,m,y,w,S,T,I,R,k,F){const G=this.elements;return G[0]=e,G[4]=t,G[8]=i,G[12]=r,G[1]=s,G[5]=c,G[9]=d,G[13]=m,G[2]=y,G[6]=w,G[10]=S,G[14]=T,G[3]=I,G[7]=R,G[11]=k,G[15]=F,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return(new Bi).fromArray(this.elements)}copy(e){const t=this.elements,i=e.elements;return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t[4]=i[4],t[5]=i[5],t[6]=i[6],t[7]=i[7],t[8]=i[8],t[9]=i[9],t[10]=i[10],t[11]=i[11],t[12]=i[12],t[13]=i[13],t[14]=i[14],t[15]=i[15],this}copyPosition(e){const t=this.elements,i=e.elements;return t[12]=i[12],t[13]=i[13],t[14]=i[14],this}setFromMatrix3(e){const t=e.elements;return this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1),this}extractBasis(e,t,i){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),i.setFromMatrixColumn(this,2),this}makeBasis(e,t,i){return this.set(e.x,t.x,i.x,0,e.y,t.y,i.y,0,e.z,t.z,i.z,0,0,0,0,1),this}extractRotation(e){const t=this.elements,i=e.elements,r=1/Yv.setFromMatrixColumn(e,0).length(),s=1/Yv.setFromMatrixColumn(e,1).length(),c=1/Yv.setFromMatrixColumn(e,2).length();return t[0]=i[0]*r,t[1]=i[1]*r,t[2]=i[2]*r,t[3]=0,t[4]=i[4]*s,t[5]=i[5]*s,t[6]=i[6]*s,t[7]=0,t[8]=i[8]*c,t[9]=i[9]*c,t[10]=i[10]*c,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromEuler(e){const t=this.elements,i=e.x,r=e.y,s=e.z,c=Math.cos(i),d=Math.sin(i),m=Math.cos(r),y=Math.sin(r),w=Math.cos(s),S=Math.sin(s);if("XYZ"===e.order){const T=c*w,I=c*S,R=d*w,k=d*S;t[0]=m*w,t[4]=-m*S,t[8]=y,t[1]=I+R*y,t[5]=T-k*y,t[9]=-d*m,t[2]=k-T*y,t[6]=R+I*y,t[10]=c*m}else if("YXZ"===e.order){const T=m*w,I=m*S,R=y*w,k=y*S;t[0]=T+k*d,t[4]=R*d-I,t[8]=c*y,t[1]=c*S,t[5]=c*w,t[9]=-d,t[2]=I*d-R,t[6]=k+T*d,t[10]=c*m}else if("ZXY"===e.order){const T=m*w,I=m*S,R=y*w,k=y*S;t[0]=T-k*d,t[4]=-c*S,t[8]=R+I*d,t[1]=I+R*d,t[5]=c*w,t[9]=k-T*d,t[2]=-c*y,t[6]=d,t[10]=c*m}else if("ZYX"===e.order){const T=c*w,I=c*S,R=d*w,k=d*S;t[0]=m*w,t[4]=R*y-I,t[8]=T*y+k,t[1]=m*S,t[5]=k*y+T,t[9]=I*y-R,t[2]=-y,t[6]=d*m,t[10]=c*m}else if("YZX"===e.order){const T=c*m,I=c*y,R=d*m,k=d*y;t[0]=m*w,t[4]=k-T*S,t[8]=R*S+I,t[1]=S,t[5]=c*w,t[9]=-d*w,t[2]=-y*w,t[6]=I*S+R,t[10]=T-k*S}else if("XZY"===e.order){const T=c*m,I=c*y,R=d*m,k=d*y;t[0]=m*w,t[4]=-S,t[8]=y*w,t[1]=T*S+k,t[5]=c*w,t[9]=I*S-R,t[2]=R*S-I,t[6]=d*w,t[10]=k*S+T}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromQuaternion(e){return this.compose(TJ,e,DJ)}lookAt(e,t,i){const r=this.elements;return Sc.subVectors(e,t),0===Sc.lengthSq()&&(Sc.z=1),Sc.normalize(),gm.crossVectors(i,Sc),0===gm.lengthSq()&&(1===Math.abs(i.z)?Sc.x+=1e-4:Sc.z+=1e-4,Sc.normalize(),gm.crossVectors(i,Sc)),gm.normalize(),TS.crossVectors(Sc,gm),r[0]=gm.x,r[4]=TS.x,r[8]=Sc.x,r[1]=gm.y,r[5]=TS.y,r[9]=Sc.y,r[2]=gm.z,r[6]=TS.z,r[10]=Sc.z,this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const i=e.elements,r=t.elements,s=this.elements,c=i[0],d=i[4],m=i[8],y=i[12],w=i[1],S=i[5],T=i[9],I=i[13],R=i[2],k=i[6],F=i[10],G=i[14],W=i[3],V=i[7],X=i[11],ee=i[15],ae=r[0],Ee=r[4],J=r[8],pe=r[12],Oe=r[1],st=r[5],xt=r[9],Qe=r[13],Ge=r[2],ft=r[6],qe=r[10],dt=r[14],Ye=r[3],gt=r[7],Ot=r[11],pn=r[15];return s[0]=c*ae+d*Oe+m*Ge+y*Ye,s[4]=c*Ee+d*st+m*ft+y*gt,s[8]=c*J+d*xt+m*qe+y*Ot,s[12]=c*pe+d*Qe+m*dt+y*pn,s[1]=w*ae+S*Oe+T*Ge+I*Ye,s[5]=w*Ee+S*st+T*ft+I*gt,s[9]=w*J+S*xt+T*qe+I*Ot,s[13]=w*pe+S*Qe+T*dt+I*pn,s[2]=R*ae+k*Oe+F*Ge+G*Ye,s[6]=R*Ee+k*st+F*ft+G*gt,s[10]=R*J+k*xt+F*qe+G*Ot,s[14]=R*pe+k*Qe+F*dt+G*pn,s[3]=W*ae+V*Oe+X*Ge+ee*Ye,s[7]=W*Ee+V*st+X*ft+ee*gt,s[11]=W*J+V*xt+X*qe+ee*Ot,s[15]=W*pe+V*Qe+X*dt+ee*pn,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}determinant(){const e=this.elements,t=e[0],i=e[4],r=e[8],s=e[12],c=e[1],d=e[5],m=e[9],y=e[13],w=e[2],S=e[6],T=e[10],I=e[14];return e[3]*(+s*m*S-r*y*S-s*d*T+i*y*T+r*d*I-i*m*I)+e[7]*(+t*m*I-t*y*T+s*c*T-r*c*I+r*y*w-s*m*w)+e[11]*(+t*y*S-t*d*I-s*c*S+i*c*I+s*d*w-i*y*w)+e[15]*(-r*d*w-t*m*S+t*d*T+r*c*S-i*c*T+i*m*w)}transpose(){const e=this.elements;let t;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this}setPosition(e,t,i){const r=this.elements;return e.isVector3?(r[12]=e.x,r[13]=e.y,r[14]=e.z):(r[12]=e,r[13]=t,r[14]=i),this}invert(){const e=this.elements,t=e[0],i=e[1],r=e[2],s=e[3],c=e[4],d=e[5],m=e[6],y=e[7],w=e[8],S=e[9],T=e[10],I=e[11],R=e[12],k=e[13],F=e[14],G=e[15],W=S*F*y-k*T*y+k*m*I-d*F*I-S*m*G+d*T*G,V=R*T*y-w*F*y-R*m*I+c*F*I+w*m*G-c*T*G,X=w*k*y-R*S*y+R*d*I-c*k*I-w*d*G+c*S*G,ee=R*S*m-w*k*m-R*d*T+c*k*T+w*d*F-c*S*F,ae=t*W+i*V+r*X+s*ee;if(0===ae)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const Ee=1/ae;return e[0]=W*Ee,e[1]=(k*T*s-S*F*s-k*r*I+i*F*I+S*r*G-i*T*G)*Ee,e[2]=(d*F*s-k*m*s+k*r*y-i*F*y-d*r*G+i*m*G)*Ee,e[3]=(S*m*s-d*T*s-S*r*y+i*T*y+d*r*I-i*m*I)*Ee,e[4]=V*Ee,e[5]=(w*F*s-R*T*s+R*r*I-t*F*I-w*r*G+t*T*G)*Ee,e[6]=(R*m*s-c*F*s-R*r*y+t*F*y+c*r*G-t*m*G)*Ee,e[7]=(c*T*s-w*m*s+w*r*y-t*T*y-c*r*I+t*m*I)*Ee,e[8]=X*Ee,e[9]=(R*S*s-w*k*s-R*i*I+t*k*I+w*i*G-t*S*G)*Ee,e[10]=(c*k*s-R*d*s+R*i*y-t*k*y-c*i*G+t*d*G)*Ee,e[11]=(w*d*s-c*S*s-w*i*y+t*S*y+c*i*I-t*d*I)*Ee,e[12]=ee*Ee,e[13]=(w*k*r-R*S*r+R*i*T-t*k*T-w*i*F+t*S*F)*Ee,e[14]=(R*d*r-c*k*r-R*i*m+t*k*m+c*i*F-t*d*F)*Ee,e[15]=(c*S*r-w*d*r+w*i*m-t*S*m-c*i*T+t*d*T)*Ee,this}scale(e){const t=this.elements,i=e.x,r=e.y,s=e.z;return t[0]*=i,t[4]*=r,t[8]*=s,t[1]*=i,t[5]*=r,t[9]*=s,t[2]*=i,t[6]*=r,t[10]*=s,t[3]*=i,t[7]*=r,t[11]*=s,this}getMaxScaleOnAxis(){const e=this.elements;return Math.sqrt(Math.max(e[0]*e[0]+e[1]*e[1]+e[2]*e[2],e[4]*e[4]+e[5]*e[5]+e[6]*e[6],e[8]*e[8]+e[9]*e[9]+e[10]*e[10]))}makeTranslation(e,t,i){return this.set(1,0,0,e,0,1,0,t,0,0,1,i,0,0,0,1),this}makeRotationX(e){const t=Math.cos(e),i=Math.sin(e);return this.set(1,0,0,0,0,t,-i,0,0,i,t,0,0,0,0,1),this}makeRotationY(e){const t=Math.cos(e),i=Math.sin(e);return this.set(t,0,i,0,0,1,0,0,-i,0,t,0,0,0,0,1),this}makeRotationZ(e){const t=Math.cos(e),i=Math.sin(e);return this.set(t,-i,0,0,i,t,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,t){const i=Math.cos(t),r=Math.sin(t),s=1-i,c=e.x,d=e.y,m=e.z,y=s*c,w=s*d;return this.set(y*c+i,y*d-r*m,y*m+r*d,0,y*d+r*m,w*d+i,w*m-r*c,0,y*m-r*d,w*m+r*c,s*m*m+i,0,0,0,0,1),this}makeScale(e,t,i){return this.set(e,0,0,0,0,t,0,0,0,0,i,0,0,0,0,1),this}makeShear(e,t,i,r,s,c){return this.set(1,i,s,0,e,1,c,0,t,r,1,0,0,0,0,1),this}compose(e,t,i){const r=this.elements,s=t._x,c=t._y,d=t._z,m=t._w,y=s+s,w=c+c,S=d+d,T=s*y,I=s*w,R=s*S,k=c*w,F=c*S,G=d*S,W=m*y,V=m*w,X=m*S,ee=i.x,ae=i.y,Ee=i.z;return r[0]=(1-(k+G))*ee,r[1]=(I+X)*ee,r[2]=(R-V)*ee,r[3]=0,r[4]=(I-X)*ae,r[5]=(1-(T+G))*ae,r[6]=(F+W)*ae,r[7]=0,r[8]=(R+V)*Ee,r[9]=(F-W)*Ee,r[10]=(1-(T+k))*Ee,r[11]=0,r[12]=e.x,r[13]=e.y,r[14]=e.z,r[15]=1,this}decompose(e,t,i){const r=this.elements;let s=Yv.set(r[0],r[1],r[2]).length();const c=Yv.set(r[4],r[5],r[6]).length(),d=Yv.set(r[8],r[9],r[10]).length();this.determinant()<0&&(s=-s),e.x=r[12],e.y=r[13],e.z=r[14],gd.copy(this);const y=1/s,w=1/c,S=1/d;return gd.elements[0]*=y,gd.elements[1]*=y,gd.elements[2]*=y,gd.elements[4]*=w,gd.elements[5]*=w,gd.elements[6]*=w,gd.elements[8]*=S,gd.elements[9]*=S,gd.elements[10]*=S,t.setFromRotationMatrix(gd),i.x=s,i.y=c,i.z=d,this}makePerspective(e,t,i,r,s,c){const d=this.elements,y=2*s/(i-r),w=(t+e)/(t-e),S=(i+r)/(i-r),T=-(c+s)/(c-s),I=-2*c*s/(c-s);return d[0]=2*s/(t-e),d[4]=0,d[8]=w,d[12]=0,d[1]=0,d[5]=y,d[9]=S,d[13]=0,d[2]=0,d[6]=0,d[10]=T,d[14]=I,d[3]=0,d[7]=0,d[11]=-1,d[15]=0,this}makeOrthographic(e,t,i,r,s,c){const d=this.elements,m=1/(t-e),y=1/(i-r),w=1/(c-s),S=(t+e)*m,T=(i+r)*y,I=(c+s)*w;return d[0]=2*m,d[4]=0,d[8]=0,d[12]=-S,d[1]=0,d[5]=2*y,d[9]=0,d[13]=-T,d[2]=0,d[6]=0,d[10]=-2*w,d[14]=-I,d[3]=0,d[7]=0,d[11]=0,d[15]=1,this}equals(e){const t=this.elements,i=e.elements;for(let r=0;r<16;r++)if(t[r]!==i[r])return!1;return!0}fromArray(e,t=0){for(let i=0;i<16;i++)this.elements[i]=e[i+t];return this}toArray(e=[],t=0){const i=this.elements;return e[t]=i[0],e[t+1]=i[1],e[t+2]=i[2],e[t+3]=i[3],e[t+4]=i[4],e[t+5]=i[5],e[t+6]=i[6],e[t+7]=i[7],e[t+8]=i[8],e[t+9]=i[9],e[t+10]=i[10],e[t+11]=i[11],e[t+12]=i[12],e[t+13]=i[13],e[t+14]=i[14],e[t+15]=i[15],e}}const Yv=new _e,gd=new Bi,TJ=new _e(0,0,0),DJ=new _e(1,1,1),gm=new _e,TS=new _e,Sc=new _e,wV=new Bi,MV=new wl;let AJ=(()=>{class n{constructor(t=0,i=0,r=0,s=n.DEFAULT_ORDER){this.isEuler=!0,this._x=t,this._y=i,this._z=r,this._order=s}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get order(){return this._order}set order(t){this._order=t,this._onChangeCallback()}set(t,i,r,s=this._order){return this._x=t,this._y=i,this._z=r,this._order=s,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(t){return this._x=t._x,this._y=t._y,this._z=t._z,this._order=t._order,this._onChangeCallback(),this}setFromRotationMatrix(t,i=this._order,r=!0){const s=t.elements,c=s[0],d=s[4],m=s[8],y=s[1],w=s[5],S=s[9],T=s[2],I=s[6],R=s[10];switch(i){case"XYZ":this._y=Math.asin(to(m,-1,1)),Math.abs(m)<.9999999?(this._x=Math.atan2(-S,R),this._z=Math.atan2(-d,c)):(this._x=Math.atan2(I,w),this._z=0);break;case"YXZ":this._x=Math.asin(-to(S,-1,1)),Math.abs(S)<.9999999?(this._y=Math.atan2(m,R),this._z=Math.atan2(y,w)):(this._y=Math.atan2(-T,c),this._z=0);break;case"ZXY":this._x=Math.asin(to(I,-1,1)),Math.abs(I)<.9999999?(this._y=Math.atan2(-T,R),this._z=Math.atan2(-d,w)):(this._y=0,this._z=Math.atan2(y,c));break;case"ZYX":this._y=Math.asin(-to(T,-1,1)),Math.abs(T)<.9999999?(this._x=Math.atan2(I,R),this._z=Math.atan2(y,c)):(this._x=0,this._z=Math.atan2(-d,w));break;case"YZX":this._z=Math.asin(to(y,-1,1)),Math.abs(y)<.9999999?(this._x=Math.atan2(-S,w),this._y=Math.atan2(-T,c)):(this._x=0,this._y=Math.atan2(m,R));break;case"XZY":this._z=Math.asin(-to(d,-1,1)),Math.abs(d)<.9999999?(this._x=Math.atan2(I,w),this._y=Math.atan2(m,c)):(this._x=Math.atan2(-S,R),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+i)}return this._order=i,!0===r&&this._onChangeCallback(),this}setFromQuaternion(t,i,r){return wV.makeRotationFromQuaternion(t),this.setFromRotationMatrix(wV,i,r)}setFromVector3(t,i=this._order){return this.set(t.x,t.y,t.z,i)}reorder(t){return MV.setFromEuler(this),this.setFromQuaternion(MV,t)}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._order===this._order}fromArray(t){return this._x=t[0],this._y=t[1],this._z=t[2],void 0!==t[3]&&(this._order=t[3]),this._onChangeCallback(),this}toArray(t=[],i=0){return t[i]=this._x,t[i+1]=this._y,t[i+2]=this._z,t[i+3]=this._order,t}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}return n.DEFAULT_ORDER="XYZ",n})();class M2{constructor(){this.mask=1}set(e){this.mask=(1<<e|0)>>>0}enable(e){this.mask|=1<<e|0}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e|0}disable(e){this.mask&=~(1<<e|0)}disableAll(){this.mask=0}test(e){return 0!=(this.mask&e.mask)}isEnabled(e){return 0!=(this.mask&(1<<e|0))}}let IJ=0;const CV=new _e,Kv=new wl,Sp=new Bi,DS=new _e,gw=new _e,PJ=new _e,RJ=new wl,SV=new _e(1,0,0),EV=new _e(0,1,0),TV=new _e(0,0,1),kJ={type:"added"},DV={type:"removed"};let Cl=(()=>{class n extends Kg{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:IJ++}),this.uuid=Cc(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=n.DEFAULT_UP.clone();const t=new _e,i=new AJ,r=new wl,s=new _e(1,1,1);i._onChange(function c(){r.setFromEuler(i,!1)}),r._onChange(function d(){i.setFromQuaternion(r,void 0,!1)}),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:t},rotation:{configurable:!0,enumerable:!0,value:i},quaternion:{configurable:!0,enumerable:!0,value:r},scale:{configurable:!0,enumerable:!0,value:s},modelViewMatrix:{value:new Bi},normalMatrix:{value:new Xa}}),this.matrix=new Bi,this.matrixWorld=new Bi,this.matrixAutoUpdate=n.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.matrixWorldAutoUpdate=n.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.layers=new M2,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeRender(){}onAfterRender(){}applyMatrix4(t){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(t),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(t){return this.quaternion.premultiply(t),this}setRotationFromAxisAngle(t,i){this.quaternion.setFromAxisAngle(t,i)}setRotationFromEuler(t){this.quaternion.setFromEuler(t,!0)}setRotationFromMatrix(t){this.quaternion.setFromRotationMatrix(t)}setRotationFromQuaternion(t){this.quaternion.copy(t)}rotateOnAxis(t,i){return Kv.setFromAxisAngle(t,i),this.quaternion.multiply(Kv),this}rotateOnWorldAxis(t,i){return Kv.setFromAxisAngle(t,i),this.quaternion.premultiply(Kv),this}rotateX(t){return this.rotateOnAxis(SV,t)}rotateY(t){return this.rotateOnAxis(EV,t)}rotateZ(t){return this.rotateOnAxis(TV,t)}translateOnAxis(t,i){return CV.copy(t).applyQuaternion(this.quaternion),this.position.add(CV.multiplyScalar(i)),this}translateX(t){return this.translateOnAxis(SV,t)}translateY(t){return this.translateOnAxis(EV,t)}translateZ(t){return this.translateOnAxis(TV,t)}localToWorld(t){return this.updateWorldMatrix(!0,!1),t.applyMatrix4(this.matrixWorld)}worldToLocal(t){return this.updateWorldMatrix(!0,!1),t.applyMatrix4(Sp.copy(this.matrixWorld).invert())}lookAt(t,i,r){t.isVector3?DS.copy(t):DS.set(t,i,r);const s=this.parent;this.updateWorldMatrix(!0,!1),gw.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?Sp.lookAt(gw,DS,this.up):Sp.lookAt(DS,gw,this.up),this.quaternion.setFromRotationMatrix(Sp),s&&(Sp.extractRotation(s.matrixWorld),Kv.setFromRotationMatrix(Sp),this.quaternion.premultiply(Kv.invert()))}add(t){if(arguments.length>1){for(let i=0;i<arguments.length;i++)this.add(arguments[i]);return this}return t===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",t),this):(t&&t.isObject3D?(null!==t.parent&&t.parent.remove(t),t.parent=this,this.children.push(t),t.dispatchEvent(kJ)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",t),this)}remove(t){if(arguments.length>1){for(let r=0;r<arguments.length;r++)this.remove(arguments[r]);return this}const i=this.children.indexOf(t);return-1!==i&&(t.parent=null,this.children.splice(i,1),t.dispatchEvent(DV)),this}removeFromParent(){const t=this.parent;return null!==t&&t.remove(this),this}clear(){for(let t=0;t<this.children.length;t++){const i=this.children[t];i.parent=null,i.dispatchEvent(DV)}return this.children.length=0,this}attach(t){return this.updateWorldMatrix(!0,!1),Sp.copy(this.matrixWorld).invert(),null!==t.parent&&(t.parent.updateWorldMatrix(!0,!1),Sp.multiply(t.parent.matrixWorld)),t.applyMatrix4(Sp),this.add(t),t.updateWorldMatrix(!1,!0),this}getObjectById(t){return this.getObjectByProperty("id",t)}getObjectByName(t){return this.getObjectByProperty("name",t)}getObjectByProperty(t,i){if(this[t]===i)return this;for(let r=0,s=this.children.length;r<s;r++){const d=this.children[r].getObjectByProperty(t,i);if(void 0!==d)return d}}getObjectsByProperty(t,i){let r=[];this[t]===i&&r.push(this);for(let s=0,c=this.children.length;s<c;s++){const d=this.children[s].getObjectsByProperty(t,i);d.length>0&&(r=r.concat(d))}return r}getWorldPosition(t){return this.updateWorldMatrix(!0,!1),t.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(gw,t,PJ),t}getWorldScale(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(gw,RJ,t),t}getWorldDirection(t){this.updateWorldMatrix(!0,!1);const i=this.matrixWorld.elements;return t.set(i[8],i[9],i[10]).normalize()}raycast(){}traverse(t){t(this);const i=this.children;for(let r=0,s=i.length;r<s;r++)i[r].traverse(t)}traverseVisible(t){if(!1===this.visible)return;t(this);const i=this.children;for(let r=0,s=i.length;r<s;r++)i[r].traverseVisible(t)}traverseAncestors(t){const i=this.parent;null!==i&&(t(i),i.traverseAncestors(t))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(t){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||t)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,t=!0);const i=this.children;for(let r=0,s=i.length;r<s;r++){const c=i[r];(!0===c.matrixWorldAutoUpdate||!0===t)&&c.updateMatrixWorld(t)}}updateWorldMatrix(t,i){const r=this.parent;if(!0===t&&null!==r&&!0===r.matrixWorldAutoUpdate&&r.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),!0===i){const s=this.children;for(let c=0,d=s.length;c<d;c++){const m=s[c];!0===m.matrixWorldAutoUpdate&&m.updateWorldMatrix(!1,!0)}}}toJSON(t){const i=void 0===t||"string"==typeof t,r={};i&&(t={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},r.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});const s={};function c(m,y){return void 0===m[y.uuid]&&(m[y.uuid]=y.toJSON(t)),y.uuid}if(s.uuid=this.uuid,s.type=this.type,""!==this.name&&(s.name=this.name),!0===this.castShadow&&(s.castShadow=!0),!0===this.receiveShadow&&(s.receiveShadow=!0),!1===this.visible&&(s.visible=!1),!1===this.frustumCulled&&(s.frustumCulled=!1),0!==this.renderOrder&&(s.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(s.userData=this.userData),s.layers=this.layers.mask,s.matrix=this.matrix.toArray(),!1===this.matrixAutoUpdate&&(s.matrixAutoUpdate=!1),this.isInstancedMesh&&(s.type="InstancedMesh",s.count=this.count,s.instanceMatrix=this.instanceMatrix.toJSON(),null!==this.instanceColor&&(s.instanceColor=this.instanceColor.toJSON())),this.isScene)this.background&&(this.background.isColor?s.background=this.background.toJSON():this.background.isTexture&&(s.background=this.background.toJSON(t).uuid)),this.environment&&this.environment.isTexture&&!0!==this.environment.isRenderTargetTexture&&(s.environment=this.environment.toJSON(t).uuid);else if(this.isMesh||this.isLine||this.isPoints){s.geometry=c(t.geometries,this.geometry);const m=this.geometry.parameters;if(void 0!==m&&void 0!==m.shapes){const y=m.shapes;if(Array.isArray(y))for(let w=0,S=y.length;w<S;w++)c(t.shapes,y[w]);else c(t.shapes,y)}}if(this.isSkinnedMesh&&(s.bindMode=this.bindMode,s.bindMatrix=this.bindMatrix.toArray(),void 0!==this.skeleton&&(c(t.skeletons,this.skeleton),s.skeleton=this.skeleton.uuid)),void 0!==this.material)if(Array.isArray(this.material)){const m=[];for(let y=0,w=this.material.length;y<w;y++)m.push(c(t.materials,this.material[y]));s.material=m}else s.material=c(t.materials,this.material);if(this.children.length>0){s.children=[];for(let m=0;m<this.children.length;m++)s.children.push(this.children[m].toJSON(t).object)}if(this.animations.length>0){s.animations=[];for(let m=0;m<this.animations.length;m++)s.animations.push(c(t.animations,this.animations[m]))}if(i){const m=d(t.geometries),y=d(t.materials),w=d(t.textures),S=d(t.images),T=d(t.shapes),I=d(t.skeletons),R=d(t.animations),k=d(t.nodes);m.length>0&&(r.geometries=m),y.length>0&&(r.materials=y),w.length>0&&(r.textures=w),S.length>0&&(r.images=S),T.length>0&&(r.shapes=T),I.length>0&&(r.skeletons=I),R.length>0&&(r.animations=R),k.length>0&&(r.nodes=k)}return r.object=s,r;function d(m){const y=[];for(const w in m){const S=m[w];delete S.metadata,y.push(S)}return y}}clone(t){return(new this.constructor).copy(this,t)}copy(t,i=!0){if(this.name=t.name,this.up.copy(t.up),this.position.copy(t.position),this.rotation.order=t.rotation.order,this.quaternion.copy(t.quaternion),this.scale.copy(t.scale),this.matrix.copy(t.matrix),this.matrixWorld.copy(t.matrixWorld),this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrixWorldNeedsUpdate=t.matrixWorldNeedsUpdate,this.matrixWorldAutoUpdate=t.matrixWorldAutoUpdate,this.layers.mask=t.layers.mask,this.visible=t.visible,this.castShadow=t.castShadow,this.receiveShadow=t.receiveShadow,this.frustumCulled=t.frustumCulled,this.renderOrder=t.renderOrder,this.userData=JSON.parse(JSON.stringify(t.userData)),!0===i)for(let r=0;r<t.children.length;r++)this.add(t.children[r].clone());return this}}return n.DEFAULT_UP=new _e(0,1,0),n.DEFAULT_MATRIX_AUTO_UPDATE=!0,n.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0,n})();const _d=new _e,Ep=new _e,C2=new _e,Tp=new _e,Qv=new _e,Jv=new _e,AV=new _e,S2=new _e,E2=new _e,T2=new _e;class yd{constructor(e=new _e,t=new _e,i=new _e){this.a=e,this.b=t,this.c=i}static getNormal(e,t,i,r){r.subVectors(i,t),_d.subVectors(e,t),r.cross(_d);const s=r.lengthSq();return s>0?r.multiplyScalar(1/Math.sqrt(s)):r.set(0,0,0)}static getBarycoord(e,t,i,r,s){_d.subVectors(r,t),Ep.subVectors(i,t),C2.subVectors(e,t);const c=_d.dot(_d),d=_d.dot(Ep),m=_d.dot(C2),y=Ep.dot(Ep),w=Ep.dot(C2),S=c*y-d*d;if(0===S)return s.set(-2,-1,-1);const T=1/S,I=(y*m-d*w)*T,R=(c*w-d*m)*T;return s.set(1-I-R,R,I)}static containsPoint(e,t,i,r){return this.getBarycoord(e,t,i,r,Tp),Tp.x>=0&&Tp.y>=0&&Tp.x+Tp.y<=1}static getUV(e,t,i,r,s,c,d,m){return this.getBarycoord(e,t,i,r,Tp),m.set(0,0),m.addScaledVector(s,Tp.x),m.addScaledVector(c,Tp.y),m.addScaledVector(d,Tp.z),m}static isFrontFacing(e,t,i,r){return _d.subVectors(i,t),Ep.subVectors(e,t),_d.cross(Ep).dot(r)<0}set(e,t,i){return this.a.copy(e),this.b.copy(t),this.c.copy(i),this}setFromPointsAndIndices(e,t,i,r){return this.a.copy(e[t]),this.b.copy(e[i]),this.c.copy(e[r]),this}setFromAttributeAndIndices(e,t,i,r){return this.a.fromBufferAttribute(e,t),this.b.fromBufferAttribute(e,i),this.c.fromBufferAttribute(e,r),this}clone(){return(new this.constructor).copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return _d.subVectors(this.c,this.b),Ep.subVectors(this.a,this.b),.5*_d.cross(Ep).length()}getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return yd.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,t){return yd.getBarycoord(e,this.a,this.b,this.c,t)}getUV(e,t,i,r,s){return yd.getUV(e,this.a,this.b,this.c,t,i,r,s)}containsPoint(e){return yd.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return yd.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,t){const i=this.a,r=this.b,s=this.c;let c,d;Qv.subVectors(r,i),Jv.subVectors(s,i),S2.subVectors(e,i);const m=Qv.dot(S2),y=Jv.dot(S2);if(m<=0&&y<=0)return t.copy(i);E2.subVectors(e,r);const w=Qv.dot(E2),S=Jv.dot(E2);if(w>=0&&S<=w)return t.copy(r);const T=m*S-w*y;if(T<=0&&m>=0&&w<=0)return c=m/(m-w),t.copy(i).addScaledVector(Qv,c);T2.subVectors(e,s);const I=Qv.dot(T2),R=Jv.dot(T2);if(R>=0&&I<=R)return t.copy(s);const k=I*y-m*R;if(k<=0&&y>=0&&R<=0)return d=y/(y-R),t.copy(i).addScaledVector(Jv,d);const F=w*R-I*S;if(F<=0&&S-w>=0&&I-R>=0)return AV.subVectors(s,r),d=(S-w)/(S-w+(I-R)),t.copy(r).addScaledVector(AV,d);const G=1/(F+k+T);return c=k*G,d=T*G,t.copy(i).addScaledVector(Qv,c).addScaledVector(Jv,d)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}let LJ=0;class rh extends Kg{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:LJ++}),this.uuid=Cc(),this.name="",this.type="Material",this.blending=1,this.side=0,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.blendSrc=204,this.blendDst=205,this.blendEquation=100,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=3,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=519,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=7680,this.stencilZFail=7680,this.stencilZPass=7680,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(e){this._alphaTest>0!=e>0&&this.version++,this._alphaTest=e}onBuild(){}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(void 0!==e)for(const t in e){const i=e[t];if(void 0===i){console.warn("THREE.Material: '"+t+"' parameter is undefined.");continue}const r=this[t];void 0!==r?r&&r.isColor?r.set(i):r&&r.isVector3&&i&&i.isVector3?r.copy(i):this[t]=i:console.warn("THREE."+this.type+": '"+t+"' is not a property of this material.")}}toJSON(e){const t=void 0===e||"string"==typeof e;t&&(e={textures:{},images:{}});const i={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};function r(s){const c=[];for(const d in s){const m=s[d];delete m.metadata,c.push(m)}return c}if(i.uuid=this.uuid,i.type=this.type,""!==this.name&&(i.name=this.name),this.color&&this.color.isColor&&(i.color=this.color.getHex()),void 0!==this.roughness&&(i.roughness=this.roughness),void 0!==this.metalness&&(i.metalness=this.metalness),void 0!==this.sheen&&(i.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(i.sheenColor=this.sheenColor.getHex()),void 0!==this.sheenRoughness&&(i.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(i.emissive=this.emissive.getHex()),this.emissiveIntensity&&1!==this.emissiveIntensity&&(i.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(i.specular=this.specular.getHex()),void 0!==this.specularIntensity&&(i.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(i.specularColor=this.specularColor.getHex()),void 0!==this.shininess&&(i.shininess=this.shininess),void 0!==this.clearcoat&&(i.clearcoat=this.clearcoat),void 0!==this.clearcoatRoughness&&(i.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(i.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(i.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(i.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,i.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),void 0!==this.iridescence&&(i.iridescence=this.iridescence),void 0!==this.iridescenceIOR&&(i.iridescenceIOR=this.iridescenceIOR),void 0!==this.iridescenceThicknessRange&&(i.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(i.iridescenceMap=this.iridescenceMap.toJSON(e).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(i.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(e).uuid),this.map&&this.map.isTexture&&(i.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(i.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(i.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(i.lightMap=this.lightMap.toJSON(e).uuid,i.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(i.aoMap=this.aoMap.toJSON(e).uuid,i.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(i.bumpMap=this.bumpMap.toJSON(e).uuid,i.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(i.normalMap=this.normalMap.toJSON(e).uuid,i.normalMapType=this.normalMapType,i.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(i.displacementMap=this.displacementMap.toJSON(e).uuid,i.displacementScale=this.displacementScale,i.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(i.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(i.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(i.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(i.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(i.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(i.specularColorMap=this.specularColorMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(i.envMap=this.envMap.toJSON(e).uuid,void 0!==this.combine&&(i.combine=this.combine)),void 0!==this.envMapIntensity&&(i.envMapIntensity=this.envMapIntensity),void 0!==this.reflectivity&&(i.reflectivity=this.reflectivity),void 0!==this.refractionRatio&&(i.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(i.gradientMap=this.gradientMap.toJSON(e).uuid),void 0!==this.transmission&&(i.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(i.transmissionMap=this.transmissionMap.toJSON(e).uuid),void 0!==this.thickness&&(i.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(i.thicknessMap=this.thicknessMap.toJSON(e).uuid),void 0!==this.attenuationDistance&&this.attenuationDistance!==1/0&&(i.attenuationDistance=this.attenuationDistance),void 0!==this.attenuationColor&&(i.attenuationColor=this.attenuationColor.getHex()),void 0!==this.size&&(i.size=this.size),null!==this.shadowSide&&(i.shadowSide=this.shadowSide),void 0!==this.sizeAttenuation&&(i.sizeAttenuation=this.sizeAttenuation),1!==this.blending&&(i.blending=this.blending),0!==this.side&&(i.side=this.side),this.vertexColors&&(i.vertexColors=!0),this.opacity<1&&(i.opacity=this.opacity),!0===this.transparent&&(i.transparent=this.transparent),i.depthFunc=this.depthFunc,i.depthTest=this.depthTest,i.depthWrite=this.depthWrite,i.colorWrite=this.colorWrite,i.stencilWrite=this.stencilWrite,i.stencilWriteMask=this.stencilWriteMask,i.stencilFunc=this.stencilFunc,i.stencilRef=this.stencilRef,i.stencilFuncMask=this.stencilFuncMask,i.stencilFail=this.stencilFail,i.stencilZFail=this.stencilZFail,i.stencilZPass=this.stencilZPass,void 0!==this.rotation&&0!==this.rotation&&(i.rotation=this.rotation),!0===this.polygonOffset&&(i.polygonOffset=!0),0!==this.polygonOffsetFactor&&(i.polygonOffsetFactor=this.polygonOffsetFactor),0!==this.polygonOffsetUnits&&(i.polygonOffsetUnits=this.polygonOffsetUnits),void 0!==this.linewidth&&1!==this.linewidth&&(i.linewidth=this.linewidth),void 0!==this.dashSize&&(i.dashSize=this.dashSize),void 0!==this.gapSize&&(i.gapSize=this.gapSize),void 0!==this.scale&&(i.scale=this.scale),!0===this.dithering&&(i.dithering=!0),this.alphaTest>0&&(i.alphaTest=this.alphaTest),!0===this.alphaToCoverage&&(i.alphaToCoverage=this.alphaToCoverage),!0===this.premultipliedAlpha&&(i.premultipliedAlpha=this.premultipliedAlpha),!0===this.forceSinglePass&&(i.forceSinglePass=this.forceSinglePass),!0===this.wireframe&&(i.wireframe=this.wireframe),this.wireframeLinewidth>1&&(i.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(i.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(i.wireframeLinejoin=this.wireframeLinejoin),!0===this.flatShading&&(i.flatShading=this.flatShading),!1===this.visible&&(i.visible=!1),!1===this.toneMapped&&(i.toneMapped=!1),!1===this.fog&&(i.fog=!1),Object.keys(this.userData).length>0&&(i.userData=this.userData),t){const s=r(e.textures),c=r(e.images);s.length>0&&(i.textures=s),c.length>0&&(i.images=c)}return i}clone(){return(new this.constructor).copy(this)}copy(e){this.name=e.name,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;const t=e.clippingPlanes;let i=null;if(null!==t){const r=t.length;i=new Array(r);for(let s=0;s!==r;++s)i[s]=t[s].clone()}return this.clippingPlanes=i,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.forceSinglePass=e.forceSinglePass,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){!0===e&&this.version++}}const IV={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},vd={h:0,s:0,l:0},AS={h:0,s:0,l:0};function D2(n,e,t){return t<0&&(t+=1),t>1&&(t-=1),t<1/6?n+6*(e-n)*t:t<.5?e:t<2/3?n+6*(e-n)*(2/3-t):n}class An{constructor(e,t,i){return this.isColor=!0,this.r=1,this.g=1,this.b=1,void 0===t&&void 0===i?this.set(e):this.setRGB(e,t,i)}set(e){return e&&e.isColor?this.copy(e):"number"==typeof e?this.setHex(e):"string"==typeof e&&this.setStyle(e),this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e,t=ih){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(255&e)/255,Ml.toWorkingColorSpace(this,t),this}setRGB(e,t,i,r=Ml.workingColorSpace){return this.r=e,this.g=t,this.b=i,Ml.toWorkingColorSpace(this,r),this}setHSL(e,t,i,r=Ml.workingColorSpace){if(e=function u2(n,e){return(n%e+e)%e}(e,1),t=to(t,0,1),i=to(i,0,1),0===t)this.r=this.g=this.b=i;else{const s=i<=.5?i*(1+t):i+t-i*t,c=2*i-s;this.r=D2(c,s,e+1/3),this.g=D2(c,s,e),this.b=D2(c,s,e-1/3)}return Ml.toWorkingColorSpace(this,r),this}setStyle(e,t=ih){function i(s){void 0!==s&&parseFloat(s)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}let r;if(r=/^(\w+)\(([^\)]*)\)/.exec(e)){let s;const d=r[2];switch(r[1]){case"rgb":case"rgba":if(s=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(d))return this.r=Math.min(255,parseInt(s[1],10))/255,this.g=Math.min(255,parseInt(s[2],10))/255,this.b=Math.min(255,parseInt(s[3],10))/255,Ml.toWorkingColorSpace(this,t),i(s[4]),this;if(s=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(d))return this.r=Math.min(100,parseInt(s[1],10))/100,this.g=Math.min(100,parseInt(s[2],10))/100,this.b=Math.min(100,parseInt(s[3],10))/100,Ml.toWorkingColorSpace(this,t),i(s[4]),this;break;case"hsl":case"hsla":if(s=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(d)){const m=parseFloat(s[1])/360,y=parseFloat(s[2])/100,w=parseFloat(s[3])/100;return i(s[4]),this.setHSL(m,y,w,t)}break;default:console.warn("THREE.Color: Unknown color model "+e)}}else if(r=/^\#([A-Fa-f\d]+)$/.exec(e)){const s=r[1],c=s.length;if(3===c)return this.r=parseInt(s.charAt(0)+s.charAt(0),16)/255,this.g=parseInt(s.charAt(1)+s.charAt(1),16)/255,this.b=parseInt(s.charAt(2)+s.charAt(2),16)/255,Ml.toWorkingColorSpace(this,t),this;if(6===c)return this.r=parseInt(s.charAt(0)+s.charAt(1),16)/255,this.g=parseInt(s.charAt(2)+s.charAt(3),16)/255,this.b=parseInt(s.charAt(4)+s.charAt(5),16)/255,Ml.toWorkingColorSpace(this,t),this;console.warn("THREE.Color: Invalid hex color "+e)}else if(e&&e.length>0)return this.setColorName(e,t);return this}setColorName(e,t=ih){const i=IV[e.toLowerCase()];return void 0!==i?this.setHex(i,t):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copySRGBToLinear(e){return this.r=Hv(e.r),this.g=Hv(e.g),this.b=Hv(e.b),this}copyLinearToSRGB(e){return this.r=f2(e.r),this.g=f2(e.g),this.b=f2(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(e=ih){return Ml.fromWorkingColorSpace(Ya.copy(this),e),to(255*Ya.r,0,255)<<16^to(255*Ya.g,0,255)<<8^to(255*Ya.b,0,255)<<0}getHexString(e=ih){return("000000"+this.getHex(e).toString(16)).slice(-6)}getHSL(e,t=Ml.workingColorSpace){Ml.fromWorkingColorSpace(Ya.copy(this),t);const i=Ya.r,r=Ya.g,s=Ya.b,c=Math.max(i,r,s),d=Math.min(i,r,s);let m,y;const w=(d+c)/2;if(d===c)m=0,y=0;else{const S=c-d;switch(y=w<=.5?S/(c+d):S/(2-c-d),c){case i:m=(r-s)/S+(r<s?6:0);break;case r:m=(s-i)/S+2;break;case s:m=(i-r)/S+4}m/=6}return e.h=m,e.s=y,e.l=w,e}getRGB(e,t=Ml.workingColorSpace){return Ml.fromWorkingColorSpace(Ya.copy(this),t),e.r=Ya.r,e.g=Ya.g,e.b=Ya.b,e}getStyle(e=ih){Ml.fromWorkingColorSpace(Ya.copy(this),e);const t=Ya.r,i=Ya.g,r=Ya.b;return e!==ih?`color(${e} ${t.toFixed(3)} ${i.toFixed(3)} ${r.toFixed(3)})`:`rgb(${255*t|0},${255*i|0},${255*r|0})`}offsetHSL(e,t,i){return this.getHSL(vd),vd.h+=e,vd.s+=t,vd.l+=i,this.setHSL(vd.h,vd.s,vd.l),this}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this}lerpColors(e,t,i){return this.r=e.r+(t.r-e.r)*i,this.g=e.g+(t.g-e.g)*i,this.b=e.b+(t.b-e.b)*i,this}lerpHSL(e,t){this.getHSL(vd),e.getHSL(AS);const i=hw(vd.h,AS.h,t),r=hw(vd.s,AS.s,t),s=hw(vd.l,AS.l,t);return this.setHSL(i,r,s),this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,t=0){return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}toArray(e=[],t=0){return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}fromBufferAttribute(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}const Ya=new An;An.NAMES=IV;class _m extends rh{constructor(e){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new An(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}const To=new _e,IS=new Pt;class sa{constructor(e,t,i=!1){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=e,this.itemSize=t,this.count=void 0!==e?e.length/t:0,this.normalized=i,this.usage=35044,this.updateRange={offset:0,count:-1},this.version=0}onUploadCallback(){}set needsUpdate(e){!0===e&&this.version++}setUsage(e){return this.usage=e,this}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this}copyAt(e,t,i){e*=this.itemSize,i*=t.itemSize;for(let r=0,s=this.itemSize;r<s;r++)this.array[e+r]=t.array[i+r];return this}copyArray(e){return this.array.set(e),this}applyMatrix3(e){if(2===this.itemSize)for(let t=0,i=this.count;t<i;t++)IS.fromBufferAttribute(this,t),IS.applyMatrix3(e),this.setXY(t,IS.x,IS.y);else if(3===this.itemSize)for(let t=0,i=this.count;t<i;t++)To.fromBufferAttribute(this,t),To.applyMatrix3(e),this.setXYZ(t,To.x,To.y,To.z);return this}applyMatrix4(e){for(let t=0,i=this.count;t<i;t++)To.fromBufferAttribute(this,t),To.applyMatrix4(e),this.setXYZ(t,To.x,To.y,To.z);return this}applyNormalMatrix(e){for(let t=0,i=this.count;t<i;t++)To.fromBufferAttribute(this,t),To.applyNormalMatrix(e),this.setXYZ(t,To.x,To.y,To.z);return this}transformDirection(e){for(let t=0,i=this.count;t<i;t++)To.fromBufferAttribute(this,t),To.transformDirection(e),this.setXYZ(t,To.x,To.y,To.z);return this}set(e,t=0){return this.array.set(e,t),this}getX(e){let t=this.array[e*this.itemSize];return this.normalized&&(t=wp(t,this.array)),t}setX(e,t){return this.normalized&&(t=os(t,this.array)),this.array[e*this.itemSize]=t,this}getY(e){let t=this.array[e*this.itemSize+1];return this.normalized&&(t=wp(t,this.array)),t}setY(e,t){return this.normalized&&(t=os(t,this.array)),this.array[e*this.itemSize+1]=t,this}getZ(e){let t=this.array[e*this.itemSize+2];return this.normalized&&(t=wp(t,this.array)),t}setZ(e,t){return this.normalized&&(t=os(t,this.array)),this.array[e*this.itemSize+2]=t,this}getW(e){let t=this.array[e*this.itemSize+3];return this.normalized&&(t=wp(t,this.array)),t}setW(e,t){return this.normalized&&(t=os(t,this.array)),this.array[e*this.itemSize+3]=t,this}setXY(e,t,i){return e*=this.itemSize,this.normalized&&(t=os(t,this.array),i=os(i,this.array)),this.array[e+0]=t,this.array[e+1]=i,this}setXYZ(e,t,i,r){return e*=this.itemSize,this.normalized&&(t=os(t,this.array),i=os(i,this.array),r=os(r,this.array)),this.array[e+0]=t,this.array[e+1]=i,this.array[e+2]=r,this}setXYZW(e,t,i,r,s){return e*=this.itemSize,this.normalized&&(t=os(t,this.array),i=os(i,this.array),r=os(r,this.array),s=os(s,this.array)),this.array[e+0]=t,this.array[e+1]=i,this.array[e+2]=r,this.array[e+3]=s,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return""!==this.name&&(e.name=this.name),35044!==this.usage&&(e.usage=this.usage),(0!==this.updateRange.offset||-1!==this.updateRange.count)&&(e.updateRange=this.updateRange),e}copyColorsArray(){console.error("THREE.BufferAttribute: copyColorsArray() was removed in r144.")}copyVector2sArray(){console.error("THREE.BufferAttribute: copyVector2sArray() was removed in r144.")}copyVector3sArray(){console.error("THREE.BufferAttribute: copyVector3sArray() was removed in r144.")}copyVector4sArray(){console.error("THREE.BufferAttribute: copyVector4sArray() was removed in r144.")}}class PV extends sa{constructor(e,t,i){super(new Uint16Array(e),t,i)}}class RV extends sa{constructor(e,t,i){super(new Uint32Array(e),t,i)}}class kn extends sa{constructor(e,t,i){super(new Float32Array(e),t,i)}}let OJ=0;const fu=new Bi,A2=new Cl,e0=new _e,Ec=new $v,_w=new $v,oa=new _e;class Wi extends Kg{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:OJ++}),this.uuid=Cc(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return this.index=Array.isArray(e)?new(yV(e)?RV:PV)(e,1):e,this}getAttribute(e){return this.attributes[e]}setAttribute(e,t){return this.attributes[e]=t,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return void 0!==this.attributes[e]}addGroup(e,t,i=0){this.groups.push({start:e,count:t,materialIndex:i})}clearGroups(){this.groups=[]}setDrawRange(e,t){this.drawRange.start=e,this.drawRange.count=t}applyMatrix4(e){const t=this.attributes.position;void 0!==t&&(t.applyMatrix4(e),t.needsUpdate=!0);const i=this.attributes.normal;if(void 0!==i){const s=(new Xa).getNormalMatrix(e);i.applyNormalMatrix(s),i.needsUpdate=!0}const r=this.attributes.tangent;return void 0!==r&&(r.transformDirection(e),r.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this}applyQuaternion(e){return fu.makeRotationFromQuaternion(e),this.applyMatrix4(fu),this}rotateX(e){return fu.makeRotationX(e),this.applyMatrix4(fu),this}rotateY(e){return fu.makeRotationY(e),this.applyMatrix4(fu),this}rotateZ(e){return fu.makeRotationZ(e),this.applyMatrix4(fu),this}translate(e,t,i){return fu.makeTranslation(e,t,i),this.applyMatrix4(fu),this}scale(e,t,i){return fu.makeScale(e,t,i),this.applyMatrix4(fu),this}lookAt(e){return A2.lookAt(e),A2.updateMatrix(),this.applyMatrix4(A2.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(e0).negate(),this.translate(e0.x,e0.y,e0.z),this}setFromPoints(e){const t=[];for(let i=0,r=e.length;i<r;i++){const s=e[i];t.push(s.x,s.y,s.z||0)}return this.setAttribute("position",new kn(t,3)),this}computeBoundingBox(){null===this.boundingBox&&(this.boundingBox=new $v);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingBox.set(new _e(-1/0,-1/0,-1/0),new _e(1/0,1/0,1/0));if(void 0!==e){if(this.boundingBox.setFromBufferAttribute(e),t)for(let i=0,r=t.length;i<r;i++)Ec.setFromBufferAttribute(t[i]),this.morphTargetsRelative?(oa.addVectors(this.boundingBox.min,Ec.min),this.boundingBox.expandByPoint(oa),oa.addVectors(this.boundingBox.max,Ec.max),this.boundingBox.expandByPoint(oa)):(this.boundingBox.expandByPoint(Ec.min),this.boundingBox.expandByPoint(Ec.max))}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){null===this.boundingSphere&&(this.boundingSphere=new Xv);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingSphere.set(new _e,1/0);if(e){const i=this.boundingSphere.center;if(Ec.setFromBufferAttribute(e),t)for(let s=0,c=t.length;s<c;s++)_w.setFromBufferAttribute(t[s]),this.morphTargetsRelative?(oa.addVectors(Ec.min,_w.min),Ec.expandByPoint(oa),oa.addVectors(Ec.max,_w.max),Ec.expandByPoint(oa)):(Ec.expandByPoint(_w.min),Ec.expandByPoint(_w.max));Ec.getCenter(i);let r=0;for(let s=0,c=e.count;s<c;s++)oa.fromBufferAttribute(e,s),r=Math.max(r,i.distanceToSquared(oa));if(t)for(let s=0,c=t.length;s<c;s++){const d=t[s],m=this.morphTargetsRelative;for(let y=0,w=d.count;y<w;y++)oa.fromBufferAttribute(d,y),m&&(e0.fromBufferAttribute(e,y),oa.add(e0)),r=Math.max(r,i.distanceToSquared(oa))}this.boundingSphere.radius=Math.sqrt(r),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const e=this.index,t=this.attributes;if(null===e||void 0===t.position||void 0===t.normal||void 0===t.uv)return void console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");const i=e.array,r=t.position.array,s=t.normal.array,c=t.uv.array,d=r.length/3;!1===this.hasAttribute("tangent")&&this.setAttribute("tangent",new sa(new Float32Array(4*d),4));const m=this.getAttribute("tangent").array,y=[],w=[];for(let Oe=0;Oe<d;Oe++)y[Oe]=new _e,w[Oe]=new _e;const S=new _e,T=new _e,I=new _e,R=new Pt,k=new Pt,F=new Pt,G=new _e,W=new _e;function V(Oe,st,xt){S.fromArray(r,3*Oe),T.fromArray(r,3*st),I.fromArray(r,3*xt),R.fromArray(c,2*Oe),k.fromArray(c,2*st),F.fromArray(c,2*xt),T.sub(S),I.sub(S),k.sub(R),F.sub(R);const Qe=1/(k.x*F.y-F.x*k.y);!isFinite(Qe)||(G.copy(T).multiplyScalar(F.y).addScaledVector(I,-k.y).multiplyScalar(Qe),W.copy(I).multiplyScalar(k.x).addScaledVector(T,-F.x).multiplyScalar(Qe),y[Oe].add(G),y[st].add(G),y[xt].add(G),w[Oe].add(W),w[st].add(W),w[xt].add(W))}let X=this.groups;0===X.length&&(X=[{start:0,count:i.length}]);for(let Oe=0,st=X.length;Oe<st;++Oe){const xt=X[Oe],Qe=xt.start;for(let ft=Qe,qe=Qe+xt.count;ft<qe;ft+=3)V(i[ft+0],i[ft+1],i[ft+2])}const ee=new _e,ae=new _e,Ee=new _e,J=new _e;function pe(Oe){Ee.fromArray(s,3*Oe),J.copy(Ee);const st=y[Oe];ee.copy(st),ee.sub(Ee.multiplyScalar(Ee.dot(st))).normalize(),ae.crossVectors(J,st);const Qe=ae.dot(w[Oe])<0?-1:1;m[4*Oe]=ee.x,m[4*Oe+1]=ee.y,m[4*Oe+2]=ee.z,m[4*Oe+3]=Qe}for(let Oe=0,st=X.length;Oe<st;++Oe){const xt=X[Oe],Qe=xt.start;for(let ft=Qe,qe=Qe+xt.count;ft<qe;ft+=3)pe(i[ft+0]),pe(i[ft+1]),pe(i[ft+2])}}computeVertexNormals(){const e=this.index,t=this.getAttribute("position");if(void 0!==t){let i=this.getAttribute("normal");if(void 0===i)i=new sa(new Float32Array(3*t.count),3),this.setAttribute("normal",i);else for(let T=0,I=i.count;T<I;T++)i.setXYZ(T,0,0,0);const r=new _e,s=new _e,c=new _e,d=new _e,m=new _e,y=new _e,w=new _e,S=new _e;if(e)for(let T=0,I=e.count;T<I;T+=3){const R=e.getX(T+0),k=e.getX(T+1),F=e.getX(T+2);r.fromBufferAttribute(t,R),s.fromBufferAttribute(t,k),c.fromBufferAttribute(t,F),w.subVectors(c,s),S.subVectors(r,s),w.cross(S),d.fromBufferAttribute(i,R),m.fromBufferAttribute(i,k),y.fromBufferAttribute(i,F),d.add(w),m.add(w),y.add(w),i.setXYZ(R,d.x,d.y,d.z),i.setXYZ(k,m.x,m.y,m.z),i.setXYZ(F,y.x,y.y,y.z)}else for(let T=0,I=t.count;T<I;T+=3)r.fromBufferAttribute(t,T+0),s.fromBufferAttribute(t,T+1),c.fromBufferAttribute(t,T+2),w.subVectors(c,s),S.subVectors(r,s),w.cross(S),i.setXYZ(T+0,w.x,w.y,w.z),i.setXYZ(T+1,w.x,w.y,w.z),i.setXYZ(T+2,w.x,w.y,w.z);this.normalizeNormals(),i.needsUpdate=!0}}merge(){return console.error("THREE.BufferGeometry.merge() has been removed. Use THREE.BufferGeometryUtils.mergeBufferGeometries() instead."),this}normalizeNormals(){const e=this.attributes.normal;for(let t=0,i=e.count;t<i;t++)oa.fromBufferAttribute(e,t),oa.normalize(),e.setXYZ(t,oa.x,oa.y,oa.z)}toNonIndexed(){function e(d,m){const y=d.array,w=d.itemSize,S=d.normalized,T=new y.constructor(m.length*w);let I=0,R=0;for(let k=0,F=m.length;k<F;k++){I=d.isInterleavedBufferAttribute?m[k]*d.data.stride+d.offset:m[k]*w;for(let G=0;G<w;G++)T[R++]=y[I++]}return new sa(T,w,S)}if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const t=new Wi,i=this.index.array,r=this.attributes;for(const d in r){const y=e(r[d],i);t.setAttribute(d,y)}const s=this.morphAttributes;for(const d in s){const m=[],y=s[d];for(let w=0,S=y.length;w<S;w++){const I=e(y[w],i);m.push(I)}t.morphAttributes[d]=m}t.morphTargetsRelative=this.morphTargetsRelative;const c=this.groups;for(let d=0,m=c.length;d<m;d++){const y=c[d];t.addGroup(y.start,y.count,y.materialIndex)}return t}toJSON(){const e={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,""!==this.name&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),void 0!==this.parameters){const m=this.parameters;for(const y in m)void 0!==m[y]&&(e[y]=m[y]);return e}e.data={attributes:{}};const t=this.index;null!==t&&(e.data.index={type:t.array.constructor.name,array:Array.prototype.slice.call(t.array)});const i=this.attributes;for(const m in i)e.data.attributes[m]=i[m].toJSON(e.data);const r={};let s=!1;for(const m in this.morphAttributes){const y=this.morphAttributes[m],w=[];for(let S=0,T=y.length;S<T;S++)w.push(y[S].toJSON(e.data));w.length>0&&(r[m]=w,s=!0)}s&&(e.data.morphAttributes=r,e.data.morphTargetsRelative=this.morphTargetsRelative);const c=this.groups;c.length>0&&(e.data.groups=JSON.parse(JSON.stringify(c)));const d=this.boundingSphere;return null!==d&&(e.data.boundingSphere={center:d.center.toArray(),radius:d.radius}),e}clone(){return(new this.constructor).copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const t={};this.name=e.name;const i=e.index;null!==i&&this.setIndex(i.clone(t));const r=e.attributes;for(const y in r)this.setAttribute(y,r[y].clone(t));const s=e.morphAttributes;for(const y in s){const w=[],S=s[y];for(let T=0,I=S.length;T<I;T++)w.push(S[T].clone(t));this.morphAttributes[y]=w}this.morphTargetsRelative=e.morphTargetsRelative;const c=e.groups;for(let y=0,w=c.length;y<w;y++){const S=c[y];this.addGroup(S.start,S.count,S.materialIndex)}const d=e.boundingBox;null!==d&&(this.boundingBox=d.clone());const m=e.boundingSphere;return null!==m&&(this.boundingSphere=m.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}const kV=new Bi,sh=new ES,PS=new Xv,LV=new _e,yw=new _e,vw=new _e,xw=new _e,I2=new _e,RS=new _e,kS=new Pt,LS=new Pt,OS=new Pt,P2=new _e,FS=new _e;class Ka extends Cl{constructor(e=new Wi,t=new _m){super(),this.isMesh=!0,this.type="Mesh",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),void 0!==e.morphTargetInfluences&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),void 0!==e.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=e.material,this.geometry=e.geometry,this}updateMorphTargets(){const t=this.geometry.morphAttributes,i=Object.keys(t);if(i.length>0){const r=t[i[0]];if(void 0!==r){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let s=0,c=r.length;s<c;s++){const d=r[s].name||String(s);this.morphTargetInfluences.push(0),this.morphTargetDictionary[d]=s}}}}getVertexPosition(e,t){const i=this.geometry,s=i.morphAttributes.position,c=i.morphTargetsRelative;t.fromBufferAttribute(i.attributes.position,e);const d=this.morphTargetInfluences;if(s&&d){RS.set(0,0,0);for(let m=0,y=s.length;m<y;m++){const w=d[m],S=s[m];0!==w&&(I2.fromBufferAttribute(S,e),RS.addScaledVector(c?I2:I2.sub(t),w))}t.add(RS)}return this.isSkinnedMesh&&this.boneTransform(e,t),t}raycast(e,t){const i=this.geometry,r=this.material,s=this.matrixWorld;if(void 0===r||(null===i.boundingSphere&&i.computeBoundingSphere(),PS.copy(i.boundingSphere),PS.applyMatrix4(s),sh.copy(e.ray).recast(e.near),!1===PS.containsPoint(sh.origin)&&(null===sh.intersectSphere(PS,LV)||sh.origin.distanceToSquared(LV)>(e.far-e.near)**2))||(kV.copy(s).invert(),sh.copy(e.ray).applyMatrix4(kV),null!==i.boundingBox&&!1===sh.intersectsBox(i.boundingBox)))return;let c;const d=i.index,m=i.attributes.position,y=i.attributes.uv,w=i.attributes.uv2,S=i.groups,T=i.drawRange;if(null!==d)if(Array.isArray(r))for(let I=0,R=S.length;I<R;I++){const k=S[I],F=r[k.materialIndex];for(let V=Math.max(k.start,T.start),X=Math.min(d.count,Math.min(k.start+k.count,T.start+T.count));V<X;V+=3){const ee=d.getX(V),ae=d.getX(V+1),Ee=d.getX(V+2);c=NS(this,F,e,sh,y,w,ee,ae,Ee),c&&(c.faceIndex=Math.floor(V/3),c.face.materialIndex=k.materialIndex,t.push(c))}}else for(let k=Math.max(0,T.start),F=Math.min(d.count,T.start+T.count);k<F;k+=3){const G=d.getX(k),W=d.getX(k+1),V=d.getX(k+2);c=NS(this,r,e,sh,y,w,G,W,V),c&&(c.faceIndex=Math.floor(k/3),t.push(c))}else if(void 0!==m)if(Array.isArray(r))for(let I=0,R=S.length;I<R;I++){const k=S[I],F=r[k.materialIndex];for(let V=Math.max(k.start,T.start),X=Math.min(m.count,Math.min(k.start+k.count,T.start+T.count));V<X;V+=3)c=NS(this,F,e,sh,y,w,V,V+1,V+2),c&&(c.faceIndex=Math.floor(V/3),c.face.materialIndex=k.materialIndex,t.push(c))}else for(let k=Math.max(0,T.start),F=Math.min(m.count,T.start+T.count);k<F;k+=3)c=NS(this,r,e,sh,y,w,k,k+1,k+2),c&&(c.faceIndex=Math.floor(k/3),t.push(c))}}function NS(n,e,t,i,r,s,c,d,m){n.getVertexPosition(c,yw),n.getVertexPosition(d,vw),n.getVertexPosition(m,xw);const y=function FJ(n,e,t,i,r,s,c,d){let m;if(m=1===e.side?i.intersectTriangle(c,s,r,!0,d):i.intersectTriangle(r,s,c,0===e.side,d),null===m)return null;FS.copy(d),FS.applyMatrix4(n.matrixWorld);const y=t.ray.origin.distanceTo(FS);return y<t.near||y>t.far?null:{distance:y,point:FS.clone(),object:n}}(n,e,t,i,yw,vw,xw,P2);if(y){r&&(kS.fromBufferAttribute(r,c),LS.fromBufferAttribute(r,d),OS.fromBufferAttribute(r,m),y.uv=yd.getUV(P2,yw,vw,xw,kS,LS,OS,new Pt)),s&&(kS.fromBufferAttribute(s,c),LS.fromBufferAttribute(s,d),OS.fromBufferAttribute(s,m),y.uv2=yd.getUV(P2,yw,vw,xw,kS,LS,OS,new Pt));const w={a:c,b:d,c:m,normal:new _e,materialIndex:0};yd.getNormal(yw,vw,xw,w.normal),y.face=w}return y}class t0 extends Wi{constructor(e=1,t=1,i=1,r=1,s=1,c=1){super(),this.type="BoxGeometry",this.parameters={width:e,height:t,depth:i,widthSegments:r,heightSegments:s,depthSegments:c};const d=this;r=Math.floor(r),s=Math.floor(s),c=Math.floor(c);const m=[],y=[],w=[],S=[];let T=0,I=0;function R(k,F,G,W,V,X,ee,ae,Ee,J,pe){const Oe=X/Ee,st=ee/J,xt=X/2,Qe=ee/2,Ge=ae/2,ft=Ee+1,qe=J+1;let dt=0,Ye=0;const gt=new _e;for(let Ot=0;Ot<qe;Ot++){const pn=Ot*st-Qe;for(let at=0;at<ft;at++)gt[k]=(at*Oe-xt)*W,gt[F]=pn*V,gt[G]=Ge,y.push(gt.x,gt.y,gt.z),gt[k]=0,gt[F]=0,gt[G]=ae>0?1:-1,w.push(gt.x,gt.y,gt.z),S.push(at/Ee),S.push(1-Ot/J),dt+=1}for(let Ot=0;Ot<J;Ot++)for(let pn=0;pn<Ee;pn++){const Ut=T+pn+ft*(Ot+1),zt=T+(pn+1)+ft*(Ot+1),nt=T+(pn+1)+ft*Ot;m.push(T+pn+ft*Ot,Ut,nt),m.push(Ut,zt,nt),Ye+=6}d.addGroup(I,Ye,pe),I+=Ye,T+=dt}R("z","y","x",-1,-1,i,t,e,c,s,0),R("z","y","x",1,-1,i,t,-e,c,s,1),R("x","z","y",1,1,e,i,t,r,c,2),R("x","z","y",1,-1,e,i,-t,r,c,3),R("x","y","z",1,-1,e,t,i,r,s,4),R("x","y","z",-1,-1,e,t,-i,r,s,5),this.setIndex(m),this.setAttribute("position",new kn(y,3)),this.setAttribute("normal",new kn(w,3)),this.setAttribute("uv",new kn(S,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new t0(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}}function n0(n){const e={};for(const t in n){e[t]={};for(const i in n[t]){const r=n[t][i];e[t][i]=r&&(r.isColor||r.isMatrix3||r.isMatrix4||r.isVector2||r.isVector3||r.isVector4||r.isTexture||r.isQuaternion)?r.clone():Array.isArray(r)?r.slice():r}}return e}function Sl(n){const e={};for(let t=0;t<n.length;t++){const i=n0(n[t]);for(const r in i)e[r]=i[r]}return e}function OV(n){return null===n.getRenderTarget()&&n.outputEncoding===vs?ih:uw}const BJ={clone:n0,merge:Sl};class ym extends rh{constructor(e){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",this.fragmentShader="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}",this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,void 0!==e&&this.setValues(e)}copy(e){return super.copy(e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=n0(e.uniforms),this.uniformsGroups=function NJ(n){const e=[];for(let t=0;t<n.length;t++)e.push(n[t].clone());return e}(e.uniformsGroups),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.fog=e.fog,this.lights=e.lights,this.clipping=e.clipping,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this}toJSON(e){const t=super.toJSON(e);t.glslVersion=this.glslVersion,t.uniforms={};for(const r in this.uniforms){const c=this.uniforms[r].value;t.uniforms[r]=c&&c.isTexture?{type:"t",value:c.toJSON(e).uuid}:c&&c.isColor?{type:"c",value:c.getHex()}:c&&c.isVector2?{type:"v2",value:c.toArray()}:c&&c.isVector3?{type:"v3",value:c.toArray()}:c&&c.isVector4?{type:"v4",value:c.toArray()}:c&&c.isMatrix3?{type:"m3",value:c.toArray()}:c&&c.isMatrix4?{type:"m4",value:c.toArray()}:{value:c}}Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader;const i={};for(const r in this.extensions)!0===this.extensions[r]&&(i[r]=!0);return Object.keys(i).length>0&&(t.extensions=i),t}}class R2 extends Cl{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new Bi,this.projectionMatrix=new Bi,this.projectionMatrixInverse=new Bi}copy(e,t){return super.copy(e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(-t[8],-t[9],-t[10]).normalize()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,t){super.updateWorldMatrix(e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return(new this.constructor).copy(this)}}class Da extends R2{constructor(e=50,t=1,i=.1,r=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=i,this.far=r,this.focus=10,this.aspect=t,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=null===e.view?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){const t=.5*this.getFilmHeight()/e;this.fov=2*dw*Math.atan(t),this.updateProjectionMatrix()}getFocalLength(){const e=Math.tan(.5*Qg*this.fov);return.5*this.getFilmHeight()/e}getEffectiveFOV(){return 2*dw*Math.atan(Math.tan(.5*Qg*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}setViewOffset(e,t,i,r,s,c){this.aspect=e/t,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=i,this.view.offsetY=r,this.view.width=s,this.view.height=c,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=this.near;let t=e*Math.tan(.5*Qg*this.fov)/this.zoom,i=2*t,r=this.aspect*i,s=-.5*r;const c=this.view;if(null!==this.view&&this.view.enabled){const m=c.fullWidth,y=c.fullHeight;s+=c.offsetX*r/m,t-=c.offsetY*i/y,r*=c.width/m,i*=c.height/y}const d=this.filmOffset;0!==d&&(s+=e*d/this.getFilmWidth()),this.projectionMatrix.makePerspective(s,s+r,t,t-i,e,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,null!==this.view&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}}class UJ extends Cl{constructor(e,t,i){super(),this.type="CubeCamera",this.renderTarget=i;const r=new Da(-90,1,e,t);r.layers=this.layers,r.up.set(0,1,0),r.lookAt(1,0,0),this.add(r);const s=new Da(-90,1,e,t);s.layers=this.layers,s.up.set(0,1,0),s.lookAt(-1,0,0),this.add(s);const c=new Da(-90,1,e,t);c.layers=this.layers,c.up.set(0,0,-1),c.lookAt(0,1,0),this.add(c);const d=new Da(-90,1,e,t);d.layers=this.layers,d.up.set(0,0,1),d.lookAt(0,-1,0),this.add(d);const m=new Da(-90,1,e,t);m.layers=this.layers,m.up.set(0,1,0),m.lookAt(0,0,1),this.add(m);const y=new Da(-90,1,e,t);y.layers=this.layers,y.up.set(0,1,0),y.lookAt(0,0,-1),this.add(y)}update(e,t){null===this.parent&&this.updateMatrixWorld();const i=this.renderTarget,[r,s,c,d,m,y]=this.children,w=e.getRenderTarget(),S=e.toneMapping,T=e.xr.enabled;e.toneMapping=0,e.xr.enabled=!1;const I=i.texture.generateMipmaps;i.texture.generateMipmaps=!1,e.setRenderTarget(i,0),e.render(t,r),e.setRenderTarget(i,1),e.render(t,s),e.setRenderTarget(i,2),e.render(t,c),e.setRenderTarget(i,3),e.render(t,d),e.setRenderTarget(i,4),e.render(t,m),i.texture.generateMipmaps=I,e.setRenderTarget(i,5),e.render(t,y),e.setRenderTarget(w),e.toneMapping=S,e.xr.enabled=T,i.texture.needsPMREMUpdate=!0}}class BS extends hm{constructor(e,t,i,r,s,c,d,m,y,w){super(e=void 0!==e?e:[],t=void 0!==t?t:301,i,r,s,c,d,m,y,w),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(e){this.image=e}}class HJ extends Jg{constructor(e=1,t={}){super(e,e,t),this.isWebGLCubeRenderTarget=!0;const i={width:e,height:e,depth:1};this.texture=new BS([i,i,i,i,i,i],t.mapping,t.wrapS,t.wrapT,t.magFilter,t.minFilter,t.format,t.type,t.anisotropy,t.encoding),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=void 0!==t.generateMipmaps&&t.generateMipmaps,this.texture.minFilter=void 0!==t.minFilter?t.minFilter:Eo}fromEquirectangularTexture(e,t){this.texture.type=t.type,this.texture.encoding=t.encoding,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;const i_uniforms={tEquirect:{value:null}},i_vertexShader="\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\tvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\n\t\t\t\t\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n\n\t\t\t\t}\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvWorldDirection = transformDirection( position, modelMatrix );\n\n\t\t\t\t\t#include <begin_vertex>\n\t\t\t\t\t#include <project_vertex>\n\n\t\t\t\t}\n\t\t\t",i_fragmentShader="\n\n\t\t\t\tuniform sampler2D tEquirect;\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\t#include <common>\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvec3 direction = normalize( vWorldDirection );\n\n\t\t\t\t\tvec2 sampleUV = equirectUv( direction );\n\n\t\t\t\t\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\n\t\t\t\t}\n\t\t\t",r=new t0(5,5,5),s=new ym({name:"CubemapFromEquirect",uniforms:n0(i_uniforms),vertexShader:i_vertexShader,fragmentShader:i_fragmentShader,side:1,blending:0});s.uniforms.tEquirect.value=t;const c=new Ka(r,s),d=t.minFilter;return t.minFilter===$g&&(t.minFilter=Eo),new UJ(1,10,this).update(e,c),t.minFilter=d,c.geometry.dispose(),c.material.dispose(),this}clear(e,t,i,r){const s=e.getRenderTarget();for(let c=0;c<6;c++)e.setRenderTarget(this,c),e.clear(t,i,r);e.setRenderTarget(s)}}const k2=new _e,GJ=new _e,jJ=new Xa;class i_{constructor(e=new _e(1,0,0),t=0){this.isPlane=!0,this.normal=e,this.constant=t}set(e,t){return this.normal.copy(e),this.constant=t,this}setComponents(e,t,i,r){return this.normal.set(e,t,i),this.constant=r,this}setFromNormalAndCoplanarPoint(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}setFromCoplanarPoints(e,t,i){const r=k2.subVectors(i,t).cross(GJ.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(r,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){const e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,t){return t.copy(e).addScaledVector(this.normal,-this.distanceToPoint(e))}intersectLine(e,t){const i=e.delta(k2),r=this.normal.dot(i);if(0===r)return 0===this.distanceToPoint(e.start)?t.copy(e.start):null;const s=-(e.start.dot(this.normal)+this.constant)/r;return s<0||s>1?null:t.copy(e.start).addScaledVector(i,s)}intersectsLine(e){const t=this.distanceToPoint(e.start),i=this.distanceToPoint(e.end);return t<0&&i>0||i<0&&t>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,t){const i=t||jJ.getNormalMatrix(e),r=this.coplanarPoint(k2).applyMatrix4(e),s=this.normal.applyMatrix3(i).normalize();return this.constant=-r.dot(s),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return(new this.constructor).copy(this)}}const o0=new Xv,zS=new _e;class L2{constructor(e=new i_,t=new i_,i=new i_,r=new i_,s=new i_,c=new i_){this.planes=[e,t,i,r,s,c]}set(e,t,i,r,s,c){const d=this.planes;return d[0].copy(e),d[1].copy(t),d[2].copy(i),d[3].copy(r),d[4].copy(s),d[5].copy(c),this}copy(e){const t=this.planes;for(let i=0;i<6;i++)t[i].copy(e.planes[i]);return this}setFromProjectionMatrix(e){const t=this.planes,i=e.elements,r=i[0],s=i[1],c=i[2],d=i[3],m=i[4],y=i[5],w=i[6],S=i[7],T=i[8],I=i[9],R=i[10],k=i[11],F=i[12],G=i[13],W=i[14],V=i[15];return t[0].setComponents(d-r,S-m,k-T,V-F).normalize(),t[1].setComponents(d+r,S+m,k+T,V+F).normalize(),t[2].setComponents(d+s,S+y,k+I,V+G).normalize(),t[3].setComponents(d-s,S-y,k-I,V-G).normalize(),t[4].setComponents(d-c,S-w,k-R,V-W).normalize(),t[5].setComponents(d+c,S+w,k+R,V+W).normalize(),this}intersectsObject(e){const t=e.geometry;return null===t.boundingSphere&&t.computeBoundingSphere(),o0.copy(t.boundingSphere).applyMatrix4(e.matrixWorld),this.intersectsSphere(o0)}intersectsSprite(e){return o0.center.set(0,0,0),o0.radius=.7071067811865476,o0.applyMatrix4(e.matrixWorld),this.intersectsSphere(o0)}intersectsSphere(e){const t=this.planes,i=e.center,r=-e.radius;for(let s=0;s<6;s++)if(t[s].distanceToPoint(i)<r)return!1;return!0}intersectsBox(e){const t=this.planes;for(let i=0;i<6;i++){const r=t[i];if(zS.x=r.normal.x>0?e.max.x:e.min.x,zS.y=r.normal.y>0?e.max.y:e.min.y,zS.z=r.normal.z>0?e.max.z:e.min.z,r.distanceToPoint(zS)<0)return!1}return!0}containsPoint(e){const t=this.planes;for(let i=0;i<6;i++)if(t[i].distanceToPoint(e)<0)return!1;return!0}clone(){return(new this.constructor).copy(this)}}function FV(){let n=null,e=!1,t=null,i=null;function r(s,c){t(s,c),i=n.requestAnimationFrame(r)}return{start:function(){!0!==e&&null!==t&&(i=n.requestAnimationFrame(r),e=!0)},stop:function(){n.cancelAnimationFrame(i),e=!1},setAnimationLoop:function(s){t=s},setContext:function(s){n=s}}}function $J(n,e){const t=e.isWebGL2,i=new WeakMap;return{get:function c(y){return y.isInterleavedBufferAttribute&&(y=y.data),i.get(y)},remove:function d(y){y.isInterleavedBufferAttribute&&(y=y.data);const w=i.get(y);w&&(n.deleteBuffer(w.buffer),i.delete(y))},update:function m(y,w){if(y.isGLBufferAttribute){const T=i.get(y);return void((!T||T.version<y.version)&&i.set(y,{buffer:y.buffer,type:y.type,bytesPerElement:y.elementSize,version:y.version}))}y.isInterleavedBufferAttribute&&(y=y.data);const S=i.get(y);void 0===S?i.set(y,function r(y,w){const S=y.array,T=y.usage,I=n.createBuffer();let R;if(n.bindBuffer(w,I),n.bufferData(w,S,T),y.onUploadCallback(),S instanceof Float32Array)R=5126;else if(S instanceof Uint16Array)if(y.isFloat16BufferAttribute){if(!t)throw new Error("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2.");R=5131}else R=5123;else if(S instanceof Int16Array)R=5122;else if(S instanceof Uint32Array)R=5125;else if(S instanceof Int32Array)R=5124;else if(S instanceof Int8Array)R=5120;else if(S instanceof Uint8Array)R=5121;else{if(!(S instanceof Uint8ClampedArray))throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+S);R=5121}return{buffer:I,type:R,bytesPerElement:S.BYTES_PER_ELEMENT,version:y.version}}(y,w)):S.version<y.version&&(function s(y,w,S){const T=w.array,I=w.updateRange;n.bindBuffer(S,y),-1===I.count?n.bufferSubData(S,0,T):(t?n.bufferSubData(S,I.offset*T.BYTES_PER_ELEMENT,T,I.offset,I.count):n.bufferSubData(S,I.offset*T.BYTES_PER_ELEMENT,T.subarray(I.offset,I.offset+I.count)),I.count=-1),w.onUploadCallback()}(S.buffer,y,w),S.version=y.version)}}}class VS extends Wi{constructor(e=1,t=1,i=1,r=1){super(),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:i,heightSegments:r};const s=e/2,c=t/2,d=Math.floor(i),m=Math.floor(r),y=d+1,w=m+1,S=e/d,T=t/m,I=[],R=[],k=[],F=[];for(let G=0;G<w;G++){const W=G*T-c;for(let V=0;V<y;V++)R.push(V*S-s,-W,0),k.push(0,0,1),F.push(V/d),F.push(1-G/m)}for(let G=0;G<m;G++)for(let W=0;W<d;W++){const X=W+y*(G+1),ee=W+1+y*(G+1),ae=W+1+y*G;I.push(W+y*G,X,ae),I.push(X,ee,ae)}this.setIndex(I),this.setAttribute("position",new kn(R,3)),this.setAttribute("normal",new kn(k,3)),this.setAttribute("uv",new kn(F,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new VS(e.width,e.height,e.widthSegments,e.heightSegments)}}const qi={alphamap_fragment:"#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, vUv ).g;\n#endif",alphamap_pars_fragment:"#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",alphatest_fragment:"#ifdef USE_ALPHATEST\n\tif ( diffuseColor.a < alphaTest ) discard;\n#endif",alphatest_pars_fragment:"#ifdef USE_ALPHATEST\n\tuniform float alphaTest;\n#endif",aomap_fragment:"#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\t#if defined( USE_ENVMAP ) && defined( STANDARD )\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );\n\t#endif\n#endif",aomap_pars_fragment:"#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif",begin_vertex:"vec3 transformed = vec3( position );",beginnormal_vertex:"vec3 objectNormal = vec3( normal );\n#ifdef USE_TANGENT\n\tvec3 objectTangent = vec3( tangent.xyz );\n#endif",bsdfs:"vec3 BRDF_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {\n\tfloat fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n\treturn f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n}\nfloat F_Schlick( const in float f0, const in float f90, const in float dotVH ) {\n\tfloat fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n\treturn f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n}\nvec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {\n    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );\n    float x2 = x * x;\n    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );\n    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );\n}\nfloat V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\nvec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 f0, const in float f90, const in float roughness ) {\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( f0, f90, dotVH );\n\tfloat V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\tfloat D = D_GGX( alpha, dotNH );\n\treturn F * ( V * D );\n}\n#ifdef USE_IRIDESCENCE\n\tvec3 BRDF_GGX_Iridescence( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 f0, const in float f90, const in float iridescence, const in vec3 iridescenceFresnel, const in float roughness ) {\n\t\tfloat alpha = pow2( roughness );\n\t\tvec3 halfDir = normalize( lightDir + viewDir );\n\t\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\t\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\t\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\t\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\t\tvec3 F = mix( F_Schlick( f0, f90, dotVH ), iridescenceFresnel, iridescence );\n\t\tfloat V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\t\tfloat D = D_GGX( alpha, dotNH );\n\t\treturn F * ( V * D );\n\t}\n#endif\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n\tconst float LUT_SIZE = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS = 0.5 / LUT_SIZE;\n\tfloat dotNV = saturate( dot( N, V ) );\n\tvec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\treturn uv;\n}\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n\tfloat l = length( f );\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n}\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n\tfloat x = dot( v1, v2 );\n\tfloat y = abs( x );\n\tfloat a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\n\tfloat b = 3.4175940 + ( 4.1616724 + y ) * y;\n\tfloat v = a / b;\n\tfloat theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\n\treturn cross( v1, v2 ) * theta_sintheta;\n}\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n\tvec3 lightNormal = cross( v1, v2 );\n\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n\tvec3 T1, T2;\n\tT1 = normalize( V - N * dot( V, N ) );\n\tT2 = - cross( N, T1 );\n\tmat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\n\tvec3 coords[ 4 ];\n\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n\tcoords[ 0 ] = normalize( coords[ 0 ] );\n\tcoords[ 1 ] = normalize( coords[ 1 ] );\n\tcoords[ 2 ] = normalize( coords[ 2 ] );\n\tcoords[ 3 ] = normalize( coords[ 3 ] );\n\tvec3 vectorFormFactor = vec3( 0.0 );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n\tfloat result = LTC_ClippedSphereFormFactor( vectorFormFactor );\n\treturn vec3( result );\n}\nfloat G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, 1.0, dotVH );\n\tfloat G = G_BlinnPhong_Implicit( );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n}\n#if defined( USE_SHEEN )\nfloat D_Charlie( float roughness, float dotNH ) {\n\tfloat alpha = pow2( roughness );\n\tfloat invAlpha = 1.0 / alpha;\n\tfloat cos2h = dotNH * dotNH;\n\tfloat sin2h = max( 1.0 - cos2h, 0.0078125 );\n\treturn ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );\n}\nfloat V_Neubelt( float dotNV, float dotNL ) {\n\treturn saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );\n}\nvec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat D = D_Charlie( sheenRoughness, dotNH );\n\tfloat V = V_Neubelt( dotNV, dotNL );\n\treturn sheenColor * ( D * V );\n}\n#endif",iridescence_fragment:"#ifdef USE_IRIDESCENCE\n\tconst mat3 XYZ_TO_REC709 = mat3(\n\t\t 3.2404542, -0.9692660,  0.0556434,\n\t\t-1.5371385,  1.8760108, -0.2040259,\n\t\t-0.4985314,  0.0415560,  1.0572252\n\t);\n\tvec3 Fresnel0ToIor( vec3 fresnel0 ) {\n\t\tvec3 sqrtF0 = sqrt( fresnel0 );\n\t\treturn ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );\n\t}\n\tvec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {\n\t\treturn pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );\n\t}\n\tfloat IorToFresnel0( float transmittedIor, float incidentIor ) {\n\t\treturn pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));\n\t}\n\tvec3 evalSensitivity( float OPD, vec3 shift ) {\n\t\tfloat phase = 2.0 * PI * OPD * 1.0e-9;\n\t\tvec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );\n\t\tvec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );\n\t\tvec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );\n\t\tvec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );\n\t\txyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );\n\t\txyz /= 1.0685e-7;\n\t\tvec3 rgb = XYZ_TO_REC709 * xyz;\n\t\treturn rgb;\n\t}\n\tvec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {\n\t\tvec3 I;\n\t\tfloat iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );\n\t\tfloat sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );\n\t\tfloat cosTheta2Sq = 1.0 - sinTheta2Sq;\n\t\tif ( cosTheta2Sq < 0.0 ) {\n\t\t\t return vec3( 1.0 );\n\t\t}\n\t\tfloat cosTheta2 = sqrt( cosTheta2Sq );\n\t\tfloat R0 = IorToFresnel0( iridescenceIOR, outsideIOR );\n\t\tfloat R12 = F_Schlick( R0, 1.0, cosTheta1 );\n\t\tfloat R21 = R12;\n\t\tfloat T121 = 1.0 - R12;\n\t\tfloat phi12 = 0.0;\n\t\tif ( iridescenceIOR < outsideIOR ) phi12 = PI;\n\t\tfloat phi21 = PI - phi12;\n\t\tvec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );\t\tvec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );\n\t\tvec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );\n\t\tvec3 phi23 = vec3( 0.0 );\n\t\tif ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;\n\t\tif ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;\n\t\tif ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;\n\t\tfloat OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;\n\t\tvec3 phi = vec3( phi21 ) + phi23;\n\t\tvec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );\n\t\tvec3 r123 = sqrt( R123 );\n\t\tvec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );\n\t\tvec3 C0 = R12 + Rs;\n\t\tI = C0;\n\t\tvec3 Cm = Rs - T121;\n\t\tfor ( int m = 1; m <= 2; ++ m ) {\n\t\t\tCm *= r123;\n\t\t\tvec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );\n\t\t\tI += Cm * Sm;\n\t\t}\n\t\treturn max( I, vec3( 0.0 ) );\n\t}\n#endif",bumpmap_pars_fragment:"#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\t\tvec2 dSTdx = dFdx( vUv );\n\t\tvec2 dSTdy = dFdy( vUv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {\n\t\tvec3 vSigmaX = dFdx( surf_pos.xyz );\n\t\tvec3 vSigmaY = dFdy( surf_pos.xyz );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 ) * faceDirection;\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif",clipping_planes_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvec4 plane;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\tplane = clippingPlanes[ i ];\n\t\tif ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;\n\t}\n\t#pragma unroll_loop_end\n\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\tbool clipped = true;\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tclipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t\tif ( clipped ) discard;\n\t#endif\n#endif",clipping_planes_pars_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif",clipping_planes_pars_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n#endif",clipping_planes_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvClipPosition = - mvPosition.xyz;\n#endif",color_fragment:"#if defined( USE_COLOR_ALPHA )\n\tdiffuseColor *= vColor;\n#elif defined( USE_COLOR )\n\tdiffuseColor.rgb *= vColor;\n#endif",color_pars_fragment:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR )\n\tvarying vec3 vColor;\n#endif",color_pars_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvarying vec3 vColor;\n#endif",color_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvColor = vec4( 1.0 );\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvColor = vec3( 1.0 );\n#endif\n#ifdef USE_COLOR\n\tvColor *= color;\n#endif\n#ifdef USE_INSTANCING_COLOR\n\tvColor.xyz *= instanceColor.xyz;\n#endif",common:"#define PI 3.141592653589793\n#define PI2 6.283185307179586\n#define PI_HALF 1.5707963267948966\n#define RECIPROCAL_PI 0.3183098861837907\n#define RECIPROCAL_PI2 0.15915494309189535\n#define EPSILON 1e-6\n#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\n#define whiteComplement( a ) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nvec3 pow2( const in vec3 x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }\nfloat average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract( sin( sn ) * c );\n}\n#ifdef HIGH_PRECISION\n\tfloat precisionSafeLength( vec3 v ) { return length( v ); }\n#else\n\tfloat precisionSafeLength( vec3 v ) {\n\t\tfloat maxComponent = max3( abs( v ) );\n\t\treturn length( v / maxComponent ) * maxComponent;\n\t}\n#endif\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\nstruct GeometricContext {\n\tvec3 position;\n\tvec3 normal;\n\tvec3 viewDir;\n#ifdef USE_CLEARCOAT\n\tvec3 clearcoatNormal;\n#endif\n};\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nmat3 transposeMat3( const in mat3 m ) {\n\tmat3 tmp;\n\ttmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\n\ttmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\n\ttmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\n\treturn tmp;\n}\nfloat luminance( const in vec3 rgb ) {\n\tconst vec3 weights = vec3( 0.2126729, 0.7151522, 0.0721750 );\n\treturn dot( weights, rgb );\n}\nbool isPerspectiveMatrix( mat4 m ) {\n\treturn m[ 2 ][ 3 ] == - 1.0;\n}\nvec2 equirectUv( in vec3 dir ) {\n\tfloat u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;\n\tfloat v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\treturn vec2( u, v );\n}",cube_uv_reflection_fragment:"#ifdef ENVMAP_TYPE_CUBE_UV\n\t#define cubeUV_minMipLevel 4.0\n\t#define cubeUV_minTileSize 16.0\n\tfloat getFace( vec3 direction ) {\n\t\tvec3 absDirection = abs( direction );\n\t\tfloat face = - 1.0;\n\t\tif ( absDirection.x > absDirection.z ) {\n\t\t\tif ( absDirection.x > absDirection.y )\n\t\t\t\tface = direction.x > 0.0 ? 0.0 : 3.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t} else {\n\t\t\tif ( absDirection.z > absDirection.y )\n\t\t\t\tface = direction.z > 0.0 ? 2.0 : 5.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t}\n\t\treturn face;\n\t}\n\tvec2 getUV( vec3 direction, float face ) {\n\t\tvec2 uv;\n\t\tif ( face == 0.0 ) {\n\t\t\tuv = vec2( direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 1.0 ) {\n\t\t\tuv = vec2( - direction.x, - direction.z ) / abs( direction.y );\n\t\t} else if ( face == 2.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.y ) / abs( direction.z );\n\t\t} else if ( face == 3.0 ) {\n\t\t\tuv = vec2( - direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 4.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.z ) / abs( direction.y );\n\t\t} else {\n\t\t\tuv = vec2( direction.x, direction.y ) / abs( direction.z );\n\t\t}\n\t\treturn 0.5 * ( uv + 1.0 );\n\t}\n\tvec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {\n\t\tfloat face = getFace( direction );\n\t\tfloat filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );\n\t\tmipInt = max( mipInt, cubeUV_minMipLevel );\n\t\tfloat faceSize = exp2( mipInt );\n\t\thighp vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;\n\t\tif ( face > 2.0 ) {\n\t\t\tuv.y += faceSize;\n\t\t\tface -= 3.0;\n\t\t}\n\t\tuv.x += face * faceSize;\n\t\tuv.x += filterInt * 3.0 * cubeUV_minTileSize;\n\t\tuv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );\n\t\tuv.x *= CUBEUV_TEXEL_WIDTH;\n\t\tuv.y *= CUBEUV_TEXEL_HEIGHT;\n\t\t#ifdef texture2DGradEXT\n\t\t\treturn texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;\n\t\t#else\n\t\t\treturn texture2D( envMap, uv ).rgb;\n\t\t#endif\n\t}\n\t#define cubeUV_r0 1.0\n\t#define cubeUV_v0 0.339\n\t#define cubeUV_m0 - 2.0\n\t#define cubeUV_r1 0.8\n\t#define cubeUV_v1 0.276\n\t#define cubeUV_m1 - 1.0\n\t#define cubeUV_r4 0.4\n\t#define cubeUV_v4 0.046\n\t#define cubeUV_m4 2.0\n\t#define cubeUV_r5 0.305\n\t#define cubeUV_v5 0.016\n\t#define cubeUV_m5 3.0\n\t#define cubeUV_r6 0.21\n\t#define cubeUV_v6 0.0038\n\t#define cubeUV_m6 4.0\n\tfloat roughnessToMip( float roughness ) {\n\t\tfloat mip = 0.0;\n\t\tif ( roughness >= cubeUV_r1 ) {\n\t\t\tmip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;\n\t\t} else if ( roughness >= cubeUV_r4 ) {\n\t\t\tmip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;\n\t\t} else if ( roughness >= cubeUV_r5 ) {\n\t\t\tmip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;\n\t\t} else if ( roughness >= cubeUV_r6 ) {\n\t\t\tmip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;\n\t\t} else {\n\t\t\tmip = - 2.0 * log2( 1.16 * roughness );\t\t}\n\t\treturn mip;\n\t}\n\tvec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {\n\t\tfloat mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );\n\t\tfloat mipF = fract( mip );\n\t\tfloat mipInt = floor( mip );\n\t\tvec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );\n\t\tif ( mipF == 0.0 ) {\n\t\t\treturn vec4( color0, 1.0 );\n\t\t} else {\n\t\t\tvec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );\n\t\t\treturn vec4( mix( color0, color1, mipF ), 1.0 );\n\t\t}\n\t}\n#endif",defaultnormal_vertex:"vec3 transformedNormal = objectNormal;\n#ifdef USE_INSTANCING\n\tmat3 m = mat3( instanceMatrix );\n\ttransformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );\n\ttransformedNormal = m * transformedNormal;\n#endif\ntransformedNormal = normalMatrix * transformedNormal;\n#ifdef FLIP_SIDED\n\ttransformedNormal = - transformedNormal;\n#endif\n#ifdef USE_TANGENT\n\tvec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#ifdef FLIP_SIDED\n\t\ttransformedTangent = - transformedTangent;\n\t#endif\n#endif",displacementmap_pars_vertex:"#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif",displacementmap_vertex:"#ifdef USE_DISPLACEMENTMAP\n\ttransformed += normalize( objectNormal ) * ( texture2D( displacementMap, vUv ).x * displacementScale + displacementBias );\n#endif",emissivemap_fragment:"#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D( emissiveMap, vUv );\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif",emissivemap_pars_fragment:"#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif",encodings_fragment:"gl_FragColor = linearToOutputTexel( gl_FragColor );",encodings_pars_fragment:"vec4 LinearToLinear( in vec4 value ) {\n\treturn value;\n}\nvec4 LinearTosRGB( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );\n}",envmap_fragment:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvec3 cameraToFrag;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToFrag = normalize( vWorldPosition - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( cameraToFrag, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec = vReflect;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t#else\n\t\tvec4 envColor = vec4( 0.0 );\n\t#endif\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif",envmap_common_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float envMapIntensity;\n\tuniform float flipEnvMap;\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\t\n#endif",envmap_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float reflectivity;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\tvarying vec3 vWorldPosition;\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif",envmap_pars_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\t\n\t\tvarying vec3 vWorldPosition;\n\t#else\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\t#endif\n#endif",envmap_physical_pars_fragment:"#if defined( USE_ENVMAP )\n\tvec3 getIBLIrradiance( const in vec3 normal ) {\n\t\t#if defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );\n\t\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n\tvec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {\n\t\t#if defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 reflectVec = reflect( - viewDir, normal );\n\t\t\treflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );\n\t\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );\n\t\t\treturn envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n#endif",envmap_vertex:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvWorldPosition = worldPosition.xyz;\n\t#else\n\t\tvec3 cameraToVertex;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#endif\n#endif",fog_vertex:"#ifdef USE_FOG\n\tvFogDepth = - mvPosition.z;\n#endif",fog_pars_vertex:"#ifdef USE_FOG\n\tvarying float vFogDepth;\n#endif",fog_fragment:"#ifdef USE_FOG\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, vFogDepth );\n\t#endif\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif",fog_pars_fragment:"#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\tvarying float vFogDepth;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif",gradientmap_pars_fragment:"#ifdef USE_GRADIENTMAP\n\tuniform sampler2D gradientMap;\n#endif\nvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\tfloat dotNL = dot( normal, lightDirection );\n\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\t#ifdef USE_GRADIENTMAP\n\t\treturn vec3( texture2D( gradientMap, coord ).r );\n\t#else\n\t\tvec2 fw = fwidth( coord ) * 0.5;\n\t\treturn mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );\n\t#endif\n}",lightmap_fragment:"#ifdef USE_LIGHTMAP\n\tvec4 lightMapTexel = texture2D( lightMap, vUv2 );\n\tvec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;\n\treflectedLight.indirectDiffuse += lightMapIrradiance;\n#endif",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif",lights_lambert_fragment:"LambertMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularStrength = specularStrength;",lights_lambert_pars_fragment:"varying vec3 vViewPosition;\nstruct LambertMaterial {\n\tvec3 diffuseColor;\n\tfloat specularStrength;\n};\nvoid RE_Direct_Lambert( const in IncidentLight directLight, const in GeometricContext geometry, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in GeometricContext geometry, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Lambert\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Lambert",lights_pars_begin:"uniform bool receiveShadow;\nuniform vec3 ambientLightColor;\nuniform vec3 lightProbe[ 9 ];\nvec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {\n\tfloat x = normal.x, y = normal.y, z = normal.z;\n\tvec3 result = shCoefficients[ 0 ] * 0.886227;\n\tresult += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;\n\tresult += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;\n\tresult += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;\n\tresult += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;\n\tresult += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;\n\tresult += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );\n\tresult += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;\n\tresult += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );\n\treturn result;\n}\nvec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {\n\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\tvec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );\n\treturn irradiance;\n}\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\treturn irradiance;\n}\nfloat getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n\t#if defined ( LEGACY_LIGHTS )\n\t\tif ( cutoffDistance > 0.0 && decayExponent > 0.0 ) {\n\t\t\treturn pow( saturate( - lightDistance / cutoffDistance + 1.0 ), decayExponent );\n\t\t}\n\t\treturn 1.0;\n\t#else\n\t\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\t\tif ( cutoffDistance > 0.0 ) {\n\t\t\tdistanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t\t}\n\t\treturn distanceFalloff;\n\t#endif\n}\nfloat getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {\n\treturn smoothstep( coneCosine, penumbraCosine, angleCosine );\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\tvoid getDirectionalLightInfo( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight light ) {\n\t\tlight.color = directionalLight.color;\n\t\tlight.direction = directionalLight.direction;\n\t\tlight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\tvoid getPointLightInfo( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight light ) {\n\t\tvec3 lVector = pointLight.position - geometry.position;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tlight.color = pointLight.color;\n\t\tlight.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );\n\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\tvoid getSpotLightInfo( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight light ) {\n\t\tvec3 lVector = spotLight.position - geometry.position;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat angleCos = dot( light.direction, spotLight.direction );\n\t\tfloat spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\tif ( spotAttenuation > 0.0 ) {\n\t\t\tfloat lightDistance = length( lVector );\n\t\t\tlight.color = spotLight.color * spotAttenuation;\n\t\t\tlight.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t\t} else {\n\t\t\tlight.color = vec3( 0.0 );\n\t\t\tlight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\tuniform sampler2D ltc_1;\tuniform sampler2D ltc_2;\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {\n\t\tfloat dotNL = dot( normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\treturn irradiance;\n\t}\n#endif",lights_toon_fragment:"ToonMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;",lights_toon_pars_fragment:"varying vec3 vViewPosition;\nstruct ToonMaterial {\n\tvec3 diffuseColor;\n};\nvoid RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\tvec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Toon\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Toon",lights_phong_fragment:"BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;",lights_phong_pars_fragment:"varying vec3 vViewPosition;\nstruct BlinnPhongMaterial {\n\tvec3 diffuseColor;\n\tvec3 specularColor;\n\tfloat specularShininess;\n\tfloat specularStrength;\n};\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong",lights_physical_fragment:"PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nvec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );\nfloat geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );\nmaterial.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;\nmaterial.roughness = min( material.roughness, 1.0 );\n#ifdef IOR\n\tmaterial.ior = ior;\n\t#ifdef SPECULAR\n\t\tfloat specularIntensityFactor = specularIntensity;\n\t\tvec3 specularColorFactor = specularColor;\n\t\t#ifdef USE_SPECULARINTENSITYMAP\n\t\t\tspecularIntensityFactor *= texture2D( specularIntensityMap, vUv ).a;\n\t\t#endif\n\t\t#ifdef USE_SPECULARCOLORMAP\n\t\t\tspecularColorFactor *= texture2D( specularColorMap, vUv ).rgb;\n\t\t#endif\n\t\tmaterial.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );\n\t#else\n\t\tfloat specularIntensityFactor = 1.0;\n\t\tvec3 specularColorFactor = vec3( 1.0 );\n\t\tmaterial.specularF90 = 1.0;\n\t#endif\n\tmaterial.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );\n#else\n\tmaterial.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );\n\tmaterial.specularF90 = 1.0;\n#endif\n#ifdef USE_CLEARCOAT\n\tmaterial.clearcoat = clearcoat;\n\tmaterial.clearcoatRoughness = clearcoatRoughness;\n\tmaterial.clearcoatF0 = vec3( 0.04 );\n\tmaterial.clearcoatF90 = 1.0;\n\t#ifdef USE_CLEARCOATMAP\n\t\tmaterial.clearcoat *= texture2D( clearcoatMap, vUv ).x;\n\t#endif\n\t#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\t\tmaterial.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vUv ).y;\n\t#endif\n\tmaterial.clearcoat = saturate( material.clearcoat );\tmaterial.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );\n\tmaterial.clearcoatRoughness += geometryRoughness;\n\tmaterial.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );\n#endif\n#ifdef USE_IRIDESCENCE\n\tmaterial.iridescence = iridescence;\n\tmaterial.iridescenceIOR = iridescenceIOR;\n\t#ifdef USE_IRIDESCENCEMAP\n\t\tmaterial.iridescence *= texture2D( iridescenceMap, vUv ).r;\n\t#endif\n\t#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\t\tmaterial.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vUv ).g + iridescenceThicknessMinimum;\n\t#else\n\t\tmaterial.iridescenceThickness = iridescenceThicknessMaximum;\n\t#endif\n#endif\n#ifdef USE_SHEEN\n\tmaterial.sheenColor = sheenColor;\n\t#ifdef USE_SHEENCOLORMAP\n\t\tmaterial.sheenColor *= texture2D( sheenColorMap, vUv ).rgb;\n\t#endif\n\tmaterial.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );\n\t#ifdef USE_SHEENROUGHNESSMAP\n\t\tmaterial.sheenRoughness *= texture2D( sheenRoughnessMap, vUv ).a;\n\t#endif\n#endif",lights_physical_pars_fragment:"struct PhysicalMaterial {\n\tvec3 diffuseColor;\n\tfloat roughness;\n\tvec3 specularColor;\n\tfloat specularF90;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat clearcoat;\n\t\tfloat clearcoatRoughness;\n\t\tvec3 clearcoatF0;\n\t\tfloat clearcoatF90;\n\t#endif\n\t#ifdef USE_IRIDESCENCE\n\t\tfloat iridescence;\n\t\tfloat iridescenceIOR;\n\t\tfloat iridescenceThickness;\n\t\tvec3 iridescenceFresnel;\n\t\tvec3 iridescenceF0;\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tvec3 sheenColor;\n\t\tfloat sheenRoughness;\n\t#endif\n\t#ifdef IOR\n\t\tfloat ior;\n\t#endif\n\t#ifdef USE_TRANSMISSION\n\t\tfloat transmission;\n\t\tfloat transmissionAlpha;\n\t\tfloat thickness;\n\t\tfloat attenuationDistance;\n\t\tvec3 attenuationColor;\n\t#endif\n};\nvec3 clearcoatSpecular = vec3( 0.0 );\nvec3 sheenSpecular = vec3( 0.0 );\nfloat IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat r2 = roughness * roughness;\n\tfloat a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;\n\tfloat b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;\n\tfloat DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );\n\treturn saturate( DG * RECIPROCAL_PI );\n}\nvec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\tvec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;\n\treturn fab;\n}\nvec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\treturn specularColor * fab.x + specularF90 * fab.y;\n}\n#ifdef USE_IRIDESCENCE\nvoid computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n#else\nvoid computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n#endif\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\t#ifdef USE_IRIDESCENCE\n\t\tvec3 Fr = mix( specularColor, iridescenceF0, iridescence );\n\t#else\n\t\tvec3 Fr = specularColor;\n\t#endif\n\tvec3 FssEss = Fr * fab.x + specularF90 * fab.y;\n\tfloat Ess = fab.x + fab.y;\n\tfloat Ems = 1.0 - Ess;\n\tvec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;\tvec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );\n\tsingleScatter += FssEss;\n\tmultiScatter += Fms * Ems;\n}\n#if NUM_RECT_AREA_LIGHTS > 0\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t\tvec3 normal = geometry.normal;\n\t\tvec3 viewDir = geometry.viewDir;\n\t\tvec3 position = geometry.position;\n\t\tvec3 lightPos = rectAreaLight.position;\n\t\tvec3 halfWidth = rectAreaLight.halfWidth;\n\t\tvec3 halfHeight = rectAreaLight.halfHeight;\n\t\tvec3 lightColor = rectAreaLight.color;\n\t\tfloat roughness = material.roughness;\n\t\tvec3 rectCoords[ 4 ];\n\t\trectCoords[ 0 ] = lightPos + halfWidth - halfHeight;\t\trectCoords[ 1 ] = lightPos - halfWidth - halfHeight;\n\t\trectCoords[ 2 ] = lightPos - halfWidth + halfHeight;\n\t\trectCoords[ 3 ] = lightPos + halfWidth + halfHeight;\n\t\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\n\t\tvec4 t1 = texture2D( ltc_1, uv );\n\t\tvec4 t2 = texture2D( ltc_2, uv );\n\t\tmat3 mInv = mat3(\n\t\t\tvec3( t1.x, 0, t1.y ),\n\t\t\tvec3(    0, 1,    0 ),\n\t\t\tvec3( t1.z, 0, t1.w )\n\t\t);\n\t\tvec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );\n\t\treflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n\t\treflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\n\t}\n#endif\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNLcc = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );\n\t\tvec3 ccIrradiance = dotNLcc * directLight.color;\n\t\tclearcoatSpecular += ccIrradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.clearcoatNormal, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tsheenSpecular += irradiance * BRDF_Sheen( directLight.direction, geometry.viewDir, geometry.normal, material.sheenColor, material.sheenRoughness );\n\t#endif\n\t#ifdef USE_IRIDESCENCE\n\t\treflectedLight.directSpecular += irradiance * BRDF_GGX_Iridescence( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness );\n\t#else\n\t\treflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularF90, material.roughness );\n\t#endif\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatSpecular += clearcoatRadiance * EnvironmentBRDF( geometry.clearcoatNormal, geometry.viewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tsheenSpecular += irradiance * material.sheenColor * IBLSheenBRDF( geometry.normal, geometry.viewDir, material.sheenRoughness );\n\t#endif\n\tvec3 singleScattering = vec3( 0.0 );\n\tvec3 multiScattering = vec3( 0.0 );\n\tvec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;\n\t#ifdef USE_IRIDESCENCE\n\t\tcomputeMultiscatteringIridescence( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );\n\t#else\n\t\tcomputeMultiscattering( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );\n\t#endif\n\tvec3 totalScattering = singleScattering + multiScattering;\n\tvec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );\n\treflectedLight.indirectSpecular += radiance * singleScattering;\n\treflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;\n\treflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;\n}\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}",lights_fragment_begin:"\nGeometricContext geometry;\ngeometry.position = - vViewPosition;\ngeometry.normal = normal;\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );\n#ifdef USE_CLEARCOAT\n\tgeometry.clearcoatNormal = clearcoatNormal;\n#endif\n#ifdef USE_IRIDESCENCE\n\tfloat dotNVi = saturate( dot( normal, geometry.viewDir ) );\n\tif ( material.iridescenceThickness == 0.0 ) {\n\t\tmaterial.iridescence = 0.0;\n\t} else {\n\t\tmaterial.iridescence = saturate( material.iridescence );\n\t}\n\tif ( material.iridescence > 0.0 ) {\n\t\tmaterial.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );\n\t\tmaterial.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );\n\t}\n#endif\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tgetPointLightInfo( pointLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )\n\t\tpointLightShadow = pointLightShadows[ i ];\n\t\tdirectLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\tvec4 spotColor;\n\tvec3 spotLightCoord;\n\tbool inSpotLightMap;\n\t#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotLightInfo( spotLight, geometry, directLight );\n\t\t#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )\n\t\t#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX\n\t\t#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\t#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS\n\t\t#else\n\t\t#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )\n\t\t#endif\n\t\t#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )\n\t\t\tspotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;\n\t\t\tinSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );\n\t\t\tspotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );\n\t\t\tdirectLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;\n\t\t#endif\n\t\t#undef SPOT_LIGHT_MAP_INDEX\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\tspotLightShadow = spotLightShadows[ i ];\n\t\tdirectLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalLightInfo( directionalLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )\n\t\tdirectionalLightShadow = directionalLightShadows[ i ];\n\t\tdirectLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\tRectAreaLight rectAreaLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 iblIrradiance = vec3( 0.0 );\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\tirradiance += getLightProbeIrradiance( lightProbe, geometry.normal );\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if defined( RE_IndirectSpecular )\n\tvec3 radiance = vec3( 0.0 );\n\tvec3 clearcoatRadiance = vec3( 0.0 );\n#endif",lights_fragment_maps:"#if defined( RE_IndirectDiffuse )\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel = texture2D( lightMap, vUv2 );\n\t\tvec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;\n\t\tirradiance += lightMapIrradiance;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )\n\t\tiblIrradiance += getIBLIrradiance( geometry.normal );\n\t#endif\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\tradiance += getIBLRadiance( geometry.viewDir, geometry.normal, material.roughness );\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatRadiance += getIBLRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness );\n\t#endif\n#endif",lights_fragment_end:"#if defined( RE_IndirectDiffuse )\n\tRE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );\n#endif\n#if defined( RE_IndirectSpecular )\n\tRE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );\n#endif",logdepthbuf_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tgl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;\n#endif",logdepthbuf_pars_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tuniform float logDepthBufFC;\n\tvarying float vFragDepth;\n\tvarying float vIsPerspective;\n#endif",logdepthbuf_pars_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t\tvarying float vIsPerspective;\n\t#else\n\t\tuniform float logDepthBufFC;\n\t#endif\n#endif",logdepthbuf_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvFragDepth = 1.0 + gl_Position.w;\n\t\tvIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );\n\t#else\n\t\tif ( isPerspectiveMatrix( projectionMatrix ) ) {\n\t\t\tgl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;\n\t\t\tgl_Position.z *= gl_Position.w;\n\t\t}\n\t#endif\n#endif",map_fragment:"#ifdef USE_MAP\n\tvec4 sampledDiffuseColor = texture2D( map, vUv );\n\t#ifdef DECODE_VIDEO_TEXTURE\n\t\tsampledDiffuseColor = vec4( mix( pow( sampledDiffuseColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), sampledDiffuseColor.rgb * 0.0773993808, vec3( lessThanEqual( sampledDiffuseColor.rgb, vec3( 0.04045 ) ) ) ), sampledDiffuseColor.w );\n\t#endif\n\tdiffuseColor *= sampledDiffuseColor;\n#endif",map_pars_fragment:"#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif",map_particle_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\tvec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\n#endif\n#ifdef USE_MAP\n\tdiffuseColor *= texture2D( map, uv );\n#endif\n#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, uv ).g;\n#endif",map_particle_pars_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\tuniform mat3 uvTransform;\n#endif\n#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",metalnessmap_fragment:"float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n\tvec4 texelMetalness = texture2D( metalnessMap, vUv );\n\tmetalnessFactor *= texelMetalness.b;\n#endif",metalnessmap_pars_fragment:"#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif",morphcolor_vertex:"#if defined( USE_MORPHCOLORS ) && defined( MORPHTARGETS_TEXTURE )\n\tvColor *= morphTargetBaseInfluence;\n\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t#if defined( USE_COLOR_ALPHA )\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];\n\t\t#elif defined( USE_COLOR )\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];\n\t\t#endif\n\t}\n#endif",morphnormal_vertex:"#ifdef USE_MORPHNORMALS\n\tobjectNormal *= morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];\n\t\t}\n\t#else\n\t\tobjectNormal += morphNormal0 * morphTargetInfluences[ 0 ];\n\t\tobjectNormal += morphNormal1 * morphTargetInfluences[ 1 ];\n\t\tobjectNormal += morphNormal2 * morphTargetInfluences[ 2 ];\n\t\tobjectNormal += morphNormal3 * morphTargetInfluences[ 3 ];\n\t#endif\n#endif",morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\n\tuniform float morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tuniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];\n\t\tuniform sampler2DArray morphTargetsTexture;\n\t\tuniform ivec2 morphTargetsTextureSize;\n\t\tvec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {\n\t\t\tint texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;\n\t\t\tint y = texelIndex / morphTargetsTextureSize.x;\n\t\t\tint x = texelIndex - y * morphTargetsTextureSize.x;\n\t\t\tivec3 morphUV = ivec3( x, y, morphTargetIndex );\n\t\t\treturn texelFetch( morphTargetsTexture, morphUV, 0 );\n\t\t}\n\t#else\n\t\t#ifndef USE_MORPHNORMALS\n\t\t\tuniform float morphTargetInfluences[ 8 ];\n\t\t#else\n\t\t\tuniform float morphTargetInfluences[ 4 ];\n\t\t#endif\n\t#endif\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\n\ttransformed *= morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];\n\t\t}\n\t#else\n\t\ttransformed += morphTarget0 * morphTargetInfluences[ 0 ];\n\t\ttransformed += morphTarget1 * morphTargetInfluences[ 1 ];\n\t\ttransformed += morphTarget2 * morphTargetInfluences[ 2 ];\n\t\ttransformed += morphTarget3 * morphTargetInfluences[ 3 ];\n\t\t#ifndef USE_MORPHNORMALS\n\t\t\ttransformed += morphTarget4 * morphTargetInfluences[ 4 ];\n\t\t\ttransformed += morphTarget5 * morphTargetInfluences[ 5 ];\n\t\t\ttransformed += morphTarget6 * morphTargetInfluences[ 6 ];\n\t\t\ttransformed += morphTarget7 * morphTargetInfluences[ 7 ];\n\t\t#endif\n\t#endif\n#endif",normal_fragment_begin:"float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;\n#ifdef FLAT_SHADED\n\tvec3 fdx = dFdx( vViewPosition );\n\tvec3 fdy = dFdy( vViewPosition );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n#else\n\tvec3 normal = normalize( vNormal );\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * faceDirection;\n\t#endif\n\t#ifdef USE_TANGENT\n\t\tvec3 tangent = normalize( vTangent );\n\t\tvec3 bitangent = normalize( vBitangent );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\ttangent = tangent * faceDirection;\n\t\t\tbitangent = bitangent * faceDirection;\n\t\t#endif\n\t\t#if defined( TANGENTSPACE_NORMALMAP ) || defined( USE_CLEARCOAT_NORMALMAP )\n\t\t\tmat3 vTBN = mat3( tangent, bitangent, normal );\n\t\t#endif\n\t#endif\n#endif\nvec3 geometryNormal = normal;",normal_fragment_maps:"#ifdef OBJECTSPACE_NORMALMAP\n\tnormal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\t#ifdef FLIP_SIDED\n\t\tnormal = - normal;\n\t#endif\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * faceDirection;\n\t#endif\n\tnormal = normalize( normalMatrix * normal );\n#elif defined( TANGENTSPACE_NORMALMAP )\n\tvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\tmapN.xy *= normalScale;\n\t#ifdef USE_TANGENT\n\t\tnormal = normalize( vTBN * mapN );\n\t#else\n\t\tnormal = perturbNormal2Arb( - vViewPosition, normal, mapN, faceDirection );\n\t#endif\n#elif defined( USE_BUMPMAP )\n\tnormal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );\n#endif",normal_pars_fragment:"#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_pars_vertex:"#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_vertex:"#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif",normalmap_pars_fragment:"#ifdef USE_NORMALMAP\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n#endif\n#ifdef OBJECTSPACE_NORMALMAP\n\tuniform mat3 normalMatrix;\n#endif\n#if ! defined ( USE_TANGENT ) && ( defined ( TANGENTSPACE_NORMALMAP ) || defined ( USE_CLEARCOAT_NORMALMAP ) )\n\tvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec3 mapN, float faceDirection ) {\n\t\tvec3 q0 = dFdx( eye_pos.xyz );\n\t\tvec3 q1 = dFdy( eye_pos.xyz );\n\t\tvec2 st0 = dFdx( vUv.st );\n\t\tvec2 st1 = dFdy( vUv.st );\n\t\tvec3 N = surf_norm;\n\t\tvec3 q1perp = cross( q1, N );\n\t\tvec3 q0perp = cross( N, q0 );\n\t\tvec3 T = q1perp * st0.x + q0perp * st1.x;\n\t\tvec3 B = q1perp * st0.y + q0perp * st1.y;\n\t\tfloat det = max( dot( T, T ), dot( B, B ) );\n\t\tfloat scale = ( det == 0.0 ) ? 0.0 : faceDirection * inversesqrt( det );\n\t\treturn normalize( T * ( mapN.x * scale ) + B * ( mapN.y * scale ) + N * mapN.z );\n\t}\n#endif",clearcoat_normal_fragment_begin:"#ifdef USE_CLEARCOAT\n\tvec3 clearcoatNormal = geometryNormal;\n#endif",clearcoat_normal_fragment_maps:"#ifdef USE_CLEARCOAT_NORMALMAP\n\tvec3 clearcoatMapN = texture2D( clearcoatNormalMap, vUv ).xyz * 2.0 - 1.0;\n\tclearcoatMapN.xy *= clearcoatNormalScale;\n\t#ifdef USE_TANGENT\n\t\tclearcoatNormal = normalize( vTBN * clearcoatMapN );\n\t#else\n\t\tclearcoatNormal = perturbNormal2Arb( - vViewPosition, clearcoatNormal, clearcoatMapN, faceDirection );\n\t#endif\n#endif",clearcoat_pars_fragment:"#ifdef USE_CLEARCOATMAP\n\tuniform sampler2D clearcoatMap;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tuniform sampler2D clearcoatRoughnessMap;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform sampler2D clearcoatNormalMap;\n\tuniform vec2 clearcoatNormalScale;\n#endif",iridescence_pars_fragment:"#ifdef USE_IRIDESCENCEMAP\n\tuniform sampler2D iridescenceMap;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tuniform sampler2D iridescenceThicknessMap;\n#endif",output_fragment:"#ifdef OPAQUE\ndiffuseColor.a = 1.0;\n#endif\n#ifdef USE_TRANSMISSION\ndiffuseColor.a *= material.transmissionAlpha + 0.1;\n#endif\ngl_FragColor = vec4( outgoingLight, diffuseColor.a );",packing:"vec3 packNormalToRGB( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n\treturn 2.0 * rgb.xyz - 1.0;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\nconst float ShiftRight8 = 1. / 256.;\nvec4 packDepthToRGBA( const in float v ) {\n\tvec4 r = vec4( fract( v * PackFactors ), v );\n\tr.yzw -= r.xyz * ShiftRight8;\treturn r * PackUpscale;\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors );\n}\nvec2 packDepthToRG( in highp float v ) {\n\treturn packDepthToRGBA( v ).yx;\n}\nfloat unpackRGToDepth( const in highp vec2 v ) {\n\treturn unpackRGBAToDepth( vec4( v.xy, 0.0, 0.0 ) );\n}\nvec4 pack2HalfToRGBA( vec2 v ) {\n\tvec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );\n\treturn vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );\n}\nvec2 unpackRGBATo2Half( vec4 v ) {\n\treturn vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {\n\treturn linearClipZ * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {\n\treturn ( near * far ) / ( ( far - near ) * invClipZ - far );\n}",premultiplied_alpha_fragment:"#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif",project_vertex:"vec4 mvPosition = vec4( transformed, 1.0 );\n#ifdef USE_INSTANCING\n\tmvPosition = instanceMatrix * mvPosition;\n#endif\nmvPosition = modelViewMatrix * mvPosition;\ngl_Position = projectionMatrix * mvPosition;",dithering_fragment:"#ifdef DITHERING\n\tgl_FragColor.rgb = dithering( gl_FragColor.rgb );\n#endif",dithering_pars_fragment:"#ifdef DITHERING\n\tvec3 dithering( vec3 color ) {\n\t\tfloat grid_position = rand( gl_FragCoord.xy );\n\t\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n\t\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n\t\treturn color + dither_shift_RGB;\n\t}\n#endif",roughnessmap_fragment:"float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n\tvec4 texelRoughness = texture2D( roughnessMap, vUv );\n\troughnessFactor *= texelRoughness.g;\n#endif",roughnessmap_pars_fragment:"#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif",shadowmap_pars_fragment:"#if NUM_SPOT_LIGHT_COORDS > 0\n\tvarying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];\n#endif\n#if NUM_SPOT_LIGHT_MAPS > 0\n\tuniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];\n#endif\n#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\t}\n\tvec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {\n\t\treturn unpackRGBATo2Half( texture2D( shadow, uv ) );\n\t}\n\tfloat VSMShadow (sampler2D shadow, vec2 uv, float compare ){\n\t\tfloat occlusion = 1.0;\n\t\tvec2 distribution = texture2DDistribution( shadow, uv );\n\t\tfloat hard_shadow = step( compare , distribution.x );\n\t\tif (hard_shadow != 1.0 ) {\n\t\t\tfloat distance = compare - distribution.x ;\n\t\t\tfloat variance = max( 0.00000, distribution.y * distribution.y );\n\t\t\tfloat softness_probability = variance / (variance + distance * distance );\t\t\tsoftness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );\t\t\tocclusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );\n\t\t}\n\t\treturn occlusion;\n\t}\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tfloat shadow = 1.0;\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\t\tbool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;\n\t\tbool frustumTest = inFrustum && shadowCoord.z <= 1.0;\n\t\tif ( frustumTest ) {\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tfloat dx2 = dx0 / 2.0;\n\t\t\tfloat dy2 = dy0 / 2.0;\n\t\t\tfloat dx3 = dx1 / 2.0;\n\t\t\tfloat dy3 = dy1 / 2.0;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 17.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx = texelSize.x;\n\t\t\tfloat dy = texelSize.y;\n\t\t\tvec2 uv = shadowCoord.xy;\n\t\t\tvec2 f = fract( uv * shadowMapSize + 0.5 );\n\t\t\tuv -= f * texelSize;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, uv, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t f.y )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_VSM )\n\t\t\tshadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#else\n\t\t\tshadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#endif\n\t\t}\n\t\treturn shadow;\n\t}\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\t\tvec3 absV = abs( v );\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\t\tvec2 planar = v.xy;\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\t\tif ( absV.z >= almostOne ) {\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\t\t} else if ( absV.x >= almostOne ) {\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\t\t} else if ( absV.y >= almostOne ) {\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\t\t}\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\t}\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\tfloat dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );\t\tdp += shadowBias;\n\t\tvec3 bd3D = normalize( lightToPosition );\n\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )\n\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\t\t\treturn (\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\treturn texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\t\t#endif\n\t}\n#endif",shadowmap_pars_vertex:"#if NUM_SPOT_LIGHT_COORDS > 0\n\tuniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];\n\tvarying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];\n#endif\n#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n#endif",shadowmap_vertex:"#if ( defined( USE_SHADOWMAP ) && ( NUM_DIR_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0 ) ) || ( NUM_SPOT_LIGHT_COORDS > 0 )\n\tvec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\tvec4 shadowWorldPosition;\n#endif\n#if defined( USE_SHADOWMAP )\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );\n\t\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );\n\t\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if NUM_SPOT_LIGHT_COORDS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition;\n\t\t#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\t\tshadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;\n\t\t#endif\n\t\tvSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n#endif",shadowmask_pars_fragment:"float getShadowMask() {\n\tfloat shadow = 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tdirectionalLight = directionalLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tspotLight = spotLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tpointLight = pointLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#endif\n\treturn shadow;\n}",skinbase_vertex:"#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\tuniform highp sampler2D boneTexture;\n\tuniform int boneTextureSize;\n\tmat4 getBoneMatrix( const in float i ) {\n\t\tfloat j = i * 4.0;\n\t\tfloat x = mod( j, float( boneTextureSize ) );\n\t\tfloat y = floor( j / float( boneTextureSize ) );\n\t\tfloat dx = 1.0 / float( boneTextureSize );\n\t\tfloat dy = 1.0 / float( boneTextureSize );\n\t\ty = dy * ( y + 0.5 );\n\t\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n\t\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n\t\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n\t\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\t\tmat4 bone = mat4( v1, v2, v3, v4 );\n\t\treturn bone;\n\t}\n#endif",skinning_vertex:"#ifdef USE_SKINNING\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\ttransformed = ( bindMatrixInverse * skinned ).xyz;\n#endif",skinnormal_vertex:"#ifdef USE_SKINNING\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n\t#ifdef USE_TANGENT\n\t\tobjectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#endif\n#endif",specularmap_fragment:"float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vUv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif",specularmap_pars_fragment:"#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif",tonemapping_fragment:"#if defined( TONE_MAPPING )\n\tgl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif",tonemapping_pars_fragment:"#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\nuniform float toneMappingExposure;\nvec3 LinearToneMapping( vec3 color ) {\n\treturn toneMappingExposure * color;\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n}\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\nvec3 RRTAndODTFit( vec3 v ) {\n\tvec3 a = v * ( v + 0.0245786 ) - 0.000090537;\n\tvec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;\n\treturn a / b;\n}\nvec3 ACESFilmicToneMapping( vec3 color ) {\n\tconst mat3 ACESInputMat = mat3(\n\t\tvec3( 0.59719, 0.07600, 0.02840 ),\t\tvec3( 0.35458, 0.90834, 0.13383 ),\n\t\tvec3( 0.04823, 0.01566, 0.83777 )\n\t);\n\tconst mat3 ACESOutputMat = mat3(\n\t\tvec3(  1.60475, -0.10208, -0.00327 ),\t\tvec3( -0.53108,  1.10813, -0.07276 ),\n\t\tvec3( -0.07367, -0.00605,  1.07602 )\n\t);\n\tcolor *= toneMappingExposure / 0.6;\n\tcolor = ACESInputMat * color;\n\tcolor = RRTAndODTFit( color );\n\tcolor = ACESOutputMat * color;\n\treturn saturate( color );\n}\nvec3 CustomToneMapping( vec3 color ) { return color; }",transmission_fragment:"#ifdef USE_TRANSMISSION\n\tmaterial.transmission = transmission;\n\tmaterial.transmissionAlpha = 1.0;\n\tmaterial.thickness = thickness;\n\tmaterial.attenuationDistance = attenuationDistance;\n\tmaterial.attenuationColor = attenuationColor;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\tmaterial.transmission *= texture2D( transmissionMap, vUv ).r;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tmaterial.thickness *= texture2D( thicknessMap, vUv ).g;\n\t#endif\n\tvec3 pos = vWorldPosition;\n\tvec3 v = normalize( cameraPosition - pos );\n\tvec3 n = inverseTransformDirection( normal, viewMatrix );\n\tvec4 transmission = getIBLVolumeRefraction(\n\t\tn, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,\n\t\tpos, modelMatrix, viewMatrix, projectionMatrix, material.ior, material.thickness,\n\t\tmaterial.attenuationColor, material.attenuationDistance );\n\tmaterial.transmissionAlpha = mix( material.transmissionAlpha, transmission.a, material.transmission );\n\ttotalDiffuse = mix( totalDiffuse, transmission.rgb, material.transmission );\n#endif",transmission_pars_fragment:"#ifdef USE_TRANSMISSION\n\tuniform float transmission;\n\tuniform float thickness;\n\tuniform float attenuationDistance;\n\tuniform vec3 attenuationColor;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\tuniform sampler2D transmissionMap;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tuniform sampler2D thicknessMap;\n\t#endif\n\tuniform vec2 transmissionSamplerSize;\n\tuniform sampler2D transmissionSamplerMap;\n\tuniform mat4 modelMatrix;\n\tuniform mat4 projectionMatrix;\n\tvarying vec3 vWorldPosition;\n\tfloat w0( float a ) {\n\t\treturn ( 1.0 / 6.0 ) * ( a * ( a * ( - a + 3.0 ) - 3.0 ) + 1.0 );\n\t}\n\tfloat w1( float a ) {\n\t\treturn ( 1.0 / 6.0 ) * ( a *  a * ( 3.0 * a - 6.0 ) + 4.0 );\n\t}\n\tfloat w2( float a ){\n\t\treturn ( 1.0 / 6.0 ) * ( a * ( a * ( - 3.0 * a + 3.0 ) + 3.0 ) + 1.0 );\n\t}\n\tfloat w3( float a ) {\n\t\treturn ( 1.0 / 6.0 ) * ( a * a * a );\n\t}\n\tfloat g0( float a ) {\n\t\treturn w0( a ) + w1( a );\n\t}\n\tfloat g1( float a ) {\n\t\treturn w2( a ) + w3( a );\n\t}\n\tfloat h0( float a ) {\n\t\treturn - 1.0 + w1( a ) / ( w0( a ) + w1( a ) );\n\t}\n\tfloat h1( float a ) {\n\t\treturn 1.0 + w3( a ) / ( w2( a ) + w3( a ) );\n\t}\n\tvec4 bicubic( sampler2D tex, vec2 uv, vec4 texelSize, vec2 fullSize, float lod ) {\n\t\tuv = uv * texelSize.zw + 0.5;\n\t\tvec2 iuv = floor( uv );\n\t\tvec2 fuv = fract( uv );\n\t\tfloat g0x = g0( fuv.x );\n\t\tfloat g1x = g1( fuv.x );\n\t\tfloat h0x = h0( fuv.x );\n\t\tfloat h1x = h1( fuv.x );\n\t\tfloat h0y = h0( fuv.y );\n\t\tfloat h1y = h1( fuv.y );\n\t\tvec2 p0 = ( vec2( iuv.x + h0x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;\n\t\tvec2 p1 = ( vec2( iuv.x + h1x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;\n\t\tvec2 p2 = ( vec2( iuv.x + h0x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;\n\t\tvec2 p3 = ( vec2( iuv.x + h1x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;\n\t\t\n\t\tvec2 lodFudge = pow( 1.95, lod ) / fullSize;\n\t\treturn g0( fuv.y ) * ( g0x * textureLod( tex, p0, lod ) + g1x * textureLod( tex, p1, lod ) ) +\n\t\t\tg1( fuv.y ) * ( g0x * textureLod( tex, p2, lod ) + g1x * textureLod( tex, p3, lod ) );\n\t}\n\tvec4 textureBicubic( sampler2D sampler, vec2 uv, float lod ) {\n\t\tvec2 fLodSize = vec2( textureSize( sampler, int( lod ) ) );\n\t\tvec2 cLodSize = vec2( textureSize( sampler, int( lod + 1.0 ) ) );\n\t\tvec2 fLodSizeInv = 1.0 / fLodSize;\n\t\tvec2 cLodSizeInv = 1.0 / cLodSize;\n\t\tvec2 fullSize = vec2( textureSize( sampler, 0 ) );\n\t\tvec4 fSample = bicubic( sampler, uv, vec4( fLodSizeInv, fLodSize ), fullSize, floor( lod ) );\n\t\tvec4 cSample = bicubic( sampler, uv, vec4( cLodSizeInv, cLodSize ), fullSize, ceil( lod ) );\n\t\treturn mix( fSample, cSample, fract( lod ) );\n\t}\n\tvec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {\n\t\tvec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );\n\t\tvec3 modelScale;\n\t\tmodelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );\n\t\tmodelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );\n\t\tmodelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );\n\t\treturn normalize( refractionVector ) * thickness * modelScale;\n\t}\n\tfloat applyIorToRoughness( const in float roughness, const in float ior ) {\n\t\treturn roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );\n\t}\n\tvec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {\n\t\tfloat lod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );\n\t\treturn textureBicubic( transmissionSamplerMap, fragCoord.xy, lod );\n\t}\n\tvec3 applyVolumeAttenuation( const in vec3 radiance, const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {\n\t\tif ( isinf( attenuationDistance ) ) {\n\t\t\treturn radiance;\n\t\t} else {\n\t\t\tvec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;\n\t\t\tvec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );\t\t\treturn transmittance * radiance;\n\t\t}\n\t}\n\tvec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,\n\t\tconst in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,\n\t\tconst in mat4 viewMatrix, const in mat4 projMatrix, const in float ior, const in float thickness,\n\t\tconst in vec3 attenuationColor, const in float attenuationDistance ) {\n\t\tvec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );\n\t\tvec3 refractedRayExit = position + transmissionRay;\n\t\tvec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );\n\t\tvec2 refractionCoords = ndcPos.xy / ndcPos.w;\n\t\trefractionCoords += 1.0;\n\t\trefractionCoords /= 2.0;\n\t\tvec4 transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );\n\t\tvec3 attenuatedColor = applyVolumeAttenuation( transmittedLight.rgb, length( transmissionRay ), attenuationColor, attenuationDistance );\n\t\tvec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );\n\t\treturn vec4( ( 1.0 - F ) * attenuatedColor * diffuseColor, transmittedLight.a );\n\t}\n#endif",uv_pars_fragment:"#if ( defined( USE_UV ) && ! defined( UVS_VERTEX_ONLY ) )\n\tvarying vec2 vUv;\n#endif",uv_pars_vertex:"#ifdef USE_UV\n\t#ifdef UVS_VERTEX_ONLY\n\t\tvec2 vUv;\n\t#else\n\t\tvarying vec2 vUv;\n\t#endif\n\tuniform mat3 uvTransform;\n#endif",uv_vertex:"#ifdef USE_UV\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n#endif",uv2_pars_fragment:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvarying vec2 vUv2;\n#endif",uv2_pars_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tattribute vec2 uv2;\n\tvarying vec2 vUv2;\n\tuniform mat3 uv2Transform;\n#endif",uv2_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvUv2 = ( uv2Transform * vec3( uv2, 1 ) ).xy;\n#endif",worldpos_vertex:"#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0\n\tvec4 worldPosition = vec4( transformed, 1.0 );\n\t#ifdef USE_INSTANCING\n\t\tworldPosition = instanceMatrix * worldPosition;\n\t#endif\n\tworldPosition = modelMatrix * worldPosition;\n#endif",background_vert:"varying vec2 vUv;\nuniform mat3 uvTransform;\nvoid main() {\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\tgl_Position = vec4( position.xy, 1.0, 1.0 );\n}",background_frag:"uniform sampler2D t2D;\nuniform float backgroundIntensity;\nvarying vec2 vUv;\nvoid main() {\n\tvec4 texColor = texture2D( t2D, vUv );\n\t#ifdef DECODE_VIDEO_TEXTURE\n\t\ttexColor = vec4( mix( pow( texColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), texColor.rgb * 0.0773993808, vec3( lessThanEqual( texColor.rgb, vec3( 0.04045 ) ) ) ), texColor.w );\n\t#endif\n\ttexColor.rgb *= backgroundIntensity;\n\tgl_FragColor = texColor;\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",backgroundCube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",backgroundCube_frag:"#ifdef ENVMAP_TYPE_CUBE\n\tuniform samplerCube envMap;\n#elif defined( ENVMAP_TYPE_CUBE_UV )\n\tuniform sampler2D envMap;\n#endif\nuniform float flipEnvMap;\nuniform float backgroundBlurriness;\nuniform float backgroundIntensity;\nvarying vec3 vWorldDirection;\n#include <cube_uv_reflection_fragment>\nvoid main() {\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 texColor = textureCube( envMap, vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );\n\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\tvec4 texColor = textureCubeUV( envMap, vWorldDirection, backgroundBlurriness );\n\t#else\n\t\tvec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t#endif\n\ttexColor.rgb *= backgroundIntensity;\n\tgl_FragColor = texColor;\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",cube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",cube_frag:"uniform samplerCube tCube;\nuniform float tFlip;\nuniform float opacity;\nvarying vec3 vWorldDirection;\nvoid main() {\n\tvec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );\n\tgl_FragColor = texColor;\n\tgl_FragColor.a *= opacity;\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",depth_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvHighPrecisionZW = gl_Position.zw;\n}",depth_frag:"#if DEPTH_PACKING == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <logdepthbuf_fragment>\n\tfloat fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( fragCoordZ );\n\t#endif\n}",distanceRGBA_vert:"#define DISTANCE\nvarying vec3 vWorldPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition.xyz;\n}",distanceRGBA_frag:"#define DISTANCE\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\tfloat dist = length( vWorldPosition - referencePosition );\n\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n\tdist = saturate( dist );\n\tgl_FragColor = packDepthToRGBA( dist );\n}",equirect_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}",equirect_frag:"uniform sampler2D tEquirect;\nvarying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldDirection );\n\tvec2 sampleUV = equirectUv( direction );\n\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",linedashed_vert:"uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\tvLineDistance = scale * lineDistance;\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",linedashed_frag:"uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",meshbasic_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinbase_vertex>\n\t\t#include <skinnormal_vertex>\n\t\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n}",meshbasic_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel = texture2D( lightMap, vUv2 );\n\t\treflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;\n\t#else\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\t#endif\n\t#include <aomap_fragment>\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <envmap_fragment>\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshlambert_vert:"#define LAMBERT\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshlambert_frag:"#define LAMBERT\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_lambert_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_lambert_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshmatcap_vert:"#define MATCAP\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\tvViewPosition = - mvPosition.xyz;\n}",meshmatcap_frag:"#define MATCAP\nuniform vec3 diffuse;\nuniform float opacity;\nuniform sampler2D matcap;\nvarying vec3 vViewPosition;\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <fog_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tvec3 viewDir = normalize( vViewPosition );\n\tvec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\n\tvec3 y = cross( viewDir, x );\n\tvec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;\n\t#ifdef USE_MATCAP\n\t\tvec4 matcapColor = texture2D( matcap, uv );\n\t#else\n\t\tvec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );\n\t#endif\n\tvec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshnormal_vert:"#define NORMAL\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n}",meshnormal_frag:"#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tgl_FragColor = vec4( packNormalToRGB( normal ), opacity );\n\t#ifdef OPAQUE\n\t\tgl_FragColor.a = 1.0;\n\t#endif\n}",meshphong_vert:"#define PHONG\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshphong_frag:"#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphysical_vert:"#define STANDARD\nvarying vec3 vViewPosition;\n#ifdef USE_TRANSMISSION\n\tvarying vec3 vWorldPosition;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n#ifdef USE_TRANSMISSION\n\tvWorldPosition = worldPosition.xyz;\n#endif\n}",meshphysical_frag:"#define STANDARD\n#ifdef PHYSICAL\n\t#define IOR\n\t#define SPECULAR\n#endif\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifdef IOR\n\tuniform float ior;\n#endif\n#ifdef SPECULAR\n\tuniform float specularIntensity;\n\tuniform vec3 specularColor;\n\t#ifdef USE_SPECULARINTENSITYMAP\n\t\tuniform sampler2D specularIntensityMap;\n\t#endif\n\t#ifdef USE_SPECULARCOLORMAP\n\t\tuniform sampler2D specularColorMap;\n\t#endif\n#endif\n#ifdef USE_CLEARCOAT\n\tuniform float clearcoat;\n\tuniform float clearcoatRoughness;\n#endif\n#ifdef USE_IRIDESCENCE\n\tuniform float iridescence;\n\tuniform float iridescenceIOR;\n\tuniform float iridescenceThicknessMinimum;\n\tuniform float iridescenceThicknessMaximum;\n#endif\n#ifdef USE_SHEEN\n\tuniform vec3 sheenColor;\n\tuniform float sheenRoughness;\n\t#ifdef USE_SHEENCOLORMAP\n\t\tuniform sampler2D sheenColorMap;\n\t#endif\n\t#ifdef USE_SHEENROUGHNESSMAP\n\t\tuniform sampler2D sheenRoughnessMap;\n\t#endif\n#endif\nvarying vec3 vViewPosition;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <bsdfs>\n#include <iridescence_fragment>\n#include <cube_uv_reflection_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_physical_pars_fragment>\n#include <transmission_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <clearcoat_pars_fragment>\n#include <iridescence_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <clearcoat_normal_fragment_begin>\n\t#include <clearcoat_normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;\n\tvec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;\n\t#include <transmission_fragment>\n\tvec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;\n\t#ifdef USE_SHEEN\n\t\tfloat sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );\n\t\toutgoingLight = outgoingLight * sheenEnergyComp + sheenSpecular;\n\t#endif\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNVcc = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );\n\t\tvec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );\n\t\toutgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + clearcoatSpecular * material.clearcoat;\n\t#endif\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshtoon_vert:"#define TOON\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshtoon_frag:"#define TOON\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_toon_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_toon_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",points_vert:"uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\tgl_PointSize = size;\n\t#ifdef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <fog_vertex>\n}",points_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",shadow_vert:"#include <common>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <shadowmap_pars_vertex>\nvoid main() {\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",shadow_frag:"uniform vec3 color;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <logdepthbuf_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n\t#include <logdepthbuf_fragment>\n\tgl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",sprite_vert:"uniform float rotation;\nuniform vec2 center;\n#include <common>\n#include <uv_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\tvec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n\tvec2 scale;\n\tscale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n\tscale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\n\t#ifndef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) scale *= - mvPosition.z;\n\t#endif\n\tvec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\n\tvec2 rotatedPosition;\n\trotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n\trotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n\tmvPosition.xy += rotatedPosition;\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",sprite_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}"},fn={common:{diffuse:{value:new An(16777215)},opacity:{value:1},map:{value:null},uvTransform:{value:new Xa},uv2Transform:{value:new Xa},alphaMap:{value:null},alphaTest:{value:0}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new Pt(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new An(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new An(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new Xa}},sprite:{diffuse:{value:new An(16777215)},opacity:{value:1},center:{value:new Pt(.5,.5)},rotation:{value:0},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new Xa}}},oh={basic:{uniforms:Sl([fn.common,fn.specularmap,fn.envmap,fn.aomap,fn.lightmap,fn.fog]),vertexShader:qi.meshbasic_vert,fragmentShader:qi.meshbasic_frag},lambert:{uniforms:Sl([fn.common,fn.specularmap,fn.envmap,fn.aomap,fn.lightmap,fn.emissivemap,fn.bumpmap,fn.normalmap,fn.displacementmap,fn.fog,fn.lights,{emissive:{value:new An(0)}}]),vertexShader:qi.meshlambert_vert,fragmentShader:qi.meshlambert_frag},phong:{uniforms:Sl([fn.common,fn.specularmap,fn.envmap,fn.aomap,fn.lightmap,fn.emissivemap,fn.bumpmap,fn.normalmap,fn.displacementmap,fn.fog,fn.lights,{emissive:{value:new An(0)},specular:{value:new An(1118481)},shininess:{value:30}}]),vertexShader:qi.meshphong_vert,fragmentShader:qi.meshphong_frag},standard:{uniforms:Sl([fn.common,fn.envmap,fn.aomap,fn.lightmap,fn.emissivemap,fn.bumpmap,fn.normalmap,fn.displacementmap,fn.roughnessmap,fn.metalnessmap,fn.fog,fn.lights,{emissive:{value:new An(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:qi.meshphysical_vert,fragmentShader:qi.meshphysical_frag},toon:{uniforms:Sl([fn.common,fn.aomap,fn.lightmap,fn.emissivemap,fn.bumpmap,fn.normalmap,fn.displacementmap,fn.gradientmap,fn.fog,fn.lights,{emissive:{value:new An(0)}}]),vertexShader:qi.meshtoon_vert,fragmentShader:qi.meshtoon_frag},matcap:{uniforms:Sl([fn.common,fn.bumpmap,fn.normalmap,fn.displacementmap,fn.fog,{matcap:{value:null}}]),vertexShader:qi.meshmatcap_vert,fragmentShader:qi.meshmatcap_frag},points:{uniforms:Sl([fn.points,fn.fog]),vertexShader:qi.points_vert,fragmentShader:qi.points_frag},dashed:{uniforms:Sl([fn.common,fn.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:qi.linedashed_vert,fragmentShader:qi.linedashed_frag},depth:{uniforms:Sl([fn.common,fn.displacementmap]),vertexShader:qi.depth_vert,fragmentShader:qi.depth_frag},normal:{uniforms:Sl([fn.common,fn.bumpmap,fn.normalmap,fn.displacementmap,{opacity:{value:1}}]),vertexShader:qi.meshnormal_vert,fragmentShader:qi.meshnormal_frag},sprite:{uniforms:Sl([fn.sprite,fn.fog]),vertexShader:qi.sprite_vert,fragmentShader:qi.sprite_frag},background:{uniforms:{uvTransform:{value:new Xa},t2D:{value:null},backgroundIntensity:{value:1}},vertexShader:qi.background_vert,fragmentShader:qi.background_frag},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1}},vertexShader:qi.backgroundCube_vert,fragmentShader:qi.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:qi.cube_vert,fragmentShader:qi.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:qi.equirect_vert,fragmentShader:qi.equirect_frag},distanceRGBA:{uniforms:Sl([fn.common,fn.displacementmap,{referencePosition:{value:new _e},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:qi.distanceRGBA_vert,fragmentShader:qi.distanceRGBA_frag},shadow:{uniforms:Sl([fn.lights,fn.fog,{color:{value:new An(0)},opacity:{value:1}}]),vertexShader:qi.shadow_vert,fragmentShader:qi.shadow_frag}};oh.physical={uniforms:Sl([oh.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatNormalScale:{value:new Pt(1,1)},clearcoatNormalMap:{value:null},iridescence:{value:0},iridescenceMap:{value:null},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},sheen:{value:0},sheenColor:{value:new An(0)},sheenColorMap:{value:null},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},transmission:{value:0},transmissionMap:{value:null},transmissionSamplerSize:{value:new Pt},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},attenuationDistance:{value:0},attenuationColor:{value:new An(0)},specularIntensity:{value:1},specularIntensityMap:{value:null},specularColor:{value:new An(1,1,1)},specularColorMap:{value:null}}]),vertexShader:qi.meshphysical_vert,fragmentShader:qi.meshphysical_frag};const US={r:0,b:0,g:0};function jte(n,e,t,i,r,s,c){const d=new An(0);let y,w,m=!0===s?0:1,S=null,T=0,I=null;function k(F,G){F.getRGB(US,OV(n)),i.buffers.color.setClear(US.r,US.g,US.b,G,c)}return{getClearColor:function(){return d},setClearColor:function(F,G=1){d.set(F),m=G,k(d,m)},getClearAlpha:function(){return m},setClearAlpha:function(F){m=F,k(d,m)},render:function R(F,G){let W=!1,V=!0===G.isScene?G.background:null;V&&V.isTexture&&(V=(G.backgroundBlurriness>0?t:e).get(V));const X=n.xr,ee=X.getSession&&X.getSession();ee&&"additive"===ee.environmentBlendMode&&(V=null),null===V?k(d,m):V&&V.isColor&&(k(V,1),W=!0),(n.autoClear||W)&&n.clear(n.autoClearColor,n.autoClearDepth,n.autoClearStencil),V&&(V.isCubeTexture||306===V.mapping)?(void 0===w&&(w=new Ka(new t0(1,1,1),new ym({name:"BackgroundCubeMaterial",uniforms:n0(oh.backgroundCube.uniforms),vertexShader:oh.backgroundCube.vertexShader,fragmentShader:oh.backgroundCube.fragmentShader,side:1,depthTest:!1,depthWrite:!1,fog:!1})),w.geometry.deleteAttribute("normal"),w.geometry.deleteAttribute("uv"),w.onBeforeRender=function(ae,Ee,J){this.matrixWorld.copyPosition(J.matrixWorld)},Object.defineProperty(w.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),r.update(w)),w.material.uniforms.envMap.value=V,w.material.uniforms.flipEnvMap.value=V.isCubeTexture&&!1===V.isRenderTargetTexture?-1:1,w.material.uniforms.backgroundBlurriness.value=G.backgroundBlurriness,w.material.uniforms.backgroundIntensity.value=G.backgroundIntensity,w.material.toneMapped=V.encoding!==vs,(S!==V||T!==V.version||I!==n.toneMapping)&&(w.material.needsUpdate=!0,S=V,T=V.version,I=n.toneMapping),w.layers.enableAll(),F.unshift(w,w.geometry,w.material,0,0,null)):V&&V.isTexture&&(void 0===y&&(y=new Ka(new VS(2,2),new ym({name:"BackgroundMaterial",uniforms:n0(oh.background.uniforms),vertexShader:oh.background.vertexShader,fragmentShader:oh.background.fragmentShader,side:0,depthTest:!1,depthWrite:!1,fog:!1})),y.geometry.deleteAttribute("normal"),Object.defineProperty(y.material,"map",{get:function(){return this.uniforms.t2D.value}}),r.update(y)),y.material.uniforms.t2D.value=V,y.material.uniforms.backgroundIntensity.value=G.backgroundIntensity,y.material.toneMapped=V.encoding!==vs,!0===V.matrixAutoUpdate&&V.updateMatrix(),y.material.uniforms.uvTransform.value.copy(V.matrix),(S!==V||T!==V.version||I!==n.toneMapping)&&(y.material.needsUpdate=!0,S=V,T=V.version,I=n.toneMapping),y.layers.enableAll(),F.unshift(y,y.geometry,y.material,0,0,null))}}}function $te(n,e,t,i){const r=n.getParameter(34921),s=i.isWebGL2?null:e.get("OES_vertex_array_object"),c=i.isWebGL2||null!==s,d={},m=F(null);let y=m,w=!1;function I(Ge){return i.isWebGL2?n.bindVertexArray(Ge):s.bindVertexArrayOES(Ge)}function R(Ge){return i.isWebGL2?n.deleteVertexArray(Ge):s.deleteVertexArrayOES(Ge)}function F(Ge){const ft=[],qe=[],dt=[];for(let Ye=0;Ye<r;Ye++)ft[Ye]=0,qe[Ye]=0,dt[Ye]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:ft,enabledAttributes:qe,attributeDivisors:dt,object:Ge,attributes:{},index:null}}function V(){const Ge=y.newAttributes;for(let ft=0,qe=Ge.length;ft<qe;ft++)Ge[ft]=0}function X(Ge){ee(Ge,0)}function ee(Ge,ft){const dt=y.enabledAttributes,Ye=y.attributeDivisors;y.newAttributes[Ge]=1,0===dt[Ge]&&(n.enableVertexAttribArray(Ge),dt[Ge]=1),Ye[Ge]!==ft&&((i.isWebGL2?n:e.get("ANGLE_instanced_arrays"))[i.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](Ge,ft),Ye[Ge]=ft)}function ae(){const Ge=y.newAttributes,ft=y.enabledAttributes;for(let qe=0,dt=ft.length;qe<dt;qe++)ft[qe]!==Ge[qe]&&(n.disableVertexAttribArray(qe),ft[qe]=0)}function Ee(Ge,ft,qe,dt,Ye,gt){!0!==i.isWebGL2||5124!==qe&&5125!==qe?n.vertexAttribPointer(Ge,ft,qe,dt,Ye,gt):n.vertexAttribIPointer(Ge,ft,qe,Ye,gt)}function xt(){Qe(),w=!0,y!==m&&(y=m,I(y.object))}function Qe(){m.geometry=null,m.program=null,m.wireframe=!1}return{setup:function S(Ge,ft,qe,dt,Ye){let gt=!1;if(c){const Ot=function k(Ge,ft,qe){const dt=!0===qe.wireframe;let Ye=d[Ge.id];void 0===Ye&&(Ye={},d[Ge.id]=Ye);let gt=Ye[ft.id];void 0===gt&&(gt={},Ye[ft.id]=gt);let Ot=gt[dt];return void 0===Ot&&(Ot=F(function T(){return i.isWebGL2?n.createVertexArray():s.createVertexArrayOES()}()),gt[dt]=Ot),Ot}(dt,qe,ft);y!==Ot&&(y=Ot,I(y.object)),gt=function G(Ge,ft,qe,dt){const Ye=y.attributes,gt=ft.attributes;let Ot=0;const pn=qe.getAttributes();for(const at in pn)if(pn[at].location>=0){const zt=Ye[at];let nt=gt[at];if(void 0===nt&&("instanceMatrix"===at&&Ge.instanceMatrix&&(nt=Ge.instanceMatrix),"instanceColor"===at&&Ge.instanceColor&&(nt=Ge.instanceColor)),void 0===zt||zt.attribute!==nt||nt&&zt.data!==nt.data)return!0;Ot++}return y.attributesNum!==Ot||y.index!==dt}(Ge,dt,qe,Ye),gt&&function W(Ge,ft,qe,dt){const Ye={},gt=ft.attributes;let Ot=0;const pn=qe.getAttributes();for(const at in pn)if(pn[at].location>=0){let zt=gt[at];void 0===zt&&("instanceMatrix"===at&&Ge.instanceMatrix&&(zt=Ge.instanceMatrix),"instanceColor"===at&&Ge.instanceColor&&(zt=Ge.instanceColor));const nt={};nt.attribute=zt,zt&&zt.data&&(nt.data=zt.data),Ye[at]=nt,Ot++}y.attributes=Ye,y.attributesNum=Ot,y.index=dt}(Ge,dt,qe,Ye)}else{const Ot=!0===ft.wireframe;(y.geometry!==dt.id||y.program!==qe.id||y.wireframe!==Ot)&&(y.geometry=dt.id,y.program=qe.id,y.wireframe=Ot,gt=!0)}null!==Ye&&t.update(Ye,34963),(gt||w)&&(w=!1,function J(Ge,ft,qe,dt){if(!1===i.isWebGL2&&(Ge.isInstancedMesh||dt.isInstancedBufferGeometry)&&null===e.get("ANGLE_instanced_arrays"))return;V();const Ye=dt.attributes,gt=qe.getAttributes(),Ot=ft.defaultAttributeValues;for(const pn in gt){const at=gt[pn];if(at.location>=0){let Ut=Ye[pn];if(void 0===Ut&&("instanceMatrix"===pn&&Ge.instanceMatrix&&(Ut=Ge.instanceMatrix),"instanceColor"===pn&&Ge.instanceColor&&(Ut=Ge.instanceColor)),void 0!==Ut){const zt=Ut.normalized,nt=Ut.itemSize,In=t.get(Ut);if(void 0===In)continue;const en=In.buffer,xn=In.type,gn=In.bytesPerElement;if(Ut.isInterleavedBufferAttribute){const On=Ut.data,ii=On.stride,Nt=Ut.offset;if(On.isInstancedInterleavedBuffer){for(let Wt=0;Wt<at.locationSize;Wt++)ee(at.location+Wt,On.meshPerAttribute);!0!==Ge.isInstancedMesh&&void 0===dt._maxInstanceCount&&(dt._maxInstanceCount=On.meshPerAttribute*On.count)}else for(let Wt=0;Wt<at.locationSize;Wt++)X(at.location+Wt);n.bindBuffer(34962,en);for(let Wt=0;Wt<at.locationSize;Wt++)Ee(at.location+Wt,nt/at.locationSize,xn,zt,ii*gn,(Nt+nt/at.locationSize*Wt)*gn)}else{if(Ut.isInstancedBufferAttribute){for(let On=0;On<at.locationSize;On++)ee(at.location+On,Ut.meshPerAttribute);!0!==Ge.isInstancedMesh&&void 0===dt._maxInstanceCount&&(dt._maxInstanceCount=Ut.meshPerAttribute*Ut.count)}else for(let On=0;On<at.locationSize;On++)X(at.location+On);n.bindBuffer(34962,en);for(let On=0;On<at.locationSize;On++)Ee(at.location+On,nt/at.locationSize,xn,zt,nt*gn,nt/at.locationSize*On*gn)}}else if(void 0!==Ot){const zt=Ot[pn];if(void 0!==zt)switch(zt.length){case 2:n.vertexAttrib2fv(at.location,zt);break;case 3:n.vertexAttrib3fv(at.location,zt);break;case 4:n.vertexAttrib4fv(at.location,zt);break;default:n.vertexAttrib1fv(at.location,zt)}}}}ae()}(Ge,ft,qe,dt),null!==Ye&&n.bindBuffer(34963,t.get(Ye).buffer))},reset:xt,resetDefaultState:Qe,dispose:function pe(){xt();for(const Ge in d){const ft=d[Ge];for(const qe in ft){const dt=ft[qe];for(const Ye in dt)R(dt[Ye].object),delete dt[Ye];delete ft[qe]}delete d[Ge]}},releaseStatesOfGeometry:function Oe(Ge){if(void 0===d[Ge.id])return;const ft=d[Ge.id];for(const qe in ft){const dt=ft[qe];for(const Ye in dt)R(dt[Ye].object),delete dt[Ye];delete ft[qe]}delete d[Ge.id]},releaseStatesOfProgram:function st(Ge){for(const ft in d){const qe=d[ft];if(void 0===qe[Ge.id])continue;const dt=qe[Ge.id];for(const Ye in dt)R(dt[Ye].object),delete dt[Ye];delete qe[Ge.id]}},initAttributes:V,enableAttribute:X,disableUnusedAttributes:ae}}function Wte(n,e,t,i){const r=i.isWebGL2;let s;this.setMode=function c(y){s=y},this.render=function d(y,w){n.drawArrays(s,y,w),t.update(w,s,1)},this.renderInstances=function m(y,w,S){if(0===S)return;let T,I;if(r)T=n,I="drawArraysInstanced";else if(T=e.get("ANGLE_instanced_arrays"),I="drawArraysInstancedANGLE",null===T)return void console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");T[I](s,y,w,S),t.update(w,s,S)}}function qte(n,e,t){let i;function s(Ee){if("highp"===Ee){if(n.getShaderPrecisionFormat(35633,36338).precision>0&&n.getShaderPrecisionFormat(35632,36338).precision>0)return"highp";Ee="mediump"}return"mediump"===Ee&&n.getShaderPrecisionFormat(35633,36337).precision>0&&n.getShaderPrecisionFormat(35632,36337).precision>0?"mediump":"lowp"}const c=typeof WebGL2RenderingContext<"u"&&n instanceof WebGL2RenderingContext;let d=void 0!==t.precision?t.precision:"highp";const m=s(d);m!==d&&(console.warn("THREE.WebGLRenderer:",d,"not supported, using",m,"instead."),d=m);const y=c||e.has("WEBGL_draw_buffers"),w=!0===t.logarithmicDepthBuffer,S=n.getParameter(34930),T=n.getParameter(35660),I=n.getParameter(3379),R=n.getParameter(34076),k=n.getParameter(34921),F=n.getParameter(36347),G=n.getParameter(36348),W=n.getParameter(36349),V=T>0,X=c||e.has("OES_texture_float");return{isWebGL2:c,drawBuffers:y,getMaxAnisotropy:function r(){if(void 0!==i)return i;if(!0===e.has("EXT_texture_filter_anisotropic")){const Ee=e.get("EXT_texture_filter_anisotropic");i=n.getParameter(Ee.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else i=0;return i},getMaxPrecision:s,precision:d,logarithmicDepthBuffer:w,maxTextures:S,maxVertexTextures:T,maxTextureSize:I,maxCubemapSize:R,maxAttributes:k,maxVertexUniforms:F,maxVaryings:G,maxFragmentUniforms:W,vertexTextures:V,floatFragmentTextures:X,floatVertexTextures:V&&X,maxSamples:c?n.getParameter(36183):0}}function Zte(n){const e=this;let t=null,i=0,r=!1,s=!1;const c=new i_,d=new Xa,m={value:null,needsUpdate:!1};function w(S,T,I,R){const k=null!==S?S.length:0;let F=null;if(0!==k){if(F=m.value,!0!==R||null===F){const G=I+4*k,W=T.matrixWorldInverse;d.getNormalMatrix(W),(null===F||F.length<G)&&(F=new Float32Array(G));for(let V=0,X=I;V!==k;++V,X+=4)c.copy(S[V]).applyMatrix4(W,d),c.normal.toArray(F,X),F[X+3]=c.constant}m.value=F,m.needsUpdate=!0}return e.numPlanes=k,e.numIntersection=0,F}this.uniform=m,this.numPlanes=0,this.numIntersection=0,this.init=function(S,T){const I=0!==S.length||T||0!==i||r;return r=T,i=S.length,I},this.beginShadows=function(){s=!0,w(null)},this.endShadows=function(){s=!1},this.setGlobalState=function(S,T){t=w(S,T,0)},this.setState=function(S,T,I){const R=S.clippingPlanes,k=S.clipIntersection,F=S.clipShadows,G=n.get(S);if(!r||null===R||0===R.length||s&&!F)s?w(null):function y(){m.value!==t&&(m.value=t,m.needsUpdate=i>0),e.numPlanes=i,e.numIntersection=0}();else{const W=s?0:i,V=4*W;let X=G.clippingState||null;m.value=X,X=w(R,T,V,I);for(let ee=0;ee!==V;++ee)X[ee]=t[ee];G.clippingState=X,this.numIntersection=k?this.numPlanes:0,this.numPlanes+=W}}}function Xte(n){let e=new WeakMap;function t(c,d){return 303===d?c.mapping=301:304===d&&(c.mapping=302),c}function r(c){const d=c.target;d.removeEventListener("dispose",r);const m=e.get(d);void 0!==m&&(e.delete(d),m.dispose())}return{get:function i(c){if(c&&c.isTexture&&!1===c.isRenderTargetTexture){const d=c.mapping;if(303===d||304===d){if(e.has(c))return t(e.get(c).texture,c.mapping);{const m=c.image;if(m&&m.height>0){const y=new HJ(m.height/2);return y.fromEquirectangularTexture(n,c),e.set(c,y),c.addEventListener("dispose",r),t(y.texture,c.mapping)}return null}}}return c},dispose:function s(){e=new WeakMap}}}class O2 extends R2{constructor(e=-1,t=1,i=1,r=-1,s=.1,c=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=t,this.top=i,this.bottom=r,this.near=s,this.far=c,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=null===e.view?null:Object.assign({},e.view),this}setViewOffset(e,t,i,r,s,c){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=i,this.view.offsetY=r,this.view.width=s,this.view.height=c,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),i=(this.right+this.left)/2,r=(this.top+this.bottom)/2;let s=i-e,c=i+e,d=r+t,m=r-t;if(null!==this.view&&this.view.enabled){const y=(this.right-this.left)/this.view.fullWidth/this.zoom,w=(this.top-this.bottom)/this.view.fullHeight/this.zoom;s+=y*this.view.offsetX,c=s+y*this.view.width,d-=w*this.view.offsetY,m=d-w*this.view.height}this.projectionMatrix.makeOrthographic(s,c,d,m,this.near,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,null!==this.view&&(t.object.view=Object.assign({},this.view)),t}}const NV=[.125,.215,.35,.446,.526,.582],F2=new O2,BV=new An;let N2=null;const s_=(1+Math.sqrt(5))/2,l0=1/s_,zV=[new _e(1,1,1),new _e(-1,1,1),new _e(1,1,-1),new _e(-1,1,-1),new _e(0,s_,l0),new _e(0,s_,-l0),new _e(l0,0,s_),new _e(-l0,0,s_),new _e(s_,l0,0),new _e(-s_,l0,0)];class VV{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(e,t=0,i=.1,r=100){N2=this._renderer.getRenderTarget(),this._setSize(256);const s=this._allocateTargets();return s.depthBuffer=!0,this._sceneToCubeUV(e,i,r,s),t>0&&this._blur(s,0,0,t),this._applyPMREM(s),this._cleanup(s),s}fromEquirectangular(e,t=null){return this._fromTexture(e,t)}fromCubemap(e,t=null){return this._fromTexture(e,t)}compileCubemapShader(){null===this._cubemapMaterial&&(this._cubemapMaterial=GV(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){null===this._equirectMaterial&&(this._equirectMaterial=HV(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),null!==this._cubemapMaterial&&this._cubemapMaterial.dispose(),null!==this._equirectMaterial&&this._equirectMaterial.dispose()}_setSize(e){this._lodMax=Math.floor(Math.log2(e)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){null!==this._blurMaterial&&this._blurMaterial.dispose(),null!==this._pingPongRenderTarget&&this._pingPongRenderTarget.dispose();for(let e=0;e<this._lodPlanes.length;e++)this._lodPlanes[e].dispose()}_cleanup(e){this._renderer.setRenderTarget(N2),e.scissorTest=!1,HS(e,0,0,e.width,e.height)}_fromTexture(e,t){this._setSize(301===e.mapping||302===e.mapping?0===e.image.length?16:e.image[0].width||e.image[0].image.width:e.image.width/4),N2=this._renderer.getRenderTarget();const i=t||this._allocateTargets();return this._textureToCubeUV(e,i),this._applyPMREM(i),this._cleanup(i),i}_allocateTargets(){const e=3*Math.max(this._cubeSize,112),t=4*this._cubeSize,i={magFilter:Eo,minFilter:Eo,generateMipmaps:!1,type:cw,format:pu,encoding:Xg,depthBuffer:!1},r=UV(e,t,i);if(null===this._pingPongRenderTarget||this._pingPongRenderTarget.width!==e||this._pingPongRenderTarget.height!==t){null!==this._pingPongRenderTarget&&this._dispose(),this._pingPongRenderTarget=UV(e,t,i);const{_lodMax:s}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=function Yte(n){const e=[],t=[],i=[];let r=n;const s=n-4+1+NV.length;for(let c=0;c<s;c++){const d=Math.pow(2,r);t.push(d);let m=1/d;c>n-4?m=NV[c-n+4-1]:0===c&&(m=0),i.push(m);const y=1/(d-2),w=-y,S=1+y,T=[w,w,S,w,S,S,w,w,S,S,w,S],I=6,R=6,k=3,F=2,G=1,W=new Float32Array(k*R*I),V=new Float32Array(F*R*I),X=new Float32Array(G*R*I);for(let ae=0;ae<I;ae++){const Ee=ae%3*2/3-1,J=ae>2?0:-1;W.set([Ee,J,0,Ee+2/3,J,0,Ee+2/3,J+1,0,Ee,J,0,Ee+2/3,J+1,0,Ee,J+1,0],k*R*ae),V.set(T,F*R*ae),X.set([ae,ae,ae,ae,ae,ae],G*R*ae)}const ee=new Wi;ee.setAttribute("position",new sa(W,k)),ee.setAttribute("uv",new sa(V,F)),ee.setAttribute("faceIndex",new sa(X,G)),e.push(ee),r>4&&r--}return{lodPlanes:e,sizeLods:t,sigmas:i}}(s)),this._blurMaterial=function Kte(n,e,t){const i=new Float32Array(20),r=new _e(0,1,0);return new ym({name:"SphericalGaussianBlur",defines:{n:20,CUBEUV_TEXEL_WIDTH:1/e,CUBEUV_TEXEL_HEIGHT:1/t,CUBEUV_MAX_MIP:`${n}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:i},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:r}},vertexShader:"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t",fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\t\t\tuniform int samples;\n\t\t\tuniform float weights[ n ];\n\t\t\tuniform bool latitudinal;\n\t\t\tuniform float dTheta;\n\t\t\tuniform float mipInt;\n\t\t\tuniform vec3 poleAxis;\n\n\t\t\t#define ENVMAP_TYPE_CUBE_UV\n\t\t\t#include <cube_uv_reflection_fragment>\n\n\t\t\tvec3 getSample( float theta, vec3 axis ) {\n\n\t\t\t\tfloat cosTheta = cos( theta );\n\t\t\t\t// Rodrigues' axis-angle rotation\n\t\t\t\tvec3 sampleDirection = vOutputDirection * cosTheta\n\t\t\t\t\t+ cross( axis, vOutputDirection ) * sin( theta )\n\t\t\t\t\t+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );\n\n\t\t\t\treturn bilinearCubeUV( envMap, sampleDirection, mipInt );\n\n\t\t\t}\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );\n\n\t\t\t\tif ( all( equal( axis, vec3( 0.0 ) ) ) ) {\n\n\t\t\t\t\taxis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );\n\n\t\t\t\t}\n\n\t\t\t\taxis = normalize( axis );\n\n\t\t\t\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t\t\t\tgl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );\n\n\t\t\t\tfor ( int i = 1; i < n; i++ ) {\n\n\t\t\t\t\tif ( i >= samples ) {\n\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tfloat theta = dTheta * float( i );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( theta, axis );\n\n\t\t\t\t}\n\n\t\t\t}\n\t\t",blending:0,depthTest:!1,depthWrite:!1})}(s,e,t)}return r}_compileMaterial(e){const t=new Ka(this._lodPlanes[0],e);this._renderer.compile(t,F2)}_sceneToCubeUV(e,t,i,r){const d=new Da(90,1,t,i),m=[1,-1,1,1,1,1],y=[1,1,1,-1,-1,-1],w=this._renderer,S=w.autoClear,T=w.toneMapping;w.getClearColor(BV),w.toneMapping=0,w.autoClear=!1;const I=new _m({name:"PMREM.Background",side:1,depthWrite:!1,depthTest:!1}),R=new Ka(new t0,I);let k=!1;const F=e.background;F?F.isColor&&(I.color.copy(F),e.background=null,k=!0):(I.color.copy(BV),k=!0);for(let G=0;G<6;G++){const W=G%3;0===W?(d.up.set(0,m[G],0),d.lookAt(y[G],0,0)):1===W?(d.up.set(0,0,m[G]),d.lookAt(0,y[G],0)):(d.up.set(0,m[G],0),d.lookAt(0,0,y[G]));const V=this._cubeSize;HS(r,W*V,G>2?V:0,V,V),w.setRenderTarget(r),k&&w.render(R,d),w.render(e,d)}R.geometry.dispose(),R.material.dispose(),w.toneMapping=T,w.autoClear=S,e.background=F}_textureToCubeUV(e,t){const i=this._renderer,r=301===e.mapping||302===e.mapping;r?(null===this._cubemapMaterial&&(this._cubemapMaterial=GV()),this._cubemapMaterial.uniforms.flipEnvMap.value=!1===e.isRenderTargetTexture?-1:1):null===this._equirectMaterial&&(this._equirectMaterial=HV());const s=r?this._cubemapMaterial:this._equirectMaterial,c=new Ka(this._lodPlanes[0],s);s.uniforms.envMap.value=e;const m=this._cubeSize;HS(t,0,0,3*m,2*m),i.setRenderTarget(t),i.render(c,F2)}_applyPMREM(e){const t=this._renderer,i=t.autoClear;t.autoClear=!1;for(let r=1;r<this._lodPlanes.length;r++){const s=Math.sqrt(this._sigmas[r]*this._sigmas[r]-this._sigmas[r-1]*this._sigmas[r-1]);this._blur(e,r-1,r,s,zV[(r-1)%zV.length])}t.autoClear=i}_blur(e,t,i,r,s){const c=this._pingPongRenderTarget;this._halfBlur(e,c,t,i,r,"latitudinal",s),this._halfBlur(c,e,i,i,r,"longitudinal",s)}_halfBlur(e,t,i,r,s,c,d){const m=this._renderer,y=this._blurMaterial;"latitudinal"!==c&&"longitudinal"!==c&&console.error("blur direction must be either latitudinal or longitudinal!");const S=new Ka(this._lodPlanes[r],y),T=y.uniforms,I=this._sizeLods[i]-1,R=isFinite(s)?Math.PI/(2*I):2*Math.PI/39,k=s/R,F=isFinite(s)?1+Math.floor(3*k):20;F>20&&console.warn(`sigmaRadians, ${s}, is too large and will clip, as it requested ${F} samples when the maximum is set to 20`);const G=[];let W=0;for(let Ee=0;Ee<20;++Ee){const J=Ee/k,pe=Math.exp(-J*J/2);G.push(pe),0===Ee?W+=pe:Ee<F&&(W+=2*pe)}for(let Ee=0;Ee<G.length;Ee++)G[Ee]=G[Ee]/W;T.envMap.value=e.texture,T.samples.value=F,T.weights.value=G,T.latitudinal.value="latitudinal"===c,d&&(T.poleAxis.value=d);const{_lodMax:V}=this;T.dTheta.value=R,T.mipInt.value=V-i;const X=this._sizeLods[r];HS(t,3*X*(r>V-4?r-V+4:0),4*(this._cubeSize-X),3*X,2*X),m.setRenderTarget(t),m.render(S,F2)}}function UV(n,e,t){const i=new Jg(n,e,t);return i.texture.mapping=306,i.texture.name="PMREM.cubeUv",i.scissorTest=!0,i}function HS(n,e,t,i,r){n.viewport.set(e,t,i,r),n.scissor.set(e,t,i,r)}function HV(){return new ym({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t",fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\n\t\t\t#include <common>\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 outputDirection = normalize( vOutputDirection );\n\t\t\t\tvec2 uv = equirectUv( outputDirection );\n\n\t\t\t\tgl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );\n\n\t\t\t}\n\t\t",blending:0,depthTest:!1,depthWrite:!1})}function GV(){return new ym({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t",fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tuniform float flipEnvMap;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform samplerCube envMap;\n\n\t\t\tvoid main() {\n\n\t\t\t\tgl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );\n\n\t\t\t}\n\t\t",blending:0,depthTest:!1,depthWrite:!1})}function Qte(n){let e=new WeakMap,t=null;function s(d){const m=d.target;m.removeEventListener("dispose",s);const y=e.get(m);void 0!==y&&(e.delete(m),y.dispose())}return{get:function i(d){if(d&&d.isTexture){const m=d.mapping,y=303===m||304===m,w=301===m||302===m;if(y||w){if(d.isRenderTargetTexture&&!0===d.needsPMREMUpdate){d.needsPMREMUpdate=!1;let S=e.get(d);return null===t&&(t=new VV(n)),S=y?t.fromEquirectangular(d,S):t.fromCubemap(d,S),e.set(d,S),S.texture}if(e.has(d))return e.get(d).texture;{const S=d.image;if(y&&S&&S.height>0||w&&S&&function r(d){let m=0;for(let w=0;w<6;w++)void 0!==d[w]&&m++;return 6===m}(S)){null===t&&(t=new VV(n));const T=y?t.fromEquirectangular(d):t.fromCubemap(d);return e.set(d,T),d.addEventListener("dispose",s),T.texture}return null}}}return d},dispose:function c(){e=new WeakMap,null!==t&&(t.dispose(),t=null)}}}function Jte(n){const e={};function t(i){if(void 0!==e[i])return e[i];let r;switch(i){case"WEBGL_depth_texture":r=n.getExtension("WEBGL_depth_texture")||n.getExtension("MOZ_WEBGL_depth_texture")||n.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":r=n.getExtension("EXT_texture_filter_anisotropic")||n.getExtension("MOZ_EXT_texture_filter_anisotropic")||n.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":r=n.getExtension("WEBGL_compressed_texture_s3tc")||n.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||n.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":r=n.getExtension("WEBGL_compressed_texture_pvrtc")||n.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:r=n.getExtension(i)}return e[i]=r,r}return{has:function(i){return null!==t(i)},init:function(i){i.isWebGL2?t("EXT_color_buffer_float"):(t("WEBGL_depth_texture"),t("OES_texture_float"),t("OES_texture_half_float"),t("OES_texture_half_float_linear"),t("OES_standard_derivatives"),t("OES_element_index_uint"),t("OES_vertex_array_object"),t("ANGLE_instanced_arrays")),t("OES_texture_float_linear"),t("EXT_color_buffer_half_float"),t("WEBGL_multisampled_render_to_texture")},get:function(i){const r=t(i);return null===r&&console.warn("THREE.WebGLRenderer: "+i+" extension not supported."),r}}}function ene(n,e,t,i){const r={},s=new WeakMap;function c(S){const T=S.target;null!==T.index&&e.remove(T.index);for(const R in T.attributes)e.remove(T.attributes[R]);T.removeEventListener("dispose",c),delete r[T.id];const I=s.get(T);I&&(e.remove(I),s.delete(T)),i.releaseStatesOfGeometry(T),!0===T.isInstancedBufferGeometry&&delete T._maxInstanceCount,t.memory.geometries--}function y(S){const T=[],I=S.index,R=S.attributes.position;let k=0;if(null!==I){const W=I.array;k=I.version;for(let V=0,X=W.length;V<X;V+=3){const ee=W[V+0],ae=W[V+1],Ee=W[V+2];T.push(ee,ae,ae,Ee,Ee,ee)}}else{k=R.version;for(let V=0,X=R.array.length/3-1;V<X;V+=3){const ee=V+0,ae=V+1,Ee=V+2;T.push(ee,ae,ae,Ee,Ee,ee)}}const F=new(yV(T)?RV:PV)(T,1);F.version=k;const G=s.get(S);G&&e.remove(G),s.set(S,F)}return{get:function d(S,T){return!0===r[T.id]||(T.addEventListener("dispose",c),r[T.id]=!0,t.memory.geometries++),T},update:function m(S){const T=S.attributes;for(const R in T)e.update(T[R],34962);const I=S.morphAttributes;for(const R in I){const k=I[R];for(let F=0,G=k.length;F<G;F++)e.update(k[F],34962)}},getWireframeAttribute:function w(S){const T=s.get(S);if(T){const I=S.index;null!==I&&T.version<I.version&&y(S)}else y(S);return s.get(S)}}}function tne(n,e,t,i){const r=i.isWebGL2;let s,d,m;this.setMode=function c(T){s=T},this.setIndex=function y(T){d=T.type,m=T.bytesPerElement},this.render=function w(T,I){n.drawElements(s,I,d,T*m),t.update(I,s,1)},this.renderInstances=function S(T,I,R){if(0===R)return;let k,F;if(r)k=n,F="drawElementsInstanced";else if(k=e.get("ANGLE_instanced_arrays"),F="drawElementsInstancedANGLE",null===k)return void console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");k[F](s,I,d,T*m,R),t.update(I,s,R)}}function nne(n){const t={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:t,programs:null,autoReset:!0,reset:function r(){t.frame++,t.calls=0,t.triangles=0,t.points=0,t.lines=0},update:function i(s,c,d){switch(t.calls++,c){case 4:t.triangles+=d*(s/3);break;case 1:t.lines+=d*(s/2);break;case 3:t.lines+=d*(s-1);break;case 2:t.lines+=d*s;break;case 0:t.points+=d*s;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",c)}}}}function ine(n,e){return n[0]-e[0]}function rne(n,e){return Math.abs(e[1])-Math.abs(n[1])}function sne(n,e,t){const i={},r=new Float32Array(8),s=new WeakMap,c=new Qr,d=[];for(let y=0;y<8;y++)d[y]=[y,0];return{update:function m(y,w,S){const T=y.morphTargetInfluences;if(!0===e.isWebGL2){const I=w.morphAttributes.position||w.morphAttributes.normal||w.morphAttributes.color,R=void 0!==I?I.length:0;let k=s.get(w);if(void 0===k||k.count!==R){let Ge=function(){xt.dispose(),s.delete(w),w.removeEventListener("dispose",Ge)};void 0!==k&&k.texture.dispose();const W=void 0!==w.morphAttributes.position,V=void 0!==w.morphAttributes.normal,X=void 0!==w.morphAttributes.color,ee=w.morphAttributes.position||[],ae=w.morphAttributes.normal||[],Ee=w.morphAttributes.color||[];let J=0;!0===W&&(J=1),!0===V&&(J=2),!0===X&&(J=3);let pe=w.attributes.position.count*J,Oe=1;pe>e.maxTextureSize&&(Oe=Math.ceil(pe/e.maxTextureSize),pe=e.maxTextureSize);const st=new Float32Array(pe*Oe*4*R),xt=new g2(st,pe,Oe,R);xt.type=um,xt.needsUpdate=!0;const Qe=4*J;for(let ft=0;ft<R;ft++){const qe=ee[ft],dt=ae[ft],Ye=Ee[ft],gt=pe*Oe*4*ft;for(let Ot=0;Ot<qe.count;Ot++){const pn=Ot*Qe;!0===W&&(c.fromBufferAttribute(qe,Ot),st[gt+pn+0]=c.x,st[gt+pn+1]=c.y,st[gt+pn+2]=c.z,st[gt+pn+3]=0),!0===V&&(c.fromBufferAttribute(dt,Ot),st[gt+pn+4]=c.x,st[gt+pn+5]=c.y,st[gt+pn+6]=c.z,st[gt+pn+7]=0),!0===X&&(c.fromBufferAttribute(Ye,Ot),st[gt+pn+8]=c.x,st[gt+pn+9]=c.y,st[gt+pn+10]=c.z,st[gt+pn+11]=4===Ye.itemSize?c.w:1)}}k={count:R,texture:xt,size:new Pt(pe,Oe)},s.set(w,k),w.addEventListener("dispose",Ge)}let F=0;for(let W=0;W<T.length;W++)F+=T[W];const G=w.morphTargetsRelative?1:1-F;S.getUniforms().setValue(n,"morphTargetBaseInfluence",G),S.getUniforms().setValue(n,"morphTargetInfluences",T),S.getUniforms().setValue(n,"morphTargetsTexture",k.texture,t),S.getUniforms().setValue(n,"morphTargetsTextureSize",k.size)}else{const I=void 0===T?0:T.length;let R=i[w.id];if(void 0===R||R.length!==I){R=[];for(let V=0;V<I;V++)R[V]=[V,0];i[w.id]=R}for(let V=0;V<I;V++){const X=R[V];X[0]=V,X[1]=T[V]}R.sort(rne);for(let V=0;V<8;V++)V<I&&R[V][1]?(d[V][0]=R[V][0],d[V][1]=R[V][1]):(d[V][0]=Number.MAX_SAFE_INTEGER,d[V][1]=0);d.sort(ine);const k=w.morphAttributes.position,F=w.morphAttributes.normal;let G=0;for(let V=0;V<8;V++){const X=d[V],ee=X[0],ae=X[1];ee!==Number.MAX_SAFE_INTEGER&&ae?(k&&w.getAttribute("morphTarget"+V)!==k[ee]&&w.setAttribute("morphTarget"+V,k[ee]),F&&w.getAttribute("morphNormal"+V)!==F[ee]&&w.setAttribute("morphNormal"+V,F[ee]),r[V]=ae,G+=ae):(k&&!0===w.hasAttribute("morphTarget"+V)&&w.deleteAttribute("morphTarget"+V),F&&!0===w.hasAttribute("morphNormal"+V)&&w.deleteAttribute("morphNormal"+V),r[V]=0)}const W=w.morphTargetsRelative?1:1-G;S.getUniforms().setValue(n,"morphTargetBaseInfluence",W),S.getUniforms().setValue(n,"morphTargetInfluences",r)}}}}function one(n,e,t,i){let r=new WeakMap;function d(m){const y=m.target;y.removeEventListener("dispose",d),t.remove(y.instanceMatrix),null!==y.instanceColor&&t.remove(y.instanceColor)}return{update:function s(m){const y=i.render.frame,S=e.get(m,m.geometry);return r.get(S)!==y&&(e.update(S),r.set(S,y)),m.isInstancedMesh&&(!1===m.hasEventListener("dispose",d)&&m.addEventListener("dispose",d),t.update(m.instanceMatrix,34962),null!==m.instanceColor&&t.update(m.instanceColor,34962)),S},dispose:function c(){r=new WeakMap}}}const jV=new hm,$V=new g2,WV=new bV,qV=new BS,ZV=[],XV=[],YV=new Float32Array(16),KV=new Float32Array(9),QV=new Float32Array(4);function c0(n,e,t){const i=n[0];if(i<=0||i>0)return n;const r=e*t;let s=ZV[r];if(void 0===s&&(s=new Float32Array(r),ZV[r]=s),0!==e){i.toArray(s,0);for(let c=1,d=0;c!==e;++c)d+=t,n[c].toArray(s,d)}return s}function jo(n,e){if(n.length!==e.length)return!1;for(let t=0,i=n.length;t<i;t++)if(n[t]!==e[t])return!1;return!0}function $o(n,e){for(let t=0,i=e.length;t<i;t++)n[t]=e[t]}function GS(n,e){let t=XV[e];void 0===t&&(t=new Int32Array(e),XV[e]=t);for(let i=0;i!==e;++i)t[i]=n.allocateTextureUnit();return t}function ane(n,e){const t=this.cache;t[0]!==e&&(n.uniform1f(this.addr,e),t[0]=e)}function lne(n,e){const t=this.cache;if(void 0!==e.x)(t[0]!==e.x||t[1]!==e.y)&&(n.uniform2f(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(jo(t,e))return;n.uniform2fv(this.addr,e),$o(t,e)}}function cne(n,e){const t=this.cache;if(void 0!==e.x)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(n.uniform3f(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else if(void 0!==e.r)(t[0]!==e.r||t[1]!==e.g||t[2]!==e.b)&&(n.uniform3f(this.addr,e.r,e.g,e.b),t[0]=e.r,t[1]=e.g,t[2]=e.b);else{if(jo(t,e))return;n.uniform3fv(this.addr,e),$o(t,e)}}function une(n,e){const t=this.cache;if(void 0!==e.x)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(n.uniform4f(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(jo(t,e))return;n.uniform4fv(this.addr,e),$o(t,e)}}function dne(n,e){const t=this.cache,i=e.elements;if(void 0===i){if(jo(t,e))return;n.uniformMatrix2fv(this.addr,!1,e),$o(t,e)}else{if(jo(t,i))return;QV.set(i),n.uniformMatrix2fv(this.addr,!1,QV),$o(t,i)}}function hne(n,e){const t=this.cache,i=e.elements;if(void 0===i){if(jo(t,e))return;n.uniformMatrix3fv(this.addr,!1,e),$o(t,e)}else{if(jo(t,i))return;KV.set(i),n.uniformMatrix3fv(this.addr,!1,KV),$o(t,i)}}function pne(n,e){const t=this.cache,i=e.elements;if(void 0===i){if(jo(t,e))return;n.uniformMatrix4fv(this.addr,!1,e),$o(t,e)}else{if(jo(t,i))return;YV.set(i),n.uniformMatrix4fv(this.addr,!1,YV),$o(t,i)}}function fne(n,e){const t=this.cache;t[0]!==e&&(n.uniform1i(this.addr,e),t[0]=e)}function mne(n,e){const t=this.cache;if(void 0!==e.x)(t[0]!==e.x||t[1]!==e.y)&&(n.uniform2i(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(jo(t,e))return;n.uniform2iv(this.addr,e),$o(t,e)}}function gne(n,e){const t=this.cache;if(void 0!==e.x)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(n.uniform3i(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else{if(jo(t,e))return;n.uniform3iv(this.addr,e),$o(t,e)}}function _ne(n,e){const t=this.cache;if(void 0!==e.x)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(n.uniform4i(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(jo(t,e))return;n.uniform4iv(this.addr,e),$o(t,e)}}function yne(n,e){const t=this.cache;t[0]!==e&&(n.uniform1ui(this.addr,e),t[0]=e)}function vne(n,e){const t=this.cache;if(void 0!==e.x)(t[0]!==e.x||t[1]!==e.y)&&(n.uniform2ui(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(jo(t,e))return;n.uniform2uiv(this.addr,e),$o(t,e)}}function xne(n,e){const t=this.cache;if(void 0!==e.x)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(n.uniform3ui(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else{if(jo(t,e))return;n.uniform3uiv(this.addr,e),$o(t,e)}}function bne(n,e){const t=this.cache;if(void 0!==e.x)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(n.uniform4ui(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(jo(t,e))return;n.uniform4uiv(this.addr,e),$o(t,e)}}function wne(n,e,t){const i=this.cache,r=t.allocateTextureUnit();i[0]!==r&&(n.uniform1i(this.addr,r),i[0]=r),t.setTexture2D(e||jV,r)}function Mne(n,e,t){const i=this.cache,r=t.allocateTextureUnit();i[0]!==r&&(n.uniform1i(this.addr,r),i[0]=r),t.setTexture3D(e||WV,r)}function Cne(n,e,t){const i=this.cache,r=t.allocateTextureUnit();i[0]!==r&&(n.uniform1i(this.addr,r),i[0]=r),t.setTextureCube(e||qV,r)}function Sne(n,e,t){const i=this.cache,r=t.allocateTextureUnit();i[0]!==r&&(n.uniform1i(this.addr,r),i[0]=r),t.setTexture2DArray(e||$V,r)}function Tne(n,e){n.uniform1fv(this.addr,e)}function Dne(n,e){const t=c0(e,this.size,2);n.uniform2fv(this.addr,t)}function Ane(n,e){const t=c0(e,this.size,3);n.uniform3fv(this.addr,t)}function Ine(n,e){const t=c0(e,this.size,4);n.uniform4fv(this.addr,t)}function Pne(n,e){const t=c0(e,this.size,4);n.uniformMatrix2fv(this.addr,!1,t)}function Rne(n,e){const t=c0(e,this.size,9);n.uniformMatrix3fv(this.addr,!1,t)}function kne(n,e){const t=c0(e,this.size,16);n.uniformMatrix4fv(this.addr,!1,t)}function Lne(n,e){n.uniform1iv(this.addr,e)}function One(n,e){n.uniform2iv(this.addr,e)}function Fne(n,e){n.uniform3iv(this.addr,e)}function Nne(n,e){n.uniform4iv(this.addr,e)}function Bne(n,e){n.uniform1uiv(this.addr,e)}function zne(n,e){n.uniform2uiv(this.addr,e)}function Vne(n,e){n.uniform3uiv(this.addr,e)}function Une(n,e){n.uniform4uiv(this.addr,e)}function Hne(n,e,t){const i=this.cache,r=e.length,s=GS(t,r);jo(i,s)||(n.uniform1iv(this.addr,s),$o(i,s));for(let c=0;c!==r;++c)t.setTexture2D(e[c]||jV,s[c])}function Gne(n,e,t){const i=this.cache,r=e.length,s=GS(t,r);jo(i,s)||(n.uniform1iv(this.addr,s),$o(i,s));for(let c=0;c!==r;++c)t.setTexture3D(e[c]||WV,s[c])}function jne(n,e,t){const i=this.cache,r=e.length,s=GS(t,r);jo(i,s)||(n.uniform1iv(this.addr,s),$o(i,s));for(let c=0;c!==r;++c)t.setTextureCube(e[c]||qV,s[c])}function $ne(n,e,t){const i=this.cache,r=e.length,s=GS(t,r);jo(i,s)||(n.uniform1iv(this.addr,s),$o(i,s));for(let c=0;c!==r;++c)t.setTexture2DArray(e[c]||$V,s[c])}class qne{constructor(e,t,i){this.id=e,this.addr=i,this.cache=[],this.setValue=function Ene(n){switch(n){case 5126:return ane;case 35664:return lne;case 35665:return cne;case 35666:return une;case 35674:return dne;case 35675:return hne;case 35676:return pne;case 5124:case 35670:return fne;case 35667:case 35671:return mne;case 35668:case 35672:return gne;case 35669:case 35673:return _ne;case 5125:return yne;case 36294:return vne;case 36295:return xne;case 36296:return bne;case 35678:case 36198:case 36298:case 36306:case 35682:return wne;case 35679:case 36299:case 36307:return Mne;case 35680:case 36300:case 36308:case 36293:return Cne;case 36289:case 36303:case 36311:case 36292:return Sne}}(t.type)}}class Zne{constructor(e,t,i){this.id=e,this.addr=i,this.cache=[],this.size=t.size,this.setValue=function Wne(n){switch(n){case 5126:return Tne;case 35664:return Dne;case 35665:return Ane;case 35666:return Ine;case 35674:return Pne;case 35675:return Rne;case 35676:return kne;case 5124:case 35670:return Lne;case 35667:case 35671:return One;case 35668:case 35672:return Fne;case 35669:case 35673:return Nne;case 5125:return Bne;case 36294:return zne;case 36295:return Vne;case 36296:return Une;case 35678:case 36198:case 36298:case 36306:case 35682:return Hne;case 35679:case 36299:case 36307:return Gne;case 35680:case 36300:case 36308:case 36293:return jne;case 36289:case 36303:case 36311:case 36292:return $ne}}(t.type)}}class Xne{constructor(e){this.id=e,this.seq=[],this.map={}}setValue(e,t,i){const r=this.seq;for(let s=0,c=r.length;s!==c;++s){const d=r[s];d.setValue(e,t[d.id],i)}}}const z2=/(\w+)(\])?(\[|\.)?/g;function JV(n,e){n.seq.push(e),n.map[e.id]=e}function Yne(n,e,t){const i=n.name,r=i.length;for(z2.lastIndex=0;;){const s=z2.exec(i),c=z2.lastIndex;let d=s[1];const y=s[3];if("]"===s[2]&&(d|=0),void 0===y||"["===y&&c+2===r){JV(t,void 0===y?new qne(d,n,e):new Zne(d,n,e));break}{let S=t.map[d];void 0===S&&(S=new Xne(d),JV(t,S)),t=S}}}class jS{constructor(e,t){this.seq=[],this.map={};const i=e.getProgramParameter(t,35718);for(let r=0;r<i;++r){const s=e.getActiveUniform(t,r);Yne(s,e.getUniformLocation(t,s.name),this)}}setValue(e,t,i,r){const s=this.map[t];void 0!==s&&s.setValue(e,i,r)}setOptional(e,t,i){const r=t[i];void 0!==r&&this.setValue(e,i,r)}static upload(e,t,i,r){for(let s=0,c=t.length;s!==c;++s){const d=t[s],m=i[d.id];!1!==m.needsUpdate&&d.setValue(e,m.value,r)}}static seqWithValue(e,t){const i=[];for(let r=0,s=e.length;r!==s;++r){const c=e[r];c.id in t&&i.push(c)}return i}}function e4(n,e,t){const i=n.createShader(e);return n.shaderSource(i,t),n.compileShader(i),i}let Kne=0;function t4(n,e,t){const i=n.getShaderParameter(e,35713),r=n.getShaderInfoLog(e).trim();if(i&&""===r)return"";const s=/ERROR: 0:(\d+)/.exec(r);if(s){const c=parseInt(s[1]);return t.toUpperCase()+"\n\n"+r+"\n\n"+function Qne(n,e){const t=n.split("\n"),i=[],r=Math.max(e-6,0),s=Math.min(e+6,t.length);for(let c=r;c<s;c++){const d=c+1;i.push(`${d===e?">":" "} ${d}: ${t[c]}`)}return i.join("\n")}(n.getShaderSource(e),c)}return r}function eie(n,e){const t=function Jne(n){switch(n){case Xg:return["Linear","( value )"];case vs:return["sRGB","( value )"];default:return console.warn("THREE.WebGLProgram: Unsupported encoding:",n),["Linear","( value )"]}}(e);return"vec4 "+n+"( vec4 value ) { return LinearTo"+t[0]+t[1]+"; }"}function tie(n,e){let t;switch(e){case 1:t="Linear";break;case 2:t="Reinhard";break;case 3:t="OptimizedCineon";break;case 4:t="ACESFilmic";break;case 5:t="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",e),t="Linear"}return"vec3 "+n+"( vec3 color ) { return "+t+"ToneMapping( color ); }"}function bw(n){return""!==n}function n4(n,e){const t=e.numSpotLightShadows+e.numSpotLightMaps-e.numSpotLightShadowsWithMaps;return n.replace(/NUM_DIR_LIGHTS/g,e.numDirLights).replace(/NUM_SPOT_LIGHTS/g,e.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,e.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,t).replace(/NUM_RECT_AREA_LIGHTS/g,e.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,e.numPointLights).replace(/NUM_HEMI_LIGHTS/g,e.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,e.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,e.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,e.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,e.numPointLightShadows)}function r4(n,e){return n.replace(/NUM_CLIPPING_PLANES/g,e.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,e.numClippingPlanes-e.numClipIntersection)}const sie=/^[ \t]*#include +<([\w\d./]+)>/gm;function V2(n){return n.replace(sie,oie)}function oie(n,e){const t=qi[e];if(void 0===t)throw new Error("Can not resolve #include <"+e+">");return V2(t)}const aie=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function s4(n){return n.replace(aie,lie)}function lie(n,e,t,i){let r="";for(let s=parseInt(e);s<parseInt(t);s++)r+=i.replace(/\[\s*i\s*\]/g,"[ "+s+" ]").replace(/UNROLLED_LOOP_INDEX/g,s);return r}function o4(n){let e="precision "+n.precision+" float;\nprecision "+n.precision+" int;";return"highp"===n.precision?e+="\n#define HIGH_PRECISION":"mediump"===n.precision?e+="\n#define MEDIUM_PRECISION":"lowp"===n.precision&&(e+="\n#define LOW_PRECISION"),e}function fie(n,e,t,i){const r=n.getContext(),s=t.defines;let c=t.vertexShader,d=t.fragmentShader;const m=function cie(n){let e="SHADOWMAP_TYPE_BASIC";return 1===n.shadowMapType?e="SHADOWMAP_TYPE_PCF":2===n.shadowMapType?e="SHADOWMAP_TYPE_PCF_SOFT":3===n.shadowMapType&&(e="SHADOWMAP_TYPE_VSM"),e}(t),y=function uie(n){let e="ENVMAP_TYPE_CUBE";if(n.envMap)switch(n.envMapMode){case 301:case 302:e="ENVMAP_TYPE_CUBE";break;case 306:e="ENVMAP_TYPE_CUBE_UV"}return e}(t),w=function die(n){let e="ENVMAP_MODE_REFLECTION";return n.envMap&&302===n.envMapMode&&(e="ENVMAP_MODE_REFRACTION"),e}(t),S=function hie(n){let e="ENVMAP_BLENDING_NONE";if(n.envMap)switch(n.combine){case 0:e="ENVMAP_BLENDING_MULTIPLY";break;case 1:e="ENVMAP_BLENDING_MIX";break;case 2:e="ENVMAP_BLENDING_ADD"}return e}(t),T=function pie(n){const e=n.envMapCubeUVHeight;if(null===e)return null;const t=Math.log2(e)-2,i=1/e;return{texelWidth:1/(3*Math.max(Math.pow(2,t),112)),texelHeight:i,maxMip:t}}(t),I=t.isWebGL2?"":function nie(n){return[n.extensionDerivatives||n.envMapCubeUVHeight||n.bumpMap||n.tangentSpaceNormalMap||n.clearcoatNormalMap||n.flatShading||"physical"===n.shaderID?"#extension GL_OES_standard_derivatives : enable":"",(n.extensionFragDepth||n.logarithmicDepthBuffer)&&n.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",n.extensionDrawBuffers&&n.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(n.extensionShaderTextureLOD||n.envMap||n.transmission)&&n.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(bw).join("\n")}(t),R=function iie(n){const e=[];for(const t in n){const i=n[t];!1!==i&&e.push("#define "+t+" "+i)}return e.join("\n")}(s),k=r.createProgram();let F,G,W=t.glslVersion?"#version "+t.glslVersion+"\n":"";t.isRawShaderMaterial?(F=[R].filter(bw).join("\n"),F.length>0&&(F+="\n"),G=[I,R].filter(bw).join("\n"),G.length>0&&(G+="\n")):(F=[o4(t),"#define SHADER_NAME "+t.shaderName,R,t.instancing?"#define USE_INSTANCING":"",t.instancingColor?"#define USE_INSTANCING_COLOR":"",t.supportsVertexTextures?"#define VERTEX_TEXTURES":"",t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.map?"#define USE_MAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+w:"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMap&&t.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",t.normalMap&&t.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",t.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",t.displacementMap&&t.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",t.specularColorMap?"#define USE_SPECULARCOLORMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.transmission?"#define USE_TRANSMISSION":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.thicknessMap?"#define USE_THICKNESSMAP":"",t.sheenColorMap?"#define USE_SHEENCOLORMAP":"",t.sheenRoughnessMap?"#define USE_SHEENROUGHNESSMAP":"",t.vertexTangents?"#define USE_TANGENT":"",t.vertexColors?"#define USE_COLOR":"",t.vertexAlphas?"#define USE_COLOR_ALPHA":"",t.vertexUvs?"#define USE_UV":"",t.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",t.flatShading?"#define FLAT_SHADED":"",t.skinning?"#define USE_SKINNING":"",t.morphTargets?"#define USE_MORPHTARGETS":"",t.morphNormals&&!1===t.flatShading?"#define USE_MORPHNORMALS":"",t.morphColors&&t.isWebGL2?"#define USE_MORPHCOLORS":"",t.morphTargetsCount>0&&t.isWebGL2?"#define MORPHTARGETS_TEXTURE":"",t.morphTargetsCount>0&&t.isWebGL2?"#define MORPHTARGETS_TEXTURE_STRIDE "+t.morphTextureStride:"",t.morphTargetsCount>0&&t.isWebGL2?"#define MORPHTARGETS_COUNT "+t.morphTargetsCount:"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+m:"",t.sizeAttenuation?"#define USE_SIZEATTENUATION":"",t.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",t.logarithmicDepthBuffer&&t.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","\tattribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","\tattribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_TANGENT","\tattribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","\tattribute vec4 color;","#elif defined( USE_COLOR )","\tattribute vec3 color;","#endif","#if ( defined( USE_MORPHTARGETS ) && ! defined( MORPHTARGETS_TEXTURE ) )","\tattribute vec3 morphTarget0;","\tattribute vec3 morphTarget1;","\tattribute vec3 morphTarget2;","\tattribute vec3 morphTarget3;","\t#ifdef USE_MORPHNORMALS","\t\tattribute vec3 morphNormal0;","\t\tattribute vec3 morphNormal1;","\t\tattribute vec3 morphNormal2;","\t\tattribute vec3 morphNormal3;","\t#else","\t\tattribute vec3 morphTarget4;","\t\tattribute vec3 morphTarget5;","\t\tattribute vec3 morphTarget6;","\t\tattribute vec3 morphTarget7;","\t#endif","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(bw).join("\n"),G=[I,o4(t),"#define SHADER_NAME "+t.shaderName,R,t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.map?"#define USE_MAP":"",t.matcap?"#define USE_MATCAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+y:"",t.envMap?"#define "+w:"",t.envMap?"#define "+S:"",T?"#define CUBEUV_TEXEL_WIDTH "+T.texelWidth:"",T?"#define CUBEUV_TEXEL_HEIGHT "+T.texelHeight:"",T?"#define CUBEUV_MAX_MIP "+T.maxMip+".0":"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMap&&t.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",t.normalMap&&t.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",t.clearcoat?"#define USE_CLEARCOAT":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.iridescence?"#define USE_IRIDESCENCE":"",t.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",t.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",t.specularColorMap?"#define USE_SPECULARCOLORMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.alphaTest?"#define USE_ALPHATEST":"",t.sheen?"#define USE_SHEEN":"",t.sheenColorMap?"#define USE_SHEENCOLORMAP":"",t.sheenRoughnessMap?"#define USE_SHEENROUGHNESSMAP":"",t.transmission?"#define USE_TRANSMISSION":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.thicknessMap?"#define USE_THICKNESSMAP":"",t.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",t.vertexTangents?"#define USE_TANGENT":"",t.vertexColors||t.instancingColor?"#define USE_COLOR":"",t.vertexAlphas?"#define USE_COLOR_ALPHA":"",t.vertexUvs?"#define USE_UV":"",t.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",t.gradientMap?"#define USE_GRADIENTMAP":"",t.flatShading?"#define FLAT_SHADED":"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+m:"",t.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",t.useLegacyLights?"#define LEGACY_LIGHTS":"",t.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",t.logarithmicDepthBuffer&&t.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",0!==t.toneMapping?"#define TONE_MAPPING":"",0!==t.toneMapping?qi.tonemapping_pars_fragment:"",0!==t.toneMapping?tie("toneMapping",t.toneMapping):"",t.dithering?"#define DITHERING":"",t.opaque?"#define OPAQUE":"",qi.encodings_pars_fragment,eie("linearToOutputTexel",t.outputEncoding),t.useDepthPacking?"#define DEPTH_PACKING "+t.depthPacking:"","\n"].filter(bw).join("\n")),c=V2(c),c=n4(c,t),c=r4(c,t),d=V2(d),d=n4(d,t),d=r4(d,t),c=s4(c),d=s4(d),t.isWebGL2&&!0!==t.isRawShaderMaterial&&(W="#version 300 es\n",F=["precision mediump sampler2DArray;","#define attribute in","#define varying out","#define texture2D texture"].join("\n")+"\n"+F,G=["#define varying in","300 es"===t.glslVersion?"":"layout(location = 0) out highp vec4 pc_fragColor;","300 es"===t.glslVersion?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join("\n")+"\n"+G);const X=W+G+d,ee=e4(r,35633,W+F+c),ae=e4(r,35632,X);if(r.attachShader(k,ee),r.attachShader(k,ae),void 0!==t.index0AttributeName?r.bindAttribLocation(k,0,t.index0AttributeName):!0===t.morphTargets&&r.bindAttribLocation(k,0,"position"),r.linkProgram(k),n.debug.checkShaderErrors){const pe=r.getProgramInfoLog(k).trim(),Oe=r.getShaderInfoLog(ee).trim(),st=r.getShaderInfoLog(ae).trim();let xt=!0,Qe=!0;if(!1===r.getProgramParameter(k,35714)){xt=!1;const Ge=t4(r,ee,"vertex"),ft=t4(r,ae,"fragment");console.error("THREE.WebGLProgram: Shader Error "+r.getError()+" - VALIDATE_STATUS "+r.getProgramParameter(k,35715)+"\n\nProgram Info Log: "+pe+"\n"+Ge+"\n"+ft)}else""!==pe?console.warn("THREE.WebGLProgram: Program Info Log:",pe):(""===Oe||""===st)&&(Qe=!1);Qe&&(this.diagnostics={runnable:xt,programLog:pe,vertexShader:{log:Oe,prefix:F},fragmentShader:{log:st,prefix:G}})}let Ee,J;return r.deleteShader(ee),r.deleteShader(ae),this.getUniforms=function(){return void 0===Ee&&(Ee=new jS(r,k)),Ee},this.getAttributes=function(){return void 0===J&&(J=function rie(n,e){const t={},i=n.getProgramParameter(e,35721);for(let r=0;r<i;r++){const s=n.getActiveAttrib(e,r),c=s.name;let d=1;35674===s.type&&(d=2),35675===s.type&&(d=3),35676===s.type&&(d=4),t[c]={type:s.type,location:n.getAttribLocation(e,c),locationSize:d}}return t}(r,k)),J},this.destroy=function(){i.releaseStatesOfProgram(this),r.deleteProgram(k),this.program=void 0},this.name=t.shaderName,this.id=Kne++,this.cacheKey=e,this.usedTimes=1,this.program=k,this.vertexShader=ee,this.fragmentShader=ae,this}let mie=0;class gie{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(e){const i=e.fragmentShader,r=this._getShaderStage(e.vertexShader),s=this._getShaderStage(i),c=this._getShaderCacheForMaterial(e);return!1===c.has(r)&&(c.add(r),r.usedTimes++),!1===c.has(s)&&(c.add(s),s.usedTimes++),this}remove(e){const t=this.materialCache.get(e);for(const i of t)i.usedTimes--,0===i.usedTimes&&this.shaderCache.delete(i.code);return this.materialCache.delete(e),this}getVertexShaderID(e){return this._getShaderStage(e.vertexShader).id}getFragmentShaderID(e){return this._getShaderStage(e.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(e){const t=this.materialCache;let i=t.get(e);return void 0===i&&(i=new Set,t.set(e,i)),i}_getShaderStage(e){const t=this.shaderCache;let i=t.get(e);return void 0===i&&(i=new _ie(e),t.set(e,i)),i}}class _ie{constructor(e){this.id=mie++,this.code=e,this.usedTimes=0}}function yie(n,e,t,i,r,s,c){const d=new M2,m=new gie,y=[],w=r.isWebGL2,S=r.logarithmicDepthBuffer,T=r.vertexTextures;let I=r.precision;const R={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};return{getParameters:function k(J,pe,Oe,st,xt){const Qe=st.fog,Ge=xt.geometry,qe=(J.isMeshStandardMaterial?t:e).get(J.envMap||(J.isMeshStandardMaterial?st.environment:null)),dt=qe&&306===qe.mapping?qe.image.height:null,Ye=R[J.type];null!==J.precision&&(I=r.getMaxPrecision(J.precision),I!==J.precision&&console.warn("THREE.WebGLProgram.getParameters:",J.precision,"not supported, using",I,"instead."));const gt=Ge.morphAttributes.position||Ge.morphAttributes.normal||Ge.morphAttributes.color,Ot=void 0!==gt?gt.length:0;let at,Ut,zt,nt,pn=0;if(void 0!==Ge.morphAttributes.position&&(pn=1),void 0!==Ge.morphAttributes.normal&&(pn=2),void 0!==Ge.morphAttributes.color&&(pn=3),Ye){const ii=oh[Ye];at=ii.vertexShader,Ut=ii.fragmentShader}else at=J.vertexShader,Ut=J.fragmentShader,m.update(J),zt=m.getVertexShaderID(J),nt=m.getFragmentShaderID(J);const In=n.getRenderTarget(),xn=J.clearcoat>0,gn=J.iridescence>0;return{isWebGL2:w,shaderID:Ye,shaderName:J.type,vertexShader:at,fragmentShader:Ut,defines:J.defines,customVertexShaderID:zt,customFragmentShaderID:nt,isRawShaderMaterial:!0===J.isRawShaderMaterial,glslVersion:J.glslVersion,precision:I,instancing:!0===xt.isInstancedMesh,instancingColor:!0===xt.isInstancedMesh&&null!==xt.instanceColor,supportsVertexTextures:T,outputEncoding:null===In?n.outputEncoding:!0===In.isXRRenderTarget?In.texture.encoding:Xg,map:!!J.map,matcap:!!J.matcap,envMap:!!qe,envMapMode:qe&&qe.mapping,envMapCubeUVHeight:dt,lightMap:!!J.lightMap,aoMap:!!J.aoMap,emissiveMap:!!J.emissiveMap,bumpMap:!!J.bumpMap,normalMap:!!J.normalMap,objectSpaceNormalMap:1===J.normalMapType,tangentSpaceNormalMap:0===J.normalMapType,decodeVideoTexture:!!J.map&&!0===J.map.isVideoTexture&&J.map.encoding===vs,clearcoat:xn,clearcoatMap:xn&&!!J.clearcoatMap,clearcoatRoughnessMap:xn&&!!J.clearcoatRoughnessMap,clearcoatNormalMap:xn&&!!J.clearcoatNormalMap,iridescence:gn,iridescenceMap:gn&&!!J.iridescenceMap,iridescenceThicknessMap:gn&&!!J.iridescenceThicknessMap,displacementMap:!!J.displacementMap,roughnessMap:!!J.roughnessMap,metalnessMap:!!J.metalnessMap,specularMap:!!J.specularMap,specularIntensityMap:!!J.specularIntensityMap,specularColorMap:!!J.specularColorMap,opaque:!1===J.transparent&&1===J.blending,alphaMap:!!J.alphaMap,alphaTest:J.alphaTest>0,gradientMap:!!J.gradientMap,sheen:J.sheen>0,sheenColorMap:!!J.sheenColorMap,sheenRoughnessMap:!!J.sheenRoughnessMap,transmission:J.transmission>0,transmissionMap:!!J.transmissionMap,thicknessMap:!!J.thicknessMap,combine:J.combine,vertexTangents:!!J.normalMap&&!!Ge.attributes.tangent,vertexColors:J.vertexColors,vertexAlphas:!0===J.vertexColors&&!!Ge.attributes.color&&4===Ge.attributes.color.itemSize,vertexUvs:!!(J.map||J.bumpMap||J.normalMap||J.specularMap||J.alphaMap||J.emissiveMap||J.roughnessMap||J.metalnessMap||J.clearcoatMap||J.clearcoatRoughnessMap||J.clearcoatNormalMap||J.iridescenceMap||J.iridescenceThicknessMap||J.displacementMap||J.transmissionMap||J.thicknessMap||J.specularIntensityMap||J.specularColorMap||J.sheenColorMap||J.sheenRoughnessMap),uvsVertexOnly:!(J.map||J.bumpMap||J.normalMap||J.specularMap||J.alphaMap||J.emissiveMap||J.roughnessMap||J.metalnessMap||J.clearcoatNormalMap||J.iridescenceMap||J.iridescenceThicknessMap||J.transmission>0||J.transmissionMap||J.thicknessMap||J.specularIntensityMap||J.specularColorMap||J.sheen>0||J.sheenColorMap||J.sheenRoughnessMap||!J.displacementMap),fog:!!Qe,useFog:!0===J.fog,fogExp2:Qe&&Qe.isFogExp2,flatShading:!!J.flatShading,sizeAttenuation:J.sizeAttenuation,logarithmicDepthBuffer:S,skinning:!0===xt.isSkinnedMesh,morphTargets:void 0!==Ge.morphAttributes.position,morphNormals:void 0!==Ge.morphAttributes.normal,morphColors:void 0!==Ge.morphAttributes.color,morphTargetsCount:Ot,morphTextureStride:pn,numDirLights:pe.directional.length,numPointLights:pe.point.length,numSpotLights:pe.spot.length,numSpotLightMaps:pe.spotLightMap.length,numRectAreaLights:pe.rectArea.length,numHemiLights:pe.hemi.length,numDirLightShadows:pe.directionalShadowMap.length,numPointLightShadows:pe.pointShadowMap.length,numSpotLightShadows:pe.spotShadowMap.length,numSpotLightShadowsWithMaps:pe.numSpotLightShadowsWithMaps,numClippingPlanes:c.numPlanes,numClipIntersection:c.numIntersection,dithering:J.dithering,shadowMapEnabled:n.shadowMap.enabled&&Oe.length>0,shadowMapType:n.shadowMap.type,toneMapping:J.toneMapped?n.toneMapping:0,useLegacyLights:n.useLegacyLights,premultipliedAlpha:J.premultipliedAlpha,doubleSided:2===J.side,flipSided:1===J.side,useDepthPacking:!!J.depthPacking,depthPacking:J.depthPacking||0,index0AttributeName:J.index0AttributeName,extensionDerivatives:J.extensions&&J.extensions.derivatives,extensionFragDepth:J.extensions&&J.extensions.fragDepth,extensionDrawBuffers:J.extensions&&J.extensions.drawBuffers,extensionShaderTextureLOD:J.extensions&&J.extensions.shaderTextureLOD,rendererExtensionFragDepth:w||i.has("EXT_frag_depth"),rendererExtensionDrawBuffers:w||i.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:w||i.has("EXT_shader_texture_lod"),customProgramCacheKey:J.customProgramCacheKey()}},getProgramCacheKey:function F(J){const pe=[];if(J.shaderID?pe.push(J.shaderID):(pe.push(J.customVertexShaderID),pe.push(J.customFragmentShaderID)),void 0!==J.defines)for(const Oe in J.defines)pe.push(Oe),pe.push(J.defines[Oe]);return!1===J.isRawShaderMaterial&&(function G(J,pe){J.push(pe.precision),J.push(pe.outputEncoding),J.push(pe.envMapMode),J.push(pe.envMapCubeUVHeight),J.push(pe.combine),J.push(pe.vertexUvs),J.push(pe.fogExp2),J.push(pe.sizeAttenuation),J.push(pe.morphTargetsCount),J.push(pe.morphAttributeCount),J.push(pe.numDirLights),J.push(pe.numPointLights),J.push(pe.numSpotLights),J.push(pe.numSpotLightMaps),J.push(pe.numHemiLights),J.push(pe.numRectAreaLights),J.push(pe.numDirLightShadows),J.push(pe.numPointLightShadows),J.push(pe.numSpotLightShadows),J.push(pe.numSpotLightShadowsWithMaps),J.push(pe.shadowMapType),J.push(pe.toneMapping),J.push(pe.numClippingPlanes),J.push(pe.numClipIntersection),J.push(pe.depthPacking)}(pe,J),function W(J,pe){d.disableAll(),pe.isWebGL2&&d.enable(0),pe.supportsVertexTextures&&d.enable(1),pe.instancing&&d.enable(2),pe.instancingColor&&d.enable(3),pe.map&&d.enable(4),pe.matcap&&d.enable(5),pe.envMap&&d.enable(6),pe.lightMap&&d.enable(7),pe.aoMap&&d.enable(8),pe.emissiveMap&&d.enable(9),pe.bumpMap&&d.enable(10),pe.normalMap&&d.enable(11),pe.objectSpaceNormalMap&&d.enable(12),pe.tangentSpaceNormalMap&&d.enable(13),pe.clearcoat&&d.enable(14),pe.clearcoatMap&&d.enable(15),pe.clearcoatRoughnessMap&&d.enable(16),pe.clearcoatNormalMap&&d.enable(17),pe.iridescence&&d.enable(18),pe.iridescenceMap&&d.enable(19),pe.iridescenceThicknessMap&&d.enable(20),pe.displacementMap&&d.enable(21),pe.specularMap&&d.enable(22),pe.roughnessMap&&d.enable(23),pe.metalnessMap&&d.enable(24),pe.gradientMap&&d.enable(25),pe.alphaMap&&d.enable(26),pe.alphaTest&&d.enable(27),pe.vertexColors&&d.enable(28),pe.vertexAlphas&&d.enable(29),pe.vertexUvs&&d.enable(30),pe.vertexTangents&&d.enable(31),pe.uvsVertexOnly&&d.enable(32),J.push(d.mask),d.disableAll(),pe.fog&&d.enable(0),pe.useFog&&d.enable(1),pe.flatShading&&d.enable(2),pe.logarithmicDepthBuffer&&d.enable(3),pe.skinning&&d.enable(4),pe.morphTargets&&d.enable(5),pe.morphNormals&&d.enable(6),pe.morphColors&&d.enable(7),pe.premultipliedAlpha&&d.enable(8),pe.shadowMapEnabled&&d.enable(9),pe.useLegacyLights&&d.enable(10),pe.doubleSided&&d.enable(11),pe.flipSided&&d.enable(12),pe.useDepthPacking&&d.enable(13),pe.dithering&&d.enable(14),pe.specularIntensityMap&&d.enable(15),pe.specularColorMap&&d.enable(16),pe.transmission&&d.enable(17),pe.transmissionMap&&d.enable(18),pe.thicknessMap&&d.enable(19),pe.sheen&&d.enable(20),pe.sheenColorMap&&d.enable(21),pe.sheenRoughnessMap&&d.enable(22),pe.decodeVideoTexture&&d.enable(23),pe.opaque&&d.enable(24),J.push(d.mask)}(pe,J),pe.push(n.outputEncoding)),pe.push(J.customProgramCacheKey),pe.join()},getUniforms:function V(J){const pe=R[J.type];let Oe;return Oe=pe?BJ.clone(oh[pe].uniforms):J.uniforms,Oe},acquireProgram:function X(J,pe){let Oe;for(let st=0,xt=y.length;st<xt;st++){const Qe=y[st];if(Qe.cacheKey===pe){Oe=Qe,++Oe.usedTimes;break}}return void 0===Oe&&(Oe=new fie(n,pe,J,s),y.push(Oe)),Oe},releaseProgram:function ee(J){if(0==--J.usedTimes){const pe=y.indexOf(J);y[pe]=y[y.length-1],y.pop(),J.destroy()}},releaseShaderCache:function ae(J){m.remove(J)},programs:y,dispose:function Ee(){m.dispose()}}}function vie(){let n=new WeakMap;return{get:function e(s){let c=n.get(s);return void 0===c&&(c={},n.set(s,c)),c},remove:function t(s){n.delete(s)},update:function i(s,c,d){n.get(s)[c]=d},dispose:function r(){n=new WeakMap}}}function xie(n,e){return n.groupOrder!==e.groupOrder?n.groupOrder-e.groupOrder:n.renderOrder!==e.renderOrder?n.renderOrder-e.renderOrder:n.material.id!==e.material.id?n.material.id-e.material.id:n.z!==e.z?n.z-e.z:n.id-e.id}function a4(n,e){return n.groupOrder!==e.groupOrder?n.groupOrder-e.groupOrder:n.renderOrder!==e.renderOrder?n.renderOrder-e.renderOrder:n.z!==e.z?e.z-n.z:n.id-e.id}function l4(){const n=[];let e=0;const t=[],i=[],r=[];function c(S,T,I,R,k,F){let G=n[e];return void 0===G?(G={id:S.id,object:S,geometry:T,material:I,groupOrder:R,renderOrder:S.renderOrder,z:k,group:F},n[e]=G):(G.id=S.id,G.object=S,G.geometry=T,G.material=I,G.groupOrder=R,G.renderOrder=S.renderOrder,G.z=k,G.group=F),e++,G}return{opaque:t,transmissive:i,transparent:r,init:function s(){e=0,t.length=0,i.length=0,r.length=0},push:function d(S,T,I,R,k,F){const G=c(S,T,I,R,k,F);I.transmission>0?i.push(G):!0===I.transparent?r.push(G):t.push(G)},unshift:function m(S,T,I,R,k,F){const G=c(S,T,I,R,k,F);I.transmission>0?i.unshift(G):!0===I.transparent?r.unshift(G):t.unshift(G)},finish:function w(){for(let S=e,T=n.length;S<T;S++){const I=n[S];if(null===I.id)break;I.id=null,I.object=null,I.geometry=null,I.material=null,I.group=null}},sort:function y(S,T){t.length>1&&t.sort(S||xie),i.length>1&&i.sort(T||a4),r.length>1&&r.sort(T||a4)}}}function bie(){let n=new WeakMap;return{get:function e(i,r){const s=n.get(i);let c;return void 0===s?(c=new l4,n.set(i,[c])):r>=s.length?(c=new l4,s.push(c)):c=s[r],c},dispose:function t(){n=new WeakMap}}}function wie(){const n={};return{get:function(e){if(void 0!==n[e.id])return n[e.id];let t;switch(e.type){case"DirectionalLight":t={direction:new _e,color:new An};break;case"SpotLight":t={position:new _e,direction:new _e,color:new An,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":t={position:new _e,color:new An,distance:0,decay:0};break;case"HemisphereLight":t={direction:new _e,skyColor:new An,groundColor:new An};break;case"RectAreaLight":t={color:new An,position:new _e,halfWidth:new _e,halfHeight:new _e}}return n[e.id]=t,t}}}let Cie=0;function Sie(n,e){return(e.castShadow?2:0)-(n.castShadow?2:0)+(e.map?1:0)-(n.map?1:0)}function Eie(n,e){const t=new wie,i=function Mie(){const n={};return{get:function(e){if(void 0!==n[e.id])return n[e.id];let t;switch(e.type){case"DirectionalLight":case"SpotLight":t={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Pt};break;case"PointLight":t={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Pt,shadowCameraNear:1,shadowCameraFar:1e3}}return n[e.id]=t,t}}}(),r={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0};for(let w=0;w<9;w++)r.probe.push(new _e);const s=new _e,c=new Bi,d=new Bi;return{setup:function m(w,S){let T=0,I=0,R=0;for(let st=0;st<9;st++)r.probe[st].set(0,0,0);let k=0,F=0,G=0,W=0,V=0,X=0,ee=0,ae=0,Ee=0,J=0;w.sort(Sie);const pe=!0===S?Math.PI:1;for(let st=0,xt=w.length;st<xt;st++){const Qe=w[st],Ge=Qe.color,ft=Qe.intensity,qe=Qe.distance,dt=Qe.shadow&&Qe.shadow.map?Qe.shadow.map.texture:null;if(Qe.isAmbientLight)T+=Ge.r*ft*pe,I+=Ge.g*ft*pe,R+=Ge.b*ft*pe;else if(Qe.isLightProbe)for(let Ye=0;Ye<9;Ye++)r.probe[Ye].addScaledVector(Qe.sh.coefficients[Ye],ft);else if(Qe.isDirectionalLight){const Ye=t.get(Qe);if(Ye.color.copy(Qe.color).multiplyScalar(Qe.intensity*pe),Qe.castShadow){const gt=Qe.shadow,Ot=i.get(Qe);Ot.shadowBias=gt.bias,Ot.shadowNormalBias=gt.normalBias,Ot.shadowRadius=gt.radius,Ot.shadowMapSize=gt.mapSize,r.directionalShadow[k]=Ot,r.directionalShadowMap[k]=dt,r.directionalShadowMatrix[k]=Qe.shadow.matrix,X++}r.directional[k]=Ye,k++}else if(Qe.isSpotLight){const Ye=t.get(Qe);Ye.position.setFromMatrixPosition(Qe.matrixWorld),Ye.color.copy(Ge).multiplyScalar(ft*pe),Ye.distance=qe,Ye.coneCos=Math.cos(Qe.angle),Ye.penumbraCos=Math.cos(Qe.angle*(1-Qe.penumbra)),Ye.decay=Qe.decay,r.spot[G]=Ye;const gt=Qe.shadow;if(Qe.map&&(r.spotLightMap[Ee]=Qe.map,Ee++,gt.updateMatrices(Qe),Qe.castShadow&&J++),r.spotLightMatrix[G]=gt.matrix,Qe.castShadow){const Ot=i.get(Qe);Ot.shadowBias=gt.bias,Ot.shadowNormalBias=gt.normalBias,Ot.shadowRadius=gt.radius,Ot.shadowMapSize=gt.mapSize,r.spotShadow[G]=Ot,r.spotShadowMap[G]=dt,ae++}G++}else if(Qe.isRectAreaLight){const Ye=t.get(Qe);Ye.color.copy(Ge).multiplyScalar(ft),Ye.halfWidth.set(.5*Qe.width,0,0),Ye.halfHeight.set(0,.5*Qe.height,0),r.rectArea[W]=Ye,W++}else if(Qe.isPointLight){const Ye=t.get(Qe);if(Ye.color.copy(Qe.color).multiplyScalar(Qe.intensity*pe),Ye.distance=Qe.distance,Ye.decay=Qe.decay,Qe.castShadow){const gt=Qe.shadow,Ot=i.get(Qe);Ot.shadowBias=gt.bias,Ot.shadowNormalBias=gt.normalBias,Ot.shadowRadius=gt.radius,Ot.shadowMapSize=gt.mapSize,Ot.shadowCameraNear=gt.camera.near,Ot.shadowCameraFar=gt.camera.far,r.pointShadow[F]=Ot,r.pointShadowMap[F]=dt,r.pointShadowMatrix[F]=Qe.shadow.matrix,ee++}r.point[F]=Ye,F++}else if(Qe.isHemisphereLight){const Ye=t.get(Qe);Ye.skyColor.copy(Qe.color).multiplyScalar(ft*pe),Ye.groundColor.copy(Qe.groundColor).multiplyScalar(ft*pe),r.hemi[V]=Ye,V++}}W>0&&(e.isWebGL2||!0===n.has("OES_texture_float_linear")?(r.rectAreaLTC1=fn.LTC_FLOAT_1,r.rectAreaLTC2=fn.LTC_FLOAT_2):!0===n.has("OES_texture_half_float_linear")?(r.rectAreaLTC1=fn.LTC_HALF_1,r.rectAreaLTC2=fn.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),r.ambient[0]=T,r.ambient[1]=I,r.ambient[2]=R;const Oe=r.hash;(Oe.directionalLength!==k||Oe.pointLength!==F||Oe.spotLength!==G||Oe.rectAreaLength!==W||Oe.hemiLength!==V||Oe.numDirectionalShadows!==X||Oe.numPointShadows!==ee||Oe.numSpotShadows!==ae||Oe.numSpotMaps!==Ee)&&(r.directional.length=k,r.spot.length=G,r.rectArea.length=W,r.point.length=F,r.hemi.length=V,r.directionalShadow.length=X,r.directionalShadowMap.length=X,r.pointShadow.length=ee,r.pointShadowMap.length=ee,r.spotShadow.length=ae,r.spotShadowMap.length=ae,r.directionalShadowMatrix.length=X,r.pointShadowMatrix.length=ee,r.spotLightMatrix.length=ae+Ee-J,r.spotLightMap.length=Ee,r.numSpotLightShadowsWithMaps=J,Oe.directionalLength=k,Oe.pointLength=F,Oe.spotLength=G,Oe.rectAreaLength=W,Oe.hemiLength=V,Oe.numDirectionalShadows=X,Oe.numPointShadows=ee,Oe.numSpotShadows=ae,Oe.numSpotMaps=Ee,r.version=Cie++)},setupView:function y(w,S){let T=0,I=0,R=0,k=0,F=0;const G=S.matrixWorldInverse;for(let W=0,V=w.length;W<V;W++){const X=w[W];if(X.isDirectionalLight){const ee=r.directional[T];ee.direction.setFromMatrixPosition(X.matrixWorld),s.setFromMatrixPosition(X.target.matrixWorld),ee.direction.sub(s),ee.direction.transformDirection(G),T++}else if(X.isSpotLight){const ee=r.spot[R];ee.position.setFromMatrixPosition(X.matrixWorld),ee.position.applyMatrix4(G),ee.direction.setFromMatrixPosition(X.matrixWorld),s.setFromMatrixPosition(X.target.matrixWorld),ee.direction.sub(s),ee.direction.transformDirection(G),R++}else if(X.isRectAreaLight){const ee=r.rectArea[k];ee.position.setFromMatrixPosition(X.matrixWorld),ee.position.applyMatrix4(G),d.identity(),c.copy(X.matrixWorld),c.premultiply(G),d.extractRotation(c),ee.halfWidth.set(.5*X.width,0,0),ee.halfHeight.set(0,.5*X.height,0),ee.halfWidth.applyMatrix4(d),ee.halfHeight.applyMatrix4(d),k++}else if(X.isPointLight){const ee=r.point[I];ee.position.setFromMatrixPosition(X.matrixWorld),ee.position.applyMatrix4(G),I++}else if(X.isHemisphereLight){const ee=r.hemi[F];ee.direction.setFromMatrixPosition(X.matrixWorld),ee.direction.transformDirection(G),F++}}},state:r}}function c4(n,e){const t=new Eie(n,e),i=[],r=[];return{init:function s(){i.length=0,r.length=0},state:{lightsArray:i,shadowsArray:r,lights:t},setupLights:function m(S){t.setup(i,S)},setupLightsView:function y(S){t.setupView(i,S)},pushLight:function c(S){i.push(S)},pushShadow:function d(S){r.push(S)}}}function Tie(n,e){let t=new WeakMap;return{get:function i(s,c=0){const d=t.get(s);let m;return void 0===d?(m=new c4(n,e),t.set(s,[m])):c>=d.length?(m=new c4(n,e),d.push(m)):m=d[c],m},dispose:function r(){t=new WeakMap}}}class u4 extends rh{constructor(e){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=3200,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(e)}copy(e){return super.copy(e),this.depthPacking=e.depthPacking,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}}class d4 extends rh{constructor(e){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.referencePosition=new _e,this.nearDistance=1,this.farDistance=1e3,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(e)}copy(e){return super.copy(e),this.referencePosition.copy(e.referencePosition),this.nearDistance=e.nearDistance,this.farDistance=e.farDistance,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}}function Iie(n,e,t){let i=new L2;const r=new Pt,s=new Pt,c=new Qr,d=new u4({depthPacking:3201}),m=new d4,y={},w=t.maxTextureSize,S={0:1,1:0,2:2},T=new ym({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new Pt},radius:{value:4}},vertexShader:"void main() {\n\tgl_Position = vec4( position, 1.0 );\n}",fragmentShader:"uniform sampler2D shadow_pass;\nuniform vec2 resolution;\nuniform float radius;\n#include <packing>\nvoid main() {\n\tconst float samples = float( VSM_SAMPLES );\n\tfloat mean = 0.0;\n\tfloat squared_mean = 0.0;\n\tfloat uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );\n\tfloat uvStart = samples <= 1.0 ? 0.0 : - 1.0;\n\tfor ( float i = 0.0; i < samples; i ++ ) {\n\t\tfloat uvOffset = uvStart + i * uvStride;\n\t\t#ifdef HORIZONTAL_PASS\n\t\t\tvec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );\n\t\t\tmean += distribution.x;\n\t\t\tsquared_mean += distribution.y * distribution.y + distribution.x * distribution.x;\n\t\t#else\n\t\t\tfloat depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );\n\t\t\tmean += depth;\n\t\t\tsquared_mean += depth * depth;\n\t\t#endif\n\t}\n\tmean = mean / samples;\n\tsquared_mean = squared_mean / samples;\n\tfloat std_dev = sqrt( squared_mean - mean * mean );\n\tgl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );\n}"}),I=T.clone();I.defines.HORIZONTAL_PASS=1;const R=new Wi;R.setAttribute("position",new sa(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const k=new Ka(R,T),F=this;function G(X,ee){const ae=e.update(k);T.defines.VSM_SAMPLES!==X.blurSamples&&(T.defines.VSM_SAMPLES=X.blurSamples,I.defines.VSM_SAMPLES=X.blurSamples,T.needsUpdate=!0,I.needsUpdate=!0),null===X.mapPass&&(X.mapPass=new Jg(r.x,r.y)),T.uniforms.shadow_pass.value=X.map.texture,T.uniforms.resolution.value=X.mapSize,T.uniforms.radius.value=X.radius,n.setRenderTarget(X.mapPass),n.clear(),n.renderBufferDirect(ee,null,ae,T,k,null),I.uniforms.shadow_pass.value=X.mapPass.texture,I.uniforms.resolution.value=X.mapSize,I.uniforms.radius.value=X.radius,n.setRenderTarget(X.map),n.clear(),n.renderBufferDirect(ee,null,ae,I,k,null)}function W(X,ee,ae,Ee,J,pe){let Oe=null;const st=!0===ae.isPointLight?X.customDistanceMaterial:X.customDepthMaterial;if(void 0!==st)Oe=st;else if(Oe=!0===ae.isPointLight?m:d,n.localClippingEnabled&&!0===ee.clipShadows&&Array.isArray(ee.clippingPlanes)&&0!==ee.clippingPlanes.length||ee.displacementMap&&0!==ee.displacementScale||ee.alphaMap&&ee.alphaTest>0||ee.map&&ee.alphaTest>0){const xt=Oe.uuid,Qe=ee.uuid;let Ge=y[xt];void 0===Ge&&(Ge={},y[xt]=Ge);let ft=Ge[Qe];void 0===ft&&(ft=Oe.clone(),Ge[Qe]=ft),Oe=ft}return Oe.visible=ee.visible,Oe.wireframe=ee.wireframe,Oe.side=3===pe?null!==ee.shadowSide?ee.shadowSide:ee.side:null!==ee.shadowSide?ee.shadowSide:S[ee.side],Oe.alphaMap=ee.alphaMap,Oe.alphaTest=ee.alphaTest,Oe.map=ee.map,Oe.clipShadows=ee.clipShadows,Oe.clippingPlanes=ee.clippingPlanes,Oe.clipIntersection=ee.clipIntersection,Oe.displacementMap=ee.displacementMap,Oe.displacementScale=ee.displacementScale,Oe.displacementBias=ee.displacementBias,Oe.wireframeLinewidth=ee.wireframeLinewidth,Oe.linewidth=ee.linewidth,!0===ae.isPointLight&&!0===Oe.isMeshDistanceMaterial&&(Oe.referencePosition.setFromMatrixPosition(ae.matrixWorld),Oe.nearDistance=Ee,Oe.farDistance=J),Oe}function V(X,ee,ae,Ee,J){if(!1===X.visible)return;if(X.layers.test(ee.layers)&&(X.isMesh||X.isLine||X.isPoints)&&(X.castShadow||X.receiveShadow&&3===J)&&(!X.frustumCulled||i.intersectsObject(X))){X.modelViewMatrix.multiplyMatrices(ae.matrixWorldInverse,X.matrixWorld);const st=e.update(X),xt=X.material;if(Array.isArray(xt)){const Qe=st.groups;for(let Ge=0,ft=Qe.length;Ge<ft;Ge++){const qe=Qe[Ge],dt=xt[qe.materialIndex];if(dt&&dt.visible){const Ye=W(X,dt,Ee,ae.near,ae.far,J);n.renderBufferDirect(ae,null,st,Ye,X,qe)}}}else if(xt.visible){const Qe=W(X,xt,Ee,ae.near,ae.far,J);n.renderBufferDirect(ae,null,st,Qe,X,null)}}const Oe=X.children;for(let st=0,xt=Oe.length;st<xt;st++)V(Oe[st],ee,ae,Ee,J)}this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=1,this.render=function(X,ee,ae){if(!1===F.enabled||!1===F.autoUpdate&&!1===F.needsUpdate||0===X.length)return;const Ee=n.getRenderTarget(),J=n.getActiveCubeFace(),pe=n.getActiveMipmapLevel(),Oe=n.state;Oe.setBlending(0),Oe.buffers.color.setClear(1,1,1,1),Oe.buffers.depth.setTest(!0),Oe.setScissorTest(!1);for(let st=0,xt=X.length;st<xt;st++){const Qe=X[st],Ge=Qe.shadow;if(void 0===Ge){console.warn("THREE.WebGLShadowMap:",Qe,"has no shadow.");continue}if(!1===Ge.autoUpdate&&!1===Ge.needsUpdate)continue;r.copy(Ge.mapSize);const ft=Ge.getFrameExtents();r.multiply(ft),s.copy(Ge.mapSize),(r.x>w||r.y>w)&&(r.x>w&&(s.x=Math.floor(w/ft.x),r.x=s.x*ft.x,Ge.mapSize.x=s.x),r.y>w&&(s.y=Math.floor(w/ft.y),r.y=s.y*ft.y,Ge.mapSize.y=s.y)),null===Ge.map&&(Ge.map=new Jg(r.x,r.y,3!==this.type?{minFilter:So,magFilter:So}:{}),Ge.map.texture.name=Qe.name+".shadowMap",Ge.camera.updateProjectionMatrix()),n.setRenderTarget(Ge.map),n.clear();const qe=Ge.getViewportCount();for(let dt=0;dt<qe;dt++){const Ye=Ge.getViewport(dt);c.set(s.x*Ye.x,s.y*Ye.y,s.x*Ye.z,s.y*Ye.w),Oe.viewport(c),Ge.updateMatrices(Qe,dt),i=Ge.getFrustum(),V(ee,ae,Ge.camera,Qe,this.type)}!0!==Ge.isPointLightShadow&&3===this.type&&G(Ge,ae),Ge.needsUpdate=!1}F.needsUpdate=!1,n.setRenderTarget(Ee,J,pe)}}function Pie(n,e,t){const i=t.isWebGL2,d=new function r(){let He=!1;const Ct=new Qr;let Qt=null;const Ln=new Qr(0,0,0,0);return{setMask:function(Wn){Qt!==Wn&&!He&&(n.colorMask(Wn,Wn,Wn,Wn),Qt=Wn)},setLocked:function(Wn){He=Wn},setClear:function(Wn,bs,aa,Tl,uh){!0===uh&&(Wn*=Tl,bs*=Tl,aa*=Tl),Ct.set(Wn,bs,aa,Tl),!1===Ln.equals(Ct)&&(n.clearColor(Wn,bs,aa,Tl),Ln.copy(Ct))},reset:function(){He=!1,Qt=null,Ln.set(-1,0,0,0)}}},m=new function s(){let He=!1,Ct=null,Qt=null,Ln=null;return{setTest:function(Wn){Wn?en(2929):xn(2929)},setMask:function(Wn){Ct!==Wn&&!He&&(n.depthMask(Wn),Ct=Wn)},setFunc:function(Wn){if(Qt!==Wn){switch(Wn){case 0:n.depthFunc(512);break;case 1:n.depthFunc(519);break;case 2:n.depthFunc(513);break;case 3:default:n.depthFunc(515);break;case 4:n.depthFunc(514);break;case 5:n.depthFunc(518);break;case 6:n.depthFunc(516);break;case 7:n.depthFunc(517)}Qt=Wn}},setLocked:function(Wn){He=Wn},setClear:function(Wn){Ln!==Wn&&(n.clearDepth(Wn),Ln=Wn)},reset:function(){He=!1,Ct=null,Qt=null,Ln=null}}},y=new function c(){let He=!1,Ct=null,Qt=null,Ln=null,Wn=null,bs=null,aa=null,Tl=null,uh=null;return{setTest:function(io){He||(io?en(2960):xn(2960))},setMask:function(io){Ct!==io&&!He&&(n.stencilMask(io),Ct=io)},setFunc:function(io,vu,dh){(Qt!==io||Ln!==vu||Wn!==dh)&&(n.stencilFunc(io,vu,dh),Qt=io,Ln=vu,Wn=dh)},setOp:function(io,vu,dh){(bs!==io||aa!==vu||Tl!==dh)&&(n.stencilOp(io,vu,dh),bs=io,aa=vu,Tl=dh)},setLocked:function(io){He=io},setClear:function(io){uh!==io&&(n.clearStencil(io),uh=io)},reset:function(){He=!1,Ct=null,Qt=null,Ln=null,Wn=null,bs=null,aa=null,Tl=null,uh=null}}},w=new WeakMap,S=new WeakMap;let T={},I={},R=new WeakMap,k=[],F=null,G=!1,W=null,V=null,X=null,ee=null,ae=null,Ee=null,J=null,pe=!1,Oe=null,st=null,xt=null,Qe=null,Ge=null;const ft=n.getParameter(35661);let qe=!1,dt=0;const Ye=n.getParameter(7938);-1!==Ye.indexOf("WebGL")?(dt=parseFloat(/^WebGL (\d)/.exec(Ye)[1]),qe=dt>=1):-1!==Ye.indexOf("OpenGL ES")&&(dt=parseFloat(/^OpenGL ES (\d)/.exec(Ye)[1]),qe=dt>=2);let gt=null,Ot={};const pn=n.getParameter(3088),at=n.getParameter(2978),Ut=(new Qr).fromArray(pn),zt=(new Qr).fromArray(at);function nt(He,Ct,Qt){const Ln=new Uint8Array(4),Wn=n.createTexture();n.bindTexture(He,Wn),n.texParameteri(He,10241,9728),n.texParameteri(He,10240,9728);for(let bs=0;bs<Qt;bs++)n.texImage2D(Ct+bs,0,6408,1,1,0,6408,5121,Ln);return Wn}const In={};function en(He){!0!==T[He]&&(n.enable(He),T[He]=!0)}function xn(He){!1!==T[He]&&(n.disable(He),T[He]=!1)}In[3553]=nt(3553,3553,1),In[34067]=nt(34067,34069,6),d.setClear(0,0,0,1),m.setClear(1),y.setClear(0),en(2929),m.setFunc(3),_n(!1),xi(1),en(2884),cn(0);const Nt={100:32774,101:32778,102:32779};if(i)Nt[103]=32775,Nt[104]=32776;else{const He=e.get("EXT_blend_minmax");null!==He&&(Nt[103]=He.MIN_EXT,Nt[104]=He.MAX_EXT)}const Wt={200:0,201:1,202:768,204:770,210:776,208:774,206:772,203:769,205:771,209:775,207:773};function cn(He,Ct,Qt,Ln,Wn,bs,aa,Tl){if(0!==He){if(!1===G&&(en(3042),G=!0),5===He)Wn=Wn||Ct,bs=bs||Qt,aa=aa||Ln,(Ct!==V||Wn!==ae)&&(n.blendEquationSeparate(Nt[Ct],Nt[Wn]),V=Ct,ae=Wn),(Qt!==X||Ln!==ee||bs!==Ee||aa!==J)&&(n.blendFuncSeparate(Wt[Qt],Wt[Ln],Wt[bs],Wt[aa]),X=Qt,ee=Ln,Ee=bs,J=aa),W=He,pe=!1;else if(He!==W||Tl!==pe){if((100!==V||100!==ae)&&(n.blendEquation(32774),V=100,ae=100),Tl)switch(He){case 1:n.blendFuncSeparate(1,771,1,771);break;case 2:n.blendFunc(1,1);break;case 3:n.blendFuncSeparate(0,769,0,1);break;case 4:n.blendFuncSeparate(0,768,0,770);break;default:console.error("THREE.WebGLState: Invalid blending: ",He)}else switch(He){case 1:n.blendFuncSeparate(770,771,1,771);break;case 2:n.blendFunc(770,1);break;case 3:n.blendFuncSeparate(0,769,0,1);break;case 4:n.blendFunc(0,768);break;default:console.error("THREE.WebGLState: Invalid blending: ",He)}X=null,ee=null,Ee=null,J=null,W=He,pe=Tl}}else!0===G&&(xn(3042),G=!1)}function _n(He){Oe!==He&&(n.frontFace(He?2304:2305),Oe=He)}function xi(He){0!==He?(en(2884),He!==st&&n.cullFace(1===He?1029:2===He?1028:1032)):xn(2884),st=He}function bi(He,Ct,Qt){He?(en(32823),(Qe!==Ct||Ge!==Qt)&&(n.polygonOffset(Ct,Qt),Qe=Ct,Ge=Qt)):xn(32823)}return{buffers:{color:d,depth:m,stencil:y},enable:en,disable:xn,bindFramebuffer:function gn(He,Ct){return I[He]!==Ct&&(n.bindFramebuffer(He,Ct),I[He]=Ct,i&&(36009===He&&(I[36160]=Ct),36160===He&&(I[36009]=Ct)),!0)},drawBuffers:function On(He,Ct){let Qt=k,Ln=!1;if(He)if(Qt=R.get(Ct),void 0===Qt&&(Qt=[],R.set(Ct,Qt)),He.isWebGLMultipleRenderTargets){const Wn=He.texture;if(Qt.length!==Wn.length||36064!==Qt[0]){for(let bs=0,aa=Wn.length;bs<aa;bs++)Qt[bs]=36064+bs;Qt.length=Wn.length,Ln=!0}}else 36064!==Qt[0]&&(Qt[0]=36064,Ln=!0);else 1029!==Qt[0]&&(Qt[0]=1029,Ln=!0);Ln&&(t.isWebGL2?n.drawBuffers(Qt):e.get("WEBGL_draw_buffers").drawBuffersWEBGL(Qt))},useProgram:function ii(He){return F!==He&&(n.useProgram(He),F=He,!0)},setBlending:cn,setMaterial:function $n(He,Ct){2===He.side?xn(2884):en(2884);let Qt=1===He.side;Ct&&(Qt=!Qt),_n(Qt),1===He.blending&&!1===He.transparent?cn(0):cn(He.blending,He.blendEquation,He.blendSrc,He.blendDst,He.blendEquationAlpha,He.blendSrcAlpha,He.blendDstAlpha,He.premultipliedAlpha),m.setFunc(He.depthFunc),m.setTest(He.depthTest),m.setMask(He.depthWrite),d.setMask(He.colorWrite);const Ln=He.stencilWrite;y.setTest(Ln),Ln&&(y.setMask(He.stencilWriteMask),y.setFunc(He.stencilFunc,He.stencilRef,He.stencilFuncMask),y.setOp(He.stencilFail,He.stencilZFail,He.stencilZPass)),bi(He.polygonOffset,He.polygonOffsetFactor,He.polygonOffsetUnits),!0===He.alphaToCoverage?en(32926):xn(32926)},setFlipSided:_n,setCullFace:xi,setLineWidth:function ri(He){He!==xt&&(qe&&n.lineWidth(He),xt=He)},setPolygonOffset:bi,setScissorTest:function qr(He){He?en(3089):xn(3089)},activeTexture:function Ar(He){void 0===He&&(He=33984+ft-1),gt!==He&&(n.activeTexture(He),gt=He)},bindTexture:function we(He,Ct,Qt){void 0===Qt&&(Qt=null===gt?33984+ft-1:gt);let Ln=Ot[Qt];void 0===Ln&&(Ln={type:void 0,texture:void 0},Ot[Qt]=Ln),(Ln.type!==He||Ln.texture!==Ct)&&(gt!==Qt&&(n.activeTexture(Qt),gt=Qt),n.bindTexture(He,Ct||In[He]),Ln.type=He,Ln.texture=Ct)},unbindTexture:function de(){const He=Ot[gt];void 0!==He&&void 0!==He.type&&(n.bindTexture(He.type,null),He.type=void 0,He.texture=void 0)},compressedTexImage2D:function vt(){try{n.compressedTexImage2D.apply(n,arguments)}catch(He){console.error("THREE.WebGLState:",He)}},compressedTexImage3D:function rn(){try{n.compressedTexImage3D.apply(n,arguments)}catch(He){console.error("THREE.WebGLState:",He)}},texImage2D:function yn(){try{n.texImage2D.apply(n,arguments)}catch(He){console.error("THREE.WebGLState:",He)}},texImage3D:function Zn(){try{n.texImage3D.apply(n,arguments)}catch(He){console.error("THREE.WebGLState:",He)}},updateUBOMapping:function _r(He,Ct){let Qt=S.get(Ct);void 0===Qt&&(Qt=new WeakMap,S.set(Ct,Qt));let Ln=Qt.get(He);void 0===Ln&&(Ln=n.getUniformBlockIndex(Ct,He.name),Qt.set(He,Ln))},uniformBlockBinding:function Ir(He,Ct){const Ln=S.get(Ct).get(He);w.get(Ct)!==Ln&&(n.uniformBlockBinding(Ct,Ln,He.__bindingPointIndex),w.set(Ct,Ln))},texStorage2D:function et(){try{n.texStorage2D.apply(n,arguments)}catch(He){console.error("THREE.WebGLState:",He)}},texStorage3D:function En(){try{n.texStorage3D.apply(n,arguments)}catch(He){console.error("THREE.WebGLState:",He)}},texSubImage2D:function sn(){try{n.texSubImage2D.apply(n,arguments)}catch(He){console.error("THREE.WebGLState:",He)}},texSubImage3D:function wn(){try{n.texSubImage3D.apply(n,arguments)}catch(He){console.error("THREE.WebGLState:",He)}},compressedTexSubImage2D:function Yn(){try{n.compressedTexSubImage2D.apply(n,arguments)}catch(He){console.error("THREE.WebGLState:",He)}},compressedTexSubImage3D:function ke(){try{n.compressedTexSubImage3D.apply(n,arguments)}catch(He){console.error("THREE.WebGLState:",He)}},scissor:function Jn(He){!1===Ut.equals(He)&&(n.scissor(He.x,He.y,He.z,He.w),Ut.copy(He))},viewport:function Kn(He){!1===zt.equals(He)&&(n.viewport(He.x,He.y,He.z,He.w),zt.copy(He))},reset:function Jr(){n.disable(3042),n.disable(2884),n.disable(2929),n.disable(32823),n.disable(3089),n.disable(2960),n.disable(32926),n.blendEquation(32774),n.blendFunc(1,0),n.blendFuncSeparate(1,0,1,0),n.colorMask(!0,!0,!0,!0),n.clearColor(0,0,0,0),n.depthMask(!0),n.depthFunc(513),n.clearDepth(1),n.stencilMask(4294967295),n.stencilFunc(519,0,4294967295),n.stencilOp(7680,7680,7680),n.clearStencil(0),n.cullFace(1029),n.frontFace(2305),n.polygonOffset(0,0),n.activeTexture(33984),n.bindFramebuffer(36160,null),!0===i&&(n.bindFramebuffer(36009,null),n.bindFramebuffer(36008,null)),n.useProgram(null),n.lineWidth(1),n.scissor(0,0,n.canvas.width,n.canvas.height),n.viewport(0,0,n.canvas.width,n.canvas.height),T={},gt=null,Ot={},I={},R=new WeakMap,k=[],F=null,G=!1,W=null,V=null,X=null,ee=null,ae=null,Ee=null,J=null,pe=!1,Oe=null,st=null,xt=null,Qe=null,Ge=null,Ut.set(0,0,n.canvas.width,n.canvas.height),zt.set(0,0,n.canvas.width,n.canvas.height),d.reset(),m.reset(),y.reset()}}}function Rie(n,e,t,i,r,s,c){const d=r.isWebGL2,m=r.maxTextures,y=r.maxCubemapSize,w=r.maxTextureSize,S=r.maxSamples,T=e.has("WEBGL_multisampled_render_to_texture")?e.get("WEBGL_multisampled_render_to_texture"):null,I=!(typeof navigator>"u")&&/OculusBrowser/g.test(navigator.userAgent),R=new WeakMap;let k;const F=new WeakMap;let G=!1;try{G=typeof OffscreenCanvas<"u"&&null!==new OffscreenCanvas(1,1).getContext("2d")}catch{}function W(we,de){return G?new OffscreenCanvas(we,de):pw("canvas")}function V(we,de,vt,rn){let sn=1;if((we.width>rn||we.height>rn)&&(sn=rn/Math.max(we.width,we.height)),sn<1||!0===de){if(typeof HTMLImageElement<"u"&&we instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&we instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&we instanceof ImageBitmap){const wn=de?_V:Math.floor,Yn=wn(sn*we.width),ke=wn(sn*we.height);void 0===k&&(k=W(Yn,ke));const et=vt?W(Yn,ke):k;return et.width=Yn,et.height=ke,et.getContext("2d").drawImage(we,0,0,Yn,ke),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+we.width+"x"+we.height+") to ("+Yn+"x"+ke+")."),et}return"data"in we&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+we.width+"x"+we.height+")."),we}return we}function X(we){return d2(we.width)&&d2(we.height)}function ae(we,de){return we.generateMipmaps&&de&&we.minFilter!==So&&we.minFilter!==Eo}function Ee(we){n.generateMipmap(we)}function J(we,de,vt,rn,sn=!1){if(!1===d)return de;if(null!==we){if(void 0!==n[we])return n[we];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+we+"'")}let wn=de;return 6403===de&&(5126===vt&&(wn=33326),5131===vt&&(wn=33325),5121===vt&&(wn=33321)),33319===de&&(5126===vt&&(wn=33328),5131===vt&&(wn=33327),5121===vt&&(wn=33323)),6408===de&&(5126===vt&&(wn=34836),5131===vt&&(wn=34842),5121===vt&&(wn=rn===vs&&!1===sn?35907:32856),32819===vt&&(wn=32854),32820===vt&&(wn=32855)),(33325===wn||33326===wn||33327===wn||33328===wn||34842===wn||34836===wn)&&e.get("EXT_color_buffer_float"),wn}function pe(we,de,vt){return!0===ae(we,vt)||we.isFramebufferTexture&&we.minFilter!==So&&we.minFilter!==Eo?Math.log2(Math.max(de.width,de.height))+1:void 0!==we.mipmaps&&we.mipmaps.length>0?we.mipmaps.length:we.isCompressedTexture&&Array.isArray(we.image)?de.mipmaps.length:1}function Oe(we){return we===So||1004===we||1005===we?9728:9729}function st(we){const de=we.target;de.removeEventListener("dispose",st),function Qe(we){const de=i.get(we);if(void 0===de.__webglInit)return;const vt=we.source,rn=F.get(vt);if(rn){const sn=rn[de.__cacheKey];sn.usedTimes--,0===sn.usedTimes&&Ge(we),0===Object.keys(rn).length&&F.delete(vt)}i.remove(we)}(de),de.isVideoTexture&&R.delete(de)}function xt(we){const de=we.target;de.removeEventListener("dispose",xt),function ft(we){const de=we.texture,vt=i.get(we),rn=i.get(de);if(void 0!==rn.__webglTexture&&(n.deleteTexture(rn.__webglTexture),c.memory.textures--),we.depthTexture&&we.depthTexture.dispose(),we.isWebGLCubeRenderTarget)for(let sn=0;sn<6;sn++)n.deleteFramebuffer(vt.__webglFramebuffer[sn]),vt.__webglDepthbuffer&&n.deleteRenderbuffer(vt.__webglDepthbuffer[sn]);else{if(n.deleteFramebuffer(vt.__webglFramebuffer),vt.__webglDepthbuffer&&n.deleteRenderbuffer(vt.__webglDepthbuffer),vt.__webglMultisampledFramebuffer&&n.deleteFramebuffer(vt.__webglMultisampledFramebuffer),vt.__webglColorRenderbuffer)for(let sn=0;sn<vt.__webglColorRenderbuffer.length;sn++)vt.__webglColorRenderbuffer[sn]&&n.deleteRenderbuffer(vt.__webglColorRenderbuffer[sn]);vt.__webglDepthRenderbuffer&&n.deleteRenderbuffer(vt.__webglDepthRenderbuffer)}if(we.isWebGLMultipleRenderTargets)for(let sn=0,wn=de.length;sn<wn;sn++){const Yn=i.get(de[sn]);Yn.__webglTexture&&(n.deleteTexture(Yn.__webglTexture),c.memory.textures--),i.remove(de[sn])}i.remove(de),i.remove(we)}(de)}function Ge(we){const de=i.get(we);n.deleteTexture(de.__webglTexture),delete F.get(we.source)[de.__cacheKey],c.memory.textures--}let qe=0;function Ot(we,de){const vt=i.get(we);if(we.isVideoTexture&&function qr(we){const de=c.render.frame;R.get(we)!==de&&(R.set(we,de),we.update())}(we),!1===we.isRenderTargetTexture&&we.version>0&&vt.__version!==we.version){const rn=we.image;if(null===rn)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else{if(!1!==rn.complete)return void xn(vt,we,de);console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete")}}t.bindTexture(3553,vt.__webglTexture,33984+de)}const zt={1e3:10497,[bl]:33071,1002:33648},nt={[So]:9728,1004:9984,1005:9986,[Eo]:9729,1007:9985,[$g]:9987};function In(we,de,vt){if(vt?(n.texParameteri(we,10242,zt[de.wrapS]),n.texParameteri(we,10243,zt[de.wrapT]),(32879===we||35866===we)&&n.texParameteri(we,32882,zt[de.wrapR]),n.texParameteri(we,10240,nt[de.magFilter]),n.texParameteri(we,10241,nt[de.minFilter])):(n.texParameteri(we,10242,33071),n.texParameteri(we,10243,33071),(32879===we||35866===we)&&n.texParameteri(we,32882,33071),(de.wrapS!==bl||de.wrapT!==bl)&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),n.texParameteri(we,10240,Oe(de.magFilter)),n.texParameteri(we,10241,Oe(de.minFilter)),de.minFilter!==So&&de.minFilter!==Eo&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),!0===e.has("EXT_texture_filter_anisotropic")){const rn=e.get("EXT_texture_filter_anisotropic");if(de.magFilter===So||1005!==de.minFilter&&de.minFilter!==$g||de.type===um&&!1===e.has("OES_texture_float_linear")||!1===d&&de.type===cw&&!1===e.has("OES_texture_half_float_linear"))return;(de.anisotropy>1||i.get(de).__currentAnisotropy)&&(n.texParameterf(we,rn.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(de.anisotropy,r.getMaxAnisotropy())),i.get(de).__currentAnisotropy=de.anisotropy)}}function en(we,de){let vt=!1;void 0===we.__webglInit&&(we.__webglInit=!0,de.addEventListener("dispose",st));const rn=de.source;let sn=F.get(rn);void 0===sn&&(sn={},F.set(rn,sn));const wn=function gt(we){const de=[];return de.push(we.wrapS),de.push(we.wrapT),de.push(we.wrapR||0),de.push(we.magFilter),de.push(we.minFilter),de.push(we.anisotropy),de.push(we.internalFormat),de.push(we.format),de.push(we.type),de.push(we.generateMipmaps),de.push(we.premultiplyAlpha),de.push(we.flipY),de.push(we.unpackAlignment),de.push(we.encoding),de.join()}(de);if(wn!==we.__cacheKey){void 0===sn[wn]&&(sn[wn]={texture:n.createTexture(),usedTimes:0},c.memory.textures++,vt=!0),sn[wn].usedTimes++;const Yn=sn[we.__cacheKey];void 0!==Yn&&(sn[we.__cacheKey].usedTimes--,0===Yn.usedTimes&&Ge(de)),we.__cacheKey=wn,we.__webglTexture=sn[wn].texture}return vt}function xn(we,de,vt){let rn=3553;(de.isDataArrayTexture||de.isCompressedArrayTexture)&&(rn=35866),de.isData3DTexture&&(rn=32879);const sn=en(we,de),wn=de.source;t.bindTexture(rn,we.__webglTexture,33984+vt);const Yn=i.get(wn);if(wn.version!==Yn.__version||!0===sn){t.activeTexture(33984+vt),n.pixelStorei(37440,de.flipY),n.pixelStorei(37441,de.premultiplyAlpha),n.pixelStorei(3317,de.unpackAlignment),n.pixelStorei(37443,0);const ke=function ee(we){return!d&&(we.wrapS!==bl||we.wrapT!==bl||we.minFilter!==So&&we.minFilter!==Eo)}(de)&&!1===X(de.image);let et=V(de.image,ke,!1,w);et=Ar(de,et);const En=X(et)||d,yn=s.convert(de.format,de.encoding);let Kn,Zn=s.convert(de.type),Jn=J(de.internalFormat,yn,Zn,de.encoding,de.isVideoTexture);In(rn,de,En);const _r=de.mipmaps,Ir=d&&!0!==de.isVideoTexture,Jr=void 0===Yn.__version||!0===sn,He=pe(de,et,En);if(de.isDepthTexture)Jn=6402,d?Jn=de.type===um?36012:de.type===qg?33190:de.type===Nv?35056:33189:de.type===um&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),de.format===Zg&&6402===Jn&&1012!==de.type&&de.type!==qg&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),de.type=qg,Zn=s.convert(de.type)),de.format===Bv&&6402===Jn&&(Jn=34041,de.type!==Nv&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),de.type=Nv,Zn=s.convert(de.type))),Jr&&(Ir?t.texStorage2D(3553,1,Jn,et.width,et.height):t.texImage2D(3553,0,Jn,et.width,et.height,0,yn,Zn,null));else if(de.isDataTexture)if(_r.length>0&&En){Ir&&Jr&&t.texStorage2D(3553,He,Jn,_r[0].width,_r[0].height);for(let Ct=0,Qt=_r.length;Ct<Qt;Ct++)Kn=_r[Ct],Ir?t.texSubImage2D(3553,Ct,0,0,Kn.width,Kn.height,yn,Zn,Kn.data):t.texImage2D(3553,Ct,Jn,Kn.width,Kn.height,0,yn,Zn,Kn.data);de.generateMipmaps=!1}else Ir?(Jr&&t.texStorage2D(3553,He,Jn,et.width,et.height),t.texSubImage2D(3553,0,0,0,et.width,et.height,yn,Zn,et.data)):t.texImage2D(3553,0,Jn,et.width,et.height,0,yn,Zn,et.data);else if(de.isCompressedTexture)if(de.isCompressedArrayTexture){Ir&&Jr&&t.texStorage3D(35866,He,Jn,_r[0].width,_r[0].height,et.depth);for(let Ct=0,Qt=_r.length;Ct<Qt;Ct++)Kn=_r[Ct],de.format!==pu?null!==yn?Ir?t.compressedTexSubImage3D(35866,Ct,0,0,0,Kn.width,Kn.height,et.depth,yn,Kn.data,0,0):t.compressedTexImage3D(35866,Ct,Jn,Kn.width,Kn.height,et.depth,0,Kn.data,0,0):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):Ir?t.texSubImage3D(35866,Ct,0,0,0,Kn.width,Kn.height,et.depth,yn,Zn,Kn.data):t.texImage3D(35866,Ct,Jn,Kn.width,Kn.height,et.depth,0,yn,Zn,Kn.data)}else{Ir&&Jr&&t.texStorage2D(3553,He,Jn,_r[0].width,_r[0].height);for(let Ct=0,Qt=_r.length;Ct<Qt;Ct++)Kn=_r[Ct],de.format!==pu?null!==yn?Ir?t.compressedTexSubImage2D(3553,Ct,0,0,Kn.width,Kn.height,yn,Kn.data):t.compressedTexImage2D(3553,Ct,Jn,Kn.width,Kn.height,0,Kn.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):Ir?t.texSubImage2D(3553,Ct,0,0,Kn.width,Kn.height,yn,Zn,Kn.data):t.texImage2D(3553,Ct,Jn,Kn.width,Kn.height,0,yn,Zn,Kn.data)}else if(de.isDataArrayTexture)Ir?(Jr&&t.texStorage3D(35866,He,Jn,et.width,et.height,et.depth),t.texSubImage3D(35866,0,0,0,0,et.width,et.height,et.depth,yn,Zn,et.data)):t.texImage3D(35866,0,Jn,et.width,et.height,et.depth,0,yn,Zn,et.data);else if(de.isData3DTexture)Ir?(Jr&&t.texStorage3D(32879,He,Jn,et.width,et.height,et.depth),t.texSubImage3D(32879,0,0,0,0,et.width,et.height,et.depth,yn,Zn,et.data)):t.texImage3D(32879,0,Jn,et.width,et.height,et.depth,0,yn,Zn,et.data);else if(de.isFramebufferTexture){if(Jr)if(Ir)t.texStorage2D(3553,He,Jn,et.width,et.height);else{let Ct=et.width,Qt=et.height;for(let Ln=0;Ln<He;Ln++)t.texImage2D(3553,Ln,Jn,Ct,Qt,0,yn,Zn,null),Ct>>=1,Qt>>=1}}else if(_r.length>0&&En){Ir&&Jr&&t.texStorage2D(3553,He,Jn,_r[0].width,_r[0].height);for(let Ct=0,Qt=_r.length;Ct<Qt;Ct++)Kn=_r[Ct],Ir?t.texSubImage2D(3553,Ct,0,0,yn,Zn,Kn):t.texImage2D(3553,Ct,Jn,yn,Zn,Kn);de.generateMipmaps=!1}else Ir?(Jr&&t.texStorage2D(3553,He,Jn,et.width,et.height),t.texSubImage2D(3553,0,0,0,yn,Zn,et)):t.texImage2D(3553,0,Jn,yn,Zn,et);ae(de,En)&&Ee(rn),Yn.__version=wn.version,de.onUpdate&&de.onUpdate(de)}we.__version=de.version}function On(we,de,vt,rn,sn){const wn=s.convert(vt.format,vt.encoding),Yn=s.convert(vt.type),ke=J(vt.internalFormat,wn,Yn,vt.encoding);i.get(de).__hasExternalTextures||(32879===sn||35866===sn?t.texImage3D(sn,0,ke,de.width,de.height,de.depth,0,wn,Yn,null):t.texImage2D(sn,0,ke,de.width,de.height,0,wn,Yn,null)),t.bindFramebuffer(36160,we),bi(de)?T.framebufferTexture2DMultisampleEXT(36160,rn,sn,i.get(vt).__webglTexture,0,ri(de)):(3553===sn||sn>=34069&&sn<=34074)&&n.framebufferTexture2D(36160,rn,sn,i.get(vt).__webglTexture,0),t.bindFramebuffer(36160,null)}function ii(we,de,vt){if(n.bindRenderbuffer(36161,we),de.depthBuffer&&!de.stencilBuffer){let rn=33189;if(vt||bi(de)){const sn=de.depthTexture;sn&&sn.isDepthTexture&&(sn.type===um?rn=36012:sn.type===qg&&(rn=33190));const wn=ri(de);bi(de)?T.renderbufferStorageMultisampleEXT(36161,wn,rn,de.width,de.height):n.renderbufferStorageMultisample(36161,wn,rn,de.width,de.height)}else n.renderbufferStorage(36161,rn,de.width,de.height);n.framebufferRenderbuffer(36160,36096,36161,we)}else if(de.depthBuffer&&de.stencilBuffer){const rn=ri(de);vt&&!1===bi(de)?n.renderbufferStorageMultisample(36161,rn,35056,de.width,de.height):bi(de)?T.renderbufferStorageMultisampleEXT(36161,rn,35056,de.width,de.height):n.renderbufferStorage(36161,34041,de.width,de.height),n.framebufferRenderbuffer(36160,33306,36161,we)}else{const rn=!0===de.isWebGLMultipleRenderTargets?de.texture:[de.texture];for(let sn=0;sn<rn.length;sn++){const wn=rn[sn],Yn=s.convert(wn.format,wn.encoding),ke=s.convert(wn.type),et=J(wn.internalFormat,Yn,ke,wn.encoding),En=ri(de);vt&&!1===bi(de)?n.renderbufferStorageMultisample(36161,En,et,de.width,de.height):bi(de)?T.renderbufferStorageMultisampleEXT(36161,En,et,de.width,de.height):n.renderbufferStorage(36161,et,de.width,de.height)}}n.bindRenderbuffer(36161,null)}function Wt(we){const de=i.get(we),vt=!0===we.isWebGLCubeRenderTarget;if(we.depthTexture&&!de.__autoAllocateDepthBuffer){if(vt)throw new Error("target.depthTexture not supported in Cube render targets");!function Nt(we,de){if(de&&de.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(t.bindFramebuffer(36160,we),!de.depthTexture||!de.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");(!i.get(de.depthTexture).__webglTexture||de.depthTexture.image.width!==de.width||de.depthTexture.image.height!==de.height)&&(de.depthTexture.image.width=de.width,de.depthTexture.image.height=de.height,de.depthTexture.needsUpdate=!0),Ot(de.depthTexture,0);const rn=i.get(de.depthTexture).__webglTexture,sn=ri(de);if(de.depthTexture.format===Zg)bi(de)?T.framebufferTexture2DMultisampleEXT(36160,36096,3553,rn,0,sn):n.framebufferTexture2D(36160,36096,3553,rn,0);else{if(de.depthTexture.format!==Bv)throw new Error("Unknown depthTexture format");bi(de)?T.framebufferTexture2DMultisampleEXT(36160,33306,3553,rn,0,sn):n.framebufferTexture2D(36160,33306,3553,rn,0)}}(de.__webglFramebuffer,we)}else if(vt){de.__webglDepthbuffer=[];for(let rn=0;rn<6;rn++)t.bindFramebuffer(36160,de.__webglFramebuffer[rn]),de.__webglDepthbuffer[rn]=n.createRenderbuffer(),ii(de.__webglDepthbuffer[rn],we,!1)}else t.bindFramebuffer(36160,de.__webglFramebuffer),de.__webglDepthbuffer=n.createRenderbuffer(),ii(de.__webglDepthbuffer,we,!1);t.bindFramebuffer(36160,null)}function ri(we){return Math.min(S,we.samples)}function bi(we){const de=i.get(we);return d&&we.samples>0&&!0===e.has("WEBGL_multisampled_render_to_texture")&&!1!==de.__useRenderToTexture}function Ar(we,de){const vt=we.encoding,rn=we.format,sn=we.type;return!0===we.isCompressedTexture||!0===we.isVideoTexture||1035===we.format||vt!==Xg&&(vt===vs?!1===d?!0===e.has("EXT_sRGB")&&rn===pu?(we.format=1035,we.minFilter=Eo,we.generateMipmaps=!1):de=xV.sRGBToLinear(de):(rn!==pu||sn!==Wg)&&console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture encoding:",vt)),de}this.allocateTextureUnit=function Ye(){const we=qe;return we>=m&&console.warn("THREE.WebGLTextures: Trying to use "+we+" texture units while this GPU supports only "+m),qe+=1,we},this.resetTextureUnits=function dt(){qe=0},this.setTexture2D=Ot,this.setTexture2DArray=function pn(we,de){const vt=i.get(we);we.version>0&&vt.__version!==we.version?xn(vt,we,de):t.bindTexture(35866,vt.__webglTexture,33984+de)},this.setTexture3D=function at(we,de){const vt=i.get(we);we.version>0&&vt.__version!==we.version?xn(vt,we,de):t.bindTexture(32879,vt.__webglTexture,33984+de)},this.setTextureCube=function Ut(we,de){const vt=i.get(we);we.version>0&&vt.__version!==we.version?function gn(we,de,vt){if(6!==de.image.length)return;const rn=en(we,de),sn=de.source;t.bindTexture(34067,we.__webglTexture,33984+vt);const wn=i.get(sn);if(sn.version!==wn.__version||!0===rn){t.activeTexture(33984+vt),n.pixelStorei(37440,de.flipY),n.pixelStorei(37441,de.premultiplyAlpha),n.pixelStorei(3317,de.unpackAlignment),n.pixelStorei(37443,0);const Yn=de.isCompressedTexture||de.image[0].isCompressedTexture,ke=de.image[0]&&de.image[0].isDataTexture,et=[];for(let Ct=0;Ct<6;Ct++)et[Ct]=Yn||ke?ke?de.image[Ct].image:de.image[Ct]:V(de.image[Ct],!1,!0,y),et[Ct]=Ar(de,et[Ct]);const En=et[0],yn=X(En)||d,Zn=s.convert(de.format,de.encoding),Jn=s.convert(de.type),Kn=J(de.internalFormat,Zn,Jn,de.encoding),_r=d&&!0!==de.isVideoTexture,Ir=void 0===wn.__version||!0===rn;let He,Jr=pe(de,En,yn);if(In(34067,de,yn),Yn){_r&&Ir&&t.texStorage2D(34067,Jr,Kn,En.width,En.height);for(let Ct=0;Ct<6;Ct++){He=et[Ct].mipmaps;for(let Qt=0;Qt<He.length;Qt++){const Ln=He[Qt];de.format!==pu?null!==Zn?_r?t.compressedTexSubImage2D(34069+Ct,Qt,0,0,Ln.width,Ln.height,Zn,Ln.data):t.compressedTexImage2D(34069+Ct,Qt,Kn,Ln.width,Ln.height,0,Ln.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):_r?t.texSubImage2D(34069+Ct,Qt,0,0,Ln.width,Ln.height,Zn,Jn,Ln.data):t.texImage2D(34069+Ct,Qt,Kn,Ln.width,Ln.height,0,Zn,Jn,Ln.data)}}}else{He=de.mipmaps,_r&&Ir&&(He.length>0&&Jr++,t.texStorage2D(34067,Jr,Kn,et[0].width,et[0].height));for(let Ct=0;Ct<6;Ct++)if(ke){_r?t.texSubImage2D(34069+Ct,0,0,0,et[Ct].width,et[Ct].height,Zn,Jn,et[Ct].data):t.texImage2D(34069+Ct,0,Kn,et[Ct].width,et[Ct].height,0,Zn,Jn,et[Ct].data);for(let Qt=0;Qt<He.length;Qt++){const Wn=He[Qt].image[Ct].image;_r?t.texSubImage2D(34069+Ct,Qt+1,0,0,Wn.width,Wn.height,Zn,Jn,Wn.data):t.texImage2D(34069+Ct,Qt+1,Kn,Wn.width,Wn.height,0,Zn,Jn,Wn.data)}}else{_r?t.texSubImage2D(34069+Ct,0,0,0,Zn,Jn,et[Ct]):t.texImage2D(34069+Ct,0,Kn,Zn,Jn,et[Ct]);for(let Qt=0;Qt<He.length;Qt++){const Ln=He[Qt];_r?t.texSubImage2D(34069+Ct,Qt+1,0,0,Zn,Jn,Ln.image[Ct]):t.texImage2D(34069+Ct,Qt+1,Kn,Zn,Jn,Ln.image[Ct])}}}ae(de,yn)&&Ee(34067),wn.__version=sn.version,de.onUpdate&&de.onUpdate(de)}we.__version=de.version}(vt,we,de):t.bindTexture(34067,vt.__webglTexture,33984+de)},this.rebindTextures=function cn(we,de,vt){const rn=i.get(we);void 0!==de&&On(rn.__webglFramebuffer,we,we.texture,36064,3553),void 0!==vt&&Wt(we)},this.setupRenderTarget=function $n(we){const de=we.texture,vt=i.get(we),rn=i.get(de);we.addEventListener("dispose",xt),!0!==we.isWebGLMultipleRenderTargets&&(void 0===rn.__webglTexture&&(rn.__webglTexture=n.createTexture()),rn.__version=de.version,c.memory.textures++);const sn=!0===we.isWebGLCubeRenderTarget,wn=!0===we.isWebGLMultipleRenderTargets,Yn=X(we)||d;if(sn){vt.__webglFramebuffer=[];for(let ke=0;ke<6;ke++)vt.__webglFramebuffer[ke]=n.createFramebuffer()}else{if(vt.__webglFramebuffer=n.createFramebuffer(),wn)if(r.drawBuffers){const ke=we.texture;for(let et=0,En=ke.length;et<En;et++){const yn=i.get(ke[et]);void 0===yn.__webglTexture&&(yn.__webglTexture=n.createTexture(),c.memory.textures++)}}else console.warn("THREE.WebGLRenderer: WebGLMultipleRenderTargets can only be used with WebGL2 or WEBGL_draw_buffers extension.");if(d&&we.samples>0&&!1===bi(we)){const ke=wn?de:[de];vt.__webglMultisampledFramebuffer=n.createFramebuffer(),vt.__webglColorRenderbuffer=[],t.bindFramebuffer(36160,vt.__webglMultisampledFramebuffer);for(let et=0;et<ke.length;et++){const En=ke[et];vt.__webglColorRenderbuffer[et]=n.createRenderbuffer(),n.bindRenderbuffer(36161,vt.__webglColorRenderbuffer[et]);const yn=s.convert(En.format,En.encoding),Zn=s.convert(En.type),Jn=J(En.internalFormat,yn,Zn,En.encoding,!0===we.isXRRenderTarget),Kn=ri(we);n.renderbufferStorageMultisample(36161,Kn,Jn,we.width,we.height),n.framebufferRenderbuffer(36160,36064+et,36161,vt.__webglColorRenderbuffer[et])}n.bindRenderbuffer(36161,null),we.depthBuffer&&(vt.__webglDepthRenderbuffer=n.createRenderbuffer(),ii(vt.__webglDepthRenderbuffer,we,!0)),t.bindFramebuffer(36160,null)}}if(sn){t.bindTexture(34067,rn.__webglTexture),In(34067,de,Yn);for(let ke=0;ke<6;ke++)On(vt.__webglFramebuffer[ke],we,de,36064,34069+ke);ae(de,Yn)&&Ee(34067),t.unbindTexture()}else if(wn){const ke=we.texture;for(let et=0,En=ke.length;et<En;et++){const yn=ke[et],Zn=i.get(yn);t.bindTexture(3553,Zn.__webglTexture),In(3553,yn,Yn),On(vt.__webglFramebuffer,we,yn,36064+et,3553),ae(yn,Yn)&&Ee(3553)}t.unbindTexture()}else{let ke=3553;(we.isWebGL3DRenderTarget||we.isWebGLArrayRenderTarget)&&(d?ke=we.isWebGL3DRenderTarget?32879:35866:console.error("THREE.WebGLTextures: THREE.Data3DTexture and THREE.DataArrayTexture only supported with WebGL2.")),t.bindTexture(ke,rn.__webglTexture),In(ke,de,Yn),On(vt.__webglFramebuffer,we,de,36064,ke),ae(de,Yn)&&Ee(ke),t.unbindTexture()}we.depthBuffer&&Wt(we)},this.updateRenderTargetMipmap=function _n(we){const de=X(we)||d,vt=!0===we.isWebGLMultipleRenderTargets?we.texture:[we.texture];for(let rn=0,sn=vt.length;rn<sn;rn++){const wn=vt[rn];if(ae(wn,de)){const Yn=we.isWebGLCubeRenderTarget?34067:3553,ke=i.get(wn).__webglTexture;t.bindTexture(Yn,ke),Ee(Yn),t.unbindTexture()}}},this.updateMultisampleRenderTarget=function xi(we){if(d&&we.samples>0&&!1===bi(we)){const de=we.isWebGLMultipleRenderTargets?we.texture:[we.texture],vt=we.width,rn=we.height;let sn=16384;const wn=[],Yn=we.stencilBuffer?33306:36096,ke=i.get(we),et=!0===we.isWebGLMultipleRenderTargets;if(et)for(let En=0;En<de.length;En++)t.bindFramebuffer(36160,ke.__webglMultisampledFramebuffer),n.framebufferRenderbuffer(36160,36064+En,36161,null),t.bindFramebuffer(36160,ke.__webglFramebuffer),n.framebufferTexture2D(36009,36064+En,3553,null,0);t.bindFramebuffer(36008,ke.__webglMultisampledFramebuffer),t.bindFramebuffer(36009,ke.__webglFramebuffer);for(let En=0;En<de.length;En++){wn.push(36064+En),we.depthBuffer&&wn.push(Yn);const yn=void 0!==ke.__ignoreDepthValues&&ke.__ignoreDepthValues;if(!1===yn&&(we.depthBuffer&&(sn|=256),we.stencilBuffer&&(sn|=1024)),et&&n.framebufferRenderbuffer(36008,36064,36161,ke.__webglColorRenderbuffer[En]),!0===yn&&(n.invalidateFramebuffer(36008,[Yn]),n.invalidateFramebuffer(36009,[Yn])),et){const Zn=i.get(de[En]).__webglTexture;n.framebufferTexture2D(36009,36064,3553,Zn,0)}n.blitFramebuffer(0,0,vt,rn,0,0,vt,rn,sn,9728),I&&n.invalidateFramebuffer(36008,wn)}if(t.bindFramebuffer(36008,null),t.bindFramebuffer(36009,null),et)for(let En=0;En<de.length;En++){t.bindFramebuffer(36160,ke.__webglMultisampledFramebuffer),n.framebufferRenderbuffer(36160,36064+En,36161,ke.__webglColorRenderbuffer[En]);const yn=i.get(de[En]).__webglTexture;t.bindFramebuffer(36160,ke.__webglFramebuffer),n.framebufferTexture2D(36009,36064+En,3553,yn,0)}t.bindFramebuffer(36009,ke.__webglMultisampledFramebuffer)}},this.setupDepthRenderbuffer=Wt,this.setupFrameBufferTexture=On,this.useMultisampledRTT=bi}function kie(n,e,t){const i=t.isWebGL2;return{convert:function r(s,c=null){let d;if(s===Wg)return 5121;if(1017===s)return 32819;if(1018===s)return 32820;if(1010===s)return 5120;if(1011===s)return 5122;if(1012===s)return 5123;if(1013===s)return 5124;if(s===qg)return 5125;if(s===um)return 5126;if(s===cw)return i?5131:(d=e.get("OES_texture_half_float"),null!==d?d.HALF_FLOAT_OES:null);if(1021===s)return 6406;if(s===pu)return 6408;if(1024===s)return 6409;if(1025===s)return 6410;if(s===Zg)return 6402;if(s===Bv)return 34041;if(1035===s)return d=e.get("EXT_sRGB"),null!==d?d.SRGB_ALPHA_EXT:null;if(1028===s)return 6403;if(1029===s)return 36244;if(1030===s)return 33319;if(1031===s)return 33320;if(1033===s)return 36249;if(33776===s||33777===s||33778===s||33779===s)if(c===vs){if(d=e.get("WEBGL_compressed_texture_s3tc_srgb"),null===d)return null;if(33776===s)return d.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(33777===s)return d.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(33778===s)return d.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(33779===s)return d.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else{if(d=e.get("WEBGL_compressed_texture_s3tc"),null===d)return null;if(33776===s)return d.COMPRESSED_RGB_S3TC_DXT1_EXT;if(33777===s)return d.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(33778===s)return d.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(33779===s)return d.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(35840===s||35841===s||35842===s||35843===s){if(d=e.get("WEBGL_compressed_texture_pvrtc"),null===d)return null;if(35840===s)return d.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(35841===s)return d.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(35842===s)return d.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(35843===s)return d.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(36196===s)return d=e.get("WEBGL_compressed_texture_etc1"),null!==d?d.COMPRESSED_RGB_ETC1_WEBGL:null;if(37492===s||37496===s){if(d=e.get("WEBGL_compressed_texture_etc"),null===d)return null;if(37492===s)return c===vs?d.COMPRESSED_SRGB8_ETC2:d.COMPRESSED_RGB8_ETC2;if(37496===s)return c===vs?d.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:d.COMPRESSED_RGBA8_ETC2_EAC}if(37808===s||37809===s||37810===s||37811===s||37812===s||37813===s||37814===s||37815===s||37816===s||37817===s||37818===s||37819===s||37820===s||37821===s){if(d=e.get("WEBGL_compressed_texture_astc"),null===d)return null;if(37808===s)return c===vs?d.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:d.COMPRESSED_RGBA_ASTC_4x4_KHR;if(37809===s)return c===vs?d.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:d.COMPRESSED_RGBA_ASTC_5x4_KHR;if(37810===s)return c===vs?d.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:d.COMPRESSED_RGBA_ASTC_5x5_KHR;if(37811===s)return c===vs?d.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:d.COMPRESSED_RGBA_ASTC_6x5_KHR;if(37812===s)return c===vs?d.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:d.COMPRESSED_RGBA_ASTC_6x6_KHR;if(37813===s)return c===vs?d.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:d.COMPRESSED_RGBA_ASTC_8x5_KHR;if(37814===s)return c===vs?d.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:d.COMPRESSED_RGBA_ASTC_8x6_KHR;if(37815===s)return c===vs?d.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:d.COMPRESSED_RGBA_ASTC_8x8_KHR;if(37816===s)return c===vs?d.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:d.COMPRESSED_RGBA_ASTC_10x5_KHR;if(37817===s)return c===vs?d.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:d.COMPRESSED_RGBA_ASTC_10x6_KHR;if(37818===s)return c===vs?d.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:d.COMPRESSED_RGBA_ASTC_10x8_KHR;if(37819===s)return c===vs?d.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:d.COMPRESSED_RGBA_ASTC_10x10_KHR;if(37820===s)return c===vs?d.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:d.COMPRESSED_RGBA_ASTC_12x10_KHR;if(37821===s)return c===vs?d.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:d.COMPRESSED_RGBA_ASTC_12x12_KHR}if(36492===s){if(d=e.get("EXT_texture_compression_bptc"),null===d)return null;if(36492===s)return c===vs?d.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:d.COMPRESSED_RGBA_BPTC_UNORM_EXT}if(36283===s||36284===s||36285===s||36286===s){if(d=e.get("EXT_texture_compression_rgtc"),null===d)return null;if(36492===s)return d.COMPRESSED_RED_RGTC1_EXT;if(36284===s)return d.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(36285===s)return d.COMPRESSED_RED_GREEN_RGTC2_EXT;if(36286===s)return d.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}return s===Nv?i?34042:(d=e.get("WEBGL_depth_texture"),null!==d?d.UNSIGNED_INT_24_8_WEBGL:null):void 0!==n[s]?n[s]:null}}}class Lie extends Da{constructor(e=[]){super(),this.isArrayCamera=!0,this.cameras=e}}class u0 extends Cl{constructor(){super(),this.isGroup=!0,this.type="Group"}}const Oie={type:"move"};class U2{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return null===this._hand&&(this._hand=new u0,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return null===this._targetRay&&(this._targetRay=new u0,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new _e,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new _e),this._targetRay}getGripSpace(){return null===this._grip&&(this._grip=new u0,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new _e,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new _e),this._grip}dispatchEvent(e){return null!==this._targetRay&&this._targetRay.dispatchEvent(e),null!==this._grip&&this._grip.dispatchEvent(e),null!==this._hand&&this._hand.dispatchEvent(e),this}connect(e){if(e&&e.hand){const t=this._hand;if(t)for(const i of e.hand.values())this._getHandJoint(t,i)}return this.dispatchEvent({type:"connected",data:e}),this}disconnect(e){return this.dispatchEvent({type:"disconnected",data:e}),null!==this._targetRay&&(this._targetRay.visible=!1),null!==this._grip&&(this._grip.visible=!1),null!==this._hand&&(this._hand.visible=!1),this}update(e,t,i){let r=null,s=null,c=null;const d=this._targetRay,m=this._grip,y=this._hand;if(e&&"visible-blurred"!==t.session.visibilityState){if(y&&e.hand){c=!0;for(const k of e.hand.values()){const F=t.getJointPose(k,i),G=this._getHandJoint(y,k);null!==F&&(G.matrix.fromArray(F.transform.matrix),G.matrix.decompose(G.position,G.rotation,G.scale),G.jointRadius=F.radius),G.visible=null!==F}const T=y.joints["index-finger-tip"].position.distanceTo(y.joints["thumb-tip"].position),I=.02,R=.005;y.inputState.pinching&&T>I+R?(y.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!y.inputState.pinching&&T<=I-R&&(y.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else null!==m&&e.gripSpace&&(s=t.getPose(e.gripSpace,i),null!==s&&(m.matrix.fromArray(s.transform.matrix),m.matrix.decompose(m.position,m.rotation,m.scale),s.linearVelocity?(m.hasLinearVelocity=!0,m.linearVelocity.copy(s.linearVelocity)):m.hasLinearVelocity=!1,s.angularVelocity?(m.hasAngularVelocity=!0,m.angularVelocity.copy(s.angularVelocity)):m.hasAngularVelocity=!1));null!==d&&(r=t.getPose(e.targetRaySpace,i),null===r&&null!==s&&(r=s),null!==r&&(d.matrix.fromArray(r.transform.matrix),d.matrix.decompose(d.position,d.rotation,d.scale),r.linearVelocity?(d.hasLinearVelocity=!0,d.linearVelocity.copy(r.linearVelocity)):d.hasLinearVelocity=!1,r.angularVelocity?(d.hasAngularVelocity=!0,d.angularVelocity.copy(r.angularVelocity)):d.hasAngularVelocity=!1,this.dispatchEvent(Oie)))}return null!==d&&(d.visible=null!==r),null!==m&&(m.visible=null!==s),null!==y&&(y.visible=null!==c),this}_getHandJoint(e,t){if(void 0===e.joints[t.jointName]){const i=new u0;i.matrixAutoUpdate=!1,i.visible=!1,e.joints[t.jointName]=i,e.add(i)}return e.joints[t.jointName]}}class Fie extends hm{constructor(e,t,i,r,s,c,d,m,y,w){if((w=void 0!==w?w:Zg)!==Zg&&w!==Bv)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");void 0===i&&w===Zg&&(i=qg),void 0===i&&w===Bv&&(i=Nv),super(null,r,s,c,d,m,w,i,y),this.isDepthTexture=!0,this.image={width:e,height:t},this.magFilter=void 0!==d?d:So,this.minFilter=void 0!==m?m:So,this.flipY=!1,this.generateMipmaps=!1}}class Nie extends Kg{constructor(e,t){super();const i=this;let r=null,s=1,c=null,d="local-floor",m=1,y=null,w=null,S=null,T=null,I=null,R=null;const k=t.getContextAttributes();let F=null,G=null;const W=[],V=[],X=new Set,ee=new Map,ae=new Da;ae.layers.enable(1),ae.viewport=new Qr;const Ee=new Da;Ee.layers.enable(2),Ee.viewport=new Qr;const J=[ae,Ee],pe=new Lie;pe.layers.enable(1),pe.layers.enable(2);let Oe=null,st=null;function xt(at){const Ut=V.indexOf(at.inputSource);if(-1===Ut)return;const zt=W[Ut];void 0!==zt&&zt.dispatchEvent({type:at.type,data:at.inputSource})}function Qe(){r.removeEventListener("select",xt),r.removeEventListener("selectstart",xt),r.removeEventListener("selectend",xt),r.removeEventListener("squeeze",xt),r.removeEventListener("squeezestart",xt),r.removeEventListener("squeezeend",xt),r.removeEventListener("end",Qe),r.removeEventListener("inputsourceschange",Ge);for(let at=0;at<W.length;at++){const Ut=V[at];null!==Ut&&(V[at]=null,W[at].disconnect(Ut))}Oe=null,st=null,e.setRenderTarget(F),I=null,T=null,S=null,r=null,G=null,pn.stop(),i.isPresenting=!1,i.dispatchEvent({type:"sessionend"})}function Ge(at){for(let Ut=0;Ut<at.removed.length;Ut++){const zt=at.removed[Ut],nt=V.indexOf(zt);nt>=0&&(V[nt]=null,W[nt].disconnect(zt))}for(let Ut=0;Ut<at.added.length;Ut++){const zt=at.added[Ut];let nt=V.indexOf(zt);if(-1===nt){for(let en=0;en<W.length;en++){if(en>=V.length){V.push(zt),nt=en;break}if(null===V[en]){V[en]=zt,nt=en;break}}if(-1===nt)break}const In=W[nt];In&&In.connect(zt)}}this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(at){let Ut=W[at];return void 0===Ut&&(Ut=new U2,W[at]=Ut),Ut.getTargetRaySpace()},this.getControllerGrip=function(at){let Ut=W[at];return void 0===Ut&&(Ut=new U2,W[at]=Ut),Ut.getGripSpace()},this.getHand=function(at){let Ut=W[at];return void 0===Ut&&(Ut=new U2,W[at]=Ut),Ut.getHandSpace()},this.setFramebufferScaleFactor=function(at){s=at,!0===i.isPresenting&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(at){d=at,!0===i.isPresenting&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return y||c},this.setReferenceSpace=function(at){y=at},this.getBaseLayer=function(){return null!==T?T:I},this.getBinding=function(){return S},this.getFrame=function(){return R},this.getSession=function(){return r},this.setSession=function(){var at=function aQ(n){return function(){var e=this,t=arguments;return new Promise(function(i,r){var s=n.apply(e,t);function c(m){Pz(s,i,r,c,d,"next",m)}function d(m){Pz(s,i,r,c,d,"throw",m)}c(void 0)})}}(function*(Ut){if(r=Ut,null!==r){if(F=e.getRenderTarget(),r.addEventListener("select",xt),r.addEventListener("selectstart",xt),r.addEventListener("selectend",xt),r.addEventListener("squeeze",xt),r.addEventListener("squeezestart",xt),r.addEventListener("squeezeend",xt),r.addEventListener("end",Qe),r.addEventListener("inputsourceschange",Ge),!0!==k.xrCompatible&&(yield t.makeXRCompatible()),void 0===r.renderState.layers||!1===e.capabilities.isWebGL2)I=new XRWebGLLayer(r,t,{antialias:void 0!==r.renderState.layers||k.antialias,alpha:k.alpha,depth:k.depth,stencil:k.stencil,framebufferScaleFactor:s}),r.updateRenderState({baseLayer:I}),G=new Jg(I.framebufferWidth,I.framebufferHeight,{format:pu,type:Wg,encoding:e.outputEncoding,stencilBuffer:k.stencil});else{let zt=null,nt=null,In=null;k.depth&&(In=k.stencil?35056:33190,zt=k.stencil?Bv:Zg,nt=k.stencil?Nv:qg);const en={colorFormat:32856,depthFormat:In,scaleFactor:s};S=new XRWebGLBinding(r,t),T=S.createProjectionLayer(en),r.updateRenderState({layers:[T]}),G=new Jg(T.textureWidth,T.textureHeight,{format:pu,type:Wg,depthTexture:new Fie(T.textureWidth,T.textureHeight,nt,void 0,void 0,void 0,void 0,void 0,void 0,zt),stencilBuffer:k.stencil,encoding:e.outputEncoding,samples:k.antialias?4:0}),e.properties.get(G).__ignoreDepthValues=T.ignoreDepthValues}G.isXRRenderTarget=!0,this.setFoveation(m),y=null,c=yield r.requestReferenceSpace(d),pn.setContext(r),pn.start(),i.isPresenting=!0,i.dispatchEvent({type:"sessionstart"})}});return function(Ut){return at.apply(this,arguments)}}();const ft=new _e,qe=new _e;function Ye(at,Ut){null===Ut?at.matrixWorld.copy(at.matrix):at.matrixWorld.multiplyMatrices(Ut.matrixWorld,at.matrix),at.matrixWorldInverse.copy(at.matrixWorld).invert()}this.updateCamera=function(at){if(null===r)return;pe.near=Ee.near=ae.near=at.near,pe.far=Ee.far=ae.far=at.far,(Oe!==pe.near||st!==pe.far)&&(r.updateRenderState({depthNear:pe.near,depthFar:pe.far}),Oe=pe.near,st=pe.far);const Ut=at.parent,zt=pe.cameras;Ye(pe,Ut);for(let In=0;In<zt.length;In++)Ye(zt[In],Ut);pe.matrixWorld.decompose(pe.position,pe.quaternion,pe.scale),at.matrix.copy(pe.matrix),at.matrix.decompose(at.position,at.quaternion,at.scale);const nt=at.children;for(let In=0,en=nt.length;In<en;In++)nt[In].updateMatrixWorld(!0);2===zt.length?function dt(at,Ut,zt){ft.setFromMatrixPosition(Ut.matrixWorld),qe.setFromMatrixPosition(zt.matrixWorld);const nt=ft.distanceTo(qe),In=Ut.projectionMatrix.elements,en=zt.projectionMatrix.elements,xn=In[14]/(In[10]-1),gn=In[14]/(In[10]+1),On=(In[9]+1)/In[5],ii=(In[9]-1)/In[5],Nt=(In[8]-1)/In[0],Wt=(en[8]+1)/en[0],cn=xn*Nt,$n=xn*Wt,_n=nt/(-Nt+Wt),xi=_n*-Nt;Ut.matrixWorld.decompose(at.position,at.quaternion,at.scale),at.translateX(xi),at.translateZ(_n),at.matrixWorld.compose(at.position,at.quaternion,at.scale),at.matrixWorldInverse.copy(at.matrixWorld).invert();const ri=xn+_n,bi=gn+_n;at.projectionMatrix.makePerspective(cn-xi,$n+(nt-xi),On*gn/bi*ri,ii*gn/bi*ri,ri,bi)}(pe,ae,Ee):pe.projectionMatrix.copy(ae.projectionMatrix)},this.getCamera=function(){return pe},this.getFoveation=function(){if(null!==T||null!==I)return m},this.setFoveation=function(at){m=at,null!==T&&(T.fixedFoveation=at),null!==I&&void 0!==I.fixedFoveation&&(I.fixedFoveation=at)},this.getPlanes=function(){return X};let gt=null;const pn=new FV;pn.setAnimationLoop(function Ot(at,Ut){if(w=Ut.getViewerPose(y||c),R=Ut,null!==w){const zt=w.views;null!==I&&(e.setRenderTargetFramebuffer(G,I.framebuffer),e.setRenderTarget(G));let nt=!1;zt.length!==pe.cameras.length&&(pe.cameras.length=0,nt=!0);for(let In=0;In<zt.length;In++){const en=zt[In];let xn=null;if(null!==I)xn=I.getViewport(en);else{const On=S.getViewSubImage(T,en);xn=On.viewport,0===In&&(e.setRenderTargetTextures(G,On.colorTexture,T.ignoreDepthValues?void 0:On.depthStencilTexture),e.setRenderTarget(G))}let gn=J[In];void 0===gn&&(gn=new Da,gn.layers.enable(In),gn.viewport=new Qr,J[In]=gn),gn.matrix.fromArray(en.transform.matrix),gn.projectionMatrix.fromArray(en.projectionMatrix),gn.viewport.set(xn.x,xn.y,xn.width,xn.height),0===In&&pe.matrix.copy(gn.matrix),!0===nt&&pe.cameras.push(gn)}}for(let zt=0;zt<W.length;zt++){const nt=V[zt],In=W[zt];null!==nt&&void 0!==In&&In.update(nt,Ut,y||c)}if(gt&&gt(at,Ut),Ut.detectedPlanes){i.dispatchEvent({type:"planesdetected",data:Ut.detectedPlanes});let zt=null;for(const nt of X)Ut.detectedPlanes.has(nt)||(null===zt&&(zt=[]),zt.push(nt));if(null!==zt)for(const nt of zt)X.delete(nt),ee.delete(nt),i.dispatchEvent({type:"planeremoved",data:nt});for(const nt of Ut.detectedPlanes)if(X.has(nt)){const In=ee.get(nt);nt.lastChangedTime>In&&(ee.set(nt,nt.lastChangedTime),i.dispatchEvent({type:"planechanged",data:nt}))}else X.add(nt),ee.set(nt,Ut.lastChangedTime),i.dispatchEvent({type:"planeadded",data:nt})}R=null}),this.setAnimationLoop=function(at){gt=at},this.dispose=function(){}}}function Bie(n,e){function r(k,F){k.opacity.value=F.opacity,F.color&&k.diffuse.value.copy(F.color),F.emissive&&k.emissive.value.copy(F.emissive).multiplyScalar(F.emissiveIntensity),F.map&&(k.map.value=F.map),F.alphaMap&&(k.alphaMap.value=F.alphaMap),F.bumpMap&&(k.bumpMap.value=F.bumpMap,k.bumpScale.value=F.bumpScale,1===F.side&&(k.bumpScale.value*=-1)),F.displacementMap&&(k.displacementMap.value=F.displacementMap,k.displacementScale.value=F.displacementScale,k.displacementBias.value=F.displacementBias),F.emissiveMap&&(k.emissiveMap.value=F.emissiveMap),F.normalMap&&(k.normalMap.value=F.normalMap,k.normalScale.value.copy(F.normalScale),1===F.side&&k.normalScale.value.negate()),F.specularMap&&(k.specularMap.value=F.specularMap),F.alphaTest>0&&(k.alphaTest.value=F.alphaTest);const G=e.get(F).envMap;if(G&&(k.envMap.value=G,k.flipEnvMap.value=G.isCubeTexture&&!1===G.isRenderTargetTexture?-1:1,k.reflectivity.value=F.reflectivity,k.ior.value=F.ior,k.refractionRatio.value=F.refractionRatio),F.lightMap){k.lightMap.value=F.lightMap;const X=!0===n.useLegacyLights?Math.PI:1;k.lightMapIntensity.value=F.lightMapIntensity*X}let W,V;F.aoMap&&(k.aoMap.value=F.aoMap,k.aoMapIntensity.value=F.aoMapIntensity),F.map?W=F.map:F.specularMap?W=F.specularMap:F.displacementMap?W=F.displacementMap:F.normalMap?W=F.normalMap:F.bumpMap?W=F.bumpMap:F.roughnessMap?W=F.roughnessMap:F.metalnessMap?W=F.metalnessMap:F.alphaMap?W=F.alphaMap:F.emissiveMap?W=F.emissiveMap:F.clearcoatMap?W=F.clearcoatMap:F.clearcoatNormalMap?W=F.clearcoatNormalMap:F.clearcoatRoughnessMap?W=F.clearcoatRoughnessMap:F.iridescenceMap?W=F.iridescenceMap:F.iridescenceThicknessMap?W=F.iridescenceThicknessMap:F.specularIntensityMap?W=F.specularIntensityMap:F.specularColorMap?W=F.specularColorMap:F.transmissionMap?W=F.transmissionMap:F.thicknessMap?W=F.thicknessMap:F.sheenColorMap?W=F.sheenColorMap:F.sheenRoughnessMap&&(W=F.sheenRoughnessMap),void 0!==W&&(W.isWebGLRenderTarget&&(W=W.texture),!0===W.matrixAutoUpdate&&W.updateMatrix(),k.uvTransform.value.copy(W.matrix)),F.aoMap?V=F.aoMap:F.lightMap&&(V=F.lightMap),void 0!==V&&(V.isWebGLRenderTarget&&(V=V.texture),!0===V.matrixAutoUpdate&&V.updateMatrix(),k.uv2Transform.value.copy(V.matrix))}return{refreshFogUniforms:function t(k,F){F.color.getRGB(k.fogColor.value,OV(n)),F.isFog?(k.fogNear.value=F.near,k.fogFar.value=F.far):F.isFogExp2&&(k.fogDensity.value=F.density)},refreshMaterialUniforms:function i(k,F,G,W,V){F.isMeshBasicMaterial||F.isMeshLambertMaterial?r(k,F):F.isMeshToonMaterial?(r(k,F),function w(k,F){F.gradientMap&&(k.gradientMap.value=F.gradientMap)}(k,F)):F.isMeshPhongMaterial?(r(k,F),function y(k,F){k.specular.value.copy(F.specular),k.shininess.value=Math.max(F.shininess,1e-4)}(k,F)):F.isMeshStandardMaterial?(r(k,F),function S(k,F){k.roughness.value=F.roughness,k.metalness.value=F.metalness,F.roughnessMap&&(k.roughnessMap.value=F.roughnessMap),F.metalnessMap&&(k.metalnessMap.value=F.metalnessMap),e.get(F).envMap&&(k.envMapIntensity.value=F.envMapIntensity)}(k,F),F.isMeshPhysicalMaterial&&function T(k,F,G){k.ior.value=F.ior,F.sheen>0&&(k.sheenColor.value.copy(F.sheenColor).multiplyScalar(F.sheen),k.sheenRoughness.value=F.sheenRoughness,F.sheenColorMap&&(k.sheenColorMap.value=F.sheenColorMap),F.sheenRoughnessMap&&(k.sheenRoughnessMap.value=F.sheenRoughnessMap)),F.clearcoat>0&&(k.clearcoat.value=F.clearcoat,k.clearcoatRoughness.value=F.clearcoatRoughness,F.clearcoatMap&&(k.clearcoatMap.value=F.clearcoatMap),F.clearcoatRoughnessMap&&(k.clearcoatRoughnessMap.value=F.clearcoatRoughnessMap),F.clearcoatNormalMap&&(k.clearcoatNormalScale.value.copy(F.clearcoatNormalScale),k.clearcoatNormalMap.value=F.clearcoatNormalMap,1===F.side&&k.clearcoatNormalScale.value.negate())),F.iridescence>0&&(k.iridescence.value=F.iridescence,k.iridescenceIOR.value=F.iridescenceIOR,k.iridescenceThicknessMinimum.value=F.iridescenceThicknessRange[0],k.iridescenceThicknessMaximum.value=F.iridescenceThicknessRange[1],F.iridescenceMap&&(k.iridescenceMap.value=F.iridescenceMap),F.iridescenceThicknessMap&&(k.iridescenceThicknessMap.value=F.iridescenceThicknessMap)),F.transmission>0&&(k.transmission.value=F.transmission,k.transmissionSamplerMap.value=G.texture,k.transmissionSamplerSize.value.set(G.width,G.height),F.transmissionMap&&(k.transmissionMap.value=F.transmissionMap),k.thickness.value=F.thickness,F.thicknessMap&&(k.thicknessMap.value=F.thicknessMap),k.attenuationDistance.value=F.attenuationDistance,k.attenuationColor.value.copy(F.attenuationColor)),k.specularIntensity.value=F.specularIntensity,k.specularColor.value.copy(F.specularColor),F.specularIntensityMap&&(k.specularIntensityMap.value=F.specularIntensityMap),F.specularColorMap&&(k.specularColorMap.value=F.specularColorMap)}(k,F,V)):F.isMeshMatcapMaterial?(r(k,F),function I(k,F){F.matcap&&(k.matcap.value=F.matcap)}(k,F)):F.isMeshDepthMaterial?r(k,F):F.isMeshDistanceMaterial?(r(k,F),function R(k,F){k.referencePosition.value.copy(F.referencePosition),k.nearDistance.value=F.nearDistance,k.farDistance.value=F.farDistance}(k,F)):F.isMeshNormalMaterial?r(k,F):F.isLineBasicMaterial?(function s(k,F){k.diffuse.value.copy(F.color),k.opacity.value=F.opacity}(k,F),F.isLineDashedMaterial&&function c(k,F){k.dashSize.value=F.dashSize,k.totalSize.value=F.dashSize+F.gapSize,k.scale.value=F.scale}(k,F)):F.isPointsMaterial?function d(k,F,G,W){let V;k.diffuse.value.copy(F.color),k.opacity.value=F.opacity,k.size.value=F.size*G,k.scale.value=.5*W,F.map&&(k.map.value=F.map),F.alphaMap&&(k.alphaMap.value=F.alphaMap),F.alphaTest>0&&(k.alphaTest.value=F.alphaTest),F.map?V=F.map:F.alphaMap&&(V=F.alphaMap),void 0!==V&&(!0===V.matrixAutoUpdate&&V.updateMatrix(),k.uvTransform.value.copy(V.matrix))}(k,F,G,W):F.isSpriteMaterial?function m(k,F){let G;k.diffuse.value.copy(F.color),k.opacity.value=F.opacity,k.rotation.value=F.rotation,F.map&&(k.map.value=F.map),F.alphaMap&&(k.alphaMap.value=F.alphaMap),F.alphaTest>0&&(k.alphaTest.value=F.alphaTest),F.map?G=F.map:F.alphaMap&&(G=F.alphaMap),void 0!==G&&(!0===G.matrixAutoUpdate&&G.updateMatrix(),k.uvTransform.value.copy(G.matrix))}(k,F):F.isShadowMaterial?(k.color.value.copy(F.color),k.opacity.value=F.opacity):F.isShaderMaterial&&(F.uniformsNeedUpdate=!1)}}}function zie(n,e,t,i){let r={},s={},c=[];const d=t.isWebGL2?n.getParameter(35375):0;function I(W,V,X){const ee=W.value;if(void 0===X[V]){if("number"==typeof ee)X[V]=ee;else{const ae=Array.isArray(ee)?ee:[ee],Ee=[];for(let J=0;J<ae.length;J++)Ee.push(ae[J].clone());X[V]=Ee}return!0}if("number"==typeof ee){if(X[V]!==ee)return X[V]=ee,!0}else{const ae=Array.isArray(X[V])?X[V]:[X[V]],Ee=Array.isArray(ee)?ee:[ee];for(let J=0;J<ae.length;J++){const pe=ae[J];if(!1===pe.equals(Ee[J]))return pe.copy(Ee[J]),!0}}return!1}function k(W){const V={boundary:0,storage:0};return"number"==typeof W?(V.boundary=4,V.storage=4):W.isVector2?(V.boundary=8,V.storage=8):W.isVector3||W.isColor?(V.boundary=16,V.storage=12):W.isVector4?(V.boundary=16,V.storage=16):W.isMatrix3?(V.boundary=48,V.storage=48):W.isMatrix4?(V.boundary=64,V.storage=64):W.isTexture?console.warn("THREE.WebGLRenderer: Texture samplers can not be part of an uniforms group."):console.warn("THREE.WebGLRenderer: Unsupported uniform value type.",W),V}function F(W){const V=W.target;V.removeEventListener("dispose",F);const X=c.indexOf(V.__bindingPointIndex);c.splice(X,1),n.deleteBuffer(r[V.id]),delete r[V.id],delete s[V.id]}return{bind:function m(W,V){i.uniformBlockBinding(W,V.program)},update:function y(W,V){let X=r[W.id];void 0===X&&(function R(W){const V=W.uniforms;let X=0;let ae=0;for(let Ee=0,J=V.length;Ee<J;Ee++){const pe=V[Ee],Oe={boundary:0,storage:0},st=Array.isArray(pe.value)?pe.value:[pe.value];for(let xt=0,Qe=st.length;xt<Qe;xt++){const ft=k(st[xt]);Oe.boundary+=ft.boundary,Oe.storage+=ft.storage}if(pe.__data=new Float32Array(Oe.storage/Float32Array.BYTES_PER_ELEMENT),pe.__offset=X,Ee>0){ae=X%16;const xt=16-ae;0!==ae&&xt-Oe.boundary<0&&(X+=16-ae,pe.__offset=X)}X+=Oe.storage}ae=X%16,ae>0&&(X+=16-ae),W.__size=X,W.__cache={}}(W),X=function w(W){const V=function S(){for(let W=0;W<d;W++)if(-1===c.indexOf(W))return c.push(W),W;return console.error("THREE.WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}();W.__bindingPointIndex=V;const X=n.createBuffer(),ee=W.__size,ae=W.usage;return n.bindBuffer(35345,X),n.bufferData(35345,ee,ae),n.bindBuffer(35345,null),n.bindBufferBase(35345,V,X),X}(W),r[W.id]=X,W.addEventListener("dispose",F)),i.updateUBOMapping(W,V.program);const ae=e.render.frame;s[W.id]!==ae&&(function T(W){const X=W.uniforms,ee=W.__cache;n.bindBuffer(35345,r[W.id]);for(let ae=0,Ee=X.length;ae<Ee;ae++){const J=X[ae];if(!0===I(J,ae,ee)){const pe=J.__offset,Oe=Array.isArray(J.value)?J.value:[J.value];let st=0;for(let xt=0;xt<Oe.length;xt++){const Qe=Oe[xt],Ge=k(Qe);"number"==typeof Qe?(J.__data[0]=Qe,n.bufferSubData(35345,pe+st,J.__data)):Qe.isMatrix3?(J.__data[0]=Qe.elements[0],J.__data[1]=Qe.elements[1],J.__data[2]=Qe.elements[2],J.__data[3]=Qe.elements[0],J.__data[4]=Qe.elements[3],J.__data[5]=Qe.elements[4],J.__data[6]=Qe.elements[5],J.__data[7]=Qe.elements[0],J.__data[8]=Qe.elements[6],J.__data[9]=Qe.elements[7],J.__data[10]=Qe.elements[8],J.__data[11]=Qe.elements[0]):(Qe.toArray(J.__data,st),st+=Ge.storage/Float32Array.BYTES_PER_ELEMENT)}n.bufferSubData(35345,pe,J.__data)}}n.bindBuffer(35345,null)}(W),s[W.id]=ae)},dispose:function G(){for(const W in r)n.deleteBuffer(r[W]);c=[],r={},s={}}}}function H2(n={}){this.isWebGLRenderer=!0;const e=void 0!==n.canvas?n.canvas:function Vie(){const n=pw("canvas");return n.style.display="block",n}(),t=void 0!==n.context?n.context:null,i=void 0===n.depth||n.depth,r=void 0===n.stencil||n.stencil,s=void 0!==n.antialias&&n.antialias,c=void 0===n.premultipliedAlpha||n.premultipliedAlpha,d=void 0!==n.preserveDrawingBuffer&&n.preserveDrawingBuffer,m=void 0!==n.powerPreference?n.powerPreference:"default",y=void 0!==n.failIfMajorPerformanceCaveat&&n.failIfMajorPerformanceCaveat;let w;w=null!==t?t.getContextAttributes().alpha:void 0!==n.alpha&&n.alpha;let S=null,T=null;const I=[],R=[];this.domElement=e,this.debug={checkShaderErrors:!0},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.outputEncoding=Xg,this.useLegacyLights=!0,this.toneMapping=0,this.toneMappingExposure=1;const k=this;let F=!1,G=0,W=0,V=null,X=-1,ee=null;const ae=new Qr,Ee=new Qr;let J=null,pe=e.width,Oe=e.height,st=1,xt=null,Qe=null;const Ge=new Qr(0,0,pe,Oe),ft=new Qr(0,0,pe,Oe);let qe=!1;const dt=new L2;let Ye=!1,gt=!1,Ot=null;const pn=new Bi,at=new _e,Ut={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function zt(){return null===V?st:1}let en,xn,gn,On,ii,Nt,Wt,cn,$n,_n,xi,ri,bi,qr,Ar,we,de,vt,rn,sn,wn,Yn,ke,et,nt=t;function In(ve,ot){for(let Mt=0;Mt<ve.length;Mt++){const At=e.getContext(ve[Mt],ot);if(null!==At)return At}return null}try{const ve={alpha:!0,depth:i,stencil:r,antialias:s,premultipliedAlpha:c,preserveDrawingBuffer:d,powerPreference:m,failIfMajorPerformanceCaveat:y};if("setAttribute"in e&&e.setAttribute("data-engine","three.js r150"),e.addEventListener("webglcontextlost",Zn,!1),e.addEventListener("webglcontextrestored",Jn,!1),e.addEventListener("webglcontextcreationerror",Kn,!1),null===nt){const ot=["webgl2","webgl","experimental-webgl"];if(!0===k.isWebGL1Renderer&&ot.shift(),nt=In(ot,ve),null===nt)throw In(ot)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}void 0===nt.getShaderPrecisionFormat&&(nt.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(ve){throw console.error("THREE.WebGLRenderer: "+ve.message),ve}function En(){en=new Jte(nt),xn=new qte(nt,en,n),en.init(xn),Yn=new kie(nt,en,xn),gn=new Pie(nt,en,xn),On=new nne,ii=new vie,Nt=new Rie(nt,en,gn,ii,xn,Yn,On),Wt=new Xte(k),cn=new Qte(k),$n=new $J(nt,xn),ke=new $te(nt,en,$n,xn),_n=new ene(nt,$n,On,ke),xi=new one(nt,_n,$n,On),rn=new sne(nt,xn,Nt),we=new Zte(ii),ri=new yie(k,Wt,cn,en,xn,ke,we),bi=new Bie(k,ii),qr=new bie,Ar=new Tie(en,xn),vt=new jte(k,Wt,cn,gn,xi,w,c),de=new Iie(k,xi,xn),et=new zie(nt,On,xn,gn),sn=new Wte(nt,en,On,xn),wn=new tne(nt,en,On,xn),On.programs=ri.programs,k.capabilities=xn,k.extensions=en,k.properties=ii,k.renderLists=qr,k.shadowMap=de,k.state=gn,k.info=On}En();const yn=new Nie(k,nt);function Zn(ve){ve.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),F=!0}function Jn(){console.log("THREE.WebGLRenderer: Context Restored."),F=!1;const ve=On.autoReset,ot=de.enabled,Mt=de.autoUpdate,tt=de.needsUpdate,At=de.type;En(),On.autoReset=ve,de.enabled=ot,de.autoUpdate=Mt,de.needsUpdate=tt,de.type=At}function Kn(ve){console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ",ve.statusMessage)}function _r(ve){const ot=ve.target;ot.removeEventListener("dispose",_r),function Ir(ve){(function Jr(ve){const ot=ii.get(ve).programs;void 0!==ot&&(ot.forEach(function(Mt){ri.releaseProgram(Mt)}),ve.isShaderMaterial&&ri.releaseShaderCache(ve))})(ve),ii.remove(ve)}(ot)}this.xr=yn,this.getContext=function(){return nt},this.getContextAttributes=function(){return nt.getContextAttributes()},this.forceContextLoss=function(){const ve=en.get("WEBGL_lose_context");ve&&ve.loseContext()},this.forceContextRestore=function(){const ve=en.get("WEBGL_lose_context");ve&&ve.restoreContext()},this.getPixelRatio=function(){return st},this.setPixelRatio=function(ve){void 0!==ve&&(st=ve,this.setSize(pe,Oe,!1))},this.getSize=function(ve){return ve.set(pe,Oe)},this.setSize=function(ve,ot,Mt=!0){yn.isPresenting?console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting."):(pe=ve,Oe=ot,e.width=Math.floor(ve*st),e.height=Math.floor(ot*st),!0===Mt&&(e.style.width=ve+"px",e.style.height=ot+"px"),this.setViewport(0,0,ve,ot))},this.getDrawingBufferSize=function(ve){return ve.set(pe*st,Oe*st).floor()},this.setDrawingBufferSize=function(ve,ot,Mt){pe=ve,Oe=ot,st=Mt,e.width=Math.floor(ve*Mt),e.height=Math.floor(ot*Mt),this.setViewport(0,0,ve,ot)},this.getCurrentViewport=function(ve){return ve.copy(ae)},this.getViewport=function(ve){return ve.copy(Ge)},this.setViewport=function(ve,ot,Mt,tt){ve.isVector4?Ge.set(ve.x,ve.y,ve.z,ve.w):Ge.set(ve,ot,Mt,tt),gn.viewport(ae.copy(Ge).multiplyScalar(st).floor())},this.getScissor=function(ve){return ve.copy(ft)},this.setScissor=function(ve,ot,Mt,tt){ve.isVector4?ft.set(ve.x,ve.y,ve.z,ve.w):ft.set(ve,ot,Mt,tt),gn.scissor(Ee.copy(ft).multiplyScalar(st).floor())},this.getScissorTest=function(){return qe},this.setScissorTest=function(ve){gn.setScissorTest(qe=ve)},this.setOpaqueSort=function(ve){xt=ve},this.setTransparentSort=function(ve){Qe=ve},this.getClearColor=function(ve){return ve.copy(vt.getClearColor())},this.setClearColor=function(){vt.setClearColor.apply(vt,arguments)},this.getClearAlpha=function(){return vt.getClearAlpha()},this.setClearAlpha=function(){vt.setClearAlpha.apply(vt,arguments)},this.clear=function(ve=!0,ot=!0,Mt=!0){let tt=0;ve&&(tt|=16384),ot&&(tt|=256),Mt&&(tt|=1024),nt.clear(tt)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){e.removeEventListener("webglcontextlost",Zn,!1),e.removeEventListener("webglcontextrestored",Jn,!1),e.removeEventListener("webglcontextcreationerror",Kn,!1),qr.dispose(),Ar.dispose(),ii.dispose(),Wt.dispose(),cn.dispose(),xi.dispose(),ke.dispose(),et.dispose(),ri.dispose(),yn.dispose(),yn.removeEventListener("sessionstart",Qt),yn.removeEventListener("sessionend",Ln),Ot&&(Ot.dispose(),Ot=null),Wn.stop()},this.renderBufferDirect=function(ve,ot,Mt,tt,At,fi){null===ot&&(ot=Ut);const Pi=At.isMesh&&At.matrixWorld.determinant()<0,Ji=function Hle(ve,ot,Mt,tt,At){!0!==ot.isScene&&(ot=Ut),Nt.resetTextureUnits();const fi=ot.fog,Ji=null===V?k.outputEncoding:!0===V.isXRRenderTarget?V.texture.encoding:Xg,rr=(tt.isMeshStandardMaterial?cn:Wt).get(tt.envMap||(tt.isMeshStandardMaterial?ot.environment:null)),Fr=!0===tt.vertexColors&&!!Mt.attributes.color&&4===Mt.attributes.color.itemSize,Sr=!!tt.normalMap&&!!Mt.attributes.tangent,Er=!!Mt.morphAttributes.position,Do=!!Mt.morphAttributes.normal,Ac=!!Mt.morphAttributes.color,kp=tt.toneMapped?k.toneMapping:0,y_=Mt.morphAttributes.position||Mt.morphAttributes.normal||Mt.morphAttributes.color,Ao=void 0!==y_?y_.length:0,Tr=ii.get(tt),nR=T.state.lights;!0!==Ye||!0!==gt&&ve===ee||we.setState(tt,ve,ve===ee&&tt.id===X);let la=!1;tt.version===Tr.__version?(Tr.needsLights&&Tr.lightsStateVersion!==nR.state.version||Tr.outputEncoding!==Ji||At.isInstancedMesh&&!1===Tr.instancing||!At.isInstancedMesh&&!0===Tr.instancing||At.isSkinnedMesh&&!1===Tr.skinning||!At.isSkinnedMesh&&!0===Tr.skinning||Tr.envMap!==rr||!0===tt.fog&&Tr.fog!==fi||void 0!==Tr.numClippingPlanes&&(Tr.numClippingPlanes!==we.numPlanes||Tr.numIntersection!==we.numIntersection)||Tr.vertexAlphas!==Fr||Tr.vertexTangents!==Sr||Tr.morphTargets!==Er||Tr.morphNormals!==Do||Tr.morphColors!==Ac||Tr.toneMapping!==kp||!0===xn.isWebGL2&&Tr.morphTargetsCount!==Ao)&&(la=!0):(la=!0,Tr.__version=tt.version);let v_=Tr.currentProgram;!0===la&&(v_=vu(tt,ot,At));let y5=!1,Uw=!1,iR=!1;const Dl=v_.getUniforms(),x_=Tr.uniforms;if(gn.useProgram(v_.program)&&(y5=!0,Uw=!0,iR=!0),tt.id!==X&&(X=tt.id,Uw=!0),y5||ee!==ve){if(Dl.setValue(nt,"projectionMatrix",ve.projectionMatrix),xn.logarithmicDepthBuffer&&Dl.setValue(nt,"logDepthBufFC",2/(Math.log(ve.far+1)/Math.LN2)),ee!==ve&&(ee=ve,Uw=!0,iR=!0),tt.isShaderMaterial||tt.isMeshPhongMaterial||tt.isMeshToonMaterial||tt.isMeshStandardMaterial||tt.envMap){const Ic=Dl.map.cameraPosition;void 0!==Ic&&Ic.setValue(nt,at.setFromMatrixPosition(ve.matrixWorld))}(tt.isMeshPhongMaterial||tt.isMeshToonMaterial||tt.isMeshLambertMaterial||tt.isMeshBasicMaterial||tt.isMeshStandardMaterial||tt.isShaderMaterial)&&Dl.setValue(nt,"isOrthographic",!0===ve.isOrthographicCamera),(tt.isMeshPhongMaterial||tt.isMeshToonMaterial||tt.isMeshLambertMaterial||tt.isMeshBasicMaterial||tt.isMeshStandardMaterial||tt.isShaderMaterial||tt.isShadowMaterial||At.isSkinnedMesh)&&Dl.setValue(nt,"viewMatrix",ve.matrixWorldInverse)}if(At.isSkinnedMesh){Dl.setOptional(nt,At,"bindMatrix"),Dl.setOptional(nt,At,"bindMatrixInverse");const Ic=At.skeleton;Ic&&(xn.floatVertexTextures?(null===Ic.boneTexture&&Ic.computeBoneTexture(),Dl.setValue(nt,"boneTexture",Ic.boneTexture,Nt),Dl.setValue(nt,"boneTextureSize",Ic.boneTextureSize)):console.warn("THREE.WebGLRenderer: SkinnedMesh can only be used with WebGL 2. With WebGL 1 OES_texture_float and vertex textures support is required."))}const rR=Mt.morphAttributes;if((void 0!==rR.position||void 0!==rR.normal||void 0!==rR.color&&!0===xn.isWebGL2)&&rn.update(At,Mt,v_),(Uw||Tr.receiveShadow!==At.receiveShadow)&&(Tr.receiveShadow=At.receiveShadow,Dl.setValue(nt,"receiveShadow",At.receiveShadow)),tt.isMeshGouraudMaterial&&null!==tt.envMap&&(x_.envMap.value=rr,x_.flipEnvMap.value=rr.isCubeTexture&&!1===rr.isRenderTargetTexture?-1:1),Uw&&(Dl.setValue(nt,"toneMappingExposure",k.toneMappingExposure),Tr.needsLights&&function Gle(ve,ot){ve.ambientLightColor.needsUpdate=ot,ve.lightProbe.needsUpdate=ot,ve.directionalLights.needsUpdate=ot,ve.directionalLightShadows.needsUpdate=ot,ve.pointLights.needsUpdate=ot,ve.pointLightShadows.needsUpdate=ot,ve.spotLights.needsUpdate=ot,ve.spotLightShadows.needsUpdate=ot,ve.rectAreaLights.needsUpdate=ot,ve.hemisphereLights.needsUpdate=ot}(x_,iR),fi&&!0===tt.fog&&bi.refreshFogUniforms(x_,fi),bi.refreshMaterialUniforms(x_,tt,st,Oe,Ot),jS.upload(nt,Tr.uniformsList,x_,Nt)),tt.isShaderMaterial&&!0===tt.uniformsNeedUpdate&&(jS.upload(nt,Tr.uniformsList,x_,Nt),tt.uniformsNeedUpdate=!1),tt.isSpriteMaterial&&Dl.setValue(nt,"center",At.center),Dl.setValue(nt,"modelViewMatrix",At.modelViewMatrix),Dl.setValue(nt,"normalMatrix",At.normalMatrix),Dl.setValue(nt,"modelMatrix",At.matrixWorld),tt.isShaderMaterial||tt.isRawShaderMaterial){const Ic=tt.uniformsGroups;for(let sR=0,$le=Ic.length;sR<$le;sR++)if(xn.isWebGL2){const v5=Ic[sR];et.update(v5,v_),et.bind(v5,v_)}else console.warn("THREE.WebGLRenderer: Uniform Buffer Objects can only be used with WebGL 2.")}return v_}(ve,ot,Mt,tt,At);gn.setMaterial(tt,Pi);let rr=Mt.index,Fr=1;!0===tt.wireframe&&(rr=_n.getWireframeAttribute(Mt),Fr=2);const Sr=Mt.drawRange,Er=Mt.attributes.position;let Do=Sr.start*Fr,Ac=(Sr.start+Sr.count)*Fr;null!==fi&&(Do=Math.max(Do,fi.start*Fr),Ac=Math.min(Ac,(fi.start+fi.count)*Fr)),null!==rr?(Do=Math.max(Do,0),Ac=Math.min(Ac,rr.count)):null!=Er&&(Do=Math.max(Do,0),Ac=Math.min(Ac,Er.count));const kp=Ac-Do;if(kp<0||kp===1/0)return;ke.setup(At,tt,Ji,Mt,rr);let y_,Ao=sn;if(null!==rr&&(y_=$n.get(rr),Ao=wn,Ao.setIndex(y_)),At.isMesh)!0===tt.wireframe?(gn.setLineWidth(tt.wireframeLinewidth*zt()),Ao.setMode(1)):Ao.setMode(4);else if(At.isLine){let Tr=tt.linewidth;void 0===Tr&&(Tr=1),gn.setLineWidth(Tr*zt()),Ao.setMode(At.isLineSegments?1:At.isLineLoop?2:3)}else At.isPoints?Ao.setMode(0):At.isSprite&&Ao.setMode(4);if(At.isInstancedMesh)Ao.renderInstances(Do,kp,At.count);else if(Mt.isInstancedBufferGeometry){const nR=Math.min(Mt.instanceCount,void 0!==Mt._maxInstanceCount?Mt._maxInstanceCount:1/0);Ao.renderInstances(Do,kp,nR)}else Ao.render(Do,kp)},this.compile=function(ve,ot){function Mt(tt,At,fi){!0===tt.transparent&&2===tt.side&&!1===tt.forceSinglePass?(tt.side=1,tt.needsUpdate=!0,vu(tt,At,fi),tt.side=0,tt.needsUpdate=!0,vu(tt,At,fi),tt.side=2):vu(tt,At,fi)}T=Ar.get(ve),T.init(),R.push(T),ve.traverseVisible(function(tt){tt.isLight&&tt.layers.test(ot.layers)&&(T.pushLight(tt),tt.castShadow&&T.pushShadow(tt))}),T.setupLights(k.useLegacyLights),ve.traverse(function(tt){const At=tt.material;if(At)if(Array.isArray(At))for(let fi=0;fi<At.length;fi++)Mt(At[fi],ve,tt);else Mt(At,ve,tt)}),R.pop(),T=null};let He=null;function Qt(){Wn.stop()}function Ln(){Wn.start()}const Wn=new FV;function bs(ve,ot,Mt,tt){if(!1===ve.visible)return;if(ve.layers.test(ot.layers))if(ve.isGroup)Mt=ve.renderOrder;else if(ve.isLOD)!0===ve.autoUpdate&&ve.update(ot);else if(ve.isLight)T.pushLight(ve),ve.castShadow&&T.pushShadow(ve);else if(ve.isSprite){if(!ve.frustumCulled||dt.intersectsSprite(ve)){tt&&at.setFromMatrixPosition(ve.matrixWorld).applyMatrix4(pn);const Pi=xi.update(ve),Ji=ve.material;Ji.visible&&S.push(ve,Pi,Ji,Mt,at.z,null)}}else if((ve.isMesh||ve.isLine||ve.isPoints)&&(ve.isSkinnedMesh&&ve.skeleton.frame!==On.render.frame&&(ve.skeleton.update(),ve.skeleton.frame=On.render.frame),!ve.frustumCulled||dt.intersectsObject(ve))){tt&&at.setFromMatrixPosition(ve.matrixWorld).applyMatrix4(pn);const Pi=xi.update(ve),Ji=ve.material;if(Array.isArray(Ji)){const rr=Pi.groups;for(let Fr=0,Sr=rr.length;Fr<Sr;Fr++){const Er=rr[Fr],Do=Ji[Er.materialIndex];Do&&Do.visible&&S.push(ve,Pi,Do,Mt,at.z,Er)}}else Ji.visible&&S.push(ve,Pi,Ji,Mt,at.z,null)}const fi=ve.children;for(let Pi=0,Ji=fi.length;Pi<Ji;Pi++)bs(fi[Pi],ot,Mt,tt)}function aa(ve,ot,Mt,tt){const At=ve.opaque,fi=ve.transmissive,Pi=ve.transparent;T.setupLightsView(Mt),!0===Ye&&we.setGlobalState(k.clippingPlanes,Mt),fi.length>0&&function Tl(ve,ot,Mt){const tt=xn.isWebGL2;null===Ot&&(Ot=new Jg(1024,1024,{generateMipmaps:!0,type:en.has("EXT_color_buffer_half_float")?cw:Wg,minFilter:$g,samples:tt&&!0===s?4:0}));const At=k.getRenderTarget();k.setRenderTarget(Ot),k.clear();const fi=k.toneMapping;k.toneMapping=0,uh(ve,ot,Mt),k.toneMapping=fi,Nt.updateMultisampleRenderTarget(Ot),Nt.updateRenderTargetMipmap(Ot),k.setRenderTarget(At)}(At,ot,Mt),tt&&gn.viewport(ae.copy(tt)),At.length>0&&uh(At,ot,Mt),fi.length>0&&uh(fi,ot,Mt),Pi.length>0&&uh(Pi,ot,Mt),gn.buffers.depth.setTest(!0),gn.buffers.depth.setMask(!0),gn.buffers.color.setMask(!0),gn.setPolygonOffset(!1)}function uh(ve,ot,Mt){const tt=!0===ot.isScene?ot.overrideMaterial:null;for(let At=0,fi=ve.length;At<fi;At++){const Pi=ve[At],Ji=Pi.object,rr=Pi.geometry,Fr=null===tt?Pi.material:tt,Sr=Pi.group;Ji.layers.test(Mt.layers)&&io(Ji,ot,Mt,rr,Fr,Sr)}}function io(ve,ot,Mt,tt,At,fi){ve.onBeforeRender(k,ot,Mt,tt,At,fi),ve.modelViewMatrix.multiplyMatrices(Mt.matrixWorldInverse,ve.matrixWorld),ve.normalMatrix.getNormalMatrix(ve.modelViewMatrix),At.onBeforeRender(k,ot,Mt,tt,ve,fi),!0===At.transparent&&2===At.side&&!1===At.forceSinglePass?(At.side=1,At.needsUpdate=!0,k.renderBufferDirect(Mt,ot,tt,At,ve,fi),At.side=0,At.needsUpdate=!0,k.renderBufferDirect(Mt,ot,tt,At,ve,fi),At.side=2):k.renderBufferDirect(Mt,ot,tt,At,ve,fi),ve.onAfterRender(k,ot,Mt,tt,At,fi)}function vu(ve,ot,Mt){!0!==ot.isScene&&(ot=Ut);const tt=ii.get(ve),At=T.state.lights,Pi=At.state.version,Ji=ri.getParameters(ve,At.state,T.state.shadowsArray,ot,Mt),rr=ri.getProgramCacheKey(Ji);let Fr=tt.programs;tt.environment=ve.isMeshStandardMaterial?ot.environment:null,tt.fog=ot.fog,tt.envMap=(ve.isMeshStandardMaterial?cn:Wt).get(ve.envMap||tt.environment),void 0===Fr&&(ve.addEventListener("dispose",_r),Fr=new Map,tt.programs=Fr);let Sr=Fr.get(rr);if(void 0!==Sr){if(tt.currentProgram===Sr&&tt.lightsStateVersion===Pi)return dh(ve,Ji),Sr}else Ji.uniforms=ri.getUniforms(ve),ve.onBuild(Mt,Ji,k),ve.onBeforeCompile(Ji,k),Sr=ri.acquireProgram(Ji,rr),Fr.set(rr,Sr),tt.uniforms=Ji.uniforms;const Er=tt.uniforms;(!ve.isShaderMaterial&&!ve.isRawShaderMaterial||!0===ve.clipping)&&(Er.clippingPlanes=we.uniform),dh(ve,Ji),tt.needsLights=function jle(ve){return ve.isMeshLambertMaterial||ve.isMeshToonMaterial||ve.isMeshPhongMaterial||ve.isMeshStandardMaterial||ve.isShadowMaterial||ve.isShaderMaterial&&!0===ve.lights}(ve),tt.lightsStateVersion=Pi,tt.needsLights&&(Er.ambientLightColor.value=At.state.ambient,Er.lightProbe.value=At.state.probe,Er.directionalLights.value=At.state.directional,Er.directionalLightShadows.value=At.state.directionalShadow,Er.spotLights.value=At.state.spot,Er.spotLightShadows.value=At.state.spotShadow,Er.rectAreaLights.value=At.state.rectArea,Er.ltc_1.value=At.state.rectAreaLTC1,Er.ltc_2.value=At.state.rectAreaLTC2,Er.pointLights.value=At.state.point,Er.pointLightShadows.value=At.state.pointShadow,Er.hemisphereLights.value=At.state.hemi,Er.directionalShadowMap.value=At.state.directionalShadowMap,Er.directionalShadowMatrix.value=At.state.directionalShadowMatrix,Er.spotShadowMap.value=At.state.spotShadowMap,Er.spotLightMatrix.value=At.state.spotLightMatrix,Er.spotLightMap.value=At.state.spotLightMap,Er.pointShadowMap.value=At.state.pointShadowMap,Er.pointShadowMatrix.value=At.state.pointShadowMatrix);const Do=Sr.getUniforms(),Ac=jS.seqWithValue(Do.seq,Er);return tt.currentProgram=Sr,tt.uniformsList=Ac,Sr}function dh(ve,ot){const Mt=ii.get(ve);Mt.outputEncoding=ot.outputEncoding,Mt.instancing=ot.instancing,Mt.skinning=ot.skinning,Mt.morphTargets=ot.morphTargets,Mt.morphNormals=ot.morphNormals,Mt.morphColors=ot.morphColors,Mt.morphTargetsCount=ot.morphTargetsCount,Mt.numClippingPlanes=ot.numClippingPlanes,Mt.numIntersection=ot.numClipIntersection,Mt.vertexAlphas=ot.vertexAlphas,Mt.vertexTangents=ot.vertexTangents,Mt.toneMapping=ot.toneMapping}Wn.setAnimationLoop(function Ct(ve){He&&He(ve)}),typeof self<"u"&&Wn.setContext(self),this.setAnimationLoop=function(ve){He=ve,yn.setAnimationLoop(ve),null===ve?Wn.stop():Wn.start()},yn.addEventListener("sessionstart",Qt),yn.addEventListener("sessionend",Ln),this.render=function(ve,ot){if(void 0===ot||!0===ot.isCamera){if(!0!==F){if(!0===ve.matrixWorldAutoUpdate&&ve.updateMatrixWorld(),null===ot.parent&&!0===ot.matrixWorldAutoUpdate&&ot.updateMatrixWorld(),!0===yn.enabled&&!0===yn.isPresenting&&(!0===yn.cameraAutoUpdate&&yn.updateCamera(ot),ot=yn.getCamera()),!0===ve.isScene&&ve.onBeforeRender(k,ve,ot,V),T=Ar.get(ve,R.length),T.init(),R.push(T),pn.multiplyMatrices(ot.projectionMatrix,ot.matrixWorldInverse),dt.setFromProjectionMatrix(pn),gt=this.localClippingEnabled,Ye=we.init(this.clippingPlanes,gt),S=qr.get(ve,I.length),S.init(),I.push(S),bs(ve,ot,0,k.sortObjects),S.finish(),!0===k.sortObjects&&S.sort(xt,Qe),!0===Ye&&we.beginShadows(),de.render(T.state.shadowsArray,ve,ot),!0===Ye&&we.endShadows(),!0===this.info.autoReset&&this.info.reset(),vt.render(S,ve),T.setupLights(k.useLegacyLights),ot.isArrayCamera){const tt=ot.cameras;for(let At=0,fi=tt.length;At<fi;At++){const Pi=tt[At];aa(S,ve,Pi,Pi.viewport)}}else aa(S,ve,ot);null!==V&&(Nt.updateMultisampleRenderTarget(V),Nt.updateRenderTargetMipmap(V)),!0===ve.isScene&&ve.onAfterRender(k,ve,ot),ke.resetDefaultState(),X=-1,ee=null,R.pop(),T=R.length>0?R[R.length-1]:null,I.pop(),S=I.length>0?I[I.length-1]:null}}else console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.")},this.getActiveCubeFace=function(){return G},this.getActiveMipmapLevel=function(){return W},this.getRenderTarget=function(){return V},this.setRenderTargetTextures=function(ve,ot,Mt){ii.get(ve.texture).__webglTexture=ot,ii.get(ve.depthTexture).__webglTexture=Mt;const tt=ii.get(ve);tt.__hasExternalTextures=!0,tt.__hasExternalTextures&&(tt.__autoAllocateDepthBuffer=void 0===Mt,tt.__autoAllocateDepthBuffer||!0===en.has("WEBGL_multisampled_render_to_texture")&&(console.warn("THREE.WebGLRenderer: Render-to-texture extension was disabled because an external texture was provided"),tt.__useRenderToTexture=!1))},this.setRenderTargetFramebuffer=function(ve,ot){const Mt=ii.get(ve);Mt.__webglFramebuffer=ot,Mt.__useDefaultFramebuffer=void 0===ot},this.setRenderTarget=function(ve,ot=0,Mt=0){V=ve,G=ot,W=Mt;let tt=!0,At=null,fi=!1,Pi=!1;if(ve){const rr=ii.get(ve);void 0!==rr.__useDefaultFramebuffer?(gn.bindFramebuffer(36160,null),tt=!1):void 0===rr.__webglFramebuffer?Nt.setupRenderTarget(ve):rr.__hasExternalTextures&&Nt.rebindTextures(ve,ii.get(ve.texture).__webglTexture,ii.get(ve.depthTexture).__webglTexture);const Fr=ve.texture;(Fr.isData3DTexture||Fr.isDataArrayTexture||Fr.isCompressedArrayTexture)&&(Pi=!0);const Sr=ii.get(ve).__webglFramebuffer;ve.isWebGLCubeRenderTarget?(At=Sr[ot],fi=!0):At=xn.isWebGL2&&ve.samples>0&&!1===Nt.useMultisampledRTT(ve)?ii.get(ve).__webglMultisampledFramebuffer:Sr,ae.copy(ve.viewport),Ee.copy(ve.scissor),J=ve.scissorTest}else ae.copy(Ge).multiplyScalar(st).floor(),Ee.copy(ft).multiplyScalar(st).floor(),J=qe;if(gn.bindFramebuffer(36160,At)&&xn.drawBuffers&&tt&&gn.drawBuffers(ve,At),gn.viewport(ae),gn.scissor(Ee),gn.setScissorTest(J),fi){const rr=ii.get(ve.texture);nt.framebufferTexture2D(36160,36064,34069+ot,rr.__webglTexture,Mt)}else if(Pi){const rr=ii.get(ve.texture);nt.framebufferTextureLayer(36160,36064,rr.__webglTexture,Mt||0,ot||0)}X=-1},this.readRenderTargetPixels=function(ve,ot,Mt,tt,At,fi,Pi){if(!ve||!ve.isWebGLRenderTarget)return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let Ji=ii.get(ve).__webglFramebuffer;if(ve.isWebGLCubeRenderTarget&&void 0!==Pi&&(Ji=Ji[Pi]),Ji){gn.bindFramebuffer(36160,Ji);try{const rr=ve.texture,Fr=rr.format,Sr=rr.type;if(Fr!==pu&&Yn.convert(Fr)!==nt.getParameter(35739))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");const Er=Sr===cw&&(en.has("EXT_color_buffer_half_float")||xn.isWebGL2&&en.has("EXT_color_buffer_float"));if(!(Sr===Wg||Yn.convert(Sr)===nt.getParameter(35738)||Sr===um&&(xn.isWebGL2||en.has("OES_texture_float")||en.has("WEBGL_color_buffer_float"))||Er))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");ot>=0&&ot<=ve.width-tt&&Mt>=0&&Mt<=ve.height-At&&nt.readPixels(ot,Mt,tt,At,Yn.convert(Fr),Yn.convert(Sr),fi)}finally{const rr=null!==V?ii.get(V).__webglFramebuffer:null;gn.bindFramebuffer(36160,rr)}}},this.copyFramebufferToTexture=function(ve,ot,Mt=0){const tt=Math.pow(2,-Mt),At=Math.floor(ot.image.width*tt),fi=Math.floor(ot.image.height*tt);Nt.setTexture2D(ot,0),nt.copyTexSubImage2D(3553,Mt,0,0,ve.x,ve.y,At,fi),gn.unbindTexture()},this.copyTextureToTexture=function(ve,ot,Mt,tt=0){const At=ot.image.width,fi=ot.image.height,Pi=Yn.convert(Mt.format),Ji=Yn.convert(Mt.type);Nt.setTexture2D(Mt,0),nt.pixelStorei(37440,Mt.flipY),nt.pixelStorei(37441,Mt.premultiplyAlpha),nt.pixelStorei(3317,Mt.unpackAlignment),ot.isDataTexture?nt.texSubImage2D(3553,tt,ve.x,ve.y,At,fi,Pi,Ji,ot.image.data):ot.isCompressedTexture?nt.compressedTexSubImage2D(3553,tt,ve.x,ve.y,ot.mipmaps[0].width,ot.mipmaps[0].height,Pi,ot.mipmaps[0].data):nt.texSubImage2D(3553,tt,ve.x,ve.y,Pi,Ji,ot.image),0===tt&&Mt.generateMipmaps&&nt.generateMipmap(3553),gn.unbindTexture()},this.copyTextureToTexture3D=function(ve,ot,Mt,tt,At=0){if(k.isWebGL1Renderer)return void console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: can only be used with WebGL2.");const fi=ve.max.x-ve.min.x+1,Pi=ve.max.y-ve.min.y+1,Ji=ve.max.z-ve.min.z+1,rr=Yn.convert(tt.format),Fr=Yn.convert(tt.type);let Sr;if(tt.isData3DTexture)Nt.setTexture3D(tt,0),Sr=32879;else{if(!tt.isDataArrayTexture)return void console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");Nt.setTexture2DArray(tt,0),Sr=35866}nt.pixelStorei(37440,tt.flipY),nt.pixelStorei(37441,tt.premultiplyAlpha),nt.pixelStorei(3317,tt.unpackAlignment);const Er=nt.getParameter(3314),Do=nt.getParameter(32878),Ac=nt.getParameter(3316),kp=nt.getParameter(3315),y_=nt.getParameter(32877),Ao=Mt.isCompressedTexture?Mt.mipmaps[0]:Mt.image;nt.pixelStorei(3314,Ao.width),nt.pixelStorei(32878,Ao.height),nt.pixelStorei(3316,ve.min.x),nt.pixelStorei(3315,ve.min.y),nt.pixelStorei(32877,ve.min.z),Mt.isDataTexture||Mt.isData3DTexture?nt.texSubImage3D(Sr,At,ot.x,ot.y,ot.z,fi,Pi,Ji,rr,Fr,Ao.data):Mt.isCompressedArrayTexture?(console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: untested support for compressed srcTexture."),nt.compressedTexSubImage3D(Sr,At,ot.x,ot.y,ot.z,fi,Pi,Ji,rr,Ao.data)):nt.texSubImage3D(Sr,At,ot.x,ot.y,ot.z,fi,Pi,Ji,rr,Fr,Ao),nt.pixelStorei(3314,Er),nt.pixelStorei(32878,Do),nt.pixelStorei(3316,Ac),nt.pixelStorei(3315,kp),nt.pixelStorei(32877,y_),0===At&&tt.generateMipmaps&&nt.generateMipmap(Sr),gn.unbindTexture()},this.initTexture=function(ve){ve.isCubeTexture?Nt.setTextureCube(ve,0):ve.isData3DTexture?Nt.setTexture3D(ve,0):ve.isDataArrayTexture||ve.isCompressedArrayTexture?Nt.setTexture2DArray(ve,0):Nt.setTexture2D(ve,0),gn.unbindTexture()},this.resetState=function(){G=0,W=0,V=null,gn.reset(),ke.reset()},typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}Object.defineProperties(H2.prototype,{physicallyCorrectLights:{get:function(){return console.warn("THREE.WebGLRenderer: the property .physicallyCorrectLights has been removed. Set renderer.useLegacyLights instead."),!this.useLegacyLights},set:function(n){console.warn("THREE.WebGLRenderer: the property .physicallyCorrectLights has been removed. Set renderer.useLegacyLights instead."),this.useLegacyLights=!n}}}),class Uie extends H2{}.prototype.isWebGL1Renderer=!0;class h4 extends Cl{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.overrideMaterial=null,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,t){return super.copy(e,t),null!==e.background&&(this.background=e.background.clone()),null!==e.environment&&(this.environment=e.environment.clone()),null!==e.fog&&(this.fog=e.fog.clone()),this.backgroundBlurriness=e.backgroundBlurriness,this.backgroundIntensity=e.backgroundIntensity,null!==e.overrideMaterial&&(this.overrideMaterial=e.overrideMaterial.clone()),this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){const t=super.toJSON(e);return null!==this.fog&&(t.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(t.object.backgroundBlurriness=this.backgroundBlurriness),1!==this.backgroundIntensity&&(t.object.backgroundIntensity=this.backgroundIntensity),t}get autoUpdate(){return console.warn("THREE.Scene: autoUpdate was renamed to matrixWorldAutoUpdate in r144."),this.matrixWorldAutoUpdate}set autoUpdate(e){console.warn("THREE.Scene: autoUpdate was renamed to matrixWorldAutoUpdate in r144."),this.matrixWorldAutoUpdate=e}}class Qa extends rh{constructor(e){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new An(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this.fog=e.fog,this}}const T4=new _e,D4=new _e,A4=new Bi,q2=new ES,YS=new Xv;class Dw extends Cl{constructor(e=new Wi,t=new Qa){super(),this.isLine=!0,this.type="Line",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=e.material,this.geometry=e.geometry,this}computeLineDistances(){const e=this.geometry;if(null===e.index){const t=e.attributes.position,i=[0];for(let r=1,s=t.count;r<s;r++)T4.fromBufferAttribute(t,r-1),D4.fromBufferAttribute(t,r),i[r]=i[r-1],i[r]+=T4.distanceTo(D4);e.setAttribute("lineDistance",new kn(i,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(e,t){const i=this.geometry,r=this.matrixWorld,s=e.params.Line.threshold,c=i.drawRange;if(null===i.boundingSphere&&i.computeBoundingSphere(),YS.copy(i.boundingSphere),YS.applyMatrix4(r),YS.radius+=s,!1===e.ray.intersectsSphere(YS))return;A4.copy(r).invert(),q2.copy(e.ray).applyMatrix4(A4);const d=s/((this.scale.x+this.scale.y+this.scale.z)/3),m=d*d,y=new _e,w=new _e,S=new _e,T=new _e,I=this.isLineSegments?2:1,R=i.index,F=i.attributes.position;if(null!==R)for(let V=Math.max(0,c.start),X=Math.min(R.count,c.start+c.count)-1;V<X;V+=I){const ee=R.getX(V),ae=R.getX(V+1);if(y.fromBufferAttribute(F,ee),w.fromBufferAttribute(F,ae),q2.distanceSqToSegment(y,w,T,S)>m)continue;T.applyMatrix4(this.matrixWorld);const J=e.ray.origin.distanceTo(T);J<e.near||J>e.far||t.push({distance:J,point:S.clone().applyMatrix4(this.matrixWorld),index:V,face:null,faceIndex:null,object:this})}else for(let V=Math.max(0,c.start),X=Math.min(F.count,c.start+c.count)-1;V<X;V+=I){if(y.fromBufferAttribute(F,V),w.fromBufferAttribute(F,V+1),q2.distanceSqToSegment(y,w,T,S)>m)continue;T.applyMatrix4(this.matrixWorld);const ae=e.ray.origin.distanceTo(T);ae<e.near||ae>e.far||t.push({distance:ae,point:S.clone().applyMatrix4(this.matrixWorld),index:V,face:null,faceIndex:null,object:this})}}updateMorphTargets(){const t=this.geometry.morphAttributes,i=Object.keys(t);if(i.length>0){const r=t[i[0]];if(void 0!==r){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let s=0,c=r.length;s<c;s++){const d=r[s].name||String(s);this.morphTargetInfluences.push(0),this.morphTargetDictionary[d]=s}}}}}const I4=new _e,P4=new _e;class KS extends Dw{constructor(e,t){super(e,t),this.isLineSegments=!0,this.type="LineSegments"}computeLineDistances(){const e=this.geometry;if(null===e.index){const t=e.attributes.position,i=[];for(let r=0,s=t.count;r<s;r+=2)I4.fromBufferAttribute(t,r),P4.fromBufferAttribute(t,r+1),i[r]=0===r?0:i[r-1],i[r+1]=i[r]+I4.distanceTo(P4);e.setAttribute("lineDistance",new kn(i,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}}class g0 extends rh{constructor(e){super(),this.isPointsMaterial=!0,this.type="PointsMaterial",this.color=new An(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}const R4=new Bi,Z2=new ES,QS=new Xv,JS=new _e;class eE extends Cl{constructor(e=new Wi,t=new g0){super(),this.isPoints=!0,this.type="Points",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=e.material,this.geometry=e.geometry,this}raycast(e,t){const i=this.geometry,r=this.matrixWorld,s=e.params.Points.threshold,c=i.drawRange;if(null===i.boundingSphere&&i.computeBoundingSphere(),QS.copy(i.boundingSphere),QS.applyMatrix4(r),QS.radius+=s,!1===e.ray.intersectsSphere(QS))return;R4.copy(r).invert(),Z2.copy(e.ray).applyMatrix4(R4);const d=s/((this.scale.x+this.scale.y+this.scale.z)/3),m=d*d,y=i.index,S=i.attributes.position;if(null!==y)for(let R=Math.max(0,c.start),k=Math.min(y.count,c.start+c.count);R<k;R++){const F=y.getX(R);JS.fromBufferAttribute(S,F),k4(JS,F,m,r,e,t,this)}else for(let R=Math.max(0,c.start),k=Math.min(S.count,c.start+c.count);R<k;R++)JS.fromBufferAttribute(S,R),k4(JS,R,m,r,e,t,this)}updateMorphTargets(){const t=this.geometry.morphAttributes,i=Object.keys(t);if(i.length>0){const r=t[i[0]];if(void 0!==r){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let s=0,c=r.length;s<c;s++){const d=r[s].name||String(s);this.morphTargetInfluences.push(0),this.morphTargetDictionary[d]=s}}}}}function k4(n,e,t,i,r,s,c){const d=Z2.distanceSqToPoint(n);if(d<t){const m=new _e;Z2.closestPointToPoint(n,m),m.applyMatrix4(i);const y=r.ray.origin.distanceTo(m);if(y<r.near||y>r.far)return;s.push({distance:y,distanceToRay:Math.sqrt(d),point:m,index:e,face:null,object:c})}}class q4 extends rh{constructor(e){super(),this.isMeshPhongMaterial=!0,this.type="MeshPhongMaterial",this.color=new An(16777215),this.specular=new An(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new An(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new Pt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}function mu(n,e,t){return _P(n)?new n.constructor(n.subarray(e,void 0!==t?t:n.length)):n.slice(e,t)}function l_(n,e,t){return!n||!t&&n.constructor===e?n:"number"==typeof e.BYTES_PER_ELEMENT?new e(n):Array.prototype.slice.call(n)}function _P(n){return ArrayBuffer.isView(n)&&!(n instanceof DataView)}class hE{constructor(e,t,i,r){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=void 0!==r?r:new t.constructor(i),this.sampleValues=t,this.valueSize=i,this.settings=null,this.DefaultSettings_={}}evaluate(e){const t=this.parameterPositions;let i=this._cachedIndex,r=t[i],s=t[i-1];e:{t:{let c;n:{i:if(!(e<r)){for(let d=i+2;;){if(void 0===r){if(e<s)break i;return i=t.length,this._cachedIndex=i,this.copySampleValue_(i-1)}if(i===d)break;if(s=r,r=t[++i],e<r)break t}c=t.length;break n}if(e>=s)break e;{const d=t[1];e<d&&(i=2,s=d);for(let m=i-2;;){if(void 0===s)return this._cachedIndex=0,this.copySampleValue_(0);if(i===m)break;if(r=s,s=t[--i-1],e>=s)break t}c=i,i=0}}for(;i<c;){const d=i+c>>>1;e<t[d]?c=d:i=d+1}if(r=t[i],s=t[i-1],void 0===s)return this._cachedIndex=0,this.copySampleValue_(0);if(void 0===r)return i=t.length,this._cachedIndex=i,this.copySampleValue_(i-1)}this._cachedIndex=i,this.intervalChanged_(i,s,r)}return this.interpolate_(i,s,e,r)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(e){const t=this.resultBuffer,i=this.sampleValues,r=this.valueSize,s=e*r;for(let c=0;c!==r;++c)t[c]=i[s+c];return t}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}class Hre extends hE{constructor(e,t,i,r){super(e,t,i,r),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:2400,endingEnd:2400}}intervalChanged_(e,t,i){const r=this.parameterPositions;let s=e-2,c=e+1,d=r[s],m=r[c];if(void 0===d)switch(this.getSettings_().endingStart){case 2401:s=e,d=2*t-i;break;case 2402:s=r.length-2,d=t+r[s]-r[s+1];break;default:s=e,d=i}if(void 0===m)switch(this.getSettings_().endingEnd){case 2401:c=e,m=2*i-t;break;case 2402:c=1,m=i+r[1]-r[0];break;default:c=e-1,m=t}const y=.5*(i-t),w=this.valueSize;this._weightPrev=y/(t-d),this._weightNext=y/(m-i),this._offsetPrev=s*w,this._offsetNext=c*w}interpolate_(e,t,i,r){const s=this.resultBuffer,c=this.sampleValues,d=this.valueSize,m=e*d,y=m-d,w=this._offsetPrev,S=this._offsetNext,T=this._weightPrev,I=this._weightNext,R=(i-t)/(r-t),k=R*R,F=k*R,G=-T*F+2*T*k-T*R,W=(1+T)*F+(-1.5-2*T)*k+(-.5+T)*R+1,V=(-1-I)*F+(1.5+I)*k+.5*R,X=I*F-I*k;for(let ee=0;ee!==d;++ee)s[ee]=G*c[w+ee]+W*c[y+ee]+V*c[m+ee]+X*c[S+ee];return s}}class X4 extends hE{constructor(e,t,i,r){super(e,t,i,r)}interpolate_(e,t,i,r){const s=this.resultBuffer,c=this.sampleValues,d=this.valueSize,m=e*d,y=m-d,w=(i-t)/(r-t),S=1-w;for(let T=0;T!==d;++T)s[T]=c[y+T]*S+c[m+T]*w;return s}}class Gre extends hE{constructor(e,t,i,r){super(e,t,i,r)}interpolate_(e){return this.copySampleValue_(e-1)}}class lh{constructor(e,t,i,r){if(void 0===e)throw new Error("THREE.KeyframeTrack: track name is undefined");if(void 0===t||0===t.length)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=l_(t,this.TimeBufferType),this.values=l_(i,this.ValueBufferType),this.setInterpolation(r||this.DefaultInterpolation)}static toJSON(e){const t=e.constructor;let i;if(t.toJSON!==this.toJSON)i=t.toJSON(e);else{i={name:e.name,times:l_(e.times,Array),values:l_(e.values,Array)};const r=e.getInterpolation();r!==e.DefaultInterpolation&&(i.interpolation=r)}return i.type=e.ValueTypeName,i}InterpolantFactoryMethodDiscrete(e){return new Gre(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodLinear(e){return new X4(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodSmooth(e){return new Hre(this.times,this.values,this.getValueSize(),e)}setInterpolation(e){let t;switch(e){case 2300:t=this.InterpolantFactoryMethodDiscrete;break;case 2301:t=this.InterpolantFactoryMethodLinear;break;case 2302:t=this.InterpolantFactoryMethodSmooth}if(void 0===t){const i="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant){if(e===this.DefaultInterpolation)throw new Error(i);this.setInterpolation(this.DefaultInterpolation)}return console.warn("THREE.KeyframeTrack:",i),this}return this.createInterpolant=t,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return 2300;case this.InterpolantFactoryMethodLinear:return 2301;case this.InterpolantFactoryMethodSmooth:return 2302}}getValueSize(){return this.values.length/this.times.length}shift(e){if(0!==e){const t=this.times;for(let i=0,r=t.length;i!==r;++i)t[i]+=e}return this}scale(e){if(1!==e){const t=this.times;for(let i=0,r=t.length;i!==r;++i)t[i]*=e}return this}trim(e,t){const i=this.times,r=i.length;let s=0,c=r-1;for(;s!==r&&i[s]<e;)++s;for(;-1!==c&&i[c]>t;)--c;if(++c,0!==s||c!==r){s>=c&&(c=Math.max(c,1),s=c-1);const d=this.getValueSize();this.times=mu(i,s,c),this.values=mu(this.values,s*d,c*d)}return this}validate(){let e=!0;const t=this.getValueSize();t-Math.floor(t)!=0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),e=!1);const i=this.times,r=this.values,s=i.length;0===s&&(console.error("THREE.KeyframeTrack: Track is empty.",this),e=!1);let c=null;for(let d=0;d!==s;d++){const m=i[d];if("number"==typeof m&&isNaN(m)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,d,m),e=!1;break}if(null!==c&&c>m){console.error("THREE.KeyframeTrack: Out of order keys.",this,d,m,c),e=!1;break}c=m}if(void 0!==r&&_P(r))for(let d=0,m=r.length;d!==m;++d){const y=r[d];if(isNaN(y)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,d,y),e=!1;break}}return e}optimize(){const e=mu(this.times),t=mu(this.values),i=this.getValueSize(),r=2302===this.getInterpolation(),s=e.length-1;let c=1;for(let d=1;d<s;++d){let m=!1;const y=e[d];if(y!==e[d+1]&&(1!==d||y!==e[0]))if(r)m=!0;else{const S=d*i,T=S-i,I=S+i;for(let R=0;R!==i;++R){const k=t[S+R];if(k!==t[T+R]||k!==t[I+R]){m=!0;break}}}if(m){if(d!==c){e[c]=e[d];const S=d*i,T=c*i;for(let I=0;I!==i;++I)t[T+I]=t[S+I]}++c}}if(s>0){e[c]=e[s];for(let d=s*i,m=c*i,y=0;y!==i;++y)t[m+y]=t[d+y];++c}return c!==e.length?(this.times=mu(e,0,c),this.values=mu(t,0,c*i)):(this.times=e,this.values=t),this}clone(){const e=mu(this.times,0),t=mu(this.values,0),r=new(0,this.constructor)(this.name,e,t);return r.createInterpolant=this.createInterpolant,r}}lh.prototype.TimeBufferType=Float32Array,lh.prototype.ValueBufferType=Float32Array,lh.prototype.DefaultInterpolation=2301;class v0 extends lh{}v0.prototype.ValueTypeName="bool",v0.prototype.ValueBufferType=Array,v0.prototype.DefaultInterpolation=2300,v0.prototype.InterpolantFactoryMethodLinear=void 0,v0.prototype.InterpolantFactoryMethodSmooth=void 0;(class Y4 extends lh{}).prototype.ValueTypeName="color";(class pE extends lh{}).prototype.ValueTypeName="number";class jre extends hE{constructor(e,t,i,r){super(e,t,i,r)}interpolate_(e,t,i,r){const s=this.resultBuffer,c=this.sampleValues,d=this.valueSize,m=(i-t)/(r-t);let y=e*d;for(let w=y+d;y!==w;y+=4)wl.slerpFlat(s,0,c,y-d,c,y,m);return s}}class Ow extends lh{InterpolantFactoryMethodLinear(e){return new jre(this.times,this.values,this.getValueSize(),e)}}Ow.prototype.ValueTypeName="quaternion",Ow.prototype.DefaultInterpolation=2301,Ow.prototype.InterpolantFactoryMethodSmooth=void 0;class x0 extends lh{}x0.prototype.ValueTypeName="string",x0.prototype.ValueBufferType=Array,x0.prototype.DefaultInterpolation=2300,x0.prototype.InterpolantFactoryMethodLinear=void 0,x0.prototype.InterpolantFactoryMethodSmooth=void 0;(class fE extends lh{}).prototype.ValueTypeName="vector";const b0={enabled:!1,files:{},add:function(n,e){!1!==this.enabled&&(this.files[n]=e)},get:function(n){if(!1!==this.enabled)return this.files[n]},remove:function(n){delete this.files[n]},clear:function(){this.files={}}};class K4{constructor(e,t,i){const r=this;let m,s=!1,c=0,d=0;const y=[];this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=i,this.itemStart=function(w){d++,!1===s&&void 0!==r.onStart&&r.onStart(w,c,d),s=!0},this.itemEnd=function(w){c++,void 0!==r.onProgress&&r.onProgress(w,c,d),c===d&&(s=!1,void 0!==r.onLoad&&r.onLoad())},this.itemError=function(w){void 0!==r.onError&&r.onError(w)},this.resolveURL=function(w){return m?m(w):w},this.setURLModifier=function(w){return m=w,this},this.addHandler=function(w,S){return y.push(w,S),this},this.removeHandler=function(w){const S=y.indexOf(w);return-1!==S&&y.splice(S,2),this},this.getHandler=function(w){for(let S=0,T=y.length;S<T;S+=2){const I=y[S],R=y[S+1];if(I.global&&(I.lastIndex=0),I.test(w))return R}return null}}}const qre=new K4;class gE{constructor(e){this.manager=void 0!==e?e:qre,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(e,t){const i=this;return new Promise(function(r,s){i.load(e,r,t,s)})}parse(){}setCrossOrigin(e){return this.crossOrigin=e,this}setWithCredentials(e){return this.withCredentials=e,this}setPath(e){return this.path=e,this}setResourcePath(e){return this.resourcePath=e,this}setRequestHeader(e){return this.requestHeader=e,this}}const Ap={};class Zre extends Error{constructor(e,t){super(e),this.response=t}}class Ip extends gE{constructor(e){super(e)}load(e,t,i,r){void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);const s=b0.get(e);if(void 0!==s)return this.manager.itemStart(e),setTimeout(()=>{t&&t(s),this.manager.itemEnd(e)},0),s;if(void 0!==Ap[e])return void Ap[e].push({onLoad:t,onProgress:i,onError:r});Ap[e]=[],Ap[e].push({onLoad:t,onProgress:i,onError:r});const c=new Request(e,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),d=this.mimeType,m=this.responseType;fetch(c).then(y=>{if(200===y.status||0===y.status){if(0===y.status&&console.warn("THREE.FileLoader: HTTP Status 0 received."),typeof ReadableStream>"u"||void 0===y.body||void 0===y.body.getReader)return y;const w=Ap[e],S=y.body.getReader(),T=y.headers.get("Content-Length")||y.headers.get("X-File-Size"),I=T?parseInt(T):0,R=0!==I;let k=0;const F=new ReadableStream({start(G){!function W(){S.read().then(({done:V,value:X})=>{if(V)G.close();else{k+=X.byteLength;const ee=new ProgressEvent("progress",{lengthComputable:R,loaded:k,total:I});for(let ae=0,Ee=w.length;ae<Ee;ae++){const J=w[ae];J.onProgress&&J.onProgress(ee)}G.enqueue(X),W()}})}()}});return new Response(F)}throw new Zre(`fetch for "${y.url}" responded with ${y.status}: ${y.statusText}`,y)}).then(y=>{switch(m){case"arraybuffer":return y.arrayBuffer();case"blob":return y.blob();case"document":return y.text().then(w=>(new DOMParser).parseFromString(w,d));case"json":return y.json();default:if(void 0===d)return y.text();{const S=/charset="?([^;"\s]*)"?/i.exec(d),T=S&&S[1]?S[1].toLowerCase():void 0,I=new TextDecoder(T);return y.arrayBuffer().then(R=>I.decode(R))}}}).then(y=>{b0.add(e,y);const w=Ap[e];delete Ap[e];for(let S=0,T=w.length;S<T;S++){const I=w[S];I.onLoad&&I.onLoad(y)}}).catch(y=>{const w=Ap[e];if(void 0===w)throw this.manager.itemError(e),y;delete Ap[e];for(let S=0,T=w.length;S<T;S++){const I=w[S];I.onError&&I.onError(y)}this.manager.itemError(e)}).finally(()=>{this.manager.itemEnd(e)}),this.manager.itemStart(e)}setResponseType(e){return this.responseType=e,this}setMimeType(e){return this.mimeType=e,this}}class _E extends gE{constructor(e){super(e)}load(e,t,i,r){void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);const s=this,c=b0.get(e);if(void 0!==c)return s.manager.itemStart(e),setTimeout(function(){t&&t(c),s.manager.itemEnd(e)},0),c;const d=pw("img");function m(){w(),b0.add(e,this),t&&t(this),s.manager.itemEnd(e)}function y(S){w(),r&&r(S),s.manager.itemError(e),s.manager.itemEnd(e)}function w(){d.removeEventListener("load",m,!1),d.removeEventListener("error",y,!1)}return d.addEventListener("load",m,!1),d.addEventListener("error",y,!1),"data:"!==e.slice(0,5)&&void 0!==this.crossOrigin&&(d.crossOrigin=this.crossOrigin),s.manager.itemStart(e),d.src=e,d}}class Xre extends gE{constructor(e){super(e)}load(e,t,i,r){const s=new hm,c=new _E(this.manager);return c.setCrossOrigin(this.crossOrigin),c.setPath(this.path),c.load(e,function(d){s.image=d,s.needsUpdate=!0,void 0!==t&&t(s)},i,r),s}}class Q4 extends Cl{constructor(e,t=1){super(),this.isLight=!0,this.type="Light",this.color=new An(e),this.intensity=t}dispose(){}copy(e,t){return super.copy(e,t),this.color.copy(e.color),this.intensity=e.intensity,this}toJSON(e){const t=super.toJSON(e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,void 0!==this.groundColor&&(t.object.groundColor=this.groundColor.getHex()),void 0!==this.distance&&(t.object.distance=this.distance),void 0!==this.angle&&(t.object.angle=this.angle),void 0!==this.decay&&(t.object.decay=this.decay),void 0!==this.penumbra&&(t.object.penumbra=this.penumbra),void 0!==this.shadow&&(t.object.shadow=this.shadow.toJSON()),t}}const xP=new Bi,J4=new _e,eU=new _e;class nse extends class Kre{constructor(e){this.camera=e,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new Pt(512,512),this.map=null,this.mapPass=null,this.matrix=new Bi,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new L2,this._frameExtents=new Pt(1,1),this._viewportCount=1,this._viewports=[new Qr(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(e){const t=this.camera,i=this.matrix;J4.setFromMatrixPosition(e.matrixWorld),t.position.copy(J4),eU.setFromMatrixPosition(e.target.matrixWorld),t.lookAt(eU),t.updateMatrixWorld(),xP.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),this._frustum.setFromProjectionMatrix(xP),i.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),i.multiply(xP)}getViewport(e){return this._viewports[e]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(e){return this.camera=e.camera.clone(),this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this}clone(){return(new this.constructor).copy(this)}toJSON(){const e={};return 0!==this.bias&&(e.bias=this.bias),0!==this.normalBias&&(e.normalBias=this.normalBias),1!==this.radius&&(e.radius=this.radius),(512!==this.mapSize.x||512!==this.mapSize.y)&&(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}{constructor(){super(new O2(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}}class nU extends Q4{constructor(e,t){super(e,t),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(Cl.DEFAULT_UP),this.updateMatrix(),this.target=new Cl,this.shadow=new nse}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}class iU extends Q4{constructor(e,t){super(e,t),this.isAmbientLight=!0,this.type="AmbientLight"}}const MP="\\[\\]\\.:\\/",pse=new RegExp("["+MP+"]","g"),CP="[^"+MP+"]",fse="[^"+MP.replace("\\.","")+"]",vse=new RegExp("^"+/((?:WC+[\/:])*)/.source.replace("WC",CP)+/(WCOD+)?/.source.replace("WCOD",fse)+/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",CP)+/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",CP)+"$"),xse=["material","materials","bones","map"];class bse{constructor(e,t,i){const r=i||xs.parseTrackName(t);this._targetGroup=e,this._bindings=e.subscribe_(t,r)}getValue(e,t){this.bind();const r=this._bindings[this._targetGroup.nCachedObjects_];void 0!==r&&r.getValue(e,t)}setValue(e,t){const i=this._bindings;for(let r=this._targetGroup.nCachedObjects_,s=i.length;r!==s;++r)i[r].setValue(e,t)}bind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,i=e.length;t!==i;++t)e[t].bind()}unbind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,i=e.length;t!==i;++t)e[t].unbind()}}let xs=(()=>{class n{constructor(t,i,r){this.path=i,this.parsedPath=r||n.parseTrackName(i),this.node=n.findNode(t,this.parsedPath.nodeName),this.rootNode=t,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(t,i,r){return t&&t.isAnimationObjectGroup?new n.Composite(t,i,r):new n(t,i,r)}static sanitizeNodeName(t){return t.replace(/\s/g,"_").replace(pse,"")}static parseTrackName(t){const i=vse.exec(t);if(null===i)throw new Error("PropertyBinding: Cannot parse trackName: "+t);const r={nodeName:i[2],objectName:i[3],objectIndex:i[4],propertyName:i[5],propertyIndex:i[6]},s=r.nodeName&&r.nodeName.lastIndexOf(".");if(void 0!==s&&-1!==s){const c=r.nodeName.substring(s+1);-1!==xse.indexOf(c)&&(r.nodeName=r.nodeName.substring(0,s),r.objectName=c)}if(null===r.propertyName||0===r.propertyName.length)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+t);return r}static findNode(t,i){if(void 0===i||""===i||"."===i||-1===i||i===t.name||i===t.uuid)return t;if(t.skeleton){const r=t.skeleton.getBoneByName(i);if(void 0!==r)return r}if(t.children){const r=function(c){for(let d=0;d<c.length;d++){const m=c[d];if(m.name===i||m.uuid===i)return m;const y=r(m.children);if(y)return y}return null},s=r(t.children);if(s)return s}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(t,i){t[i]=this.targetObject[this.propertyName]}_getValue_array(t,i){const r=this.resolvedProperty;for(let s=0,c=r.length;s!==c;++s)t[i++]=r[s]}_getValue_arrayElement(t,i){t[i]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(t,i){this.resolvedProperty.toArray(t,i)}_setValue_direct(t,i){this.targetObject[this.propertyName]=t[i]}_setValue_direct_setNeedsUpdate(t,i){this.targetObject[this.propertyName]=t[i],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(t,i){this.targetObject[this.propertyName]=t[i],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(t,i){const r=this.resolvedProperty;for(let s=0,c=r.length;s!==c;++s)r[s]=t[i++]}_setValue_array_setNeedsUpdate(t,i){const r=this.resolvedProperty;for(let s=0,c=r.length;s!==c;++s)r[s]=t[i++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(t,i){const r=this.resolvedProperty;for(let s=0,c=r.length;s!==c;++s)r[s]=t[i++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(t,i){this.resolvedProperty[this.propertyIndex]=t[i]}_setValue_arrayElement_setNeedsUpdate(t,i){this.resolvedProperty[this.propertyIndex]=t[i],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(t,i){this.resolvedProperty[this.propertyIndex]=t[i],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(t,i){this.resolvedProperty.fromArray(t,i)}_setValue_fromArray_setNeedsUpdate(t,i){this.resolvedProperty.fromArray(t,i),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(t,i){this.resolvedProperty.fromArray(t,i),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(t,i){this.bind(),this.getValue(t,i)}_setValue_unbound(t,i){this.bind(),this.setValue(t,i)}bind(){let t=this.node;const i=this.parsedPath,r=i.objectName,s=i.propertyName;let c=i.propertyIndex;if(t||(t=n.findNode(this.rootNode,i.nodeName),this.node=t),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!t)return void console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.");if(r){let w=i.objectIndex;switch(r){case"materials":if(!t.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!t.material.materials)return void console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);t=t.material.materials;break;case"bones":if(!t.skeleton)return void console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);t=t.skeleton.bones;for(let S=0;S<t.length;S++)if(t[S].name===w){w=S;break}break;case"map":if("map"in t){t=t.map;break}if(!t.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!t.material.map)return void console.error("THREE.PropertyBinding: Can not bind to material.map as node.material does not have a map.",this);t=t.material.map;break;default:if(void 0===t[r])return void console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);t=t[r]}if(void 0!==w){if(void 0===t[w])return void console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,t);t=t[w]}}const d=t[s];if(void 0===d)return void console.error("THREE.PropertyBinding: Trying to update property for track: "+i.nodeName+"."+s+" but it wasn't found.",t);let m=this.Versioning.None;this.targetObject=t,void 0!==t.needsUpdate?m=this.Versioning.NeedsUpdate:void 0!==t.matrixWorldNeedsUpdate&&(m=this.Versioning.MatrixWorldNeedsUpdate);let y=this.BindingType.Direct;if(void 0!==c){if("morphTargetInfluences"===s){if(!t.geometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(!t.geometry.morphAttributes)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);void 0!==t.morphTargetDictionary[c]&&(c=t.morphTargetDictionary[c])}y=this.BindingType.ArrayElement,this.resolvedProperty=d,this.propertyIndex=c}else void 0!==d.fromArray&&void 0!==d.toArray?(y=this.BindingType.HasFromToArray,this.resolvedProperty=d):Array.isArray(d)?(y=this.BindingType.EntireArray,this.resolvedProperty=d):this.propertyName=s;this.getValue=this.GetterByBindingType[y],this.setValue=this.SetterByBindingTypeAndVersioning[y][m]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}return n.Composite=bse,n})();xs.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},xs.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},xs.prototype.GetterByBindingType=[xs.prototype._getValue_direct,xs.prototype._getValue_array,xs.prototype._getValue_arrayElement,xs.prototype._getValue_toArray],xs.prototype.SetterByBindingTypeAndVersioning=[[xs.prototype._setValue_direct,xs.prototype._setValue_direct_setNeedsUpdate,xs.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[xs.prototype._setValue_array,xs.prototype._setValue_array_setNeedsUpdate,xs.prototype._setValue_array_setMatrixWorldNeedsUpdate],[xs.prototype._setValue_arrayElement,xs.prototype._setValue_arrayElement_setNeedsUpdate,xs.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[xs.prototype._setValue_fromArray,xs.prototype._setValue_fromArray_setNeedsUpdate,xs.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]],new Float32Array(1);class mU{constructor(e=1,t=0,i=0){return this.radius=e,this.phi=t,this.theta=i,this}set(e,t,i){return this.radius=e,this.phi=t,this.theta=i,this}copy(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this}makeSafe(){return this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi)),this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,i){return this.radius=Math.sqrt(e*e+t*t+i*i),0===this.radius?(this.theta=0,this.phi=0):(this.theta=Math.atan2(e,i),this.phi=Math.acos(to(t/this.radius,-1,1))),this}clone(){return(new this.constructor).copy(this)}}typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:"150"}})),typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__="150");const Ase=/^[og]\s*(.+)?/,Ise=/^mtllib /,Pse=/^usemtl /,Rse=/^usemap /,SU=/\s+/,EU=new _e,DP=new _e,TU=new _e,DU=new _e,gu=new _e,SE=new An;function kse(){const n={objects:[],object:{},vertices:[],normals:[],colors:[],uvs:[],materials:{},materialLibraries:[],startObject:function(e,t){if(this.object&&!1===this.object.fromDeclaration)return this.object.name=e,void(this.object.fromDeclaration=!1!==t);const i=this.object&&"function"==typeof this.object.currentMaterial?this.object.currentMaterial():void 0;if(this.object&&"function"==typeof this.object._finalize&&this.object._finalize(!0),this.object={name:e||"",fromDeclaration:!1!==t,geometry:{vertices:[],normals:[],colors:[],uvs:[],hasUVIndices:!1},materials:[],smooth:!0,startMaterial:function(r,s){const c=this._finalize(!1);c&&(c.inherited||c.groupCount<=0)&&this.materials.splice(c.index,1);const d={index:this.materials.length,name:r||"",mtllib:Array.isArray(s)&&s.length>0?s[s.length-1]:"",smooth:void 0!==c?c.smooth:this.smooth,groupStart:void 0!==c?c.groupEnd:0,groupEnd:-1,groupCount:-1,inherited:!1,clone:function(m){const y={index:"number"==typeof m?m:this.index,name:this.name,mtllib:this.mtllib,smooth:this.smooth,groupStart:0,groupEnd:-1,groupCount:-1,inherited:!1};return y.clone=this.clone.bind(y),y}};return this.materials.push(d),d},currentMaterial:function(){if(this.materials.length>0)return this.materials[this.materials.length-1]},_finalize:function(r){const s=this.currentMaterial();if(s&&-1===s.groupEnd&&(s.groupEnd=this.geometry.vertices.length/3,s.groupCount=s.groupEnd-s.groupStart,s.inherited=!1),r&&this.materials.length>1)for(let c=this.materials.length-1;c>=0;c--)this.materials[c].groupCount<=0&&this.materials.splice(c,1);return r&&0===this.materials.length&&this.materials.push({name:"",smooth:this.smooth}),s}},i&&i.name&&"function"==typeof i.clone){const r=i.clone(0);r.inherited=!0,this.object.materials.push(r)}this.objects.push(this.object)},finalize:function(){this.object&&"function"==typeof this.object._finalize&&this.object._finalize(!0)},parseVertexIndex:function(e,t){const i=parseInt(e,10);return 3*(i>=0?i-1:i+t/3)},parseNormalIndex:function(e,t){const i=parseInt(e,10);return 3*(i>=0?i-1:i+t/3)},parseUVIndex:function(e,t){const i=parseInt(e,10);return 2*(i>=0?i-1:i+t/2)},addVertex:function(e,t,i){const r=this.vertices,s=this.object.geometry.vertices;s.push(r[e+0],r[e+1],r[e+2]),s.push(r[t+0],r[t+1],r[t+2]),s.push(r[i+0],r[i+1],r[i+2])},addVertexPoint:function(e){const t=this.vertices;this.object.geometry.vertices.push(t[e+0],t[e+1],t[e+2])},addVertexLine:function(e){const t=this.vertices;this.object.geometry.vertices.push(t[e+0],t[e+1],t[e+2])},addNormal:function(e,t,i){const r=this.normals,s=this.object.geometry.normals;s.push(r[e+0],r[e+1],r[e+2]),s.push(r[t+0],r[t+1],r[t+2]),s.push(r[i+0],r[i+1],r[i+2])},addFaceNormal:function(e,t,i){const r=this.vertices,s=this.object.geometry.normals;EU.fromArray(r,e),DP.fromArray(r,t),TU.fromArray(r,i),gu.subVectors(TU,DP),DU.subVectors(EU,DP),gu.cross(DU),gu.normalize(),s.push(gu.x,gu.y,gu.z),s.push(gu.x,gu.y,gu.z),s.push(gu.x,gu.y,gu.z)},addColor:function(e,t,i){const r=this.colors,s=this.object.geometry.colors;void 0!==r[e]&&s.push(r[e+0],r[e+1],r[e+2]),void 0!==r[t]&&s.push(r[t+0],r[t+1],r[t+2]),void 0!==r[i]&&s.push(r[i+0],r[i+1],r[i+2])},addUV:function(e,t,i){const r=this.uvs,s=this.object.geometry.uvs;s.push(r[e+0],r[e+1]),s.push(r[t+0],r[t+1]),s.push(r[i+0],r[i+1])},addDefaultUV:function(){const e=this.object.geometry.uvs;e.push(0,0),e.push(0,0),e.push(0,0)},addUVLine:function(e){const t=this.uvs;this.object.geometry.uvs.push(t[e+0],t[e+1])},addFace:function(e,t,i,r,s,c,d,m,y){const w=this.vertices.length;let S=this.parseVertexIndex(e,w),T=this.parseVertexIndex(t,w),I=this.parseVertexIndex(i,w);if(this.addVertex(S,T,I),this.addColor(S,T,I),void 0!==d&&""!==d){const R=this.normals.length;S=this.parseNormalIndex(d,R),T=this.parseNormalIndex(m,R),I=this.parseNormalIndex(y,R),this.addNormal(S,T,I)}else this.addFaceNormal(S,T,I);if(void 0!==r&&""!==r){const R=this.uvs.length;S=this.parseUVIndex(r,R),T=this.parseUVIndex(s,R),I=this.parseUVIndex(c,R),this.addUV(S,T,I),this.object.geometry.hasUVIndices=!0}else this.addDefaultUV()},addPointGeometry:function(e){this.object.geometry.type="Points";const t=this.vertices.length;for(let i=0,r=e.length;i<r;i++){const s=this.parseVertexIndex(e[i],t);this.addVertexPoint(s),this.addColor(s)}},addLineGeometry:function(e,t){this.object.geometry.type="Line";const i=this.vertices.length,r=this.uvs.length;for(let s=0,c=e.length;s<c;s++)this.addVertexLine(this.parseVertexIndex(e[s],i));for(let s=0,c=t.length;s<c;s++)this.addUVLine(this.parseUVIndex(t[s],r))}};return n.startObject("",!1),n}class Lse extends gE{constructor(e){super(e),this.materials=null}load(e,t,i,r){const s=this,c=new Ip(this.manager);c.setPath(this.path),c.setRequestHeader(this.requestHeader),c.setWithCredentials(this.withCredentials),c.load(e,function(d){try{t(s.parse(d))}catch(m){r?r(m):console.error(m),s.manager.itemError(e)}},i,r)}setMaterials(e){return this.materials=e,this}parse(e){const t=new kse;-1!==e.indexOf("\r\n")&&(e=e.replace(/\r\n/g,"\n")),-1!==e.indexOf("\\\n")&&(e=e.replace(/\\\n/g,""));const i=e.split("\n");let r=[];for(let d=0,m=i.length;d<m;d++){const y=i[d].trimStart();if(0===y.length)continue;const w=y.charAt(0);if("#"!==w)if("v"===w){const S=y.split(SU);switch(S[0]){case"v":t.vertices.push(parseFloat(S[1]),parseFloat(S[2]),parseFloat(S[3])),S.length>=7?(SE.setRGB(parseFloat(S[4]),parseFloat(S[5]),parseFloat(S[6])).convertSRGBToLinear(),t.colors.push(SE.r,SE.g,SE.b)):t.colors.push(void 0,void 0,void 0);break;case"vn":t.normals.push(parseFloat(S[1]),parseFloat(S[2]),parseFloat(S[3]));break;case"vt":t.uvs.push(parseFloat(S[1]),parseFloat(S[2]))}}else if("f"===w){const T=y.slice(1).trim().split(SU),I=[];for(let k=0,F=T.length;k<F;k++){const G=T[k];if(G.length>0){const W=G.split("/");I.push(W)}}const R=I[0];for(let k=1,F=I.length-1;k<F;k++){const G=I[k],W=I[k+1];t.addFace(R[0],G[0],W[0],R[1],G[1],W[1],R[2],G[2],W[2])}}else if("l"===w){const S=y.substring(1).trim().split(" ");let T=[];const I=[];if(-1===y.indexOf("/"))T=S;else for(let R=0,k=S.length;R<k;R++){const F=S[R].split("/");""!==F[0]&&T.push(F[0]),""!==F[1]&&I.push(F[1])}t.addLineGeometry(T,I)}else if("p"===w){const T=y.slice(1).trim().split(" ");t.addPointGeometry(T)}else if(null!==(r=Ase.exec(y))){const S=(" "+r[0].slice(1).trim()).slice(1);t.startObject(S)}else if(Pse.test(y))t.object.startMaterial(y.substring(7).trim(),t.materialLibraries);else if(Ise.test(y))t.materialLibraries.push(y.substring(7).trim());else if(Rse.test(y))console.warn('THREE.OBJLoader: Rendering identifier "usemap" not supported. Textures must be defined in MTL files.');else if("s"===w){if(r=y.split(" "),r.length>1){const T=r[1].trim().toLowerCase();t.object.smooth="0"!==T&&"off"!==T}else t.object.smooth=!0;const S=t.object.currentMaterial();S&&(S.smooth=t.object.smooth)}else{if("\0"===y)continue;console.warn('THREE.OBJLoader: Unexpected line: "'+y+'"')}}t.finalize();const s=new u0;if(s.materialLibraries=[].concat(t.materialLibraries),1==!(1===t.objects.length&&0===t.objects[0].geometry.vertices.length))for(let d=0,m=t.objects.length;d<m;d++){const y=t.objects[d],w=y.geometry,S=y.materials,T="Line"===w.type,I="Points"===w.type;let R=!1;if(0===w.vertices.length)continue;const k=new Wi;k.setAttribute("position",new kn(w.vertices,3)),w.normals.length>0&&k.setAttribute("normal",new kn(w.normals,3)),w.colors.length>0&&(R=!0,k.setAttribute("color",new kn(w.colors,3))),!0===w.hasUVIndices&&k.setAttribute("uv",new kn(w.uvs,2));const F=[];for(let W=0,V=S.length;W<V;W++){const X=S[W],ee=X.name+"_"+X.smooth+"_"+R;let ae=t.materials[ee];if(null!==this.materials)if(ae=this.materials.create(X.name),!T||!ae||ae instanceof Qa){if(I&&ae&&!(ae instanceof g0)){const Ee=new g0({size:10,sizeAttenuation:!1});rh.prototype.copy.call(Ee,ae),Ee.color.copy(ae.color),Ee.map=ae.map,ae=Ee}}else{const Ee=new Qa;rh.prototype.copy.call(Ee,ae),Ee.color.copy(ae.color),ae=Ee}void 0===ae&&(ae=T?new Qa:I?new g0({size:1,sizeAttenuation:!1}):new q4,ae.name=X.name,ae.flatShading=!X.smooth,ae.vertexColors=R,t.materials[ee]=ae),F.push(ae)}let G;if(F.length>1){for(let W=0,V=S.length;W<V;W++){const X=S[W];k.addGroup(X.groupStart,X.groupCount,W)}G=T?new KS(k,F):I?new eE(k,F):new Ka(k,F)}else G=T?new KS(k,F[0]):I?new eE(k,F[0]):new Ka(k,F[0]);G.name=y.name,s.add(G)}else if(t.vertices.length>0){const d=new g0({size:1,sizeAttenuation:!1}),m=new Wi;m.setAttribute("position",new kn(t.vertices,3)),t.colors.length>0&&void 0!==t.colors[0]&&(m.setAttribute("color",new kn(t.colors,3)),d.vertexColors=!0);const y=new eE(m,d);s.add(y)}return s}}const AU={type:"change"},AP={type:"start"},IU={type:"end"};class Ose extends Kg{constructor(e,t){super(),this.object=e,this.domElement=t,this.domElement.style.touchAction="none",this.enabled=!0,this.target=new _e,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},this.mouseButtons={LEFT:0,MIDDLE:1,RIGHT:2},this.touches={ONE:0,TWO:2},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this.getPolarAngle=function(){return d.phi},this.getAzimuthalAngle=function(){return d.theta},this.getDistance=function(){return this.object.position.distanceTo(this.target)},this.listenToKeyEvents=function(ke){ke.addEventListener("keydown",Ar),this._domElementKeyEvents=ke},this.stopListenToKeyEvents=function(){this._domElementKeyEvents.removeEventListener("keydown",Ar),this._domElementKeyEvents=null},this.saveState=function(){i.target0.copy(i.target),i.position0.copy(i.object.position),i.zoom0=i.object.zoom},this.reset=function(){i.target.copy(i.target0),i.object.position.copy(i.position0),i.object.zoom=i.zoom0,i.object.updateProjectionMatrix(),i.dispatchEvent(AU),i.update(),s=r.NONE},this.update=function(){const ke=new _e,et=(new wl).setFromUnitVectors(e.up,new _e(0,1,0)),En=et.clone().invert(),yn=new _e,Zn=new wl,Jn=2*Math.PI;return function(){const _r=i.object.position;ke.copy(_r).sub(i.target),ke.applyQuaternion(et),d.setFromVector3(ke),i.autoRotate&&s===r.NONE&&pe(function Ee(){return 2*Math.PI/60/60*i.autoRotateSpeed}()),i.enableDamping?(d.theta+=m.theta*i.dampingFactor,d.phi+=m.phi*i.dampingFactor):(d.theta+=m.theta,d.phi+=m.phi);let Ir=i.minAzimuthAngle,Jr=i.maxAzimuthAngle;return isFinite(Ir)&&isFinite(Jr)&&(Ir<-Math.PI?Ir+=Jn:Ir>Math.PI&&(Ir-=Jn),Jr<-Math.PI?Jr+=Jn:Jr>Math.PI&&(Jr-=Jn),d.theta=Ir<=Jr?Math.max(Ir,Math.min(Jr,d.theta)):d.theta>(Ir+Jr)/2?Math.max(Ir,d.theta):Math.min(Jr,d.theta)),d.phi=Math.max(i.minPolarAngle,Math.min(i.maxPolarAngle,d.phi)),d.makeSafe(),d.radius*=y,d.radius=Math.max(i.minDistance,Math.min(i.maxDistance,d.radius)),!0===i.enableDamping?i.target.addScaledVector(w,i.dampingFactor):i.target.add(w),ke.setFromSpherical(d),ke.applyQuaternion(En),_r.copy(i.target).add(ke),i.object.lookAt(i.target),!0===i.enableDamping?(m.theta*=1-i.dampingFactor,m.phi*=1-i.dampingFactor,w.multiplyScalar(1-i.dampingFactor)):(m.set(0,0,0),w.set(0,0,0)),y=1,!!(S||yn.distanceToSquared(i.object.position)>c||8*(1-Zn.dot(i.object.quaternion))>c)&&(i.dispatchEvent(AU),yn.copy(i.object.position),Zn.copy(i.object.quaternion),S=!1,!0)}}(),this.dispose=function(){i.domElement.removeEventListener("contextmenu",vt),i.domElement.removeEventListener("pointerdown",cn),i.domElement.removeEventListener("pointercancel",xi),i.domElement.removeEventListener("wheel",qr),i.domElement.removeEventListener("pointermove",$n),i.domElement.removeEventListener("pointerup",_n),null!==i._domElementKeyEvents&&(i._domElementKeyEvents.removeEventListener("keydown",Ar),i._domElementKeyEvents=null)};const i=this,r={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6};let s=r.NONE;const c=1e-6,d=new mU,m=new mU;let y=1;const w=new _e;let S=!1;const T=new Pt,I=new Pt,R=new Pt,k=new Pt,F=new Pt,G=new Pt,W=new Pt,V=new Pt,X=new Pt,ee=[],ae={};function J(){return Math.pow(.95,i.zoomSpeed)}function pe(ke){m.theta-=ke}function Oe(ke){m.phi-=ke}const st=function(){const ke=new _e;return function(En,yn){ke.setFromMatrixColumn(yn,0),ke.multiplyScalar(-En),w.add(ke)}}(),xt=function(){const ke=new _e;return function(En,yn){!0===i.screenSpacePanning?ke.setFromMatrixColumn(yn,1):(ke.setFromMatrixColumn(yn,0),ke.crossVectors(i.object.up,ke)),ke.multiplyScalar(En),w.add(ke)}}(),Qe=function(){const ke=new _e;return function(En,yn){const Zn=i.domElement;if(i.object.isPerspectiveCamera){ke.copy(i.object.position).sub(i.target);let Kn=ke.length();Kn*=Math.tan(i.object.fov/2*Math.PI/180),st(2*En*Kn/Zn.clientHeight,i.object.matrix),xt(2*yn*Kn/Zn.clientHeight,i.object.matrix)}else i.object.isOrthographicCamera?(st(En*(i.object.right-i.object.left)/i.object.zoom/Zn.clientWidth,i.object.matrix),xt(yn*(i.object.top-i.object.bottom)/i.object.zoom/Zn.clientHeight,i.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),i.enablePan=!1)}}();function Ge(ke){i.object.isPerspectiveCamera?y/=ke:i.object.isOrthographicCamera?(i.object.zoom=Math.max(i.minZoom,Math.min(i.maxZoom,i.object.zoom*ke)),i.object.updateProjectionMatrix(),S=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),i.enableZoom=!1)}function ft(ke){i.object.isPerspectiveCamera?y*=ke:i.object.isOrthographicCamera?(i.object.zoom=Math.max(i.minZoom,Math.min(i.maxZoom,i.object.zoom/ke)),i.object.updateProjectionMatrix(),S=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),i.enableZoom=!1)}function qe(ke){T.set(ke.clientX,ke.clientY)}function Ye(ke){k.set(ke.clientX,ke.clientY)}function zt(){1===ee.length?T.set(ee[0].pageX,ee[0].pageY):T.set(.5*(ee[0].pageX+ee[1].pageX),.5*(ee[0].pageY+ee[1].pageY))}function nt(){1===ee.length?k.set(ee[0].pageX,ee[0].pageY):k.set(.5*(ee[0].pageX+ee[1].pageX),.5*(ee[0].pageY+ee[1].pageY))}function In(){const ke=ee[0].pageX-ee[1].pageX,et=ee[0].pageY-ee[1].pageY,En=Math.sqrt(ke*ke+et*et);W.set(0,En)}function gn(ke){if(1==ee.length)I.set(ke.pageX,ke.pageY);else{const En=Yn(ke);I.set(.5*(ke.pageX+En.x),.5*(ke.pageY+En.y))}R.subVectors(I,T).multiplyScalar(i.rotateSpeed);const et=i.domElement;pe(2*Math.PI*R.x/et.clientHeight),Oe(2*Math.PI*R.y/et.clientHeight),T.copy(I)}function On(ke){if(1===ee.length)F.set(ke.pageX,ke.pageY);else{const et=Yn(ke);F.set(.5*(ke.pageX+et.x),.5*(ke.pageY+et.y))}G.subVectors(F,k).multiplyScalar(i.panSpeed),Qe(G.x,G.y),k.copy(F)}function ii(ke){const et=Yn(ke),En=ke.pageX-et.x,yn=ke.pageY-et.y,Zn=Math.sqrt(En*En+yn*yn);V.set(0,Zn),X.set(0,Math.pow(V.y/W.y,i.zoomSpeed)),Ge(X.y),W.copy(V)}function cn(ke){!1!==i.enabled&&(0===ee.length&&(i.domElement.setPointerCapture(ke.pointerId),i.domElement.addEventListener("pointermove",$n),i.domElement.addEventListener("pointerup",_n)),function rn(ke){ee.push(ke)}(ke),"touch"===ke.pointerType?function we(ke){switch(wn(ke),ee.length){case 1:switch(i.touches.ONE){case 0:if(!1===i.enableRotate)return;zt(),s=r.TOUCH_ROTATE;break;case 1:if(!1===i.enablePan)return;nt(),s=r.TOUCH_PAN;break;default:s=r.NONE}break;case 2:switch(i.touches.TWO){case 2:if(!1===i.enableZoom&&!1===i.enablePan)return;(function en(){i.enableZoom&&In(),i.enablePan&&nt()})(),s=r.TOUCH_DOLLY_PAN;break;case 3:if(!1===i.enableZoom&&!1===i.enableRotate)return;(function xn(){i.enableZoom&&In(),i.enableRotate&&zt()})(),s=r.TOUCH_DOLLY_ROTATE;break;default:s=r.NONE}break;default:s=r.NONE}s!==r.NONE&&i.dispatchEvent(AP)}(ke):function ri(ke){let et;switch(ke.button){case 0:et=i.mouseButtons.LEFT;break;case 1:et=i.mouseButtons.MIDDLE;break;case 2:et=i.mouseButtons.RIGHT;break;default:et=-1}switch(et){case 1:if(!1===i.enableZoom)return;(function dt(ke){W.set(ke.clientX,ke.clientY)})(ke),s=r.DOLLY;break;case 0:if(ke.ctrlKey||ke.metaKey||ke.shiftKey){if(!1===i.enablePan)return;Ye(ke),s=r.PAN}else{if(!1===i.enableRotate)return;qe(ke),s=r.ROTATE}break;case 2:if(ke.ctrlKey||ke.metaKey||ke.shiftKey){if(!1===i.enableRotate)return;qe(ke),s=r.ROTATE}else{if(!1===i.enablePan)return;Ye(ke),s=r.PAN}break;default:s=r.NONE}s!==r.NONE&&i.dispatchEvent(AP)}(ke))}function $n(ke){!1!==i.enabled&&("touch"===ke.pointerType?function de(ke){switch(wn(ke),s){case r.TOUCH_ROTATE:if(!1===i.enableRotate)return;gn(ke),i.update();break;case r.TOUCH_PAN:if(!1===i.enablePan)return;On(ke),i.update();break;case r.TOUCH_DOLLY_PAN:if(!1===i.enableZoom&&!1===i.enablePan)return;(function Nt(ke){i.enableZoom&&ii(ke),i.enablePan&&On(ke)})(ke),i.update();break;case r.TOUCH_DOLLY_ROTATE:if(!1===i.enableZoom&&!1===i.enableRotate)return;(function Wt(ke){i.enableZoom&&ii(ke),i.enableRotate&&gn(ke)})(ke),i.update();break;default:s=r.NONE}}(ke):function bi(ke){switch(s){case r.ROTATE:if(!1===i.enableRotate)return;!function gt(ke){I.set(ke.clientX,ke.clientY),R.subVectors(I,T).multiplyScalar(i.rotateSpeed);const et=i.domElement;pe(2*Math.PI*R.x/et.clientHeight),Oe(2*Math.PI*R.y/et.clientHeight),T.copy(I),i.update()}(ke);break;case r.DOLLY:if(!1===i.enableZoom)return;!function Ot(ke){V.set(ke.clientX,ke.clientY),X.subVectors(V,W),X.y>0?Ge(J()):X.y<0&&ft(J()),W.copy(V),i.update()}(ke);break;case r.PAN:if(!1===i.enablePan)return;!function pn(ke){F.set(ke.clientX,ke.clientY),G.subVectors(F,k).multiplyScalar(i.panSpeed),Qe(G.x,G.y),k.copy(F),i.update()}(ke)}}(ke))}function _n(ke){sn(ke),0===ee.length&&(i.domElement.releasePointerCapture(ke.pointerId),i.domElement.removeEventListener("pointermove",$n),i.domElement.removeEventListener("pointerup",_n)),i.dispatchEvent(IU),s=r.NONE}function xi(ke){sn(ke)}function qr(ke){!1===i.enabled||!1===i.enableZoom||s!==r.NONE||(ke.preventDefault(),i.dispatchEvent(AP),function at(ke){ke.deltaY<0?ft(J()):ke.deltaY>0&&Ge(J()),i.update()}(ke),i.dispatchEvent(IU))}function Ar(ke){!1===i.enabled||!1===i.enablePan||function Ut(ke){let et=!1;switch(ke.code){case i.keys.UP:ke.ctrlKey||ke.metaKey||ke.shiftKey?Oe(2*Math.PI*i.rotateSpeed/i.domElement.clientHeight):Qe(0,i.keyPanSpeed),et=!0;break;case i.keys.BOTTOM:ke.ctrlKey||ke.metaKey||ke.shiftKey?Oe(-2*Math.PI*i.rotateSpeed/i.domElement.clientHeight):Qe(0,-i.keyPanSpeed),et=!0;break;case i.keys.LEFT:ke.ctrlKey||ke.metaKey||ke.shiftKey?pe(2*Math.PI*i.rotateSpeed/i.domElement.clientHeight):Qe(i.keyPanSpeed,0),et=!0;break;case i.keys.RIGHT:ke.ctrlKey||ke.metaKey||ke.shiftKey?pe(-2*Math.PI*i.rotateSpeed/i.domElement.clientHeight):Qe(-i.keyPanSpeed,0),et=!0}et&&(ke.preventDefault(),i.update())}(ke)}function vt(ke){!1!==i.enabled&&ke.preventDefault()}function sn(ke){delete ae[ke.pointerId];for(let et=0;et<ee.length;et++)if(ee[et].pointerId==ke.pointerId)return void ee.splice(et,1)}function wn(ke){let et=ae[ke.pointerId];void 0===et&&(et=new Pt,ae[ke.pointerId]=et),et.set(ke.pageX,ke.pageY)}function Yn(ke){return ae[(ke.pointerId===ee[0].pointerId?ee[1]:ee[0]).pointerId]}i.domElement.addEventListener("contextmenu",vt),i.domElement.addEventListener("pointerdown",cn),i.domElement.addEventListener("pointercancel",xi),i.domElement.addEventListener("wheel",qr,{passive:!1}),this.update()}}const Fse=["container"];let Nse=(()=>{class n{constructor(){this.scene=new h4,this.modelLoaded=!1}initscene(){this.camera=new Da(75,window.innerWidth/window.innerHeight,.1,1e3),this.camera.position.set(0,0,5),this.renderer=new H2({antialias:!0}),this.renderer.setSize(window.innerWidth,window.innerHeight),this.container.nativeElement.appendChild(this.renderer.domElement),this.controls=new Ose(this.camera,this.renderer.domElement),this.controls.enableDamping=!0,this.controls.dampingFactor=.05,this.controls.screenSpacePanning=!1,this.ambientLight=new iU(16777215,.5),this.scene.add(this.ambientLight),this.directionalLight=new nU(16777215,1),this.directionalLight.position.set(1,1,1).normalize(),this.scene.add(this.directionalLight),this.scene.background=new An(10197915)}ngOnInit(){this.initscene(),console.log("holaaa"),this.load3DObject("../assets/3d-models/room3/textured_output.obj");const t=this.container.nativeElement;this.renderer.setSize(t.clientWidth,t.clientHeight),this.camera.lookAt(0,0,0),this.animate()}ngOnDestroy(){this.controls.dispose(),this.renderer.dispose(),this.scene.dispose()}animate(){requestAnimationFrame(()=>this.animate()),this.renderer.render(this.scene,this.camera)}load3DObject(t){return this.modelLoaded=!1,new Promise((i,r)=>{(new Lse).load(t,c=>{c.traverse(d=>{if(d instanceof Ka){c.scale.set(.5,.5,.5),this.scene.add(c);const y=(new Xre).load("../assets/3d-models/room3/textured_output.jpg");d.material=new _m({map:y}),this.modelLoaded=!0}}),i(c)},c=>{console.log(c.loaded/c.total*100+"% loaded")},c=>{console.error(`Error al cargar el objeto 3D: ${c}`)},void 0,r)})}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275cmp=Qn({type:n,selectors:[["app-dimensionmodel"]],viewQuery:function(t,i){if(1&t&&Uo(Fse,7),2&t){let r;Gi(r=ji())&&(i.container=r.first)}},decls:2,vars:0,consts:[[2,"width","100%","height","100%"],["container",""]],template:function(t,i){1&t&&jt(0,"div",0,1)}}),n})(),Bse=(()=>{class n{constructor(t){this.router=t}ngOnInit(){}reservarArriendo(){this.router.navigate(["/payment"])}}return n.\u0275fac=function(t){return new(t||n)(Ie(qs))},n.\u0275cmp=Qn({type:n,selectors:[["app-rent-form"]],decls:52,vars:0,consts:[[1,"row"],[1,"col-md-6","mb-2"],[1,"form-group"],["for","nombre"],["type","text","id","nombre",1,"form-control"],["for","apellido"],["type","text","id","apellido",1,"form-control"],["for","correo"],["type","email","id","correo",1,"form-control"],["for","telefono"],["type","tel","id","telefono",1,"form-control"],["for","fecha-inicio"],["type","date","id","fecha-inicio",1,"form-control"],["for","fecha-termino"],["type","date","id","fecha-termino",1,"form-control"],["for","rut"],["type","text","id","rut",1,"form-control"],[1,"col-md-12","mb-2"],[1,"form-check"],["type","checkbox","id","terminos",1,"form-check-input"],["for","terminos",1,"form-check-label"],[1,"col","text-center"],["type","submit",1,"btn","btn-primary",3,"click"]],template:function(t,i){1&t&&(Ae(0,"form")(1,"h2"),it(2,"Formulario de reserva"),xe(),Ae(3,"div",0)(4,"div",1)(5,"div",2)(6,"label",3),it(7,"Nombre"),xe(),jt(8,"input",4),xe()(),Ae(9,"div",1)(10,"div",2)(11,"label",5),it(12,"Apellido"),xe(),jt(13,"input",6),xe()()(),Ae(14,"div",0)(15,"div",1)(16,"div",2)(17,"label",7),it(18,"Correo"),xe(),jt(19,"input",8),xe()(),Ae(20,"div",1)(21,"div",2)(22,"label",9),it(23,"Tel\xe9fono"),xe(),jt(24,"input",10),xe()()(),Ae(25,"div",0)(26,"div",1)(27,"div",2)(28,"label",11),it(29,"Fecha de inicio"),xe(),jt(30,"input",12),xe()(),Ae(31,"div",1)(32,"div",2)(33,"label",13),it(34,"Fecha de t\xe9rmino"),xe(),jt(35,"input",14),xe()()(),Ae(36,"div",0)(37,"div",1)(38,"div",2)(39,"label",15),it(40,"RUT"),xe(),jt(41,"input",16),xe()()(),Ae(42,"div",0)(43,"div",17)(44,"div",18),jt(45,"input",19),Ae(46,"label",20),it(47,"Acepto los t\xe9rminos y condiciones y autorizo el uso de mis datos de acuerdo a la Declaraci\xf3n de Privacidad"),xe()()()(),Ae(48,"div",0)(49,"div",21)(50,"button",22),gi("click",function(){return i.reservarArriendo()}),it(51,"Reservar arriendo"),xe()()()())},dependencies:[bv,vv,yp]}),n})(),zse=(()=>{class n{constructor(t,i,r){this.activaterouter=t,this.router=i,this.roomService=r,this.room=null}ngOnInit(){let t=this.activaterouter.snapshot.paramMap.get("id");this.getRoom(t)}getRoom(t){this.roomService.getRoom(t).subscribe(i=>{this.room=i})}}return n.\u0275fac=function(t){return new(t||n)(Ie(md),Ie(qs),Ie(Iv))},n.\u0275cmp=Qn({type:n,selectors:[["app-room-component"]],decls:21,vars:0,consts:[[1,"container"],[1,"row"],[1,"col-9"],[1,"col-3"],["type","button","data-bs-toggle","modal","data-bs-target","#rentModal",1,"btn","btn-primary"],["id","rentModal","aria-labelledby","rentModal","aria-hidden","true",1,"modal","fade"],[1,"modal-dialog"],[1,"modal-content"],[1,"modal-header"],["type","button","data-bs-dismiss","modal","aria-label","Close",1,"btn-close"],[1,"modal-body"]],template:function(t,i){1&t&&(jt(0,"app-toolbar"),Ae(1,"div",0)(2,"div",1)(3,"div",2),jt(4,"app-dimensionmodel"),xe(),Ae(5,"div",3)(6,"button",4),it(7,"Buscar"),xe(),jt(8,"app-data-room-container"),xe()(),Ae(9,"div",1)(10,"div",2),jt(11,"app-map"),xe(),Ae(12,"div",3),jt(13,"app-calendar"),xe()()(),Ae(14,"div",5)(15,"div",6)(16,"div",7)(17,"div",8),jt(18,"button",9),xe(),Ae(19,"div",10),jt(20,"app-rent-form"),xe()()()())},dependencies:[cS,rQ,sQ,oQ,Nse,Bse],styles:[".modal-overlay[_ngcontent-%COMP%]{position:fixed;top:0;left:0;width:100%;height:100%;background-color:#00000080;display:flex;justify-content:center;align-items:center}.modal-container[_ngcontent-%COMP%]{background-color:#fff;padding:20px;border-radius:5px;box-shadow:0 0 10px #0000004d;position:relative}.close[_ngcontent-%COMP%]{position:absolute;top:10px;right:10px;cursor:pointer}.btn-primary[_ngcontent-%COMP%]{background-color:#007bff;color:#fff;border:none;padding:10px 20px;margin-top:20px;cursor:pointer}.btn-primary[_ngcontent-%COMP%]:hover{background-color:#0056b3}.btn[_ngcontent-%COMP%]{width:100%}"]}),n})(),PU=(()=>{class n{constructor(){}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275cmp=Qn({type:n,selectors:[["app-contact"]],decls:20,vars:0,consts:[[1,"container"],[1,"row","justify-content-center"],[1,"col-md-12"],[1,"form-group"],["for","name"],["type","text","id","name","placeholder","Ingresa tu nombre",1,"form-control"],["for","email"],["type","email","id","email","placeholder","Ingresa tu correo electr\xf3nico",1,"form-control"],["for","message"],["id","message","rows","5","placeholder","Ingresa tu mensaje",1,"form-control"],["type","submit",1,"btn","btn-primary"]],template:function(t,i){1&t&&(Ae(0,"div",0)(1,"div",1)(2,"div",2)(3,"form")(4,"h2"),it(5,"Contacto"),xe(),Ae(6,"div",3)(7,"label",4),it(8,"Nombre"),xe(),jt(9,"input",5),xe(),Ae(10,"div",3)(11,"label",6),it(12,"Correo electr\xf3nico"),xe(),jt(13,"input",7),xe(),Ae(14,"div",3)(15,"label",8),it(16,"Mensaje"),xe(),jt(17,"textarea",9),xe(),Ae(18,"button",10),it(19,"Enviar"),xe()()()()())},dependencies:[bv,vv,yp],styles:['.spacer[_ngcontent-%COMP%]{padding-bottom:30px}.mat-mdc-form-field[_ngcontent-%COMP%] + .mat-mdc-form-field[_ngcontent-%COMP%]{margin-left:8px}mat-form-field.mat-form-field[_ngcontent-%COMP%]{color:"blue"}.contact-form[_ngcontent-%COMP%]{display:grid;width:50%;margin:auto}.example-full-width[_ngcontent-%COMP%]{width:100%}.titulo-contacto[_ngcontent-%COMP%]{text-align:center}']}),n})();function Vse(n,e){if(1&n&&(Ae(0,"div",17)(1,"div",18)(2,"div",6)(3,"h5",7),it(4),xe(),Ae(5,"p",8),it(6),xe()()()()),2&n){const t=e.$implicit;Et(4),Qs(t.title),Et(2),Qs(t.content)}}let Use=(()=>{class n{constructor(t){this.router=t,this.cards=[{title:"Card 1",content:"This is the content of card 1."},{title:"Card 2",content:"This is the content of card 2."},{title:"Card 3",content:"This is the content of card 3."},{title:"Card 4",content:"This is the content of card 4."}]}ngOnInit(){}}return n.\u0275fac=function(t){return new(t||n)(Ie(qs))},n.\u0275cmp=Qn({type:n,selectors:[["app-card-grid"]],decls:23,vars:1,consts:[[1,"container"],[1,"row","justify-content-center"],[1,"col-md-8"],[1,"text-center"],[1,"col-md-8","card-column"],["data-bs-toggle","modal","data-bs-target","#contactModal",1,"card"],[1,"card-body"],[1,"card-title"],[1,"card-text"],[1,"row"],["class","col-md-6 card-column",4,"ngFor","ngForOf"],["id","contactModal","aria-labelledby","contactModal","aria-hidden","true",1,"modal","fade"],[1,"modal-dialog"],[1,"modal-content"],[1,"modal-header"],["type","button","data-bs-dismiss","modal","aria-label","Close",1,"btn-close"],[1,"modal-body"],[1,"col-md-6","card-column"],["routerLink","/faq",1,"card"]],template:function(t,i){1&t&&(Ae(0,"div",0)(1,"div",1)(2,"div",2)(3,"h1",3),it(4,"Elige la categor\xeda disponible para la pregunta que tengas"),xe()(),Ae(5,"div",1)(6,"div",4)(7,"div",5)(8,"div",6)(9,"h5",7),it(10,"Esribenos tu solicitud"),xe(),Ae(11,"p",8),it(12,"This is the content of card 1."),xe()()()()(),Ae(13,"div",9)(14,"div",9),Di(15,Vse,7,2,"div",10),xe()()(),Ae(16,"div",11)(17,"div",12)(18,"div",13)(19,"div",14),jt(20,"button",15),xe(),Ae(21,"div",16),jt(22,"app-contact"),xe()()()()()),2&t&&(Et(15),Kt("ngForOf",i.cards))},dependencies:[hp,sS,PU],styles:[".card-column[_ngcontent-%COMP%]{margin-bottom:20px}.card[_ngcontent-%COMP%]:hover{transform:scale(1.05);transition:transform .3s ease;background-color:#87ceeb}"]}),n})(),Hse=(()=>{class n{constructor(){}ngOnInit(){}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275cmp=Qn({type:n,selectors:[["app-help-component"]],decls:8,vars:0,consts:[[1,"container"],[1,"jumbotron","text-center"],[1,"display-4"],[1,"lead"]],template:function(t,i){1&t&&(jt(0,"app-toolbar"),Ae(1,"div",0)(2,"div",1)(3,"h1",2),it(4,"Centro de ayuda RooMatch"),xe(),Ae(5,"p",3),it(6,"\xbfEn que te podemos ayudar?"),xe()()(),jt(7,"app-card-grid"))},dependencies:[cS,Use]}),n})();class Gse{constructor(e="",t="",i=""){this._id=e,this.question=t,this.response=i}}let jse=(()=>{class n{constructor(t){this.http=t,this.URL_API="http://127.0.0.1:3000/api/faq",this.selectedFaq=new Gse}getFaqs(){return this.http.get(this.URL_API)}postFaq(t){}putFaq(t){}deleteFaq(t){}}return n.\u0275fac=function(t){return new(t||n)(Xe(_v))},n.\u0275prov=Yt({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();function $se(n,e){if(1&n&&(Ae(0,"mat-expansion-panel",2)(1,"mat-expansion-panel-header")(2,"mat-panel-title"),it(3),xe()(),Ae(4,"p"),it(5),xe()()),2&n){const t=e.$implicit;Et(3),Vo(" ",t.question," "),Et(2),Qs(t.response)}}let Wse=(()=>{class n{constructor(t){this.faqService=t}ngOnInit(){this.getFaqs()}getFaqs(){this.faqService.getFaqs().subscribe(t=>{this.faqService.faqs=t})}}return n.\u0275fac=function(t){return new(t||n)(Ie(jse))},n.\u0275cmp=Qn({type:n,selectors:[["app-faq"]],decls:4,vars:1,consts:[[1,"tittle-faq"],["hideToggle","",4,"ngFor","ngForOf"],["hideToggle",""]],template:function(t,i){1&t&&(Ae(0,"mat-accordion")(1,"h1",0),it(2,"PREGUNTAS FRECUENTES"),xe(),Di(3,$se,6,2,"mat-expansion-panel",1),xe()),2&t&&(Et(3),Kt("ngForOf",i.faqService.faqs))},dependencies:[hp,oq,JF,e3,sq],styles:[".mat-accordion[_ngcontent-%COMP%]{display:grid;width:100%;margin:auto}.mat-mdc-form-field[_ngcontent-%COMP%] + .mat-mdc-form-field[_ngcontent-%COMP%]{margin-left:8px}.tittle-faq[_ngcontent-%COMP%]{text-align:center}"]}),n})(),qse=(()=>{class n{constructor(){}ngOnInit(){}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275cmp=Qn({type:n,selectors:[["app-details"]],decls:50,vars:0,consts:[[1,"container"],[1,"row"],[1,"col-md-6"],[1,"text-left"],[1,"card"],[1,"card-body"],[1,"form-group"],["for","fechaInicio"],["type","text","id","fechaInicio","value","2023-06-01","disabled","",1,"form-control"],["for","fechaFin"],["type","text","id","fechaFin","value","2023-06-08","disabled","",1,"form-control"],["for","duracion"],["type","text","id","duracion","value","7 d\xedas","disabled","",1,"form-control"],["for","habitacion"],["type","text","id","habitacion","value","Habitaci\xf3n 102","disabled","",1,"form-control"],[1,"list-group"],[1,"list-group-item"],[1,"font-weight-bold"],[1,"float-right"],[1,"list-group-item","bg-info","text-white"]],template:function(t,i){1&t&&(Ae(0,"div",0)(1,"div",1)(2,"div",2)(3,"h2",3),it(4,"Detalles de la compra"),xe(),Ae(5,"div",4)(6,"div",5)(7,"div",6)(8,"label",7),it(9,"Fecha de inicio:"),xe(),jt(10,"input",8),xe(),Ae(11,"div",6)(12,"label",9),it(13,"Fecha de fin:"),xe(),jt(14,"input",10),xe(),Ae(15,"div",6)(16,"label",11),it(17,"Duraci\xf3n:"),xe(),jt(18,"input",12),xe(),Ae(19,"div",6)(20,"label",13),it(21,"Habitaci\xf3n seleccionada:"),xe(),jt(22,"input",14),xe()()()(),Ae(23,"div",2)(24,"h2",3),it(25,"Informaci\xf3n \xfatil"),xe(),Ae(26,"div",4)(27,"div",5)(28,"p"),it(29,"Aqu\xed puedes incluir informaci\xf3n \xfatil relacionada con la compra, como instrucciones de llegada, servicios adicionales, etc."),xe()()(),Ae(30,"h2",3),it(31,"Desglose del precio"),xe(),Ae(32,"div",4)(33,"div",5)(34,"ul",15)(35,"li",16)(36,"span",17),it(37,"Tarifa diaria:"),xe(),Ae(38,"span",18),it(39,"$100"),xe()(),Ae(40,"li",16)(41,"span",17),it(42,"Duraci\xf3n:"),xe(),Ae(43,"span",18),it(44,"7 d\xedas"),xe()(),Ae(45,"li",19)(46,"span",17),it(47,"Total:"),xe(),Ae(48,"span",18),it(49,"$700"),xe()()()()()()()())}}),n})(),Zse=(()=>{class n{constructor(){}ngOnInit(){}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275cmp=Qn({type:n,selectors:[["app-payment-data"]],decls:54,vars:0,consts:[[1,"container"],[1,"row"],[1,"col-md-6"],[1,"text-left"],[1,"card"],[1,"card-body"],[1,"form-group"],["for","nombre"],["type","text","id","nombre","placeholder","Ingrese su nombre",1,"form-control"],["for","apellido"],["type","text","id","apellido","placeholder","Ingrese su apellido",1,"form-control"],["for","email"],["type","email","id","email","placeholder","Ingrese su email",1,"form-control"],["for","telefono"],["type","tel","id","telefono","placeholder","Ingrese su tel\xe9fono",1,"form-control"],["for","cantidadHuespedes"],["type","number","id","cantidadHuespedes","placeholder","Ingrese la cantidad de hu\xe9spedes",1,"form-control"],["for","peticionesEspeciales"],["id","peticionesEspeciales","rows","3","placeholder","Ingrese sus peticiones especiales",1,"form-control"],["type","submit",1,"btn","btn-primary"],["for","horaLlegada"],["type","time","id","horaLlegada",1,"form-control"],[1,"list-group"],[1,"list-group-item"]],template:function(t,i){1&t&&(Ae(0,"div",0)(1,"div",1)(2,"div",2)(3,"h2",3),it(4,"Formulario de Datos"),xe(),Ae(5,"div",4)(6,"div",5)(7,"form")(8,"div",6)(9,"label",7),it(10,"Nombre:"),xe(),jt(11,"input",8),xe(),Ae(12,"div",6)(13,"label",9),it(14,"Apellido:"),xe(),jt(15,"input",10),xe(),Ae(16,"div",6)(17,"label",11),it(18,"Email:"),xe(),jt(19,"input",12),xe(),Ae(20,"div",6)(21,"label",13),it(22,"Tel\xe9fono:"),xe(),jt(23,"input",14),xe(),Ae(24,"div",6)(25,"label",15),it(26,"Cantidad de hu\xe9spedes:"),xe(),jt(27,"input",16),xe(),Ae(28,"div",6)(29,"label",17),it(30,"Peticiones especiales:"),xe(),jt(31,"textarea",18),xe(),Ae(32,"button",19),it(33,"Enviar"),xe()()()()(),Ae(34,"div",2)(35,"h2",3),it(36,"Hora de llegada"),xe(),Ae(37,"div",4)(38,"div",5)(39,"div",6)(40,"label",20),it(41,"Seleccione la hora de llegada:"),xe(),jt(42,"input",21),xe()()(),Ae(43,"h2",3),it(44,"Normas"),xe(),Ae(45,"div",4)(46,"div",5)(47,"ul",22)(48,"li",23),it(49,"1. Respetar el horario de silencio"),xe(),Ae(50,"li",23),it(51,"2. No fumar dentro de las habitaciones"),xe(),Ae(52,"li",23),it(53,"3. Mantener el orden y la limpieza"),xe()()()()()()())},dependencies:[bv,vv,yp]}),n})(),Xse=(()=>{class n{constructor(){}ngOnInit(){}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275cmp=Qn({type:n,selectors:[["app-payment-payment"]],decls:19,vars:0,consts:[[1,"container"],[1,"row"],[1,"col-md-6","offset-md-3"],[1,"card"],[1,"card-body"],[1,"card-title"],[1,"card-text"],[1,"btn","btn-primary","btn-block"]],template:function(t,i){1&t&&(Ae(0,"div",0)(1,"div",1)(2,"div",2)(3,"h2"),it(4,"Resumen de Compra"),xe(),jt(5,"hr"),Ae(6,"div",3)(7,"div",4)(8,"h5",5),it(9,"Producto: Habitaci\xf3n Est\xe1ndar"),xe(),Ae(10,"p",6),it(11,"Precio: $100"),xe(),Ae(12,"p",6),it(13,"Cantidad: 1"),xe(),jt(14,"hr"),Ae(15,"h4",6),it(16,"Total: $100"),xe(),Ae(17,"button",7),it(18,"Pagar con Flow"),xe()()()()()())}}),n})();const Yse=function(n){return{active:n}};function Kse(n,e){if(1&n&&(Ae(0,"li",10)(1,"span",11),it(2),xe(),Ae(3,"span",12),it(4),xe()()),2&n){const t=e.$implicit,i=e.index,r=ki();Kt("ngClass",uD(3,Yse,r.currentStep===i+1)),Et(2),Qs(i+1),Et(2),Qs(t.title)}}function Qse(n,e){1&n&&(Ae(0,"div",13),jt(1,"app-payment-data"),xe())}function Jse(n,e){1&n&&(Ae(0,"div",13),jt(1,"app-details"),xe())}function eoe(n,e){1&n&&(Ae(0,"div",13),jt(1,"app-payment-payment"),xe())}function toe(n,e){if(1&n){const t=Yd();Ae(0,"button",14),gi("click",function(){return As(t),Us(ki().previousStep())}),it(1,"Anterior"),xe()}}function noe(n,e){if(1&n){const t=Yd();Ae(0,"button",15),gi("click",function(){return As(t),Us(ki().nextStep())}),it(1,"Siguiente"),xe()}}let ioe=(()=>{class n{constructor(){this.currentStep=1,this.currentContent="",this.hideNextButton=!1,this.hidePreviousButton=!0,this.steps=[{title:"Tus datos",content:"data"},{title:"Detalles",content:"details"},{title:"Pago",content:"payment"}]}ngOnInit(){this.currentContent=this.steps[0].content}previousStep(){this.currentStep>1&&(this.currentStep--,this.currentContent=this.steps[this.currentStep-1].content),this.updateButtonVisibility()}nextStep(){this.currentStep<this.steps.length&&(this.currentStep++,this.currentContent=this.steps[this.currentStep-1].content),this.updateButtonVisibility()}updateButtonVisibility(){this.hideNextButton=3===this.currentStep,this.hidePreviousButton=1===this.currentStep}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275cmp=Qn({type:n,selectors:[["app-payment-component"]],decls:16,vars:6,consts:[[1,"container","mt-4"],[1,"row"],[1,"col"],[1,"stepper"],["class","step",3,"ngClass",4,"ngFor","ngForOf"],[1,"content-container"],["class","slide-in",4,"ngIf"],[1,"row","mt-4"],["class","btn btn-primary",3,"click",4,"ngIf"],["class","btn btn-primary ml-2",3,"click",4,"ngIf"],[1,"step",3,"ngClass"],[1,"step-number"],[1,"step-title"],[1,"slide-in"],[1,"btn","btn-primary",3,"click"],[1,"btn","btn-primary","ml-2",3,"click"]],template:function(t,i){1&t&&(Ae(0,"div",0)(1,"div",1)(2,"div",2)(3,"ul",3),Di(4,Kse,5,5,"li",4),xe()()(),Ae(5,"div",1)(6,"div",2)(7,"div",5)(8,"div",5),Di(9,Qse,2,0,"div",6),Di(10,Jse,2,0,"div",6),Di(11,eoe,2,0,"div",6),xe()()()(),Ae(12,"div",7)(13,"div",2),Di(14,toe,2,0,"button",8),Di(15,noe,2,0,"button",9),xe()()()),2&t&&(Et(4),Kt("ngForOf",i.steps),Et(5),Kt("ngIf","details"===i.currentContent),Et(1),Kt("ngIf","data"===i.currentContent),Et(1),Kt("ngIf","payment"===i.currentContent),Et(3),Kt("ngIf",!i.hidePreviousButton),Et(1),Kt("ngIf",!i.hideNextButton))},dependencies:[KM,hp,Yf,qse,Zse,Xse],styles:[".stepper[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;list-style-type:none;padding:0;margin:0}.step[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;padding:0;margin:0;text-align:center}.step-number[_ngcontent-%COMP%]{width:30px;height:30px;display:flex;justify-content:center;align-items:center;background-color:#f8f9fa;border-radius:50%;margin-bottom:5px}.step-title[_ngcontent-%COMP%]{font-size:14px}.step.active[_ngcontent-%COMP%]   .step-number[_ngcontent-%COMP%]{background-color:#007bff;color:#fff}.slide-in[_ngcontent-%COMP%]{animation:slide-in .5s ease-in-out}@keyframes slide-in{0%{opacity:0;transform:translate(100%)}to{opacity:1;transform:translate(0)}}"]}),n})(),roe=(()=>{class n{constructor(){}ngOnInit(){}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275cmp=Qn({type:n,selectors:[["app-sidebar"]],decls:32,vars:0,consts:[[1,"d-flex","flex-column","align-items-center","align-items-sm-start","px-3","pt-2","text-white","min-vh-100"],["href","/",1,"d-flex","align-items-center","pb-3","mb-md-0","me-md-auto","text-white","text-decoration-none"],[1,"fs-5","d-none","d-sm-inline"],["id","menu",1,"nav","nav-pills","flex-column","mb-sm-auto","mb-0","align-items-center","align-items-sm-start"],[1,"nav-item"],["href","#",1,"nav-link","align-middle","px-0"],[1,"fs-4","bi-house"],[1,"ms-1","d-none","d-sm-inline"],["href","#",1,"nav-link","px-0","align-middle"],[1,"fs-4","bi-people"],[1,"fs-4","bi-book"],[1,"fs-4","bi-megaphone"],[1,"dropdown","pb-4"],[1,"fs-4","bi-box-arrow-in-left"]],template:function(t,i){1&t&&(Ae(0,"div",0)(1,"a",1)(2,"span",2),it(3,"Roomatch"),xe()(),Ae(4,"ul",3)(5,"li",4)(6,"a",5),jt(7,"i",6),Ae(8,"span",7),it(9,"Home"),xe()()(),Ae(10,"li")(11,"a",8),jt(12,"i",9),Ae(13,"span",7),it(14,"Usuarios"),xe()()(),Ae(15,"li")(16,"a",8),jt(17,"i",10),Ae(18,"span",7),it(19,"Reservas"),xe()()(),Ae(20,"li")(21,"a",8),jt(22,"i",11),Ae(23,"span",7),it(24,"Reclamos"),xe()()()(),Ae(25,"div",12)(26,"ul",3)(27,"li")(28,"a",8),jt(29,"i",13),Ae(30,"span",7),it(31,"Salir"),xe()()()()()())}}),n})();const soe=[{path:"index",component:cK},{path:"results",component:DK},{path:"room/:id",component:zse},{path:"help",component:Hse},{path:"login",component:mz},{path:"register",component:gz},{path:"faq",component:Wse},{path:"claim",component:PU},{path:"payment",component:ioe},{path:"admin",component:(()=>{class n{constructor(){}ngOnInit(){}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275cmp=Qn({type:n,selectors:[["app-admin-component"]],decls:7,vars:0,consts:[[1,"container-fluid"],[1,"row","flex-nowrap"],[1,"col-auto","col-md-3","col-xl-2","px-sm-2","px-0","bg-dark"],[1,"col","py-3"]],template:function(t,i){1&t&&(Ae(0,"div",0)(1,"div",1)(2,"div",2),jt(3,"app-sidebar"),xe(),Ae(4,"div",3)(5,"p"),it(6,"Aqu\xed es donde va todo el contenido"),xe()()()())},dependencies:[roe]}),n})()},{path:"",redirectTo:"/index",pathMatch:"full"}];let ooe=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=Gn({type:n}),n.\u0275inj=Bn({imports:[pz.forRoot(soe),pz]}),n})(),aoe=(()=>{class n{constructor(){this.title="Sistema web de arriendo"}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275cmp=Qn({type:n,selectors:[["app-root"]],decls:1,vars:0,template:function(t,i){1&t&&jt(0,"router-outlet")},dependencies:[DI]}),n})(),uoe=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=Gn({type:n}),n.\u0275inj=Bn({imports:[mC,Ki,mC,Ki]}),n})(),doe=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=Gn({type:n}),n.\u0275inj=Bn({imports:[Ki,Ki]}),n})(),Soe=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=Gn({type:n}),n.\u0275inj=Bn({imports:[mC,kb,Ki,CA,au,mC,Ki,CA,doe]}),n})();const Aoe={provide:new Vt("mat-tooltip-scroll-strategy"),deps:[yv],useFactory:function Doe(n){return()=>n.scrollStrategies.reposition({scrollThrottle:20})}};let Poe=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=Gn({type:n}),n.\u0275inj=Bn({providers:[Aoe],imports:[AF,au,SC,Ki,Ki,Vb]}),n})(),IP=(()=>{class n{constructor(){this.changes=new si,this.itemsPerPageLabel="Items per page:",this.nextPageLabel="Next page",this.previousPageLabel="Previous page",this.firstPageLabel="First page",this.lastPageLabel="Last page",this.getRangeLabel=(t,i,r)=>{if(0==r||0==i)return`0 of ${r}`;const s=t*i;return`${s+1} \u2013 ${s<(r=Math.max(r,0))?Math.min(s+i,r):s+i} of ${r}`}}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=Yt({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();const Foe={provide:IP,deps:[[new ls,new $r,IP]],useFactory:function Ooe(n){return n||new IP}};let Noe=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=Gn({type:n}),n.\u0275inj=Bn({providers:[Foe],imports:[au,Fb,tB,Poe,Ki]}),n})();function LU(n){return new bt(3e3,!1)}function yae(){return typeof window<"u"&&typeof window.document<"u"}function PP(){return typeof process<"u"&&"[object process]"==={}.toString.call(process)}function xm(n){switch(n.length){case 0:return new Ob;case 1:return n[0];default:return new ZF(n)}}function OU(n,e,t,i,r=new Map,s=new Map){const c=[],d=[];let m=-1,y=null;if(i.forEach(w=>{const S=w.get("offset"),T=S==m,I=T&&y||new Map;w.forEach((R,k)=>{let F=k,G=R;if("offset"!==k)switch(F=e.normalizePropertyName(F,c),G){case"!":G=r.get(k);break;case fp:G=s.get(k);break;default:G=e.normalizeStyleValue(k,F,G,c)}I.set(F,G)}),T||d.push(I),y=I,m=S}),c.length)throw function oae(n){return new bt(3502,!1)}();return d}function RP(n,e,t,i){switch(e){case"start":n.onStart(()=>i(t&&kP(t,"start",n)));break;case"done":n.onDone(()=>i(t&&kP(t,"done",n)));break;case"destroy":n.onDestroy(()=>i(t&&kP(t,"destroy",n)))}}function kP(n,e,t){const s=LP(n.element,n.triggerName,n.fromState,n.toState,e||n.phaseName,t.totalTime??n.totalTime,!!t.disabled),c=n._data;return null!=c&&(s._data=c),s}function LP(n,e,t,i,r="",s=0,c){return{element:n,triggerName:e,fromState:t,toState:i,phaseName:r,totalTime:s,disabled:!!c}}function Tc(n,e,t){let i=n.get(e);return i||n.set(e,i=t),i}function FU(n){const e=n.indexOf(":");return[n.substring(1,e),n.slice(e+1)]}let OP=(n,e)=>!1,NU=(n,e,t)=>[],BU=null;function FP(n){const e=n.parentNode||n.host;return e===BU?null:e}(PP()||typeof Element<"u")&&(yae()?(BU=(()=>document.documentElement)(),OP=(n,e)=>{for(;e;){if(e===n)return!0;e=FP(e)}return!1}):OP=(n,e)=>n.contains(e),NU=(n,e,t)=>{if(t)return Array.from(n.querySelectorAll(e));const i=n.querySelector(e);return i?[i]:[]});let m_=null,zU=!1;const VU=OP,UU=NU;let HU=(()=>{class n{validateStyleProperty(t){return function xae(n){m_||(m_=function bae(){return typeof document<"u"?document.body:null}()||{},zU=!!m_.style&&"WebkitAppearance"in m_.style);let e=!0;return m_.style&&!function vae(n){return"ebkit"==n.substring(1,6)}(n)&&(e=n in m_.style,!e&&zU&&(e="Webkit"+n.charAt(0).toUpperCase()+n.slice(1)in m_.style)),e}(t)}matchesElement(t,i){return!1}containsElement(t,i){return VU(t,i)}getParentElement(t){return FP(t)}query(t,i,r){return UU(t,i,r)}computeStyle(t,i,r){return r||""}animate(t,i,r,s,c,d=[],m){return new Ob(r,s)}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=Yt({token:n,factory:n.\u0275fac}),n})(),NP=(()=>{class n{}return n.NOOP=new HU,n})();const BP="ng-enter",EE="ng-leave",TE="ng-trigger",DE=".ng-trigger",jU="ng-animating",zP=".ng-animating";function Rp(n){if("number"==typeof n)return n;const e=n.match(/^(-?[\.\d]+)(m?s)/);return!e||e.length<2?0:VP(parseFloat(e[1]),e[2])}function VP(n,e){return"s"===e?1e3*n:n}function AE(n,e,t){return n.hasOwnProperty("duration")?n:function Cae(n,e,t){let r,s=0,c="";if("string"==typeof n){const d=n.match(/^(-?[\.\d]+)(m?s)(?:\s+(-?[\.\d]+)(m?s))?(?:\s+([-a-z]+(?:\(.+?\))?))?$/i);if(null===d)return e.push(LU()),{duration:0,delay:0,easing:""};r=VP(parseFloat(d[1]),d[2]);const m=d[3];null!=m&&(s=VP(parseFloat(m),d[4]));const y=d[5];y&&(c=y)}else r=n;if(!t){let d=!1,m=e.length;r<0&&(e.push(function Boe(){return new bt(3100,!1)}()),d=!0),s<0&&(e.push(function zoe(){return new bt(3101,!1)}()),d=!0),d&&e.splice(m,0,LU())}return{duration:r,delay:s,easing:c}}(n,e,t)}function Nw(n,e={}){return Object.keys(n).forEach(t=>{e[t]=n[t]}),e}function $U(n){const e=new Map;return Object.keys(n).forEach(t=>{e.set(t,n[t])}),e}function bm(n,e=new Map,t){if(t)for(let[i,r]of t)e.set(i,r);for(let[i,r]of n)e.set(i,r);return e}function qU(n,e,t){return t?e+":"+t+";":""}function ZU(n){let e="";for(let t=0;t<n.style.length;t++){const i=n.style.item(t);e+=qU(0,i,n.style.getPropertyValue(i))}for(const t in n.style)n.style.hasOwnProperty(t)&&!t.startsWith("_")&&(e+=qU(0,Dae(t),n.style[t]));n.setAttribute("style",e)}function ch(n,e,t){n.style&&(e.forEach((i,r)=>{const s=HP(r);t&&!t.has(r)&&t.set(r,n.style[s]),n.style[s]=i}),PP()&&ZU(n))}function g_(n,e){n.style&&(e.forEach((t,i)=>{const r=HP(i);n.style[r]=""}),PP()&&ZU(n))}function Bw(n){return Array.isArray(n)?1==n.length?n[0]:WF(n):n}const UP=new RegExp("{{\\s*(.+?)\\s*}}","g");function XU(n){let e=[];if("string"==typeof n){let t;for(;t=UP.exec(n);)e.push(t[1]);UP.lastIndex=0}return e}function zw(n,e,t){const i=n.toString(),r=i.replace(UP,(s,c)=>{let d=e[c];return null==d&&(t.push(function Uoe(n){return new bt(3003,!1)}()),d=""),d.toString()});return r==i?n:r}function IE(n){const e=[];let t=n.next();for(;!t.done;)e.push(t.value),t=n.next();return e}const Tae=/-+([a-z0-9])/g;function HP(n){return n.replace(Tae,(...e)=>e[1].toUpperCase())}function Dae(n){return n.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()}function Dc(n,e,t){switch(e.type){case 7:return n.visitTrigger(e,t);case 0:return n.visitState(e,t);case 1:return n.visitTransition(e,t);case 2:return n.visitSequence(e,t);case 3:return n.visitGroup(e,t);case 4:return n.visitAnimate(e,t);case 5:return n.visitKeyframes(e,t);case 6:return n.visitStyle(e,t);case 8:return n.visitReference(e,t);case 9:return n.visitAnimateChild(e,t);case 10:return n.visitAnimateRef(e,t);case 11:return n.visitQuery(e,t);case 12:return n.visitStagger(e,t);default:throw function Hoe(n){return new bt(3004,!1)}()}}function YU(n,e){return window.getComputedStyle(n)[e]}function Lae(n,e){const t=[];return"string"==typeof n?n.split(/\s*,\s*/).forEach(i=>function Oae(n,e,t){if(":"==n[0]){const m=function Fae(n,e){switch(n){case":enter":return"void => *";case":leave":return"* => void";case":increment":return(t,i)=>parseFloat(i)>parseFloat(t);case":decrement":return(t,i)=>parseFloat(i)<parseFloat(t);default:return e.push(function nae(n){return new bt(3016,!1)}()),"* => *"}}(n,t);if("function"==typeof m)return void e.push(m);n=m}const i=n.match(/^(\*|[-\w]+)\s*(<?[=-]>)\s*(\*|[-\w]+)$/);if(null==i||i.length<4)return t.push(function tae(n){return new bt(3015,!1)}()),e;const r=i[1],s=i[2],c=i[3];e.push(KU(r,c));"<"==s[0]&&!("*"==r&&"*"==c)&&e.push(KU(c,r))}(i,t,e)):t.push(n),t}const LE=new Set(["true","1"]),OE=new Set(["false","0"]);function KU(n,e){const t=LE.has(n)||OE.has(n),i=LE.has(e)||OE.has(e);return(r,s)=>{let c="*"==n||n==r,d="*"==e||e==s;return!c&&t&&"boolean"==typeof r&&(c=r?LE.has(n):OE.has(n)),!d&&i&&"boolean"==typeof s&&(d=s?LE.has(e):OE.has(e)),c&&d}}const Nae=new RegExp("s*:selfs*,?","g");function GP(n,e,t,i){return new Bae(n).build(e,t,i)}class Bae{constructor(e){this._driver=e}build(e,t,i){const r=new Uae(t);return this._resetContextStyleTimingState(r),Dc(this,Bw(e),r)}_resetContextStyleTimingState(e){e.currentQuerySelector="",e.collectedStyles=new Map,e.collectedStyles.set("",new Map),e.currentTime=0}visitTrigger(e,t){let i=t.queryCount=0,r=t.depCount=0;const s=[],c=[];return"@"==e.name.charAt(0)&&t.errors.push(function joe(){return new bt(3006,!1)}()),e.definitions.forEach(d=>{if(this._resetContextStyleTimingState(t),0==d.type){const m=d,y=m.name;y.toString().split(/\s*,\s*/).forEach(w=>{m.name=w,s.push(this.visitState(m,t))}),m.name=y}else if(1==d.type){const m=this.visitTransition(d,t);i+=m.queryCount,r+=m.depCount,c.push(m)}else t.errors.push(function $oe(){return new bt(3007,!1)}())}),{type:7,name:e.name,states:s,transitions:c,queryCount:i,depCount:r,options:null}}visitState(e,t){const i=this.visitStyle(e.styles,t),r=e.options&&e.options.params||null;if(i.containsDynamicStyles){const s=new Set,c=r||{};i.styles.forEach(d=>{d instanceof Map&&d.forEach(m=>{XU(m).forEach(y=>{c.hasOwnProperty(y)||s.add(y)})})}),s.size&&(IE(s.values()),t.errors.push(function Woe(n,e){return new bt(3008,!1)}()))}return{type:0,name:e.name,style:i,options:r?{params:r}:null}}visitTransition(e,t){t.queryCount=0,t.depCount=0;const i=Dc(this,Bw(e.animation),t);return{type:1,matchers:Lae(e.expr,t.errors),animation:i,queryCount:t.queryCount,depCount:t.depCount,options:__(e.options)}}visitSequence(e,t){return{type:2,steps:e.steps.map(i=>Dc(this,i,t)),options:__(e.options)}}visitGroup(e,t){const i=t.currentTime;let r=0;const s=e.steps.map(c=>{t.currentTime=i;const d=Dc(this,c,t);return r=Math.max(r,t.currentTime),d});return t.currentTime=r,{type:3,steps:s,options:__(e.options)}}visitAnimate(e,t){const i=function Gae(n,e){if(n.hasOwnProperty("duration"))return n;if("number"==typeof n)return jP(AE(n,e).duration,0,"");const t=n;if(t.split(/\s+/).some(s=>"{"==s.charAt(0)&&"{"==s.charAt(1))){const s=jP(0,0,"");return s.dynamic=!0,s.strValue=t,s}const r=AE(t,e);return jP(r.duration,r.delay,r.easing)}(e.timings,t.errors);t.currentAnimateTimings=i;let r,s=e.styles?e.styles:Cr({});if(5==s.type)r=this.visitKeyframes(s,t);else{let c=e.styles,d=!1;if(!c){d=!0;const y={};i.easing&&(y.easing=i.easing),c=Cr(y)}t.currentTime+=i.duration+i.delay;const m=this.visitStyle(c,t);m.isEmptyStep=d,r=m}return t.currentAnimateTimings=null,{type:4,timings:i,style:r,options:null}}visitStyle(e,t){const i=this._makeStyleAst(e,t);return this._validateStyleAst(i,t),i}_makeStyleAst(e,t){const i=[],r=Array.isArray(e.styles)?e.styles:[e.styles];for(let d of r)"string"==typeof d?d===fp?i.push(d):t.errors.push(new bt(3002,!1)):i.push($U(d));let s=!1,c=null;return i.forEach(d=>{if(d instanceof Map&&(d.has("easing")&&(c=d.get("easing"),d.delete("easing")),!s))for(let m of d.values())if(m.toString().indexOf("{{")>=0){s=!0;break}}),{type:6,styles:i,easing:c,offset:e.offset,containsDynamicStyles:s,options:null}}_validateStyleAst(e,t){const i=t.currentAnimateTimings;let r=t.currentTime,s=t.currentTime;i&&s>0&&(s-=i.duration+i.delay),e.styles.forEach(c=>{"string"!=typeof c&&c.forEach((d,m)=>{const y=t.collectedStyles.get(t.currentQuerySelector),w=y.get(m);let S=!0;w&&(s!=r&&s>=w.startTime&&r<=w.endTime&&(t.errors.push(function Zoe(n,e,t,i,r){return new bt(3010,!1)}()),S=!1),s=w.startTime),S&&y.set(m,{startTime:s,endTime:r}),t.options&&function Eae(n,e,t){const i=e.params||{},r=XU(n);r.length&&r.forEach(s=>{i.hasOwnProperty(s)||t.push(function Voe(n){return new bt(3001,!1)}())})}(d,t.options,t.errors)})})}visitKeyframes(e,t){const i={type:5,styles:[],options:null};if(!t.currentAnimateTimings)return t.errors.push(function Xoe(){return new bt(3011,!1)}()),i;let s=0;const c=[];let d=!1,m=!1,y=0;const w=e.steps.map(G=>{const W=this._makeStyleAst(G,t);let V=null!=W.offset?W.offset:function Hae(n){if("string"==typeof n)return null;let e=null;if(Array.isArray(n))n.forEach(t=>{if(t instanceof Map&&t.has("offset")){const i=t;e=parseFloat(i.get("offset")),i.delete("offset")}});else if(n instanceof Map&&n.has("offset")){const t=n;e=parseFloat(t.get("offset")),t.delete("offset")}return e}(W.styles),X=0;return null!=V&&(s++,X=W.offset=V),m=m||X<0||X>1,d=d||X<y,y=X,c.push(X),W});m&&t.errors.push(function Yoe(){return new bt(3012,!1)}()),d&&t.errors.push(function Koe(){return new bt(3200,!1)}());const S=e.steps.length;let T=0;s>0&&s<S?t.errors.push(function Qoe(){return new bt(3202,!1)}()):0==s&&(T=1/(S-1));const I=S-1,R=t.currentTime,k=t.currentAnimateTimings,F=k.duration;return w.forEach((G,W)=>{const V=T>0?W==I?1:T*W:c[W],X=V*F;t.currentTime=R+k.delay+X,k.duration=X,this._validateStyleAst(G,t),G.offset=V,i.styles.push(G)}),i}visitReference(e,t){return{type:8,animation:Dc(this,Bw(e.animation),t),options:__(e.options)}}visitAnimateChild(e,t){return t.depCount++,{type:9,options:__(e.options)}}visitAnimateRef(e,t){return{type:10,animation:this.visitReference(e.animation,t),options:__(e.options)}}visitQuery(e,t){const i=t.currentQuerySelector,r=e.options||{};t.queryCount++,t.currentQuery=e;const[s,c]=function zae(n){const e=!!n.split(/\s*,\s*/).find(t=>":self"==t);return e&&(n=n.replace(Nae,"")),n=n.replace(/@\*/g,DE).replace(/@\w+/g,t=>DE+"-"+t.slice(1)).replace(/:animating/g,zP),[n,e]}(e.selector);t.currentQuerySelector=i.length?i+" "+s:s,Tc(t.collectedStyles,t.currentQuerySelector,new Map);const d=Dc(this,Bw(e.animation),t);return t.currentQuery=null,t.currentQuerySelector=i,{type:11,selector:s,limit:r.limit||0,optional:!!r.optional,includeSelf:c,animation:d,originalSelector:e.selector,options:__(e.options)}}visitStagger(e,t){t.currentQuery||t.errors.push(function Joe(){return new bt(3013,!1)}());const i="full"===e.timings?{duration:0,delay:0,easing:"full"}:AE(e.timings,t.errors,!0);return{type:12,animation:Dc(this,Bw(e.animation),t),timings:i,options:null}}}class Uae{constructor(e){this.errors=e,this.queryCount=0,this.depCount=0,this.currentTransition=null,this.currentQuery=null,this.currentQuerySelector=null,this.currentAnimateTimings=null,this.currentTime=0,this.collectedStyles=new Map,this.options=null,this.unsupportedCSSPropertiesFound=new Set}}function __(n){return n?(n=Nw(n)).params&&(n.params=function Vae(n){return n?Nw(n):null}(n.params)):n={},n}function jP(n,e,t){return{duration:n,delay:e,easing:t}}function $P(n,e,t,i,r,s,c=null,d=!1){return{type:1,element:n,keyframes:e,preStyleProps:t,postStyleProps:i,duration:r,delay:s,totalTime:r+s,easing:c,subTimeline:d}}class FE{constructor(){this._map=new Map}get(e){return this._map.get(e)||[]}append(e,t){let i=this._map.get(e);i||this._map.set(e,i=[]),i.push(...t)}has(e){return this._map.has(e)}clear(){this._map.clear()}}const Wae=new RegExp(":enter","g"),Zae=new RegExp(":leave","g");function WP(n,e,t,i,r,s=new Map,c=new Map,d,m,y=[]){return(new Xae).buildKeyframes(n,e,t,i,r,s,c,d,m,y)}class Xae{buildKeyframes(e,t,i,r,s,c,d,m,y,w=[]){y=y||new FE;const S=new qP(e,t,y,r,s,w,[]);S.options=m;const T=m.delay?Rp(m.delay):0;S.currentTimeline.delayNextStep(T),S.currentTimeline.setStyles([c],null,S.errors,m),Dc(this,i,S);const I=S.timelines.filter(R=>R.containsAnimation());if(I.length&&d.size){let R;for(let k=I.length-1;k>=0;k--){const F=I[k];if(F.element===t){R=F;break}}R&&!R.allowOnlyTimelineStyles()&&R.setStyles([d],null,S.errors,m)}return I.length?I.map(R=>R.buildKeyframes()):[$P(t,[],[],[],0,T,"",!1)]}visitTrigger(e,t){}visitState(e,t){}visitTransition(e,t){}visitAnimateChild(e,t){const i=t.subInstructions.get(t.element);if(i){const r=t.createSubContext(e.options),s=t.currentTimeline.currentTime,c=this._visitSubInstructions(i,r,r.options);s!=c&&t.transformIntoNewTimeline(c)}t.previousNode=e}visitAnimateRef(e,t){const i=t.createSubContext(e.options);i.transformIntoNewTimeline(),this._applyAnimationRefDelays([e.options,e.animation.options],t,i),this.visitReference(e.animation,i),t.transformIntoNewTimeline(i.currentTimeline.currentTime),t.previousNode=e}_applyAnimationRefDelays(e,t,i){for(const r of e){const s=r?.delay;if(s){const c="number"==typeof s?s:Rp(zw(s,r?.params??{},t.errors));i.delayNextStep(c)}}}_visitSubInstructions(e,t,i){let s=t.currentTimeline.currentTime;const c=null!=i.duration?Rp(i.duration):null,d=null!=i.delay?Rp(i.delay):null;return 0!==c&&e.forEach(m=>{const y=t.appendInstructionToTimeline(m,c,d);s=Math.max(s,y.duration+y.delay)}),s}visitReference(e,t){t.updateOptions(e.options,!0),Dc(this,e.animation,t),t.previousNode=e}visitSequence(e,t){const i=t.subContextCount;let r=t;const s=e.options;if(s&&(s.params||s.delay)&&(r=t.createSubContext(s),r.transformIntoNewTimeline(),null!=s.delay)){6==r.previousNode.type&&(r.currentTimeline.snapshotCurrentStyles(),r.previousNode=NE);const c=Rp(s.delay);r.delayNextStep(c)}e.steps.length&&(e.steps.forEach(c=>Dc(this,c,r)),r.currentTimeline.applyStylesToKeyframe(),r.subContextCount>i&&r.transformIntoNewTimeline()),t.previousNode=e}visitGroup(e,t){const i=[];let r=t.currentTimeline.currentTime;const s=e.options&&e.options.delay?Rp(e.options.delay):0;e.steps.forEach(c=>{const d=t.createSubContext(e.options);s&&d.delayNextStep(s),Dc(this,c,d),r=Math.max(r,d.currentTimeline.currentTime),i.push(d.currentTimeline)}),i.forEach(c=>t.currentTimeline.mergeTimelineCollectedStyles(c)),t.transformIntoNewTimeline(r),t.previousNode=e}_visitTiming(e,t){if(e.dynamic){const i=e.strValue;return AE(t.params?zw(i,t.params,t.errors):i,t.errors)}return{duration:e.duration,delay:e.delay,easing:e.easing}}visitAnimate(e,t){const i=t.currentAnimateTimings=this._visitTiming(e.timings,t),r=t.currentTimeline;i.delay&&(t.incrementTime(i.delay),r.snapshotCurrentStyles());const s=e.style;5==s.type?this.visitKeyframes(s,t):(t.incrementTime(i.duration),this.visitStyle(s,t),r.applyStylesToKeyframe()),t.currentAnimateTimings=null,t.previousNode=e}visitStyle(e,t){const i=t.currentTimeline,r=t.currentAnimateTimings;!r&&i.hasCurrentStyleProperties()&&i.forwardFrame();const s=r&&r.easing||e.easing;e.isEmptyStep?i.applyEmptyStep(s):i.setStyles(e.styles,s,t.errors,t.options),t.previousNode=e}visitKeyframes(e,t){const i=t.currentAnimateTimings,r=t.currentTimeline.duration,s=i.duration,d=t.createSubContext().currentTimeline;d.easing=i.easing,e.styles.forEach(m=>{d.forwardTime((m.offset||0)*s),d.setStyles(m.styles,m.easing,t.errors,t.options),d.applyStylesToKeyframe()}),t.currentTimeline.mergeTimelineCollectedStyles(d),t.transformIntoNewTimeline(r+s),t.previousNode=e}visitQuery(e,t){const i=t.currentTimeline.currentTime,r=e.options||{},s=r.delay?Rp(r.delay):0;s&&(6===t.previousNode.type||0==i&&t.currentTimeline.hasCurrentStyleProperties())&&(t.currentTimeline.snapshotCurrentStyles(),t.previousNode=NE);let c=i;const d=t.invokeQuery(e.selector,e.originalSelector,e.limit,e.includeSelf,!!r.optional,t.errors);t.currentQueryTotal=d.length;let m=null;d.forEach((y,w)=>{t.currentQueryIndex=w;const S=t.createSubContext(e.options,y);s&&S.delayNextStep(s),y===t.element&&(m=S.currentTimeline),Dc(this,e.animation,S),S.currentTimeline.applyStylesToKeyframe(),c=Math.max(c,S.currentTimeline.currentTime)}),t.currentQueryIndex=0,t.currentQueryTotal=0,t.transformIntoNewTimeline(c),m&&(t.currentTimeline.mergeTimelineCollectedStyles(m),t.currentTimeline.snapshotCurrentStyles()),t.previousNode=e}visitStagger(e,t){const i=t.parentContext,r=t.currentTimeline,s=e.timings,c=Math.abs(s.duration),d=c*(t.currentQueryTotal-1);let m=c*t.currentQueryIndex;switch(s.duration<0?"reverse":s.easing){case"reverse":m=d-m;break;case"full":m=i.currentStaggerTime}const w=t.currentTimeline;m&&w.delayNextStep(m);const S=w.currentTime;Dc(this,e.animation,t),t.previousNode=e,i.currentStaggerTime=r.currentTime-S+(r.startTime-i.currentTimeline.startTime)}}const NE={};class qP{constructor(e,t,i,r,s,c,d,m){this._driver=e,this.element=t,this.subInstructions=i,this._enterClassName=r,this._leaveClassName=s,this.errors=c,this.timelines=d,this.parentContext=null,this.currentAnimateTimings=null,this.previousNode=NE,this.subContextCount=0,this.options={},this.currentQueryIndex=0,this.currentQueryTotal=0,this.currentStaggerTime=0,this.currentTimeline=m||new BE(this._driver,t,0),d.push(this.currentTimeline)}get params(){return this.options.params}updateOptions(e,t){if(!e)return;const i=e;let r=this.options;null!=i.duration&&(r.duration=Rp(i.duration)),null!=i.delay&&(r.delay=Rp(i.delay));const s=i.params;if(s){let c=r.params;c||(c=this.options.params={}),Object.keys(s).forEach(d=>{(!t||!c.hasOwnProperty(d))&&(c[d]=zw(s[d],c,this.errors))})}}_copyOptions(){const e={};if(this.options){const t=this.options.params;if(t){const i=e.params={};Object.keys(t).forEach(r=>{i[r]=t[r]})}}return e}createSubContext(e=null,t,i){const r=t||this.element,s=new qP(this._driver,r,this.subInstructions,this._enterClassName,this._leaveClassName,this.errors,this.timelines,this.currentTimeline.fork(r,i||0));return s.previousNode=this.previousNode,s.currentAnimateTimings=this.currentAnimateTimings,s.options=this._copyOptions(),s.updateOptions(e),s.currentQueryIndex=this.currentQueryIndex,s.currentQueryTotal=this.currentQueryTotal,s.parentContext=this,this.subContextCount++,s}transformIntoNewTimeline(e){return this.previousNode=NE,this.currentTimeline=this.currentTimeline.fork(this.element,e),this.timelines.push(this.currentTimeline),this.currentTimeline}appendInstructionToTimeline(e,t,i){const r={duration:t??e.duration,delay:this.currentTimeline.currentTime+(i??0)+e.delay,easing:""},s=new Yae(this._driver,e.element,e.keyframes,e.preStyleProps,e.postStyleProps,r,e.stretchStartingKeyframe);return this.timelines.push(s),r}incrementTime(e){this.currentTimeline.forwardTime(this.currentTimeline.duration+e)}delayNextStep(e){e>0&&this.currentTimeline.delayNextStep(e)}invokeQuery(e,t,i,r,s,c){let d=[];if(r&&d.push(this.element),e.length>0){e=(e=e.replace(Wae,"."+this._enterClassName)).replace(Zae,"."+this._leaveClassName);let y=this._driver.query(this.element,e,1!=i);0!==i&&(y=i<0?y.slice(y.length+i,y.length):y.slice(0,i)),d.push(...y)}return!s&&0==d.length&&c.push(function eae(n){return new bt(3014,!1)}()),d}}class BE{constructor(e,t,i,r){this._driver=e,this.element=t,this.startTime=i,this._elementTimelineStylesLookup=r,this.duration=0,this._previousKeyframe=new Map,this._currentKeyframe=new Map,this._keyframes=new Map,this._styleSummary=new Map,this._localTimelineStyles=new Map,this._pendingStyles=new Map,this._backFill=new Map,this._currentEmptyStepKeyframe=null,this._elementTimelineStylesLookup||(this._elementTimelineStylesLookup=new Map),this._globalTimelineStyles=this._elementTimelineStylesLookup.get(t),this._globalTimelineStyles||(this._globalTimelineStyles=this._localTimelineStyles,this._elementTimelineStylesLookup.set(t,this._localTimelineStyles)),this._loadKeyframe()}containsAnimation(){switch(this._keyframes.size){case 0:return!1;case 1:return this.hasCurrentStyleProperties();default:return!0}}hasCurrentStyleProperties(){return this._currentKeyframe.size>0}get currentTime(){return this.startTime+this.duration}delayNextStep(e){const t=1===this._keyframes.size&&this._pendingStyles.size;this.duration||t?(this.forwardTime(this.currentTime+e),t&&this.snapshotCurrentStyles()):this.startTime+=e}fork(e,t){return this.applyStylesToKeyframe(),new BE(this._driver,e,t||this.currentTime,this._elementTimelineStylesLookup)}_loadKeyframe(){this._currentKeyframe&&(this._previousKeyframe=this._currentKeyframe),this._currentKeyframe=this._keyframes.get(this.duration),this._currentKeyframe||(this._currentKeyframe=new Map,this._keyframes.set(this.duration,this._currentKeyframe))}forwardFrame(){this.duration+=1,this._loadKeyframe()}forwardTime(e){this.applyStylesToKeyframe(),this.duration=e,this._loadKeyframe()}_updateStyle(e,t){this._localTimelineStyles.set(e,t),this._globalTimelineStyles.set(e,t),this._styleSummary.set(e,{time:this.currentTime,value:t})}allowOnlyTimelineStyles(){return this._currentEmptyStepKeyframe!==this._currentKeyframe}applyEmptyStep(e){e&&this._previousKeyframe.set("easing",e);for(let[t,i]of this._globalTimelineStyles)this._backFill.set(t,i||fp),this._currentKeyframe.set(t,fp);this._currentEmptyStepKeyframe=this._currentKeyframe}setStyles(e,t,i,r){t&&this._previousKeyframe.set("easing",t);const s=r&&r.params||{},c=function Kae(n,e){const t=new Map;let i;return n.forEach(r=>{if("*"===r){i=i||e.keys();for(let s of i)t.set(s,fp)}else bm(r,t)}),t}(e,this._globalTimelineStyles);for(let[d,m]of c){const y=zw(m,s,i);this._pendingStyles.set(d,y),this._localTimelineStyles.has(d)||this._backFill.set(d,this._globalTimelineStyles.get(d)??fp),this._updateStyle(d,y)}}applyStylesToKeyframe(){0!=this._pendingStyles.size&&(this._pendingStyles.forEach((e,t)=>{this._currentKeyframe.set(t,e)}),this._pendingStyles.clear(),this._localTimelineStyles.forEach((e,t)=>{this._currentKeyframe.has(t)||this._currentKeyframe.set(t,e)}))}snapshotCurrentStyles(){for(let[e,t]of this._localTimelineStyles)this._pendingStyles.set(e,t),this._updateStyle(e,t)}getFinalKeyframe(){return this._keyframes.get(this.duration)}get properties(){const e=[];for(let t in this._currentKeyframe)e.push(t);return e}mergeTimelineCollectedStyles(e){e._styleSummary.forEach((t,i)=>{const r=this._styleSummary.get(i);(!r||t.time>r.time)&&this._updateStyle(i,t.value)})}buildKeyframes(){this.applyStylesToKeyframe();const e=new Set,t=new Set,i=1===this._keyframes.size&&0===this.duration;let r=[];this._keyframes.forEach((d,m)=>{const y=bm(d,new Map,this._backFill);y.forEach((w,S)=>{"!"===w?e.add(S):w===fp&&t.add(S)}),i||y.set("offset",m/this.duration),r.push(y)});const s=e.size?IE(e.values()):[],c=t.size?IE(t.values()):[];if(i){const d=r[0],m=new Map(d);d.set("offset",0),m.set("offset",1),r=[d,m]}return $P(this.element,r,s,c,this.duration,this.startTime,this.easing,!1)}}class Yae extends BE{constructor(e,t,i,r,s,c,d=!1){super(e,t,c.delay),this.keyframes=i,this.preStyleProps=r,this.postStyleProps=s,this._stretchStartingKeyframe=d,this.timings={duration:c.duration,delay:c.delay,easing:c.easing}}containsAnimation(){return this.keyframes.length>1}buildKeyframes(){let e=this.keyframes,{delay:t,duration:i,easing:r}=this.timings;if(this._stretchStartingKeyframe&&t){const s=[],c=i+t,d=t/c,m=bm(e[0]);m.set("offset",0),s.push(m);const y=bm(e[0]);y.set("offset",e5(d)),s.push(y);const w=e.length-1;for(let S=1;S<=w;S++){let T=bm(e[S]);const I=T.get("offset");T.set("offset",e5((t+I*i)/c)),s.push(T)}i=c,t=0,r="",e=s}return $P(this.element,e,this.preStyleProps,this.postStyleProps,i,t,r,!0)}}function e5(n,e=3){const t=Math.pow(10,e-1);return Math.round(n*t)/t}class ZP{}const Qae=new Set(["width","height","minWidth","minHeight","maxWidth","maxHeight","left","top","bottom","right","fontSize","outlineWidth","outlineOffset","paddingTop","paddingLeft","paddingBottom","paddingRight","marginTop","marginLeft","marginBottom","marginRight","borderRadius","borderWidth","borderTopWidth","borderLeftWidth","borderRightWidth","borderBottomWidth","textIndent","perspective"]);class Jae extends ZP{normalizePropertyName(e,t){return HP(e)}normalizeStyleValue(e,t,i,r){let s="";const c=i.toString().trim();if(Qae.has(t)&&0!==i&&"0"!==i)if("number"==typeof i)s="px";else{const d=i.match(/^[+-]?[\d\.]+([a-z]*)$/);d&&0==d[1].length&&r.push(function Goe(n,e){return new bt(3005,!1)}())}return c+s}}function t5(n,e,t,i,r,s,c,d,m,y,w,S,T){return{type:0,element:n,triggerName:e,isRemovalTransition:r,fromState:t,fromStyles:s,toState:i,toStyles:c,timelines:d,queriedElements:m,preStyleProps:y,postStyleProps:w,totalTime:S,errors:T}}const XP={};class n5{constructor(e,t,i){this._triggerName=e,this.ast=t,this._stateStyles=i}match(e,t,i,r){return function ele(n,e,t,i,r){return n.some(s=>s(e,t,i,r))}(this.ast.matchers,e,t,i,r)}buildStyles(e,t,i){let r=this._stateStyles.get("*");return void 0!==e&&(r=this._stateStyles.get(e?.toString())||r),r?r.buildStyles(t,i):new Map}build(e,t,i,r,s,c,d,m,y,w){const S=[],T=this.ast.options&&this.ast.options.params||XP,R=this.buildStyles(i,d&&d.params||XP,S),k=m&&m.params||XP,F=this.buildStyles(r,k,S),G=new Set,W=new Map,V=new Map,X="void"===r,ee={params:tle(k,T),delay:this.ast.options?.delay},ae=w?[]:WP(e,t,this.ast.animation,s,c,R,F,ee,y,S);let Ee=0;if(ae.forEach(pe=>{Ee=Math.max(pe.duration+pe.delay,Ee)}),S.length)return t5(t,this._triggerName,i,r,X,R,F,[],[],W,V,Ee,S);ae.forEach(pe=>{const Oe=pe.element,st=Tc(W,Oe,new Set);pe.preStyleProps.forEach(Qe=>st.add(Qe));const xt=Tc(V,Oe,new Set);pe.postStyleProps.forEach(Qe=>xt.add(Qe)),Oe!==t&&G.add(Oe)});const J=IE(G.values());return t5(t,this._triggerName,i,r,X,R,F,ae,J,W,V,Ee)}}function tle(n,e){const t=Nw(e);for(const i in n)n.hasOwnProperty(i)&&null!=n[i]&&(t[i]=n[i]);return t}class nle{constructor(e,t,i){this.styles=e,this.defaultParams=t,this.normalizer=i}buildStyles(e,t){const i=new Map,r=Nw(this.defaultParams);return Object.keys(e).forEach(s=>{const c=e[s];null!==c&&(r[s]=c)}),this.styles.styles.forEach(s=>{"string"!=typeof s&&s.forEach((c,d)=>{c&&(c=zw(c,r,t));const m=this.normalizer.normalizePropertyName(d,t);c=this.normalizer.normalizeStyleValue(d,m,c,t),i.set(m,c)})}),i}}class rle{constructor(e,t,i){this.name=e,this.ast=t,this._normalizer=i,this.transitionFactories=[],this.states=new Map,t.states.forEach(r=>{this.states.set(r.name,new nle(r.style,r.options&&r.options.params||{},i))}),r5(this.states,"true","1"),r5(this.states,"false","0"),t.transitions.forEach(r=>{this.transitionFactories.push(new n5(e,r,this.states))}),this.fallbackTransition=function sle(n,e,t){return new n5(n,{type:1,animation:{type:2,steps:[],options:null},matchers:[(c,d)=>!0],options:null,queryCount:0,depCount:0},e)}(e,this.states)}get containsQueries(){return this.ast.queryCount>0}matchTransition(e,t,i,r){return this.transitionFactories.find(c=>c.match(e,t,i,r))||null}matchStyles(e,t,i){return this.fallbackTransition.buildStyles(e,t,i)}}function r5(n,e,t){n.has(e)?n.has(t)||n.set(t,n.get(e)):n.has(t)&&n.set(e,n.get(t))}const ole=new FE;class ale{constructor(e,t,i){this.bodyNode=e,this._driver=t,this._normalizer=i,this._animations=new Map,this._playersById=new Map,this.players=[]}register(e,t){const i=[],s=GP(this._driver,t,i,[]);if(i.length)throw function aae(n){return new bt(3503,!1)}();this._animations.set(e,s)}_buildPlayer(e,t,i){const r=e.element,s=OU(0,this._normalizer,0,e.keyframes,t,i);return this._driver.animate(r,s,e.duration,e.delay,e.easing,[],!0)}create(e,t,i={}){const r=[],s=this._animations.get(e);let c;const d=new Map;if(s?(c=WP(this._driver,t,s,BP,EE,new Map,new Map,i,ole,r),c.forEach(w=>{const S=Tc(d,w.element,new Map);w.postStyleProps.forEach(T=>S.set(T,null))})):(r.push(function lae(){return new bt(3300,!1)}()),c=[]),r.length)throw function cae(n){return new bt(3504,!1)}();d.forEach((w,S)=>{w.forEach((T,I)=>{w.set(I,this._driver.computeStyle(S,I,fp))})});const y=xm(c.map(w=>{const S=d.get(w.element);return this._buildPlayer(w,new Map,S)}));return this._playersById.set(e,y),y.onDestroy(()=>this.destroy(e)),this.players.push(y),y}destroy(e){const t=this._getPlayer(e);t.destroy(),this._playersById.delete(e);const i=this.players.indexOf(t);i>=0&&this.players.splice(i,1)}_getPlayer(e){const t=this._playersById.get(e);if(!t)throw function uae(n){return new bt(3301,!1)}();return t}listen(e,t,i,r){const s=LP(t,"","","");return RP(this._getPlayer(e),i,s,r),()=>{}}command(e,t,i,r){if("register"==i)return void this.register(e,r[0]);if("create"==i)return void this.create(e,t,r[0]||{});const s=this._getPlayer(e);switch(i){case"play":s.play();break;case"pause":s.pause();break;case"reset":s.reset();break;case"restart":s.restart();break;case"finish":s.finish();break;case"init":s.init();break;case"setPosition":s.setPosition(parseFloat(r[0]));break;case"destroy":this.destroy(e)}}}const s5="ng-animate-queued",YP="ng-animate-disabled",hle=[],o5={namespaceId:"",setForRemoval:!1,setForMove:!1,hasAnimation:!1,removedBeforeQueried:!1},ple={namespaceId:"",setForMove:!1,setForRemoval:!1,hasAnimation:!1,removedBeforeQueried:!0},_u="__ng_removed";class KP{constructor(e,t=""){this.namespaceId=t;const i=e&&e.hasOwnProperty("value");if(this.value=function _le(n){return n??null}(i?e.value:e),i){const s=Nw(e);delete s.value,this.options=s}else this.options={};this.options.params||(this.options.params={})}get params(){return this.options.params}absorbOptions(e){const t=e.params;if(t){const i=this.options.params;Object.keys(t).forEach(r=>{null==i[r]&&(i[r]=t[r])})}}}const Vw="void",QP=new KP(Vw);class fle{constructor(e,t,i){this.id=e,this.hostElement=t,this._engine=i,this.players=[],this._triggers=new Map,this._queue=[],this._elementListeners=new Map,this._hostClassName="ng-tns-"+e,yu(t,this._hostClassName)}listen(e,t,i,r){if(!this._triggers.has(t))throw function dae(n,e){return new bt(3302,!1)}();if(null==i||0==i.length)throw function hae(n){return new bt(3303,!1)}();if(!function yle(n){return"start"==n||"done"==n}(i))throw function pae(n,e){return new bt(3400,!1)}();const s=Tc(this._elementListeners,e,[]),c={name:t,phase:i,callback:r};s.push(c);const d=Tc(this._engine.statesByElement,e,new Map);return d.has(t)||(yu(e,TE),yu(e,TE+"-"+t),d.set(t,QP)),()=>{this._engine.afterFlush(()=>{const m=s.indexOf(c);m>=0&&s.splice(m,1),this._triggers.has(t)||d.delete(t)})}}register(e,t){return!this._triggers.has(e)&&(this._triggers.set(e,t),!0)}_getTrigger(e){const t=this._triggers.get(e);if(!t)throw function fae(n){return new bt(3401,!1)}();return t}trigger(e,t,i,r=!0){const s=this._getTrigger(t),c=new JP(this.id,t,e);let d=this._engine.statesByElement.get(e);d||(yu(e,TE),yu(e,TE+"-"+t),this._engine.statesByElement.set(e,d=new Map));let m=d.get(t);const y=new KP(i,this.id);if(!(i&&i.hasOwnProperty("value"))&&m&&y.absorbOptions(m.options),d.set(t,y),m||(m=QP),y.value!==Vw&&m.value===y.value){if(!function ble(n,e){const t=Object.keys(n),i=Object.keys(e);if(t.length!=i.length)return!1;for(let r=0;r<t.length;r++){const s=t[r];if(!e.hasOwnProperty(s)||n[s]!==e[s])return!1}return!0}(m.params,y.params)){const k=[],F=s.matchStyles(m.value,m.params,k),G=s.matchStyles(y.value,y.params,k);k.length?this._engine.reportError(k):this._engine.afterFlush(()=>{g_(e,F),ch(e,G)})}return}const T=Tc(this._engine.playersByElement,e,[]);T.forEach(k=>{k.namespaceId==this.id&&k.triggerName==t&&k.queued&&k.destroy()});let I=s.matchTransition(m.value,y.value,e,y.params),R=!1;if(!I){if(!r)return;I=s.fallbackTransition,R=!0}return this._engine.totalQueuedPlayers++,this._queue.push({element:e,triggerName:t,transition:I,fromState:m,toState:y,player:c,isFallbackTransition:R}),R||(yu(e,s5),c.onStart(()=>{w0(e,s5)})),c.onDone(()=>{let k=this.players.indexOf(c);k>=0&&this.players.splice(k,1);const F=this._engine.playersByElement.get(e);if(F){let G=F.indexOf(c);G>=0&&F.splice(G,1)}}),this.players.push(c),T.push(c),c}deregister(e){this._triggers.delete(e),this._engine.statesByElement.forEach(t=>t.delete(e)),this._elementListeners.forEach((t,i)=>{this._elementListeners.set(i,t.filter(r=>r.name!=e))})}clearElementCache(e){this._engine.statesByElement.delete(e),this._elementListeners.delete(e);const t=this._engine.playersByElement.get(e);t&&(t.forEach(i=>i.destroy()),this._engine.playersByElement.delete(e))}_signalRemovalForInnerTriggers(e,t){const i=this._engine.driver.query(e,DE,!0);i.forEach(r=>{if(r[_u])return;const s=this._engine.fetchNamespacesByElement(r);s.size?s.forEach(c=>c.triggerLeaveAnimation(r,t,!1,!0)):this.clearElementCache(r)}),this._engine.afterFlushAnimationsDone(()=>i.forEach(r=>this.clearElementCache(r)))}triggerLeaveAnimation(e,t,i,r){const s=this._engine.statesByElement.get(e),c=new Map;if(s){const d=[];if(s.forEach((m,y)=>{if(c.set(y,m.value),this._triggers.has(y)){const w=this.trigger(e,y,Vw,r);w&&d.push(w)}}),d.length)return this._engine.markElementAsRemoved(this.id,e,!0,t,c),i&&xm(d).onDone(()=>this._engine.processLeaveNode(e)),!0}return!1}prepareLeaveAnimationListeners(e){const t=this._elementListeners.get(e),i=this._engine.statesByElement.get(e);if(t&&i){const r=new Set;t.forEach(s=>{const c=s.name;if(r.has(c))return;r.add(c);const m=this._triggers.get(c).fallbackTransition,y=i.get(c)||QP,w=new KP(Vw),S=new JP(this.id,c,e);this._engine.totalQueuedPlayers++,this._queue.push({element:e,triggerName:c,transition:m,fromState:y,toState:w,player:S,isFallbackTransition:!0})})}}removeNode(e,t){const i=this._engine;if(e.childElementCount&&this._signalRemovalForInnerTriggers(e,t),this.triggerLeaveAnimation(e,t,!0))return;let r=!1;if(i.totalAnimations){const s=i.players.length?i.playersByQueriedElement.get(e):[];if(s&&s.length)r=!0;else{let c=e;for(;c=c.parentNode;)if(i.statesByElement.get(c)){r=!0;break}}}if(this.prepareLeaveAnimationListeners(e),r)i.markElementAsRemoved(this.id,e,!1,t);else{const s=e[_u];(!s||s===o5)&&(i.afterFlush(()=>this.clearElementCache(e)),i.destroyInnerAnimations(e),i._onRemovalComplete(e,t))}}insertNode(e,t){yu(e,this._hostClassName)}drainQueuedTransitions(e){const t=[];return this._queue.forEach(i=>{const r=i.player;if(r.destroyed)return;const s=i.element,c=this._elementListeners.get(s);c&&c.forEach(d=>{if(d.name==i.triggerName){const m=LP(s,i.triggerName,i.fromState.value,i.toState.value);m._data=e,RP(i.player,d.phase,m,d.callback)}}),r.markedForDestroy?this._engine.afterFlush(()=>{r.destroy()}):t.push(i)}),this._queue=[],t.sort((i,r)=>{const s=i.transition.ast.depCount,c=r.transition.ast.depCount;return 0==s||0==c?s-c:this._engine.driver.containsElement(i.element,r.element)?1:-1})}destroy(e){this.players.forEach(t=>t.destroy()),this._signalRemovalForInnerTriggers(this.hostElement,e)}elementContainsData(e){let t=!1;return this._elementListeners.has(e)&&(t=!0),t=!!this._queue.find(i=>i.element===e)||t,t}}class mle{constructor(e,t,i){this.bodyNode=e,this.driver=t,this._normalizer=i,this.players=[],this.newHostElements=new Map,this.playersByElement=new Map,this.playersByQueriedElement=new Map,this.statesByElement=new Map,this.disabledNodes=new Set,this.totalAnimations=0,this.totalQueuedPlayers=0,this._namespaceLookup={},this._namespaceList=[],this._flushFns=[],this._whenQuietFns=[],this.namespacesByHostElement=new Map,this.collectedEnterElements=[],this.collectedLeaveElements=[],this.onRemovalComplete=(r,s)=>{}}_onRemovalComplete(e,t){this.onRemovalComplete(e,t)}get queuedPlayers(){const e=[];return this._namespaceList.forEach(t=>{t.players.forEach(i=>{i.queued&&e.push(i)})}),e}createNamespace(e,t){const i=new fle(e,t,this);return this.bodyNode&&this.driver.containsElement(this.bodyNode,t)?this._balanceNamespaceList(i,t):(this.newHostElements.set(t,i),this.collectEnterElement(t)),this._namespaceLookup[e]=i}_balanceNamespaceList(e,t){const i=this._namespaceList,r=this.namespacesByHostElement;if(i.length-1>=0){let c=!1,d=this.driver.getParentElement(t);for(;d;){const m=r.get(d);if(m){const y=i.indexOf(m);i.splice(y+1,0,e),c=!0;break}d=this.driver.getParentElement(d)}c||i.unshift(e)}else i.push(e);return r.set(t,e),e}register(e,t){let i=this._namespaceLookup[e];return i||(i=this.createNamespace(e,t)),i}registerTrigger(e,t,i){let r=this._namespaceLookup[e];r&&r.register(t,i)&&this.totalAnimations++}destroy(e,t){if(!e)return;const i=this._fetchNamespace(e);this.afterFlush(()=>{this.namespacesByHostElement.delete(i.hostElement),delete this._namespaceLookup[e];const r=this._namespaceList.indexOf(i);r>=0&&this._namespaceList.splice(r,1)}),this.afterFlushAnimationsDone(()=>i.destroy(t))}_fetchNamespace(e){return this._namespaceLookup[e]}fetchNamespacesByElement(e){const t=new Set,i=this.statesByElement.get(e);if(i)for(let r of i.values())if(r.namespaceId){const s=this._fetchNamespace(r.namespaceId);s&&t.add(s)}return t}trigger(e,t,i,r){if(zE(t)){const s=this._fetchNamespace(e);if(s)return s.trigger(t,i,r),!0}return!1}insertNode(e,t,i,r){if(!zE(t))return;const s=t[_u];if(s&&s.setForRemoval){s.setForRemoval=!1,s.setForMove=!0;const c=this.collectedLeaveElements.indexOf(t);c>=0&&this.collectedLeaveElements.splice(c,1)}if(e){const c=this._fetchNamespace(e);c&&c.insertNode(t,i)}r&&this.collectEnterElement(t)}collectEnterElement(e){this.collectedEnterElements.push(e)}markElementAsDisabled(e,t){t?this.disabledNodes.has(e)||(this.disabledNodes.add(e),yu(e,YP)):this.disabledNodes.has(e)&&(this.disabledNodes.delete(e),w0(e,YP))}removeNode(e,t,i,r){if(zE(t)){const s=e?this._fetchNamespace(e):null;if(s?s.removeNode(t,r):this.markElementAsRemoved(e,t,!1,r),i){const c=this.namespacesByHostElement.get(t);c&&c.id!==e&&c.removeNode(t,r)}}else this._onRemovalComplete(t,r)}markElementAsRemoved(e,t,i,r,s){this.collectedLeaveElements.push(t),t[_u]={namespaceId:e,setForRemoval:r,hasAnimation:i,removedBeforeQueried:!1,previousTriggersValues:s}}listen(e,t,i,r,s){return zE(t)?this._fetchNamespace(e).listen(t,i,r,s):()=>{}}_buildInstruction(e,t,i,r,s){return e.transition.build(this.driver,e.element,e.fromState.value,e.toState.value,i,r,e.fromState.options,e.toState.options,t,s)}destroyInnerAnimations(e){let t=this.driver.query(e,DE,!0);t.forEach(i=>this.destroyActiveAnimationsForElement(i)),0!=this.playersByQueriedElement.size&&(t=this.driver.query(e,zP,!0),t.forEach(i=>this.finishActiveQueriedAnimationOnElement(i)))}destroyActiveAnimationsForElement(e){const t=this.playersByElement.get(e);t&&t.forEach(i=>{i.queued?i.markedForDestroy=!0:i.destroy()})}finishActiveQueriedAnimationOnElement(e){const t=this.playersByQueriedElement.get(e);t&&t.forEach(i=>i.finish())}whenRenderingDone(){return new Promise(e=>{if(this.players.length)return xm(this.players).onDone(()=>e());e()})}processLeaveNode(e){const t=e[_u];if(t&&t.setForRemoval){if(e[_u]=o5,t.namespaceId){this.destroyInnerAnimations(e);const i=this._fetchNamespace(t.namespaceId);i&&i.clearElementCache(e)}this._onRemovalComplete(e,t.setForRemoval)}e.classList?.contains(YP)&&this.markElementAsDisabled(e,!1),this.driver.query(e,".ng-animate-disabled",!0).forEach(i=>{this.markElementAsDisabled(i,!1)})}flush(e=-1){let t=[];if(this.newHostElements.size&&(this.newHostElements.forEach((i,r)=>this._balanceNamespaceList(i,r)),this.newHostElements.clear()),this.totalAnimations&&this.collectedEnterElements.length)for(let i=0;i<this.collectedEnterElements.length;i++)yu(this.collectedEnterElements[i],"ng-star-inserted");if(this._namespaceList.length&&(this.totalQueuedPlayers||this.collectedLeaveElements.length)){const i=[];try{t=this._flushAnimations(i,e)}finally{for(let r=0;r<i.length;r++)i[r]()}}else for(let i=0;i<this.collectedLeaveElements.length;i++)this.processLeaveNode(this.collectedLeaveElements[i]);if(this.totalQueuedPlayers=0,this.collectedEnterElements.length=0,this.collectedLeaveElements.length=0,this._flushFns.forEach(i=>i()),this._flushFns=[],this._whenQuietFns.length){const i=this._whenQuietFns;this._whenQuietFns=[],t.length?xm(t).onDone(()=>{i.forEach(r=>r())}):i.forEach(r=>r())}}reportError(e){throw function mae(n){return new bt(3402,!1)}()}_flushAnimations(e,t){const i=new FE,r=[],s=new Map,c=[],d=new Map,m=new Map,y=new Map,w=new Set;this.disabledNodes.forEach(qe=>{w.add(qe);const dt=this.driver.query(qe,".ng-animate-queued",!0);for(let Ye=0;Ye<dt.length;Ye++)w.add(dt[Ye])});const S=this.bodyNode,T=Array.from(this.statesByElement.keys()),I=c5(T,this.collectedEnterElements),R=new Map;let k=0;I.forEach((qe,dt)=>{const Ye=BP+k++;R.set(dt,Ye),qe.forEach(gt=>yu(gt,Ye))});const F=[],G=new Set,W=new Set;for(let qe=0;qe<this.collectedLeaveElements.length;qe++){const dt=this.collectedLeaveElements[qe],Ye=dt[_u];Ye&&Ye.setForRemoval&&(F.push(dt),G.add(dt),Ye.hasAnimation?this.driver.query(dt,".ng-star-inserted",!0).forEach(gt=>G.add(gt)):W.add(dt))}const V=new Map,X=c5(T,Array.from(G));X.forEach((qe,dt)=>{const Ye=EE+k++;V.set(dt,Ye),qe.forEach(gt=>yu(gt,Ye))}),e.push(()=>{I.forEach((qe,dt)=>{const Ye=R.get(dt);qe.forEach(gt=>w0(gt,Ye))}),X.forEach((qe,dt)=>{const Ye=V.get(dt);qe.forEach(gt=>w0(gt,Ye))}),F.forEach(qe=>{this.processLeaveNode(qe)})});const ee=[],ae=[];for(let qe=this._namespaceList.length-1;qe>=0;qe--)this._namespaceList[qe].drainQueuedTransitions(t).forEach(Ye=>{const gt=Ye.player,Ot=Ye.element;if(ee.push(gt),this.collectedEnterElements.length){const en=Ot[_u];if(en&&en.setForMove){if(en.previousTriggersValues&&en.previousTriggersValues.has(Ye.triggerName)){const xn=en.previousTriggersValues.get(Ye.triggerName),gn=this.statesByElement.get(Ye.element);if(gn&&gn.has(Ye.triggerName)){const On=gn.get(Ye.triggerName);On.value=xn,gn.set(Ye.triggerName,On)}}return void gt.destroy()}}const pn=!S||!this.driver.containsElement(S,Ot),at=V.get(Ot),Ut=R.get(Ot),zt=this._buildInstruction(Ye,i,Ut,at,pn);if(zt.errors&&zt.errors.length)return void ae.push(zt);if(pn)return gt.onStart(()=>g_(Ot,zt.fromStyles)),gt.onDestroy(()=>ch(Ot,zt.toStyles)),void r.push(gt);if(Ye.isFallbackTransition)return gt.onStart(()=>g_(Ot,zt.fromStyles)),gt.onDestroy(()=>ch(Ot,zt.toStyles)),void r.push(gt);const nt=[];zt.timelines.forEach(en=>{en.stretchStartingKeyframe=!0,this.disabledNodes.has(en.element)||nt.push(en)}),zt.timelines=nt,i.append(Ot,zt.timelines),c.push({instruction:zt,player:gt,element:Ot}),zt.queriedElements.forEach(en=>Tc(d,en,[]).push(gt)),zt.preStyleProps.forEach((en,xn)=>{if(en.size){let gn=m.get(xn);gn||m.set(xn,gn=new Set),en.forEach((On,ii)=>gn.add(ii))}}),zt.postStyleProps.forEach((en,xn)=>{let gn=y.get(xn);gn||y.set(xn,gn=new Set),en.forEach((On,ii)=>gn.add(ii))})});if(ae.length){const qe=[];ae.forEach(dt=>{qe.push(function gae(n,e){return new bt(3505,!1)}())}),ee.forEach(dt=>dt.destroy()),this.reportError(qe)}const Ee=new Map,J=new Map;c.forEach(qe=>{const dt=qe.element;i.has(dt)&&(J.set(dt,dt),this._beforeAnimationBuild(qe.player.namespaceId,qe.instruction,Ee))}),r.forEach(qe=>{const dt=qe.element;this._getPreviousPlayers(dt,!1,qe.namespaceId,qe.triggerName,null).forEach(gt=>{Tc(Ee,dt,[]).push(gt),gt.destroy()})});const pe=F.filter(qe=>d5(qe,m,y)),Oe=new Map;l5(Oe,this.driver,W,y,fp).forEach(qe=>{d5(qe,m,y)&&pe.push(qe)});const xt=new Map;I.forEach((qe,dt)=>{l5(xt,this.driver,new Set(qe),m,"!")}),pe.forEach(qe=>{const dt=Oe.get(qe),Ye=xt.get(qe);Oe.set(qe,new Map([...Array.from(dt?.entries()??[]),...Array.from(Ye?.entries()??[])]))});const Qe=[],Ge=[],ft={};c.forEach(qe=>{const{element:dt,player:Ye,instruction:gt}=qe;if(i.has(dt)){if(w.has(dt))return Ye.onDestroy(()=>ch(dt,gt.toStyles)),Ye.disabled=!0,Ye.overrideTotalTime(gt.totalTime),void r.push(Ye);let Ot=ft;if(J.size>1){let at=dt;const Ut=[];for(;at=at.parentNode;){const zt=J.get(at);if(zt){Ot=zt;break}Ut.push(at)}Ut.forEach(zt=>J.set(zt,Ot))}const pn=this._buildAnimation(Ye.namespaceId,gt,Ee,s,xt,Oe);if(Ye.setRealPlayer(pn),Ot===ft)Qe.push(Ye);else{const at=this.playersByElement.get(Ot);at&&at.length&&(Ye.parentPlayer=xm(at)),r.push(Ye)}}else g_(dt,gt.fromStyles),Ye.onDestroy(()=>ch(dt,gt.toStyles)),Ge.push(Ye),w.has(dt)&&r.push(Ye)}),Ge.forEach(qe=>{const dt=s.get(qe.element);if(dt&&dt.length){const Ye=xm(dt);qe.setRealPlayer(Ye)}}),r.forEach(qe=>{qe.parentPlayer?qe.syncPlayerEvents(qe.parentPlayer):qe.destroy()});for(let qe=0;qe<F.length;qe++){const dt=F[qe],Ye=dt[_u];if(w0(dt,EE),Ye&&Ye.hasAnimation)continue;let gt=[];if(d.size){let pn=d.get(dt);pn&&pn.length&&gt.push(...pn);let at=this.driver.query(dt,zP,!0);for(let Ut=0;Ut<at.length;Ut++){let zt=d.get(at[Ut]);zt&&zt.length&&gt.push(...zt)}}const Ot=gt.filter(pn=>!pn.destroyed);Ot.length?vle(this,dt,Ot):this.processLeaveNode(dt)}return F.length=0,Qe.forEach(qe=>{this.players.push(qe),qe.onDone(()=>{qe.destroy();const dt=this.players.indexOf(qe);this.players.splice(dt,1)}),qe.play()}),Qe}elementContainsData(e,t){let i=!1;const r=t[_u];return r&&r.setForRemoval&&(i=!0),this.playersByElement.has(t)&&(i=!0),this.playersByQueriedElement.has(t)&&(i=!0),this.statesByElement.has(t)&&(i=!0),this._fetchNamespace(e).elementContainsData(t)||i}afterFlush(e){this._flushFns.push(e)}afterFlushAnimationsDone(e){this._whenQuietFns.push(e)}_getPreviousPlayers(e,t,i,r,s){let c=[];if(t){const d=this.playersByQueriedElement.get(e);d&&(c=d)}else{const d=this.playersByElement.get(e);if(d){const m=!s||s==Vw;d.forEach(y=>{y.queued||!m&&y.triggerName!=r||c.push(y)})}}return(i||r)&&(c=c.filter(d=>!(i&&i!=d.namespaceId||r&&r!=d.triggerName))),c}_beforeAnimationBuild(e,t,i){const s=t.element,c=t.isRemovalTransition?void 0:e,d=t.isRemovalTransition?void 0:t.triggerName;for(const m of t.timelines){const y=m.element,w=y!==s,S=Tc(i,y,[]);this._getPreviousPlayers(y,w,c,d,t.toState).forEach(I=>{const R=I.getRealPlayer();R.beforeDestroy&&R.beforeDestroy(),I.destroy(),S.push(I)})}g_(s,t.fromStyles)}_buildAnimation(e,t,i,r,s,c){const d=t.triggerName,m=t.element,y=[],w=new Set,S=new Set,T=t.timelines.map(R=>{const k=R.element;w.add(k);const F=k[_u];if(F&&F.removedBeforeQueried)return new Ob(R.duration,R.delay);const G=k!==m,W=function xle(n){const e=[];return u5(n,e),e}((i.get(k)||hle).map(Ee=>Ee.getRealPlayer())).filter(Ee=>!!Ee.element&&Ee.element===k),V=s.get(k),X=c.get(k),ee=OU(0,this._normalizer,0,R.keyframes,V,X),ae=this._buildPlayer(R,ee,W);if(R.subTimeline&&r&&S.add(k),G){const Ee=new JP(e,d,k);Ee.setRealPlayer(ae),y.push(Ee)}return ae});y.forEach(R=>{Tc(this.playersByQueriedElement,R.element,[]).push(R),R.onDone(()=>function gle(n,e,t){let i=n.get(e);if(i){if(i.length){const r=i.indexOf(t);i.splice(r,1)}0==i.length&&n.delete(e)}return i}(this.playersByQueriedElement,R.element,R))}),w.forEach(R=>yu(R,jU));const I=xm(T);return I.onDestroy(()=>{w.forEach(R=>w0(R,jU)),ch(m,t.toStyles)}),S.forEach(R=>{Tc(r,R,[]).push(I)}),I}_buildPlayer(e,t,i){return t.length>0?this.driver.animate(e.element,t,e.duration,e.delay,e.easing,i):new Ob(e.duration,e.delay)}}class JP{constructor(e,t,i){this.namespaceId=e,this.triggerName=t,this.element=i,this._player=new Ob,this._containsRealPlayer=!1,this._queuedCallbacks=new Map,this.destroyed=!1,this.markedForDestroy=!1,this.disabled=!1,this.queued=!0,this.totalTime=0}setRealPlayer(e){this._containsRealPlayer||(this._player=e,this._queuedCallbacks.forEach((t,i)=>{t.forEach(r=>RP(e,i,void 0,r))}),this._queuedCallbacks.clear(),this._containsRealPlayer=!0,this.overrideTotalTime(e.totalTime),this.queued=!1)}getRealPlayer(){return this._player}overrideTotalTime(e){this.totalTime=e}syncPlayerEvents(e){const t=this._player;t.triggerCallback&&e.onStart(()=>t.triggerCallback("start")),e.onDone(()=>this.finish()),e.onDestroy(()=>this.destroy())}_queueEvent(e,t){Tc(this._queuedCallbacks,e,[]).push(t)}onDone(e){this.queued&&this._queueEvent("done",e),this._player.onDone(e)}onStart(e){this.queued&&this._queueEvent("start",e),this._player.onStart(e)}onDestroy(e){this.queued&&this._queueEvent("destroy",e),this._player.onDestroy(e)}init(){this._player.init()}hasStarted(){return!this.queued&&this._player.hasStarted()}play(){!this.queued&&this._player.play()}pause(){!this.queued&&this._player.pause()}restart(){!this.queued&&this._player.restart()}finish(){this._player.finish()}destroy(){this.destroyed=!0,this._player.destroy()}reset(){!this.queued&&this._player.reset()}setPosition(e){this.queued||this._player.setPosition(e)}getPosition(){return this.queued?0:this._player.getPosition()}triggerCallback(e){const t=this._player;t.triggerCallback&&t.triggerCallback(e)}}function zE(n){return n&&1===n.nodeType}function a5(n,e){const t=n.style.display;return n.style.display=e??"none",t}function l5(n,e,t,i,r){const s=[];t.forEach(m=>s.push(a5(m)));const c=[];i.forEach((m,y)=>{const w=new Map;m.forEach(S=>{const T=e.computeStyle(y,S,r);w.set(S,T),(!T||0==T.length)&&(y[_u]=ple,c.push(y))}),n.set(y,w)});let d=0;return t.forEach(m=>a5(m,s[d++])),c}function c5(n,e){const t=new Map;if(n.forEach(d=>t.set(d,[])),0==e.length)return t;const r=new Set(e),s=new Map;function c(d){if(!d)return 1;let m=s.get(d);if(m)return m;const y=d.parentNode;return m=t.has(y)?y:r.has(y)?1:c(y),s.set(d,m),m}return e.forEach(d=>{const m=c(d);1!==m&&t.get(m).push(d)}),t}function yu(n,e){n.classList?.add(e)}function w0(n,e){n.classList?.remove(e)}function vle(n,e,t){xm(t).onDone(()=>n.processLeaveNode(e))}function u5(n,e){for(let t=0;t<n.length;t++){const i=n[t];i instanceof ZF?u5(i.players,e):e.push(i)}}function d5(n,e,t){const i=t.get(n);if(!i)return!1;let r=e.get(n);return r?i.forEach(s=>r.add(s)):e.set(n,i),t.delete(n),!0}class VE{constructor(e,t,i){this.bodyNode=e,this._driver=t,this._normalizer=i,this._triggerCache={},this.onRemovalComplete=(r,s)=>{},this._transitionEngine=new mle(e,t,i),this._timelineEngine=new ale(e,t,i),this._transitionEngine.onRemovalComplete=(r,s)=>this.onRemovalComplete(r,s)}registerTrigger(e,t,i,r,s){const c=e+"-"+r;let d=this._triggerCache[c];if(!d){const m=[],w=GP(this._driver,s,m,[]);if(m.length)throw function sae(n,e){return new bt(3404,!1)}();d=function ile(n,e,t){return new rle(n,e,t)}(r,w,this._normalizer),this._triggerCache[c]=d}this._transitionEngine.registerTrigger(t,r,d)}register(e,t){this._transitionEngine.register(e,t)}destroy(e,t){this._transitionEngine.destroy(e,t)}onInsert(e,t,i,r){this._transitionEngine.insertNode(e,t,i,r)}onRemove(e,t,i,r){this._transitionEngine.removeNode(e,t,r||!1,i)}disableAnimations(e,t){this._transitionEngine.markElementAsDisabled(e,t)}process(e,t,i,r){if("@"==i.charAt(0)){const[s,c]=FU(i);this._timelineEngine.command(s,t,c,r)}else this._transitionEngine.trigger(e,t,i,r)}listen(e,t,i,r,s){if("@"==i.charAt(0)){const[c,d]=FU(i);return this._timelineEngine.listen(c,t,d,s)}return this._transitionEngine.listen(e,t,i,r,s)}flush(e=-1){this._transitionEngine.flush(e)}get players(){return this._transitionEngine.players.concat(this._timelineEngine.players)}whenRenderingDone(){return this._transitionEngine.whenRenderingDone()}}let Mle=(()=>{class n{constructor(t,i,r){this._element=t,this._startStyles=i,this._endStyles=r,this._state=0;let s=n.initialStylesByElement.get(t);s||n.initialStylesByElement.set(t,s=new Map),this._initialStyles=s}start(){this._state<1&&(this._startStyles&&ch(this._element,this._startStyles,this._initialStyles),this._state=1)}finish(){this.start(),this._state<2&&(ch(this._element,this._initialStyles),this._endStyles&&(ch(this._element,this._endStyles),this._endStyles=null),this._state=1)}destroy(){this.finish(),this._state<3&&(n.initialStylesByElement.delete(this._element),this._startStyles&&(g_(this._element,this._startStyles),this._endStyles=null),this._endStyles&&(g_(this._element,this._endStyles),this._endStyles=null),ch(this._element,this._initialStyles),this._state=3)}}return n.initialStylesByElement=new WeakMap,n})();function eR(n){let e=null;return n.forEach((t,i)=>{(function Cle(n){return"display"===n||"position"===n})(i)&&(e=e||new Map,e.set(i,t))}),e}class h5{constructor(e,t,i,r){this.element=e,this.keyframes=t,this.options=i,this._specialStyles=r,this._onDoneFns=[],this._onStartFns=[],this._onDestroyFns=[],this._initialized=!1,this._finished=!1,this._started=!1,this._destroyed=!1,this._originalOnDoneFns=[],this._originalOnStartFns=[],this.time=0,this.parentPlayer=null,this.currentSnapshot=new Map,this._duration=i.duration,this._delay=i.delay||0,this.time=this._duration+this._delay}_onFinish(){this._finished||(this._finished=!0,this._onDoneFns.forEach(e=>e()),this._onDoneFns=[])}init(){this._buildPlayer(),this._preparePlayerBeforeStart()}_buildPlayer(){if(this._initialized)return;this._initialized=!0;const e=this.keyframes;this.domPlayer=this._triggerWebAnimation(this.element,e,this.options),this._finalKeyframe=e.length?e[e.length-1]:new Map,this.domPlayer.addEventListener("finish",()=>this._onFinish())}_preparePlayerBeforeStart(){this._delay?this._resetDomPlayerState():this.domPlayer.pause()}_convertKeyframesToObject(e){const t=[];return e.forEach(i=>{t.push(Object.fromEntries(i))}),t}_triggerWebAnimation(e,t,i){return e.animate(this._convertKeyframesToObject(t),i)}onStart(e){this._originalOnStartFns.push(e),this._onStartFns.push(e)}onDone(e){this._originalOnDoneFns.push(e),this._onDoneFns.push(e)}onDestroy(e){this._onDestroyFns.push(e)}play(){this._buildPlayer(),this.hasStarted()||(this._onStartFns.forEach(e=>e()),this._onStartFns=[],this._started=!0,this._specialStyles&&this._specialStyles.start()),this.domPlayer.play()}pause(){this.init(),this.domPlayer.pause()}finish(){this.init(),this._specialStyles&&this._specialStyles.finish(),this._onFinish(),this.domPlayer.finish()}reset(){this._resetDomPlayerState(),this._destroyed=!1,this._finished=!1,this._started=!1,this._onStartFns=this._originalOnStartFns,this._onDoneFns=this._originalOnDoneFns}_resetDomPlayerState(){this.domPlayer&&this.domPlayer.cancel()}restart(){this.reset(),this.play()}hasStarted(){return this._started}destroy(){this._destroyed||(this._destroyed=!0,this._resetDomPlayerState(),this._onFinish(),this._specialStyles&&this._specialStyles.destroy(),this._onDestroyFns.forEach(e=>e()),this._onDestroyFns=[])}setPosition(e){void 0===this.domPlayer&&this.init(),this.domPlayer.currentTime=e*this.time}getPosition(){return this.domPlayer.currentTime/this.time}get totalTime(){return this._delay+this._duration}beforeDestroy(){const e=new Map;this.hasStarted()&&this._finalKeyframe.forEach((i,r)=>{"offset"!==r&&e.set(r,this._finished?i:YU(this.element,r))}),this.currentSnapshot=e}triggerCallback(e){const t="start"===e?this._onStartFns:this._onDoneFns;t.forEach(i=>i()),t.length=0}}class Sle{validateStyleProperty(e){return!0}validateAnimatableStyleProperty(e){return!0}matchesElement(e,t){return!1}containsElement(e,t){return VU(e,t)}getParentElement(e){return FP(e)}query(e,t,i){return UU(e,t,i)}computeStyle(e,t,i){return window.getComputedStyle(e)[t]}animate(e,t,i,r,s,c=[]){const m={duration:i,delay:r,fill:0==r?"both":"forwards"};s&&(m.easing=s);const y=new Map,w=c.filter(I=>I instanceof h5);(function Aae(n,e){return 0===n||0===e})(i,r)&&w.forEach(I=>{I.currentSnapshot.forEach((R,k)=>y.set(k,R))});let S=function Sae(n){return n.length?n[0]instanceof Map?n:n.map(e=>$U(e)):[]}(t).map(I=>bm(I));S=function Iae(n,e,t){if(t.size&&e.length){let i=e[0],r=[];if(t.forEach((s,c)=>{i.has(c)||r.push(c),i.set(c,s)}),r.length)for(let s=1;s<e.length;s++){let c=e[s];r.forEach(d=>c.set(d,YU(n,d)))}}return e}(e,S,y);const T=function wle(n,e){let t=null,i=null;return Array.isArray(e)&&e.length?(t=eR(e[0]),e.length>1&&(i=eR(e[e.length-1]))):e instanceof Map&&(t=eR(e)),t||i?new Mle(n,t,i):null}(e,S);return new h5(e,S,m,T)}}let Ele=(()=>{class n extends $F{constructor(t,i){super(),this._nextAnimationId=0,this._renderer=t.createRenderer(i.body,{id:"0",encapsulation:pa.None,styles:[],data:{animation:[]}})}build(t){const i=this._nextAnimationId.toString();this._nextAnimationId++;const r=Array.isArray(t)?WF(t):t;return p5(this._renderer,null,i,"register",[r]),new Tle(i,this._renderer)}}return n.\u0275fac=function(t){return new(t||n)(Xe(sg),Xe(Vi))},n.\u0275prov=Yt({token:n,factory:n.\u0275fac}),n})();class Tle extends class $W{}{constructor(e,t){super(),this._id=e,this._renderer=t}create(e,t){return new Dle(this._id,e,t||{},this._renderer)}}class Dle{constructor(e,t,i,r){this.id=e,this.element=t,this._renderer=r,this.parentPlayer=null,this._started=!1,this.totalTime=0,this._command("create",i)}_listen(e,t){return this._renderer.listen(this.element,`@@${this.id}:${e}`,t)}_command(e,...t){return p5(this._renderer,this.element,this.id,e,t)}onDone(e){this._listen("done",e)}onStart(e){this._listen("start",e)}onDestroy(e){this._listen("destroy",e)}init(){this._command("init")}hasStarted(){return this._started}play(){this._command("play"),this._started=!0}pause(){this._command("pause")}restart(){this._command("restart")}finish(){this._command("finish")}destroy(){this._command("destroy")}reset(){this._command("reset"),this._started=!1}setPosition(e){this._command("setPosition",e)}getPosition(){return this._renderer.engine.players[+this.id]?.getPosition()??0}}function p5(n,e,t,i,r){return n.setProperty(e,`@@${t}:${i}`,r)}const f5="@.disabled";let Ale=(()=>{class n{constructor(t,i,r){this.delegate=t,this.engine=i,this._zone=r,this._currentId=0,this._microtaskId=1,this._animationCallbacksBuffer=[],this._rendererCache=new Map,this._cdRecurDepth=0,this.promise=Promise.resolve(0),i.onRemovalComplete=(s,c)=>{const d=c?.parentNode(s);d&&c.removeChild(d,s)}}createRenderer(t,i){const s=this.delegate.createRenderer(t,i);if(!(t&&i&&i.data&&i.data.animation)){let w=this._rendererCache.get(s);return w||(w=new m5("",s,this.engine,()=>this._rendererCache.delete(s)),this._rendererCache.set(s,w)),w}const c=i.id,d=i.id+"-"+this._currentId;this._currentId++,this.engine.register(d,t);const m=w=>{Array.isArray(w)?w.forEach(m):this.engine.registerTrigger(c,d,t,w.name,w)};return i.data.animation.forEach(m),new Ile(this,d,s,this.engine)}begin(){this._cdRecurDepth++,this.delegate.begin&&this.delegate.begin()}_scheduleCountTask(){this.promise.then(()=>{this._microtaskId++})}scheduleListenerCallback(t,i,r){t>=0&&t<this._microtaskId?this._zone.run(()=>i(r)):(0==this._animationCallbacksBuffer.length&&Promise.resolve(null).then(()=>{this._zone.run(()=>{this._animationCallbacksBuffer.forEach(s=>{const[c,d]=s;c(d)}),this._animationCallbacksBuffer=[]})}),this._animationCallbacksBuffer.push([i,r]))}end(){this._cdRecurDepth--,0==this._cdRecurDepth&&this._zone.runOutsideAngular(()=>{this._scheduleCountTask(),this.engine.flush(this._microtaskId)}),this.delegate.end&&this.delegate.end()}whenRenderingDone(){return this.engine.whenRenderingDone()}}return n.\u0275fac=function(t){return new(t||n)(Xe(sg),Xe(VE),Xe(nr))},n.\u0275prov=Yt({token:n,factory:n.\u0275fac}),n})();class m5{constructor(e,t,i,r){this.namespaceId=e,this.delegate=t,this.engine=i,this._onDestroy=r,this.destroyNode=this.delegate.destroyNode?s=>t.destroyNode(s):null}get data(){return this.delegate.data}destroy(){this.engine.destroy(this.namespaceId,this.delegate),this.delegate.destroy(),this._onDestroy?.()}createElement(e,t){return this.delegate.createElement(e,t)}createComment(e){return this.delegate.createComment(e)}createText(e){return this.delegate.createText(e)}appendChild(e,t){this.delegate.appendChild(e,t),this.engine.onInsert(this.namespaceId,t,e,!1)}insertBefore(e,t,i,r=!0){this.delegate.insertBefore(e,t,i),this.engine.onInsert(this.namespaceId,t,e,r)}removeChild(e,t,i){this.engine.onRemove(this.namespaceId,t,this.delegate,i)}selectRootElement(e,t){return this.delegate.selectRootElement(e,t)}parentNode(e){return this.delegate.parentNode(e)}nextSibling(e){return this.delegate.nextSibling(e)}setAttribute(e,t,i,r){this.delegate.setAttribute(e,t,i,r)}removeAttribute(e,t,i){this.delegate.removeAttribute(e,t,i)}addClass(e,t){this.delegate.addClass(e,t)}removeClass(e,t){this.delegate.removeClass(e,t)}setStyle(e,t,i,r){this.delegate.setStyle(e,t,i,r)}removeStyle(e,t,i){this.delegate.removeStyle(e,t,i)}setProperty(e,t,i){"@"==t.charAt(0)&&t==f5?this.disableAnimations(e,!!i):this.delegate.setProperty(e,t,i)}setValue(e,t){this.delegate.setValue(e,t)}listen(e,t,i){return this.delegate.listen(e,t,i)}disableAnimations(e,t){this.engine.disableAnimations(e,t)}}class Ile extends m5{constructor(e,t,i,r,s){super(t,i,r,s),this.factory=e,this.namespaceId=t}setProperty(e,t,i){"@"==t.charAt(0)?"."==t.charAt(1)&&t==f5?this.disableAnimations(e,i=void 0===i||!!i):this.engine.process(this.namespaceId,e,t.slice(1),i):this.delegate.setProperty(e,t,i)}listen(e,t,i){if("@"==t.charAt(0)){const r=function Ple(n){switch(n){case"body":return document.body;case"document":return document;case"window":return window;default:return n}}(e);let s=t.slice(1),c="";return"@"!=s.charAt(0)&&([s,c]=function Rle(n){const e=n.indexOf(".");return[n.substring(0,e),n.slice(e+1)]}(s)),this.engine.listen(this.namespaceId,r,s,c,d=>{this.factory.scheduleListenerCallback(d._data||-1,i,d)})}return this.delegate.listen(e,t,i)}}const g5=[{provide:$F,useClass:Ele},{provide:ZP,useFactory:function Lle(){return new Jae}},{provide:VE,useClass:(()=>{class n extends VE{constructor(t,i,r,s){super(t.body,i,r)}ngOnDestroy(){this.flush()}}return n.\u0275fac=function(t){return new(t||n)(Xe(Vi),Xe(NP),Xe(ZP),Xe(ov))},n.\u0275prov=Yt({token:n,factory:n.\u0275fac}),n})()},{provide:sg,useFactory:function Ole(n,e,t){return new Ale(n,e,t)},deps:[rC,VE,nr]}],tR=[{provide:NP,useFactory:()=>new Sle},{provide:ru,useValue:"BrowserAnimations"},...g5],_5=[{provide:NP,useClass:HU},{provide:ru,useValue:"NoopAnimations"},...g5];let Fle=(()=>{class n{static withConfig(t){return{ngModule:n,providers:t.disableAnimations?_5:tR}}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=Gn({type:n}),n.\u0275inj=Bn({providers:tR,imports:[nF]}),n})(),zle=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=Gn({type:n}),n.\u0275inj=Bn({imports:[SC,Lb,au,Fb,Ki,Ki]}),n})(),Ule=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=Gn({type:n,bootstrap:[aoe]}),n.\u0275inj=Bn({imports:[nF,ooe,Fle,NW,C9,_C,Fb,aq,E9,tB,SZ,uoe,b3,Soe,iQ,SW,eZ,a9,zle,Noe,xK,NZ]}),n})();(function LG(){tO=!1})(),s$().bootstrapModule(Ule).catch(n=>console.error(n))},898:function(M0){M0.exports=function(){"use strict";var Lp,Op,sr;function wm(g,lt){if(Lp)if(Op){var Al="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+Lp+")(sharedChunk); ("+Op+")(sharedChunk); self.onerror = null;",Aa={};Lp(Aa),sr=lt(Aa),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(sr.workerUrl=window.URL.createObjectURL(new Blob([Al],{type:"text/javascript"})))}else Op=lt;else Lp=lt}return wm(0,function(g){var lt=typeof self<"u"?self:{},Al="2.11.0";let Aa;const wi={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(null==Aa){const a=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{Aa=null!=process.env.API_URL_REGEX?new RegExp(process.env.API_URL_REGEX):a}catch{Aa=a}}return Aa},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get EVENTS_URL(){return this.API_URL?0===this.API_URL.indexOf("https://api.mapbox.cn")?"https://events.mapbox.cn/events/v2":0===this.API_URL.indexOf("https://api.mapbox.com")?"https://events.mapbox.com/events/v2":null:null},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},mi={supported:!1,testSupport:function(a){!Ja&&ro&&(hh?ph(a):Ss=a)}};let Ss,ro,Ja=!1,hh=!1;function ph(a){const o=a.createTexture();a.bindTexture(a.TEXTURE_2D,o);try{if(a.texImage2D(a.TEXTURE_2D,0,a.RGBA,a.RGBA,a.UNSIGNED_BYTE,ro),a.isContextLost())return;mi.supported=!0}catch{}a.deleteTexture(o),Ja=!0}lt.document&&(ro=lt.document.createElement("img"),ro.onload=function(){Ss&&ph(Ss),Ss=null,hh=!0},ro.onerror=function(){Ja=!0,Ss=null},ro.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const Il="01";var Pc=Ia;function Ia(a,o,l,h){this.cx=3*a,this.bx=3*(l-a)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*o,this.by=3*(h-o)-this.cy,this.ay=1-this.cy-this.by,this.p1x=a,this.p1y=o,this.p2x=l,this.p2y=h}Ia.prototype={sampleCurveX:function(a){return((this.ax*a+this.bx)*a+this.cx)*a},sampleCurveY:function(a){return((this.ay*a+this.by)*a+this.cy)*a},sampleCurveDerivativeX:function(a){return(3*this.ax*a+2*this.bx)*a+this.cx},solveCurveX:function(a,o){if(void 0===o&&(o=1e-6),a<0)return 0;if(a>1)return 1;for(var l=a,h=0;h<8;h++){var f=this.sampleCurveX(l)-a;if(Math.abs(f)<o)return l;var v=this.sampleCurveDerivativeX(l);if(Math.abs(v)<1e-6)break;l-=f/v}var b=0,C=1;for(l=a,h=0;h<20&&(f=this.sampleCurveX(l),!(Math.abs(f-a)<o));h++)a>f?b=l:C=l,l=.5*(C-b)+b;return l},solve:function(a,o){return this.sampleCurveY(this.solveCurveX(a,o))}};var Ht=Pa;function Pa(a,o){this.x=a,this.y=o}Pa.prototype={clone:function(){return new Pa(this.x,this.y)},add:function(a){return this.clone()._add(a)},sub:function(a){return this.clone()._sub(a)},multByPoint:function(a){return this.clone()._multByPoint(a)},divByPoint:function(a){return this.clone()._divByPoint(a)},mult:function(a){return this.clone()._mult(a)},div:function(a){return this.clone()._div(a)},rotate:function(a){return this.clone()._rotate(a)},rotateAround:function(a,o){return this.clone()._rotateAround(a,o)},matMult:function(a){return this.clone()._matMult(a)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(a){return this.x===a.x&&this.y===a.y},dist:function(a){return Math.sqrt(this.distSqr(a))},distSqr:function(a){var o=a.x-this.x,l=a.y-this.y;return o*o+l*l},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(a){return Math.atan2(this.y-a.y,this.x-a.x)},angleWith:function(a){return this.angleWithSep(a.x,a.y)},angleWithSep:function(a,o){return Math.atan2(this.x*o-this.y*a,this.x*a+this.y*o)},_matMult:function(a){var o=a[2]*this.x+a[3]*this.y;return this.x=a[0]*this.x+a[1]*this.y,this.y=o,this},_add:function(a){return this.x+=a.x,this.y+=a.y,this},_sub:function(a){return this.x-=a.x,this.y-=a.y,this},_mult:function(a){return this.x*=a,this.y*=a,this},_div:function(a){return this.x/=a,this.y/=a,this},_multByPoint:function(a){return this.x*=a.x,this.y*=a.y,this},_divByPoint:function(a){return this.x/=a.x,this.y/=a.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var a=this.y;return this.y=this.x,this.x=-a,this},_rotate:function(a){var o=Math.cos(a),l=Math.sin(a),h=l*this.x+o*this.y;return this.x=o*this.x-l*this.y,this.y=h,this},_rotateAround:function(a,o){var l=Math.cos(a),h=Math.sin(a),f=o.y+h*(this.x-o.x)+l*(this.y-o.y);return this.x=o.x+l*(this.x-o.x)-h*(this.y-o.y),this.y=f,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},Pa.convert=function(a){return a instanceof Pa?a:Array.isArray(a)?new Pa(a[0],a[1]):a};const Kl=Math.PI/180,Fp=180/Math.PI;function Si(a){return a*Kl}function Es(a){return a*Fp}const xu=[[0,0],[1,0],[1,1],[0,1]];function bu(a){if(a<=0)return 0;if(a>=1)return 1;const o=a*a,l=o*a;return 4*(a<.5?l:3*(a-o)+l-.75)}function fh(a,o,l,h){const f=new Pc(a,o,l,h);return function(v){return f.solve(v)}}const wu=fh(.25,.1,.25,1);function Ei(a,o,l){return Math.min(l,Math.max(o,a))}function Mu(a,o,l){return(l=Ei((l-a)/(o-a),0,1))*l*(3-2*l)}function Wo(a,o,l){const h=l-o,f=((a-o)%h+h)%h+o;return f===o?l:f}function Rc(a,o,l){if(!a.length)return l(null,[]);let h=a.length;const f=new Array(a.length);let v=null;a.forEach((b,C)=>{o(b,(D,A)=>{D&&(v=D),f[C]=A,0==--h&&l(v,f)})})}function kc(a){const o=[];for(const l in a)o.push(a[l]);return o}function ci(a,...o){for(const l of o)for(const h in l)a[h]=l[h];return a}let Cu=1;function mh(){return Cu++}function Ql(){return function a(o){return o?(o^Math.random()*(16>>o/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,a)}()}function Pl(a){return a<=1?1:Math.pow(2,Math.ceil(Math.log(a)/Math.LN2))}function si(a){return!!a&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(a)}function Lc(a,o){a.forEach(l=>{o[l]&&(o[l]=o[l].bind(o))})}function ca(a,o){return-1!==a.indexOf(o,a.length-o.length)}function Dr(a,o,l){const h={};for(const f in a)h[f]=o.call(l||this,a[f],f,a);return h}function Pr(a,o,l){const h={};for(const f in a)o.call(l||this,a[f],f,a)&&(h[f]=a[f]);return h}function ua(a){return Array.isArray(a)?a.map(ua):"object"==typeof a&&a?Dr(a,ua):a}const ei={};function Vr(a){ei[a]||(typeof console<"u"&&console.warn(a),ei[a]=!0)}function Rl(a,o,l){return(l.y-a.y)*(o.x-a.x)>(o.y-a.y)*(l.x-a.x)}function Ri(a){let o=0;for(let l,h,f=0,v=a.length,b=v-1;f<v;b=f++)l=a[f],h=a[b],o+=(h.x-l.x)*(l.y+h.y);return o}function kl(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function Np(a){const o={};if(a.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(l,h,f,v)=>{const b=f||v;return o[h]=!b||b.toLowerCase(),""}),o["max-age"]){const l=parseInt(o["max-age"],10);isNaN(l)?delete o["max-age"]:o["max-age"]=l}return o}let Oc=null;function gh(a){if(null==Oc){const o=a.navigator?a.navigator.userAgent:null;Oc=!!a.safari||!(!o||!(/\b(iPad|iPhone|iPod)\b/.test(o)||o.match("Safari")&&!o.match("Chrome")))}return Oc}function _h(a){try{const o=lt[a];return o.setItem("_mapbox_test_",1),o.removeItem("_mapbox_test_"),!0}catch{return!1}}function Su(a,o){return[a[4*o],a[4*o+1],a[4*o+2],a[4*o+3]]}const yh="mapbox-tiles";let qo,Jl,xd=500,Bp=50;function vh(){try{return lt.caches}catch{}}function Eu(){vh()&&!qo&&(qo=lt.caches.open(yh))}function el(a){const o=a.indexOf("?");if(o<0)return a;const h=function(f){const v=f.indexOf("?");return v>0?f.slice(v+1).split("&"):[]}(a).filter(f=>{const v=f.split("=");return"language"===v[0]||"worldview"===v[0]});return h.length?`${a.slice(0,o)}?${h.join("&")}`:a.slice(0,o)}let bd=1/0;const Ra={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};"function"==typeof Object.freeze&&Object.freeze(Ra);class xh extends Error{constructor(o,l,h){401===l&&Iu(h)&&(o+=": you may have provided an invalid Mapbox access token. See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes"),super(o),this.status=l,this.url=h}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const bh=kl()?()=>self.worker&&self.worker.referrer:()=>("blob:"===lt.location.protocol?lt.parent:lt).location.href,Fc=function(a,o){if(!(/^file:/.test(l=a.url)||/^file:/.test(bh())&&!/^\w+:/.test(l))){if(lt.fetch&&lt.Request&&lt.AbortController&&lt.Request.prototype.hasOwnProperty("signal"))return function(h,f){const v=new lt.AbortController,b=new lt.Request(h.url,{method:h.method||"GET",body:h.body,credentials:h.credentials,headers:h.headers,referrer:bh(),signal:v.signal});let C=!1,D=!1;const A=(L=b.url).indexOf("sku=")>0&&Iu(L);var L;"json"===h.type&&b.headers.set("Accept","application/json");const B=(j,$,Y)=>{if(D)return;if(j&&"SecurityError"!==j.message&&Vr(j),$&&Y)return z($);const te=Date.now();lt.fetch(b).then(me=>{if(me.ok){const Ce=A?me.clone():null;return z(me,Ce,te)}return f(new xh(me.statusText,me.status,h.url))}).catch(me=>{20!==me.code&&f(new Error(me.message))})},z=(j,$,Y)=>{("arrayBuffer"===h.type?j.arrayBuffer():"json"===h.type?j.json():j.text()).then(te=>{D||($&&Y&&function(me,Ce,fe){if(Eu(),!qo)return;const be={status:Ce.status,statusText:Ce.statusText,headers:new lt.Headers};Ce.headers.forEach((Ze,$e)=>be.headers.set($e,Ze));const Pe=Np(Ce.headers.get("Cache-Control")||"");if(Pe["no-store"])return;Pe["max-age"]&&be.headers.set("Expires",new Date(fe+1e3*Pe["max-age"]).toUTCString());const Te=be.headers.get("Expires");Te&&(new Date(Te).getTime()-fe<42e4||function(Ze,$e){if(void 0===Jl)try{new Response(new ReadableStream),Jl=!0}catch{Jl=!1}Jl?$e(Ze.body):Ze.blob().then($e)}(Ce,Ze=>{const $e=new lt.Response(Ze,be);Eu(),qo&&qo.then(ct=>ct.put(el(me.url),$e)).catch(ct=>Vr(ct.message))}))}(b,$,Y),C=!0,f(null,te,j.headers.get("Cache-Control"),j.headers.get("Expires")))}).catch(te=>{D||f(new Error(te.message))})};return A?function(j,$){if(Eu(),!qo)return $(null);const Y=el(j.url);qo.then(te=>{te.match(Y).then(me=>{const Ce=function(fe){if(!fe)return!1;const be=new Date(fe.headers.get("Expires")||0),Pe=Np(fe.headers.get("Cache-Control")||"");return be>Date.now()&&!Pe["no-cache"]}(me);te.delete(Y),Ce&&te.put(Y,me.clone()),$(null,me,Ce)}).catch($)}).catch($)}(b,B):B(null,null),{cancel:()=>{D=!0,C||v.abort()}}}(a,o);if(kl()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",a,o,void 0,!0)}var l;return function(h,f){const v=new lt.XMLHttpRequest;v.open(h.method||"GET",h.url,!0),"arrayBuffer"===h.type&&(v.responseType="arraybuffer");for(const b in h.headers)v.setRequestHeader(b,h.headers[b]);return"json"===h.type&&(v.responseType="text",v.setRequestHeader("Accept","application/json")),v.withCredentials="include"===h.credentials,v.onerror=()=>{f(new Error(v.statusText))},v.onload=()=>{if((v.status>=200&&v.status<300||0===v.status)&&null!==v.response){let b=v.response;if("json"===h.type)try{b=JSON.parse(v.response)}catch(C){return f(C)}f(null,b,v.getResponseHeader("Cache-Control"),v.getResponseHeader("Expires"))}else f(new xh(v.statusText,v.status,h.url))},v.send(h.body),{cancel:()=>v.abort()}}(a,o)},Tu=function(a,o){return Fc(ci(a,{type:"arrayBuffer"}),o)};function zp(a){const o=lt.document.createElement("a");return o.href=a,o.protocol===lt.document.location.protocol&&o.host===lt.document.location.host}const Mm="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let wh,Du;wh=[],Du=0;const Nc=function(a,o){if(mi.supported&&(a.headers||(a.headers={}),a.headers.accept="image/webp,*/*"),Du>=wi.MAX_PARALLEL_IMAGE_REQUESTS){const v={requestParameters:a,callback:o,cancelled:!1,cancel(){this.cancelled=!0}};return wh.push(v),v}Du++;let l=!1;const h=()=>{if(!l)for(l=!0,Du--;wh.length&&Du<wi.MAX_PARALLEL_IMAGE_REQUESTS;){const v=wh.shift(),{requestParameters:b,callback:C,cancelled:D}=v;D||(v.cancel=Nc(b,C).cancel)}},f=Tu(a,(v,b,C,D)=>{h(),v?o(v):b&&(lt.createImageBitmap?function(A,L){const B=new lt.Blob([new Uint8Array(A)],{type:"image/png"});lt.createImageBitmap(B).then(z=>{L(null,z)}).catch(z=>{L(new Error(`Could not load image because of ${z.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(b,(A,L)=>o(A,L,C,D)):function(A,L){const B=new lt.Image,z=lt.URL;B.onload=()=>{L(null,B),z.revokeObjectURL(B.src),B.onload=null,lt.requestAnimationFrame(()=>{B.src=Mm})},B.onerror=()=>L(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const j=new lt.Blob([new Uint8Array(A)],{type:"image/png"});B.src=A.byteLength?z.createObjectURL(j):Mm}(b,(A,L)=>o(A,L,C,D)))});return{cancel:()=>{f.cancel(),h()}}},Au="NO_ACCESS_TOKEN";function ka(a){return 0===a.indexOf("mapbox:")}function Iu(a){return wi.API_URL_REGEX.test(a)}function Mh(a){return wi.API_STYLE_REGEX.test(a)&&!wd(a)}function wd(a){return wi.API_SPRITE_REGEX.test(a)}const Pu=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Io(a){const o=a.match(Pu);if(!o)throw new Error("Unable to parse URL object");return{protocol:o[1],authority:o[2],path:o[3]||"/",params:o[4]?o[4].split("&"):[]}}function Bc(a){const o=a.params.length?`?${a.params.join("&")}`:"";return`${a.protocol}://${a.authority}${a.path}${o}`}function Md(a){if(!a)return null;const o=a.split(".");if(!o||3!==o.length)return null;try{return JSON.parse(decodeURIComponent(lt.atob(o[1]).split("").map(l=>"%"+("00"+l.charCodeAt(0).toString(16)).slice(-2)).join("")))}catch{return null}}class ws{constructor(o){this.type=o,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(o){const l=Md(wi.ACCESS_TOKEN);let h="";return h=l&&l.u?lt.btoa(encodeURIComponent(l.u).replace(/%([0-9A-F]{2})/g,(f,v)=>String.fromCharCode(Number("0x"+v)))):wi.ACCESS_TOKEN||"",o?`mapbox.eventData.${o}:${h}`:`mapbox.eventData:${h}`}fetchEventData(){const o=_h("localStorage"),l=this.getStorageKey(),h=this.getStorageKey("uuid");if(o)try{const f=lt.localStorage.getItem(l);f&&(this.eventData=JSON.parse(f));const v=lt.localStorage.getItem(h);v&&(this.anonId=v)}catch{Vr("Unable to read from LocalStorage")}}saveEventData(){const o=_h("localStorage"),l=this.getStorageKey(),h=this.getStorageKey("uuid");if(o)try{lt.localStorage.setItem(h,this.anonId),Object.keys(this.eventData).length>=1&&lt.localStorage.setItem(l,JSON.stringify(this.eventData))}catch{Vr("Unable to write to LocalStorage")}}processRequests(o){}postEvent(o,l,h,f){if(!wi.EVENTS_URL)return;const v=Io(wi.EVENTS_URL);v.params.push(`access_token=${f||wi.ACCESS_TOKEN||""}`);const b={event:this.type,created:new Date(o).toISOString()},C=l?ci(b,l):b,D={url:Bc(v),headers:{"Content-Type":"text/plain"},body:JSON.stringify([C])};var L;this.pendingRequest=(L=A=>{this.pendingRequest=null,h(A),this.saveEventData(),this.processRequests(f)},Fc(ci(D,{method:"POST"}),L))}queueRequest(o,l){this.queue.push(o),this.processRequests(l)}}const he=new class extends ws{constructor(a){super("appUserTurnstile"),this._customAccessToken=a}postTurnstileEvent(a,o){wi.EVENTS_URL&&wi.ACCESS_TOKEN&&Array.isArray(a)&&a.some(l=>ka(l)||Iu(l))&&this.queueRequest(Date.now(),o)}processRequests(a){if(this.pendingRequest||0===this.queue.length)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const o=Md(wi.ACCESS_TOKEN),l=o?o.u:wi.ACCESS_TOKEN;let h=l!==this.eventData.tokenU;si(this.anonId)||(this.anonId=Ql(),h=!0);const f=this.queue.shift();if(this.eventData.lastSuccess){const v=new Date(this.eventData.lastSuccess),b=new Date(f),C=(f-this.eventData.lastSuccess)/864e5;h=h||C>=1||C<-1||v.getDate()!==b.getDate()}else h=!0;h?this.postEvent(f,{sdkIdentifier:"mapbox-gl-js",sdkVersion:Al,skuId:Il,"enabled.telemetry":!1,userId:this.anonId},v=>{v||(this.eventData.lastSuccess=f,this.eventData.tokenU=l)},a):this.processRequests()}},q=he.postTurnstileEvent.bind(he),K=new class extends ws{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(a,o,l,h){this.skuToken=o,this.errorCb=h,wi.EVENTS_URL&&(l||wi.ACCESS_TOKEN?this.queueRequest({id:a,timestamp:Date.now()},l):this.errorCb(new Error(Au)))}processRequests(a){if(this.pendingRequest||0===this.queue.length)return;const{id:o,timestamp:l}=this.queue.shift();o&&this.success[o]||(this.anonId||this.fetchEventData(),si(this.anonId)||(this.anonId=Ql()),this.postEvent(l,{sdkIdentifier:"mapbox-gl-js",sdkVersion:Al,skuId:Il,skuToken:this.skuToken,userId:this.anonId},h=>{h?this.errorCb(h):o&&(this.success[o]=!0)},a))}},ce=K.postMapLoadEvent.bind(K),ye=new class extends ws{constructor(){super("gljs.performance")}postPerformanceEvent(a,o){wi.EVENTS_URL&&(a||wi.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:o},a)}processRequests(a){if(this.pendingRequest||0===this.queue.length)return;const{timestamp:o,performanceData:l}=this.queue.shift(),h=function(f){const v=lt.performance.getEntriesByType("resource"),b=lt.performance.getEntriesByType("mark"),C=function(z){const j={};if(z)for(const $ in z)if("other"!==$)for(const Y of z[$]){const te=`${$}RequestCount`,me=`${$}ResolveRangeMin`,Ce=`${$}ResolveRangeMax`;j[me]=Math.min(j[me]||1/0,Y.startTime),j[Ce]=Math.max(j[Ce]||-1/0,Y.responseEnd),void 0===j[te]&&(j[te]=0),++j[te]}return j}(function(z,j){const $={};if(z)for(const Y of z){const te=j(Y);void 0===$[te]&&($[te]=[]),$[te].push(Y)}return $}(v,Gt)),D=lt.devicePixelRatio,A=lt.navigator.connection||lt.navigator.mozConnection||lt.navigator.webkitConnection,L={counters:[],metadata:[],attributes:[]},B=(z,j,$)=>{null!=$&&z.push({name:j,value:$.toString()})};for(const z in C)B(L.counters,z,C[z]);if(f.interactionRange[0]!==1/0&&f.interactionRange[1]!==-1/0&&(B(L.counters,"interactionRangeMin",f.interactionRange[0]),B(L.counters,"interactionRangeMax",f.interactionRange[1])),b)for(const z of Object.keys(ze)){const j=ze[z],$=b.find(Y=>Y.name===j);$&&B(L.counters,j,$.startTime)}return B(L.attributes,"style",function(z){if(z)for(const j of z){const $=j.name.split("?")[0];if(Mh($)){const Y=$.split("/").slice(-2);if(2===Y.length)return`mapbox://styles/${Y[0]}/${Y[1]}`}}}(v)),B(L.attributes,"terrainEnabled",f.terrainEnabled?"true":"false"),B(L.attributes,"fogEnabled",f.fogEnabled?"true":"false"),B(L.attributes,"projection",f.projection.name),B(L.attributes,"zoom",f.zoom),B(L.metadata,"devicePixelRatio",D),B(L.metadata,"connectionEffectiveType",A?A.effectiveType:void 0),B(L.metadata,"navigatorUserAgent",lt.navigator.userAgent),B(L.metadata,"screenWidth",lt.screen.width),B(L.metadata,"screenHeight",lt.screen.height),B(L.metadata,"windowWidth",lt.innerWidth),B(L.metadata,"windowHeight",lt.innerHeight),B(L.metadata,"mapWidth",f.width/D),B(L.metadata,"mapHeight",f.height/D),B(L.metadata,"webglRenderer",f.renderer),B(L.metadata,"webglVendor",f.vendor),B(L.metadata,"sdkVersion",Al),B(L.metadata,"sdkIdentifier","mapbox-gl-js"),L}(l);for(const f of h.metadata);for(const f of h.counters);for(const f of h.attributes);this.postEvent(o,h,()=>{},a)}},Re=ye.postPerformanceEvent.bind(ye),Ve=new class extends ws{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(a,o,l,h){if(!wi.API_URL||!wi.SESSION_PATH)return;const f=Io(wi.API_URL+wi.SESSION_PATH);f.params.push(`sku=${o||""}`),f.params.push(`access_token=${h||wi.ACCESS_TOKEN||""}`);const v={url:Bc(f),headers:{"Content-Type":"text/plain"}};var C;this.pendingRequest=(C=b=>{this.pendingRequest=null,l(b),this.saveEventData(),this.processRequests(h)},Fc(ci(v,{method:"GET"}),C))}getSessionAPI(a,o,l,h){this.skuToken=o,this.errorCb=h,wi.SESSION_PATH&&wi.API_URL&&(l||wi.ACCESS_TOKEN?this.queueRequest({id:a,timestamp:Date.now()},l):this.errorCb(new Error(Au)))}processRequests(a){if(this.pendingRequest||0===this.queue.length)return;const{id:o,timestamp:l}=this.queue.shift();o&&this.success[o]||this.getSession(l,this.skuToken,h=>{h?this.errorCb(h):o&&(this.success[o]=!0)},a)}},Be=Ve.getSessionAPI.bind(Ve),Le=new Set,ze={create:"create",load:"load",fullLoad:"fullLoad"},_t={mark(a){lt.performance.mark(a)},measure(a,o,l){lt.performance.measure(a,o,l)}};function Gt(a){const o=a.name.split("?")[0];return o.includes("mapbox-gl.js")?"javascript":o.includes("mapbox-gl.css")?"css":wi.API_FONTS_REGEX.test(o)?"fontRange":wd(o)?"sprite":Mh(o)?"style":wi.API_TILEJSON_REGEX.test(o)?"tilejson":"other"}const Dt=lt.performance;function Pn(a){const o=a?a.url.toString():void 0;return Dt.getEntriesByName(o)}let Sn,Mn,Vn,oi;const Ui={now:()=>void 0!==Vn?Vn:lt.performance.now(),setNow(a){Vn=a},restoreNow(){Vn=void 0},frame(a){const o=lt.requestAnimationFrame(a);return{cancel:()=>lt.cancelAnimationFrame(o)}},getImageData(a,o=0){const{width:l,height:h}=a;oi||(oi=lt.document.createElement("canvas"));const f=oi.getContext("2d");if(!f)throw new Error("failed to create canvas 2d context");return(l>oi.width||h>oi.height)&&(oi.width=l,oi.height=h),f.clearRect(-o,-o,l+2*o,h+2*o),f.drawImage(a,0,0,l,h),f.getImageData(-o,-o,l+2*o,h+2*o)},resolveURL:a=>(Sn||(Sn=lt.document.createElement("a")),Sn.href=a,Sn.href),get devicePixelRatio(){return lt.devicePixelRatio},get prefersReducedMotion(){return!!lt.matchMedia&&(null==Mn&&(Mn=lt.matchMedia("(prefers-reduced-motion: reduce)")),Mn.matches)}};function Fn(a,o,l){l[a]&&-1!==l[a].indexOf(o)||(l[a]=l[a]||[],l[a].push(o))}function or(a,o,l){if(l&&l[a]){const h=l[a].indexOf(o);-1!==h&&l[a].splice(h,1)}}class pr{constructor(o,l={}){ci(this,l),this.type=o}}class zc extends pr{constructor(o,l={}){super("error",ci({error:o},l))}}class ec{on(o,l){return this._listeners=this._listeners||{},Fn(o,l,this._listeners),this}off(o,l){return or(o,l,this._listeners),or(o,l,this._oneTimeListeners),this}once(o,l){return l?(this._oneTimeListeners=this._oneTimeListeners||{},Fn(o,l,this._oneTimeListeners),this):new Promise(h=>this.once(o,h))}fire(o,l){"string"==typeof o&&(o=new pr(o,l||{}));const h=o.type;if(this.listens(h)){o.target=this;const f=this._listeners&&this._listeners[h]?this._listeners[h].slice():[];for(const C of f)C.call(this,o);const v=this._oneTimeListeners&&this._oneTimeListeners[h]?this._oneTimeListeners[h].slice():[];for(const C of v)or(h,C,this._oneTimeListeners),C.call(this,o);const b=this._eventedParent;b&&(ci(o,"function"==typeof this._eventedParentData?this._eventedParentData():this._eventedParentData),b.fire(o))}else o instanceof zc&&console.error(o.error);return this}listens(o){return!!(this._listeners&&this._listeners[o]&&this._listeners[o].length>0||this._oneTimeListeners&&this._oneTimeListeners[o]&&this._oneTimeListeners[o].length>0||this._eventedParent&&this._eventedParent.listens(o))}setEventedParent(o,l){return this._eventedParent=o,this._eventedParentData=l,this}}var rt=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360,"units":"degrees"},"pitch":{"type":"number","default":0,"units":"degrees"},"light":{"type":"light"},"terrain":{"type":"terrain"},"fog":{"type":"fog"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":{},"mapbox":{}},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":{}}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":{}}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":{}}},"url":{"required":true,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"hillshade":{},"background":{},"sky":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sky"],"layout_background":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","private":true,"default":0,"minimum":0,"maximum":1,"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":{},"round":{},"square":{}},"default":"butt","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":{},"round":{},"miter":{}},"default":"miter","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"requires":[{"line-join":"miter"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"requires":[{"line-join":"round"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":{},"line":{},"line-center":{}},"default":"point","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"units":"pixels","requires":[{"symbol-placement":"line"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":{},"viewport-y":{},"source":{}},"default":"auto","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"units":"factor of the original icon size","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":{},"width":{},"height":{},"both":{}},"default":"none","requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"units":"pixels","requires":["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"requires":["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"units":"ems","requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":{},"left":{},"center":{},"right":{}},"default":"center","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","units":"ems","default":0,"requires":["text-field"],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["text-field",{"!":"text-variable-anchor"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"units":"degrees","requires":["text-field",{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":{},"vertical":{}},"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"requires":["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":{},"uppercase":{},"lowercase":{}},"default":"none","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","units":"ems","length":2,"default":[0,0],"requires":["text-field",{"!":"text-radial-offset"}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"requires":["text-field","icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},"in":{},"!in":{},"all":{},"any":{},"none":{},"has":{},"!has":{},"within":{}}},"geometry_type":{"type":"enum","values":{"Point":{},"LineString":{},"Polygon":{}}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":{},"exponential":{},"interval":{},"categorical":{}},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":{},"lab":{},"hcl":{}},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":{},"viewport":{}},"property-type":"data-constant","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":{},"equalEarth":{},"equirectangular":{},"lambertConformalConic":{},"mercator":{},"naturalEarth":{},"winkelTripel":{},"globe":{}},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"requires":["source"]}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"requires":[{"!":"fill-pattern"},{"fill-antialias":true}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-extrusion-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-extrusion-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"requires":["fill-extrusion-height"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","private":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"requires":["fill-extrusion-edge-radius"]}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"line-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["line-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"transition":true,"units":"line widths","requires":[{"!":"line-pattern"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{"type":"color","transition":false,"requires":[{"!":"line-pattern"},{"source":"geojson","has":{"lineMetrics":true}}],"expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"transition":false,"requires":[{"source":"geojson","has":{"lineMetrics":true}}],"property-type":"constant"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["circle-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"transition":false,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"transition":false,"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["icon-image","icon-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["text-field","text-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"units":"degrees","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":{},"nearest":{}},"default":"linear","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"transition":false,"units":"milliseconds","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"transition":false,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"background-pattern"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"cross-faded"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":{},"atmosphere":{}},"default":"atmosphere","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"requires":[{"sky-type":"atmosphere"}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","requires":[{"sky-type":"atmosphere"}],"default":10,"minimum":0,"maximum":100,"transition":false,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","requires":[{"sky-type":"gradient"}],"value":"number","default":[0,0],"length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","requires":[{"sky-type":"gradient"}],"default":90,"minimum":0,"maximum":180,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"transition":false,"requires":[{"sky-type":"gradient"}],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"transition":{"duration":{"type":"number","default":300,"minimum":0,"units":"milliseconds"},"delay":{"type":"number","default":0,"minimum":0,"units":"milliseconds"}},"property-type":{"data-driven":{"type":"property-type"},"cross-faded":{"type":"property-type"},"cross-faded-data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');function Ll(a,...o){for(const l of o)for(const h in l)a[h]=l[h];return a}function ps(a){return a instanceof Number||a instanceof String||a instanceof Boolean?a.valueOf():a}function Vc(a){if(Array.isArray(a))return a.map(Vc);if(a instanceof Object&&!(a instanceof Number||a instanceof String||a instanceof Boolean)){const o={};for(const l in a)o[l]=Vc(a[l]);return o}return ps(a)}class fs extends Error{constructor(o,l){super(l),this.message=l,this.key=o}}var so=fs;class Ru{constructor(o,l=[]){this.parent=o,this.bindings={};for(const[h,f]of l)this.bindings[h]=f}concat(o){return new Ru(this,o)}get(o){if(this.bindings[o])return this.bindings[o];if(this.parent)return this.parent.get(o);throw new Error(`${o} not found in scope.`)}has(o){return!!this.bindings[o]||!!this.parent&&this.parent.has(o)}}var Vp=Ru;const ar={kind:"null"},Zt={kind:"number"},vn={kind:"string"},_i={kind:"boolean"},Ol={kind:"color"},Ai={kind:"object"},Xt={kind:"value"},ku={kind:"collator"},Ch={kind:"formatted"},bt={kind:"resolvedImage"};function oo(a,o){return{kind:"array",itemType:a,N:o}}function bn(a){if("array"===a.kind){const o=bn(a.itemType);return"number"==typeof a.N?`array<${o}, ${a.N}>`:"value"===a.itemType.kind?"array":`array<${o}>`}return a.kind}const fr=[ar,Zt,vn,_i,Ol,Ch,Ai,oo(Xt),bt];function tl(a,o){if("error"===o.kind)return null;if("array"===a.kind){if("array"===o.kind&&(0===o.N&&"value"===o.itemType.kind||!tl(a.itemType,o.itemType))&&("number"!=typeof a.N||a.N===o.N))return null}else{if(a.kind===o.kind)return null;if("value"===a.kind)for(const l of fr)if(!tl(l,o))return null}return`Expected ${bn(a)} but found ${bn(o)} instead.`}function Cm(a,o){return o.some(l=>l.kind===a.kind)}function Zo(a,o){return o.some(l=>"null"===l?null===a:"array"===l?Array.isArray(a):"object"===l?a&&!Array.isArray(a)&&"object"==typeof a:l===typeof a)}var Cd,ao={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function Sm(a){return(a=Math.round(a))<0?0:a>255?255:a}function Sh(a){return Sm("%"===a[a.length-1]?parseFloat(a)/100*255:parseInt(a))}function Up(a){return(o="%"===a[a.length-1]?parseFloat(a)/100:parseFloat(a))<0?0:o>1?1:o;var o}function Po(a,o,l){return l<0?l+=1:l>1&&(l-=1),6*l<1?a+(o-a)*l*6:2*l<1?o:3*l<2?a+(o-a)*(2/3-l)*6:a}try{Cd={}.parseCSSColor=function(a){var o,l=a.replace(/ /g,"").toLowerCase();if(l in ao)return ao[l].slice();if("#"===l[0])return 4===l.length?(o=parseInt(l.substr(1),16))>=0&&o<=4095?[(3840&o)>>4|(3840&o)>>8,240&o|(240&o)>>4,15&o|(15&o)<<4,1]:null:7===l.length&&(o=parseInt(l.substr(1),16))>=0&&o<=16777215?[(16711680&o)>>16,(65280&o)>>8,255&o,1]:null;var h=l.indexOf("("),f=l.indexOf(")");if(-1!==h&&f+1===l.length){var v=l.substr(0,h),b=l.substr(h+1,f-(h+1)).split(","),C=1;switch(v){case"rgba":if(4!==b.length)return null;C=Up(b.pop());case"rgb":return 3!==b.length?null:[Sh(b[0]),Sh(b[1]),Sh(b[2]),C];case"hsla":if(4!==b.length)return null;C=Up(b.pop());case"hsl":if(3!==b.length)return null;var D=(parseFloat(b[0])%360+360)%360/360,A=Up(b[1]),L=Up(b[2]),B=L<=.5?L*(A+1):L+A-L*A,z=2*L-B;return[Sm(255*Po(z,B,D+1/3)),Sm(255*Po(z,B,D)),Sm(255*Po(z,B,D-1/3)),C];default:return null}}return null}}catch{}class Ro{constructor(o,l,h,f=1){this.r=o,this.g=l,this.b=h,this.a=f}static parse(o){if(!o)return;if(o instanceof Ro)return o;if("string"!=typeof o)return;const l=Cd(o);return l?new Ro(l[0]/255*l[3],l[1]/255*l[3],l[2]/255*l[3],l[3]):void 0}toString(){const[o,l,h,f]=this.toArray();return`rgba(${Math.round(o)},${Math.round(l)},${Math.round(h)},${f})`}toArray(){const{r:o,g:l,b:h,a:f}=this;return 0===f?[0,0,0,0]:[255*o/f,255*l/f,255*h/f,f]}toArray01(){const{r:o,g:l,b:h,a:f}=this;return 0===f?[0,0,0,0]:[o/f,l/f,h/f,f]}toArray01PremultipliedAlpha(){const{r:o,g:l,b:h,a:f}=this;return[o,l,h,f]}}Ro.black=new Ro(0,0,0,1),Ro.white=new Ro(1,1,1,1),Ro.transparent=new Ro(0,0,0,0),Ro.red=new Ro(1,0,0,1),Ro.blue=new Ro(0,0,1,1);var ms=Ro;class b_{constructor(o,l,h){this.sensitivity=o?l?"variant":"case":l?"accent":"base",this.locale=h,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(o,l){return this.collator.compare(o,l)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class w_{constructor(o,l,h,f,v){this.text=o.normalize?o.normalize():o,this.image=l,this.scale=h,this.fontStack=f,this.textColor=v}}class ko{constructor(o){this.sections=o}static fromString(o){return new ko([new w_(o,null,null,null,null)])}isEmpty(){return 0===this.sections.length||!this.sections.some(o=>0!==o.text.length||o.image&&0!==o.image.name.length)}static factory(o){return o instanceof ko?o:ko.fromString(o)}toString(){return 0===this.sections.length?"":this.sections.map(o=>o.text).join("")}serialize(){const o=["format"];for(const l of this.sections){if(l.image){o.push(["image",l.image.name]);continue}o.push(l.text);const h={};l.fontStack&&(h["text-font"]=["literal",l.fontStack.split(",")]),l.scale&&(h["font-scale"]=l.scale),l.textColor&&(h["text-color"]=["rgba"].concat(l.textColor.toArray())),o.push(h)}return o}}class da{constructor(o){this.name=o.name,this.available=o.available}toString(){return this.name}static fromString(o){return o?new da({name:o,available:!1}):null}serialize(){return["image",this.name]}}function M_(a,o,l,h){return"number"==typeof a&&a>=0&&a<=255&&"number"==typeof o&&o>=0&&o<=255&&"number"==typeof l&&l>=0&&l<=255?void 0===h||"number"==typeof h&&h>=0&&h<=1?null:`Invalid rgba value [${[a,o,l,h].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${("number"==typeof h?[a,o,l,h]:[a,o,l]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Sd(a){if(null===a||"string"==typeof a||"boolean"==typeof a||"number"==typeof a||a instanceof ms||a instanceof b_||a instanceof ko||a instanceof da)return!0;if(Array.isArray(a)){for(const o of a)if(!Sd(o))return!1;return!0}if("object"==typeof a){for(const o in a)if(!Sd(a[o]))return!1;return!0}return!1}function lr(a){if(null===a)return ar;if("string"==typeof a)return vn;if("boolean"==typeof a)return _i;if("number"==typeof a)return Zt;if(a instanceof ms)return Ol;if(a instanceof b_)return ku;if(a instanceof ko)return Ch;if(a instanceof da)return bt;if(Array.isArray(a)){const o=a.length;let l;for(const h of a){const f=lr(h);if(l){if(l===f)continue;l=Xt;break}l=f}return oo(l||Xt,o)}return Ai}function Zi(a){const o=typeof a;return null===a?"":"string"===o||"number"===o||"boolean"===o?String(a):a instanceof ms||a instanceof ko||a instanceof da?a.toString():JSON.stringify(a)}class C_{constructor(o,l){this.type=o,this.value=l}static parse(o,l){if(2!==o.length)return l.error(`'literal' expression requires exactly one argument, but found ${o.length-1} instead.`);if(!Sd(o[1]))return l.error("invalid value");const h=o[1];let f=lr(h);const v=l.expectedType;return"array"!==f.kind||0!==f.N||!v||"array"!==v.kind||"number"==typeof v.N&&0!==v.N||(f=v),new C_(f,h)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return"array"===this.type.kind||"object"===this.type.kind?["literal",this.value]:this.value instanceof ms?["rgba"].concat(this.value.toArray()):this.value instanceof ko?this.value.serialize():this.value}}var Hp=C_,lo=class{constructor(a){this.name="ExpressionEvaluationError",this.message=a}toJSON(){return this.message}};const Yt={string:vn,number:Zt,boolean:_i,object:Ai};class S_{constructor(o,l){this.type=o,this.args=l}static parse(o,l){if(o.length<2)return l.error("Expected at least one argument.");let h,f=1;const v=o[0];if("array"===v){let C,D;if(o.length>2){const A=o[1];if("string"!=typeof A||!(A in Yt)||"object"===A)return l.error('The item type argument of "array" must be one of string, number, boolean',1);C=Yt[A],f++}else C=Xt;if(o.length>3){if(null!==o[2]&&("number"!=typeof o[2]||o[2]<0||o[2]!==Math.floor(o[2])))return l.error('The length argument to "array" must be a positive integer literal',2);D=o[2],f++}h=oo(C,D)}else h=Yt[v];const b=[];for(;f<o.length;f++){const C=l.parse(o[f],f,Xt);if(!C)return null;b.push(C)}return new S_(h,b)}evaluate(o){for(let l=0;l<this.args.length;l++){const h=this.args[l].evaluate(o);if(!tl(this.type,lr(h)))return h;if(l===this.args.length-1)throw new lo(`Expected value to be of type ${bn(this.type)}, but found ${bn(lr(h))} instead.`)}return null}eachChild(o){this.args.forEach(o)}outputDefined(){return this.args.every(o=>o.outputDefined())}serialize(){const o=this.type,l=[o.kind];if("array"===o.kind){const h=o.itemType;if("string"===h.kind||"number"===h.kind||"boolean"===h.kind){l.push(h.kind);const f=o.N;("number"==typeof f||this.args.length>1)&&l.push(f)}}return l.concat(this.args.map(h=>h.serialize()))}}var Bn=S_;class nl{constructor(o){this.type=Ch,this.sections=o}static parse(o,l){if(o.length<2)return l.error("Expected at least one argument.");const h=o[1];if(!Array.isArray(h)&&"object"==typeof h)return l.error("First argument must be an image or text section.");const f=[];let v=!1;for(let b=1;b<=o.length-1;++b){const C=o[b];if(v&&"object"==typeof C&&!Array.isArray(C)){v=!1;let D=null;if(C["font-scale"]&&(D=l.parse(C["font-scale"],1,Zt),!D))return null;let A=null;if(C["text-font"]&&(A=l.parse(C["text-font"],1,oo(vn)),!A))return null;let L=null;if(C["text-color"]&&(L=l.parse(C["text-color"],1,Ol),!L))return null;const B=f[f.length-1];B.scale=D,B.font=A,B.textColor=L}else{const D=l.parse(o[b],1,Xt);if(!D)return null;const A=D.type.kind;if("string"!==A&&"value"!==A&&"null"!==A&&"resolvedImage"!==A)return l.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");v=!0,f.push({content:D,scale:null,font:null,textColor:null})}}return new nl(f)}evaluate(o){return new ko(this.sections.map(l=>{const h=l.content.evaluate(o);return lr(h)===bt?new w_("",h,null,null,null):new w_(Zi(h),null,l.scale?l.scale.evaluate(o):null,l.font?l.font.evaluate(o).join(","):null,l.textColor?l.textColor.evaluate(o):null)}))}eachChild(o){for(const l of this.sections)o(l.content),l.scale&&o(l.scale),l.font&&o(l.font),l.textColor&&o(l.textColor)}outputDefined(){return!1}serialize(){const o=["format"];for(const l of this.sections){o.push(l.content.serialize());const h={};l.scale&&(h["font-scale"]=l.scale.serialize()),l.font&&(h["text-font"]=l.font.serialize()),l.textColor&&(h["text-color"]=l.textColor.serialize()),o.push(h)}return o}}class Gp{constructor(o){this.type=bt,this.input=o}static parse(o,l){if(2!==o.length)return l.error("Expected two arguments.");const h=l.parse(o[1],1,vn);return h?new Gp(h):l.error("No image name provided.")}evaluate(o){const l=this.input.evaluate(o),h=da.fromString(l);return h&&o.availableImages&&(h.available=o.availableImages.indexOf(l)>-1),h}eachChild(o){o(this.input)}outputDefined(){return!1}serialize(){return["image",this.input.serialize()]}}const E_={"to-boolean":_i,"to-color":Ol,"to-number":Zt,"to-string":vn};class Em{constructor(o,l){this.type=o,this.args=l}static parse(o,l){if(o.length<2)return l.error("Expected at least one argument.");const h=o[0];if(("to-boolean"===h||"to-string"===h)&&2!==o.length)return l.error("Expected one argument.");const f=E_[h],v=[];for(let b=1;b<o.length;b++){const C=l.parse(o[b],b,Xt);if(!C)return null;v.push(C)}return new Em(f,v)}evaluate(o){if("boolean"===this.type.kind)return Boolean(this.args[0].evaluate(o));if("color"===this.type.kind){let l,h;for(const f of this.args){if(l=f.evaluate(o),h=null,l instanceof ms)return l;if("string"==typeof l){const v=o.parseColor(l);if(v)return v}else if(Array.isArray(l)&&(h=l.length<3||l.length>4?`Invalid rbga value ${JSON.stringify(l)}: expected an array containing either three or four numeric values.`:M_(l[0],l[1],l[2],l[3]),!h))return new ms(l[0]/255,l[1]/255,l[2]/255,l[3])}throw new lo(h||`Could not parse color from value '${"string"==typeof l?l:String(JSON.stringify(l))}'`)}if("number"===this.type.kind){let l=null;for(const h of this.args){if(l=h.evaluate(o),null===l)return 0;const f=Number(l);if(!isNaN(f))return f}throw new lo(`Could not convert ${JSON.stringify(l)} to number.`)}return"formatted"===this.type.kind?ko.fromString(Zi(this.args[0].evaluate(o))):"resolvedImage"===this.type.kind?da.fromString(Zi(this.args[0].evaluate(o))):Zi(this.args[0].evaluate(o))}eachChild(o){this.args.forEach(o)}outputDefined(){return this.args.every(o=>o.outputDefined())}serialize(){if("formatted"===this.type.kind)return new nl([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if("resolvedImage"===this.type.kind)return new Gp(this.args[0]).serialize();const o=[`to-${this.type.kind}`];return this.eachChild(l=>{o.push(l.serialize())}),o}}var Ed=Em;const T_=["Unknown","Point","LineString","Polygon"];var Eh=class{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null}id(){return this.feature&&void 0!==this.feature.id?this.feature.id:null}geometryType(){return this.feature?"number"==typeof this.feature.type?T_[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const a=this.featureDistanceData.center,o=this.featureDistanceData.scale,{x:l,y:h}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(l*o-a[0])+this.featureDistanceData.bearing[1]*(h*o-a[1])}return 0}parseColor(a){let o=this._parseColorCache[a];return o||(o=this._parseColorCache[a]=ms.parse(a)),o}};class tc{constructor(o,l,h,f){this.name=o,this.type=l,this._evaluate=h,this.args=f}evaluate(o){return this._evaluate(o,this.args)}eachChild(o){this.args.forEach(o)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(o=>o.serialize()))}static parse(o,l){const h=o[0],f=tc.definitions[h];if(!f)return l.error(`Unknown expression "${h}". If you wanted a literal array, use ["literal", [...]].`,0);const v=Array.isArray(f)?f[0]:f.type,b=Array.isArray(f)?[[f[1],f[2]]]:f.overloads,C=b.filter(([A])=>!Array.isArray(A)||A.length===o.length-1);let D=null;for(const[A,L]of C){D=new Am(l.registry,l.path,null,l.scope);const B=[];let z=!1;for(let j=1;j<o.length;j++){const $=o[j],Y=Array.isArray(A)?A[j-1]:A.type,te=D.parse($,1+B.length,Y);if(!te){z=!0;break}B.push(te)}if(!z)if(Array.isArray(A)&&A.length!==B.length)D.error(`Expected ${A.length} arguments, but found ${B.length} instead.`);else{for(let j=0;j<B.length;j++){const $=Array.isArray(A)?A[j]:A.type,Y=B[j];D.concat(j+1).checkSubtype($,Y.type)}if(0===D.errors.length)return new tc(h,v,L,B)}}if(1===C.length)l.errors.push(...D.errors);else{const A=(C.length?C:b).map(([B])=>{return z=B,Array.isArray(z)?`(${z.map(bn).join(", ")})`:`(${bn(z.type)}...)`;var z}).join(" | "),L=[];for(let B=1;B<o.length;B++){const z=l.parse(o[B],1+L.length);if(!z)return null;L.push(bn(z.type))}l.error(`Expected arguments of type ${A}, but found (${L.join(", ")}) instead.`)}return null}static register(o,l){tc.definitions=l;for(const h in l)o[h]=tc}}var La=tc;class jp{constructor(o,l,h){this.type=ku,this.locale=h,this.caseSensitive=o,this.diacriticSensitive=l}static parse(o,l){if(2!==o.length)return l.error("Expected one argument.");const h=o[1];if("object"!=typeof h||Array.isArray(h))return l.error("Collator options argument must be an object.");const f=l.parse(void 0!==h["case-sensitive"]&&h["case-sensitive"],1,_i);if(!f)return null;const v=l.parse(void 0!==h["diacritic-sensitive"]&&h["diacritic-sensitive"],1,_i);if(!v)return null;let b=null;return h.locale&&(b=l.parse(h.locale,1,vn),!b)?null:new jp(f,v,b)}evaluate(o){return new b_(this.caseSensitive.evaluate(o),this.diacriticSensitive.evaluate(o),this.locale?this.locale.evaluate(o):null)}eachChild(o){o(this.caseSensitive),o(this.diacriticSensitive),this.locale&&o(this.locale)}outputDefined(){return!1}serialize(){const o={};return o["case-sensitive"]=this.caseSensitive.serialize(),o["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(o.locale=this.locale.serialize()),["collator",o]}}const Hn=8192;function Th(a,o){a[0]=Math.min(a[0],o[0]),a[1]=Math.min(a[1],o[1]),a[2]=Math.max(a[2],o[0]),a[3]=Math.max(a[3],o[1])}function $p(a,o){return!(a[0]<=o[0]||a[2]>=o[2]||a[1]<=o[1]||a[3]>=o[3])}function gs(a,o){const l=(180+a[0])/360,h=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+a[1]*Math.PI/360)))/360,f=Math.pow(2,o.z);return[Math.round(l*f*Hn),Math.round(h*f*Hn)]}function Tm(a,o,l){const h=a[0]-o[0],f=a[1]-o[1],v=a[0]-l[0],b=a[1]-l[1];return h*b-v*f==0&&h*v<=0&&f*b<=0}function Dm(a,o){let l=!1;for(let b=0,C=o.length;b<C;b++){const D=o[b];for(let A=0,L=D.length;A<L-1;A++){if(Tm(a,D[A],D[A+1]))return!1;(f=D[A])[1]>(h=a)[1]!=(v=D[A+1])[1]>h[1]&&h[0]<(v[0]-f[0])*(h[1]-f[1])/(v[1]-f[1])+f[0]&&(l=!l)}}var h,f,v;return l}function nc(a,o){for(let l=0;l<o.length;l++)if(Dm(a,o[l]))return!0;return!1}function ha(a,o,l,h){const f=h[0]-l[0],v=h[1]-l[1],b=(a[0]-l[0])*v-f*(a[1]-l[1]),C=(o[0]-l[0])*v-f*(o[1]-l[1]);return b>0&&C<0||b<0&&C>0}function S0(a,o,l){for(const A of l)for(let L=0;L<A.length-1;++L)if((C=[(b=A[L+1])[0]-(v=A[L])[0],b[1]-v[1]])[0]*(D=[(f=o)[0]-(h=a)[0],f[1]-h[1]])[1]-C[1]*D[0]!=0&&ha(h,f,v,b)&&ha(v,b,h,f))return!0;var h,f,v,b,C,D;return!1}function D_(a,o){for(let l=0;l<a.length;++l)if(!Dm(a[l],o))return!1;for(let l=0;l<a.length-1;++l)if(S0(a[l],a[l+1],o))return!1;return!0}function pa(a,o){for(let l=0;l<o.length;l++)if(D_(a,o[l]))return!0;return!1}function cr(a,o,l){const h=[];for(let f=0;f<a.length;f++){const v=[];for(let b=0;b<a[f].length;b++){const C=gs(a[f][b],l);Th(o,C),v.push(C)}h.push(v)}return h}function A_(a,o,l){const h=[];for(let f=0;f<a.length;f++){const v=cr(a[f],o,l);h.push(v)}return h}function I_(a,o,l,h){if(a[0]<l[0]||a[0]>l[2]){const f=.5*h;let v=a[0]-l[0]>f?-h:l[0]-a[0]>f?h:0;0===v&&(v=a[0]-l[2]>f?-h:l[2]-a[0]>f?h:0),a[0]+=v}Th(o,a)}function ic(a,o,l,h){const f=Math.pow(2,h.z)*Hn,v=[h.x*Hn,h.y*Hn],b=[];if(!a)return b;for(const C of a)for(const D of C){const A=[D.x+v[0],D.y+v[1]];I_(A,o,l,f),b.push(A)}return b}function er(a,o,l,h){const f=Math.pow(2,h.z)*Hn,v=[h.x*Hn,h.y*Hn],b=[];if(!a)return b;for(const D of a){const A=[];for(const L of D){const B=[L.x+v[0],L.y+v[1]];Th(o,B),A.push(B)}b.push(A)}if(o[2]-o[0]<=f/2){(C=o)[0]=C[1]=1/0,C[2]=C[3]=-1/0;for(const D of b)for(const A of D)I_(A,o,l,f)}var C;return b}class fa{constructor(o,l){this.type=_i,this.geojson=o,this.geometries=l}static parse(o,l){if(2!==o.length)return l.error(`'within' expression requires exactly one argument, but found ${o.length-1} instead.`);if(Sd(o[1])){const h=o[1];if("FeatureCollection"===h.type)for(let f=0;f<h.features.length;++f){const v=h.features[f].geometry.type;if("Polygon"===v||"MultiPolygon"===v)return new fa(h,h.features[f].geometry)}else if("Feature"===h.type){const f=h.geometry.type;if("Polygon"===f||"MultiPolygon"===f)return new fa(h,h.geometry)}else if("Polygon"===h.type||"MultiPolygon"===h.type)return new fa(h,h)}return l.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(o){if(null!=o.geometry()&&null!=o.canonicalID()){if("Point"===o.geometryType())return function(l,h){const f=[1/0,1/0,-1/0,-1/0],v=[1/0,1/0,-1/0,-1/0],b=l.canonicalID();if(!b)return!1;if("Polygon"===h.type){const C=cr(h.coordinates,v,b),D=ic(l.geometry(),f,v,b);if(!$p(f,v))return!1;for(const A of D)if(!Dm(A,C))return!1}if("MultiPolygon"===h.type){const C=A_(h.coordinates,v,b),D=ic(l.geometry(),f,v,b);if(!$p(f,v))return!1;for(const A of D)if(!nc(A,C))return!1}return!0}(o,this.geometries);if("LineString"===o.geometryType())return function(l,h){const f=[1/0,1/0,-1/0,-1/0],v=[1/0,1/0,-1/0,-1/0],b=l.canonicalID();if(!b)return!1;if("Polygon"===h.type){const C=cr(h.coordinates,v,b),D=er(l.geometry(),f,v,b);if(!$p(f,v))return!1;for(const A of D)if(!D_(A,C))return!1}if("MultiPolygon"===h.type){const C=A_(h.coordinates,v,b),D=er(l.geometry(),f,v,b);if(!$p(f,v))return!1;for(const A of D)if(!pa(A,C))return!1}return!0}(o,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}var Li=fa;function Lu(a){if(a instanceof La&&("get"===a.name&&1===a.args.length||"feature-state"===a.name||"has"===a.name&&1===a.args.length||"properties"===a.name||"geometry-type"===a.name||"id"===a.name||/^filter-/.test(a.name))||a instanceof Li)return!1;let o=!0;return a.eachChild(l=>{o&&!Lu(l)&&(o=!1)}),o}function Dh(a){if(a instanceof La&&"feature-state"===a.name)return!1;let o=!0;return a.eachChild(l=>{o&&!Dh(l)&&(o=!1)}),o}function Oa(a,o){if(a instanceof La&&o.indexOf(a.name)>=0)return!1;let l=!0;return a.eachChild(h=>{l&&!Oa(h,o)&&(l=!1)}),l}class Uc{constructor(o,l){this.type=l.type,this.name=o,this.boundExpression=l}static parse(o,l){if(2!==o.length||"string"!=typeof o[1])return l.error("'var' expression requires exactly one string literal argument.");const h=o[1];return l.scope.has(h)?new Uc(h,l.scope.get(h)):l.error(`Unknown variable "${h}". Make sure "${h}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(o){return this.boundExpression.evaluate(o)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}var P_=Uc;class Qn{constructor(o,l=[],h,f=new Vp,v=[]){this.registry=o,this.path=l,this.key=l.map(b=>`[${b}]`).join(""),this.scope=f,this.errors=v,this.expectedType=h}parse(o,l,h,f,v={}){return l?this.concat(l,h,f)._parse(o,v):this._parse(o,v)}_parse(o,l){function h(f,v,b){return"assert"===b?new Bn(v,[f]):"coerce"===b?new Ed(v,[f]):f}if(null!==o&&"string"!=typeof o&&"boolean"!=typeof o&&"number"!=typeof o||(o=["literal",o]),Array.isArray(o)){if(0===o.length)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const f=o[0];if("string"!=typeof f)return this.error(`Expression name must be a string, but found ${typeof f} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const v=this.registry[f];if(v){let b=v.parse(o,this);if(!b)return null;if(this.expectedType){const C=this.expectedType,D=b.type;if("string"!==C.kind&&"number"!==C.kind&&"boolean"!==C.kind&&"object"!==C.kind&&"array"!==C.kind||"value"!==D.kind)if("color"!==C.kind&&"formatted"!==C.kind&&"resolvedImage"!==C.kind||"value"!==D.kind&&"string"!==D.kind){if(this.checkSubtype(C,D))return null}else b=h(b,C,l.typeAnnotation||"coerce");else b=h(b,C,l.typeAnnotation||"assert")}if(!(b instanceof Hp)&&"resolvedImage"!==b.type.kind&&Ah(b)){const C=new Eh;try{b=new Hp(b.type,b.evaluate(C))}catch(D){return this.error(D.message),null}}return b}return this.error(`Unknown expression "${f}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(void 0===o?"'undefined' value invalid. Use null instead.":"object"==typeof o?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof o} instead.`)}concat(o,l,h){const f="number"==typeof o?this.path.concat(o):this.path,v=h?this.scope.concat(h):this.scope;return new Qn(this.registry,f,l||null,v,this.errors)}error(o,...l){const h=`${this.key}${l.map(f=>`[${f}]`).join("")}`;this.errors.push(new so(h,o))}checkSubtype(o,l){const h=tl(o,l);return h&&this.error(h),h}}var Am=Qn;function Ah(a){if(a instanceof P_)return Ah(a.boundExpression);if(a instanceof La&&"error"===a.name||a instanceof jp||a instanceof Li)return!1;const o=a instanceof Ed||a instanceof Bn;let l=!0;return a.eachChild(h=>{l=o?l&&Ah(h):l&&h instanceof Hp}),!!l&&Lu(a)&&Oa(a,["zoom","heatmap-density","line-progress","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center"])}function Td(a,o){const l=a.length-1;let h,f,v=0,b=l,C=0;for(;v<=b;)if(C=Math.floor((v+b)/2),h=a[C],f=a[C+1],h<=o){if(C===l||o<f)return C;v=C+1}else{if(!(h>o))throw new lo("Input is not a number.");b=C-1}return 0}class Gn{constructor(o,l,h){this.type=o,this.input=l,this.labels=[],this.outputs=[];for(const[f,v]of h)this.labels.push(f),this.outputs.push(v)}static parse(o,l){if(o.length-1<4)return l.error(`Expected at least 4 arguments, but found only ${o.length-1}.`);if((o.length-1)%2!=0)return l.error("Expected an even number of arguments.");const h=l.parse(o[1],1,Zt);if(!h)return null;const f=[];let v=null;l.expectedType&&"value"!==l.expectedType.kind&&(v=l.expectedType);for(let b=1;b<o.length;b+=2){const C=1===b?-1/0:o[b],D=o[b+1],A=b,L=b+1;if("number"!=typeof C)return l.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',A);if(f.length&&f[f.length-1][0]>=C)return l.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',A);const B=l.parse(D,L,v);if(!B)return null;v=v||B.type,f.push([C,B])}return new Gn(v,h,f)}evaluate(o){const l=this.labels,h=this.outputs;if(1===l.length)return h[0].evaluate(o);const f=this.input.evaluate(o);if(f<=l[0])return h[0].evaluate(o);const v=l.length;return f>=l[v-1]?h[v-1].evaluate(o):h[Td(l,f)].evaluate(o)}eachChild(o){o(this.input);for(const l of this.outputs)o(l)}outputDefined(){return this.outputs.every(o=>o.outputDefined())}serialize(){const o=["step",this.input.serialize()];for(let l=0;l<this.labels.length;l++)l>0&&o.push(this.labels[l]),o.push(this.outputs[l].serialize());return o}}var Dd=Gn;function Oi(a,o,l){return a*(1-l)+o*l}var an=Object.freeze({__proto__:null,number:Oi,color:function(a,o,l){return new ms(Oi(a.r,o.r,l),Oi(a.g,o.g,l),Oi(a.b,o.b,l),Oi(a.a,o.a,l))},array:function(a,o,l){return a.map((h,f)=>Oi(h,o[f],l))}});const uo=4/29,Bs=6/29,Ou=3*Bs*Bs,Xo=Math.PI/180,ma=180/Math.PI;function hn(a){return a>.008856451679035631?Math.pow(a,1/3):a/Ou+uo}function yi(a){return a>Bs?a*a*a:Ou*(a-uo)}function Ur(a){return 255*(a<=.0031308?12.92*a:1.055*Math.pow(a,1/2.4)-.055)}function ho(a){return(a/=255)<=.04045?a/12.92:Math.pow((a+.055)/1.055,2.4)}function rc(a){const o=ho(a.r),l=ho(a.g),h=ho(a.b),f=hn((.4124564*o+.3575761*l+.1804375*h)/.95047),v=hn((.2126729*o+.7151522*l+.072175*h)/1);return{l:116*v-16,a:500*(f-v),b:200*(v-hn((.0193339*o+.119192*l+.9503041*h)/1.08883)),alpha:a.a}}function Ts(a){let o=(a.l+16)/116,l=isNaN(a.a)?o:o+a.a/500,h=isNaN(a.b)?o:o-a.b/200;return o=1*yi(o),l=.95047*yi(l),h=1.08883*yi(h),new ms(Ur(3.2404542*l-1.5371385*o-.4985314*h),Ur(-.969266*l+1.8760108*o+.041556*h),Ur(.0556434*l-.2040259*o+1.0572252*h),a.alpha)}function Fu(a,o,l){const h=o-a;return a+l*(h>180||h<-180?h-360*Math.round(h/360):h)}const Hr={forward:rc,reverse:Ts,interpolate:function(a,o,l){return{l:Oi(a.l,o.l,l),a:Oi(a.a,o.a,l),b:Oi(a.b,o.b,l),alpha:Oi(a.alpha,o.alpha,l)}}},sc={forward:function(a){const{l:o,a:l,b:h}=rc(a),f=Math.atan2(h,l)*ma;return{h:f<0?f+360:f,c:Math.sqrt(l*l+h*h),l:o,alpha:a.a}},reverse:function(a){const o=a.h*Xo,l=a.c;return Ts({l:a.l,a:Math.cos(o)*l,b:Math.sin(o)*l,alpha:a.alpha})},interpolate:function(a,o,l){return{h:Fu(a.h,o.h,l),c:Oi(a.c,o.c,l),l:Oi(a.l,o.l,l),alpha:Oi(a.alpha,o.alpha,l)}}};var Ad=Object.freeze({__proto__:null,lab:Hr,hcl:sc});class Mi{constructor(o,l,h,f,v){this.type=o,this.operator=l,this.interpolation=h,this.input=f,this.labels=[],this.outputs=[];for(const[b,C]of v)this.labels.push(b),this.outputs.push(C)}static interpolationFactor(o,l,h,f){let v=0;if("exponential"===o.name)v=Nu(l,o.base,h,f);else if("linear"===o.name)v=Nu(l,1,h,f);else if("cubic-bezier"===o.name){const b=o.controlPoints;v=new Pc(b[0],b[1],b[2],b[3]).solve(Nu(l,1,h,f))}return v}static parse(o,l){let[h,f,v,...b]=o;if(!Array.isArray(f)||0===f.length)return l.error("Expected an interpolation type expression.",1);if("linear"===f[0])f={name:"linear"};else if("exponential"===f[0]){const A=f[1];if("number"!=typeof A)return l.error("Exponential interpolation requires a numeric base.",1,1);f={name:"exponential",base:A}}else{if("cubic-bezier"!==f[0])return l.error(`Unknown interpolation type ${String(f[0])}`,1,0);{const A=f.slice(1);if(4!==A.length||A.some(L=>"number"!=typeof L||L<0||L>1))return l.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);f={name:"cubic-bezier",controlPoints:A}}}if(o.length-1<4)return l.error(`Expected at least 4 arguments, but found only ${o.length-1}.`);if((o.length-1)%2!=0)return l.error("Expected an even number of arguments.");if(v=l.parse(v,2,Zt),!v)return null;const C=[];let D=null;"interpolate-hcl"===h||"interpolate-lab"===h?D=Ol:l.expectedType&&"value"!==l.expectedType.kind&&(D=l.expectedType);for(let A=0;A<b.length;A+=2){const L=b[A],B=b[A+1],z=A+3,j=A+4;if("number"!=typeof L)return l.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',z);if(C.length&&C[C.length-1][0]>=L)return l.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',z);const $=l.parse(B,j,D);if(!$)return null;D=D||$.type,C.push([L,$])}return"number"===D.kind||"color"===D.kind||"array"===D.kind&&"number"===D.itemType.kind&&"number"==typeof D.N?new Mi(D,h,f,v,C):l.error(`Type ${bn(D)} is not interpolatable.`)}evaluate(o){const l=this.labels,h=this.outputs;if(1===l.length)return h[0].evaluate(o);const f=this.input.evaluate(o);if(f<=l[0])return h[0].evaluate(o);const v=l.length;if(f>=l[v-1])return h[v-1].evaluate(o);const b=Td(l,f),C=Mi.interpolationFactor(this.interpolation,f,l[b],l[b+1]),D=h[b].evaluate(o),A=h[b+1].evaluate(o);return"interpolate"===this.operator?an[this.type.kind.toLowerCase()](D,A,C):"interpolate-hcl"===this.operator?sc.reverse(sc.interpolate(sc.forward(D),sc.forward(A),C)):Hr.reverse(Hr.interpolate(Hr.forward(D),Hr.forward(A),C))}eachChild(o){o(this.input);for(const l of this.outputs)o(l)}outputDefined(){return this.outputs.every(o=>o.outputDefined())}serialize(){let o;o="linear"===this.interpolation.name?["linear"]:"exponential"===this.interpolation.name?1===this.interpolation.base?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const l=[this.operator,o,this.input.serialize()];for(let h=0;h<this.labels.length;h++)l.push(this.labels[h],this.outputs[h].serialize());return l}}function Nu(a,o,l,h){const f=h-l,v=a-l;return 0===f?0:1===o?v/f:(Math.pow(o,v)-1)/(Math.pow(o,f)-1)}var Lo=Mi;class Ih{constructor(o,l){this.type=o,this.args=l}static parse(o,l){if(o.length<2)return l.error("Expectected at least one argument.");let h=null;const f=l.expectedType;f&&"value"!==f.kind&&(h=f);const v=[];for(const C of o.slice(1)){const D=l.parse(C,1+v.length,h,void 0,{typeAnnotation:"omit"});if(!D)return null;h=h||D.type,v.push(D)}const b=f&&v.some(C=>tl(f,C.type));return new Ih(b?Xt:h,v)}evaluate(o){let l,h=null,f=0;for(const v of this.args){if(f++,h=v.evaluate(o),h&&h instanceof da&&!h.available&&(l||(l=h),h=null,f===this.args.length))return l;if(null!==h)break}return h}eachChild(o){this.args.forEach(o)}outputDefined(){return this.args.every(o=>o.outputDefined())}serialize(){const o=["coalesce"];return this.eachChild(l=>{o.push(l.serialize())}),o}}var Hc=Ih;class zs{constructor(o,l){this.type=l.type,this.bindings=[].concat(o),this.result=l}evaluate(o){return this.result.evaluate(o)}eachChild(o){for(const l of this.bindings)o(l[1]);o(this.result)}static parse(o,l){if(o.length<4)return l.error(`Expected at least 3 arguments, but found ${o.length-1} instead.`);const h=[];for(let v=1;v<o.length-1;v+=2){const b=o[v];if("string"!=typeof b)return l.error(`Expected string, but found ${typeof b} instead.`,v);if(/[^a-zA-Z0-9_]/.test(b))return l.error("Variable names must contain only alphanumeric characters or '_'.",v);const C=l.parse(o[v+1],v+1);if(!C)return null;h.push([b,C])}const f=l.parse(o[o.length-1],o.length-1,l.expectedType,h);return f?new zs(h,f):null}outputDefined(){return this.result.outputDefined()}serialize(){const o=["let"];for(const[l,h]of this.bindings)o.push(l,h.serialize());return o.push(this.result.serialize()),o}}var Bu=zs;class oc{constructor(o,l,h){this.type=o,this.index=l,this.input=h}static parse(o,l){if(3!==o.length)return l.error(`Expected 2 arguments, but found ${o.length-1} instead.`);const h=l.parse(o[1],1,Zt),f=l.parse(o[2],2,oo(l.expectedType||Xt));return h&&f?new oc(f.type.itemType,h,f):null}evaluate(o){const l=this.index.evaluate(o),h=this.input.evaluate(o);if(l<0)throw new lo(`Array index out of bounds: ${l} < 0.`);if(l>=h.length)throw new lo(`Array index out of bounds: ${l} > ${h.length-1}.`);if(l!==Math.floor(l))throw new lo(`Array index must be an integer, but found ${l} instead.`);return h[l]}eachChild(o){o(this.index),o(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}var Fa=oc;class Gc{constructor(o,l){this.type=_i,this.needle=o,this.haystack=l}static parse(o,l){if(3!==o.length)return l.error(`Expected 2 arguments, but found ${o.length-1} instead.`);const h=l.parse(o[1],1,Xt),f=l.parse(o[2],2,Xt);return h&&f?Cm(h.type,[_i,vn,Zt,ar,Xt])?new Gc(h,f):l.error(`Expected first argument to be of type boolean, string, number or null, but found ${bn(h.type)} instead`):null}evaluate(o){const l=this.needle.evaluate(o),h=this.haystack.evaluate(o);if(null==h)return!1;if(!Zo(l,["boolean","string","number","null"]))throw new lo(`Expected first argument to be of type boolean, string, number or null, but found ${bn(lr(l))} instead.`);if(!Zo(h,["string","array"]))throw new lo(`Expected second argument to be of type array or string, but found ${bn(lr(h))} instead.`);return h.indexOf(l)>=0}eachChild(o){o(this.needle),o(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}var R_=Gc;class vr{constructor(o,l,h){this.type=Zt,this.needle=o,this.haystack=l,this.fromIndex=h}static parse(o,l){if(o.length<=2||o.length>=5)return l.error(`Expected 3 or 4 arguments, but found ${o.length-1} instead.`);const h=l.parse(o[1],1,Xt),f=l.parse(o[2],2,Xt);if(!h||!f)return null;if(!Cm(h.type,[_i,vn,Zt,ar,Xt]))return l.error(`Expected first argument to be of type boolean, string, number or null, but found ${bn(h.type)} instead`);if(4===o.length){const v=l.parse(o[3],3,Zt);return v?new vr(h,f,v):null}return new vr(h,f)}evaluate(o){const l=this.needle.evaluate(o),h=this.haystack.evaluate(o);if(!Zo(l,["boolean","string","number","null"]))throw new lo(`Expected first argument to be of type boolean, string, number or null, but found ${bn(lr(l))} instead.`);if(!Zo(h,["string","array"]))throw new lo(`Expected second argument to be of type array or string, but found ${bn(lr(h))} instead.`);if(this.fromIndex){const f=this.fromIndex.evaluate(o);return h.indexOf(l,f)}return h.indexOf(l)}eachChild(o){o(this.needle),o(this.haystack),this.fromIndex&&o(this.fromIndex)}outputDefined(){return!1}serialize(){if(null!=this.fromIndex&&void 0!==this.fromIndex){const o=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),o]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}var k_=vr;class Wp{constructor(o,l,h,f,v,b){this.inputType=o,this.type=l,this.input=h,this.cases=f,this.outputs=v,this.otherwise=b}static parse(o,l){if(o.length<5)return l.error(`Expected at least 4 arguments, but found only ${o.length-1}.`);if(o.length%2!=1)return l.error("Expected an even number of arguments.");let h,f;l.expectedType&&"value"!==l.expectedType.kind&&(f=l.expectedType);const v={},b=[];for(let A=2;A<o.length-1;A+=2){let L=o[A];const B=o[A+1];Array.isArray(L)||(L=[L]);const z=l.concat(A);if(0===L.length)return z.error("Expected at least one branch label.");for(const $ of L){if("number"!=typeof $&&"string"!=typeof $)return z.error("Branch labels must be numbers or strings.");if("number"==typeof $&&Math.abs($)>Number.MAX_SAFE_INTEGER)return z.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if("number"==typeof $&&Math.floor($)!==$)return z.error("Numeric branch labels must be integer values.");if(h){if(z.checkSubtype(h,lr($)))return null}else h=lr($);if(void 0!==v[String($)])return z.error("Branch labels must be unique.");v[String($)]=b.length}const j=l.parse(B,A,f);if(!j)return null;f=f||j.type,b.push(j)}const C=l.parse(o[1],1,Xt);if(!C)return null;const D=l.parse(o[o.length-1],o.length-1,f);return D?"value"!==C.type.kind&&l.concat(1).checkSubtype(h,C.type)?null:new Wp(h,f,C,v,b,D):null}evaluate(o){const l=this.input.evaluate(o);return(lr(l)===this.inputType&&this.outputs[this.cases[l]]||this.otherwise).evaluate(o)}eachChild(o){o(this.input),this.outputs.forEach(o),o(this.otherwise)}outputDefined(){return this.outputs.every(o=>o.outputDefined())&&this.otherwise.outputDefined()}serialize(){const o=["match",this.input.serialize()],l=Object.keys(this.cases).sort(),h=[],f={};for(const b of l){const C=f[this.cases[b]];void 0===C?(f[this.cases[b]]=h.length,h.push([this.cases[b],[b]])):h[C][1].push(b)}const v=b=>"number"===this.inputType.kind?Number(b):b;for(const[b,C]of h)o.push(1===C.length?v(C[0]):C.map(v)),o.push(this.outputs[b].serialize());return o.push(this.otherwise.serialize()),o}}var qp=Wp;class Ph{constructor(o,l,h){this.type=o,this.branches=l,this.otherwise=h}static parse(o,l){if(o.length<4)return l.error(`Expected at least 3 arguments, but found only ${o.length-1}.`);if(o.length%2!=0)return l.error("Expected an odd number of arguments.");let h;l.expectedType&&"value"!==l.expectedType.kind&&(h=l.expectedType);const f=[];for(let b=1;b<o.length-1;b+=2){const C=l.parse(o[b],b,_i);if(!C)return null;const D=l.parse(o[b+1],b+1,h);if(!D)return null;f.push([C,D]),h=h||D.type}const v=l.parse(o[o.length-1],o.length-1,h);return v?new Ph(h,f,v):null}evaluate(o){for(const[l,h]of this.branches)if(l.evaluate(o))return h.evaluate(o);return this.otherwise.evaluate(o)}eachChild(o){for(const[l,h]of this.branches)o(l),o(h);o(this.otherwise)}outputDefined(){return this.branches.every(([o,l])=>l.outputDefined())&&this.otherwise.outputDefined()}serialize(){const o=["case"];return this.eachChild(l=>{o.push(l.serialize())}),o}}var Rh=Ph;class zu{constructor(o,l,h,f){this.type=o,this.input=l,this.beginIndex=h,this.endIndex=f}static parse(o,l){if(o.length<=2||o.length>=5)return l.error(`Expected 3 or 4 arguments, but found ${o.length-1} instead.`);const h=l.parse(o[1],1,Xt),f=l.parse(o[2],2,Zt);if(!h||!f)return null;if(!Cm(h.type,[oo(Xt),vn,Xt]))return l.error(`Expected first argument to be of type array or string, but found ${bn(h.type)} instead`);if(4===o.length){const v=l.parse(o[3],3,Zt);return v?new zu(h.type,h,f,v):null}return new zu(h.type,h,f)}evaluate(o){const l=this.input.evaluate(o),h=this.beginIndex.evaluate(o);if(!Zo(l,["string","array"]))throw new lo(`Expected first argument to be of type array or string, but found ${bn(lr(l))} instead.`);if(this.endIndex){const f=this.endIndex.evaluate(o);return l.slice(h,f)}return l.slice(h)}eachChild(o){o(this.input),o(this.beginIndex),this.endIndex&&o(this.endIndex)}outputDefined(){return!1}serialize(){if(null!=this.endIndex&&void 0!==this.endIndex){const o=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),o]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}var Fl=zu;function Vs(a,o){return"=="===a||"!="===a?"boolean"===o.kind||"string"===o.kind||"number"===o.kind||"null"===o.kind||"value"===o.kind:"string"===o.kind||"number"===o.kind||"value"===o.kind}function Im(a,o,l,h){return 0===h.compare(o,l)}function Ds(a,o,l){const h="=="!==a&&"!="!==a;return class x5{constructor(v,b,C){this.type=_i,this.lhs=v,this.rhs=b,this.collator=C,this.hasUntypedArgument="value"===v.type.kind||"value"===b.type.kind}static parse(v,b){if(3!==v.length&&4!==v.length)return b.error("Expected two or three arguments.");const C=v[0];let D=b.parse(v[1],1,Xt);if(!D)return null;if(!Vs(C,D.type))return b.concat(1).error(`"${C}" comparisons are not supported for type '${bn(D.type)}'.`);let A=b.parse(v[2],2,Xt);if(!A)return null;if(!Vs(C,A.type))return b.concat(2).error(`"${C}" comparisons are not supported for type '${bn(A.type)}'.`);if(D.type.kind!==A.type.kind&&"value"!==D.type.kind&&"value"!==A.type.kind)return b.error(`Cannot compare types '${bn(D.type)}' and '${bn(A.type)}'.`);h&&("value"===D.type.kind&&"value"!==A.type.kind?D=new Bn(A.type,[D]):"value"!==D.type.kind&&"value"===A.type.kind&&(A=new Bn(D.type,[A])));let L=null;if(4===v.length){if("string"!==D.type.kind&&"string"!==A.type.kind&&"value"!==D.type.kind&&"value"!==A.type.kind)return b.error("Cannot use collator to compare non-string types.");if(L=b.parse(v[3],3,ku),!L)return null}return new x5(D,A,L)}evaluate(v){const b=this.lhs.evaluate(v),C=this.rhs.evaluate(v);if(h&&this.hasUntypedArgument){const D=lr(b),A=lr(C);if(D.kind!==A.kind||"string"!==D.kind&&"number"!==D.kind)throw new lo(`Expected arguments for "${a}" to be (string, string) or (number, number), but found (${D.kind}, ${A.kind}) instead.`)}if(this.collator&&!h&&this.hasUntypedArgument){const D=lr(b),A=lr(C);if("string"!==D.kind||"string"!==A.kind)return o(v,b,C)}return this.collator?l(v,b,C,this.collator.evaluate(v)):o(v,b,C)}eachChild(v){v(this.lhs),v(this.rhs),this.collator&&v(this.collator)}outputDefined(){return!0}serialize(){const v=[a];return this.eachChild(b=>{v.push(b.serialize())}),v}}}const il=Ds("==",function(a,o,l){return o===l},Im),Pm=Ds("!=",function(a,o,l){return o!==l},function(a,o,l,h){return!Im(0,o,l,h)}),kh=Ds("<",function(a,o,l){return o<l},function(a,o,l,h){return h.compare(o,l)<0}),Lh=Ds(">",function(a,o,l){return o>l},function(a,o,l,h){return h.compare(o,l)>0}),Na=Ds("<=",function(a,o,l){return o<=l},function(a,o,l,h){return h.compare(o,l)<=0}),Rm=Ds(">=",function(a,o,l){return o>=l},function(a,o,l,h){return h.compare(o,l)>=0});class L_{constructor(o,l,h,f,v,b){this.type=vn,this.number=o,this.locale=l,this.currency=h,this.unit=f,this.minFractionDigits=v,this.maxFractionDigits=b}static parse(o,l){if(3!==o.length)return l.error("Expected two arguments.");const h=l.parse(o[1],1,Zt);if(!h)return null;const f=o[2];if("object"!=typeof f||Array.isArray(f))return l.error("NumberFormat options argument must be an object.");let v=null;if(f.locale&&(v=l.parse(f.locale,1,vn),!v))return null;let b=null;if(f.currency&&(b=l.parse(f.currency,1,vn),!b))return null;let C=null;if(f.unit&&(C=l.parse(f.unit,1,vn),!C))return null;let D=null;if(f["min-fraction-digits"]&&(D=l.parse(f["min-fraction-digits"],1,Zt),!D))return null;let A=null;return f["max-fraction-digits"]&&(A=l.parse(f["max-fraction-digits"],1,Zt),!A)?null:new L_(h,v,b,C,D,A)}evaluate(o){return new Intl.NumberFormat(this.locale?this.locale.evaluate(o):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(o):void 0,unit:this.unit?this.unit.evaluate(o):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(o):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(o):void 0}).format(this.number.evaluate(o))}eachChild(o){o(this.number),this.locale&&o(this.locale),this.currency&&o(this.currency),this.unit&&o(this.unit),this.minFractionDigits&&o(this.minFractionDigits),this.maxFractionDigits&&o(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const o={};return this.locale&&(o.locale=this.locale.serialize()),this.currency&&(o.currency=this.currency.serialize()),this.unit&&(o.unit=this.unit.serialize()),this.minFractionDigits&&(o["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(o["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),o]}}class km{constructor(o){this.type=Zt,this.input=o}static parse(o,l){if(2!==o.length)return l.error(`Expected 1 argument, but found ${o.length-1} instead.`);const h=l.parse(o[1],1);return h?"array"!==h.type.kind&&"string"!==h.type.kind&&"value"!==h.type.kind?l.error(`Expected argument of type string or array, but found ${bn(h.type)} instead.`):new km(h):null}evaluate(o){const l=this.input.evaluate(o);if("string"==typeof l||Array.isArray(l))return l.length;throw new lo(`Expected value to be of type string or array, but found ${bn(lr(l))} instead.`)}eachChild(o){o(this.input)}outputDefined(){return!1}serialize(){const o=["length"];return this.eachChild(l=>{o.push(l.serialize())}),o}}const O_={"==":il,"!=":Pm,">":Lh,"<":kh,">=":Rm,"<=":Na,array:Bn,at:Fa,boolean:Bn,case:Rh,coalesce:Hc,collator:jp,format:nl,image:Gp,in:R_,"index-of":k_,interpolate:Lo,"interpolate-hcl":Lo,"interpolate-lab":Lo,length:km,let:Bu,literal:Hp,match:qp,number:Bn,"number-format":L_,object:Bn,slice:Fl,step:Dd,string:Bn,"to-boolean":Ed,"to-color":Ed,"to-number":Ed,"to-string":Ed,var:P_,within:Li};function E0(a,[o,l,h,f]){o=o.evaluate(a),l=l.evaluate(a),h=h.evaluate(a);const v=f?f.evaluate(a):1,b=M_(o,l,h,v);if(b)throw new lo(b);return new ms(o/255*v,l/255*v,h/255*v,v)}function T0(a,o){return a in o}function F_(a,o){const l=o[a];return void 0===l?null:l}function Id(a){return{type:a}}La.register(O_,{error:[{kind:"error"},[vn],(a,[o])=>{throw new lo(o.evaluate(a))}],typeof:[vn,[Xt],(a,[o])=>bn(lr(o.evaluate(a)))],"to-rgba":[oo(Zt,4),[Ol],(a,[o])=>o.evaluate(a).toArray()],rgb:[Ol,[Zt,Zt,Zt],E0],rgba:[Ol,[Zt,Zt,Zt,Zt],E0],has:{type:_i,overloads:[[[vn],(a,[o])=>T0(o.evaluate(a),a.properties())],[[vn,Ai],(a,[o,l])=>T0(o.evaluate(a),l.evaluate(a))]]},get:{type:Xt,overloads:[[[vn],(a,[o])=>F_(o.evaluate(a),a.properties())],[[vn,Ai],(a,[o,l])=>F_(o.evaluate(a),l.evaluate(a))]]},"feature-state":[Xt,[vn],(a,[o])=>F_(o.evaluate(a),a.featureState||{})],properties:[Ai,[],a=>a.properties()],"geometry-type":[vn,[],a=>a.geometryType()],id:[Xt,[],a=>a.id()],zoom:[Zt,[],a=>a.globals.zoom],pitch:[Zt,[],a=>a.globals.pitch||0],"distance-from-center":[Zt,[],a=>a.distanceFromCenter()],"heatmap-density":[Zt,[],a=>a.globals.heatmapDensity||0],"line-progress":[Zt,[],a=>a.globals.lineProgress||0],"sky-radial-progress":[Zt,[],a=>a.globals.skyRadialProgress||0],accumulated:[Xt,[],a=>void 0===a.globals.accumulated?null:a.globals.accumulated],"+":[Zt,Id(Zt),(a,o)=>{let l=0;for(const h of o)l+=h.evaluate(a);return l}],"*":[Zt,Id(Zt),(a,o)=>{let l=1;for(const h of o)l*=h.evaluate(a);return l}],"-":{type:Zt,overloads:[[[Zt,Zt],(a,[o,l])=>o.evaluate(a)-l.evaluate(a)],[[Zt],(a,[o])=>-o.evaluate(a)]]},"/":[Zt,[Zt,Zt],(a,[o,l])=>o.evaluate(a)/l.evaluate(a)],"%":[Zt,[Zt,Zt],(a,[o,l])=>o.evaluate(a)%l.evaluate(a)],ln2:[Zt,[],()=>Math.LN2],pi:[Zt,[],()=>Math.PI],e:[Zt,[],()=>Math.E],"^":[Zt,[Zt,Zt],(a,[o,l])=>Math.pow(o.evaluate(a),l.evaluate(a))],sqrt:[Zt,[Zt],(a,[o])=>Math.sqrt(o.evaluate(a))],log10:[Zt,[Zt],(a,[o])=>Math.log(o.evaluate(a))/Math.LN10],ln:[Zt,[Zt],(a,[o])=>Math.log(o.evaluate(a))],log2:[Zt,[Zt],(a,[o])=>Math.log(o.evaluate(a))/Math.LN2],sin:[Zt,[Zt],(a,[o])=>Math.sin(o.evaluate(a))],cos:[Zt,[Zt],(a,[o])=>Math.cos(o.evaluate(a))],tan:[Zt,[Zt],(a,[o])=>Math.tan(o.evaluate(a))],asin:[Zt,[Zt],(a,[o])=>Math.asin(o.evaluate(a))],acos:[Zt,[Zt],(a,[o])=>Math.acos(o.evaluate(a))],atan:[Zt,[Zt],(a,[o])=>Math.atan(o.evaluate(a))],min:[Zt,Id(Zt),(a,o)=>Math.min(...o.map(l=>l.evaluate(a)))],max:[Zt,Id(Zt),(a,o)=>Math.max(...o.map(l=>l.evaluate(a)))],abs:[Zt,[Zt],(a,[o])=>Math.abs(o.evaluate(a))],round:[Zt,[Zt],(a,[o])=>{const l=o.evaluate(a);return l<0?-Math.round(-l):Math.round(l)}],floor:[Zt,[Zt],(a,[o])=>Math.floor(o.evaluate(a))],ceil:[Zt,[Zt],(a,[o])=>Math.ceil(o.evaluate(a))],"filter-==":[_i,[vn,Xt],(a,[o,l])=>a.properties()[o.value]===l.value],"filter-id-==":[_i,[Xt],(a,[o])=>a.id()===o.value],"filter-type-==":[_i,[vn],(a,[o])=>a.geometryType()===o.value],"filter-<":[_i,[vn,Xt],(a,[o,l])=>{const h=a.properties()[o.value],f=l.value;return typeof h==typeof f&&h<f}],"filter-id-<":[_i,[Xt],(a,[o])=>{const l=a.id(),h=o.value;return typeof l==typeof h&&l<h}],"filter->":[_i,[vn,Xt],(a,[o,l])=>{const h=a.properties()[o.value],f=l.value;return typeof h==typeof f&&h>f}],"filter-id->":[_i,[Xt],(a,[o])=>{const l=a.id(),h=o.value;return typeof l==typeof h&&l>h}],"filter-<=":[_i,[vn,Xt],(a,[o,l])=>{const h=a.properties()[o.value],f=l.value;return typeof h==typeof f&&h<=f}],"filter-id-<=":[_i,[Xt],(a,[o])=>{const l=a.id(),h=o.value;return typeof l==typeof h&&l<=h}],"filter->=":[_i,[vn,Xt],(a,[o,l])=>{const h=a.properties()[o.value],f=l.value;return typeof h==typeof f&&h>=f}],"filter-id->=":[_i,[Xt],(a,[o])=>{const l=a.id(),h=o.value;return typeof l==typeof h&&l>=h}],"filter-has":[_i,[Xt],(a,[o])=>o.value in a.properties()],"filter-has-id":[_i,[],a=>null!==a.id()&&void 0!==a.id()],"filter-type-in":[_i,[oo(vn)],(a,[o])=>o.value.indexOf(a.geometryType())>=0],"filter-id-in":[_i,[oo(Xt)],(a,[o])=>o.value.indexOf(a.id())>=0],"filter-in-small":[_i,[vn,oo(Xt)],(a,[o,l])=>l.value.indexOf(a.properties()[o.value])>=0],"filter-in-large":[_i,[vn,oo(Xt)],(a,[o,l])=>function(h,f,v,b){for(;v<=b;){const C=v+b>>1;if(f[C]===h)return!0;f[C]>h?b=C-1:v=C+1}return!1}(a.properties()[o.value],l.value,0,l.value.length-1)],all:{type:_i,overloads:[[[_i,_i],(a,[o,l])=>o.evaluate(a)&&l.evaluate(a)],[Id(_i),(a,o)=>{for(const l of o)if(!l.evaluate(a))return!1;return!0}]]},any:{type:_i,overloads:[[[_i,_i],(a,[o,l])=>o.evaluate(a)||l.evaluate(a)],[Id(_i),(a,o)=>{for(const l of o)if(l.evaluate(a))return!0;return!1}]]},"!":[_i,[_i],(a,[o])=>!o.evaluate(a)],"is-supported-script":[_i,[vn],(a,[o])=>{const l=a.globals&&a.globals.isSupportedScript;return!l||l(o.evaluate(a))}],upcase:[vn,[vn],(a,[o])=>o.evaluate(a).toUpperCase()],downcase:[vn,[vn],(a,[o])=>o.evaluate(a).toLowerCase()],concat:[vn,Id(Xt),(a,o)=>o.map(l=>Zi(l.evaluate(a))).join("")],"resolved-locale":[vn,[ku],(a,[o])=>o.evaluate(a).resolvedLocale()]});var Oh=O_;function N_(a){return{result:"success",value:a}}function jc(a){return{result:"error",value:a}}function Fh(a){return"data-driven"===a["property-type"]||"cross-faded-data-driven"===a["property-type"]}function D0(a){return!!a.expression&&a.expression.parameters.indexOf("zoom")>-1}function ac(a){return!!a.expression&&a.expression.interpolated}function Xi(a){return a instanceof Number?"number":a instanceof String?"string":a instanceof Boolean?"boolean":Array.isArray(a)?"array":null===a?"null":typeof a}function $c(a){return"object"==typeof a&&null!==a&&!Array.isArray(a)}function Hw(a){return a}function A0(a,o){const l="color"===o.type,h=a.stops&&"object"==typeof a.stops[0][0],f=h||!(h||void 0!==a.property),v=a.type||(ac(o)?"exponential":"interval");if(l&&((a=Ll({},a)).stops&&(a.stops=a.stops.map(A=>[A[0],ms.parse(A[1])])),a.default=ms.parse(a.default?a.default:o.default)),a.colorSpace&&"rgb"!==a.colorSpace&&!Ad[a.colorSpace])throw new Error(`Unknown color space: ${a.colorSpace}`);let b,C,D;if("exponential"===v)b=z_;else if("interval"===v)b=B_;else if("categorical"===v){b=Lm,C=Object.create(null);for(const A of a.stops)C[A[0]]=A[1];D=typeof a.stops[0][0]}else{if("identity"!==v)throw new Error(`Unknown function type "${v}"`);b=V_}if(h){const A={},L=[];for(let j=0;j<a.stops.length;j++){const $=a.stops[j],Y=$[0].zoom;void 0===A[Y]&&(A[Y]={zoom:Y,type:a.type,property:a.property,default:a.default,stops:[]},L.push(Y)),A[Y].stops.push([$[0].value,$[1]])}const B=[];for(const j of L)B.push([A[j].zoom,A0(A[j],o)]);const z={name:"linear"};return{kind:"composite",interpolationType:z,interpolationFactor:Lo.interpolationFactor.bind(void 0,z),zoomStops:B.map(j=>j[0]),evaluate:({zoom:j},$)=>z_({stops:B,base:a.base},o,j).evaluate(j,$)}}if(f){const A="exponential"===v?{name:"exponential",base:void 0!==a.base?a.base:1}:null;return{kind:"camera",interpolationType:A,interpolationFactor:Lo.interpolationFactor.bind(void 0,A),zoomStops:a.stops.map(L=>L[0]),evaluate:({zoom:L})=>b(a,o,L,C,D)}}return{kind:"source",evaluate(A,L){const B=L&&L.properties?L.properties[a.property]:void 0;return void 0===B?Vu(a.default,o.default):b(a,o,B,C,D)}}}function Vu(a,o,l){return void 0!==a?a:void 0!==o?o:void 0!==l?l:void 0}function Lm(a,o,l,h,f){return Vu(typeof l===f?h[l]:void 0,a.default,o.default)}function B_(a,o,l){if("number"!==Xi(l))return Vu(a.default,o.default);const h=a.stops.length;if(1===h||l<=a.stops[0][0])return a.stops[0][1];if(l>=a.stops[h-1][0])return a.stops[h-1][1];const f=Td(a.stops.map(v=>v[0]),l);return a.stops[f][1]}function z_(a,o,l){const h=void 0!==a.base?a.base:1;if("number"!==Xi(l))return Vu(a.default,o.default);const f=a.stops.length;if(1===f||l<=a.stops[0][0])return a.stops[0][1];if(l>=a.stops[f-1][0])return a.stops[f-1][1];const v=Td(a.stops.map(L=>L[0]),l),b=function(L,B,z,j){const $=j-z,Y=L-z;return 0===$?0:1===B?Y/$:(Math.pow(B,Y)-1)/(Math.pow(B,$)-1)}(l,h,a.stops[v][0],a.stops[v+1][0]),C=a.stops[v][1],D=a.stops[v+1][1];let A=an[o.type]||Hw;if(a.colorSpace&&"rgb"!==a.colorSpace){const L=Ad[a.colorSpace];A=(B,z)=>L.reverse(L.interpolate(L.forward(B),L.forward(z),b))}return"function"==typeof C.evaluate?{evaluate(...L){const B=C.evaluate.apply(void 0,L),z=D.evaluate.apply(void 0,L);if(void 0!==B&&void 0!==z)return A(B,z,b)}}:A(C,D,b)}function V_(a,o,l){return"color"===o.type?l=ms.parse(l):"formatted"===o.type?l=ko.fromString(l.toString()):"resolvedImage"===o.type?l=da.fromString(l.toString()):Xi(l)===o.type||"enum"===o.type&&o.values[l]||(l=void 0),Vu(l,a.default,o.default)}class rl{constructor(o,l){var h;this.expression=o,this._warningHistory={},this._evaluator=new Eh,this._defaultValue=l?"color"===(h=l).type&&($c(h.default)||Array.isArray(h.default))?new ms(0,0,0,0):"color"===h.type?ms.parse(h.default)||null:void 0===h.default?null:h.default:null,this._enumValues=l&&"enum"===l.type?l.values:null}evaluateWithoutErrorHandling(o,l,h,f,v,b,C,D){return this._evaluator.globals=o,this._evaluator.feature=l,this._evaluator.featureState=h,this._evaluator.canonical=f||null,this._evaluator.availableImages=v||null,this._evaluator.formattedSection=b,this._evaluator.featureTileCoord=C||null,this._evaluator.featureDistanceData=D||null,this.expression.evaluate(this._evaluator)}evaluate(o,l,h,f,v,b,C,D){this._evaluator.globals=o,this._evaluator.feature=l||null,this._evaluator.featureState=h||null,this._evaluator.canonical=f||null,this._evaluator.availableImages=v||null,this._evaluator.formattedSection=b||null,this._evaluator.featureTileCoord=C||null,this._evaluator.featureDistanceData=D||null;try{const A=this.expression.evaluate(this._evaluator);if(null==A||"number"==typeof A&&A!=A)return this._defaultValue;if(this._enumValues&&!(A in this._enumValues))throw new lo(`Expected value to be one of ${Object.keys(this._enumValues).map(L=>JSON.stringify(L)).join(", ")}, but found ${JSON.stringify(A)} instead.`);return A}catch(A){return this._warningHistory[A.message]||(this._warningHistory[A.message]=!0,typeof console<"u"&&console.warn(A.message)),this._defaultValue}}}function Nh(a){return Array.isArray(a)&&a.length>0&&"string"==typeof a[0]&&a[0]in Oh}function Nr(a,o){const l=new Am(Oh,[],o?function(f){const v={color:Ol,string:vn,number:Zt,enum:vn,boolean:_i,formatted:Ch,resolvedImage:bt};return"array"===f.type?oo(v[f.value]||Xt,f.length):v[f.type]}(o):void 0),h=l.parse(a,void 0,void 0,void 0,o&&"string"===o.type?{typeAnnotation:"coerce"}:void 0);return h?N_(new rl(h,o)):jc(l.errors)}class Bh{constructor(o,l){this.kind=o,this._styleExpression=l,this.isStateDependent="constant"!==o&&!Dh(l.expression)}evaluateWithoutErrorHandling(o,l,h,f,v,b){return this._styleExpression.evaluateWithoutErrorHandling(o,l,h,f,v,b)}evaluate(o,l,h,f,v,b){return this._styleExpression.evaluate(o,l,h,f,v,b)}}class Zp{constructor(o,l,h,f){this.kind=o,this.zoomStops=h,this._styleExpression=l,this.isStateDependent="camera"!==o&&!Dh(l.expression),this.interpolationType=f}evaluateWithoutErrorHandling(o,l,h,f,v,b){return this._styleExpression.evaluateWithoutErrorHandling(o,l,h,f,v,b)}evaluate(o,l,h,f,v,b){return this._styleExpression.evaluate(o,l,h,f,v,b)}interpolationFactor(o,l,h){return this.interpolationType?Lo.interpolationFactor(this.interpolationType,o,l,h):0}}function zh(a,o){if("error"===(a=Nr(a,o)).result)return a;const l=a.value.expression,h=Lu(l);if(!h&&!Fh(o))return jc([new so("","data expressions not supported")]);const f=Oa(l,["zoom","pitch","distance-from-center"]);if(!f&&!D0(o))return jc([new so("","zoom expressions not supported")]);const v=Pd(l);return v||f?v instanceof so?jc([v]):v instanceof Lo&&!ac(o)?jc([new so("",'"interpolate" expressions cannot be used with this property')]):N_(v?new Zp(h?"camera":"composite",a.value,v.labels,v instanceof Lo?v.interpolation:void 0):new Bh(h?"constant":"source",a.value)):jc([new so("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class Nl{constructor(o,l){this._parameters=o,this._specification=l,Ll(this,A0(this._parameters,this._specification))}static deserialize(o){return new Nl(o._parameters,o._specification)}static serialize(o){return{_parameters:o._parameters,_specification:o._specification}}}function Pd(a){let o=null;if(a instanceof Bu)o=Pd(a.result);else if(a instanceof Hc){for(const l of a.args)if(o=Pd(l),o)break}else(a instanceof Dd||a instanceof Lo)&&a.input instanceof La&&"zoom"===a.input.name&&(o=a);return o instanceof so||a.eachChild(l=>{const h=Pd(l);h instanceof so?o=h:!o&&h?o=new so("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):o&&h&&o!==h&&(o=new so("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),o}class Jt{constructor(o,l,h,f){this.message=(o?`${o}: `:"")+h,f&&(this.identifier=f),null!=l&&l.__line__&&(this.line=l.__line__)}}function Oo(a){const o=a.key,l=a.value,h=a.valueSpec||{},f=a.objectElementValidators||{},v=a.style,b=a.styleSpec;let C=[];const D=Xi(l);if("object"!==D)return[new Jt(o,l,`object expected, ${D} found`)];for(const A in l){const L=A.split(".")[0],B=h[L]||h["*"];let z;f[L]?z=f[L]:h[L]?z=ai:f["*"]?z=f["*"]:h["*"]&&(z=ai),z?C=C.concat(z({key:(o&&`${o}.`)+A,value:l[A],valueSpec:B,style:v,styleSpec:b,object:l,objectKey:A},l)):C.push(new Jt(o,l[A],`unknown property "${A}"`))}for(const A in h)f[A]||h[A].required&&void 0===h[A].default&&void 0===l[A]&&C.push(new Jt(o,l,`missing required property "${A}"`));return C}function Om(a){const o=a.value,l=a.valueSpec,h=a.style,f=a.styleSpec,v=a.key,b=a.arrayElementValidator||ai;if("array"!==Xi(o))return[new Jt(v,o,`array expected, ${Xi(o)} found`)];if(l.length&&o.length!==l.length)return[new Jt(v,o,`array length ${l.length} expected, length ${o.length} found`)];if(l["min-length"]&&o.length<l["min-length"])return[new Jt(v,o,`array length at least ${l["min-length"]} expected, length ${o.length} found`)];let C={type:l.value,values:l.values,minimum:l.minimum,maximum:l.maximum,function:void 0};f.$version<7&&(C.function=l.function),"object"===Xi(l.value)&&(C=l.value);let D=[];for(let A=0;A<o.length;A++)D=D.concat(b({array:o,arrayIndex:A,value:o[A],valueSpec:C,style:h,styleSpec:f,key:`${v}[${A}]`}));return D}function ga(a){const o=a.key,l=a.value,h=a.valueSpec;let f=Xi(l);if("number"===f&&l!=l&&(f="NaN"),"number"!==f)return[new Jt(o,l,`number expected, ${f} found`)];if("minimum"in h){let v=h.minimum;if("array"===Xi(h.minimum)&&(v=h.minimum[a.arrayIndex]),l<v)return[new Jt(o,l,`${l} is less than the minimum value ${v}`)]}if("maximum"in h){let v=h.maximum;if("array"===Xi(h.maximum)&&(v=h.maximum[a.arrayIndex]),l>v)return[new Jt(o,l,`${l} is greater than the maximum value ${v}`)]}return[]}function Vh(a){const o=a.valueSpec,l=ps(a.value.type);let h,f,v,b={};const C="categorical"!==l&&void 0===a.value.property,D=!C,A="array"===Xi(a.value.stops)&&"array"===Xi(a.value.stops[0])&&"object"===Xi(a.value.stops[0][0]),L=Oo({key:a.key,value:a.value,valueSpec:a.styleSpec.function,style:a.style,styleSpec:a.styleSpec,objectElementValidators:{stops:function(j){if("identity"===l)return[new Jt(j.key,j.value,'identity function may not have a "stops" property')];let $=[];const Y=j.value;return $=$.concat(Om({key:j.key,value:Y,valueSpec:j.valueSpec,style:j.style,styleSpec:j.styleSpec,arrayElementValidator:B})),"array"===Xi(Y)&&0===Y.length&&$.push(new Jt(j.key,Y,"array must have at least one stop")),$},default:function(j){return ai({key:j.key,value:j.value,valueSpec:o,style:j.style,styleSpec:j.styleSpec})}}});return"identity"===l&&C&&L.push(new Jt(a.key,a.value,'missing required property "property"')),"identity"===l||a.value.stops||L.push(new Jt(a.key,a.value,'missing required property "stops"')),"exponential"===l&&a.valueSpec.expression&&!ac(a.valueSpec)&&L.push(new Jt(a.key,a.value,"exponential functions not supported")),a.styleSpec.$version>=8&&(D&&!Fh(a.valueSpec)?L.push(new Jt(a.key,a.value,"property functions not supported")):C&&!D0(a.valueSpec)&&L.push(new Jt(a.key,a.value,"zoom functions not supported"))),"categorical"!==l&&!A||void 0!==a.value.property||L.push(new Jt(a.key,a.value,'"property" property is required')),L;function B(j){let $=[];const Y=j.value,te=j.key;if("array"!==Xi(Y))return[new Jt(te,Y,`array expected, ${Xi(Y)} found`)];if(2!==Y.length)return[new Jt(te,Y,`array length 2 expected, length ${Y.length} found`)];if(A){if("object"!==Xi(Y[0]))return[new Jt(te,Y,`object expected, ${Xi(Y[0])} found`)];if(void 0===Y[0].zoom)return[new Jt(te,Y,"object stop key must have zoom")];if(void 0===Y[0].value)return[new Jt(te,Y,"object stop key must have value")];const me=ps(Y[0].zoom);if("number"!=typeof me)return[new Jt(te,Y[0].zoom,"stop zoom values must be numbers")];if(v&&v>me)return[new Jt(te,Y[0].zoom,"stop zoom values must appear in ascending order")];me!==v&&(v=me,f=void 0,b={}),$=$.concat(Oo({key:`${te}[0]`,value:Y[0],valueSpec:{zoom:{}},style:j.style,styleSpec:j.styleSpec,objectElementValidators:{zoom:ga,value:z}}))}else $=$.concat(z({key:`${te}[0]`,value:Y[0],valueSpec:{},style:j.style,styleSpec:j.styleSpec},Y));return Nh(Vc(Y[1]))?$.concat([new Jt(`${te}[1]`,Y[1],"expressions are not allowed in function stops.")]):$.concat(ai({key:`${te}[1]`,value:Y[1],valueSpec:o,style:j.style,styleSpec:j.styleSpec}))}function z(j,$){const Y=Xi(j.value),te=ps(j.value),me=null!==j.value?j.value:$;if(h){if(Y!==h)return[new Jt(j.key,me,`${Y} stop domain type must match previous stop domain type ${h}`)]}else h=Y;if("number"!==Y&&"string"!==Y&&"boolean"!==Y&&"number"!=typeof te&&"string"!=typeof te&&"boolean"!=typeof te)return[new Jt(j.key,me,"stop domain value must be a number, string, or boolean")];if("number"!==Y&&"categorical"!==l){let Ce=`number expected, ${Y} found`;return Fh(o)&&void 0===l&&(Ce+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Jt(j.key,me,Ce)]}return"categorical"!==l||"number"!==Y||"number"==typeof te&&isFinite(te)&&Math.floor(te)===te?"categorical"!==l&&"number"===Y&&"number"==typeof te&&"number"==typeof f&&void 0!==f&&te<f?[new Jt(j.key,me,"stop domain values must appear in ascending order")]:(f=te,"categorical"===l&&te in b?[new Jt(j.key,me,"stop domain values must be unique")]:(b[te]=!0,[])):[new Jt(j.key,me,`integer expected, found ${String(te)}`)]}}function lc(a){const o=("property"===a.expressionContext?zh:Nr)(Vc(a.value),a.valueSpec);if("error"===o.result)return o.value.map(h=>new Jt(`${a.key}${h.key}`,a.value,h.message));const l=o.value.expression||o.value._styleExpression.expression;if("property"===a.expressionContext&&"text-font"===a.propertyKey&&!l.outputDefined())return[new Jt(a.key,a.value,`Invalid data expression for "${a.propertyKey}". Output values must be contained as literals within the expression.`)];if("property"===a.expressionContext&&"layout"===a.propertyType&&!Dh(l))return[new Jt(a.key,a.value,'"feature-state" data expressions are not supported with layout properties.')];if("filter"===a.expressionContext)return Xp(l,a);if(a.expressionContext&&0===a.expressionContext.indexOf("cluster")){if(!Oa(l,["zoom","feature-state"]))return[new Jt(a.key,a.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if("cluster-initial"===a.expressionContext&&!Lu(l))return[new Jt(a.key,a.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Xp(a,o){const l=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(o.valueSpec&&o.valueSpec.expression)for(const f of o.valueSpec.expression.parameters)l.delete(f);if(0===l.size)return[];const h=[];return a instanceof La&&l.has(a.name)?[new Jt(o.key,o.value,`["${a.name}"] expression is not supported in a filter for a ${o.object.type} layer with id: ${o.object.id}`)]:(a.eachChild(f=>{h.push(...Xp(f,o))}),h)}function Yp(a){const o=a.key,l=a.value,h=a.valueSpec,f=[];return Array.isArray(h.values)?-1===h.values.indexOf(ps(l))&&f.push(new Jt(o,l,`expected one of [${h.values.join(", ")}], ${JSON.stringify(l)} found`)):-1===Object.keys(h.values).indexOf(ps(l))&&f.push(new Jt(o,l,`expected one of [${Object.keys(h.values).join(", ")}], ${JSON.stringify(l)} found`)),f}function U_(a){if(!0===a||!1===a)return!0;if(!Array.isArray(a)||0===a.length)return!1;switch(a[0]){case"has":return a.length>=2&&"$id"!==a[1]&&"$type"!==a[1];case"in":return a.length>=3&&("string"!=typeof a[1]||Array.isArray(a[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return 3!==a.length||Array.isArray(a[1])||Array.isArray(a[2]);case"any":case"all":for(const o of a.slice(1))if(!U_(o)&&"boolean"!=typeof o)return!1;return!0;default:return!0}}function es(a,o="fill"){if(null==a)return{filter:()=>!0,needGeometry:!1,needFeature:!1};U_(a)||(a=cc(a));const l=a;let h=!0;try{h=function(A){if(!Ba(A))return A;let L=Vc(A);return Kp(L),L=H_(L),L}(l)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.\nThis is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md\nand paste the contents of this message in the report.\nThank you!\nFilter Expression:\n${JSON.stringify(l,null,2)}\n        `)}const f=rt[`filter_${o}`],v=Nr(h,f);let b=null;if("error"===v.result)throw new Error(v.value.map(A=>`${A.key}: ${A.message}`).join(", "));b=(A,L,B)=>v.value.evaluate(A,L,{},B);let C=null,D=null;if(h!==l){const A=Nr(l,f);if("error"===A.result)throw new Error(A.value.map(L=>`${L.key}: ${L.message}`).join(", "));C=(L,B,z,j,$)=>A.value.evaluate(L,B,{},z,void 0,void 0,j,$),D=!Lu(A.value.expression)}return{filter:b,dynamicFilter:C||void 0,needGeometry:Jp(h),needFeature:!!D}}function H_(a){if(!Array.isArray(a))return a;const o=function(l){if(Zr.has(l[0]))for(let h=1;h<l.length;h++)if(Ba(l[h]))return!0;return l}(a);return!0===o?o:o.map(l=>H_(l))}function Kp(a){let o=!1;const l=[];if("case"===a[0]){for(let h=1;h<a.length-1;h+=2)o=o||Ba(a[h]),l.push(a[h+1]);l.push(a[a.length-1])}else if("match"===a[0]){o=o||Ba(a[1]);for(let h=2;h<a.length-1;h+=2)l.push(a[h+1]);l.push(a[a.length-1])}else if("step"===a[0]){o=o||Ba(a[1]);for(let h=1;h<a.length-1;h+=2)l.push(a[h+1])}o&&(a.length=0,a.push("any",...l));for(let h=1;h<a.length;h++)Kp(a[h])}function Ba(a){if(!Array.isArray(a))return!1;if("pitch"===(o=a[0])||"distance-from-center"===o)return!0;var o;for(let l=1;l<a.length;l++)if(Ba(a[l]))return!0;return!1}const Zr=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function Qp(a,o){return a<o?-1:a>o?1:0}function Jp(a){if(!Array.isArray(a))return!1;if("within"===a[0])return!0;for(let o=1;o<a.length;o++)if(Jp(a[o]))return!0;return!1}function cc(a){if(!a)return!0;const o=a[0];return a.length<=1?"any"!==o:"=="===o?Fo(a[1],a[2],"=="):"!="===o?ef(Fo(a[1],a[2],"==")):"<"===o||">"===o||"<="===o||">="===o?Fo(a[1],a[2],o):"any"===o?(l=a.slice(1),["any"].concat(l.map(cc))):"all"===o?["all"].concat(a.slice(1).map(cc)):"none"===o?["all"].concat(a.slice(1).map(cc).map(ef)):"in"===o?G_(a[1],a.slice(2)):"!in"===o?ef(G_(a[1],a.slice(2))):"has"===o?Uu(a[1]):"!has"===o?ef(Uu(a[1])):"within"!==o||a;var l}function Fo(a,o,l){switch(a){case"$type":return[`filter-type-${l}`,o];case"$id":return[`filter-id-${l}`,o];default:return[`filter-${l}`,a,o]}}function G_(a,o){if(0===o.length)return!1;switch(a){case"$type":return["filter-type-in",["literal",o]];case"$id":return["filter-id-in",["literal",o]];default:return o.length>200&&!o.some(l=>typeof l!=typeof o[0])?["filter-in-large",a,["literal",o.sort(Qp)]]:["filter-in-small",a,["literal",o]]}}function Uu(a){switch(a){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",a]}}function ef(a){return["!",a]}function za(a){return U_(Vc(a.value))?lc(Ll({},a,{expressionContext:"filter",valueSpec:a.styleSpec[`filter_${a.layerType||"fill"}`]})):Fm(a)}function Fm(a){const o=a.value,l=a.key;if("array"!==Xi(o))return[new Jt(l,o,`array expected, ${Xi(o)} found`)];const h=a.styleSpec;let f,v=[];if(o.length<1)return[new Jt(l,o,"filter array must have at least 1 element")];switch(v=v.concat(Yp({key:`${l}[0]`,value:o[0],valueSpec:h.filter_operator,style:a.style,styleSpec:a.styleSpec})),ps(o[0])){case"<":case"<=":case">":case">=":o.length>=2&&"$type"===ps(o[1])&&v.push(new Jt(l,o,`"$type" cannot be use with operator "${o[0]}"`));case"==":case"!=":3!==o.length&&v.push(new Jt(l,o,`filter array for operator "${o[0]}" must have 3 elements`));case"in":case"!in":o.length>=2&&(f=Xi(o[1]),"string"!==f&&v.push(new Jt(`${l}[1]`,o[1],`string expected, ${f} found`)));for(let b=2;b<o.length;b++)f=Xi(o[b]),"$type"===ps(o[1])?v=v.concat(Yp({key:`${l}[${b}]`,value:o[b],valueSpec:h.geometry_type,style:a.style,styleSpec:a.styleSpec})):"string"!==f&&"number"!==f&&"boolean"!==f&&v.push(new Jt(`${l}[${b}]`,o[b],`string, number, or boolean expected, ${f} found`));break;case"any":case"all":case"none":for(let b=1;b<o.length;b++)v=v.concat(Fm({key:`${l}[${b}]`,value:o[b],style:a.style,styleSpec:a.styleSpec}));break;case"has":case"!has":f=Xi(o[1]),2!==o.length?v.push(new Jt(l,o,`filter array for "${o[0]}" operator must have 2 elements`)):"string"!==f&&v.push(new Jt(`${l}[1]`,o[1],`string expected, ${f} found`));break;case"within":f=Xi(o[1]),2!==o.length?v.push(new Jt(l,o,`filter array for "${o[0]}" operator must have 2 elements`)):"object"!==f&&v.push(new Jt(`${l}[1]`,o[1],`object expected, ${f} found`))}return v}function tf(a,o){const l=a.key,h=a.style,f=a.styleSpec,v=a.value,b=a.objectKey,C=f[`${o}_${a.layerType}`];if(!C)return[];const D=b.match(/^(.*)-transition$/);if("paint"===o&&D&&C[D[1]]&&C[D[1]].transition)return ai({key:l,value:v,valueSpec:f.transition,style:h,styleSpec:f});const A=a.valueSpec||C[b];if(!A)return[new Jt(l,v,`unknown property "${b}"`)];let L;if("string"===Xi(v)&&Fh(A)&&!A.tokens&&(L=/^{([^}]+)}$/.exec(v)))return[new Jt(l,v,`"${b}" does not support interpolation syntax\nUse an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(L[1])} }\`.`)];const B=[];return"symbol"===a.layerType&&("text-field"===b&&h&&!h.glyphs&&B.push(new Jt(l,v,'use of "text-field" requires a style "glyphs" property')),"text-font"===b&&$c(Vc(v))&&"identity"===ps(v.type)&&B.push(new Jt(l,v,'"text-font" does not support identity functions'))),B.concat(ai({key:a.key,value:v,valueSpec:A,style:h,styleSpec:f,expressionContext:"property",propertyType:o,propertyKey:b}))}function ui(a){return tf(a,"paint")}function Nm(a){return tf(a,"layout")}function j_(a){let o=[];const l=a.value,h=a.key,f=a.style,v=a.styleSpec;l.type||l.ref||o.push(new Jt(h,l,'either "type" or "ref" is required'));let b=ps(l.type);const C=ps(l.ref);if(l.id){const D=ps(l.id);for(let A=0;A<a.arrayIndex;A++){const L=f.layers[A];ps(L.id)===D&&o.push(new Jt(h,l.id,`duplicate layer id "${l.id}", previously used at line ${L.id.__line__}`))}}if("ref"in l){let D;["type","source","source-layer","filter","layout"].forEach(A=>{A in l&&o.push(new Jt(h,l[A],`"${A}" is prohibited for ref layers`))}),f.layers.forEach(A=>{ps(A.id)===C&&(D=A)}),D?D.ref?o.push(new Jt(h,l.ref,"ref cannot reference another ref layer")):b=ps(D.type):"string"==typeof C&&o.push(new Jt(h,l.ref,`ref layer "${C}" not found`))}else if("background"!==b&&"sky"!==b)if(l.source){const D=f.sources&&f.sources[l.source],A=D&&ps(D.type);D?"vector"===A&&"raster"===b?o.push(new Jt(h,l.source,`layer "${l.id}" requires a raster source`)):"raster"===A&&"raster"!==b?o.push(new Jt(h,l.source,`layer "${l.id}" requires a vector source`)):"vector"!==A||l["source-layer"]?"raster-dem"===A&&"hillshade"!==b?o.push(new Jt(h,l.source,"raster-dem source can only be used with layer type 'hillshade'.")):"line"!==b||!l.paint||!l.paint["line-gradient"]&&!l.paint["line-trim-offset"]||"geojson"===A&&D.lineMetrics||o.push(new Jt(h,l,`layer "${l.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):o.push(new Jt(h,l,`layer "${l.id}" must specify a "source-layer"`)):o.push(new Jt(h,l.source,`source "${l.source}" not found`))}else o.push(new Jt(h,l,'missing required property "source"'));return o=o.concat(Oo({key:h,value:l,valueSpec:v.layer,style:a.style,styleSpec:a.styleSpec,objectElementValidators:{"*":()=>[],type:()=>ai({key:`${h}.type`,value:l.type,valueSpec:v.layer.type,style:a.style,styleSpec:a.styleSpec,object:l,objectKey:"type"}),filter:D=>za(Ll({layerType:b},D)),layout:D=>Oo({layer:l,key:D.key,value:D.value,valueSpec:{},style:D.style,styleSpec:D.styleSpec,objectElementValidators:{"*":A=>Nm(Ll({layerType:b},A))}}),paint:D=>Oo({layer:l,key:D.key,value:D.value,valueSpec:{},style:D.style,styleSpec:D.styleSpec,objectElementValidators:{"*":A=>ui(Ll({layerType:b},A))}})}})),o}function Hu(a){const o=a.value,l=a.key,h=Xi(o);return"string"!==h?[new Jt(l,o,`string expected, ${h} found`)]:[]}const $_={promoteId:function({key:a,value:o}){if("string"===Xi(o))return Hu({key:a,value:o});{const l=[];for(const h in o)l.push(...Hu({key:`${a}.${h}`,value:o[h]}));return l}}};function nf(a){const o=a.value,l=a.key,h=a.styleSpec,f=a.style;if(!o.type)return[new Jt(l,o,'"type" is required')];const v=ps(o.type);let b;switch(v){case"vector":case"raster":case"raster-dem":return b=Oo({key:l,value:o,valueSpec:h[`source_${v.replace("-","_")}`],style:a.style,styleSpec:h,objectElementValidators:$_}),b;case"geojson":if(b=Oo({key:l,value:o,valueSpec:h.source_geojson,style:f,styleSpec:h,objectElementValidators:$_}),o.cluster)for(const C in o.clusterProperties){const[D,A]=o.clusterProperties[C],L="string"==typeof D?[D,["accumulated"],["get",C]]:D;b.push(...lc({key:`${l}.${C}.map`,value:A,expressionContext:"cluster-map"})),b.push(...lc({key:`${l}.${C}.reduce`,value:L,expressionContext:"cluster-reduce"}))}return b;case"video":return Oo({key:l,value:o,valueSpec:h.source_video,style:f,styleSpec:h});case"image":return Oo({key:l,value:o,valueSpec:h.source_image,style:f,styleSpec:h});case"canvas":return[new Jt(l,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Yp({key:`${l}.type`,value:o.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:f,styleSpec:h})}}function Rd(a){const o=a.value,l=a.styleSpec,h=l.light,f=a.style;let v=[];const b=Xi(o);if(void 0===o)return v;if("object"!==b)return v=v.concat([new Jt("light",o,`object expected, ${b} found`)]),v;for(const C in o){const D=C.match(/^(.*)-transition$/);v=v.concat(D&&h[D[1]]&&h[D[1]].transition?ai({key:C,value:o[C],valueSpec:l.transition,style:f,styleSpec:l}):h[C]?ai({key:C,value:o[C],valueSpec:h[C],style:f,styleSpec:l}):[new Jt(C,o[C],`unknown property "${C}"`)])}return v}function Bm(a){const o=a.value,l=a.key,h=a.style,f=a.styleSpec,v=f.terrain;let b=[];const C=Xi(o);if(void 0===o)return b;if("object"!==C)return b=b.concat([new Jt("terrain",o,`object expected, ${C} found`)]),b;for(const D in o){const A=D.match(/^(.*)-transition$/);b=b.concat(A&&v[A[1]]&&v[A[1]].transition?ai({key:D,value:o[D],valueSpec:f.transition,style:h,styleSpec:f}):v[D]?ai({key:D,value:o[D],valueSpec:v[D],style:h,styleSpec:f}):[new Jt(D,o[D],`unknown property "${D}"`)])}if(o.source){const D=h.sources&&h.sources[o.source],A=D&&ps(D.type);D?"raster-dem"!==A&&b.push(new Jt(l,o.source,`terrain cannot be used with a source of type ${String(A)}, it only be used with a "raster-dem" source type`)):b.push(new Jt(l,o.source,`source "${o.source}" not found`))}else b.push(new Jt(l,o,'terrain is missing required property "source"'));return b}function W_(a){const o=a.value,l=a.style,h=a.styleSpec,f=h.fog;let v=[];const b=Xi(o);if(void 0===o)return v;if("object"!==b)return v=v.concat([new Jt("fog",o,`object expected, ${b} found`)]),v;for(const C in o){const D=C.match(/^(.*)-transition$/);v=v.concat(D&&f[D[1]]&&f[D[1]].transition?ai({key:C,value:o[C],valueSpec:h.transition,style:l,styleSpec:h}):f[C]?ai({key:C,value:o[C],valueSpec:f[C],style:l,styleSpec:h}):[new Jt(C,o[C],`unknown property "${C}"`)])}return v}const Rt={"*":()=>[],array:Om,boolean:function(a){const o=a.value,l=a.key,h=Xi(o);return"boolean"!==h?[new Jt(l,o,`boolean expected, ${h} found`)]:[]},number:ga,color:function(a){const o=a.key,l=a.value,h=Xi(l);return"string"!==h?[new Jt(o,l,`color expected, ${h} found`)]:null===Cd(l)?[new Jt(o,l,`color expected, "${l}" found`)]:[]},enum:Yp,filter:za,function:Vh,layer:j_,object:Oo,source:nf,light:Rd,terrain:Bm,fog:W_,string:Hu,formatted:function(a){return 0===Hu(a).length?[]:lc(a)},resolvedImage:function(a){return 0===Hu(a).length?[]:lc(a)},projection:function(a){const o=a.value,l=a.styleSpec,h=l.projection,f=a.style;let v=[];const b=Xi(o);if("object"===b)for(const C in o)v=v.concat(ai({key:C,value:o[C],valueSpec:h[C],style:f,styleSpec:l}));else"string"!==b&&(v=v.concat([new Jt("projection",o,`object or string expected, ${b} found`)]));return v}};function ai(a){const o=a.value,l=a.valueSpec,h=a.styleSpec;return l.expression&&$c(ps(o))?Vh(a):l.expression&&Nh(Vc(o))?lc(a):l.type&&Rt[l.type]?Rt[l.type](a):Oo(Ll({},a,{valueSpec:l.type?h[l.type]:l}))}function As(a){const o=a.value,l=a.key,h=Hu(a);return h.length||(-1===o.indexOf("{fontstack}")&&h.push(new Jt(l,o,'"glyphs" url must include a "{fontstack}" token')),-1===o.indexOf("{range}")&&h.push(new Jt(l,o,'"glyphs" url must include a "{range}" token'))),h}function Us(a,o=rt){return _a(ai({key:"",value:a,valueSpec:o.$root,styleSpec:o,style:a,objectElementValidators:{glyphs:As,"*":()=>[]}}))}const Is=a=>_a(ui(a)),q_=a=>_a(Nm(a));function _a(a){return a.slice().sort((o,l)=>o.line&&l.line?o.line-l.line:0)}function Va(a,o){let l=!1;if(o&&o.length)for(const h of o)a.fire(new zc(new Error(h.message))),l=!0;return l}var Wc=Ua;function Ua(a,o,l){var h=this.cells=[];if(a instanceof ArrayBuffer){this.arrayBuffer=a;var f=new Int32Array(this.arrayBuffer);a=f[0],this.d=(o=f[1])+2*(l=f[2]);for(var v=0;v<this.d*this.d;v++){var b=f[3+v],C=f[3+v+1];h.push(b===C?null:f.subarray(b,C))}var D=f[3+h.length+1];this.keys=f.subarray(f[3+h.length],D),this.bboxes=f.subarray(D),this.insert=this._insertReadonly}else{this.d=o+2*l;for(var A=0;A<this.d*this.d;A++)h.push([]);this.keys=[],this.bboxes=[]}this.n=o,this.extent=a,this.padding=l,this.scale=o/a,this.uid=0;var L=l/o*a;this.min=-L,this.max=a+L}Ua.prototype.insert=function(a,o,l,h,f){this._forEachCell(o,l,h,f,this._insertCell,this.uid++),this.keys.push(a),this.bboxes.push(o),this.bboxes.push(l),this.bboxes.push(h),this.bboxes.push(f)},Ua.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},Ua.prototype._insertCell=function(a,o,l,h,f,v){this.cells[f].push(v)},Ua.prototype.query=function(a,o,l,h,f){var v=this.min,b=this.max;if(a<=v&&o<=v&&b<=l&&b<=h&&!f)return Array.prototype.slice.call(this.keys);var C=[];return this._forEachCell(a,o,l,h,this._queryCell,C,{},f),C},Ua.prototype._queryCell=function(a,o,l,h,f,v,b,C){var D=this.cells[f];if(null!==D)for(var A=this.keys,L=this.bboxes,B=0;B<D.length;B++){var z=D[B];if(void 0===b[z]){var j=4*z;(C?C(L[j+0],L[j+1],L[j+2],L[j+3]):a<=L[j+2]&&o<=L[j+3]&&l>=L[j+0]&&h>=L[j+1])?(b[z]=!0,v.push(A[z])):b[z]=!1}}},Ua.prototype._forEachCell=function(a,o,l,h,f,v,b,C){for(var D=this._convertToCellCoord(a),A=this._convertToCellCoord(o),L=this._convertToCellCoord(l),B=this._convertToCellCoord(h),z=D;z<=L;z++)for(var j=A;j<=B;j++){var $=this.d*j+z;if((!C||C(this._convertFromCellCoord(z),this._convertFromCellCoord(j),this._convertFromCellCoord(z+1),this._convertFromCellCoord(j+1)))&&f.call(this,a,o,l,h,$,v,b,C))return}},Ua.prototype._convertFromCellCoord=function(a){return(a-this.padding)/this.scale},Ua.prototype._convertToCellCoord=function(a){return Math.max(0,Math.min(this.d-1,Math.floor(a*this.scale)+this.padding))},Ua.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var a=this.cells,o=3+this.cells.length+1+1,l=0,h=0;h<this.cells.length;h++)l+=this.cells[h].length;var f=new Int32Array(o+l+this.keys.length+this.bboxes.length);f[0]=this.extent,f[1]=this.n,f[2]=this.padding;for(var v=o,b=0;b<a.length;b++){var C=a[b];f[3+b]=v,f.set(C,v),v+=C.length}return f[3+a.length]=v,f.set(this.keys,v),f[3+a.length+1]=v+=this.keys.length,f.set(this.bboxes,v),v+=this.bboxes.length,f.buffer};const zm={};function tn(a,o,l={}){Object.defineProperty(a,"_classRegistryKey",{value:o,writeable:!1}),zm[o]={klass:a,omit:l.omit||[]}}tn(Object,"Object"),Wc.serialize=function(a,o){const l=a.toArrayBuffer();return o&&o.push(l),{buffer:l}},Wc.deserialize=function(a){return new Wc(a.buffer)},Object.defineProperty(Wc,"name",{value:"Grid"}),tn(Wc,"Grid"),tn(ms,"Color"),tn(Error,"Error"),tn(xh,"AJAXError"),tn(da,"ResolvedImage"),tn(Nl,"StylePropertyFunction"),tn(rl,"StyleExpression",{omit:["_evaluator"]}),tn(Zp,"ZoomDependentExpression"),tn(Bh,"ZoomConstantExpression"),tn(La,"CompoundExpression",{omit:["_evaluate"]});for(const a in Oh)zm[Oh[a]._classRegistryKey]||tn(Oh[a],`Expression${a}`);function I0(a){return a&&typeof ArrayBuffer<"u"&&(a instanceof ArrayBuffer||a.constructor&&"ArrayBuffer"===a.constructor.name)}function Vm(a){return lt.ImageBitmap&&a instanceof lt.ImageBitmap}function Ps(a,o){if(null==a||"boolean"==typeof a||"number"==typeof a||"string"==typeof a||a instanceof Boolean||a instanceof Number||a instanceof String||a instanceof Date||a instanceof RegExp)return a;if(I0(a)||Vm(a))return o&&o.push(a),a;if(ArrayBuffer.isView(a)){const l=a;return o&&o.push(l.buffer),l}if(a instanceof lt.ImageData)return o&&o.push(a.data.buffer),a;if(Array.isArray(a)){const l=[];for(const h of a)l.push(Ps(h,o));return l}if("object"==typeof a){const l=a.constructor,h=l._classRegistryKey;if(!h)throw new Error(`can't serialize object of unregistered class ${h}`);const f=l.serialize?l.serialize(a,o):{};if(!l.serialize){for(const v in a)a.hasOwnProperty(v)&&(zm[h].omit.indexOf(v)>=0||(f[v]=Ps(a[v],o)));a instanceof Error&&(f.message=a.message)}if(f.$name)throw new Error("$name property is reserved for worker serialization logic.");return"Object"!==h&&(f.$name=h),f}throw new Error("can't serialize object of type "+typeof a)}function po(a){if(null==a||"boolean"==typeof a||"number"==typeof a||"string"==typeof a||a instanceof Boolean||a instanceof Number||a instanceof String||a instanceof Date||a instanceof RegExp||I0(a)||Vm(a)||ArrayBuffer.isView(a)||a instanceof lt.ImageData)return a;if(Array.isArray(a))return a.map(po);if("object"==typeof a){const o=a.$name||"Object",{klass:l}=zm[o];if(!l)throw new Error(`can't deserialize unregistered class ${o}`);if(l.deserialize)return l.deserialize(a);const h=Object.create(l.prototype);for(const f of Object.keys(a))"$name"!==f&&(h[f]=po(a[f]));return h}throw new Error("can't deserialize object of type "+typeof a)}class Um{constructor(){this.first=!0}update(o,l){const h=Math.floor(o);return this.first?(this.first=!1,this.lastIntegerZoom=h,this.lastIntegerZoomTime=0,this.lastZoom=o,this.lastFloorZoom=h,!0):(this.lastFloorZoom>h?(this.lastIntegerZoom=h+1,this.lastIntegerZoomTime=l):this.lastFloorZoom<h&&(this.lastIntegerZoom=h,this.lastIntegerZoomTime=l),o!==this.lastZoom&&(this.lastZoom=o,this.lastFloorZoom=h,!0))}}const Gu=a=>a>=1536&&a<=1791,ya=a=>a>=1872&&a<=1919,Z_=a=>a>=2208&&a<=2303,rf=a=>a>=11904&&a<=12031,X_=a=>a>=12032&&a<=12255,Hm=a=>a>=12272&&a<=12287,ju=a=>a>=12288&&a<=12351,kd=a=>a>=12352&&a<=12447,Ld=a=>a>=12448&&a<=12543,Od=a=>a>=12544&&a<=12591,sf=a=>a>=12704&&a<=12735,Gm=a=>a>=12736&&a<=12783,af=a=>a>=12784&&a<=12799,lf=a=>a>=12800&&a<=13055,jm=a=>a>=13056&&a<=13311,$m=a=>a>=13312&&a<=19903,cf=a=>a>=19968&&a<=40959,Fd=a=>a>=40960&&a<=42127,Y_=a=>a>=42128&&a<=42191,K_=a=>a>=44032&&a<=55215,fo=a=>a>=63744&&a<=64255,Bl=a=>a>=64336&&a<=65023,ts=a=>a>=65040&&a<=65055,Uh=a=>a>=65072&&a<=65103,Hh=a=>a>=65104&&a<=65135,_=a=>a>=65136&&a<=65279,u=a=>a>=65280&&a<=65519;function p(a){for(const o of a)if(E(o.charCodeAt(0)))return!0;return!1}function x(a){for(const o of a)if(!M(o.charCodeAt(0)))return!1;return!0}function M(a){return!(Gu(a)||ya(a)||Z_(a)||Bl(a)||_(a))}function E(a){return!(746!==a&&747!==a&&(a<4352||!(sf(a)||Od(a)||Uh(a)&&!(a>=65097&&a<=65103)||fo(a)||jm(a)||rf(a)||Gm(a)||!(!ju(a)||a>=12296&&a<=12305||a>=12308&&a<=12319||12336===a)||$m(a)||cf(a)||lf(a)||(o=a,o>=12592&&o<=12687)||(o=>o>=43360&&o<=43391)(a)||(o=>o>=55216&&o<=55295)(a)||(o=>o>=4352&&o<=4607)(a)||K_(a)||kd(a)||Hm(a)||(o=>o>=12688&&o<=12703)(a)||X_(a)||af(a)||Ld(a)&&12540!==a||!(!u(a)||65288===a||65289===a||65293===a||a>=65306&&a<=65310||65339===a||65341===a||65343===a||a>=65371&&a<=65503||65507===a||a>=65512&&a<=65519)||!(!Hh(a)||a>=65112&&a<=65118||a>=65123&&a<=65126)||(o=>o>=5120&&o<=5759)(a)||(o=>o>=6320&&o<=6399)(a)||ts(a)||(o=>o>=19904&&o<=19967)(a)||Fd(a)||Y_(a))));var o}function P(a){return!(E(a)||(o=a,(l=o)>=128&&l<=255&&(167===o||169===o||174===o||177===o||188===o||189===o||190===o||215===o||247===o)||(l=>l>=8192&&l<=8303)(o)&&(8214===o||8224===o||8225===o||8240===o||8241===o||8251===o||8252===o||8258===o||8263===o||8264===o||8265===o||8273===o)||(l=>l>=8448&&l<=8527)(o)||(l=>l>=8528&&l<=8591)(o)||(l=>l>=8960&&l<=9215)(o)&&(o>=8960&&o<=8967||o>=8972&&o<=8991||o>=8996&&o<=9e3||9003===o||o>=9085&&o<=9114||o>=9150&&o<=9165||9167===o||o>=9169&&o<=9179||o>=9186&&o<=9215)||(l=>l>=9216&&l<=9279)(o)&&9251!==o||(l=>l>=9280&&l<=9311)(o)||(l=>l>=9312&&l<=9471)(o)||(l=>l>=9632&&l<=9727)(o)||(l=>l>=9728&&l<=9983)(o)&&!(o>=9754&&o<=9759)||(l=>l>=11008&&l<=11263)(o)&&(o>=11026&&o<=11055||o>=11088&&o<=11097||o>=11192&&o<=11243)||ju(o)||Ld(o)||(l=>l>=57344&&l<=63743)(o)||Uh(o)||Hh(o)||u(o)||8734===o||8756===o||8757===o||o>=9984&&o<=10087||o>=10102&&o<=10131||65532===o||65533===o));var o,l}function O(a){return a>=1424&&a<=2303||Bl(a)||_(a)}function N(a,o){return!(!o&&O(a)||a>=2304&&a<=3583||a>=3840&&a<=4255||(l=a,l>=6016&&l<=6143));var l}function U(a){for(const o of a)if(O(o.charCodeAt(0)))return!0;return!1}const H="deferred",Z="loading",Q="loaded";let oe=null,ie="unavailable",le=null;const re=function(a){a&&"string"==typeof a&&a.indexOf("NetworkError")>-1&&(ie="error"),oe&&oe(a)};function ne(){ue.fire(new pr("pluginStateChange",{pluginStatus:ie,pluginURL:le}))}const ue=new ec,se=function(){return ie},Me=function(){if(ie!==H||!le)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");ie=Z,ne(),le&&Tu({url:le},a=>{a?re(a):(ie=Q,ne())})},Se={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>ie===Q||null!=Se.applyArabicShaping,isLoading:()=>ie===Z,setState(a){ie=a.pluginStatus,le=a.pluginURL},isParsed:()=>null!=Se.applyArabicShaping&&null!=Se.processBidirectionalText&&null!=Se.processStyledBidirectionalText,getPluginURL:()=>le};class ge{constructor(o,l){this.zoom=o,l?(this.now=l.now,this.fadeDuration=l.fadeDuration,this.zoomHistory=l.zoomHistory,this.transition=l.transition,this.pitch=l.pitch):(this.now=0,this.fadeDuration=0,this.zoomHistory=new Um,this.transition={},this.pitch=0)}isSupportedScript(o){return function(l,h){for(const f of l)if(!N(f.charCodeAt(0),h))return!1;return!0}(o,Se.isLoaded())}crossFadingFactor(){return 0===this.fadeDuration?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const o=this.zoom,l=o-Math.floor(o),h=this.crossFadingFactor();return o>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:l+(1-l)*h}:{fromScale:.5,toScale:1,t:1-(1-h)*l}}}class De{constructor(o,l){this.property=o,this.value=l,this.expression=function(h,f){if($c(h))return new Nl(h,f);if(Nh(h)){const v=zh(h,f);if("error"===v.result)throw new Error(v.value.map(b=>`${b.key}: ${b.message}`).join(", "));return v.value}{let v=h;return"string"==typeof h&&"color"===f.type&&(v=ms.parse(h)),{kind:"constant",evaluate:()=>v}}}(void 0===l?o.specification.default:l,o.specification)}isDataDriven(){return"source"===this.expression.kind||"composite"===this.expression.kind}possiblyEvaluate(o,l,h){return this.property.possiblyEvaluate(this,o,l,h)}}class Ue{constructor(o){this.property=o,this.value=new De(o,void 0)}transitioned(o,l){return new je(this.property,this.value,l,ci({},o.transition,this.transition),o.now)}untransitioned(){return new je(this.property,this.value,null,{},0)}}class Ke{constructor(o){this._properties=o,this._values=Object.create(o.defaultTransitionablePropertyValues)}getValue(o){return ua(this._values[o].value.value)}setValue(o,l){this._values.hasOwnProperty(o)||(this._values[o]=new Ue(this._values[o].property)),this._values[o].value=new De(this._values[o].property,null===l?void 0:ua(l))}getTransition(o){return ua(this._values[o].transition)}setTransition(o,l){this._values.hasOwnProperty(o)||(this._values[o]=new Ue(this._values[o].property)),this._values[o].transition=ua(l)||void 0}serialize(){const o={};for(const l of Object.keys(this._values)){const h=this.getValue(l);void 0!==h&&(o[l]=h);const f=this.getTransition(l);void 0!==f&&(o[`${l}-transition`]=f)}return o}transitioned(o,l){const h=new St(this._properties);for(const f of Object.keys(this._values))h._values[f]=this._values[f].transitioned(o,l._values[f]);return h}untransitioned(){const o=new St(this._properties);for(const l of Object.keys(this._values))o._values[l]=this._values[l].untransitioned();return o}}class je{constructor(o,l,h,f,v){const b=f.delay||0,C=f.duration||0;v=v||0,this.property=o,this.value=l,this.begin=v+b,this.end=this.begin+C,o.specification.transition&&(f.delay||f.duration)&&(this.prior=h)}possiblyEvaluate(o,l,h){const f=o.now||0,v=this.value.possiblyEvaluate(o,l,h),b=this.prior;if(b){if(f>this.end)return this.prior=null,v;if(this.value.isDataDriven())return this.prior=null,v;if(f<this.begin)return b.possiblyEvaluate(o,l,h);{const C=(f-this.begin)/(this.end-this.begin);return this.property.interpolate(b.possiblyEvaluate(o,l,h),v,bu(C))}}return v}}class St{constructor(o){this._properties=o,this._values=Object.create(o.defaultTransitioningPropertyValues)}possiblyEvaluate(o,l,h){const f=new ht(this._properties);for(const v of Object.keys(this._values))f._values[v]=this._values[v].possiblyEvaluate(o,l,h);return f}hasTransition(){for(const o of Object.keys(this._values))if(this._values[o].prior)return!0;return!1}}class Ne{constructor(o){this._properties=o,this._values=Object.create(o.defaultPropertyValues)}getValue(o){return ua(this._values[o].value)}setValue(o,l){this._values[o]=new De(this._values[o].property,null===l?void 0:ua(l))}serialize(){const o={};for(const l of Object.keys(this._values)){const h=this.getValue(l);void 0!==h&&(o[l]=h)}return o}possiblyEvaluate(o,l,h){const f=new ht(this._properties);for(const v of Object.keys(this._values))f._values[v]=this._values[v].possiblyEvaluate(o,l,h);return f}}class pt{constructor(o,l,h){this.property=o,this.value=l,this.parameters=h}isConstant(){return"constant"===this.value.kind}constantOr(o){return"constant"===this.value.kind?this.value.value:o}evaluate(o,l,h,f){return this.property.evaluate(this.value,this.parameters,o,l,h,f)}}class ht{constructor(o){this._properties=o,this._values=Object.create(o.defaultPossiblyEvaluatedValues)}get(o){return this._values[o]}}class We{constructor(o){this.specification=o}possiblyEvaluate(o,l){return o.expression.evaluate(l)}interpolate(o,l,h){const f=an[this.specification.type];return f?f(o,l,h):o}}class Fe{constructor(o,l){this.specification=o,this.overrides=l}possiblyEvaluate(o,l,h,f){return new pt(this,"constant"===o.expression.kind||"camera"===o.expression.kind?{kind:"constant",value:o.expression.evaluate(l,null,{},h,f)}:o.expression,l)}interpolate(o,l,h){if("constant"!==o.value.kind||"constant"!==l.value.kind)return o;if(void 0===o.value.value||void 0===l.value.value)return new pt(this,{kind:"constant",value:void 0},o.parameters);const f=an[this.specification.type];return f?new pt(this,{kind:"constant",value:f(o.value.value,l.value.value,h)},o.parameters):o}evaluate(o,l,h,f,v,b){return"constant"===o.kind?o.value:o.evaluate(l,h,f,v,b)}}class $t extends Fe{possiblyEvaluate(o,l,h,f){if(void 0===o.value)return new pt(this,{kind:"constant",value:void 0},l);if("constant"===o.expression.kind){const v=o.expression.evaluate(l,null,{},h,f),b="resolvedImage"===o.property.specification.type&&"string"!=typeof v?v.name:v,C=this._calculate(b,b,b,l);return new pt(this,{kind:"constant",value:C},l)}if("camera"===o.expression.kind){const v=this._calculate(o.expression.evaluate({zoom:l.zoom-1}),o.expression.evaluate({zoom:l.zoom}),o.expression.evaluate({zoom:l.zoom+1}),l);return new pt(this,{kind:"constant",value:v},l)}return new pt(this,o.expression,l)}evaluate(o,l,h,f,v,b){if("source"===o.kind){const C=o.evaluate(l,h,f,v,b);return this._calculate(C,C,C,l)}return"composite"===o.kind?this._calculate(o.evaluate({zoom:Math.floor(l.zoom)-1},h,f),o.evaluate({zoom:Math.floor(l.zoom)},h,f),o.evaluate({zoom:Math.floor(l.zoom)+1},h,f),l):o.value}_calculate(o,l,h,f){return f.zoom>f.zoomHistory.lastIntegerZoom?{from:o,to:l,other:h}:{from:h,to:l,other:o}}interpolate(o){return o}}class Ft{constructor(o){this.specification=o}possiblyEvaluate(o,l,h,f){if(void 0!==o.value){if("constant"===o.expression.kind){const v=o.expression.evaluate(l,null,{},h,f);return this._calculate(v,v,v,l)}return this._calculate(o.expression.evaluate(new ge(Math.floor(l.zoom-1),l)),o.expression.evaluate(new ge(Math.floor(l.zoom),l)),o.expression.evaluate(new ge(Math.floor(l.zoom+1),l)),l)}}_calculate(o,l,h,f){return f.zoom>f.zoomHistory.lastIntegerZoom?{from:o,to:l}:{from:h,to:l}}interpolate(o){return o}}class kt{constructor(o){this.specification=o}possiblyEvaluate(o,l,h,f){return!!o.expression.evaluate(l,null,{},h,f)}interpolate(){return!1}}class Bt{constructor(o){this.properties=o,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const l=new ge(0,{});for(const h in o){const f=o[h];f.specification.overridable&&this.overridableProperties.push(h);const v=this.defaultPropertyValues[h]=new De(f,void 0),b=this.defaultTransitionablePropertyValues[h]=new Ue(f);this.defaultTransitioningPropertyValues[h]=b.untransitioned(),this.defaultPossiblyEvaluatedValues[h]=v.possiblyEvaluate(l)}}}function un(a,o){return 256*(a=Ei(Math.floor(a),0,255))+Ei(Math.floor(o),0,255)}tn(Fe,"DataDrivenProperty"),tn(We,"DataConstantProperty"),tn($t,"CrossFadedDataDrivenProperty"),tn(Ft,"CrossFadedProperty"),tn(kt,"ColorRampProperty");const Nn={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Tn{constructor(o,l){this._structArray=o,this._pos1=l*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class mn{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(o,l){return o._trim(),l&&(o.isTransferred=!0,l.push(o.arrayBuffer)),{length:o.length,arrayBuffer:o.arrayBuffer}}static deserialize(o){const l=Object.create(this.prototype);return l.arrayBuffer=o.arrayBuffer,l.length=o.length,l.capacity=o.arrayBuffer.byteLength/l.bytesPerElement,l._refreshViews(),l}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(o){this.reserve(o),this.length=o}reserve(o){if(o>this.capacity){this.capacity=Math.max(o,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const l=this.uint8;this._refreshViews(),l&&this.uint8.set(l)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function Lt(a,o=1){let l=0,h=0;return{members:a.map(f=>{const v=Nn[f.type].BYTES_PER_ELEMENT,b=l=qn(l,Math.max(o,v)),C=f.components||1;return h=Math.max(h,v),l+=v*C,{name:f.name,type:f.type,components:C,offset:b}}),size:qn(l,Math.max(h,o)),alignment:o}}function qn(a,o){return Math.ceil(a/o)*o}class di extends mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,l){const h=this.length;return this.resize(h+1),this.emplace(h,o,l)}emplace(o,l,h){const f=2*o;return this.int16[f+0]=l,this.int16[f+1]=h,o}}di.prototype.bytesPerElement=4,tn(di,"StructArrayLayout2i4");class ur extends mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,l,h){const f=this.length;return this.resize(f+1),this.emplace(f,o,l,h)}emplace(o,l,h,f){const v=3*o;return this.int16[v+0]=l,this.int16[v+1]=h,this.int16[v+2]=f,o}}ur.prototype.bytesPerElement=6,tn(ur,"StructArrayLayout3i6");class dr extends mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,l,h,f){const v=this.length;return this.resize(v+1),this.emplace(v,o,l,h,f)}emplace(o,l,h,f,v){const b=4*o;return this.int16[b+0]=l,this.int16[b+1]=h,this.int16[b+2]=f,this.int16[b+3]=v,o}}dr.prototype.bytesPerElement=8,tn(dr,"StructArrayLayout4i8");class Yi extends mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,l,h,f,v,b,C){const D=this.length;return this.resize(D+1),this.emplace(D,o,l,h,f,v,b,C)}emplace(o,l,h,f,v,b,C,D){const A=6*o,L=12*o,B=3*o;return this.int16[A+0]=l,this.int16[A+1]=h,this.uint8[L+4]=f,this.uint8[L+5]=v,this.uint8[L+6]=b,this.uint8[L+7]=C,this.float32[B+2]=D,o}}Yi.prototype.bytesPerElement=12,tn(Yi,"StructArrayLayout2i4ub1f12");class Rs extends mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,l,h,f){const v=this.length;return this.resize(v+1),this.emplace(v,o,l,h,f)}emplace(o,l,h,f,v){const b=4*o;return this.float32[b+0]=l,this.float32[b+1]=h,this.float32[b+2]=f,this.float32[b+3]=v,o}}Rs.prototype.bytesPerElement=16,tn(Rs,"StructArrayLayout4f16");class Hs extends mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o,l,h,f,v,b,C,D,A,L){const B=this.length;return this.resize(B+1),this.emplace(B,o,l,h,f,v,b,C,D,A,L)}emplace(o,l,h,f,v,b,C,D,A,L,B){const z=10*o;return this.uint16[z+0]=l,this.uint16[z+1]=h,this.uint16[z+2]=f,this.uint16[z+3]=v,this.uint16[z+4]=b,this.uint16[z+5]=C,this.uint16[z+6]=D,this.uint16[z+7]=A,this.uint16[z+8]=L,this.uint16[z+9]=B,o}}Hs.prototype.bytesPerElement=20,tn(Hs,"StructArrayLayout10ui20");class Yo extends mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o,l,h,f,v,b,C,D){const A=this.length;return this.resize(A+1),this.emplace(A,o,l,h,f,v,b,C,D)}emplace(o,l,h,f,v,b,C,D,A){const L=8*o;return this.uint16[L+0]=l,this.uint16[L+1]=h,this.uint16[L+2]=f,this.uint16[L+3]=v,this.uint16[L+4]=b,this.uint16[L+5]=C,this.uint16[L+6]=D,this.uint16[L+7]=A,o}}Yo.prototype.bytesPerElement=16,tn(Yo,"StructArrayLayout8ui16");class Rr extends mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,l,h,f,v,b){const C=this.length;return this.resize(C+1),this.emplace(C,o,l,h,f,v,b)}emplace(o,l,h,f,v,b,C){const D=6*o;return this.int16[D+0]=l,this.int16[D+1]=h,this.int16[D+2]=f,this.int16[D+3]=v,this.int16[D+4]=b,this.int16[D+5]=C,o}}Rr.prototype.bytesPerElement=12,tn(Rr,"StructArrayLayout6i12");class Gr extends mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o,l,h,f,v,b,C,D,A,L,B,z){const j=this.length;return this.resize(j+1),this.emplace(j,o,l,h,f,v,b,C,D,A,L,B,z)}emplace(o,l,h,f,v,b,C,D,A,L,B,z,j){const $=12*o;return this.int16[$+0]=l,this.int16[$+1]=h,this.int16[$+2]=f,this.int16[$+3]=v,this.uint16[$+4]=b,this.uint16[$+5]=C,this.uint16[$+6]=D,this.uint16[$+7]=A,this.int16[$+8]=L,this.int16[$+9]=B,this.int16[$+10]=z,this.int16[$+11]=j,o}}Gr.prototype.bytesPerElement=24,tn(Gr,"StructArrayLayout4i4ui4i24");class Hi extends mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,l,h,f,v,b){const C=this.length;return this.resize(C+1),this.emplace(C,o,l,h,f,v,b)}emplace(o,l,h,f,v,b,C){const D=10*o,A=5*o;return this.int16[D+0]=l,this.int16[D+1]=h,this.int16[D+2]=f,this.float32[A+2]=v,this.float32[A+3]=b,this.float32[A+4]=C,o}}Hi.prototype.bytesPerElement=20,tn(Hi,"StructArrayLayout3i3f20");class jr extends mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(o){const l=this.length;return this.resize(l+1),this.emplace(l,o)}emplace(o,l){return this.uint32[1*o+0]=l,o}}jr.prototype.bytesPerElement=4,tn(jr,"StructArrayLayout1ul4");class mo extends mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o,l,h,f,v,b,C,D,A,L,B,z,j){const $=this.length;return this.resize($+1),this.emplace($,o,l,h,f,v,b,C,D,A,L,B,z,j)}emplace(o,l,h,f,v,b,C,D,A,L,B,z,j,$){const Y=20*o,te=10*o;return this.int16[Y+0]=l,this.int16[Y+1]=h,this.int16[Y+2]=f,this.int16[Y+3]=v,this.int16[Y+4]=b,this.float32[te+3]=C,this.float32[te+4]=D,this.float32[te+5]=A,this.float32[te+6]=L,this.int16[Y+14]=B,this.uint32[te+8]=z,this.uint16[Y+18]=j,this.uint16[Y+19]=$,o}}mo.prototype.bytesPerElement=40,tn(mo,"StructArrayLayout5i4f1i1ul2ui40");class hi extends mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,l,h,f,v,b,C){const D=this.length;return this.resize(D+1),this.emplace(D,o,l,h,f,v,b,C)}emplace(o,l,h,f,v,b,C,D){const A=8*o;return this.int16[A+0]=l,this.int16[A+1]=h,this.int16[A+2]=f,this.int16[A+4]=v,this.int16[A+5]=b,this.int16[A+6]=C,this.int16[A+7]=D,o}}hi.prototype.bytesPerElement=16,tn(hi,"StructArrayLayout3i2i2i16");class go extends mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,l,h,f,v){const b=this.length;return this.resize(b+1),this.emplace(b,o,l,h,f,v)}emplace(o,l,h,f,v,b){const C=4*o,D=8*o;return this.float32[C+0]=l,this.float32[C+1]=h,this.float32[C+2]=f,this.int16[D+6]=v,this.int16[D+7]=b,o}}go.prototype.bytesPerElement=16,tn(go,"StructArrayLayout2f1f2i16");class $u extends mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,l,h,f){const v=this.length;return this.resize(v+1),this.emplace(v,o,l,h,f)}emplace(o,l,h,f,v){const b=12*o,C=3*o;return this.uint8[b+0]=l,this.uint8[b+1]=h,this.float32[C+1]=f,this.float32[C+2]=v,o}}$u.prototype.bytesPerElement=12,tn($u,"StructArrayLayout2ub2f12");class Ha extends mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,l,h){const f=this.length;return this.resize(f+1),this.emplace(f,o,l,h)}emplace(o,l,h,f){const v=3*o;return this.float32[v+0]=l,this.float32[v+1]=h,this.float32[v+2]=f,o}}Ha.prototype.bytesPerElement=12,tn(Ha,"StructArrayLayout3f12");class ns extends mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o,l,h){const f=this.length;return this.resize(f+1),this.emplace(f,o,l,h)}emplace(o,l,h,f){const v=3*o;return this.uint16[v+0]=l,this.uint16[v+1]=h,this.uint16[v+2]=f,o}}ns.prototype.bytesPerElement=6,tn(ns,"StructArrayLayout3ui6");class sl extends mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(o,l,h,f,v,b,C,D,A,L,B,z,j,$,Y,te,me,Ce,fe,be,Pe){const Te=this.length;return this.resize(Te+1),this.emplace(Te,o,l,h,f,v,b,C,D,A,L,B,z,j,$,Y,te,me,Ce,fe,be,Pe)}emplace(o,l,h,f,v,b,C,D,A,L,B,z,j,$,Y,te,me,Ce,fe,be,Pe,Te){const Ze=30*o,$e=15*o,ct=60*o;return this.int16[Ze+0]=l,this.int16[Ze+1]=h,this.int16[Ze+2]=f,this.float32[$e+2]=v,this.float32[$e+3]=b,this.uint16[Ze+8]=C,this.uint16[Ze+9]=D,this.uint32[$e+5]=A,this.uint32[$e+6]=L,this.uint32[$e+7]=B,this.uint16[Ze+16]=z,this.uint16[Ze+17]=j,this.uint16[Ze+18]=$,this.float32[$e+10]=Y,this.float32[$e+11]=te,this.uint8[ct+48]=me,this.uint8[ct+49]=Ce,this.uint8[ct+50]=fe,this.uint32[$e+13]=be,this.int16[Ze+28]=Pe,this.uint8[ct+58]=Te,o}}sl.prototype.bytesPerElement=60,tn(sl,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class va extends mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(o,l,h,f,v,b,C,D,A,L,B,z,j,$,Y,te,me,Ce,fe,be,Pe,Te,Ze,$e,ct,Tt,Je,mt,yt,wt){const It=this.length;return this.resize(It+1),this.emplace(It,o,l,h,f,v,b,C,D,A,L,B,z,j,$,Y,te,me,Ce,fe,be,Pe,Te,Ze,$e,ct,Tt,Je,mt,yt,wt)}emplace(o,l,h,f,v,b,C,D,A,L,B,z,j,$,Y,te,me,Ce,fe,be,Pe,Te,Ze,$e,ct,Tt,Je,mt,yt,wt,It){const ut=38*o,nn=19*o;return this.int16[ut+0]=l,this.int16[ut+1]=h,this.int16[ut+2]=f,this.float32[nn+2]=v,this.float32[nn+3]=b,this.int16[ut+8]=C,this.int16[ut+9]=D,this.int16[ut+10]=A,this.int16[ut+11]=L,this.int16[ut+12]=B,this.int16[ut+13]=z,this.uint16[ut+14]=j,this.uint16[ut+15]=$,this.uint16[ut+16]=Y,this.uint16[ut+17]=te,this.uint16[ut+18]=me,this.uint16[ut+19]=Ce,this.uint16[ut+20]=fe,this.uint16[ut+21]=be,this.uint16[ut+22]=Pe,this.uint16[ut+23]=Te,this.uint16[ut+24]=Ze,this.uint16[ut+25]=$e,this.uint16[ut+26]=ct,this.uint16[ut+27]=Tt,this.uint16[ut+28]=Je,this.uint32[nn+15]=mt,this.float32[nn+16]=yt,this.float32[nn+17]=wt,this.float32[nn+18]=It,o}}va.prototype.bytesPerElement=76,tn(va,"StructArrayLayout3i2f6i15ui1ul3f76");class as extends mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o){const l=this.length;return this.resize(l+1),this.emplace(l,o)}emplace(o,l){return this.float32[1*o+0]=l,o}}as.prototype.bytesPerElement=4,tn(as,"StructArrayLayout1f4");class ol extends mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,l,h,f,v){const b=this.length;return this.resize(b+1),this.emplace(b,o,l,h,f,v)}emplace(o,l,h,f,v,b){const C=5*o;return this.float32[C+0]=l,this.float32[C+1]=h,this.float32[C+2]=f,this.float32[C+3]=v,this.float32[C+4]=b,o}}ol.prototype.bytesPerElement=20,tn(ol,"StructArrayLayout5f20");class zl extends mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o,l,h,f){const v=this.length;return this.resize(v+1),this.emplace(v,o,l,h,f)}emplace(o,l,h,f,v){const b=6*o;return this.uint32[3*o+0]=l,this.uint16[b+2]=h,this.uint16[b+3]=f,this.uint16[b+4]=v,o}}zl.prototype.bytesPerElement=12,tn(zl,"StructArrayLayout1ul3ui12");class _o extends mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o,l){const h=this.length;return this.resize(h+1),this.emplace(h,o,l)}emplace(o,l,h){const f=2*o;return this.uint16[f+0]=l,this.uint16[f+1]=h,o}}_o.prototype.bytesPerElement=4,tn(_o,"StructArrayLayout2ui4");class Q_ extends mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o){const l=this.length;return this.resize(l+1),this.emplace(l,o)}emplace(o,l){return this.uint16[1*o+0]=l,o}}Q_.prototype.bytesPerElement=2,tn(Q_,"StructArrayLayout1ui2");class J_ extends mn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,l){const h=this.length;return this.resize(h+1),this.emplace(h,o,l)}emplace(o,l,h){const f=2*o;return this.float32[f+0]=l,this.float32[f+1]=h,o}}J_.prototype.bytesPerElement=8,tn(J_,"StructArrayLayout2f8");class Vt extends Tn{get a_pos_30(){return this._structArray.int16[this._pos2+0]}get a_pos_31(){return this._structArray.int16[this._pos2+1]}get a_pos_32(){return this._structArray.int16[this._pos2+2]}get a_pos_normal_30(){return this._structArray.int16[this._pos2+3]}get a_pos_normal_31(){return this._structArray.int16[this._pos2+4]}get a_pos_normal_32(){return this._structArray.int16[this._pos2+5]}}Vt.prototype.size=12;class HE extends Rr{get(o){return new Vt(this,o)}}tn(HE,"FillExtrusionExtArray");class GE extends Tn{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}GE.prototype.size=40;class Gw extends mo{get(o){return new GE(this,o)}}tn(Gw,"CollisionBoxArray");class jE extends Tn{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(o){this._structArray.uint8[this._pos1+49]=o}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(o){this._structArray.uint8[this._pos1+50]=o}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(o){this._structArray.uint32[this._pos4+13]=o}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(o){this._structArray.uint8[this._pos1+58]=o}}jE.prototype.size=60;class $E extends sl{get(o){return new jE(this,o)}}tn($E,"PlacedSymbolArray");class WE extends Tn{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+11]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+13]}get key(){return this._structArray.uint16[this._pos2+14]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+17]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+19]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+21]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+22]}get featureIndex(){return this._structArray.uint16[this._pos2+23]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+25]}get numIconVertices(){return this._structArray.uint16[this._pos2+26]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+27]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+28]}get crossTileID(){return this._structArray.uint32[this._pos4+15]}set crossTileID(o){this._structArray.uint32[this._pos4+15]=o}get textOffset0(){return this._structArray.float32[this._pos4+16]}get textOffset1(){return this._structArray.float32[this._pos4+17]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+18]}}WE.prototype.size=76;class qE extends va{get(o){return new WE(this,o)}}tn(qE,"SymbolInstanceArray");class uf extends as{getoffsetX(o){return this.float32[1*o+0]}}tn(uf,"GlyphOffsetArray");class ZE extends ur{getx(o){return this.int16[3*o+0]}gety(o){return this.int16[3*o+1]}gettileUnitDistanceFromAnchor(o){return this.int16[3*o+2]}}tn(ZE,"SymbolLineVertexArray");class XE extends Tn{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}XE.prototype.size=12;class Gs extends zl{get(o){return new XE(this,o)}}tn(Gs,"FeatureIndexArray");class ey extends Tn{get a_centroid_pos0(){return this._structArray.uint16[this._pos2+0]}get a_centroid_pos1(){return this._structArray.uint16[this._pos2+1]}}ey.prototype.size=4;class df extends _o{get(o){return new ey(this,o)}}tn(df,"FillExtrusionCentroidArray");class YE extends Tn{get a_pos_30(){return this._structArray.int16[this._pos2+0]}get a_pos_31(){return this._structArray.int16[this._pos2+1]}get a_pos_32(){return this._structArray.int16[this._pos2+2]}get a_pos_normal_30(){return this._structArray.int16[this._pos2+3]}get a_pos_normal_31(){return this._structArray.int16[this._pos2+4]}get a_pos_normal_32(){return this._structArray.int16[this._pos2+5]}}YE.prototype.size=12;class jw extends Rr{get(o){return new YE(this,o)}}tn(jw,"CircleGlobeExtArray");const al=Lt([{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"}]),Wu=Lt([{name:"a_dash_to",components:4,type:"Uint16"},{name:"a_dash_from",components:4,type:"Uint16"}]);var Gh={exports:{}},P0=function(a,o){var l,h,f,v,b,C,D,A;for(h=a.length-(l=3&a.length),f=o,b=3432918353,C=461845907,A=0;A<h;)D=255&a.charCodeAt(A)|(255&a.charCodeAt(++A))<<8|(255&a.charCodeAt(++A))<<16|(255&a.charCodeAt(++A))<<24,++A,f=27492+(65535&(v=5*(65535&(f=(f^=D=(65535&(D=(D=(65535&D)*b+(((D>>>16)*b&65535)<<16)&4294967295)<<15|D>>>17))*C+(((D>>>16)*C&65535)<<16)&4294967295)<<13|f>>>19))+((5*(f>>>16)&65535)<<16)&4294967295))+((58964+(v>>>16)&65535)<<16);switch(D=0,l){case 3:D^=(255&a.charCodeAt(A+2))<<16;case 2:D^=(255&a.charCodeAt(A+1))<<8;case 1:f^=D=(65535&(D=(D=(65535&(D^=255&a.charCodeAt(A)))*b+(((D>>>16)*b&65535)<<16)&4294967295)<<15|D>>>17))*C+(((D>>>16)*C&65535)<<16)&4294967295}return f^=a.length,f=2246822507*(65535&(f^=f>>>16))+((2246822507*(f>>>16)&65535)<<16)&4294967295,f=3266489909*(65535&(f^=f>>>13))+((3266489909*(f>>>16)&65535)<<16)&4294967295,(f^=f>>>16)>>>0},KE=function(a,o){for(var l,h=a.length,f=o^h,v=0;h>=4;)l=1540483477*(65535&(l=255&a.charCodeAt(v)|(255&a.charCodeAt(++v))<<8|(255&a.charCodeAt(++v))<<16|(255&a.charCodeAt(++v))<<24))+((1540483477*(l>>>16)&65535)<<16),f=1540483477*(65535&f)+((1540483477*(f>>>16)&65535)<<16)^(l=1540483477*(65535&(l^=l>>>24))+((1540483477*(l>>>16)&65535)<<16)),h-=4,++v;switch(h){case 3:f^=(255&a.charCodeAt(v+2))<<16;case 2:f^=(255&a.charCodeAt(v+1))<<8;case 1:f=1540483477*(65535&(f^=255&a.charCodeAt(v)))+((1540483477*(f>>>16)&65535)<<16)}return f=1540483477*(65535&(f^=f>>>13))+((1540483477*(f>>>16)&65535)<<16),(f^=f>>>15)>>>0};Gh.exports=P0,Gh.exports.murmur3=P0,Gh.exports.murmur2=KE;class ty{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(o,l,h,f){this.ids.push(QE(o)),this.positions.push(l,h,f)}getPositions(o){const l=QE(o);let h=0,f=this.ids.length-1;for(;h<f;){const b=h+f>>1;this.ids[b]>=l?f=b:h=b+1}const v=[];for(;this.ids[h]===l;)v.push({index:this.positions[3*h],start:this.positions[3*h+1],end:this.positions[3*h+2]}),h++;return v}static serialize(o,l){const h=new Float64Array(o.ids),f=new Uint32Array(o.positions);return $w(h,f,0,h.length-1),l&&l.push(h.buffer,f.buffer),{ids:h,positions:f}}static deserialize(o){const l=new ty;return l.ids=o.ids,l.positions=o.positions,l.indexed=!0,l}}function QE(a){const o=+a;return!isNaN(o)&&Number.MIN_SAFE_INTEGER<=o&&o<=Number.MAX_SAFE_INTEGER?o:Gh.exports(String(a))}function $w(a,o,l,h){for(;l<h;){const f=a[l+h>>1];let v=l-1,b=h+1;for(;;){do{v++}while(a[v]<f);do{b--}while(a[b]>f);if(v>=b)break;qm(a,v,b),qm(o,3*v,3*b),qm(o,3*v+1,3*b+1),qm(o,3*v+2,3*b+2)}b-l<h-b?($w(a,o,l,b),l=b+1):($w(a,o,b+1,h),h=b)}}function qm(a,o,l){const h=a[o];a[o]=a[l],a[l]=h}tn(ty,"FeaturePositionMap");class ks{constructor(o){this.gl=o.gl,this.initialized=!1}fetchUniformLocation(o,l){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(o,l),this.initialized=!0),!!this.location}}class pf extends ks{constructor(o){super(o),this.current=0}set(o,l,h){this.fetchUniformLocation(o,l)&&this.current!==h&&(this.current=h,this.gl.uniform1f(this.location,h))}}class jh extends ks{constructor(o){super(o),this.current=[0,0,0,0]}set(o,l,h){this.fetchUniformLocation(o,l)&&(h[0]===this.current[0]&&h[1]===this.current[1]&&h[2]===this.current[2]&&h[3]===this.current[3]||(this.current=h,this.gl.uniform4f(this.location,h[0],h[1],h[2],h[3])))}}class JE extends ks{constructor(o){super(o),this.current=ms.transparent}set(o,l,h){this.fetchUniformLocation(o,l)&&(h.r===this.current.r&&h.g===this.current.g&&h.b===this.current.b&&h.a===this.current.a||(this.current=h,this.gl.uniform4f(this.location,h.r,h.g,h.b,h.a)))}}const Ww=new Float32Array(16),eT=new Float32Array(9),tT=new Float32Array(4);function R0(a){return[un(255*a.r,255*a.g),un(255*a.b,255*a.a)]}class Zm{constructor(o,l,h){this.value=o,this.uniformNames=l.map(f=>`u_${f}`),this.type=h}setUniform(o,l,h,f,v){l.set(o,v,f.constantOr(this.value))}getBinding(o,l){return"color"===this.type?new JE(o):new pf(o)}}class ff{constructor(o,l){this.uniformNames=l.map(h=>`u_${h}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(o,l){this.pixelRatioFrom=l.pixelRatio||1,this.pixelRatioTo=o.pixelRatio||1,this.patternFrom=l.tl.concat(l.br),this.patternTo=o.tl.concat(o.br)}setUniform(o,l,h,f,v){const b="u_pattern_to"===v||"u_dash_to"===v?this.patternTo:"u_pattern_from"===v||"u_dash_from"===v?this.patternFrom:"u_pixel_ratio_to"===v?this.pixelRatioTo:"u_pixel_ratio_from"===v?this.pixelRatioFrom:null;b&&l.set(o,v,b)}getBinding(o,l){return"u_pattern_from"===l||"u_pattern_to"===l||"u_dash_from"===l||"u_dash_to"===l?new jh(o):new pf(o)}}class qu{constructor(o,l,h,f){this.expression=o,this.type=h,this.maxValue=0,this.paintVertexAttributes=l.map(v=>({name:`a_${v}`,type:"Float32",components:"color"===h?2:1,offset:0})),this.paintVertexArray=new f}populatePaintArray(o,l,h,f,v,b){const C=this.paintVertexArray.length,D=this.expression.evaluate(new ge(0),l,{},v,f,b);this.paintVertexArray.resize(o),this._setPaintValue(C,o,D)}updatePaintArray(o,l,h,f,v){const b=this.expression.evaluate({zoom:0},h,f,void 0,v);this._setPaintValue(o,l,b)}_setPaintValue(o,l,h){if("color"===this.type){const f=R0(h);for(let v=o;v<l;v++)this.paintVertexArray.emplace(v,f[0],f[1])}else{for(let f=o;f<l;f++)this.paintVertexArray.emplace(f,h);this.maxValue=Math.max(this.maxValue,Math.abs(h))}}upload(o){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=o.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class ll{constructor(o,l,h,f,v,b){this.expression=o,this.uniformNames=l.map(C=>`u_${C}_t`),this.type=h,this.useIntegerZoom=f,this.zoom=v,this.maxValue=0,this.paintVertexAttributes=l.map(C=>({name:`a_${C}`,type:"Float32",components:"color"===h?4:2,offset:0})),this.paintVertexArray=new b}populatePaintArray(o,l,h,f,v,b){const C=this.expression.evaluate(new ge(this.zoom),l,{},v,f,b),D=this.expression.evaluate(new ge(this.zoom+1),l,{},v,f,b),A=this.paintVertexArray.length;this.paintVertexArray.resize(o),this._setPaintValue(A,o,C,D)}updatePaintArray(o,l,h,f,v){const b=this.expression.evaluate({zoom:this.zoom},h,f,void 0,v),C=this.expression.evaluate({zoom:this.zoom+1},h,f,void 0,v);this._setPaintValue(o,l,b,C)}_setPaintValue(o,l,h,f){if("color"===this.type){const v=R0(h),b=R0(f);for(let C=o;C<l;C++)this.paintVertexArray.emplace(C,v[0],v[1],b[0],b[1])}else{for(let v=o;v<l;v++)this.paintVertexArray.emplace(v,h,f);this.maxValue=Math.max(this.maxValue,Math.abs(h),Math.abs(f))}}upload(o){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=o.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(o,l,h,f,v){const b=this.useIntegerZoom?Math.floor(h.zoom):h.zoom,C=Ei(this.expression.interpolationFactor(b,this.zoom,this.zoom+1),0,1);l.set(o,v,C)}getBinding(o,l){return new pf(o)}}class uc{constructor(o,l,h,f,v,b,C){this.expression=o,this.type=h,this.useIntegerZoom=f,this.zoom=v,this.layerId=C,this.paintVertexAttributes=("array"===h?Wu:al).members;for(let D=0;D<l.length;++D);this.zoomInPaintVertexArray=new b,this.zoomOutPaintVertexArray=new b}populatePaintArray(o,l,h){const f=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(o),this.zoomOutPaintVertexArray.resize(o),this._setPaintValues(f,o,l.patterns&&l.patterns[this.layerId],h)}updatePaintArray(o,l,h,f,v,b){this._setPaintValues(o,l,h.patterns&&h.patterns[this.layerId],b)}_setPaintValues(o,l,h,f){if(!f||!h)return;const{min:v,mid:b,max:C}=h,D=f[v],A=f[b],L=f[C];if(D&&A&&L)for(let B=o;B<l;B++)this._setPaintValue(this.zoomInPaintVertexArray,B,A,D),this._setPaintValue(this.zoomOutPaintVertexArray,B,A,L)}_setPaintValue(o,l,h,f){o.emplace(l,h.tl[0],h.tl[1],h.br[0],h.br[1],f.tl[0],f.tl[1],f.br[0],f.br[1],h.pixelRatio,f.pixelRatio)}upload(o){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=o.createVertexBuffer(this.zoomInPaintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=o.createVertexBuffer(this.zoomOutPaintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class $h{constructor(o,l,h=(()=>!0)){this.binders={},this._buffers=[];const f=[];for(const v in o.paint._values){if(!h(v))continue;const b=o.paint.get(v);if(!(b instanceof pt&&Fh(b.property.specification)))continue;const C=ny(v,o.type),D=b.value,A=b.property.specification.type,L=b.property.useIntegerZoom,B=b.property.specification["property-type"],z="cross-faded"===B||"cross-faded-data-driven"===B,j="line-dasharray"===String(v)&&"constant"!==o.layout.get("line-cap").value.kind;if("constant"!==D.kind||j)if("source"===D.kind||j||z){const $=qw(v,A,"source");this.binders[v]=z?new uc(D,C,A,L,l,$,o.id):new qu(D,C,A,$),f.push(`/a_${v}`)}else{const $=qw(v,A,"composite");this.binders[v]=new ll(D,C,A,L,l,$),f.push(`/z_${v}`)}else this.binders[v]=z?new ff(D.value,C):new Zm(D.value,C,A),f.push(`/u_${v}`)}this.cacheKey=f.sort().join("")}getMaxValue(o){const l=this.binders[o];return l instanceof qu||l instanceof ll?l.maxValue:0}populatePaintArrays(o,l,h,f,v,b){for(const C in this.binders){const D=this.binders[C];(D instanceof qu||D instanceof ll||D instanceof uc)&&D.populatePaintArray(o,l,h,f,v,b)}}setConstantPatternPositions(o,l){for(const h in this.binders){const f=this.binders[h];f instanceof ff&&f.setConstantPatternPositions(o,l)}}updatePaintArrays(o,l,h,f,v,b){let C=!1;for(const D in o){const A=l.getPositions(D);for(const L of A){const B=h.feature(L.index);for(const z in this.binders){const j=this.binders[z];if((j instanceof qu||j instanceof ll||j instanceof uc)&&!0===j.expression.isStateDependent){const $=f.paint.get(z);j.expression=$.value,j.updatePaintArray(L.start,L.end,B,o[D],v,b),C=!0}}}}return C}defines(){const o=[];for(const l in this.binders){const h=this.binders[l];(h instanceof Zm||h instanceof ff)&&o.push(...h.uniformNames.map(f=>`#define HAS_UNIFORM_${f}`))}return o}getBinderAttributes(){const o=[];for(const l in this.binders){const h=this.binders[l];if(h instanceof qu||h instanceof ll||h instanceof uc)for(let f=0;f<h.paintVertexAttributes.length;f++)o.push(h.paintVertexAttributes[f].name)}return o}getBinderUniforms(){const o=[];for(const l in this.binders){const h=this.binders[l];if(h instanceof Zm||h instanceof ff||h instanceof ll)for(const f of h.uniformNames)o.push(f)}return o}getPaintVertexBuffers(){return this._buffers}getUniforms(o){const l=[];for(const h in this.binders){const f=this.binders[h];if(f instanceof Zm||f instanceof ff||f instanceof ll)for(const v of f.uniformNames)l.push({name:v,property:h,binding:f.getBinding(o,v)})}return l}setUniforms(o,l,h,f,v){for(const{name:b,property:C,binding:D}of h)this.binders[C].setUniform(o,D,v,f.get(C),b)}updatePaintBuffers(o){this._buffers=[];for(const l in this.binders){const h=this.binders[l];if(o&&h instanceof uc){const f=2===o.fromScale?h.zoomInPaintVertexBuffer:h.zoomOutPaintVertexBuffer;f&&this._buffers.push(f)}else(h instanceof qu||h instanceof ll)&&h.paintVertexBuffer&&this._buffers.push(h.paintVertexBuffer)}}upload(o){for(const l in this.binders){const h=this.binders[l];(h instanceof qu||h instanceof ll||h instanceof uc)&&h.upload(o)}this.updatePaintBuffers()}destroy(){for(const o in this.binders){const l=this.binders[o];(l instanceof qu||l instanceof ll||l instanceof uc)&&l.destroy()}}}class dc{constructor(o,l,h=(()=>!0)){this.programConfigurations={};for(const f of o)this.programConfigurations[f.id]=new $h(f,l,h);this.needsUpload=!1,this._featureMap=new ty,this._bufferOffset=0}populatePaintArrays(o,l,h,f,v,b,C){for(const D in this.programConfigurations)this.programConfigurations[D].populatePaintArrays(o,l,f,v,b,C);void 0!==l.id&&this._featureMap.add(l.id,h,this._bufferOffset,o),this._bufferOffset=o,this.needsUpload=!0}updatePaintArrays(o,l,h,f,v){for(const b of h)this.needsUpload=this.programConfigurations[b.id].updatePaintArrays(o,this._featureMap,l,b,f,v)||this.needsUpload}get(o){return this.programConfigurations[o]}upload(o){if(this.needsUpload){for(const l in this.programConfigurations)this.programConfigurations[l].upload(o);this.needsUpload=!1}}destroy(){for(const o in this.programConfigurations)this.programConfigurations[o].destroy()}}const k0={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"line-dasharray":["dash_to","dash_from"]};function ny(a,o){return k0[a]||[a.replace(`${o}-`,"").replace(/-/g,"_")]}const nT={"line-pattern":{source:Hs,composite:Hs},"fill-pattern":{source:Hs,composite:Hs},"fill-extrusion-pattern":{source:Hs,composite:Hs},"line-dasharray":{source:Yo,composite:Yo}},iT={color:{source:J_,composite:Rs},number:{source:as,composite:J_}};function qw(a,o,l){const h=nT[a];return h&&h[l]||iT[o][l]}tn(Zm,"ConstantBinder"),tn(ff,"CrossFadedConstantBinder"),tn(qu,"SourceExpressionBinder"),tn(uc,"CrossFadedCompositeBinder"),tn(ll,"CompositeExpressionBinder"),tn($h,"ProgramConfiguration",{omit:["_buffers"]}),tn(dc,"ProgramConfigurationSet");const Xm="-transition";class xa extends ec{constructor(o,l){if(super(),this.id=o.id,this.type=o.type,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,"custom"!==o.type&&(this.metadata=o.metadata,this.minzoom=o.minzoom,this.maxzoom=o.maxzoom,"background"!==o.type&&"sky"!==o.type&&(this.source=o.source,this.sourceLayer=o["source-layer"],this.filter=o.filter),l.layout&&(this._unevaluatedLayout=new Ne(l.layout)),l.paint)){this._transitionablePaint=new Ke(l.paint);for(const h in o.paint)this.setPaintProperty(h,o.paint[h],{validate:!1});for(const h in o.layout)this.setLayoutProperty(h,o.layout[h],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new ht(l.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(o){return"visibility"===o?this.visibility:this._unevaluatedLayout.getValue(o)}setLayoutProperty(o,l,h={}){null!=l&&this._validate(q_,`layers.${this.id}.layout.${o}`,o,l,h)||("visibility"!==o?this._unevaluatedLayout.setValue(o,l):this.visibility=l)}getPaintProperty(o){return ca(o,Xm)?this._transitionablePaint.getTransition(o.slice(0,-Xm.length)):this._transitionablePaint.getValue(o)}setPaintProperty(o,l,h={}){if(null!=l&&this._validate(Is,`layers.${this.id}.paint.${o}`,o,l,h))return!1;if(ca(o,Xm))return this._transitionablePaint.setTransition(o.slice(0,-Xm.length),l||void 0),!1;{const f=this._transitionablePaint._values[o],v="cross-faded-data-driven"===f.property.specification["property-type"],b=f.value.isDataDriven(),C=f.value;this._transitionablePaint.setValue(o,l),this._handleSpecialPaintPropertyUpdate(o);const D=this._transitionablePaint._values[o].value;return D.isDataDriven()||b||v||this._handleOverridablePaintPropertyUpdate(o,C,D)}}_handleSpecialPaintPropertyUpdate(o){}getProgramIds(){return null}getProgramConfiguration(o){return null}_handleOverridablePaintPropertyUpdate(o,l,h){return!1}isHidden(o){return!!(this.minzoom&&o<this.minzoom)||!!(this.maxzoom&&o>=this.maxzoom)||"none"===this.visibility}updateTransitions(o){this._transitioningPaint=this._transitionablePaint.transitioned(o,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(o,l){o.getCrossfadeParameters&&(this._crossfadeParameters=o.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(o,void 0,l)),this.paint=this._transitioningPaint.possiblyEvaluate(o,void 0,l)}serialize(){const o={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(o.layout=o.layout||{},o.layout.visibility=this.visibility),Pr(o,(l,h)=>!(void 0===l||"layout"===h&&!Object.keys(l).length||"paint"===h&&!Object.keys(l).length))}_validate(o,l,h,f,v={}){return(!v||!1!==v.validate)&&Va(this,o.call(Us,{key:l,layerType:this.type,objectKey:h,value:f,styleSpec:rt,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const o in this.paint._values){const l=this.paint.get(o);if(l instanceof pt&&Fh(l.property.specification)&&("source"===l.value.kind||"composite"===l.value.kind)&&l.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=es(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}}const mf=Lt([{name:"a_pos",components:2,type:"Int16"}],4),rT=Lt([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class Xe{constructor(o=[]){this.segments=o}prepareSegment(o,l,h,f){let v=this.segments[this.segments.length-1];return o>Xe.MAX_VERTEX_ARRAY_LENGTH&&Vr(`Max vertices per segment is ${Xe.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${o}`),(!v||v.vertexLength+o>Xe.MAX_VERTEX_ARRAY_LENGTH||v.sortKey!==f)&&(v={vertexOffset:l.length,primitiveOffset:h.length,vertexLength:0,primitiveLength:0},void 0!==f&&(v.sortKey=f),this.segments.push(v)),v}get(){return this.segments}destroy(){for(const o of this.segments)for(const l in o.vaos)o.vaos[l].destroy()}static simpleSegment(o,l,h,f){return new Xe([{vertexOffset:o,primitiveOffset:l,vertexLength:h,primitiveLength:f,vaos:{},sortKey:0}])}}Xe.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,tn(Xe,"SegmentVector");var Un=8192;class xr{constructor(o,l){o&&(l?this.setSouthWest(o).setNorthEast(l):4===o.length?this.setSouthWest([o[0],o[1]]).setNorthEast([o[2],o[3]]):this.setSouthWest(o[0]).setNorthEast(o[1]))}setNorthEast(o){return this._ne=o instanceof Ii?new Ii(o.lng,o.lat):Ii.convert(o),this}setSouthWest(o){return this._sw=o instanceof Ii?new Ii(o.lng,o.lat):Ii.convert(o),this}extend(o){const l=this._sw,h=this._ne;let f,v;if(o instanceof Ii)f=o,v=o;else{if(!(o instanceof xr))return Array.isArray(o)?4===o.length||o.every(Array.isArray)?this.extend(xr.convert(o)):this.extend(Ii.convert(o)):"object"==typeof o&&null!==o&&o.hasOwnProperty("lat")&&o.hasOwnProperty("lon")?this.extend(Ii.convert(o)):this;if(f=o._sw,v=o._ne,!f||!v)return this}return l||h?(l.lng=Math.min(f.lng,l.lng),l.lat=Math.min(f.lat,l.lat),h.lng=Math.max(v.lng,h.lng),h.lat=Math.max(v.lat,h.lat)):(this._sw=new Ii(f.lng,f.lat),this._ne=new Ii(v.lng,v.lat)),this}getCenter(){return new Ii((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new Ii(this.getWest(),this.getNorth())}getSouthEast(){return new Ii(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(o){const{lng:l,lat:h}=Ii.convert(o);let f=this._sw.lng<=l&&l<=this._ne.lng;return this._sw.lng>this._ne.lng&&(f=this._sw.lng>=l&&l>=this._ne.lng),this._sw.lat<=h&&h<=this._ne.lat&&f}static convert(o){return!o||o instanceof xr?o:new xr(o)}}const gf=6371008.8;class Ii{constructor(o,l){if(isNaN(o)||isNaN(l))throw new Error(`Invalid LngLat object: (${o}, ${l})`);if(this.lng=+o,this.lat=+l,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Ii(Wo(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(o){const l=Math.PI/180,h=this.lat*l,f=o.lat*l,v=Math.sin(h)*Math.sin(f)+Math.cos(h)*Math.cos(f)*Math.cos((o.lng-this.lng)*l);return gf*Math.acos(Math.min(v,1))}toBounds(o=0){const l=360*o/40075017,h=l/Math.cos(Math.PI/180*this.lat);return new xr(new Ii(this.lng-h,this.lat-l),new Ii(this.lng+h,this.lat+l))}static convert(o){if(o instanceof Ii)return o;if(Array.isArray(o)&&(2===o.length||3===o.length))return new Ii(Number(o[0]),Number(o[1]));if(!Array.isArray(o)&&"object"==typeof o&&null!==o)return new Ii(Number("lng"in o?o.lng:o.lon),Number(o.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const Zw=2*Math.PI*gf;function L0(a){return Zw*Math.cos(a*Math.PI/180)}function qc(a){return(180+a)/360}function Vl(a){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+a*Math.PI/360)))/360}function ls(a,o){return a/L0(o)}function Ga(a){return 360*a-180}function $r(a){return 360/Math.PI*Math.atan(Math.exp((180-360*a)*Math.PI/180))-90}function Xw(a,o){return a*L0($r(o))}const hc=85.051129;function _f(a){return 1/Math.cos(a*Math.PI/180)}class Zu{constructor(o,l,h=0){this.x=+o,this.y=+l,this.z=+h}static fromLngLat(o,l=0){const h=Ii.convert(o);return new Zu(qc(h.lng),Vl(h.lat),ls(l,h.lat))}toLngLat(){return new Ii(Ga(this.x),$r(this.y))}toAltitude(){return Xw(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/Zw*_f($r(this.y))}}function iy(a,o,l,h,f,v,b,C,D){const A=(o+h)/2,L=(l+f)/2,B=new Ht(A,L);C(B),function(z,j,$,Y,te,me){const Ce=$-te,fe=Y-me;return Math.abs((Y-j)*Ce-($-z)*fe)/Math.hypot(Ce,fe)}(B.x,B.y,v.x,v.y,b.x,b.y)>=D?(iy(a,o,l,A,L,v,B,C,D),iy(a,A,L,h,f,B,b,C,D)):a.push(b)}function Yw(a,o,l){let h=a[0],f=h.x,v=h.y;o(h);const b=[h];for(let C=1;C<a.length;C++){const D=a[C],{x:A,y:L}=D;o(D),iy(b,f,v,A,L,h,D,o,l),f=A,v=L,h=D}return b}function O0(a,o,l,h){if(h(o,l)){const f=o.add(l)._mult(.5);O0(a,o,f,h),O0(a,f,l,h)}else a.push(l)}function yf(a,o){let l=a[0];const h=[l];for(let f=1;f<a.length;f++){const v=a[f];O0(h,l,v,o),l=v}return h}const Wh=Math.pow(2,14)-1,Kw=-Wh-1;function oR(a,o){const l=Math.round(a.x*o),h=Math.round(a.y*o);return a.x=Ei(l,Kw,Wh),a.y=Ei(h,Kw,Wh),(l<a.x||l>a.x+1||h<a.y||h>a.y+1)&&Vr("Geometry exceeds allowed extent, reduce your vector tile buffer size"),a}function Zc(a,o,l){const h=a.loadGeometry(),f=a.extent,v=Un/f;if(o&&l&&l.projection.isReprojectedInTileSpace){const b=1<<o.z,{scale:C,x:D,y:A,projection:L}=l,B=z=>{const j=Ga((o.x+z.x/f)/b),$=$r((o.y+z.y/f)/b),Y=L.project(j,$);z.x=(Y.x*C-D)*f,z.y=(Y.y*C-A)*f};for(let z=0;z<h.length;z++)if(1!==a.type)h[z]=Yw(h[z],B,1);else{const j=[];for(const $ of h[z])$.x<0||$.x>=f||$.y<0||$.y>=f||(B($),j.push($));h[z]=j}}for(const b of h)for(const C of b)oR(C,v);return h}function qh(a,o){return{type:a.type,id:a.id,properties:a.properties,geometry:o?Zc(a):[]}}function F0(a,o,l,h,f){a.emplaceBack(2*o+(h+1)/2,2*l+(f+1)/2)}function ry(a,o,l){a.emplaceBack(o.x,o.y,o.z,16384*l[0],16384*l[1],16384*l[2])}class N0{constructor(o){this.zoom=o.zoom,this.overscaling=o.overscaling,this.layers=o.layers,this.layerIds=this.layers.map(l=>l.id),this.index=o.index,this.hasPattern=!1,this.projection=o.projection,this.layoutVertexArray=new di,this.indexArray=new ns,this.segments=new Xe,this.programConfigurations=new dc(o.layers,o.zoom),this.stateDependentLayerIds=this.layers.filter(l=>l.isStateDependent()).map(l=>l.id)}populate(o,l,h,f){const v=this.layers[0],b=[];let C=null;"circle"===v.type&&(C=v.layout.get("circle-sort-key"));for(const{feature:A,id:L,index:B,sourceLayerIndex:z}of o){const j=this.layers[0]._featureFilter.needGeometry,$=qh(A,j);if(!this.layers[0]._featureFilter.filter(new ge(this.zoom),$,h))continue;const Y=C?C.evaluate($,{},h):void 0,te={id:L,properties:A.properties,type:A.type,sourceLayerIndex:z,index:B,geometry:j?$.geometry:Zc(A,h,f),patterns:{},sortKey:Y};b.push(te)}C&&b.sort((A,L)=>A.sortKey-L.sortKey);let D=null;"globe"===f.projection.name&&(this.globeExtVertexArray=new jw,D=f.projection);for(const A of b){const{geometry:L,index:B,sourceLayerIndex:z}=A,j=o[B].feature;this.addFeature(A,L,B,l.availableImages,h,D),l.featureIndex.insert(j,L,B,z,this.index)}}update(o,l,h,f){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(o,l,this.stateDependentLayers,h,f)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(o){this.uploaded||(this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,mf.members),this.indexBuffer=o.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=o.createVertexBuffer(this.globeExtVertexArray,rT.members))),this.programConfigurations.upload(o),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(o,l,h,f,v,b){for(const C of l)for(const D of C){const A=D.x,L=D.y;if(A<0||A>=Un||L<0||L>=Un)continue;if(b){const j=b.projectTilePoint(A,L,v),$=b.upVector(v,A,L),Y=this.globeExtVertexArray;ry(Y,j,$),ry(Y,j,$),ry(Y,j,$),ry(Y,j,$)}const B=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,o.sortKey),z=B.vertexLength;F0(this.layoutVertexArray,A,L,-1,-1),F0(this.layoutVertexArray,A,L,1,-1),F0(this.layoutVertexArray,A,L,1,1),F0(this.layoutVertexArray,A,L,-1,1),this.indexArray.emplaceBack(z,z+1,z+2),this.indexArray.emplaceBack(z,z+2,z+3),B.vertexLength+=4,B.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,o,h,{},f,v)}}function Qw(a,o){for(let l=0;l<a.length;l++)if(Zh(o,a[l]))return!0;for(let l=0;l<o.length;l++)if(Zh(a,o[l]))return!0;return!!oy(a,o)}function sy(a,o,l){return!!Zh(a,o)||!!ay(o,a,l)}function B0(a,o){if(1===a.length)return ly(o,a[0]);for(let l=0;l<o.length;l++){const h=o[l];for(let f=0;f<h.length;f++)if(Zh(a,h[f]))return!0}for(let l=0;l<a.length;l++)if(ly(o,a[l]))return!0;for(let l=0;l<o.length;l++)if(oy(a,o[l]))return!0;return!1}function sT(a,o,l){if(a.length>1){if(oy(a,o))return!0;for(let h=0;h<o.length;h++)if(ay(o[h],a,l))return!0}for(let h=0;h<a.length;h++)if(ay(a[h],o,l))return!0;return!1}function oy(a,o){if(0===a.length||0===o.length)return!1;for(let l=0;l<a.length-1;l++){const h=a[l],f=a[l+1];for(let v=0;v<o.length-1;v++)if(aR(h,f,o[v],o[v+1]))return!0}return!1}function aR(a,o,l,h){return Rl(a,l,h)!==Rl(o,l,h)&&Rl(a,o,l)!==Rl(a,o,h)}function ay(a,o,l){const h=l*l;if(1===o.length)return a.distSqr(o[0])<h;for(let f=1;f<o.length;f++)if(oT(a,o[f-1],o[f])<h)return!0;return!1}function oT(a,o,l){const h=o.distSqr(l);if(0===h)return a.distSqr(o);const f=((a.x-o.x)*(l.x-o.x)+(a.y-o.y)*(l.y-o.y))/h;return a.distSqr(f<0?o:f>1?l:l.sub(o)._mult(f)._add(o))}function ly(a,o){let l,h,f,v=!1;for(let b=0;b<a.length;b++){l=a[b];for(let C=0,D=l.length-1;C<l.length;D=C++)h=l[C],f=l[D],h.y>o.y!=f.y>o.y&&o.x<(f.x-h.x)*(o.y-h.y)/(f.y-h.y)+h.x&&(v=!v)}return v}function Zh(a,o){let l=!1;for(let h=0,f=a.length-1;h<a.length;f=h++){const v=a[h],b=a[f];v.y>o.y!=b.y>o.y&&o.x<(b.x-v.x)*(o.y-v.y)/(b.y-v.y)+v.x&&(l=!l)}return l}function z0(a,o,l,h,f){for(const b of a)if(o<=b.x&&l<=b.y&&h>=b.x&&f>=b.y)return!0;const v=[new Ht(o,l),new Ht(o,f),new Ht(h,f),new Ht(h,l)];if(a.length>2)for(const b of v)if(Zh(a,b))return!0;for(let b=0;b<a.length-1;b++)if(cy(a[b],a[b+1],v))return!0;return!1}function cy(a,o,l){const h=l[0],f=l[2];if(a.x<h.x&&o.x<h.x||a.x>f.x&&o.x>f.x||a.y<h.y&&o.y<h.y||a.y>f.y&&o.y>f.y)return!1;const v=Rl(a,o,l[0]);return v!==Rl(a,o,l[1])||v!==Rl(a,o,l[2])||v!==Rl(a,o,l[3])}function Nd(a,o,l){const h=o.paint.get(a).value;return"constant"===h.kind?h.value:l.programConfigurations.get(o.id).getMaxValue(a)}function Xu(a){return Math.sqrt(a[0]*a[0]+a[1]*a[1])}function Jw(a,o,l,h,f){if(!o[0]&&!o[1])return a;const v=Ht.convert(o)._mult(f);"viewport"===l&&v._rotate(-h);const b=[];for(let C=0;C<a.length;C++)b.push(a[C].sub(v));return b}function e1(a,o,l,h){const f=Ht.convert(a)._mult(h);return"viewport"===o&&f._rotate(-l),f}tn(N0,"CircleBucket",{omit:["layers"]});const lR=new Bt({"circle-sort-key":new Fe(rt.layout_circle["circle-sort-key"])});var uy={paint:new Bt({"circle-radius":new Fe(rt.paint_circle["circle-radius"]),"circle-color":new Fe(rt.paint_circle["circle-color"]),"circle-blur":new Fe(rt.paint_circle["circle-blur"]),"circle-opacity":new Fe(rt.paint_circle["circle-opacity"]),"circle-translate":new We(rt.paint_circle["circle-translate"]),"circle-translate-anchor":new We(rt.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new We(rt.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new We(rt.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Fe(rt.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Fe(rt.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Fe(rt.paint_circle["circle-stroke-opacity"])}),layout:lR},vf=1e-6,ba=typeof Float32Array<"u"?Float32Array:Array;function V0(){var a=new ba(9);return ba!=Float32Array&&(a[1]=0,a[2]=0,a[3]=0,a[5]=0,a[6]=0,a[7]=0),a[0]=1,a[4]=1,a[8]=1,a}function U0(a,o,l){var h=o[0],f=o[1],v=o[2],b=o[3],C=o[4],D=o[5],A=o[6],L=o[7],B=o[8],z=l[0],j=l[1],$=l[2],Y=l[3],te=l[4],me=l[5],Ce=l[6],fe=l[7],be=l[8];return a[0]=z*h+j*b+$*A,a[1]=z*f+j*C+$*L,a[2]=z*v+j*D+$*B,a[3]=Y*h+te*b+me*A,a[4]=Y*f+te*C+me*L,a[5]=Y*v+te*D+me*B,a[6]=Ce*h+fe*b+be*A,a[7]=Ce*f+fe*C+be*L,a[8]=Ce*v+fe*D+be*B,a}function Ko(a){return a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=1,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=1,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a}function H0(a,o){var l=o[0],h=o[1],f=o[2],v=o[3],b=o[4],C=o[5],D=o[6],A=o[7],L=o[8],B=o[9],z=o[10],j=o[11],$=o[12],Y=o[13],te=o[14],me=o[15],Ce=l*C-h*b,fe=l*D-f*b,be=l*A-v*b,Pe=h*D-f*C,Te=h*A-v*C,Ze=f*A-v*D,$e=L*Y-B*$,ct=L*te-z*$,Tt=L*me-j*$,Je=B*te-z*Y,mt=B*me-j*Y,yt=z*me-j*te,wt=Ce*yt-fe*mt+be*Je+Pe*Tt-Te*ct+Ze*$e;return wt?(a[0]=(C*yt-D*mt+A*Je)*(wt=1/wt),a[1]=(f*mt-h*yt-v*Je)*wt,a[2]=(Y*Ze-te*Te+me*Pe)*wt,a[3]=(z*Te-B*Ze-j*Pe)*wt,a[4]=(D*Tt-b*yt-A*ct)*wt,a[5]=(l*yt-f*Tt+v*ct)*wt,a[6]=(te*be-$*Ze-me*fe)*wt,a[7]=(L*Ze-z*be+j*fe)*wt,a[8]=(b*mt-C*Tt+A*$e)*wt,a[9]=(h*Tt-l*mt-v*$e)*wt,a[10]=($*Te-Y*be+me*Ce)*wt,a[11]=(B*be-L*Te-j*Ce)*wt,a[12]=(C*ct-b*Je-D*$e)*wt,a[13]=(l*Je-h*ct+f*$e)*wt,a[14]=(Y*fe-$*Pe-te*Ce)*wt,a[15]=(L*Pe-B*fe+z*Ce)*wt,a):null}function xf(a,o,l){var h=o[0],f=o[1],v=o[2],b=o[3],C=o[4],D=o[5],A=o[6],L=o[7],B=o[8],z=o[9],j=o[10],$=o[11],Y=o[12],te=o[13],me=o[14],Ce=o[15],fe=l[0],be=l[1],Pe=l[2],Te=l[3];return a[0]=fe*h+be*C+Pe*B+Te*Y,a[1]=fe*f+be*D+Pe*z+Te*te,a[2]=fe*v+be*A+Pe*j+Te*me,a[3]=fe*b+be*L+Pe*$+Te*Ce,a[4]=(fe=l[4])*h+(be=l[5])*C+(Pe=l[6])*B+(Te=l[7])*Y,a[5]=fe*f+be*D+Pe*z+Te*te,a[6]=fe*v+be*A+Pe*j+Te*me,a[7]=fe*b+be*L+Pe*$+Te*Ce,a[8]=(fe=l[8])*h+(be=l[9])*C+(Pe=l[10])*B+(Te=l[11])*Y,a[9]=fe*f+be*D+Pe*z+Te*te,a[10]=fe*v+be*A+Pe*j+Te*me,a[11]=fe*b+be*L+Pe*$+Te*Ce,a[12]=(fe=l[12])*h+(be=l[13])*C+(Pe=l[14])*B+(Te=l[15])*Y,a[13]=fe*f+be*D+Pe*z+Te*te,a[14]=fe*v+be*A+Pe*j+Te*me,a[15]=fe*b+be*L+Pe*$+Te*Ce,a}function Ym(a,o,l){var h,f,v,b,C,D,A,L,B,z,j,$,Y=l[0],te=l[1],me=l[2];return o===a?(a[12]=o[0]*Y+o[4]*te+o[8]*me+o[12],a[13]=o[1]*Y+o[5]*te+o[9]*me+o[13],a[14]=o[2]*Y+o[6]*te+o[10]*me+o[14],a[15]=o[3]*Y+o[7]*te+o[11]*me+o[15]):(f=o[1],v=o[2],b=o[3],C=o[4],D=o[5],A=o[6],L=o[7],B=o[8],z=o[9],j=o[10],$=o[11],a[0]=h=o[0],a[1]=f,a[2]=v,a[3]=b,a[4]=C,a[5]=D,a[6]=A,a[7]=L,a[8]=B,a[9]=z,a[10]=j,a[11]=$,a[12]=h*Y+C*te+B*me+o[12],a[13]=f*Y+D*te+z*me+o[13],a[14]=v*Y+A*te+j*me+o[14],a[15]=b*Y+L*te+$*me+o[15]),a}function Xh(a,o,l){var h=l[0],f=l[1],v=l[2];return a[0]=o[0]*h,a[1]=o[1]*h,a[2]=o[2]*h,a[3]=o[3]*h,a[4]=o[4]*f,a[5]=o[5]*f,a[6]=o[6]*f,a[7]=o[7]*f,a[8]=o[8]*v,a[9]=o[9]*v,a[10]=o[10]*v,a[11]=o[11]*v,a[12]=o[12],a[13]=o[13],a[14]=o[14],a[15]=o[15],a}function G0(a,o,l){var h=Math.sin(l),f=Math.cos(l),v=o[4],b=o[5],C=o[6],D=o[7],A=o[8],L=o[9],B=o[10],z=o[11];return o!==a&&(a[0]=o[0],a[1]=o[1],a[2]=o[2],a[3]=o[3],a[12]=o[12],a[13]=o[13],a[14]=o[14],a[15]=o[15]),a[4]=v*f+A*h,a[5]=b*f+L*h,a[6]=C*f+B*h,a[7]=D*f+z*h,a[8]=A*f-v*h,a[9]=L*f-b*h,a[10]=B*f-C*h,a[11]=z*f-D*h,a}function Qo(a,o,l){var h=Math.sin(l),f=Math.cos(l),v=o[0],b=o[1],C=o[2],D=o[3],A=o[8],L=o[9],B=o[10],z=o[11];return o!==a&&(a[4]=o[4],a[5]=o[5],a[6]=o[6],a[7]=o[7],a[12]=o[12],a[13]=o[13],a[14]=o[14],a[15]=o[15]),a[0]=v*f-A*h,a[1]=b*f-L*h,a[2]=C*f-B*h,a[3]=D*f-z*h,a[8]=v*h+A*f,a[9]=b*h+L*f,a[10]=C*h+B*f,a[11]=D*h+z*f,a}function pc(a,o){return a[0]=o[0],a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=o[1],a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=o[2],a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a}function t1(a,o,l){var h,f,v,b=l[0],C=l[1],D=l[2],A=Math.hypot(b,C,D);return A<vf?null:(b*=A=1/A,C*=A,D*=A,h=Math.sin(o),f=Math.cos(o),a[0]=b*b*(v=1-f)+f,a[1]=C*b*v+D*h,a[2]=D*b*v-C*h,a[3]=0,a[4]=b*C*v-D*h,a[5]=C*C*v+f,a[6]=D*C*v+b*h,a[7]=0,a[8]=b*D*v+C*h,a[9]=C*D*v-b*h,a[10]=D*D*v+f,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a)}Math.hypot||(Math.hypot=function(){for(var a=0,o=arguments.length;o--;)a+=arguments[o]*arguments[o];return Math.sqrt(a)});var aT=xf;function j0(){var a=new ba(3);return ba!=Float32Array&&(a[0]=0,a[1]=0,a[2]=0),a}function n1(a){var o=new ba(3);return o[0]=a[0],o[1]=a[1],o[2]=a[2],o}function Km(a){return Math.hypot(a[0],a[1],a[2])}function bf(a,o,l){var h=new ba(3);return h[0]=a,h[1]=o,h[2]=l,h}function Xc(a,o,l){return a[0]=o[0]+l[0],a[1]=o[1]+l[1],a[2]=o[2]+l[2],a}function $0(a,o,l){return a[0]=o[0]-l[0],a[1]=o[1]-l[1],a[2]=o[2]-l[2],a}function r1(a,o,l){return a[0]=o[0]*l[0],a[1]=o[1]*l[1],a[2]=o[2]*l[2],a}function Qm(a,o,l){return a[0]=Math.min(o[0],l[0]),a[1]=Math.min(o[1],l[1]),a[2]=Math.min(o[2],l[2]),a}function Jm(a,o,l){return a[0]=Math.max(o[0],l[0]),a[1]=Math.max(o[1],l[1]),a[2]=Math.max(o[2],l[2]),a}function Jo(a,o,l){return a[0]=o[0]*l,a[1]=o[1]*l,a[2]=o[2]*l,a}function cl(a,o,l,h){return a[0]=o[0]+l[0]*h,a[1]=o[1]+l[1]*h,a[2]=o[2]+l[2]*h,a}function js(a,o){var l=o[0],h=o[1],f=o[2],v=l*l+h*h+f*f;return v>0&&(v=1/Math.sqrt(v)),a[0]=o[0]*v,a[1]=o[1]*v,a[2]=o[2]*v,a}function ul(a,o){return a[0]*o[0]+a[1]*o[1]+a[2]*o[2]}function dy(a,o,l){var h=o[0],f=o[1],v=o[2],b=l[0],C=l[1],D=l[2];return a[0]=f*D-v*C,a[1]=v*b-h*D,a[2]=h*C-f*b,a}function _s(a,o,l){var h=o[0],f=o[1],v=o[2],b=l[3]*h+l[7]*f+l[11]*v+l[15];return a[0]=(l[0]*h+l[4]*f+l[8]*v+l[12])/(b=b||1),a[1]=(l[1]*h+l[5]*f+l[9]*v+l[13])/b,a[2]=(l[2]*h+l[6]*f+l[10]*v+l[14])/b,a}function lT(a,o,l){var h=l[0],f=l[1],v=l[2],b=o[0],C=o[1],D=o[2],A=f*D-v*C,L=v*b-h*D,B=h*C-f*b,z=f*B-v*L,j=v*A-h*B,$=h*L-f*A,Y=2*l[3];return L*=Y,B*=Y,j*=2,$*=2,a[0]=b+(A*=Y)+(z*=2),a[1]=C+L+j,a[2]=D+B+$,a}var hy,Yc=$0,W0=r1,q0=Km;function cT(a,o,l){return a[0]=o[0]*l,a[1]=o[1]*l,a[2]=o[2]*l,a[3]=o[3]*l,a}function uT(a,o){var l=o[0],h=o[1],f=o[2],v=o[3],b=l*l+h*h+f*f+v*v;return b>0&&(b=1/Math.sqrt(b)),a[0]=l*b,a[1]=h*b,a[2]=f*b,a[3]=v*b,a}function Bd(a,o,l){var h=o[0],f=o[1],v=o[2],b=o[3];return a[0]=l[0]*h+l[4]*f+l[8]*v+l[12]*b,a[1]=l[1]*h+l[5]*f+l[9]*v+l[13]*b,a[2]=l[2]*h+l[6]*f+l[10]*v+l[14]*b,a[3]=l[3]*h+l[7]*f+l[11]*v+l[15]*b,a}function s1(){var a=new ba(4);return ba!=Float32Array&&(a[0]=0,a[1]=0,a[2]=0),a[3]=1,a}function o1(a){return a[0]=0,a[1]=0,a[2]=0,a[3]=1,a}function a1(a,o,l){l*=.5;var h=o[0],f=o[1],v=o[2],b=o[3],C=Math.sin(l),D=Math.cos(l);return a[0]=h*D+b*C,a[1]=f*D+v*C,a[2]=v*D-f*C,a[3]=b*D-h*C,a}function l1(a,o,l){l*=.5;var h=o[0],f=o[1],v=o[2],b=o[3],C=Math.sin(l),D=Math.cos(l);return a[0]=h*D-v*C,a[1]=f*D+b*C,a[2]=v*D+h*C,a[3]=b*D-f*C,a}j0(),hy=new ba(4),ba!=Float32Array&&(hy[0]=0,hy[1]=0,hy[2]=0,hy[3]=0);var c1=uT;j0(),bf(1,0,0),bf(0,1,0),s1(),s1(),V0();class wf{constructor(o,l){this.pos=o,this.dir=l}intersectsPlane(o,l,h){const f=ul(l,this.dir);if(Math.abs(f)<1e-6)return!1;const v=((o[0]-this.pos[0])*l[0]+(o[1]-this.pos[1])*l[1]+(o[2]-this.pos[2])*l[2])/f;return h[0]=this.pos[0]+this.dir[0]*v,h[1]=this.pos[1]+this.dir[1]*v,h[2]=this.pos[2]+this.dir[2]*v,!0}closestPointOnSphere(o,l,h){if(Y=(j=this.pos)[0],te=j[1],me=j[2],Ce=($=o)[0],fe=$[1],be=$[2],Math.abs(Y-Ce)<=vf*Math.max(1,Math.abs(Y),Math.abs(Ce))&&Math.abs(te-fe)<=vf*Math.max(1,Math.abs(te),Math.abs(fe))&&Math.abs(me-be)<=vf*Math.max(1,Math.abs(me),Math.abs(be))||0===l)return h[0]=h[1]=h[2]=0,!1;var j,$,Y,te,me,Ce,fe,be;const[f,v,b]=this.dir,C=this.pos[0]-o[0],D=this.pos[1]-o[1],A=this.pos[2]-o[2],L=f*f+v*v+b*b,B=2*(C*f+D*v+A*b),z=B*B-4*L*(C*C+D*D+A*A-l*l);if(z<0){const j=Math.max(-B/2,0),$=C+f*j,Y=D+v*j,te=A+b*j,me=Math.hypot($,Y,te);return h[0]=$*l/me,h[1]=Y*l/me,h[2]=te*l/me,!1}{const j=(-B-Math.sqrt(z))/(2*L);if(j<0){const $=Math.hypot(C,D,A);return h[0]=C*l/$,h[1]=D*l/$,h[2]=A*l/$,!1}return h[0]=C+f*j,h[1]=D+v*j,h[2]=A+b*j,!0}}}class py{constructor(o,l,h,f,v){this.TL=o,this.TR=l,this.BR=h,this.BL=f,this.horizon=v}static fromInvProjectionMatrix(o,l,h){const f=[-1,1,1],v=[1,1,1],b=[1,-1,1],C=[-1,-1,1],D=_s(f,f,o),A=_s(v,v,o),L=_s(b,b,o),B=_s(C,C,o);return new py(D,A,L,B,l/h)}}class eg{constructor(o,l){this.points=o,this.planes=l}static fromInvProjectionMatrix(o,l,h,f){const v=Math.pow(2,h),b=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(D=>{const A=Bd([],D,o),L=1/A[3]/l*v;return(B=A)[0]=(z=A)[0]*(j=[L,L,f?1/A[3]:L,L])[0],B[1]=z[1]*j[1],B[2]=z[2]*j[2],B[3]=z[3]*j[3],B;var B,z,j}),C=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(D=>{const A=js([],dy([],Yc([],b[D[0]],b[D[1]]),Yc([],b[D[2]],b[D[1]]))),L=-ul(A,b[D[1]]);return A.concat(L)});return new eg(b,C)}}class ea{static fromPoints(o){const l=[1/0,1/0,1/0],h=[-1/0,-1/0,-1/0];for(const f of o)Qm(l,l,f),Jm(h,h,f);return new ea(l,h)}static applyTransform(o,l){const h=o.getCorners();for(let f=0;f<h.length;++f)_s(h[f],h[f],l);return ea.fromPoints(h)}constructor(o,l){this.min=o,this.max=l,this.center=Jo([],Xc([],this.min,this.max),.5)}quadrant(o){const l=[o%2==0,o<2],h=n1(this.min),f=n1(this.max);for(let v=0;v<l.length;v++)h[v]=l[v]?this.min[v]:this.center[v],f[v]=l[v]?this.center[v]:this.max[v];return f[2]=this.max[2],new ea(h,f)}distanceX(o){return Math.max(Math.min(this.max[0],o[0]),this.min[0])-o[0]}distanceY(o){return Math.max(Math.min(this.max[1],o[1]),this.min[1])-o[1]}distanceZ(o){return Math.max(Math.min(this.max[2],o[2]),this.min[2])-o[2]}getCorners(){const o=this.min,l=this.max;return[[o[0],o[1],o[2]],[l[0],o[1],o[2]],[l[0],l[1],o[2]],[o[0],l[1],o[2]],[o[0],o[1],l[2]],[l[0],o[1],l[2]],[l[0],l[1],l[2]],[o[0],l[1],l[2]]]}intersects(o){const l=this.getCorners();let h=!0;for(let f=0;f<o.planes.length;f++){const v=o.planes[f];let b=0;for(let C=0;C<l.length;C++)b+=ul(v,l[C])+v[3]>=0;if(0===b)return 0;b!==l.length&&(h=!1)}if(h)return 2;for(let f=0;f<3;f++){let v=Number.MAX_VALUE,b=-Number.MAX_VALUE;for(let C=0;C<o.points.length;C++){const D=o.points[C][f]-this.min[f];v=Math.min(v,D),b=Math.max(b,D)}if(b<0||v>this.max[f]-this.min[f])return 0}return 1}}function br(a,o,l,h,f,v,b,C,D){if(v&&a.queryGeometry.isAboveHorizon)return!1;v&&(D*=a.pixelToTileUnitsFactor);const A=a.tileID.canonical,L=l.projection.upVectorScale(A,l.center.lat,l.worldSize).metersToTile;for(const B of o)for(const z of B){const j=z.add(C),$=f&&l.elevation?l.elevation.exaggeration()*f.getElevationAt(j.x,j.y,!0):0,Y=l.projection.projectTilePoint(j.x,j.y,A);if($>0){const fe=l.projection.upVector(A,j.x,j.y);Y.x+=fe[0]*L*$,Y.y+=fe[1]*L*$,Y.z+=fe[2]*L*$}const te=v?j:dT(Y.x,Y.y,Y.z,h),me=v?a.tilespaceRays.map(fe=>d1(fe,$)):a.queryGeometry.screenGeometry,Ce=Bd([],[Y.x,Y.y,Y.z,1],h);if(!b&&v?D*=Ce[3]/l.cameraToCenterDistance:b&&!v&&(D*=l.cameraToCenterDistance/Ce[3]),v){const fe=$r((z.y/Un+A.y)/(1<<A.z));D/=l.projection.pixelsPerMeter(fe,1)/ls(1,fe)}if(sy(me,te,D))return!0}return!1}function dT(a,o,l,h){const f=Bd([],[a,o,l,1],h);return new Ht(f[0]/f[3],f[1]/f[3])}const u1=bf(0,0,0),fy=bf(0,0,1);function d1(a,o){const l=j0();return u1[2]=o,a.intersectsPlane(u1,fy,l),new Ht(l[0],l[1])}class h1 extends N0{}function p1(a,{width:o,height:l},h,f){if(f){if(f instanceof Uint8ClampedArray)f=new Uint8Array(f.buffer);else if(f.length!==o*l*h)throw new RangeError("mismatched image size")}else f=new Uint8Array(o*l*h);return a.width=o,a.height=l,a.data=f,a}function f1(a,o,l){const{width:h,height:f}=o;h===a.width&&f===a.height||(Z0(a,o,{x:0,y:0},{x:0,y:0},{width:Math.min(a.width,h),height:Math.min(a.height,f)},l),a.width=h,a.height=f,a.data=o.data)}function Z0(a,o,l,h,f,v){if(0===f.width||0===f.height)return o;if(f.width>a.width||f.height>a.height||l.x>a.width-f.width||l.y>a.height-f.height)throw new RangeError("out of range source coordinates for image copy");if(f.width>o.width||f.height>o.height||h.x>o.width-f.width||h.y>o.height-f.height)throw new RangeError("out of range destination coordinates for image copy");const b=a.data,C=o.data;for(let D=0;D<f.height;D++){const A=((l.y+D)*a.width+l.x)*v,L=((h.y+D)*o.width+h.x)*v;for(let B=0;B<f.width*v;B++)C[L+B]=b[A+B]}return o}tn(h1,"HeatmapBucket",{omit:["layers"]});class Yu{constructor(o,l){p1(this,o,1,l)}resize(o){f1(this,new Yu(o),1)}clone(){return new Yu({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(o,l,h,f,v){Z0(o,l,h,f,v,1)}}class dl{constructor(o,l){p1(this,o,4,l)}resize(o){f1(this,new dl(o),4)}replace(o,l){l?this.data.set(o):this.data=o instanceof Uint8ClampedArray?new Uint8Array(o.buffer):o}clone(){return new dl({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(o,l,h,f,v){Z0(o,l,h,f,v,4)}}tn(Yu,"AlphaImage"),tn(dl,"RGBAImage");var cR={paint:new Bt({"heatmap-radius":new Fe(rt.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Fe(rt.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new We(rt.paint_heatmap["heatmap-intensity"]),"heatmap-color":new kt(rt.paint_heatmap["heatmap-color"]),"heatmap-opacity":new We(rt.paint_heatmap["heatmap-opacity"])})};function Yh(a){const o={},l=a.resolution||256,h=a.clips?a.clips.length:1,f=a.image||new dl({width:l,height:h}),v=(b,C,D)=>{o[a.evaluationKey]=D;const A=a.expression.evaluate(o);f.data[b+C+0]=Math.floor(255*A.r/A.a),f.data[b+C+1]=Math.floor(255*A.g/A.a),f.data[b+C+2]=Math.floor(255*A.b/A.a),f.data[b+C+3]=Math.floor(255*A.a)};if(a.clips)for(let b=0,C=0;b<h;++b,C+=4*l)for(let D=0,A=0;D<l;D++,A+=4){const L=D/(l-1),{start:B,end:z}=a.clips[b];v(C,A,B*(1-L)+z*L)}else for(let b=0,C=0;b<l;b++,C+=4)v(0,C,b/(l-1));return f}var X0={paint:new Bt({"hillshade-illumination-direction":new We(rt.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new We(rt.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new We(rt.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new We(rt.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new We(rt.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new We(rt.paint_hillshade["hillshade-accent-color"])})};const m1=Lt([{name:"a_pos",components:2,type:"Int16"}],4),{members:g1}=m1;var Mf={exports:{}};function my(a,o,l){l=l||2;var h,f,v,b,C,D,A,L=o&&o.length,B=L?o[0]*l:a.length,z=Y0(a,0,B,l,!0),j=[];if(!z||z.next===z.prev)return j;if(L&&(z=function(Y,te,me,Ce){var fe,be,Pe,Te=[];for(fe=0,be=te.length;fe<be;fe++)(Pe=Y0(Y,te[fe]*Ce,fe<be-1?te[fe+1]*Ce:Y.length,Ce,!1))===Pe.next&&(Pe.steiner=!0),Te.push(gy(Pe));for(Te.sort(y1),fe=0;fe<Te.length;fe++)me=Qh(Te[fe],me);return me}(a,o,z,l)),a.length>80*l){h=v=a[0],f=b=a[1];for(var $=l;$<B;$+=l)(C=a[$])<h&&(h=C),(D=a[$+1])<f&&(f=D),C>v&&(v=C),D>b&&(b=D);A=0!==(A=Math.max(v-h,b-f))?32767/A:0}return Kh(z,j,l,h,f,A,0),j}function Y0(a,o,l,h,f){var v,b;if(f===nx(a,o,l,h)>0)for(v=o;v<l;v+=h)b=Jh(v,a[v],a[v+1],b);else for(v=l-h;v>=o;v-=h)b=Jh(v,a[v],a[v+1],b);return b&&fc(b,b.next)&&(ig(b),b=b.next),b}function zd(a,o){if(!a)return a;o||(o=a);var l,h=a;do{if(l=!1,h.steiner||!fc(h,h.next)&&0!==Xr(h.prev,h,h.next))h=h.next;else{if(ig(h),(h=o=h.prev)===h.next)break;l=!0}}while(l||h!==o);return o}function Kh(a,o,l,h,f,v,b){if(a){!b&&v&&function(L,B,z,j){var $=L;do{0===$.z&&($.z=tg($.x,$.y,B,z,j)),$.prevZ=$.prev,$.nextZ=$.next,$=$.next}while($!==L);$.prevZ.nextZ=null,$.prevZ=null,function(Y){var te,me,Ce,fe,be,Pe,Te,Ze,$e=1;do{for(me=Y,Y=null,be=null,Pe=0;me;){for(Pe++,Ce=me,Te=0,te=0;te<$e&&(Te++,Ce=Ce.nextZ);te++);for(Ze=$e;Te>0||Ze>0&&Ce;)0!==Te&&(0===Ze||!Ce||me.z<=Ce.z)?(fe=me,me=me.nextZ,Te--):(fe=Ce,Ce=Ce.nextZ,Ze--),be?be.nextZ=fe:Y=fe,fe.prevZ=be,be=fe;me=Ce}be.nextZ=null,$e*=2}while(Pe>1)}($)}(a,h,f,v);for(var C,D,A=a;a.prev!==a.next;)if(C=a.prev,D=a.next,v?hT(a,h,f,v):uR(a))o.push(C.i/l|0),o.push(a.i/l|0),o.push(D.i/l|0),ig(a),a=D.next,A=D.next;else if((a=D)===A){b?1===b?Kh(a=K0(zd(a),o,l),o,l,h,f,v,2):2===b&&_1(a,o,l,h,f,v):Kh(zd(a),o,l,h,f,v,1);break}}}function uR(a){var o=a.prev,l=a,h=a.next;if(Xr(o,l,h)>=0)return!1;for(var f=o.x,v=l.x,b=h.x,C=o.y,D=l.y,A=h.y,L=f<v?f<b?f:b:v<b?v:b,B=C<D?C<A?C:A:D<A?D:A,z=f>v?f>b?f:b:v>b?v:b,j=C>D?C>A?C:A:D>A?D:A,$=h.next;$!==o;){if($.x>=L&&$.x<=z&&$.y>=B&&$.y<=j&&Cf(f,C,v,D,b,A,$.x,$.y)&&Xr($.prev,$,$.next)>=0)return!1;$=$.next}return!0}function hT(a,o,l,h){var f=a.prev,v=a,b=a.next;if(Xr(f,v,b)>=0)return!1;for(var C=f.x,D=v.x,A=b.x,L=f.y,B=v.y,z=b.y,j=C<D?C<A?C:A:D<A?D:A,$=L<B?L<z?L:z:B<z?B:z,Y=C>D?C>A?C:A:D>A?D:A,te=L>B?L>z?L:z:B>z?B:z,me=tg(j,$,o,l,h),Ce=tg(Y,te,o,l,h),fe=a.prevZ,be=a.nextZ;fe&&fe.z>=me&&be&&be.z<=Ce;){if(fe.x>=j&&fe.x<=Y&&fe.y>=$&&fe.y<=te&&fe!==f&&fe!==b&&Cf(C,L,D,B,A,z,fe.x,fe.y)&&Xr(fe.prev,fe,fe.next)>=0||(fe=fe.prevZ,be.x>=j&&be.x<=Y&&be.y>=$&&be.y<=te&&be!==f&&be!==b&&Cf(C,L,D,B,A,z,be.x,be.y)&&Xr(be.prev,be,be.next)>=0))return!1;be=be.nextZ}for(;fe&&fe.z>=me;){if(fe.x>=j&&fe.x<=Y&&fe.y>=$&&fe.y<=te&&fe!==f&&fe!==b&&Cf(C,L,D,B,A,z,fe.x,fe.y)&&Xr(fe.prev,fe,fe.next)>=0)return!1;fe=fe.prevZ}for(;be&&be.z<=Ce;){if(be.x>=j&&be.x<=Y&&be.y>=$&&be.y<=te&&be!==f&&be!==b&&Cf(C,L,D,B,A,z,be.x,be.y)&&Xr(be.prev,be,be.next)>=0)return!1;be=be.nextZ}return!0}function K0(a,o,l){var h=a;do{var f=h.prev,v=h.next.next;!fc(f,v)&&J0(f,h,h.next,v)&&ng(f,v)&&ng(v,f)&&(o.push(f.i/l|0),o.push(h.i/l|0),o.push(v.i/l|0),ig(h),ig(h.next),h=a=v),h=h.next}while(h!==a);return zd(h)}function _1(a,o,l,h,f,v){var b=a;do{for(var C=b.next.next;C!==b.prev;){if(b.i!==C.i&&Q0(b,C)){var D=ex(b,C);return b=zd(b,b.next),D=zd(D,D.next),Kh(b,o,l,h,f,v,0),void Kh(D,o,l,h,f,v,0)}C=C.next}b=b.next}while(b!==a)}function y1(a,o){return a.x-o.x}function Qh(a,o){var l=function(f,v){var b,C=v,D=f.x,A=f.y,L=-1/0;do{if(A<=C.y&&A>=C.next.y&&C.next.y!==C.y){var B=C.x+(A-C.y)*(C.next.x-C.x)/(C.next.y-C.y);if(B<=D&&B>L&&(L=B,b=C.x<C.next.x?C:C.next,B===D))return b}C=C.next}while(C!==v);if(!b)return null;var z,j=b,$=b.x,Y=b.y,te=1/0;C=b;do{D>=C.x&&C.x>=$&&D!==C.x&&Cf(A<Y?D:L,A,$,Y,A<Y?L:D,A,C.x,C.y)&&(z=Math.abs(A-C.y)/(D-C.x),ng(C,f)&&(z<te||z===te&&(C.x>b.x||C.x===b.x&&pT(b,C)))&&(b=C,te=z)),C=C.next}while(C!==j);return b}(a,o);if(!l)return o;var h=ex(l,a);return zd(h,h.next),zd(l,l.next)}function pT(a,o){return Xr(a.prev,a,o.prev)<0&&Xr(o.next,a,a.next)<0}function tg(a,o,l,h,f){return(a=1431655765&((a=858993459&((a=252645135&((a=16711935&((a=(a-l)*f|0)|a<<8))|a<<4))|a<<2))|a<<1))|(o=1431655765&((o=858993459&((o=252645135&((o=16711935&((o=(o-h)*f|0)|o<<8))|o<<4))|o<<2))|o<<1))<<1}function gy(a){var o=a,l=a;do{(o.x<l.x||o.x===l.x&&o.y<l.y)&&(l=o),o=o.next}while(o!==a);return l}function Cf(a,o,l,h,f,v,b,C){return(f-b)*(o-C)>=(a-b)*(v-C)&&(a-b)*(h-C)>=(l-b)*(o-C)&&(l-b)*(v-C)>=(f-b)*(h-C)}function Q0(a,o){return a.next.i!==o.i&&a.prev.i!==o.i&&!function(l,h){var f=l;do{if(f.i!==l.i&&f.next.i!==l.i&&f.i!==h.i&&f.next.i!==h.i&&J0(f,f.next,l,h))return!0;f=f.next}while(f!==l);return!1}(a,o)&&(ng(a,o)&&ng(o,a)&&function(l,h){var f=l,v=!1,b=(l.x+h.x)/2,C=(l.y+h.y)/2;do{f.y>C!=f.next.y>C&&f.next.y!==f.y&&b<(f.next.x-f.x)*(C-f.y)/(f.next.y-f.y)+f.x&&(v=!v),f=f.next}while(f!==l);return v}(a,o)&&(Xr(a.prev,a,o.prev)||Xr(a,o.prev,o))||fc(a,o)&&Xr(a.prev,a,a.next)>0&&Xr(o.prev,o,o.next)>0)}function Xr(a,o,l){return(o.y-a.y)*(l.x-o.x)-(o.x-a.x)*(l.y-o.y)}function fc(a,o){return a.x===o.x&&a.y===o.y}function J0(a,o,l,h){var f=_y(Xr(a,o,l)),v=_y(Xr(a,o,h)),b=_y(Xr(l,h,a)),C=_y(Xr(l,h,o));return f!==v&&b!==C||!(0!==f||!Sf(a,l,o))||!(0!==v||!Sf(a,h,o))||!(0!==b||!Sf(l,a,h))||!(0!==C||!Sf(l,o,h))}function Sf(a,o,l){return o.x<=Math.max(a.x,l.x)&&o.x>=Math.min(a.x,l.x)&&o.y<=Math.max(a.y,l.y)&&o.y>=Math.min(a.y,l.y)}function _y(a){return a>0?1:a<0?-1:0}function ng(a,o){return Xr(a.prev,a,a.next)<0?Xr(a,o,a.next)>=0&&Xr(a,a.prev,o)>=0:Xr(a,o,a.prev)<0||Xr(a,a.next,o)<0}function ex(a,o){var l=new tx(a.i,a.x,a.y),h=new tx(o.i,o.x,o.y),f=a.next,v=o.prev;return a.next=o,o.prev=a,l.next=f,f.prev=l,h.next=l,l.prev=h,v.next=h,h.prev=v,h}function Jh(a,o,l,h){var f=new tx(a,o,l);return h?(f.next=h.next,f.prev=h,h.next.prev=f,h.next=f):(f.prev=f,f.next=f),f}function ig(a){a.next.prev=a.prev,a.prev.next=a.next,a.prevZ&&(a.prevZ.nextZ=a.nextZ),a.nextZ&&(a.nextZ.prevZ=a.prevZ)}function tx(a,o,l){this.i=a,this.x=o,this.y=l,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function nx(a,o,l,h){for(var f=0,v=o,b=l-h;v<l;v+=h)f+=(a[b]-a[v])*(a[v+1]+a[b+1]),b=v;return f}function fT(a,o,l,h,f){yy(a,o,l||0,h||a.length-1,f||v1)}function yy(a,o,l,h,f){for(;h>l;){if(h-l>600){var v=h-l+1,b=o-l+1,C=Math.log(v),D=.5*Math.exp(2*C/3),A=.5*Math.sqrt(C*D*(v-D)/v)*(b-v/2<0?-1:1);yy(a,o,Math.max(l,Math.floor(o-b*D/v+A)),Math.min(h,Math.floor(o+(v-b)*D/v+A)),f)}var L=a[o],B=l,z=h;for(rg(a,l,o),f(a[h],L)>0&&rg(a,l,h);B<z;){for(rg(a,B,z),B++,z--;f(a[B],L)<0;)B++;for(;f(a[z],L)>0;)z--}0===f(a[l],L)?rg(a,l,z):rg(a,++z,h),z<=o&&(l=z+1),o<=z&&(h=z-1)}}function rg(a,o,l){var h=a[o];a[o]=a[l],a[l]=h}function v1(a,o){return a<o?-1:a>o?1:0}function ix(a,o){const l=a.length;if(l<=1)return[a];const h=[];let f,v;for(let b=0;b<l;b++){const C=Ri(a[b]);0!==C&&(a[b].area=Math.abs(C),void 0===v&&(v=C<0),v===C<0?(f&&h.push(f),f=[a[b]]):f.push(a[b]))}if(f&&h.push(f),o>1)for(let b=0;b<h.length;b++)h[b].length<=o||(fT(h[b],o,1,h[b].length-1,x1),h[b]=h[b].slice(0,o));return h}function x1(a,o){return o.area-a.area}function b1(a,o,l){const h=l.patternDependencies;let f=!1;for(const v of o){const b=v.paint.get(`${a}-pattern`);b.isConstant()||(f=!0);const C=b.constantOr(null);C&&(f=!0,h[C.to]=!0,h[C.from]=!0)}return f}function rx(a,o,l,h,f){const v=f.patternDependencies;for(const b of o){const C=b.paint.get(`${a}-pattern`).value;if("constant"!==C.kind){let D=C.evaluate({zoom:h-1},l,{},f.availableImages),A=C.evaluate({zoom:h},l,{},f.availableImages),L=C.evaluate({zoom:h+1},l,{},f.availableImages);D=D&&D.name?D.name:D,A=A&&A.name?A.name:A,L=L&&L.name?L.name:L,v[D]=!0,v[A]=!0,v[L]=!0,l.patterns[b.id]={min:D,mid:A,max:L}}}return l}Mf.exports=my,Mf.exports.default=my,my.deviation=function(a,o,l,h){var f=o&&o.length,v=Math.abs(nx(a,0,f?o[0]*l:a.length,l));if(f)for(var b=0,C=o.length;b<C;b++)v-=Math.abs(nx(a,o[b]*l,b<C-1?o[b+1]*l:a.length,l));var D=0;for(b=0;b<h.length;b+=3){var A=h[b]*l,L=h[b+1]*l,B=h[b+2]*l;D+=Math.abs((a[A]-a[B])*(a[L+1]-a[A+1])-(a[A]-a[L])*(a[B+1]-a[A+1]))}return 0===v&&0===D?0:Math.abs((D-v)/v)},my.flatten=function(a){for(var o=a[0][0].length,l={vertices:[],holes:[],dimensions:o},h=0,f=0;f<a.length;f++){for(var v=0;v<a[f].length;v++)for(var b=0;b<o;b++)l.vertices.push(a[f][v][b]);f>0&&l.holes.push(h+=a[f-1].length)}return l};class Kc{constructor(o){this.zoom=o.zoom,this.overscaling=o.overscaling,this.layers=o.layers,this.layerIds=this.layers.map(l=>l.id),this.index=o.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new di,this.indexArray=new ns,this.indexArray2=new _o,this.programConfigurations=new dc(o.layers,o.zoom),this.segments=new Xe,this.segments2=new Xe,this.stateDependentLayerIds=this.layers.filter(l=>l.isStateDependent()).map(l=>l.id),this.projection=o.projection}populate(o,l,h,f){this.hasPattern=b1("fill",this.layers,l);const v=this.layers[0].layout.get("fill-sort-key"),b=[];for(const{feature:C,id:D,index:A,sourceLayerIndex:L}of o){const B=this.layers[0]._featureFilter.needGeometry,z=qh(C,B);if(!this.layers[0]._featureFilter.filter(new ge(this.zoom),z,h))continue;const j=v?v.evaluate(z,{},h,l.availableImages):void 0,$={id:D,properties:C.properties,type:C.type,sourceLayerIndex:L,index:A,geometry:B?z.geometry:Zc(C,h,f),patterns:{},sortKey:j};b.push($)}v&&b.sort((C,D)=>C.sortKey-D.sortKey);for(const C of b){const{geometry:D,index:A,sourceLayerIndex:L}=C;if(this.hasPattern){const B=rx("fill",this.layers,C,this.zoom,l);this.patternFeatures.push(B)}else this.addFeature(C,D,A,h,{},l.availableImages);l.featureIndex.insert(o[A].feature,D,A,L,this.index)}}update(o,l,h,f){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(o,l,this.stateDependentLayers,h,f)}addFeatures(o,l,h,f,v){for(const b of this.patternFeatures)this.addFeature(b,b.geometry,b.index,l,h,f)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(o){this.uploaded||(this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,g1),this.indexBuffer=o.createIndexBuffer(this.indexArray),this.indexBuffer2=o.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(o),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(o,l,h,f,v,b=[]){for(const C of ix(l,500)){let D=0;for(const $ of C)D+=$.length;const A=this.segments.prepareSegment(D,this.layoutVertexArray,this.indexArray),L=A.vertexLength,B=[],z=[];for(const $ of C){if(0===$.length)continue;$!==C[0]&&z.push(B.length/2);const Y=this.segments2.prepareSegment($.length,this.layoutVertexArray,this.indexArray2),te=Y.vertexLength;this.layoutVertexArray.emplaceBack($[0].x,$[0].y),this.indexArray2.emplaceBack(te+$.length-1,te),B.push($[0].x),B.push($[0].y);for(let me=1;me<$.length;me++)this.layoutVertexArray.emplaceBack($[me].x,$[me].y),this.indexArray2.emplaceBack(te+me-1,te+me),B.push($[me].x),B.push($[me].y);Y.vertexLength+=$.length,Y.primitiveLength+=$.length}const j=Mf.exports(B,z);for(let $=0;$<j.length;$+=3)this.indexArray.emplaceBack(L+j[$],L+j[$+1],L+j[$+2]);A.vertexLength+=D,A.primitiveLength+=j.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,o,h,v,b,f)}}tn(Kc,"FillBucket",{omit:["layers","patternFeatures"]});const mT=new Bt({"fill-sort-key":new Fe(rt.layout_fill["fill-sort-key"])});var Ef={paint:new Bt({"fill-antialias":new We(rt.paint_fill["fill-antialias"]),"fill-opacity":new Fe(rt.paint_fill["fill-opacity"]),"fill-color":new Fe(rt.paint_fill["fill-color"]),"fill-outline-color":new Fe(rt.paint_fill["fill-outline-color"]),"fill-translate":new We(rt.paint_fill["fill-translate"]),"fill-translate-anchor":new We(rt.paint_fill["fill-translate-anchor"]),"fill-pattern":new $t(rt.paint_fill["fill-pattern"])}),layout:mT};const wr=Lt([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),gT=Lt([{name:"a_centroid_pos",components:2,type:"Uint16"}]),dR=Lt([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:sg}=wr;var Ul={},_T=Ht,w1=Hl;function Hl(a,o,l,h,f){this.properties={},this.extent=l,this.type=0,this._pbf=a,this._geometry=-1,this._keys=h,this._values=f,a.readFields(yT,this,o)}function yT(a,o,l){1==a?o.id=l.readVarint():2==a?function(h,f){for(var v=h.readVarint()+h.pos;h.pos<v;){var b=f._keys[h.readVarint()],C=f._values[h.readVarint()];f.properties[b]=C}}(l,o):3==a?o.type=l.readVarint():4==a&&(o._geometry=l.pos)}function sx(a){for(var o,l,h=0,f=0,v=a.length,b=v-1;f<v;b=f++)h+=((l=a[b]).x-(o=a[f]).x)*(o.y+l.y);return h}Hl.types=["Unknown","Point","LineString","Polygon"],Hl.prototype.loadGeometry=function(){var a=this._pbf;a.pos=this._geometry;for(var o,l=a.readVarint()+a.pos,h=1,f=0,v=0,b=0,C=[];a.pos<l;){if(f<=0){var D=a.readVarint();h=7&D,f=D>>3}if(f--,1===h||2===h)v+=a.readSVarint(),b+=a.readSVarint(),1===h&&(o&&C.push(o),o=[]),o.push(new _T(v,b));else{if(7!==h)throw new Error("unknown command "+h);o&&o.push(o[0].clone())}}return o&&C.push(o),C},Hl.prototype.bbox=function(){var a=this._pbf;a.pos=this._geometry;for(var o=a.readVarint()+a.pos,l=1,h=0,f=0,v=0,b=1/0,C=-1/0,D=1/0,A=-1/0;a.pos<o;){if(h<=0){var L=a.readVarint();l=7&L,h=L>>3}if(h--,1===l||2===l)(f+=a.readSVarint())<b&&(b=f),f>C&&(C=f),(v+=a.readSVarint())<D&&(D=v),v>A&&(A=v);else if(7!==l)throw new Error("unknown command "+l)}return[b,D,C,A]},Hl.prototype.toGeoJSON=function(a,o,l){var h,f,v=this.extent*Math.pow(2,l),b=this.extent*a,C=this.extent*o,D=this.loadGeometry(),A=Hl.types[this.type];function L(j){for(var $=0;$<j.length;$++){var Y=j[$];j[$]=[360*(Y.x+b)/v-180,360/Math.PI*Math.atan(Math.exp((180-360*(Y.y+C)/v)*Math.PI/180))-90]}}switch(this.type){case 1:var B=[];for(h=0;h<D.length;h++)B[h]=D[h][0];L(D=B);break;case 2:for(h=0;h<D.length;h++)L(D[h]);break;case 3:for(D=function(j){var $=j.length;if($<=1)return[j];for(var Y,te,me=[],Ce=0;Ce<$;Ce++){var fe=sx(j[Ce]);0!==fe&&(void 0===te&&(te=fe<0),te===fe<0?(Y&&me.push(Y),Y=[j[Ce]]):Y.push(j[Ce]))}return Y&&me.push(Y),me}(D),h=0;h<D.length;h++)for(f=0;f<D[h].length;f++)L(D[h][f])}1===D.length?D=D[0]:A="Multi"+A;var z={type:"Feature",geometry:{type:A,coordinates:D},properties:this.properties};return"id"in this&&(z.id=this.id),z};var vT=w1,M1=vy;function vy(a,o){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=a,this._keys=[],this._values=[],this._features=[],a.readFields(hR,this,o),this.length=this._features.length}function hR(a,o,l){15===a?o.version=l.readVarint():1===a?o.name=l.readString():5===a?o.extent=l.readVarint():2===a?o._features.push(l.pos):3===a?o._keys.push(l.readString()):4===a&&o._values.push(function(h){for(var f=null,v=h.readVarint()+h.pos;h.pos<v;){var b=h.readVarint()>>3;f=1===b?h.readString():2===b?h.readFloat():3===b?h.readDouble():4===b?h.readVarint64():5===b?h.readVarint():6===b?h.readSVarint():7===b?h.readBoolean():null}return f}(l))}vy.prototype.feature=function(a){if(a<0||a>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[a];var o=this._pbf.readVarint()+this._pbf.pos;return new vT(this._pbf,o,this.extent,this._keys,this._values)};var pR=M1;function ox(a,o,l){if(3===a){var h=new pR(l,l.readVarint()+l.pos);h.length&&(o[h.name]=h)}}var C1=Ul.VectorTile=function(a,o){this.layers=a.readFields(ox,{},o)},ax=Ul.VectorTileFeature=w1;function lx(a,o,l,h){const f=[],v=0===h?(b,C,D,A,L,B)=>{b.push(new Ht(B,D+(B-C)/(A-C)*(L-D)))}:(b,C,D,A,L,B)=>{b.push(new Ht(C+(B-D)/(L-D)*(A-C),B))};for(const b of a){const C=[];for(const D of b){if(D.length<=2)continue;const A=[];for(let z=0;z<D.length-1;z++){const j=D[z].x,$=D[z].y,Y=D[z+1].x,te=D[z+1].y,me=0===h?j:$,Ce=0===h?Y:te;me<o?Ce>o&&v(A,j,$,Y,te,o):me>l?Ce<l&&v(A,j,$,Y,te,l):A.push(D[z]),Ce<o&&me>=o&&v(A,j,$,Y,te,o),Ce>l&&me<=l&&v(A,j,$,Y,te,l)}let L=D[D.length-1];const B=0===h?L.x:L.y;B>=o&&B<=l&&A.push(L),A.length&&(L=A[A.length-1],A[0].x===L.x&&A[0].y===L.y||A.push(A[0]),C.push(A))}C.length&&f.push(C)}return f}Ul.VectorTileLayer=M1;const fR=ax.types,mR=Math.pow(2,13);function og(a,o,l,h,f,v,b,C){a.emplaceBack((o<<1)+b,(l<<1)+v,(Math.floor(h*mR)<<1)+f,Math.round(C))}function Tf(a,o,l){a.emplaceBack(o.x,o.y,o.z,16384*l[0],16384*l[1],16384*l[2])}class xy{constructor(){this.acc=new Ht(0,0),this.polyCount=[]}startRing(o){this.currentPolyCount={edges:0,top:0},this.polyCount.push(this.currentPolyCount),this.min||(this.min=new Ht(o.x,o.y),this.max=new Ht(o.x,o.y))}append(o,l){this.currentPolyCount.edges++,this.acc._add(o);const h=this.min,f=this.max;o.x<h.x?h.x=o.x:o.x>f.x&&(f.x=o.x),o.y<h.y?h.y=o.y:o.y>f.y&&(f.y=o.y),((0===o.x||o.x===Un)&&o.x===l.x)!=((0===o.y||o.y===Un)&&o.y===l.y)&&this.processBorderOverlap(o,l),l.x<0!=o.x<0&&this.addBorderIntersection(0,Oi(l.y,o.y,(0-l.x)/(o.x-l.x))),l.x>Un!=o.x>Un&&this.addBorderIntersection(1,Oi(l.y,o.y,(Un-l.x)/(o.x-l.x))),l.y<0!=o.y<0&&this.addBorderIntersection(2,Oi(l.x,o.x,(0-l.y)/(o.y-l.y))),l.y>Un!=o.y>Un&&this.addBorderIntersection(3,Oi(l.x,o.x,(Un-l.y)/(o.y-l.y)))}addBorderIntersection(o,l){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const h=this.borders[o];l<h[0]&&(h[0]=l),l>h[1]&&(h[1]=l)}processBorderOverlap(o,l){if(o.x===l.x){if(o.y===l.y)return;const h=0===o.x?0:1;this.addBorderIntersection(h,l.y),this.addBorderIntersection(h,o.y)}else{const h=0===o.y?2:3;this.addBorderIntersection(h,l.x),this.addBorderIntersection(h,o.x)}}centroid(){const o=this.polyCount.reduce((l,h)=>l+h.edges,0);return 0!==o?this.acc.div(o)._round():new Ht(0,0)}span(){return new Ht(this.max.x-this.min.x,this.max.y-this.min.y)}intersectsCount(){return this.borders.reduce((o,l)=>o+ +(l[0]!==Number.MAX_VALUE),0)}}class Df{constructor(o){this.zoom=o.zoom,this.canonical=o.canonical,this.overscaling=o.overscaling,this.layers=o.layers,this.layerIds=this.layers.map(l=>l.id),this.index=o.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=o.projection,this.layoutVertexArray=new dr,this.centroidVertexArray=new df,this.indexArray=new ns,this.programConfigurations=new dc(o.layers,o.zoom),this.segments=new Xe,this.stateDependentLayerIds=this.layers.filter(l=>l.isStateDependent()).map(l=>l.id),this.enableTerrain=o.enableTerrain}populate(o,l,h,f){this.features=[],this.hasPattern=b1("fill-extrusion",this.layers,l),this.featuresOnBorder=[],this.borders=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=function(v){const b=Math.exp(Math.PI*(1-v.y/(1<<v.z)*2));return 80150034*b/(b*b+1)/Un/(1<<v.z)}(h),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter;for(const{feature:v,id:b,index:C,sourceLayerIndex:D}of o){const A=this.layers[0]._featureFilter.needGeometry,L=qh(v,A);if(!this.layers[0]._featureFilter.filter(new ge(this.zoom),L,h))continue;const B={id:b,sourceLayerIndex:D,index:C,geometry:A?L.geometry:Zc(v,h,f),properties:v.properties,type:v.type,patterns:{}},z=this.layoutVertexArray.length;this.hasPattern?this.features.push(rx("fill-extrusion",this.layers,B,this.zoom,l)):this.addFeature(B,B.geometry,C,h,{},l.availableImages,f),l.featureIndex.insert(v,B.geometry,C,D,this.index,z)}this.sortBorders()}addFeatures(o,l,h,f,v){for(const b of this.features){const{geometry:C}=b;this.addFeature(b,C,b.index,l,h,f,v)}this.sortBorders()}update(o,l,h,f){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(o,l,this.stateDependentLayers,h,f)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(o){this.uploaded||(this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,sg),this.indexBuffer=o.createIndexBuffer(this.indexArray),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=o.createVertexBuffer(this.layoutVertexExtArray,dR.members,!0))),this.programConfigurations.upload(o),this.uploaded=!0}uploadCentroid(o){0!==this.centroidVertexArray.length&&(this.centroidVertexBuffer?this.needsCentroidUpdate&&this.centroidVertexBuffer.updateData(this.centroidVertexArray):this.centroidVertexBuffer=o.createVertexBuffer(this.centroidVertexArray,gT.members,!0),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(o,l,h,f,v,b,C){const D=[new Ht(0,0),new Ht(Un,Un)],A=C.projection,L="globe"===A.name,B=this.enableTerrain&&!L?new xy:null,z="Polygon"===fR[o.type];L&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new HE);const j=ix(l,500);for(let me=j.length-1;me>=0;me--){const Ce=j[me];(0===Ce.length||($=Ce[0]).every(fe=>fe.x<=0)||$.every(fe=>fe.x>=Un)||$.every(fe=>fe.y<=0)||$.every(fe=>fe.y>=Un))&&j.splice(me,1)}var $;let Y;if(L)Y=D1(j,D,f);else{Y=[];for(const me of j)Y.push({polygon:me,bounds:D})}const te=z?this.edgeRadius:0;for(const{polygon:me,bounds:Ce}of Y){let fe=0,be=0;for(const Te of me)z&&!Te[0].equals(Te[Te.length-1])&&Te.push(Te[0]),be+=z?Te.length-1:Te.length;const Pe=this.segments.prepareSegment((z?5:4)*be,this.layoutVertexArray,this.indexArray);if(z){const Te=[],Ze=[];fe=Pe.vertexLength;for(const ct of me){let Tt,Je;ct.length&&ct!==me[0]&&Ze.push(Te.length/2),Tt=ct[1].sub(ct[0])._perp()._unit();for(let mt=1;mt<ct.length;mt++){const yt=ct[mt],wt=ct[mt===ct.length-1?1:mt+1];let{x:It,y:ut}=yt;if(te){Je=wt.sub(yt)._perp()._unit();const nn=Tt.add(Je)._unit(),zn=te*Math.min(4,1/(Tt.x*nn.x+Tt.y*nn.y));It+=zn*nn.x,ut+=zn*nn.y,Tt=Je}og(this.layoutVertexArray,It,ut,0,0,1,1,0),Pe.vertexLength++,Te.push(yt.x,yt.y),L&&Tf(this.layoutVertexExtArray,A.projectTilePoint(It,ut,f),A.upVector(f,It,ut))}}const $e=Mf.exports(Te,Ze);for(let ct=0;ct<$e.length;ct+=3)this.indexArray.emplaceBack(fe+$e[ct],fe+$e[ct+2],fe+$e[ct+1]),Pe.primitiveLength++}for(const Te of me){B&&Te.length&&B.startRing(Te[0]);let Ze,$e,ct,Tt=Te.length>4&&wy(Te[Te.length-2],Te[0],Te[1]),Je=te?S1(Te[Te.length-2],Te[0],Te[1],te):0;$e=Te[1].sub(Te[0])._perp()._unit();let mt=!0;for(let yt=1,wt=0;yt<Te.length;yt++){let It=Te[yt-1],ut=Te[yt];const nn=Te[yt===Te.length-1?1:yt+1];if(B&&z&&B.currentPolyCount.top++,E1(ut,It,Ce)){te&&($e=nn.sub(ut)._perp()._unit(),mt=!mt);continue}B&&B.append(ut,It);const zn=ut.sub(It)._perp(),on=zn.x/(Math.abs(zn.x)+Math.abs(zn.y)),ln=zn.y>0?1:0,qt=It.dist(ut);if(wt+qt>32768&&(wt=0),te){ct=nn.sub(ut)._perp()._unit();let Fi=by(It,ut,nn,cx($e,ct),te);isNaN(Fi)&&(Fi=0);const Xn=ut.sub(It)._unit();It=It.add(Xn.mult(Je))._round(),ut=ut.add(Xn.mult(-Fi))._round(),Je=Fi,$e=ct}const Rn=Pe.vertexLength,li=Te.length>4&&wy(It,ut,nn);let ti=Ku(wt,Tt,mt);if(og(this.layoutVertexArray,It.x,It.y,on,ln,0,0,ti),og(this.layoutVertexArray,It.x,It.y,on,ln,0,1,ti),wt+=qt,ti=Ku(wt,li,!mt),Tt=li,og(this.layoutVertexArray,ut.x,ut.y,on,ln,0,0,ti),og(this.layoutVertexArray,ut.x,ut.y,on,ln,0,1,ti),Pe.vertexLength+=4,this.indexArray.emplaceBack(Rn+0,Rn+1,Rn+2),this.indexArray.emplaceBack(Rn+1,Rn+3,Rn+2),Pe.primitiveLength+=2,te){const Fi=fe+(1===yt?Te.length-2:yt-2),Xn=1===yt?fe:Fi+1;if(this.indexArray.emplaceBack(Rn+1,Fi,Rn+3),this.indexArray.emplaceBack(Fi,Xn,Rn+3),Pe.primitiveLength+=2,void 0===Ze&&(Ze=Rn),!E1(nn,Te[yt],Ce)){const Br=yt===Te.length-1?Ze:Pe.vertexLength;this.indexArray.emplaceBack(Rn+2,Rn+3,Br),this.indexArray.emplaceBack(Rn+3,Br+1,Br),this.indexArray.emplaceBack(Rn+3,Xn,Br+1),Pe.primitiveLength+=3}mt=!mt}if(L){const Fi=this.layoutVertexExtArray,Xn=A.projectTilePoint(It.x,It.y,f),Br=A.projectTilePoint(ut.x,ut.y,f),ni=A.upVector(f,It.x,It.y),Ti=A.upVector(f,ut.x,ut.y);Tf(Fi,Xn,ni),Tf(Fi,Xn,ni),Tf(Fi,Br,Ti),Tf(Fi,Br,Ti)}}z&&(fe+=Te.length-1)}}if(B&&B.polyCount.length>0){if(B.borders){B.vertexArrayOffset=this.centroidVertexArray.length;const me=B.borders,Ce=this.featuresOnBorder.push(B)-1;for(let fe=0;fe<4;fe++)me[fe][0]!==Number.MAX_VALUE&&this.borders[fe].push(Ce)}this.encodeCentroid(B.borders?void 0:B.centroid(),B)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,o,h,v,b,f)}sortBorders(){for(let o=0;o<4;o++)this.borders[o].sort((l,h)=>this.featuresOnBorder[l].borders[o][0]-this.featuresOnBorder[h].borders[o][0])}encodeCentroid(o,l,h=!0){let f,v;if(o)if(0!==o.y){const C=l.span()._mult(this.tileToMeter);f=(Math.max(o.x,1)<<3)+Math.min(7,Math.round(C.x/10)),v=(Math.max(o.y,1)<<3)+Math.min(7,Math.round(C.y/10))}else f=Math.ceil(7*(o.x+450)),v=0;else f=0,v=+h;let b=h?this.centroidVertexArray.length:l.vertexArrayOffset;for(const C of l.polyCount){h&&this.centroidVertexArray.resize(this.centroidVertexArray.length+4*C.edges+C.top);for(let D=0;D<C.top;D++)this.centroidVertexArray.emplace(b++,f,v);for(let D=0;D<2*C.edges;D++)this.centroidVertexArray.emplace(b++,0,v),this.centroidVertexArray.emplace(b++,f,v)}}}function cx(a,o){const l=a.add(o)._unit();return a.x*l.x+a.y*l.y}function S1(a,o,l,h){const f=o.sub(a)._perp()._unit(),v=l.sub(o)._perp()._unit();return by(a,o,l,cx(f,v),h)}function by(a,o,l,h,f){const v=Math.sqrt(1-h*h);return Math.min(a.dist(o)/3,o.dist(l)/3,f*v/h)}function E1(a,o,l){return a.x<l[0].x&&o.x<l[0].x||a.x>l[1].x&&o.x>l[1].x||a.y<l[0].y&&o.y<l[0].y||a.y>l[1].y&&o.y>l[1].y}function wy(a,o,l){if(a.x<0||a.x>=Un||o.x<0||o.x>=Un||l.x<0||l.x>=Un)return!1;const h=l.sub(o),f=h.perp(),v=a.sub(o);return(h.x*v.x+h.y*v.y)/Math.sqrt((h.x*h.x+h.y*h.y)*(v.x*v.x+v.y*v.y))>-.866&&f.x*v.x+f.y*v.y<0}function Ku(a,o,l){const h=o?2|a:-3&a;return l?1|h:-2&h}function T1(){const a=Math.PI/32,o=Math.tan(a),l=gf;return l*Math.sqrt(1+2*o*o)-l}function D1(a,o,l){const h=1<<l.z,f=Ga(l.x/h),v=Ga((l.x+1)/h),b=$r(l.y/h),C=$r((l.y+1)/h);return function(D,A,L,B,z=0,j){const $=[];if(!D.length||!L||!B)return $;const Y=(Te,Ze)=>{for(const $e of Te)$.push({polygon:$e,bounds:Ze})},te=Math.ceil(Math.log2(L)),me=Math.ceil(Math.log2(B)),Ce=te-me,fe=[];for(let Te=0;Te<Math.abs(Ce);Te++)fe.push(Ce>0?0:1);for(let Te=0;Te<Math.min(te,me);Te++)fe.push(0),fe.push(1);let be=D;if(be=lx(be,A[0].y-z,A[1].y+z,1),be=lx(be,A[0].x-z,A[1].x+z,0),!be.length)return $;const Pe=[];for(fe.length?Pe.push({polygons:be,bounds:A,depth:0}):Y(be,A);Pe.length;){const Te=Pe.pop(),Ze=Te.depth,$e=fe[Ze],ct=Te.bounds[0],Tt=Te.bounds[1],Je=0===$e?ct.x:ct.y,mt=0===$e?Tt.x:Tt.y,yt=j?j($e,Je,mt):.5*(Je+mt),wt=lx(Te.polygons,Je-z,yt+z,$e),It=lx(Te.polygons,yt-z,mt+z,$e);if(wt.length){const ut=[ct,new Ht(0===$e?yt:Tt.x,1===$e?yt:Tt.y)];fe.length>Ze+1?Pe.push({polygons:wt,bounds:ut,depth:Ze+1}):Y(wt,ut)}if(It.length){const ut=[new Ht(0===$e?yt:ct.x,1===$e?yt:ct.y),Tt];fe.length>Ze+1?Pe.push({polygons:It,bounds:ut,depth:Ze+1}):Y(It,ut)}}return $}(a,o,Math.ceil((v-f)/11.25),Math.ceil((b-C)/11.25),1,(D,A,L)=>{if(0===D)return.5*(A+L);{const B=$r((l.y+A/Un)/h);return(Vl(.5*($r((l.y+L/Un)/h)+B))*h-l.y)*Un}})}tn(Df,"FillExtrusionBucket",{omit:["layers","features"]}),tn(xy,"PartMetadata");const xT=new Bt({"fill-extrusion-edge-radius":new We(rt["layout_fill-extrusion"]["fill-extrusion-edge-radius"])});var A1={paint:new Bt({"fill-extrusion-opacity":new We(rt["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Fe(rt["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new We(rt["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new We(rt["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new $t(rt["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Fe(rt["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Fe(rt["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new We(rt["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new We(rt["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new We(rt["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"])}),layout:xT};function I1(a,o,l){var h=2*Math.PI*6378137/256/Math.pow(2,l);return[a*h-2*Math.PI*6378137/2,o*h-2*Math.PI*6378137/2]}class My{constructor(o,l,h){this.z=o,this.x=l,this.y=h,this.key=ep(0,o,o,l,h)}equals(o){return this.z===o.z&&this.x===o.x&&this.y===o.y}url(o,l){const h=(b=this.y,C=this.z,D=I1(256*(v=this.x),256*(b=Math.pow(2,C)-b-1),C),A=I1(256*(v+1),256*(b+1),C),D[0]+","+D[1]+","+A[0]+","+A[1]),f=function(v,b,C){let D,A="";for(let L=v;L>0;L--)D=1<<L-1,A+=(b&D?1:0)+(C&D?2:0);return A}(this.z,this.x,this.y);var v,b,C,D,A;return o[(this.x+this.y)%o.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String("tms"===l?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",f).replace("{bbox-epsg-3857}",h)}toString(){return`${this.z}/${this.x}/${this.y}`}}class P1{constructor(o,l){this.wrap=o,this.canonical=l,this.key=ep(o,l.z,l.z,l.x,l.y)}}class ta{constructor(o,l,h,f,v){this.overscaledZ=o,this.wrap=l,this.canonical=new My(h,+f,+v),this.key=0===l&&o===h?this.canonical.key:ep(l,o,h,f,v)}equals(o){return this.overscaledZ===o.overscaledZ&&this.wrap===o.wrap&&this.canonical.equals(o.canonical)}scaledTo(o){const l=this.canonical.z-o;return o>this.canonical.z?new ta(o,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new ta(o,this.wrap,o,this.canonical.x>>l,this.canonical.y>>l)}calculateScaledKey(o,l=!0){if(this.overscaledZ===o&&l)return this.key;if(o>this.canonical.z)return ep(this.wrap*+l,o,this.canonical.z,this.canonical.x,this.canonical.y);{const h=this.canonical.z-o;return ep(this.wrap*+l,o,o,this.canonical.x>>h,this.canonical.y>>h)}}isChildOf(o){if(o.wrap!==this.wrap)return!1;const l=this.canonical.z-o.canonical.z;return 0===o.overscaledZ||o.overscaledZ<this.overscaledZ&&o.canonical.x===this.canonical.x>>l&&o.canonical.y===this.canonical.y>>l}children(o){if(this.overscaledZ>=o)return[new ta(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const l=this.canonical.z+1,h=2*this.canonical.x,f=2*this.canonical.y;return[new ta(l,this.wrap,l,h,f),new ta(l,this.wrap,l,h+1,f),new ta(l,this.wrap,l,h,f+1),new ta(l,this.wrap,l,h+1,f+1)]}isLessThan(o){return this.wrap<o.wrap||!(this.wrap>o.wrap)&&(this.overscaledZ<o.overscaledZ||!(this.overscaledZ>o.overscaledZ)&&(this.canonical.x<o.canonical.x||!(this.canonical.x>o.canonical.x)&&this.canonical.y<o.canonical.y))}wrapped(){return new ta(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(o){return new ta(this.overscaledZ,o,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new P1(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function ep(a,o,l,h,f){const v=1<<Math.min(l,22);let b=v*(f%v)+h%v;return a&&l<22&&(b+=v*v*((a<0?-2*a-1:2*a)%(1<<2*(22-l)))),16*(32*b+l)+(o-l)}tn(My,"CanonicalTileID"),tn(ta,"OverscaledTileID",{omit:["projMatrix"]});class Af extends Ht{constructor(o,l,h){super(o,l),this.z=h}}function ag(a,o){return a.x*o.x+a.y*o.y}function R1(a,o){if(1===a.length){let l=0;const h=o[l++];let f;for(;!f||h.equals(f);)if(f=o[l++],!f)return 1/0;for(;l<o.length;l++){const v=o[l],b=a[0],C=f.sub(h),D=v.sub(h),A=b.sub(h),L=ag(C,C),B=ag(C,D),z=ag(D,D),j=ag(A,C),$=ag(A,D),Y=L*z-B*B,te=(z*j-B*$)/Y,me=(L*$-B*j)/Y,Ce=h.z*(1-te-me)+f.z*te+v.z*me;if(isFinite(Ce))return Ce}return 1/0}{let l=1/0;for(const h of o)l=Math.min(l,h.z);return l}}function ux(a,o,l,h,f,v,b,C){const D=b*f.getElevationAt(a,o,!0,!0),A=0!==v[0],L=A?0===v[1]?b*(v[0]/7-450):b*function(B,z,j){const $=Math.floor(z[0]/8),Y=Math.floor(z[1]/8),te=10*(z[0]-8*$),me=10*(z[1]-8*Y),Ce=B.getElevationAt($,Y,!0,!0),fe=B.getMeterToDEM(j),be=Math.floor(.5*(te*fe-1)),Pe=Math.floor(.5*(me*fe-1)),Te=B.tileCoordToPixel($,Y),Ze=2*be+1,$e=2*Pe+1,ct=(zn=Ze,on=$e,[(It=B).getElevationAtPixel(ut=Te.x-be,nn=Te.y-Pe,!0),It.getElevationAtPixel(ut+on,nn,!0),It.getElevationAtPixel(ut,nn+on,!0),It.getElevationAtPixel(ut+zn,nn+on,!0)]),Tt=Math.abs(ct[0]-ct[1]),Je=Math.abs(ct[2]-ct[3]),mt=Math.abs(ct[0]-ct[2])+Math.abs(ct[1]-ct[3]),yt=Math.min(.25,.5*fe*(Tt+Je)/Ze),wt=Math.min(.25,.5*fe*mt/$e);var It,ut,nn,zn,on;return Ce+Math.max(yt*te,wt*me)}(f,v,C):D;return{base:D+(0===l)?-1:l,top:A?Math.max(L+h,D+l+2):D+h}}const bT=Lt([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:wT}=bT,wa=Lt([{name:"a_packed",components:4,type:"Float32"}]),{members:dx}=wa,k1=ax.types,hx=Math.cos(Math.PI/180*37.5);class Xs{constructor(o){this.zoom=o.zoom,this.overscaling=o.overscaling,this.layers=o.layers,this.layerIds=this.layers.map(l=>l.id),this.index=o.index,this.projection=o.projection,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(l=>{this.gradients[l.id]={}}),this.layoutVertexArray=new Yi,this.layoutVertexArray2=new Rs,this.indexArray=new ns,this.programConfigurations=new dc(o.layers,o.zoom),this.segments=new Xe,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(l=>l.isStateDependent()).map(l=>l.id)}populate(o,l,h,f){this.hasPattern=b1("line",this.layers,l);const v=this.layers[0].layout.get("line-sort-key"),b=[];for(const{feature:L,id:B,index:z,sourceLayerIndex:j}of o){const $=this.layers[0]._featureFilter.needGeometry,Y=qh(L,$);if(!this.layers[0]._featureFilter.filter(new ge(this.zoom),Y,h))continue;const te=v?v.evaluate(Y,{},h):void 0,me={id:B,properties:L.properties,type:L.type,sourceLayerIndex:j,index:z,geometry:$?Y.geometry:Zc(L,h,f),patterns:{},sortKey:te};b.push(me)}v&&b.sort((L,B)=>L.sortKey-B.sortKey);const{lineAtlas:C,featureIndex:D}=l,A=this.addConstantDashes(C);for(const L of b){const{geometry:B,index:z,sourceLayerIndex:j}=L;if(A&&this.addFeatureDashes(L,C),this.hasPattern){const $=rx("line",this.layers,L,this.zoom,l);this.patternFeatures.push($)}else this.addFeature(L,B,z,h,C.positions,l.availableImages);D.insert(o[z].feature,B,z,j,this.index)}}addConstantDashes(o){let l=!1;for(const h of this.layers){const f=h.paint.get("line-dasharray").value,v=h.layout.get("line-cap").value;if("constant"!==f.kind||"constant"!==v.kind)l=!0;else{const b=v.value,C=f.value;if(!C)continue;o.addDash(C.from,b),o.addDash(C.to,b),C.other&&o.addDash(C.other,b)}}return l}addFeatureDashes(o,l){const h=this.zoom;for(const f of this.layers){const v=f.paint.get("line-dasharray").value,b=f.layout.get("line-cap").value;if("constant"===v.kind&&"constant"===b.kind)continue;let C,D,A,L,B,z;if("constant"===v.kind){const te=v.value;if(!te)continue;C=te.other||te.to,D=te.to,A=te.from}else C=v.evaluate({zoom:h-1},o),D=v.evaluate({zoom:h},o),A=v.evaluate({zoom:h+1},o);"constant"===b.kind?L=B=z=b.value:(L=b.evaluate({zoom:h-1},o),B=b.evaluate({zoom:h},o),z=b.evaluate({zoom:h+1},o)),l.addDash(C,L),l.addDash(D,B),l.addDash(A,z);const j=l.getKey(C,L),$=l.getKey(D,B),Y=l.getKey(A,z);o.patterns[f.id]={min:j,mid:$,max:Y}}}update(o,l,h,f){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(o,l,this.stateDependentLayers,h,f)}addFeatures(o,l,h,f,v){for(const b of this.patternFeatures)this.addFeature(b,b.geometry,b.index,l,h,f)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(o){this.uploaded||(0!==this.layoutVertexArray2.length&&(this.layoutVertexBuffer2=o.createVertexBuffer(this.layoutVertexArray2,dx)),this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,wT),this.indexBuffer=o.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(o),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(o){if(o.properties&&o.properties.hasOwnProperty("mapbox_clip_start")&&o.properties.hasOwnProperty("mapbox_clip_end"))return{start:+o.properties.mapbox_clip_start,end:+o.properties.mapbox_clip_end}}addFeature(o,l,h,f,v,b){const C=this.layers[0].layout,D=C.get("line-join").evaluate(o,{}),A=C.get("line-cap").evaluate(o,{}),L=C.get("line-miter-limit"),B=C.get("line-round-limit");this.lineClips=this.lineFeatureClips(o);for(const z of l)this.addLine(z,o,D,A,L,B);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,o,h,v,b,f)}addLine(o,l,h,f,v,b){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let me=0;me<o.length-1;me++)this.totalDistance+=o[me].dist(o[me+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const C="Polygon"===k1[l.type];let D=o.length;for(;D>=2&&o[D-1].equals(o[D-2]);)D--;let A=0;for(;A<D-1&&o[A].equals(o[A+1]);)A++;if(D<(C?3:2))return;"bevel"===h&&(v=1.05);const L=this.overscaling<=16?122880/(512*this.overscaling):0,B=this.segments.prepareSegment(10*D,this.layoutVertexArray,this.indexArray);let z,j,$,Y,te;this.e1=this.e2=-1,C&&(z=o[D-2],te=o[A].sub(z)._unit()._perp());for(let me=A;me<D;me++){if($=me===D-1?C?o[A+1]:void 0:o[me+1],$&&o[me].equals($))continue;te&&(Y=te),z&&(j=z),z=o[me],te=$?$.sub(z)._unit()._perp():Y,Y=Y||te;let Ce=Y.add(te);0===Ce.x&&0===Ce.y||Ce._unit();const fe=Y.x*te.x+Y.y*te.y,be=Ce.x*te.x+Ce.y*te.y,Pe=0!==be?1/be:1/0,Te=2*Math.sqrt(2-2*be),Ze=be<hx&&j&&$,$e=Y.x*te.y-Y.y*te.x>0;if(Ze&&me>A){const Je=z.dist(j);if(Je>2*L){const mt=z.sub(z.sub(j)._mult(L/Je)._round());this.updateDistance(j,mt),this.addCurrentVertex(mt,Y,0,0,B),j=mt}}const ct=j&&$;let Tt=ct?h:C?"butt":f;if(ct&&"round"===Tt&&(Pe<b?Tt="miter":Pe<=2&&(Tt="fakeround")),"miter"===Tt&&Pe>v&&(Tt="bevel"),"bevel"===Tt&&(Pe>2&&(Tt="flipbevel"),Pe<v&&(Tt="miter")),j&&this.updateDistance(j,z),"miter"===Tt)Ce._mult(Pe),this.addCurrentVertex(z,Ce,0,0,B);else if("flipbevel"===Tt){if(Pe>100)Ce=te.mult(-1);else{const Je=Pe*Y.add(te).mag()/Y.sub(te).mag();Ce._perp()._mult(Je*($e?-1:1))}this.addCurrentVertex(z,Ce,0,0,B),this.addCurrentVertex(z,Ce.mult(-1),0,0,B)}else if("bevel"===Tt||"fakeround"===Tt){const Je=-Math.sqrt(Pe*Pe-1),mt=$e?Je:0,yt=$e?0:Je;if(j&&this.addCurrentVertex(z,Y,mt,yt,B),"fakeround"===Tt){const wt=Math.round(180*Te/Math.PI/20);for(let It=1;It<wt;It++){let ut=It/wt;if(.5!==ut){const zn=ut-.5;ut+=ut*zn*(ut-1)*((1.0904+fe*(fe*(3.55645-1.43519*fe)-3.2452))*zn*zn+(.848013+fe*(.215638*fe-1.06021)))}const nn=te.sub(Y)._mult(ut)._add(Y)._unit()._mult($e?-1:1);this.addHalfVertex(z,nn.x,nn.y,!1,$e,0,B)}}$&&this.addCurrentVertex(z,te,-mt,-yt,B)}else if("butt"===Tt)this.addCurrentVertex(z,Ce,0,0,B);else if("square"===Tt){const Je=j?1:-1;j||this.addCurrentVertex(z,Ce,Je,Je,B),this.addCurrentVertex(z,Ce,0,0,B),j&&this.addCurrentVertex(z,Ce,Je,Je,B)}else"round"===Tt&&(j&&(this.addCurrentVertex(z,Y,0,0,B),this.addCurrentVertex(z,Y,1,1,B,!0)),$&&(this.addCurrentVertex(z,te,-1,-1,B,!0),this.addCurrentVertex(z,te,0,0,B)));if(Ze&&me<D-1){const Je=z.dist($);if(Je>2*L){const mt=z.add($.sub(z)._mult(L/Je)._round());this.updateDistance(z,mt),this.addCurrentVertex(mt,te,0,0,B),z=mt}}}}addCurrentVertex(o,l,h,f,v,b=!1){const C=l.y*f-l.x,D=-l.y-l.x*f;this.addHalfVertex(o,l.x+l.y*h,l.y-l.x*h,b,!1,h,v),this.addHalfVertex(o,C,D,b,!0,-f,v)}addHalfVertex({x:o,y:l},h,f,v,b,C,D){this.layoutVertexArray.emplaceBack((o<<1)+(v?1:0),(l<<1)+(b?1:0),Math.round(63*h)+128,Math.round(63*f)+128,1+(0===C?0:C<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineClips.start,this.lineClips.end);const A=D.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,A),D.primitiveLength++),b?this.e2=A:this.e1=A}updateScaledDistance(){if(this.lineClips){const o=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=o*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(o,l){this.distance+=o.dist(l),this.updateScaledDistance()}}tn(Xs,"LineBucket",{omit:["layers","patternFeatures"]});const lg=new Bt({"line-cap":new Fe(rt.layout_line["line-cap"]),"line-join":new Fe(rt.layout_line["line-join"]),"line-miter-limit":new We(rt.layout_line["line-miter-limit"]),"line-round-limit":new We(rt.layout_line["line-round-limit"]),"line-sort-key":new Fe(rt.layout_line["line-sort-key"])});var px={paint:new Bt({"line-opacity":new Fe(rt.paint_line["line-opacity"]),"line-color":new Fe(rt.paint_line["line-color"]),"line-translate":new We(rt.paint_line["line-translate"]),"line-translate-anchor":new We(rt.paint_line["line-translate-anchor"]),"line-width":new Fe(rt.paint_line["line-width"]),"line-gap-width":new Fe(rt.paint_line["line-gap-width"]),"line-offset":new Fe(rt.paint_line["line-offset"]),"line-blur":new Fe(rt.paint_line["line-blur"]),"line-dasharray":new $t(rt.paint_line["line-dasharray"]),"line-pattern":new $t(rt.paint_line["line-pattern"]),"line-gradient":new kt(rt.paint_line["line-gradient"]),"line-trim-offset":new We(rt.paint_line["line-trim-offset"])}),layout:lg};const L1=new class extends Fe{possiblyEvaluate(a,o){return o=new ge(Math.floor(o.zoom),{now:o.now,fadeDuration:o.fadeDuration,zoomHistory:o.zoomHistory,transition:o.transition}),super.possiblyEvaluate(a,o)}evaluate(a,o,l,h){return o=ci({},o,{zoom:Math.floor(o.zoom)}),super.evaluate(a,o,l,h)}}(px.paint.properties["line-width"].specification);function O1(a,o){return o>0?o+2*a:a}L1.useIntegerZoom=!0;const F1=Lt([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),MT=Lt([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),N1=Lt([{name:"a_projected_pos",components:4,type:"Float32"}],4);Lt([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const CT=Lt([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),B1=Lt([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"}]);Lt([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const z1=Lt([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),ST=Lt([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);Lt([{name:"triangle",components:3,type:"Uint16"}]),Lt([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),Lt([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),Lt([{type:"Float32",name:"offsetX"}]),Lt([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);const Qc=128;function fx(a,o){const{expression:l}=o;if("constant"===l.kind)return{kind:"constant",layoutSize:l.evaluate(new ge(a+1))};if("source"===l.kind)return{kind:"source"};{const{zoomStops:h,interpolationType:f}=l;let v=0;for(;v<h.length&&h[v]<=a;)v++;v=Math.max(0,v-1);let b=v;for(;b<h.length&&h[b]<a+1;)b++;b=Math.min(h.length-1,b);const C=h[v],D=h[b];return"composite"===l.kind?{kind:"composite",minZoom:C,maxZoom:D,interpolationType:f}:{kind:"camera",minZoom:C,maxZoom:D,minSize:l.evaluate(new ge(C)),maxSize:l.evaluate(new ge(D)),interpolationType:f}}}function Qu(a,{uSize:o,uSizeT:l},{lowerSize:h,upperSize:f}){return"source"===a.kind?h/Qc:"composite"===a.kind?Oi(h/Qc,f/Qc,l):o}function ja(a,o){let l=0,h=0;if("constant"===a.kind)h=a.layoutSize;else if("source"!==a.kind){const{interpolationType:f,minZoom:v,maxZoom:b}=a,C=f?Ei(Lo.interpolationFactor(f,o,v,b),0,1):0;"camera"===a.kind?h=Oi(a.minSize,a.maxSize,C):l=C}return{uSizeT:l,uSize:h}}var ET=Object.freeze({__proto__:null,getSizeData:fx,evaluateSizeForFeature:Qu,evaluateSizeForZoom:ja,SIZE_PACK_FACTOR:Qc});function TT(a,o,l){return a.sections.forEach(h=>{h.text=function(f,v,b){const C=v.layout.get("text-transform").evaluate(b,{});return"uppercase"===C?f=f.toLocaleUpperCase():"lowercase"===C&&(f=f.toLocaleLowerCase()),Se.applyArabicShaping&&(f=Se.applyArabicShaping(f)),f}(h.text,o,l)}),a}const Cy={"!":"\ufe15","#":"\uff03",$:"\uff04","%":"\uff05","&":"\uff06","(":"\ufe35",")":"\ufe36","*":"\uff0a","+":"\uff0b",",":"\ufe10","-":"\ufe32",".":"\u30fb","/":"\uff0f",":":"\ufe13",";":"\ufe14","<":"\ufe3f","=":"\uff1d",">":"\ufe40","?":"\ufe16","@":"\uff20","[":"\ufe47","\\":"\uff3c","]":"\ufe48","^":"\uff3e",_:"\ufe33","`":"\uff40","{":"\ufe37","|":"\u2015","}":"\ufe38","~":"\uff5e","\xa2":"\uffe0","\xa3":"\uffe1","\xa5":"\uffe5","\xa6":"\uffe4","\xac":"\uffe2","\xaf":"\uffe3","\u2013":"\ufe32","\u2014":"\ufe31","\u2018":"\ufe43","\u2019":"\ufe44","\u201c":"\ufe41","\u201d":"\ufe42","\u2026":"\ufe19","\u2027":"\u30fb","\u20a9":"\uffe6","\u3001":"\ufe11","\u3002":"\ufe12","\u3008":"\ufe3f","\u3009":"\ufe40","\u300a":"\ufe3d","\u300b":"\ufe3e","\u300c":"\ufe41","\u300d":"\ufe42","\u300e":"\ufe43","\u300f":"\ufe44","\u3010":"\ufe3b","\u3011":"\ufe3c","\u3014":"\ufe39","\u3015":"\ufe3a","\u3016":"\ufe17","\u3017":"\ufe18","\uff01":"\ufe15","\uff08":"\ufe35","\uff09":"\ufe36","\uff0c":"\ufe10","\uff0d":"\ufe32","\uff0e":"\u30fb","\uff1a":"\ufe13","\uff1b":"\ufe14","\uff1c":"\ufe3f","\uff1e":"\ufe40","\uff1f":"\ufe16","\uff3b":"\ufe47","\uff3d":"\ufe48","\uff3f":"\ufe33","\uff5b":"\ufe37","\uff5c":"\u2015","\uff5d":"\ufe38","\uff5f":"\ufe35","\uff60":"\ufe36","\uff61":"\ufe12","\uff62":"\ufe41","\uff63":"\ufe42"};function gR(a){return"\ufe36"===a||"\ufe48"===a||"\ufe38"===a||"\ufe44"===a||"\ufe42"===a||"\ufe3e"===a||"\ufe3c"===a||"\ufe3a"===a||"\ufe18"===a||"\ufe40"===a||"\ufe10"===a||"\ufe13"===a||"\ufe14"===a||"\uff40"===a||"\uffe3"===a||"\ufe11"===a||"\ufe12"===a}function V1(a){return"\ufe35"===a||"\ufe47"===a||"\ufe37"===a||"\ufe43"===a||"\ufe41"===a||"\ufe3d"===a||"\ufe3b"===a||"\ufe39"===a||"\ufe17"===a||"\ufe3f"===a}var Sy=mr,Ma=function(a,o,l,h,f){var v,b,C=8*f-h-1,D=(1<<C)-1,A=D>>1,L=-7,B=l?f-1:0,z=l?-1:1,j=a[o+B];for(B+=z,v=j&(1<<-L)-1,j>>=-L,L+=C;L>0;v=256*v+a[o+B],B+=z,L-=8);for(b=v&(1<<-L)-1,v>>=-L,L+=h;L>0;b=256*b+a[o+B],B+=z,L-=8);if(0===v)v=1-A;else{if(v===D)return b?NaN:1/0*(j?-1:1);b+=Math.pow(2,h),v-=A}return(j?-1:1)*b*Math.pow(2,v-h)},Ey=function(a,o,l,h,f,v){var b,C,D,A=8*v-f-1,L=(1<<A)-1,B=L>>1,z=23===f?Math.pow(2,-24)-Math.pow(2,-77):0,j=h?0:v-1,$=h?1:-1,Y=o<0||0===o&&1/o<0?1:0;for(o=Math.abs(o),isNaN(o)||o===1/0?(C=isNaN(o)?1:0,b=L):(b=Math.floor(Math.log(o)/Math.LN2),o*(D=Math.pow(2,-b))<1&&(b--,D*=2),(o+=b+B>=1?z/D:z*Math.pow(2,1-B))*D>=2&&(b++,D/=2),b+B>=L?(C=0,b=L):b+B>=1?(C=(o*D-1)*Math.pow(2,f),b+=B):(C=o*Math.pow(2,B-1)*Math.pow(2,f),b=0));f>=8;a[l+j]=255&C,j+=$,C/=256,f-=8);for(b=b<<f|C,A+=f;A>0;a[l+j]=255&b,j+=$,b/=256,A-=8);a[l+j-$]|=128*Y};function mr(a){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(a)?a:new Uint8Array(a||0),this.pos=0,this.type=0,this.length=this.buf.length}mr.Varint=0,mr.Fixed64=1,mr.Bytes=2,mr.Fixed32=5;var mx=4294967296,gx=1/mx,U1=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function hl(a){return a.type===mr.Bytes?a.readVarint()+a.pos:a.pos+1}function H1(a,o,l){var h=o<=16383?1:o<=2097151?2:o<=268435455?3:Math.floor(Math.log(o)/(7*Math.LN2));l.realloc(h);for(var f=l.pos-1;f>=a;f--)l.buf[f+h]=l.buf[f]}function _x(a,o){for(var l=0;l<a.length;l++)o.writeVarint(a[l])}function yx(a,o){for(var l=0;l<a.length;l++)o.writeSVarint(a[l])}function G1(a,o){for(var l=0;l<a.length;l++)o.writeFloat(a[l])}function _R(a,o){for(var l=0;l<a.length;l++)o.writeDouble(a[l])}function Pf(a,o){for(var l=0;l<a.length;l++)o.writeBoolean(a[l])}function vx(a,o){for(var l=0;l<a.length;l++)o.writeFixed32(a[l])}function j1(a,o){for(var l=0;l<a.length;l++)o.writeSFixed32(a[l])}function DT(a,o){for(var l=0;l<a.length;l++)o.writeFixed64(a[l])}function xx(a,o){for(var l=0;l<a.length;l++)o.writeSFixed64(a[l])}function Ty(a,o){return(a[o]|a[o+1]<<8|a[o+2]<<16)+16777216*a[o+3]}function Rf(a,o,l){a[l]=o,a[l+1]=o>>>8,a[l+2]=o>>>16,a[l+3]=o>>>24}function $1(a,o){return(a[o]|a[o+1]<<8|a[o+2]<<16)+(a[o+3]<<24)}function AT(a,o,l){o.glyphs=[],1===a&&l.readMessage(IT,o)}function IT(a,o,l){if(3===a){const{id:h,bitmap:f,width:v,height:b,left:C,top:D,advance:A}=l.readMessage(PT,{});o.glyphs.push({id:h,bitmap:new Yu({width:v+6,height:b+6},f),metrics:{width:v,height:b,left:C,top:D,advance:A}})}else 4===a?o.ascender=l.readSVarint():5===a&&(o.descender=l.readSVarint())}function PT(a,o,l){1===a?o.id=l.readVarint():2===a?o.bitmap=l.readBytes():3===a?o.width=l.readVarint():4===a?o.height=l.readVarint():5===a?o.left=l.readSVarint():6===a?o.top=l.readSVarint():7===a&&(o.advance=l.readVarint())}function Dy(a){let o=0,l=0;for(const b of a)o+=b.w*b.h,l=Math.max(l,b.w);a.sort((b,C)=>C.h-b.h);const h=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(o/.95)),l),h:1/0}];let f=0,v=0;for(const b of a)for(let C=h.length-1;C>=0;C--){const D=h[C];if(!(b.w>D.w||b.h>D.h)){if(b.x=D.x,b.y=D.y,v=Math.max(v,b.y+b.h),f=Math.max(f,b.x+b.w),b.w===D.w&&b.h===D.h){const A=h.pop();C<h.length&&(h[C]=A)}else b.h===D.h?(D.x+=b.w,D.w-=b.w):b.w===D.w?(D.y+=b.h,D.h-=b.h):(h.push({x:D.x+b.w,y:D.y,w:D.w-b.w,h:b.h}),D.y+=b.h,D.h-=b.h);break}}return{w:f,h:v,fill:o/(f*v)||0}}mr.prototype={destroy:function(){this.buf=null},readFields:function(a,o,l){for(l=l||this.length;this.pos<l;){var h=this.readVarint(),f=h>>3,v=this.pos;this.type=7&h,a(f,o,this),this.pos===v&&this.skip(h)}return o},readMessage:function(a,o){return this.readFields(a,o,this.readVarint()+this.pos)},readFixed32:function(){var a=Ty(this.buf,this.pos);return this.pos+=4,a},readSFixed32:function(){var a=$1(this.buf,this.pos);return this.pos+=4,a},readFixed64:function(){var a=Ty(this.buf,this.pos)+Ty(this.buf,this.pos+4)*mx;return this.pos+=8,a},readSFixed64:function(){var a=Ty(this.buf,this.pos)+$1(this.buf,this.pos+4)*mx;return this.pos+=8,a},readFloat:function(){var a=Ma(this.buf,this.pos,!0,23,4);return this.pos+=4,a},readDouble:function(){var a=Ma(this.buf,this.pos,!0,52,8);return this.pos+=8,a},readVarint:function(a){var o,l,h=this.buf;return o=127&(l=h[this.pos++]),l<128?o:(o|=(127&(l=h[this.pos++]))<<7,l<128?o:(o|=(127&(l=h[this.pos++]))<<14,l<128?o:(o|=(127&(l=h[this.pos++]))<<21,l<128?o:function(f,v,b){var C,D,A=b.buf;if(C=(112&(D=A[b.pos++]))>>4,D<128||(C|=(127&(D=A[b.pos++]))<<3,D<128)||(C|=(127&(D=A[b.pos++]))<<10,D<128)||(C|=(127&(D=A[b.pos++]))<<17,D<128)||(C|=(127&(D=A[b.pos++]))<<24,D<128)||(C|=(1&(D=A[b.pos++]))<<31,D<128))return function If(a,o,l){return l?4294967296*o+(a>>>0):4294967296*(o>>>0)+(a>>>0)}(f,C,v);throw new Error("Expected varint not more than 10 bytes")}(o|=(15&(l=h[this.pos]))<<28,a,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var a=this.readVarint();return a%2==1?(a+1)/-2:a/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var a=this.readVarint()+this.pos,o=this.pos;return this.pos=a,a-o>=12&&U1?U1.decode(this.buf.subarray(o,a)):function(l,h,f){for(var v="",b=h;b<f;){var C,D,A,L=l[b],B=null,z=L>239?4:L>223?3:L>191?2:1;if(b+z>f)break;1===z?L<128&&(B=L):2===z?128==(192&(C=l[b+1]))&&(B=(31&L)<<6|63&C)<=127&&(B=null):3===z?(D=l[b+2],128==(192&(C=l[b+1]))&&128==(192&D)&&((B=(15&L)<<12|(63&C)<<6|63&D)<=2047||B>=55296&&B<=57343)&&(B=null)):4===z&&(D=l[b+2],A=l[b+3],128==(192&(C=l[b+1]))&&128==(192&D)&&128==(192&A)&&((B=(15&L)<<18|(63&C)<<12|(63&D)<<6|63&A)<=65535||B>=1114112)&&(B=null)),null===B?(B=65533,z=1):B>65535&&(B-=65536,v+=String.fromCharCode(B>>>10&1023|55296),B=56320|1023&B),v+=String.fromCharCode(B),b+=z}return v}(this.buf,o,a)},readBytes:function(){var a=this.readVarint()+this.pos,o=this.buf.subarray(this.pos,a);return this.pos=a,o},readPackedVarint:function(a,o){if(this.type!==mr.Bytes)return a.push(this.readVarint(o));var l=hl(this);for(a=a||[];this.pos<l;)a.push(this.readVarint(o));return a},readPackedSVarint:function(a){if(this.type!==mr.Bytes)return a.push(this.readSVarint());var o=hl(this);for(a=a||[];this.pos<o;)a.push(this.readSVarint());return a},readPackedBoolean:function(a){if(this.type!==mr.Bytes)return a.push(this.readBoolean());var o=hl(this);for(a=a||[];this.pos<o;)a.push(this.readBoolean());return a},readPackedFloat:function(a){if(this.type!==mr.Bytes)return a.push(this.readFloat());var o=hl(this);for(a=a||[];this.pos<o;)a.push(this.readFloat());return a},readPackedDouble:function(a){if(this.type!==mr.Bytes)return a.push(this.readDouble());var o=hl(this);for(a=a||[];this.pos<o;)a.push(this.readDouble());return a},readPackedFixed32:function(a){if(this.type!==mr.Bytes)return a.push(this.readFixed32());var o=hl(this);for(a=a||[];this.pos<o;)a.push(this.readFixed32());return a},readPackedSFixed32:function(a){if(this.type!==mr.Bytes)return a.push(this.readSFixed32());var o=hl(this);for(a=a||[];this.pos<o;)a.push(this.readSFixed32());return a},readPackedFixed64:function(a){if(this.type!==mr.Bytes)return a.push(this.readFixed64());var o=hl(this);for(a=a||[];this.pos<o;)a.push(this.readFixed64());return a},readPackedSFixed64:function(a){if(this.type!==mr.Bytes)return a.push(this.readSFixed64());var o=hl(this);for(a=a||[];this.pos<o;)a.push(this.readSFixed64());return a},skip:function(a){var o=7&a;if(o===mr.Varint)for(;this.buf[this.pos++]>127;);else if(o===mr.Bytes)this.pos=this.readVarint()+this.pos;else if(o===mr.Fixed32)this.pos+=4;else{if(o!==mr.Fixed64)throw new Error("Unimplemented type: "+o);this.pos+=8}},writeTag:function(a,o){this.writeVarint(a<<3|o)},realloc:function(a){for(var o=this.length||16;o<this.pos+a;)o*=2;if(o!==this.length){var l=new Uint8Array(o);l.set(this.buf),this.buf=l,this.length=o}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(a){this.realloc(4),Rf(this.buf,a,this.pos),this.pos+=4},writeSFixed32:function(a){this.realloc(4),Rf(this.buf,a,this.pos),this.pos+=4},writeFixed64:function(a){this.realloc(8),Rf(this.buf,-1&a,this.pos),Rf(this.buf,Math.floor(a*gx),this.pos+4),this.pos+=8},writeSFixed64:function(a){this.realloc(8),Rf(this.buf,-1&a,this.pos),Rf(this.buf,Math.floor(a*gx),this.pos+4),this.pos+=8},writeVarint:function(a){(a=+a||0)>268435455||a<0?function(o,l){var h,f,v,C;if(o>=0?(h=o%4294967296|0,f=o/4294967296|0):(f=~(-o/4294967296),4294967295^(h=~(-o%4294967296))?h=h+1|0:(h=0,f=f+1|0)),o>=0x10000000000000000||o<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");l.realloc(10),v=h,(C=l).buf[C.pos++]=127&v|128,v>>>=7,C.buf[C.pos++]=127&v|128,v>>>=7,C.buf[C.pos++]=127&v|128,v>>>=7,C.buf[C.pos++]=127&v|128,C.buf[C.pos]=127&(v>>>=7),function(v,b){var C=(7&v)<<4;b.buf[b.pos++]|=C|((v>>>=3)?128:0),v&&(b.buf[b.pos++]=127&v|((v>>>=7)?128:0),v&&(b.buf[b.pos++]=127&v|((v>>>=7)?128:0),v&&(b.buf[b.pos++]=127&v|((v>>>=7)?128:0),v&&(b.buf[b.pos++]=127&v|((v>>>=7)?128:0),v&&(b.buf[b.pos++]=127&v)))))}(f,l)}(a,this):(this.realloc(4),this.buf[this.pos++]=127&a|(a>127?128:0),a<=127||(this.buf[this.pos++]=127&(a>>>=7)|(a>127?128:0),a<=127||(this.buf[this.pos++]=127&(a>>>=7)|(a>127?128:0),a<=127||(this.buf[this.pos++]=a>>>7&127))))},writeSVarint:function(a){this.writeVarint(a<0?2*-a-1:2*a)},writeBoolean:function(a){this.writeVarint(Boolean(a))},writeString:function(a){a=String(a),this.realloc(4*a.length),this.pos++;var o=this.pos;this.pos=function(h,f,v){for(var b,C,D=0;D<f.length;D++){if((b=f.charCodeAt(D))>55295&&b<57344){if(!C){b>56319||D+1===f.length?(h[v++]=239,h[v++]=191,h[v++]=189):C=b;continue}if(b<56320){h[v++]=239,h[v++]=191,h[v++]=189,C=b;continue}b=C-55296<<10|b-56320|65536,C=null}else C&&(h[v++]=239,h[v++]=191,h[v++]=189,C=null);b<128?h[v++]=b:(b<2048?h[v++]=b>>6|192:(b<65536?h[v++]=b>>12|224:(h[v++]=b>>18|240,h[v++]=b>>12&63|128),h[v++]=b>>6&63|128),h[v++]=63&b|128)}return v}(this.buf,a,this.pos);var l=this.pos-o;l>=128&&H1(o,l,this),this.pos=o-1,this.writeVarint(l),this.pos+=l},writeFloat:function(a){this.realloc(4),Ey(this.buf,a,this.pos,!0,23,4),this.pos+=4},writeDouble:function(a){this.realloc(8),Ey(this.buf,a,this.pos,!0,52,8),this.pos+=8},writeBytes:function(a){var o=a.length;this.writeVarint(o),this.realloc(o);for(var l=0;l<o;l++)this.buf[this.pos++]=a[l]},writeRawMessage:function(a,o){this.pos++;var l=this.pos;a(o,this);var h=this.pos-l;h>=128&&H1(l,h,this),this.pos=l-1,this.writeVarint(h),this.pos+=h},writeMessage:function(a,o,l){this.writeTag(a,mr.Bytes),this.writeRawMessage(o,l)},writePackedVarint:function(a,o){o.length&&this.writeMessage(a,_x,o)},writePackedSVarint:function(a,o){o.length&&this.writeMessage(a,yx,o)},writePackedBoolean:function(a,o){o.length&&this.writeMessage(a,Pf,o)},writePackedFloat:function(a,o){o.length&&this.writeMessage(a,G1,o)},writePackedDouble:function(a,o){o.length&&this.writeMessage(a,_R,o)},writePackedFixed32:function(a,o){o.length&&this.writeMessage(a,vx,o)},writePackedSFixed32:function(a,o){o.length&&this.writeMessage(a,j1,o)},writePackedFixed64:function(a,o){o.length&&this.writeMessage(a,DT,o)},writePackedSFixed64:function(a,o){o.length&&this.writeMessage(a,xx,o)},writeBytesField:function(a,o){this.writeTag(a,mr.Bytes),this.writeBytes(o)},writeFixed32Field:function(a,o){this.writeTag(a,mr.Fixed32),this.writeFixed32(o)},writeSFixed32Field:function(a,o){this.writeTag(a,mr.Fixed32),this.writeSFixed32(o)},writeFixed64Field:function(a,o){this.writeTag(a,mr.Fixed64),this.writeFixed64(o)},writeSFixed64Field:function(a,o){this.writeTag(a,mr.Fixed64),this.writeSFixed64(o)},writeVarintField:function(a,o){this.writeTag(a,mr.Varint),this.writeVarint(o)},writeSVarintField:function(a,o){this.writeTag(a,mr.Varint),this.writeSVarint(o)},writeStringField:function(a,o){this.writeTag(a,mr.Bytes),this.writeString(o)},writeFloatField:function(a,o){this.writeTag(a,mr.Fixed32),this.writeFloat(o)},writeDoubleField:function(a,o){this.writeTag(a,mr.Fixed64),this.writeDouble(o)},writeBooleanField:function(a,o){this.writeVarintField(a,Boolean(o))}};class cg{constructor(o,{pixelRatio:l,version:h,stretchX:f,stretchY:v,content:b}){this.paddedRect=o,this.pixelRatio=l,this.stretchX=f,this.stretchY=v,this.content=b,this.version=h}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class bx{constructor(o,l){const h={},f={};this.haveRenderCallbacks=[];const v=[];this.addImages(o,h,v),this.addImages(l,f,v);const{w:b,h:C}=Dy(v),D=new dl({width:b||1,height:C||1});for(const A in o){const L=o[A],B=h[A].paddedRect;dl.copy(L.data,D,{x:0,y:0},{x:B.x+1,y:B.y+1},L.data)}for(const A in l){const L=l[A],B=f[A].paddedRect,z=B.x+1,j=B.y+1,$=L.data.width,Y=L.data.height;dl.copy(L.data,D,{x:0,y:0},{x:z,y:j},L.data),dl.copy(L.data,D,{x:0,y:Y-1},{x:z,y:j-1},{width:$,height:1}),dl.copy(L.data,D,{x:0,y:0},{x:z,y:j+Y},{width:$,height:1}),dl.copy(L.data,D,{x:$-1,y:0},{x:z-1,y:j},{width:1,height:Y}),dl.copy(L.data,D,{x:0,y:0},{x:z+$,y:j},{width:1,height:Y})}this.image=D,this.iconPositions=h,this.patternPositions=f}addImages(o,l,h){for(const f in o){const v=o[f],b={x:0,y:0,w:v.data.width+2,h:v.data.height+2};h.push(b),l[f]=new cg(b,v),v.hasRenderCallback&&this.haveRenderCallbacks.push(f)}}patchUpdatedImages(o,l){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(h=>o.hasImage(h)),o.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const h in o.updatedImages)this.patchUpdatedImage(this.iconPositions[h],o.getImage(h),l),this.patchUpdatedImage(this.patternPositions[h],o.getImage(h),l)}patchUpdatedImage(o,l,h){if(!o||!l||o.version===l.version)return;o.version=l.version;const[f,v]=o.tl;h.update(l.data,void 0,{x:f,y:v})}}tn(cg,"ImagePosition"),tn(bx,"ImageAtlas");const Ca={horizontal:1,vertical:2,horizontalOnly:3};class ug{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(o,l){const h=new ug;return h.scale=o||1,h.fontStack=l,h}static forImage(o){const l=new ug;return l.imageName=o,l}}class kf{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(o,l){const h=new kf;for(let f=0;f<o.sections.length;f++){const v=o.sections[f];v.image?h.addImageSection(v):h.addTextSection(v,l)}return h}length(){return this.text.length}getSection(o){return this.sections[this.sectionIndex[o]]}getSections(){return this.sections}getSectionIndex(o){return this.sectionIndex[o]}getCharCode(o){return this.text.charCodeAt(o)}verticalizePunctuation(o){this.text=function(l,h){let f="";for(let v=0;v<l.length;v++){const b=l.charCodeAt(v+1)||null,C=l.charCodeAt(v-1)||null;f+=!h&&(b&&P(b)&&!Cy[l[v+1]]||C&&P(C)&&!Cy[l[v-1]])||!Cy[l[v]]?l[v]:Cy[l[v]]}return f}(this.text,o)}trim(){let o=0;for(let h=0;h<this.text.length&&dg[this.text.charCodeAt(h)];h++)o++;let l=this.text.length;for(let h=this.text.length-1;h>=0&&h>=o&&dg[this.text.charCodeAt(h)];h--)l--;this.text=this.text.substring(o,l),this.sectionIndex=this.sectionIndex.slice(o,l)}substring(o,l){const h=new kf;return h.text=this.text.substring(o,l),h.sectionIndex=this.sectionIndex.slice(o,l),h.sections=this.sections,h}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((o,l)=>Math.max(o,this.sections[l].scale),0)}addTextSection(o,l){this.text+=o.text,this.sections.push(ug.forText(o.scale,o.fontStack||l));const h=this.sections.length-1;for(let f=0;f<o.text.length;++f)this.sectionIndex.push(h)}addImageSection(o){const l=o.image?o.image.name:"";if(0===l.length)return void Vr("Can't add FormattedSection with an empty image.");const h=this.getNextImageSectionCharCode();h?(this.text+=String.fromCharCode(h),this.sections.push(ug.forImage(l)),this.sectionIndex.push(this.sections.length-1)):Vr("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Ay(a,o,l,h,f,v,b,C,D,A,L,B,z,j,$,Y){const te=kf.fromFeature(a,f);let me;B===Ca.vertical&&te.verticalizePunctuation(z);const{processBidirectionalText:Ce,processStyledBidirectionalText:fe}=Se;if(Ce&&1===te.sections.length){me=[];const Te=Ce(te.toString(),Cx(te,A,v,o,h,j,$));for(const Ze of Te){const $e=new kf;$e.text=Ze,$e.sections=te.sections;for(let ct=0;ct<Ze.length;ct++)$e.sectionIndex.push(0);me.push($e)}}else if(fe){me=[];const Te=fe(te.text,te.sectionIndex,Cx(te,A,v,o,h,j,$));for(const Ze of Te){const $e=new kf;$e.text=Ze[0],$e.sectionIndex=Ze[1],$e.sections=te.sections,me.push($e)}}else me=function(Te,Ze){const $e=[],ct=Te.text;let Tt=0;for(const Je of Ze)$e.push(Te.substring(Tt,Je)),Tt=Je;return Tt<ct.length&&$e.push(Te.substring(Tt,ct.length)),$e}(te,Cx(te,A,v,o,h,j,$));const be=[],Pe={positionedLines:be,text:te.toString(),top:L[1],bottom:L[1],left:L[0],right:L[0],writingMode:B,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(Te,Ze,$e,ct,Tt,Je,mt,yt,wt,It,ut,nn){let zn=0,on=0,ln=0;const qt="right"===yt?1:"left"===yt?0:.5;let Rn=!1;for(const ni of Tt){const Ti=ni.getSections();for(const Mr of Ti){if(Mr.imageName)continue;const kr=Ze[Mr.fontStack];if(kr&&(Rn=void 0!==kr.ascender&&void 0!==kr.descender,!Rn))break}if(!Rn)break}let li=0;for(const ni of Tt){ni.trim();const Ti=ni.getMaxScale(),Mr=24*(Ti-1),kr={positionedGlyphs:[],lineOffset:0};Te.positionedLines[li]=kr;const Lr=kr.positionedGlyphs;let Or=0;if(!ni.length()){on+=Je,++li;continue}let zr=0,is=0;for(let dn=0;dn<ni.length();dn++){const Ms=ni.getSection(dn),rs=ni.getSectionIndex(dn),zi=ni.getCharCode(dn);let Wr=Ms.scale,Ls=null,gr=null,cs=null,No=24,Cs=0;const ss=!(wt===Ca.horizontal||!ut&&!E(zi)||ut&&(dg[zi]||(ti=zi,Gu(ti)||ya(ti)||Z_(ti)||Bl(ti)||_(ti))));if(Ms.imageName){const Ea=ct[Ms.imageName];if(!Ea)continue;cs=Ms.imageName,Te.iconsInText=Te.iconsInText||!0,gr=Ea.paddedRect;const ys=Ea.displaySize;Wr=24*Wr/nn,Ls={width:ys[0],height:ys[1],left:1,top:-3,advance:ss?ys[1]:ys[0],localGlyph:!1},Cs=Rn?-Ls.height*Wr:24*Ti-17-ys[1]*Wr,No=Ls.advance;const rd=(ss?ys[0]:ys[1])*Wr-24*Ti;rd>0&&rd>Or&&(Or=rd)}else{const Ea=$e[Ms.fontStack];if(!Ea)continue;Ea[zi]&&(gr=Ea[zi]);const ys=Ze[Ms.fontStack];if(!ys)continue;const rd=ys.glyphs[zi];if(!rd)continue;if(Ls=rd.metrics,No=8203!==zi?24:0,Rn){const $f=void 0!==ys.ascender?Math.abs(ys.ascender):0,ap=void 0!==ys.descender?Math.abs(ys.descender):0,Sg=($f+ap)*Wr;zr<Sg&&(zr=Sg,is=($f-ap)/2*Wr),Cs=-$f*Wr}else Cs=24*(Ti-Wr)-17}ss?(Te.verticalizable=!0,Lr.push({glyph:zi,imageName:cs,x:zn,y:on+Cs,vertical:ss,scale:Wr,localGlyph:Ls.localGlyph,fontStack:Ms.fontStack,sectionIndex:rs,metrics:Ls,rect:gr}),zn+=No*Wr+It):(Lr.push({glyph:zi,imageName:cs,x:zn,y:on+Cs,vertical:ss,scale:Wr,localGlyph:Ls.localGlyph,fontStack:Ms.fontStack,sectionIndex:rs,metrics:Ls,rect:gr}),zn+=Ls.advance*Wr+It)}0!==Lr.length&&(ln=Math.max(zn-It,ln),Rn?Sx(Lr,qt,Or,is,Je*Ti/2):Sx(Lr,qt,Or,0,Je/2)),zn=0;const $s=Je*Ti+Or;kr.lineOffset=Math.max(Or,Mr),on+=$s,++li}var ti;const Fi=on,{horizontalAlign:Xn,verticalAlign:Br}=Iy(mt);(function(ni,Ti,Mr,kr,Lr,Or){const zr=(Ti-Mr)*Lr,is=-Or*kr;for(const $s of ni)for(const dn of $s.positionedGlyphs)dn.x+=zr,dn.y+=is})(Te.positionedLines,qt,Xn,Br,ln,Fi),Te.top+=-Br*Fi,Te.bottom=Te.top+Fi,Te.left+=-Xn*ln,Te.right=Te.left+ln,Te.hasBaseline=Rn}(Pe,o,l,h,me,b,C,D,B,A,z,Y),!function(Te){for(const Ze of Te)if(0!==Ze.positionedGlyphs.length)return!1;return!0}(be)&&Pe}const dg={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},tp={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function wx(a,o,l,h,f,v){if(o.imageName){const b=h[o.imageName];return b?b.displaySize[0]*o.scale*24/v+f:0}{const b=l[o.fontStack],C=b&&b.glyphs[a];return C?C.metrics.advance*o.scale+f:0}}function Mx(a,o,l,h){const f=Math.pow(a-o,2);return h?a<o?f/2:2*f:f+Math.abs(l)*l}function RT(a,o,l){let h=0;return 10===a&&(h-=1e4),l&&(h+=150),40!==a&&65288!==a||(h+=50),41!==o&&65289!==o||(h+=50),h}function kT(a,o,l,h,f,v){let b=null,C=Mx(o,l,f,v);for(const D of h){const A=Mx(o-D.x,l,f,v)+D.badness;A<=C&&(b=D,C=A)}return{index:a,x:o,priorBreak:b,badness:C}}function hg(a){return a?hg(a.priorBreak).concat(a.index):[]}function Cx(a,o,l,h,f,v,b){if("point"!==v)return[];if(!a)return[];const C=[],D=function(z,j,$,Y,te,me){let Ce=0;for(let fe=0;fe<z.length();fe++){const be=z.getSection(fe);Ce+=wx(z.getCharCode(fe),be,Y,te,j,me)}return Ce/Math.max(1,Math.ceil(Ce/$))}(a,o,l,h,f,b),A=a.text.indexOf("\u200b")>=0;let L=0;for(let z=0;z<a.length();z++){const j=a.getSection(z),$=a.getCharCode(z);if(dg[$]||(L+=wx($,j,h,f,o,b)),z<a.length()-1){const Y=!((B=$)<11904||!(sf(B)||Od(B)||Uh(B)||fo(B)||jm(B)||rf(B)||Gm(B)||ju(B)||$m(B)||cf(B)||lf(B)||u(B)||kd(B)||Hm(B)||X_(B)||af(B)||Ld(B)||ts(B)||Y_(B)||Fd(B)));(tp[$]||Y||j.imageName)&&C.push(kT(z+1,L,D,C,RT($,a.getCharCode(z+1),Y&&A),!1))}}var B;return hg(kT(a.length(),L,D,C,0,!0))}function Iy(a){let o=.5,l=.5;switch(a){case"right":case"top-right":case"bottom-right":o=1;break;case"left":case"top-left":case"bottom-left":o=0}switch(a){case"bottom":case"bottom-right":case"bottom-left":l=1;break;case"top":case"top-right":case"top-left":l=0}return{horizontalAlign:o,verticalAlign:l}}function Sx(a,o,l,h,f){if(!(o||l||h||f))return;const v=a.length-1,b=a[v],C=(b.x+b.metrics.advance*b.scale)*o;for(let D=0;D<=v;D++)a[D].x-=C,a[D].y+=l+h+f}function W1(a,o,l){const{horizontalAlign:h,verticalAlign:f}=Iy(l),v=o[0]-a.displaySize[0]*h,b=o[1]-a.displaySize[1]*f;return{image:a,top:b,bottom:b+a.displaySize[1],left:v,right:v+a.displaySize[0]}}function Py(a,o,l,h,f,v){const b=a.image;let C;if(b.content){const te=b.content,me=b.pixelRatio||1;C=[te[0]/me,te[1]/me,b.displaySize[0]-te[2]/me,b.displaySize[1]-te[3]/me]}const D=o.left*v,A=o.right*v;let L,B,z,j;"width"===l||"both"===l?(j=f[0]+D-h[3],B=f[0]+A+h[1]):(j=f[0]+(D+A-b.displaySize[0])/2,B=j+b.displaySize[0]);const $=o.top*v,Y=o.bottom*v;return"height"===l||"both"===l?(L=f[1]+$-h[0],z=f[1]+Y+h[2]):(L=f[1]+($+Y-b.displaySize[1])/2,z=L+b.displaySize[1]),{image:b,top:L,right:B,bottom:z,left:j,collisionPadding:C}}class Jc extends Ht{constructor(o,l,h,f,v){super(o,l),this.angle=f,this.z=h,void 0!==v&&(this.segment=v)}clone(){return new Jc(this.x,this.y,this.z,this.angle,this.segment)}}function pg(a,o,l,h,f){if(void 0===o.segment)return!0;let v=o,b=o.segment+1,C=0;for(;C>-l/2;){if(b--,b<0)return!1;C-=a[b].dist(v),v=a[b]}C+=a[b].dist(a[b+1]),b++;const D=[];let A=0;for(;C<l/2;){const L=a[b],B=a[b+1];if(!B)return!1;let z=a[b-1].angleTo(L)-L.angleTo(B);for(z=Math.abs((z+3*Math.PI)%(2*Math.PI)-Math.PI),D.push({distance:C,angleDelta:z}),A+=z;C-D[0].distance>h;)A-=D.shift().angleDelta;if(A>f)return!1;b++,C+=L.dist(B)}return!0}function fg(a){let o=0;for(let l=0;l<a.length-1;l++)o+=a[l].dist(a[l+1]);return o}function Ex(a,o,l){return a?.6*o*l:0}function Ry(a,o){return Math.max(a?a.right-a.left:0,o?o.right-o.left:0)}function q1(a,o,l,h,f,v){const b=Ex(l,f,v),C=Ry(l,h)*v;let D=0;const A=fg(a)/2;for(let L=0;L<a.length-1;L++){const B=a[L],z=a[L+1],j=B.dist(z);if(D+j>A){const $=(A-D)/j,Y=Oi(B.x,z.x,$),te=Oi(B.y,z.y,$),me=new Jc(Y,te,0,z.angleTo(B),L);return!b||pg(a,me,C,b,o)?me:void 0}D+=j}}function Tx(a,o,l,h,f,v,b,C,D){const A=Ex(h,v,b),L=Ry(h,f),B=L*b,z=0===a[0].x||a[0].x===D||0===a[0].y||a[0].y===D;return o-B<o/4&&(o=B+o/4),Lf(a,z?o/2*C%o:(L/2+2*v)*b*C%o,o,A,l,B,z,!1,D)}function Lf(a,o,l,h,f,v,b,C,D){const A=v/2,L=fg(a);let B=0,z=o-l,j=[];for(let $=0;$<a.length-1;$++){const Y=a[$],te=a[$+1],me=Y.dist(te),Ce=te.angleTo(Y);for(;z+l<B+me;){z+=l;const fe=(z-B)/me,be=Oi(Y.x,te.x,fe),Pe=Oi(Y.y,te.y,fe);if(be>=0&&be<D&&Pe>=0&&Pe<D&&z-A>=0&&z+A<=L){const Te=new Jc(be,Pe,0,Ce,$);Te._round(),h&&!pg(a,Te,v,h,f)||j.push(Te)}}B+=me}return C||j.length||b||(j=Lf(a,B/2,l,h,f,v,b,!0,D)),j}function Z1(a,o,l,h,f){const v=[];for(let b=0;b<a.length;b++){const C=a[b];let D;for(let A=0;A<C.length-1;A++){let L=C[A],B=C[A+1];L.x<o&&B.x<o||(L.x<o?L=new Ht(o,L.y+(o-L.x)/(B.x-L.x)*(B.y-L.y))._round():B.x<o&&(B=new Ht(o,L.y+(o-L.x)/(B.x-L.x)*(B.y-L.y))._round()),L.y<l&&B.y<l||(L.y<l?L=new Ht(L.x+(l-L.y)/(B.y-L.y)*(B.x-L.x),l)._round():B.y<l&&(B=new Ht(L.x+(l-L.y)/(B.y-L.y)*(B.x-L.x),l)._round()),L.x>=h&&B.x>=h||(L.x>=h?L=new Ht(h,L.y+(h-L.x)/(B.x-L.x)*(B.y-L.y))._round():B.x>=h&&(B=new Ht(h,L.y+(h-L.x)/(B.x-L.x)*(B.y-L.y))._round()),L.y>=f&&B.y>=f||(L.y>=f?L=new Ht(L.x+(f-L.y)/(B.y-L.y)*(B.x-L.x),f)._round():B.y>=f&&(B=new Ht(L.x+(f-L.y)/(B.y-L.y)*(B.x-L.x),f)._round()),D&&L.equals(D[D.length-1])||(D=[L],v.push(D)),D.push(B)))))}}return v}tn(Jc,"Anchor");const Of=1e20;function X1(a,o,l,h,f,v,b,C,D){for(let A=o;A<o+h;A++)Y1(a,l*v+A,v,f,b,C,D);for(let A=l;A<l+f;A++)Y1(a,A*v+o,1,h,b,C,D)}function Y1(a,o,l,h,f,v,b){v[0]=0,b[0]=-Of,b[1]=Of,f[0]=a[o];for(let C=1,D=0,A=0;C<h;C++){f[C]=a[o+C*l];const L=C*C;do{const B=v[D];A=(f[C]-f[B]+L-B*B)/(C-B)/2}while(A<=b[D]&&--D>-1);D++,v[D]=C,b[D]=A,b[D+1]=Of}for(let C=0,D=0;C<h;C++){for(;b[D+1]<C;)D++;const A=v[D],L=C-A;a[o+C*l]=f[A]+L*L}}const ky={none:0,ideographs:1,all:2};class Vd{constructor(o,l,h){this.requestManager=o,this.localGlyphMode=l,this.localFontFamily=h,this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(o){this.url=o}getGlyphs(o,l){const h=[];for(const f in o)for(const v of o[f])h.push({stack:f,id:v});Rc(h,({stack:f,id:v},b)=>{let C=this.entries[f];C||(C=this.entries[f]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let D=C.glyphs[v];if(void 0!==D)return void b(null,{stack:f,id:v,glyph:D});if(D=this._tinySDF(C,f,v),D)return C.glyphs[v]=D,void b(null,{stack:f,id:v,glyph:D});const A=Math.floor(v/256);if(256*A>65535)return void b(new Error("glyphs > 65535 not supported"));if(C.ranges[A])return void b(null,{stack:f,id:v,glyph:D});let L=C.requests[A];L||(L=C.requests[A]=[],Vd.loadGlyphRange(f,A,this.url,this.requestManager,(B,z)=>{if(z){C.ascender=z.ascender,C.descender=z.descender;for(const j in z.glyphs)this._doesCharSupportLocalGlyph(+j)||(C.glyphs[+j]=z.glyphs[+j]);C.ranges[A]=!0}for(const j of L)j(B,z);delete C.requests[A]})),L.push((B,z)=>{B?b(B):z&&b(null,{stack:f,id:v,glyph:z.glyphs[v]||null})})},(f,v)=>{if(f)l(f);else if(v){const b={};for(const{stack:C,id:D,glyph:A}of v)void 0===b[C]&&(b[C]={}),void 0===b[C].glyphs&&(b[C].glyphs={}),b[C].glyphs[D]=A&&{id:A.id,bitmap:A.bitmap.clone(),metrics:A.metrics},b[C].ascender=this.entries[C].ascender,b[C].descender=this.entries[C].descender;l(null,b)}})}_doesCharSupportLocalGlyph(o){return this.localGlyphMode!==ky.none&&(this.localGlyphMode===ky.all?!!this.localFontFamily:!!this.localFontFamily&&(cf(o)||K_(o)||kd(o)||Ld(o)||ju(o)))}_tinySDF(o,l,h){const f=this.localFontFamily;if(!f||!this._doesCharSupportLocalGlyph(h))return;let v=o.tinySDF;if(!v){let Y="400";/bold/i.test(l)?Y="900":/medium/i.test(l)?Y="500":/light/i.test(l)&&(Y="200"),v=o.tinySDF=new Vd.TinySDF({fontFamily:f,fontWeight:Y,fontSize:48,buffer:6,radius:16}),v.fontWeight=Y}if(this.localGlyphs[v.fontWeight][h])return this.localGlyphs[v.fontWeight][h];const b=String.fromCharCode(h),{data:C,width:D,height:A,glyphWidth:L,glyphHeight:B,glyphLeft:z,glyphTop:j,glyphAdvance:$}=v.draw(b);return this.localGlyphs[v.fontWeight][h]={id:h,bitmap:new Yu({width:D,height:A},C),metrics:{width:L/2,height:B/2,left:z/2,top:j/2-27,advance:$/2,localGlyph:!0}}}}function Dx(a,o,l,h){const f=[],v=a.image,b=v.pixelRatio,C=v.paddedRect.w-2,D=v.paddedRect.h-2,A=a.right-a.left,L=a.bottom-a.top,B=v.stretchX||[[0,C]],z=v.stretchY||[[0,D]],j=(Je,mt)=>Je+mt[1]-mt[0],$=B.reduce(j,0),Y=z.reduce(j,0),te=C-$,me=D-Y;let Ce=0,fe=$,be=0,Pe=Y,Te=0,Ze=te,$e=0,ct=me;if(v.content&&h){const Je=v.content;Ce=Ax(B,0,Je[0]),be=Ax(z,0,Je[1]),fe=Ax(B,Je[0],Je[2]),Pe=Ax(z,Je[1],Je[3]),Te=Je[0]-Ce,$e=Je[1]-be,Ze=Je[2]-Je[0]-fe,ct=Je[3]-Je[1]-Pe}const Tt=(Je,mt,yt,wt)=>{const It=Ly(Je.stretch-Ce,fe,A,a.left),ut=mg(Je.fixed-Te,Ze,Je.stretch,$),nn=Ly(mt.stretch-be,Pe,L,a.top),zn=mg(mt.fixed-$e,ct,mt.stretch,Y),on=Ly(yt.stretch-Ce,fe,A,a.left),ln=mg(yt.fixed-Te,Ze,yt.stretch,$),qt=Ly(wt.stretch-be,Pe,L,a.top),Rn=mg(wt.fixed-$e,ct,wt.stretch,Y),li=new Ht(It,nn),ti=new Ht(on,nn),Fi=new Ht(on,qt),Xn=new Ht(It,qt),Br=new Ht(ut/b,zn/b),ni=new Ht(ln/b,Rn/b),Ti=o*Math.PI/180;if(Ti){const Lr=Math.sin(Ti),Or=Math.cos(Ti),zr=[Or,-Lr,Lr,Or];li._matMult(zr),ti._matMult(zr),Xn._matMult(zr),Fi._matMult(zr)}const Mr=Je.stretch+Je.fixed,kr=mt.stretch+mt.fixed;return{tl:li,tr:ti,bl:Xn,br:Fi,tex:{x:v.paddedRect.x+1+Mr,y:v.paddedRect.y+1+kr,w:yt.stretch+yt.fixed-Mr,h:wt.stretch+wt.fixed-kr},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Br,pixelOffsetBR:ni,minFontScaleX:Ze/b/A,minFontScaleY:ct/b/L,isSDF:l}};if(h&&(v.stretchX||v.stretchY)){const Je=Ix(B,te,$),mt=Ix(z,me,Y);for(let yt=0;yt<Je.length-1;yt++){const wt=Je[yt],It=Je[yt+1];for(let ut=0;ut<mt.length-1;ut++)f.push(Tt(wt,mt[ut],It,mt[ut+1]))}}else f.push(Tt({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:C+1},{fixed:0,stretch:D+1}));return f}function Ax(a,o,l){let h=0;for(const f of a)h+=Math.max(o,Math.min(l,f[1]))-Math.max(o,Math.min(l,f[0]));return h}function Ix(a,o,l){const h=[{fixed:-1,stretch:0}];for(const[f,v]of a){const b=h[h.length-1];h.push({fixed:f-b.stretch,stretch:b.stretch}),h.push({fixed:f-b.stretch,stretch:b.stretch+(v-f)})}return h.push({fixed:o+1,stretch:l}),h}function Ly(a,o,l,h){return a/o*l+h}function mg(a,o,l,h){return a-o*l/h}function LT(a,o,l,h){const f=o+a.positionedLines[h].lineOffset;return 0===h?l+f/2:l+(f+(o+a.positionedLines[h-1].lineOffset))/2}Vd.loadGlyphRange=function(a,o,l,h,f){const v=256*o,b=v+255,C=h.transformRequest(h.normalizeGlyphsURL(l).replace("{fontstack}",a).replace("{range}",`${v}-${b}`),Ra.Glyphs);Tu(C,(D,A)=>{if(D)f(D);else if(A){const L={},B=new Sy(A).readFields(AT,{});for(const z of B.glyphs)L[z.id]=z;f(null,{glyphs:L,ascender:B.ascender,descender:B.descender})}})},Vd.TinySDF=class{constructor({fontSize:a=24,buffer:o=3,radius:l=8,cutoff:h=.25,fontFamily:f="sans-serif",fontWeight:v="normal",fontStyle:b="normal"}={}){this.buffer=o,this.cutoff=h,this.radius=l;const C=this.size=a+4*o,D=this._createCanvas(C),A=this.ctx=D.getContext("2d",{willReadFrequently:!0});A.font=`${b} ${v} ${a}px ${f}`,A.textBaseline="alphabetic",A.textAlign="left",A.fillStyle="black",this.gridOuter=new Float64Array(C*C),this.gridInner=new Float64Array(C*C),this.f=new Float64Array(C),this.z=new Float64Array(C+1),this.v=new Uint16Array(C)}_createCanvas(a){const o=document.createElement("canvas");return o.width=o.height=a,o}draw(a){const{width:o,actualBoundingBoxAscent:l,actualBoundingBoxDescent:h,actualBoundingBoxLeft:f,actualBoundingBoxRight:v}=this.ctx.measureText(a),b=Math.ceil(l),C=Math.min(this.size-this.buffer,Math.ceil(v-f)),D=Math.min(this.size-this.buffer,b+Math.ceil(h)),A=C+2*this.buffer,L=D+2*this.buffer,B=Math.max(A*L,0),z=new Uint8ClampedArray(B),j={data:z,width:A,height:L,glyphWidth:C,glyphHeight:D,glyphTop:b,glyphLeft:0,glyphAdvance:o};if(0===C||0===D)return j;const{ctx:$,buffer:Y,gridInner:te,gridOuter:me}=this;$.clearRect(Y,Y,C,D),$.fillText(a,Y,Y+b);const Ce=$.getImageData(Y,Y,C,D);me.fill(Of,0,B),te.fill(0,0,B);for(let fe=0;fe<D;fe++)for(let be=0;be<C;be++){const Pe=Ce.data[4*(fe*C+be)+3]/255;if(0===Pe)continue;const Te=(fe+Y)*A+be+Y;if(1===Pe)me[Te]=0,te[Te]=Of;else{const Ze=.5-Pe;me[Te]=Ze>0?Ze*Ze:0,te[Te]=Ze<0?Ze*Ze:0}}X1(me,0,0,A,L,A,this.f,this.v,this.z),X1(te,Y,Y,C,D,A,this.f,this.v,this.z);for(let fe=0;fe<B;fe++){const be=Math.sqrt(me[fe])-Math.sqrt(te[fe]);z[fe]=Math.round(255-255*(be/this.radius+this.cutoff))}return j}};class OT{constructor(o=[],l=mc){if(this.data=o,this.length=this.data.length,this.compare=l,this.length>0)for(let h=(this.length>>1)-1;h>=0;h--)this._down(h)}push(o){this.data.push(o),this.length++,this._up(this.length-1)}pop(){if(0===this.length)return;const o=this.data[0],l=this.data.pop();return this.length--,this.length>0&&(this.data[0]=l,this._down(0)),o}peek(){return this.data[0]}_up(o){const{data:l,compare:h}=this,f=l[o];for(;o>0;){const v=o-1>>1,b=l[v];if(h(f,b)>=0)break;l[o]=b,o=v}l[o]=f}_down(o){const{data:l,compare:h}=this,f=this.length>>1,v=l[o];for(;o<f;){let b=1+(o<<1),C=l[b];const D=b+1;if(D<this.length&&h(l[D],C)<0&&(b=D,C=l[D]),h(C,v)>=0)break;l[o]=C,o=b}l[o]=v}}function mc(a,o){return a<o?-1:a>o?1:0}function FT(a,o=1,l=!1){let h=1/0,f=1/0,v=-1/0,b=-1/0;const C=a[0];for(let j=0;j<C.length;j++){const $=C[j];(!j||$.x<h)&&(h=$.x),(!j||$.y<f)&&(f=$.y),(!j||$.x>v)&&(v=$.x),(!j||$.y>b)&&(b=$.y)}const D=Math.min(v-h,b-f);let A=D/2;const L=new OT([],K1);if(0===D)return new Ht(h,f);for(let j=h;j<v;j+=D)for(let $=f;$<b;$+=D)L.push(new Ff(j+A,$+A,A,a));let B=function(j){let $=0,Y=0,te=0;const me=j[0];for(let Ce=0,fe=me.length,be=fe-1;Ce<fe;be=Ce++){const Pe=me[Ce],Te=me[be],Ze=Pe.x*Te.y-Te.x*Pe.y;Y+=(Pe.x+Te.x)*Ze,te+=(Pe.y+Te.y)*Ze,$+=3*Ze}return new Ff(Y/$,te/$,0,j)}(a),z=L.length;for(;L.length;){const j=L.pop();(j.d>B.d||!B.d)&&(B=j,l&&console.log("found best %d after %d probes",Math.round(1e4*j.d)/1e4,z)),j.max-B.d<=o||(A=j.h/2,L.push(new Ff(j.p.x-A,j.p.y-A,A,a)),L.push(new Ff(j.p.x+A,j.p.y-A,A,a)),L.push(new Ff(j.p.x-A,j.p.y+A,A,a)),L.push(new Ff(j.p.x+A,j.p.y+A,A,a)),z+=4)}return l&&(console.log(`num probes: ${z}`),console.log(`best distance: ${B.d}`)),B.p}function K1(a,o){return o.max-a.max}function Ff(a,o,l,h){this.p=new Ht(a,o),this.h=l,this.d=function(f,v){let b=!1,C=1/0;for(let D=0;D<v.length;D++){const A=v[D];for(let L=0,B=A.length,z=B-1;L<B;z=L++){const j=A[L],$=A[z];j.y>f.y!=$.y>f.y&&f.x<($.x-j.x)*(f.y-j.y)/($.y-j.y)+j.x&&(b=!b),C=Math.min(C,oT(f,j,$))}}return(b?1:-1)*Math.sqrt(C)}(this.p,h),this.max=this.d+this.h*Math.SQRT2}const Px=Number.POSITIVE_INFINITY,NT=Math.sqrt(2);function Q1(a,o){return o[1]!==Px?function(l,h,f){let v=0,b=0;switch(h=Math.abs(h),f=Math.abs(f),l){case"top-right":case"top-left":case"top":b=f-7;break;case"bottom-right":case"bottom-left":case"bottom":b=7-f}switch(l){case"top-right":case"bottom-right":case"right":v=-h;break;case"top-left":case"bottom-left":case"left":v=h}return[v,b]}(a,o[0],o[1]):function(l,h){let f=0,v=0;h<0&&(h=0);const b=h/NT;switch(l){case"top-right":case"top-left":v=b-7;break;case"bottom-right":case"bottom-left":v=7-b;break;case"bottom":v=7-h;break;case"top":v=h-7}switch(l){case"top-right":case"bottom-right":f=-b;break;case"top-left":case"bottom-left":f=b;break;case"left":f=h;break;case"right":f=-h}return[f,v]}(a,o[0])}function J1(a,o,l,h,f,v,b,C,D,A){a.createArrays(),a.tilePixelRatio=Un/(512*a.overscaling),a.compareText={},a.iconsNeedLinear=!1;const L=a.layers[0].layout,B=a.layers[0]._unevaluatedLayout._values,z={};if("composite"===a.textSizeData.kind){const{minZoom:Y,maxZoom:te}=a.textSizeData;z.compositeTextSizes=[B["text-size"].possiblyEvaluate(new ge(Y),C),B["text-size"].possiblyEvaluate(new ge(te),C)]}if("composite"===a.iconSizeData.kind){const{minZoom:Y,maxZoom:te}=a.iconSizeData;z.compositeIconSizes=[B["icon-size"].possiblyEvaluate(new ge(Y),C),B["icon-size"].possiblyEvaluate(new ge(te),C)]}z.layoutTextSize=B["text-size"].possiblyEvaluate(new ge(D+1),C),z.layoutIconSize=B["icon-size"].possiblyEvaluate(new ge(D+1),C),z.textMaxSize=B["text-size"].possiblyEvaluate(new ge(18),C);const j="map"===L.get("text-rotation-alignment")&&"point"!==L.get("symbol-placement"),$=L.get("text-size");for(const Y of a.features){const te=L.get("text-font").evaluate(Y,{},C).join(","),me=$.evaluate(Y,{},C),Ce=z.layoutTextSize.evaluate(Y,{},C),fe=(z.layoutIconSize.evaluate(Y,{},C),{horizontal:{},vertical:void 0}),be=Y.text;let Pe,Te=[0,0];if(be){const ct=be.toString(),Tt=24*L.get("text-letter-spacing").evaluate(Y,{},C),Je=24*L.get("text-line-height").evaluate(Y,{},C),mt=x(ct)?Tt:0,yt=L.get("text-anchor").evaluate(Y,{},C),wt=L.get("text-variable-anchor");if(!wt){const ln=L.get("text-radial-offset").evaluate(Y,{},C);Te=ln?Q1(yt,[24*ln,Px]):L.get("text-offset").evaluate(Y,{},C).map(qt=>24*qt)}let It=j?"center":L.get("text-justify").evaluate(Y,{},C);const ut=L.get("symbol-placement"),nn="point"===ut,zn="point"===ut?24*L.get("text-max-width").evaluate(Y,{},C):0,on=ln=>{a.allowVerticalPlacement&&p(ct)&&(fe.vertical=Ay(be,o,l,f,te,zn,Je,yt,ln,mt,Te,Ca.vertical,!0,ut,Ce,me))};if(!j&&wt){const ln="auto"===It?wt.map(Rn=>Rx(Rn)):[It];let qt=!1;for(let Rn=0;Rn<ln.length;Rn++){const li=ln[Rn];if(!fe.horizontal[li])if(qt)fe.horizontal[li]=fe.horizontal[0];else{const ti=Ay(be,o,l,f,te,zn,Je,"center",li,mt,Te,Ca.horizontal,!1,ut,Ce,me);ti&&(fe.horizontal[li]=ti,qt=1===ti.positionedLines.length)}}on("left")}else{if("auto"===It&&(It=Rx(yt)),nn||L.get("text-writing-mode").indexOf("horizontal")>=0||!p(ct)){const ln=Ay(be,o,l,f,te,zn,Je,yt,It,mt,Te,Ca.horizontal,!1,ut,Ce,me);ln&&(fe.horizontal[It]=ln)}on("point"===ut?"left":It)}}let Ze=!1;if(Y.icon&&Y.icon.name){const ct=h[Y.icon.name];ct&&(Pe=W1(f[Y.icon.name],L.get("icon-offset").evaluate(Y,{},C),L.get("icon-anchor").evaluate(Y,{},C)),Ze=ct.sdf,void 0===a.sdfIcons?a.sdfIcons=ct.sdf:a.sdfIcons!==ct.sdf&&Vr("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(ct.pixelRatio!==a.pixelRatio||0!==L.get("icon-rotate").constantOr(1))&&(a.iconsNeedLinear=!0))}const $e=Et(fe.horizontal)||fe.vertical;a.iconsInText||(a.iconsInText=!!$e&&$e.iconsInText),($e||Pe)&&BT(a,Y,fe,Pe,h,z,Ce,0,Te,Ze,b,C,A)}v&&a.generateCollisionDebugBuffers(D,a.collisionBoxArray)}function Rx(a){switch(a){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function BT(a,o,l,h,f,v,b,C,D,A,L,B,z){let j=v.textMaxSize.evaluate(o,{},B);void 0===j&&(j=b);const $=a.layers[0].layout,Y=$.get("icon-offset").evaluate(o,{},B),te=Et(l.horizontal)||l.vertical,me="globe"===z.name,Ce=b/24,fe=a.tilePixelRatio*j/24,be=(mt=a.overscaling,a.zoom>18&&mt>2&&(mt>>=1),Math.max(Un/(512*mt),1)*$.get("symbol-spacing")),Pe=$.get("text-padding")*a.tilePixelRatio,Te=$.get("icon-padding")*a.tilePixelRatio,Ze=Si($.get("text-max-angle")),$e="map"===$.get("text-rotation-alignment")&&"point"!==$.get("symbol-placement"),ct="map"===$.get("icon-rotation-alignment")&&"point"!==$.get("symbol-placement"),Tt=$.get("symbol-placement"),Je=be/2;var mt;const yt=$.get("icon-text-fit");let wt;h&&"none"!==yt&&(a.allowVerticalPlacement&&l.vertical&&(wt=Py(h,l.vertical,yt,$.get("icon-text-fit-padding"),Y,Ce)),te&&(h=Py(h,te,yt,$.get("icon-text-fit-padding"),Y,Ce)));const It=(ut,nn,zn)=>{if(nn.x<0||nn.x>=Un||nn.y<0||nn.y>=Un)return;let on=null;if(me){const{x:ln,y:qt,z:Rn}=z.projectTilePoint(nn.x,nn.y,zn);on={anchor:new Jc(ln,qt,Rn,0,void 0),up:z.upVector(zn,nn.x,nn.y)}}!function(ln,qt,Rn,li,ti,Fi,Xn,Br,ni,Ti,Mr,kr,Lr,Or,zr,is,$s,dn,Ms,rs,zi,Wr,Ls,gr,cs){const No=ln.addToLineVertexArray(qt,li);let Cs,ss,Ea,ys,rd,$f,ap,Sg=0,vc=0,Wf=0,Bo=0,sd=-1,qf=-1;const Os={};let tr=Gh.exports("");const Wl=Rn?Rn.anchor:qt;let Wd=0,qd=0;if(void 0===ni._unevaluatedLayout.getValue("text-radial-offset")?[Wd,qd]=ni.layout.get("text-offset").evaluate(zi,{},cs).map(Ys=>24*Ys):(Wd=24*ni.layout.get("text-radial-offset").evaluate(zi,{},cs),qd=Px),ln.allowVerticalPlacement&&ti.vertical){const Ys=ti.vertical;if(zr)$f=Oy(Ys),Br&&(ap=Oy(Br));else{const Ks=ni.layout.get("text-rotate").evaluate(zi,{},cs)+90;Ea=gg(Ti,Wl,qt,Mr,kr,Lr,Ys,Or,Ks,is),Br&&(ys=gg(Ti,Wl,qt,Mr,kr,Lr,Br,dn,Ks))}}if(Fi){const Ys=ni.layout.get("icon-rotate").evaluate(zi,{},cs),Ks="none"!==ni.layout.get("icon-text-fit"),nu=Dx(Fi,Ys,Ls,Ks),Qy=Br?Dx(Br,Ys,Ls,Ks):void 0;ss=gg(Ti,Wl,qt,Mr,kr,Lr,Fi,dn,Ys),Sg=4*nu.length;const sb=ln.iconSizeData;let Xd=null;"source"===sb.kind?(Xd=[Qc*ni.layout.get("icon-size").evaluate(zi,{},cs)],Xd[0]>Ud&&Vr(`${ln.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):"composite"===sb.kind&&(Xd=[Qc*Wr.compositeIconSizes[0].evaluate(zi,{},cs),Qc*Wr.compositeIconSizes[1].evaluate(zi,{},cs)],(Xd[0]>Ud||Xd[1]>Ud)&&Vr(`${ln.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),ln.addSymbols(ln.icon,nu,Xd,rs,Ms,zi,!1,Rn,qt,No.lineStartIndex,No.lineLength,-1,gr,cs),sd=ln.icon.placedSymbolArray.length-1,Qy&&(vc=4*Qy.length,ln.addSymbols(ln.icon,Qy,Xd,rs,Ms,zi,Ca.vertical,Rn,qt,No.lineStartIndex,No.lineLength,-1,gr,cs),qf=ln.icon.placedSymbolArray.length-1)}for(const Ys in ti.horizontal){const Ks=ti.horizontal[Ys];Cs||(tr=Gh.exports(Ks.text),zr?rd=Oy(Ks):Cs=gg(Ti,Wl,qt,Mr,kr,Lr,Ks,Or,ni.layout.get("text-rotate").evaluate(zi,{},cs),is));const nu=1===Ks.positionedLines.length;if(Wf+=Ci(ln,Rn,qt,Ks,Xn,ni,zr,zi,is,No,ti.vertical?Ca.horizontal:Ca.horizontalOnly,nu?Object.keys(ti.horizontal):[Ys],Os,sd,Wr,gr,cs),nu)break}ti.vertical&&(Bo+=Ci(ln,Rn,qt,ti.vertical,Xn,ni,zr,zi,is,No,Ca.vertical,["vertical"],Os,qf,Wr,gr,cs));let ml=-1;const Zd=(Ys,Ks)=>Ys?Math.max(Ys,Ks):Ks;ml=Zd(rd,ml),ml=Zd($f,ml),ml=Zd(ap,ml);const Zf=ml>-1?1:0;ln.glyphOffsetArray.length>=Gd.MAX_GLYPHS&&Vr("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),void 0!==zi.sortKey&&ln.addToSortKeyRanges(ln.symbolInstances.length,zi.sortKey),ln.symbolInstances.emplaceBack(Wl.x,Wl.y,Wl.z,qt.x,qt.y,Os.right>=0?Os.right:-1,Os.center>=0?Os.center:-1,Os.left>=0?Os.left:-1,Os.vertical>=0?Os.vertical:-1,sd,qf,tr,void 0!==Cs?Cs:ln.collisionBoxArray.length,void 0!==Cs?Cs+1:ln.collisionBoxArray.length,void 0!==Ea?Ea:ln.collisionBoxArray.length,void 0!==Ea?Ea+1:ln.collisionBoxArray.length,void 0!==ss?ss:ln.collisionBoxArray.length,void 0!==ss?ss+1:ln.collisionBoxArray.length,ys||ln.collisionBoxArray.length,ys?ys+1:ln.collisionBoxArray.length,Mr,Wf,Bo,Sg,vc,Zf,0,Wd,qd,ml)}(a,nn,on,ut,l,h,f,wt,a.layers[0],a.collisionBoxArray,o.index,o.sourceLayerIndex,a.index,Pe,$e,D,0,Te,ct,Y,o,v,A,L,B)};if("line"===Tt)for(const ut of Z1(o.geometry,0,0,Un,Un)){const nn=Tx(ut,be,Ze,l.vertical||te,h,24,fe,a.overscaling,Un);for(const zn of nn){const on=te;on&&zT(a,on.text,Je,zn)||It(ut,zn,B)}}else if("line-center"===Tt){for(const ut of o.geometry)if(ut.length>1){const nn=q1(ut,Ze,l.vertical||te,h,24,fe);nn&&It(ut,nn,B)}}else if("Polygon"===o.type)for(const ut of ix(o.geometry,0)){const nn=FT(ut,16);It(ut[0],new Jc(nn.x,nn.y,0,0,void 0),B)}else if("LineString"===o.type)for(const ut of o.geometry)It(ut,new Jc(ut[0].x,ut[0].y,0,0,void 0),B);else if("Point"===o.type)for(const ut of o.geometry)for(const nn of ut)It([nn],new Jc(nn.x,nn.y,0,0,void 0),B)}const Ud=32640;function Ci(a,o,l,h,f,v,b,C,D,A,L,B,z,j,$,Y,te){const me=function(be,Pe,Te,Ze,$e,ct,Tt,Je){const mt=[];if(0===Pe.positionedLines.length)return mt;const yt=Ze.layout.get("text-rotate").evaluate(ct,{})*Math.PI/180,wt=function(on){const ln=on[0],qt=on[1],Rn=ln*qt;return Rn>0?[ln,-qt]:Rn<0?[-ln,qt]:0===ln?[qt,ln]:[qt,-ln]}(Te);let It=Math.abs(Pe.top-Pe.bottom);for(const on of Pe.positionedLines)It-=on.lineOffset;const ut=Pe.positionedLines.length,nn=It/ut;let zn=Pe.top-Te[1];for(let on=0;on<ut;++on){const ln=Pe.positionedLines[on];zn=LT(Pe,nn,zn,on);for(const qt of ln.positionedGlyphs){if(!qt.rect)continue;const Rn=qt.rect||{};let li=4,ti=!0,Fi=1,Xn=0;if(qt.imageName){const gr=Tt[qt.imageName];if(!gr)continue;if(gr.sdf){Vr("SDF images are not supported in formatted text and will be ignored.");continue}ti=!1,Fi=gr.pixelRatio,li=1/Fi}const Br=($e||Je)&&qt.vertical,ni=qt.metrics.advance*qt.scale/2,Ti=qt.metrics,Mr=qt.rect;if(null===Mr)continue;Je&&Pe.verticalizable&&(Xn=qt.imageName?ni-qt.metrics.width*qt.scale/2:0);const kr=$e?[qt.x+ni,qt.y]:[0,0];let Lr=[0,0],Or=[0,0],zr=!1;$e||(Br?(Or=[qt.x+ni+wt[0],qt.y+wt[1]-Xn],zr=!0):Lr=[qt.x+ni+Te[0],qt.y+Te[1]-Xn]);const is=Mr.w*qt.scale/(Fi*(qt.localGlyph?2:1)),$s=Mr.h*qt.scale/(Fi*(qt.localGlyph?2:1));let dn,Ms,rs,zi;if(Br){const gr=qt.y-zn,cs=new Ht(-ni,ni-gr),No=-Math.PI/2,Cs=new Ht(...Or);dn=new Ht(-ni+Lr[0],Lr[1]),dn._rotateAround(No,cs)._add(Cs),dn.x+=-gr+ni,dn.y-=(Ti.left-li)*qt.scale;const ss=qt.imageName?Ti.advance*qt.scale:24*qt.scale,Ea=String.fromCharCode(qt.glyph);gR(Ea)?dn.x+=(1-li)*qt.scale:V1(Ea)?dn.x+=ss-Ti.height*qt.scale+(-li-1)*qt.scale:dn.x+=qt.imageName||Ti.width+2*li===Mr.w&&Ti.height+2*li===Mr.h?(ss-$s)/2:(ss-(Ti.height+2*li)*qt.scale)/2,Ms=new Ht(dn.x,dn.y-is),rs=new Ht(dn.x+$s,dn.y),zi=new Ht(dn.x+$s,dn.y-is)}else{const gr=(Ti.left-li)*qt.scale-ni+Lr[0],cs=(-Ti.top-li)*qt.scale+Lr[1],No=gr+is,Cs=cs+$s;dn=new Ht(gr,cs),Ms=new Ht(No,cs),rs=new Ht(gr,Cs),zi=new Ht(No,Cs)}if(yt){let gr;gr=$e?new Ht(0,0):zr?new Ht(wt[0],wt[1]):new Ht(Te[0],Te[1]),dn._rotateAround(yt,gr),Ms._rotateAround(yt,gr),rs._rotateAround(yt,gr),zi._rotateAround(yt,gr)}const Wr=new Ht(0,0),Ls=new Ht(0,0);mt.push({tl:dn,tr:Ms,bl:rs,br:zi,tex:Rn,writingMode:Pe.writingMode,glyphOffset:kr,sectionIndex:qt.sectionIndex,isSDF:ti,pixelOffsetTL:Wr,pixelOffsetBR:Ls,minFontScaleX:0,minFontScaleY:0})}}return mt}(0,h,D,v,b,C,f,a.allowVerticalPlacement),Ce=a.textSizeData;let fe=null;"source"===Ce.kind?(fe=[Qc*v.layout.get("text-size").evaluate(C,{},te)],fe[0]>Ud&&Vr(`${a.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):"composite"===Ce.kind&&(fe=[Qc*$.compositeTextSizes[0].evaluate(C,{},te),Qc*$.compositeTextSizes[1].evaluate(C,{},te)],(fe[0]>Ud||fe[1]>Ud)&&Vr(`${a.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),a.addSymbols(a.text,me,fe,D,b,C,L,o,l,A.lineStartIndex,A.lineLength,j,Y,te);for(const be of B)z[be]=a.text.placedSymbolArray.length-1;return 4*me.length}function Et(a){for(const o in a)return a[o];return null}function gg(a,o,l,h,f,v,b,C,D,A){let L=b.top,B=b.bottom,z=b.left,j=b.right;const $=b.collisionPadding;if($&&(z-=$[0],L-=$[1],j+=$[2],B+=$[3]),D){const Y=new Ht(z,L),te=new Ht(j,L),me=new Ht(z,B),Ce=new Ht(j,B),fe=Si(D);let be=new Ht(0,0);A&&(be=new Ht(A[0],A[1])),Y._rotateAround(fe,be),te._rotateAround(fe,be),me._rotateAround(fe,be),Ce._rotateAround(fe,be),z=Math.min(Y.x,te.x,me.x,Ce.x),j=Math.max(Y.x,te.x,me.x,Ce.x),L=Math.min(Y.y,te.y,me.y,Ce.y),B=Math.max(Y.y,te.y,me.y,Ce.y)}return a.emplaceBack(o.x,o.y,o.z,l.x,l.y,z,L,j,B,C,h,f,v),a.length-1}function Oy(a){a.collisionPadding&&(a.top-=a.collisionPadding[1],a.bottom+=a.collisionPadding[3]);const o=a.bottom-a.top;return o>0?Math.max(10,o):null}function zT(a,o,l,h){const f=a.compareText;if(o in f){const v=f[o];for(let b=v.length-1;b>=0;b--)if(h.dist(v[b])<l)return!0}else f[o]=[];return f[o].push(h),!1}const VT=Lt([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:kx}=VT,eM=Lt([{name:"a_pos_3",components:3,type:"Int16"}]);var Nf=Lt([{name:"a_pos",type:"Int16",components:2}]);const Ju=Un/Math.PI/2,Lx=2*ls(1,0)*Ju*Math.PI,np=[64,32,16],Gl=-Ju,Yr=Ju,UT=[new ea([Gl,Gl,Gl],[Yr,Yr,Yr]),new ea([Gl,Gl,Gl],[0,0,Yr]),new ea([0,Gl,Gl],[Yr,0,Yr]),new ea([Gl,0,Gl],[0,Yr,Yr]),new ea([0,0,Gl],[Yr,Yr,Yr])];function Fy(a,o,l,h=!0){const f=Jo([],a._camera.position,a.worldSize),v=[o,l,1,1];Bd(v,v,a.pixelMatrixInverse),cT(v,v,1/v[3]);const b=js([],Yc([],v,f)),C=a.globeMatrix,D=[C[12],C[13],C[14]],A=Yc([],D,f),L=Km(A),B=js([],A),z=a.worldSize/(2*Math.PI),j=ul(B,b),$=Math.asin(z/L);if($<Math.acos(j)){if(!h)return null;const Tt=[],Je=[];Jo(Tt,b,L/j),js(Je,Yc(Je,Tt,A)),js(b,Xc(b,A,Jo(b,Je,Math.tan($)*L)))}const Y=[];new wf(f,b).closestPointOnSphere(D,z,Y);const te=js([],Su(C,0)),me=js([],Su(C,1)),Ce=js([],Su(C,2)),fe=ul(te,Y),be=ul(me,Y),Pe=ul(Ce,Y),Te=Es(Math.asin(-be/z));let Ze=Es(Math.atan2(fe,Pe));Ze=a.center.lng+function(Tt,Je){const mt=(Je-Tt+180)%360-180;return mt<-180?mt+360:mt}(a.center.lng,Ze);const $e=qc(Ze),ct=Ei(Vl(Te),0,1);return new Zu($e,ct)}class Ox{constructor(o,l,h){this.a=Yc([],o,h),this.b=Yc([],l,h),this.center=h;const f=js([],this.a),v=js([],this.b);this.angle=Math.acos(ul(f,v))}}function Fx(a,o){if(0===a.angle)return null;let l;return l=0===a.a[o]?1/a.angle*.5*Math.PI:1/a.angle*Math.atan(a.b[o]/a.a[o]/Math.sin(a.angle)-1/Math.tan(a.angle)),l<0||l>1?null:function(h,f,v,b){const C=Math.sin(v);return h*(Math.sin((1-b)*v)/C)+f*(Math.sin(b*v)/C)}(a.a[o],a.b[o],a.angle,Ei(l,0,1))+a.center[o]}function ed(a){if(a.z<=1)return UT[a.z+2*a.y+a.x];const o=Bx(Nx(a));return ea.fromPoints(o)}function Bf(a,o,l){return Jo(a,a,1-l),cl(a,a,o,l)}function HT(a,o){const l=Uf(o.zoom);if(0===l)return ed(a);const h=Nx(a),f=Bx(h),v=qc(h.getWest())*o.worldSize,b=qc(h.getEast())*o.worldSize,C=Vl(h.getNorth())*o.worldSize,D=Vl(h.getSouth())*o.worldSize,A=[v,C,0],L=[b,C,0],B=[v,D,0],z=[b,D,0],j=H0([],o.globeMatrix);return _s(A,A,j),_s(L,L,j),_s(B,B,j),_s(z,z,j),f[0]=Bf(f[0],B,l),f[1]=Bf(f[1],z,l),f[2]=Bf(f[2],L,l),f[3]=Bf(f[3],A,l),ea.fromPoints(f)}function tM(a,o,l){for(const h of a)_s(h,h,o),Jo(h,h,l)}function Nx({x:a,y:o,z:l}){const h=1/(1<<l),f=new Ii(Ga(a*h),$r((o+1)*h)),v=new Ii(Ga((a+1)*h),$r(o*h));return new xr(f,v)}function Bx(a){const o=Si(a.getNorth()),l=Si(a.getSouth()),h=Math.cos(o),f=Math.cos(l),v=Math.sin(o),b=Math.sin(l),C=a.getWest(),D=a.getEast();return[gc(f,b,C),gc(f,b,D),gc(h,v,D),gc(h,v,C)]}function gc(a,o,l,h=Ju){return l=Si(l),[a*Math.sin(l)*h,-o*h,a*Math.cos(l)*h]}function yg(a,o,l){return gc(Math.cos(Si(a)),Math.sin(Si(a)),o,l)}function zf(a,o,l,h){const f=1<<l.z,v=(a/Un+l.x)/f;return yg($r((o/Un+l.y)/f),Ga(v),h)}function ip({min:a,max:o}){return 16383/Math.max(o[0]-a[0],o[1]-a[1],o[2]-a[2])}const iM=new Float64Array(16);function Vf(a){const o=ip(a),l=pc(iM,[o,o,o]);return Ym(l,l,((h=[])[0]=-(f=a.min)[0],h[1]=-f[1],h[2]=-f[2],h));var h,f}function zx(a){const o=(h=a.min,(l=iM)[0]=1,l[1]=0,l[2]=0,l[3]=0,l[4]=0,l[5]=1,l[6]=0,l[7]=0,l[8]=0,l[9]=0,l[10]=1,l[11]=0,l[12]=h[0],l[13]=h[1],l[14]=h[2],l[15]=1,l);var l,h;const f=1/ip(a);return Xh(o,o,[f,f,f])}function rM(a,o,l,h,f){const v=function(D){const A=Un/(2*Math.PI);return D/(2*Math.PI)/A}(l),b=[a,o,-l/(2*Math.PI)],C=Ko(new Float64Array(16));return Ym(C,C,b),Xh(C,C,[v,v,v]),G0(C,C,Si(-f)),Qo(C,C,Si(-h)),C}function Uf(a){return Mu(5,6,a)}function sM(a,o){const l=yg(o.lat,o.lng);return b=(f=$0([],function($){const Y=yg($._center.lat,$._center.lng);let te=dy([],bf(0,1,0),Y);const me=t1([],-$.angle,Y);te=_s(te,te,me),t1(me,-$._pitch,te);const Ce=js([],Y);return Jo(Ce,Ce,$.cameraToCenterDistance/$.pixelsPerMeter*Lx),_s(Ce,Ce,me),Xc([],Y,Ce)}(a),l))[0],C=f[1],D=f[2],A=(v=l)[0],L=v[1],B=v[2],j=(z=Math.sqrt(b*b+C*C+D*D)*Math.sqrt(A*A+L*L+B*B))&&ul(f,v)/z,Math.acos(Math.min(Math.max(j,-1),1));var f,v,b,C,D,A,L,B,z,j}const oM=Si(85),aM=Math.cos(oM),GT=Math.sin(oM);function Vx(a,o){const l=a.fovAboveCenter,h=a.elevation?a.elevation.getMinElevationBelowMSL()*o:0,f=(a._camera.position[2]*a.worldSize-h)/Math.cos(a._pitch),v=Math.sin(l)*f/Math.sin(Math.max(Math.PI/2-a._pitch-l,.01)),b=Math.sin(a._pitch)*v+f;return Math.min(1.01*b,f*(1/a._horizonShift))}function Hd(a,o){if(!o.isReprojectedInTileSpace)return{scale:1<<a.z,x:a.x,y:a.y,x2:a.x+1,y2:a.y+1,projection:o};const l=Math.pow(2,-a.z),h=a.x*l,f=(a.x+1)*l,v=a.y*l,b=(a.y+1)*l,C=Ga(h),D=Ga(f),A=$r(v),L=$r(b),B=o.project(C,A),z=o.project(D,A),j=o.project(D,L),$=o.project(C,L);let Y=Math.min(B.x,z.x,j.x,$.x),te=Math.min(B.y,z.y,j.y,$.y),me=Math.max(B.x,z.x,j.x,$.x),Ce=Math.max(B.y,z.y,j.y,$.y);const fe=l/16;function be(Te,Ze,$e,ct,Tt,Je){const mt=($e+Tt)/2,yt=(ct+Je)/2,wt=o.project(Ga(mt),$r(yt)),It=Math.max(0,Y-wt.x,te-wt.y,wt.x-me,wt.y-Ce);Y=Math.min(Y,wt.x),me=Math.max(me,wt.x),te=Math.min(te,wt.y),Ce=Math.max(Ce,wt.y),It>fe&&(be(Te,wt,$e,ct,mt,yt),be(wt,Ze,mt,yt,Tt,Je))}be(B,z,h,v,f,v),be(z,j,f,v,f,b),be(j,$,f,b,h,b),be($,B,h,b,h,v),Y-=fe,te-=fe,me+=fe,Ce+=fe;const Pe=1/Math.max(me-Y,Ce-te);return{scale:Pe,x:Y*Pe,y:te*Pe,x2:me*Pe,y2:Ce*Pe,projection:o}}const Ux=Ko(new Float32Array(16));class rp{constructor(o){this.spec=o,this.name=o.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(o,l){return{x:0,y:0,z:0}}unproject(o,l){return new Ii(0,0)}projectTilePoint(o,l,h){return{x:o,y:l,z:0}}locationPoint(o,l,h=!0){return o._coordinatePoint(o.locationCoordinate(l),h)}pixelsPerMeter(o,l){return ls(1,o)*l}pixelSpaceConversion(o,l,h){return 1}farthestPixelDistance(o){return Vx(o,o.pixelsPerMeter)}pointCoordinate(o,l,h,f){const v=o.horizonLineFromTop(!1),b=new Ht(l,Math.max(v,h));return o.rayIntersectionCoordinate(o.pointRayIntersection(b,f))}pointCoordinate3D(o,l,h){const f=new Ht(l,h);if(o.elevation)return o.elevation.pointCoordinate(f);{const v=this.pointCoordinate(o,f.x,f.y,0);return[v.x,v.y,v.z]}}isPointAboveHorizon(o,l){if(o.elevation)return!this.pointCoordinate3D(o,l.x,l.y);const h=o.horizonLineFromTop();return l.y<h}createInversionMatrix(o,l){return Ux}createTileMatrix(o,l,h){let f,v,b;const C=h.canonical,D=Ko(new Float64Array(16));if(this.isReprojectedInTileSpace){const A=Hd(C,this);f=1,v=A.x+h.wrap*A.scale,b=A.y,Xh(D,D,[f/A.scale,f/A.scale,o.pixelsPerMeter/l])}else f=l/o.zoomScale(C.z),v=(C.x+Math.pow(2,C.z)*h.wrap)*f,b=C.y*f;return Ym(D,D,[v,b,0]),Xh(D,D,[f/Un,f/Un,1]),D}upVector(o,l,h){return[0,0,1]}upVectorScale(o,l,h){return{metersToTile:1}}}class Hx extends rp{constructor(o){super(o),this.range=[4,7],this.center=o.center||[-96,37.5];const[l,h]=this.parallels=o.parallels||[29.5,45.5],f=Math.sin(Si(l));this.n=(f+Math.sin(Si(h)))/2,this.c=1+f*(2*this.n-f),this.r0=Math.sqrt(this.c)/this.n}project(o,l){const{n:h,c:f,r0:v}=this,b=Si(o-this.center[0]),C=Si(l),D=Math.sqrt(f-2*h*Math.sin(C))/h;return{x:D*Math.sin(b*h),y:D*Math.cos(b*h)-v,z:0}}unproject(o,l){const{n:h,c:f,r0:v}=this,b=v+l;let C=Math.atan2(o,Math.abs(b))*Math.sign(b);b*h<0&&(C-=Math.PI*Math.sign(o)*Math.sign(b));const D=Si(this.center[0])*h;C=Wo(C,-Math.PI-D,Math.PI-D);const A=Ei(Es(C/h)+this.center[0],-180,180),L=Math.asin(Ei((f-(o*o+b*b)*h*h)/(2*h),-1,1)),B=Ei(Es(L),-85.051129,hc);return new Ii(A,B)}}const vg=1.340264,Ny=-.081106,Ie=893e-6,eu=.003796,xg=Math.sqrt(3)/2;class By extends rp{project(o,l){l=l/180*Math.PI,o=o/180*Math.PI;const h=Math.asin(xg*Math.sin(l)),f=h*h,v=f*f*f;return{x:.5*(o*Math.cos(h)/(xg*(vg+3*Ny*f+v*(7*Ie+9*eu*f)))/Math.PI+.5),y:1-.5*(h*(vg+Ny*f+v*(Ie+eu*f))/Math.PI+1),z:0}}unproject(o,l){o=(2*o-.5)*Math.PI;let h=l=(2*(1-l)-1)*Math.PI,f=h*h,v=f*f*f;for(let L,B,z,j=0;j<12&&(B=h*(vg+Ny*f+v*(Ie+eu*f))-l,z=vg+3*Ny*f+v*(7*Ie+9*eu*f),L=B/z,h=Ei(h-L,-Math.PI/3,Math.PI/3),f=h*h,v=f*f*f,!(Math.abs(L)<1e-12));++j);const b=xg*o*(vg+3*Ny*f+v*(7*Ie+9*eu*f))/Math.cos(h),C=Math.asin(Math.sin(h)/xg),D=Ei(180*b/Math.PI,-180,180),A=Ei(180*C/Math.PI,-85.051129,hc);return new Ii(D,A)}}class _c extends rp{constructor(o){super(o),this.wrap=!0,this.supportsWorldCopies=!0}project(o,l){return{x:.5+o/360,y:.5-l/360,z:0}}unproject(o,l){const h=360*(o-.5),f=Ei(360*(.5-l),-85.051129,hc);return new Ii(h,f)}}const sp=Math.PI/2;function zy(a){return Math.tan((sp+a)/2)}class Gx extends rp{constructor(o){super(o),this.center=o.center||[0,30];const[l,h]=this.parallels=o.parallels||[30,30];let f=Si(l),v=Si(h);this.southernCenter=f+v<0,this.southernCenter&&(f=-f,v=-v);const b=Math.cos(f),C=zy(f);this.n=f===v?Math.sin(f):Math.log(b/Math.cos(v))/Math.log(zy(v)/C),this.f=b*Math.pow(zy(f),this.n)/this.n}project(o,l){l=Si(l),this.southernCenter&&(l=-l),o=Si(o-this.center[0]);const h=1e-6,{n:f,f:v}=this;v>0?l<-sp+h&&(l=-sp+h):l>sp-h&&(l=sp-h);const b=v/Math.pow(zy(l),f);let C=b*Math.sin(f*o),D=v-b*Math.cos(f*o);return C=.5*(C/Math.PI+.5),D=.5*(D/Math.PI+.5),{x:C,y:this.southernCenter?D:1-D,z:0}}unproject(o,l){o=(2*o-.5)*Math.PI,this.southernCenter&&(l=1-l),l=(2*(1-l)-.5)*Math.PI;const{n:h,f}=this,v=f-l,b=Math.sign(v),C=Math.sign(h)*Math.sqrt(o*o+v*v);let D=Math.atan2(o,Math.abs(v))*b;v*h<0&&(D-=Math.PI*Math.sign(o)*b);const A=Ei(Es(D/h)+this.center[0],-180,180),L=Ei(Es(2*Math.atan(Math.pow(f/C,1/h))-sp),-85.051129,hc);return new Ii(A,this.southernCenter?-L:L)}}class tu extends rp{constructor(o){super(o),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(o,l){return{x:qc(o),y:Vl(l),z:0}}unproject(o,l){const h=Ga(o),f=$r(l);return new Ii(h,f)}}const Vy=Si(hc);class lM extends rp{project(o,l){const h=(l=Si(l))*l,f=h*h;return{x:.5*((o=Si(o))*(.8707-.131979*h+f*(f*(.003971*h-.001529*f)-.013791))/Math.PI+.5),y:1-.5*(l*(1.007226+h*(.015085+f*(.028874*h-.044475-.005916*f)))/Math.PI+1),z:0}}unproject(o,l){o=(2*o-.5)*Math.PI;let h=l=(2*(1-l)-1)*Math.PI,f=25,v=0,b=h*h;do{b=h*h;const A=b*b;v=(h*(1.007226+b*(.015085+A*(.028874*b-.044475-.005916*A)))-l)/(1.007226+b*(.045255+A*(.259866*b-.311325-.005916*11*A))),h=Ei(h-v,-Vy,Vy)}while(Math.abs(v)>1e-6&&--f>0);b=h*h;const C=Ei(Es(o/(.8707+b*(b*(b*b*b*(.003971-.001529*b)-.013791)-.131979))),-180,180),D=Es(h);return new Ii(C,D)}}const Uy=Si(hc);class yR extends rp{project(o,l){l=Si(l),o=Si(o);const h=Math.cos(l),f=2/Math.PI,v=Math.acos(h*Math.cos(o/2)),b=Math.sin(v)/v,C=.5*(o*f+2*h*Math.sin(o/2)/b)||0,D=.5*(l+Math.sin(l)/b)||0;return{x:.5*(C/Math.PI+.5),y:1-.5*(D/Math.PI+1),z:0}}unproject(o,l){let h=o=(2*o-.5)*Math.PI,f=l=(2*(1-l)-1)*Math.PI,v=25;const b=1e-6;let C=0,D=0;do{const A=Math.cos(f),L=Math.sin(f),B=2*L*A,z=L*L,j=A*A,$=Math.cos(h/2),Y=Math.sin(h/2),te=2*$*Y,me=Y*Y,Ce=1-j*$*$,fe=Ce?1/Ce:0,be=Ce?Math.acos(A*$)*Math.sqrt(1/Ce):0,Pe=.5*(2*be*A*Y+2*h/Math.PI)-o,Te=.5*(be*L+f)-l,Ze=.5*fe*(j*me+be*A*$*z)+1/Math.PI,$e=fe*(te*B/4-be*L*Y),ct=.125*fe*(B*Y-be*L*j*te),Tt=.5*fe*(z*$+be*me*A)+.5,Je=$e*ct-Tt*Ze;C=(Te*$e-Pe*Tt)/Je,D=(Pe*ct-Te*Ze)/Je,h=Ei(h-C,-Math.PI,Math.PI),f=Ei(f-D,-Uy,Uy)}while((Math.abs(C)>b||Math.abs(D)>b)&&--v>0);return new Ii(Es(h),Es(f))}}class jx extends rp{constructor(o){super(o),this.center=o.center||[0,0],this.parallels=o.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(Si(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(o,l){const{scale:h,cosPhi:f}=this;return{x:Si(o)*f*h+.5,y:-Math.sin(Si(l))/f*h+.5,z:0}}unproject(o,l){const{scale:h,cosPhi:f}=this,v=-(l-.5)/h,b=Ei(Es((o-.5)/h)/f,-180,180),C=Math.asin(Ei(v*f,-1,1)),D=Ei(Es(C),-85.051129,hc);return new Ii(b,D)}}class vR extends tu{constructor(o){super(o),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug","custom"],this.range=[3,5]}projectTilePoint(o,l,h){const f=zf(o,l,h);return _s(f,f,Vf(ed(h))),{x:f[0],y:f[1],z:f[2]}}locationPoint(o,l){const h=yg(l.lat,l.lng),f=js([],h),v=o.elevation?o.elevation.getAtPointOrZero(o.locationCoordinate(l),o._centerAltitude):o._centerAltitude;cl(h,h,f,ls(1,0)*Un*v);const b=Ko(new Float64Array(16));return xf(b,o.pixelMatrix,o.globeMatrix),_s(h,h,b),new Ht(h[0],h[1])}pixelsPerMeter(o,l){return ls(1,0)*l}pixelSpaceConversion(o,l,h){const f=ls(1,o)*l,v=Oi(ls(1,45)*l,f,h);return this.pixelsPerMeter(o,l)/v}createTileMatrix(o,l,h){const f=zx(ed(h.canonical));return xf(new Float64Array(16),o.globeMatrix,f)}createInversionMatrix(o,l){const{center:h}=o,f=Vf(ed(l));return Qo(f,f,Si(h.lng)),G0(f,f,Si(h.lat)),Xh(f,f,[o._pixelsPerMercatorPixel,o._pixelsPerMercatorPixel,1]),Float32Array.from(f)}pointCoordinate(o,l,h,f){return Fy(o,l,h,!0)||new Zu(0,0)}pointCoordinate3D(o,l,h){const f=this.pointCoordinate(o,l,h,0);return[f.x,f.y,f.z]}isPointAboveHorizon(o,l){return!Fy(o,l.x,l.y,!1)}farthestPixelDistance(o){const l=function(f,v){const b=f.cameraToCenterDistance,C=f._centerAltitude*v,D=f._camera,A=f._camera.forward(),L=Xc([],Jo([],A,-b),[0,0,C]),B=f.worldSize/(2*Math.PI),z=[0,0,-B],j=f.width/f.height,$=Math.tan(f.fovAboveCenter),Y=Jo([],D.up(),$),te=Jo([],D.right(),$*j),me=js([],Xc([],Xc([],A,Y),te)),Ce=[];let fe;if(new wf(L,me).closestPointOnSphere(z,B,Ce)){const be=Xc([],Ce,z),Pe=Yc([],be,L);fe=Math.cos(f.fovAboveCenter)*Km(Pe)}else{const be=Yc([],L,z),Pe=Yc([],z,L);js(Pe,Pe);const Te=Km(be)-B;fe=Math.sqrt(Te*(Te+2*B));const Ze=Math.acos(fe/(B+Te))-Math.acos(ul(A,Pe));fe*=Math.cos(Ze)}return 1.01*fe}(o,this.pixelsPerMeter(o.center.lat,o.worldSize)),h=Uf(o.zoom);if(h>0){const f=Vx(o,ls(1,o.center.lat)*o.worldSize),v=o.worldSize/(2*Math.PI),b=Math.max(o.width,o.height)/o.worldSize*Math.PI;return Oi(l,f+v*(1-Math.cos(b)),Math.pow(h,10))}return l}upVector(o,l,h){return zf(l,h,o,1)}upVectorScale(o){return{metersToTile:Lx*ip(ed(o))}}}function bg(a){const o=a.parallels,l=!!o&&Math.abs(o[0]+o[1])<.01;switch(a.name){case"mercator":return new tu(a);case"equirectangular":return new _c(a);case"naturalEarth":return new lM(a);case"equalEarth":return new By(a);case"winkelTripel":return new yR(a);case"albers":return l?new jx(a):new Hx(a);case"lambertConformalConic":return l?new jx(a):new Gx(a);case"globe":return new vR(a)}throw new Error(`Invalid projection name: ${a.name}`)}const Hy=ax.types,$x=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Hf(a,o,l,h,f,v,b,C,D,A,L,B,z){const j=C?Math.min(Ud,Math.round(C[0])):0,$=C?Math.min(Ud,Math.round(C[1])):0;a.emplaceBack(o,l,Math.round(32*h),Math.round(32*f),v,b,(j<<1)+(D?1:0),$,16*A,16*L,256*B,256*z)}function Gf(a,o,l,h,f,v,b){a.emplaceBack(o,l,h,f,v,b)}function Wx(a,o,l,h,f){a.emplaceBack(o,l,h,f),a.emplaceBack(o,l,h,f),a.emplaceBack(o,l,h,f),a.emplaceBack(o,l,h,f)}function jT(a){for(const o of a.sections)if(U(o.text))return!0;return!1}class qx{constructor(o){this.layoutVertexArray=new Gr,this.indexArray=new ns,this.programConfigurations=o,this.segments=new Xe,this.dynamicLayoutVertexArray=new Rs,this.opacityVertexArray=new jr,this.placedSymbolArray=new $E,this.globeExtVertexArray=new Hi}isEmpty(){return 0===this.layoutVertexArray.length&&0===this.indexArray.length&&0===this.dynamicLayoutVertexArray.length&&0===this.opacityVertexArray.length}upload(o,l,h,f){this.isEmpty()||(h&&(this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,F1.members),this.indexBuffer=o.createIndexBuffer(this.indexArray,l),this.dynamicLayoutVertexBuffer=o.createVertexBuffer(this.dynamicLayoutVertexArray,N1.members,!0),this.opacityVertexBuffer=o.createVertexBuffer(this.opacityVertexArray,$x,!0),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=o.createVertexBuffer(this.globeExtVertexArray,MT.members,!0)),this.opacityVertexBuffer.itemSize=1),(h||f)&&this.programConfigurations.upload(o))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}}tn(qx,"SymbolBuffers");class Zx{constructor(o,l,h){this.layoutVertexArray=new o,this.layoutAttributes=l,this.indexArray=new h,this.segments=new Xe,this.collisionVertexArray=new $u,this.collisionVertexArrayExt=new Ha}upload(o){this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=o.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=o.createVertexBuffer(this.collisionVertexArray,CT.members,!0),this.collisionVertexBufferExt=o.createVertexBuffer(this.collisionVertexArrayExt,B1.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}tn(Zx,"CollisionBuffers");class Gd{constructor(o){this.collisionBoxArray=o.collisionBoxArray,this.zoom=o.zoom,this.overscaling=o.overscaling,this.layers=o.layers,this.layerIds=this.layers.map(b=>b.id),this.index=o.index,this.pixelRatio=o.pixelRatio,this.sourceLayerIndex=o.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Ko([]),this.placementViewportMatrix=Ko([]);const l=this.layers[0]._unevaluatedLayout._values;this.textSizeData=fx(this.zoom,l["text-size"]),this.iconSizeData=fx(this.zoom,l["icon-size"]);const h=this.layers[0].layout,f=h.get("symbol-sort-key"),v=h.get("symbol-z-order");this.canOverlap=h.get("text-allow-overlap")||h.get("icon-allow-overlap")||h.get("text-ignore-placement")||h.get("icon-ignore-placement"),this.sortFeaturesByKey="viewport-y"!==v&&void 0!==f.constantOr(1),this.sortFeaturesByY=("viewport-y"===v||"auto"===v&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=h.get("text-writing-mode").map(b=>Ca[b]),this.stateDependentLayerIds=this.layers.filter(b=>b.isStateDependent()).map(b=>b.id),this.sourceID=o.sourceID,this.projection=o.projection}createArrays(){this.text=new qx(new dc(this.layers,this.zoom,o=>/^text/.test(o))),this.icon=new qx(new dc(this.layers,this.zoom,o=>/^icon/.test(o))),this.glyphOffsetArray=new uf,this.lineVertexArray=new ZE,this.symbolInstances=new qE}calculateGlyphDependencies(o,l,h,f,v){for(let b=0;b<o.length;b++)if(l[o.charCodeAt(b)]=!0,f&&v){const C=Cy[o.charAt(b)];C&&(l[C.charCodeAt(0)]=!0)}}populate(o,l,h,f){const v=this.layers[0],b=v.layout,C="globe"===this.projection.name,D=b.get("text-font"),A=b.get("text-field"),L=b.get("icon-image"),B=("constant"!==A.value.kind||A.value.value instanceof ko&&!A.value.value.isEmpty()||A.value.value.toString().length>0)&&("constant"!==D.value.kind||D.value.value.length>0),z="constant"!==L.value.kind||!!L.value.value||Object.keys(L.parameters).length>0,j=b.get("symbol-sort-key");if(this.features=[],!B&&!z)return;const $=l.iconDependencies,Y=l.glyphDependencies,te=l.availableImages,me=new ge(this.zoom);for(const{feature:Ce,id:fe,index:be,sourceLayerIndex:Pe}of o){const Te=v._featureFilter.needGeometry,Ze=qh(Ce,Te);if(!v._featureFilter.filter(me,Ze,h))continue;if(Te||(Ze.geometry=Zc(Ce,h,f)),C&&1!==Ce.type&&h.z<=5){const Je=Ze.geometry,mt=.98078528056,yt=(wt,It)=>ul(zf(wt.x,wt.y,h,1),zf(It.x,It.y,h,1))<mt;for(let wt=0;wt<Je.length;wt++)Je[wt]=yf(Je[wt],yt)}let $e,ct;if(B){const Je=v.getValueAndResolveTokens("text-field",Ze,h,te),mt=ko.factory(Je);jT(mt)&&(this.hasRTLText=!0),(!this.hasRTLText||"unavailable"===se()||this.hasRTLText&&Se.isParsed())&&($e=TT(mt,v,Ze))}if(z){const Je=v.getValueAndResolveTokens("icon-image",Ze,h,te);ct=Je instanceof da?Je:da.fromString(Je)}if(!$e&&!ct)continue;const Tt=this.sortFeaturesByKey?j.evaluate(Ze,{},h):void 0;if(this.features.push({id:fe,text:$e,icon:ct,index:be,sourceLayerIndex:Pe,geometry:Ze.geometry,properties:Ce.properties,type:Hy[Ce.type],sortKey:Tt}),ct&&($[ct.name]=!0),$e){const Je=D.evaluate(Ze,{},h).join(","),mt="map"===b.get("text-rotation-alignment")&&"point"!==b.get("symbol-placement");this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(Ca.vertical)>=0;for(const yt of $e.sections)if(yt.image)$[yt.image.name]=!0;else{const wt=p($e.toString()),It=yt.fontStack||Je,ut=Y[It]=Y[It]||{};this.calculateGlyphDependencies(yt.text,ut,mt,this.allowVerticalPlacement,wt)}}}"line"===b.get("symbol-placement")&&(this.features=function(Ce){const fe={},be={},Pe=[];let Te=0;function Ze(Je){Pe.push(Ce[Je]),Te++}function $e(Je,mt,yt){const wt=be[Je];return delete be[Je],be[mt]=wt,Pe[wt].geometry[0].pop(),Pe[wt].geometry[0]=Pe[wt].geometry[0].concat(yt[0]),wt}function ct(Je,mt,yt){const wt=fe[mt];return delete fe[mt],fe[Je]=wt,Pe[wt].geometry[0].shift(),Pe[wt].geometry[0]=yt[0].concat(Pe[wt].geometry[0]),wt}function Tt(Je,mt,yt){const wt=yt?mt[0][mt[0].length-1]:mt[0][0];return`${Je}:${wt.x}:${wt.y}`}for(let Je=0;Je<Ce.length;Je++){const mt=Ce[Je],yt=mt.geometry,wt=mt.text?mt.text.toString():null;if(!wt){Ze(Je);continue}const It=Tt(wt,yt),ut=Tt(wt,yt,!0);if(It in be&&ut in fe&&be[It]!==fe[ut]){const nn=ct(It,ut,yt),zn=$e(It,ut,Pe[nn].geometry);delete fe[It],delete be[ut],be[Tt(wt,Pe[zn].geometry,!0)]=zn,Pe[nn].geometry=null}else It in be?$e(It,ut,yt):ut in fe?ct(It,ut,yt):(Ze(Je),fe[It]=Te-1,be[ut]=Te-1)}return Pe.filter(Je=>Je.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((Ce,fe)=>Ce.sortKey-fe.sortKey)}update(o,l,h,f){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(o,l,this.layers,h,f),this.icon.programConfigurations.updatePaintArrays(o,l,this.layers,h,f))}isEmpty(){return 0===this.symbolInstances.length&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(o){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(o),this.iconCollisionBox.upload(o)),this.text.upload(o,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(o,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=bg(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(o,l){const h=this.lineVertexArray.length,f=o.segment;if(void 0!==f){let v=o.dist(l[f+1]),b=o.dist(l[f]);const C={};for(let D=f+1;D<l.length;D++)C[D]={x:l[D].x,y:l[D].y,tileUnitDistanceFromAnchor:v},D<l.length-1&&(v+=l[D+1].dist(l[D]));for(let D=f||0;D>=0;D--)C[D]={x:l[D].x,y:l[D].y,tileUnitDistanceFromAnchor:b},D>0&&(b+=l[D-1].dist(l[D]));for(let D=0;D<l.length;D++){const A=C[D];this.lineVertexArray.emplaceBack(A.x,A.y,A.tileUnitDistanceFromAnchor)}}return{lineStartIndex:h,lineLength:this.lineVertexArray.length-h}}addSymbols(o,l,h,f,v,b,C,D,A,L,B,z,j,$){const Y=o.indexArray,te=o.layoutVertexArray,me=o.globeExtVertexArray,Ce=o.segments.prepareSegment(4*l.length,te,Y,this.canOverlap?b.sortKey:void 0),fe=this.glyphOffsetArray.length,be=Ce.vertexLength,Pe=this.allowVerticalPlacement&&C===Ca.vertical?Math.PI/2:0,Te=b.text&&b.text.sections;for(let $e=0;$e<l.length;$e++){const{tl:ct,tr:Tt,bl:Je,br:mt,tex:yt,pixelOffsetTL:wt,pixelOffsetBR:It,minFontScaleX:ut,minFontScaleY:nn,glyphOffset:zn,isSDF:on,sectionIndex:ln}=l[$e],qt=Ce.vertexLength,Rn=zn[1];if(Hf(te,A.x,A.y,ct.x,Rn+ct.y,yt.x,yt.y,h,on,wt.x,wt.y,ut,nn),Hf(te,A.x,A.y,Tt.x,Rn+Tt.y,yt.x+yt.w,yt.y,h,on,It.x,wt.y,ut,nn),Hf(te,A.x,A.y,Je.x,Rn+Je.y,yt.x,yt.y+yt.h,h,on,wt.x,It.y,ut,nn),Hf(te,A.x,A.y,mt.x,Rn+mt.y,yt.x+yt.w,yt.y+yt.h,h,on,It.x,It.y,ut,nn),D){const li=D.anchor,ti=D.up;Gf(me,li.x,li.y,li.z,ti[0],ti[1],ti[2]),Gf(me,li.x,li.y,li.z,ti[0],ti[1],ti[2]),Gf(me,li.x,li.y,li.z,ti[0],ti[1],ti[2]),Gf(me,li.x,li.y,li.z,ti[0],ti[1],ti[2]),Wx(o.dynamicLayoutVertexArray,li.x,li.y,li.z,Pe)}else Wx(o.dynamicLayoutVertexArray,A.x,A.y,A.z,Pe);Y.emplaceBack(qt,qt+1,qt+2),Y.emplaceBack(qt+1,qt+2,qt+3),Ce.vertexLength+=4,Ce.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(zn[0]),$e!==l.length-1&&ln===l[$e+1].sectionIndex||o.programConfigurations.populatePaintArrays(te.length,b,b.index,{},j,$,Te&&Te[ln])}const Ze=D?D.anchor:A;o.placedSymbolArray.emplaceBack(Ze.x,Ze.y,Ze.z,A.x,A.y,fe,this.glyphOffsetArray.length-fe,be,L,B,A.segment,h?h[0]:0,h?h[1]:0,f[0],f[1],C,0,!1,0,z,0)}_commitLayoutVertex(o,l,h,f,v,b,C){o.emplaceBack(l,h,f,v,b,Math.round(C.x),Math.round(C.y))}_addCollisionDebugVertices(o,l,h,f,v,b,C){const D=h.segments.prepareSegment(4,h.layoutVertexArray,h.indexArray),A=D.vertexLength,L=C.tileAnchorX,B=C.tileAnchorY;for(let j=0;j<4;j++)h.collisionVertexArray.emplaceBack(0,0,0,0);h.collisionVertexArrayExt.emplaceBack(l,-o.padding,-o.padding),h.collisionVertexArrayExt.emplaceBack(l,o.padding,-o.padding),h.collisionVertexArrayExt.emplaceBack(l,o.padding,o.padding),h.collisionVertexArrayExt.emplaceBack(l,-o.padding,o.padding),this._commitLayoutVertex(h.layoutVertexArray,f,v,b,L,B,new Ht(o.x1,o.y1)),this._commitLayoutVertex(h.layoutVertexArray,f,v,b,L,B,new Ht(o.x2,o.y1)),this._commitLayoutVertex(h.layoutVertexArray,f,v,b,L,B,new Ht(o.x2,o.y2)),this._commitLayoutVertex(h.layoutVertexArray,f,v,b,L,B,new Ht(o.x1,o.y2)),D.vertexLength+=4;const z=h.indexArray;z.emplaceBack(A,A+1),z.emplaceBack(A+1,A+2),z.emplaceBack(A+2,A+3),z.emplaceBack(A+3,A),D.primitiveLength+=4}_addTextDebugCollisionBoxes(o,l,h,f,v,b){for(let C=f;C<v;C++){const D=h.get(C),A=this.getSymbolInstanceTextSize(o,b,l,C);this._addCollisionDebugVertices(D,A,this.textCollisionBox,D.projectedAnchorX,D.projectedAnchorY,D.projectedAnchorZ,b)}}_addIconDebugCollisionBoxes(o,l,h,f,v,b){for(let C=f;C<v;C++){const D=h.get(C),A=this.getSymbolInstanceIconSize(o,l,b.placedIconSymbolIndex);this._addCollisionDebugVertices(D,A,this.iconCollisionBox,D.projectedAnchorX,D.projectedAnchorY,D.projectedAnchorZ,b)}}generateCollisionDebugBuffers(o,l){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Zx(hi,z1.members,_o),this.iconCollisionBox=new Zx(hi,z1.members,_o);const h=ja(this.iconSizeData,o),f=ja(this.textSizeData,o);for(let v=0;v<this.symbolInstances.length;v++){const b=this.symbolInstances.get(v);this._addTextDebugCollisionBoxes(f,o,l,b.textBoxStartIndex,b.textBoxEndIndex,b),this._addTextDebugCollisionBoxes(f,o,l,b.verticalTextBoxStartIndex,b.verticalTextBoxEndIndex,b),this._addIconDebugCollisionBoxes(h,o,l,b.iconBoxStartIndex,b.iconBoxEndIndex,b),this._addIconDebugCollisionBoxes(h,o,l,b.verticalIconBoxStartIndex,b.verticalIconBoxEndIndex,b)}}getSymbolInstanceTextSize(o,l,h,f){const v=this.text.placedSymbolArray.get(l.rightJustifiedTextSymbolIndex>=0?l.rightJustifiedTextSymbolIndex:l.centerJustifiedTextSymbolIndex>=0?l.centerJustifiedTextSymbolIndex:l.leftJustifiedTextSymbolIndex>=0?l.leftJustifiedTextSymbolIndex:l.verticalPlacedTextSymbolIndex>=0?l.verticalPlacedTextSymbolIndex:f),b=Qu(this.textSizeData,o,v)/24;return this.tilePixelRatio*b}getSymbolInstanceIconSize(o,l,h){const f=this.icon.placedSymbolArray.get(h),v=Qu(this.iconSizeData,o,f);return this.tilePixelRatio*v}_commitDebugCollisionVertexUpdate(o,l,h){o.emplaceBack(l,-h,-h),o.emplaceBack(l,h,-h),o.emplaceBack(l,h,h),o.emplaceBack(l,-h,h)}_updateTextDebugCollisionBoxes(o,l,h,f,v,b){for(let C=f;C<v;C++){const D=h.get(C),A=this.getSymbolInstanceTextSize(o,b,l,C);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,A,D.padding)}}_updateIconDebugCollisionBoxes(o,l,h,f,v,b){for(let C=f;C<v;C++){const D=h.get(C),A=this.getSymbolInstanceIconSize(o,l,b);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,A,D.padding)}}updateCollisionDebugBuffers(o,l){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const h=ja(this.iconSizeData,o),f=ja(this.textSizeData,o);for(let v=0;v<this.symbolInstances.length;v++){const b=this.symbolInstances.get(v);this._updateTextDebugCollisionBoxes(f,o,l,b.textBoxStartIndex,b.textBoxEndIndex,b),this._updateTextDebugCollisionBoxes(f,o,l,b.verticalTextBoxStartIndex,b.verticalTextBoxEndIndex,b),this._updateIconDebugCollisionBoxes(h,o,l,b.iconBoxStartIndex,b.iconBoxEndIndex,b.placedIconSymbolIndex),this._updateIconDebugCollisionBoxes(h,o,l,b.verticalIconBoxStartIndex,b.verticalIconBoxEndIndex,b.placedIconSymbolIndex)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(o,l,h,f,v,b,C,D,A){const L={};for(let B=l;B<h;B++){const z=o.get(B);L.textBox={x1:z.x1,y1:z.y1,x2:z.x2,y2:z.y2,padding:z.padding,projectedAnchorX:z.projectedAnchorX,projectedAnchorY:z.projectedAnchorY,projectedAnchorZ:z.projectedAnchorZ,tileAnchorX:z.tileAnchorX,tileAnchorY:z.tileAnchorY},L.textFeatureIndex=z.featureIndex;break}for(let B=f;B<v;B++){const z=o.get(B);L.verticalTextBox={x1:z.x1,y1:z.y1,x2:z.x2,y2:z.y2,padding:z.padding,projectedAnchorX:z.projectedAnchorX,projectedAnchorY:z.projectedAnchorY,projectedAnchorZ:z.projectedAnchorZ,tileAnchorX:z.tileAnchorX,tileAnchorY:z.tileAnchorY},L.verticalTextFeatureIndex=z.featureIndex;break}for(let B=b;B<C;B++){const z=o.get(B);L.iconBox={x1:z.x1,y1:z.y1,x2:z.x2,y2:z.y2,padding:z.padding,projectedAnchorX:z.projectedAnchorX,projectedAnchorY:z.projectedAnchorY,projectedAnchorZ:z.projectedAnchorZ,tileAnchorX:z.tileAnchorX,tileAnchorY:z.tileAnchorY},L.iconFeatureIndex=z.featureIndex;break}for(let B=D;B<A;B++){const z=o.get(B);L.verticalIconBox={x1:z.x1,y1:z.y1,x2:z.x2,y2:z.y2,padding:z.padding,projectedAnchorX:z.projectedAnchorX,projectedAnchorY:z.projectedAnchorY,projectedAnchorZ:z.projectedAnchorZ,tileAnchorX:z.tileAnchorX,tileAnchorY:z.tileAnchorY},L.verticalIconFeatureIndex=z.featureIndex;break}return L}deserializeCollisionBoxes(o){this.collisionArrays=[];for(let l=0;l<this.symbolInstances.length;l++){const h=this.symbolInstances.get(l);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(o,h.textBoxStartIndex,h.textBoxEndIndex,h.verticalTextBoxStartIndex,h.verticalTextBoxEndIndex,h.iconBoxStartIndex,h.iconBoxEndIndex,h.verticalIconBoxStartIndex,h.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(o,l){const h=o.placedSymbolArray.get(l),f=h.vertexStartIndex+4*h.numGlyphs;for(let v=h.vertexStartIndex;v<f;v+=4)o.indexArray.emplaceBack(v,v+1,v+2),o.indexArray.emplaceBack(v+1,v+2,v+3)}getSortedSymbolIndexes(o){if(this.sortedAngle===o&&void 0!==this.symbolInstanceIndexes)return this.symbolInstanceIndexes;const l=Math.sin(o),h=Math.cos(o),f=[],v=[],b=[];for(let C=0;C<this.symbolInstances.length;++C){b.push(C);const D=this.symbolInstances.get(C);f.push(0|Math.round(l*D.tileAnchorX+h*D.tileAnchorY)),v.push(D.featureIndex)}return b.sort((C,D)=>f[C]-f[D]||v[D]-v[C]),b}addToSortKeyRanges(o,l){const h=this.sortKeyRanges[this.sortKeyRanges.length-1];h&&h.sortKey===l?h.symbolInstanceEnd=o+1:this.sortKeyRanges.push({sortKey:l,symbolInstanceStart:o,symbolInstanceEnd:o+1})}sortFeatures(o){if(this.sortFeaturesByY&&this.sortedAngle!==o&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(o),this.sortedAngle=o,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const l of this.symbolInstanceIndexes){const h=this.symbolInstances.get(l);this.featureSortOrder.push(h.featureIndex),[h.rightJustifiedTextSymbolIndex,h.centerJustifiedTextSymbolIndex,h.leftJustifiedTextSymbolIndex].forEach((f,v,b)=>{f>=0&&b.indexOf(f)===v&&this.addIndicesForPlacedSymbol(this.text,f)}),h.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,h.verticalPlacedTextSymbolIndex),h.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,h.placedIconSymbolIndex),h.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,h.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}tn(Gd,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),Gd.MAX_GLYPHS=65535,Gd.addDynamicAttributes=Wx;const cM=new Bt({"symbol-placement":new We(rt.layout_symbol["symbol-placement"]),"symbol-spacing":new We(rt.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new We(rt.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Fe(rt.layout_symbol["symbol-sort-key"]),"symbol-z-order":new We(rt.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new We(rt.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new We(rt.layout_symbol["icon-ignore-placement"]),"icon-optional":new We(rt.layout_symbol["icon-optional"]),"icon-rotation-alignment":new We(rt.layout_symbol["icon-rotation-alignment"]),"icon-size":new Fe(rt.layout_symbol["icon-size"]),"icon-text-fit":new We(rt.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new We(rt.layout_symbol["icon-text-fit-padding"]),"icon-image":new Fe(rt.layout_symbol["icon-image"]),"icon-rotate":new Fe(rt.layout_symbol["icon-rotate"]),"icon-padding":new We(rt.layout_symbol["icon-padding"]),"icon-keep-upright":new We(rt.layout_symbol["icon-keep-upright"]),"icon-offset":new Fe(rt.layout_symbol["icon-offset"]),"icon-anchor":new Fe(rt.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new We(rt.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new We(rt.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new We(rt.layout_symbol["text-rotation-alignment"]),"text-field":new Fe(rt.layout_symbol["text-field"]),"text-font":new Fe(rt.layout_symbol["text-font"]),"text-size":new Fe(rt.layout_symbol["text-size"]),"text-max-width":new Fe(rt.layout_symbol["text-max-width"]),"text-line-height":new Fe(rt.layout_symbol["text-line-height"]),"text-letter-spacing":new Fe(rt.layout_symbol["text-letter-spacing"]),"text-justify":new Fe(rt.layout_symbol["text-justify"]),"text-radial-offset":new Fe(rt.layout_symbol["text-radial-offset"]),"text-variable-anchor":new We(rt.layout_symbol["text-variable-anchor"]),"text-anchor":new Fe(rt.layout_symbol["text-anchor"]),"text-max-angle":new We(rt.layout_symbol["text-max-angle"]),"text-writing-mode":new We(rt.layout_symbol["text-writing-mode"]),"text-rotate":new Fe(rt.layout_symbol["text-rotate"]),"text-padding":new We(rt.layout_symbol["text-padding"]),"text-keep-upright":new We(rt.layout_symbol["text-keep-upright"]),"text-transform":new Fe(rt.layout_symbol["text-transform"]),"text-offset":new Fe(rt.layout_symbol["text-offset"]),"text-allow-overlap":new We(rt.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new We(rt.layout_symbol["text-ignore-placement"]),"text-optional":new We(rt.layout_symbol["text-optional"])});var uM={paint:new Bt({"icon-opacity":new Fe(rt.paint_symbol["icon-opacity"]),"icon-color":new Fe(rt.paint_symbol["icon-color"]),"icon-halo-color":new Fe(rt.paint_symbol["icon-halo-color"]),"icon-halo-width":new Fe(rt.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Fe(rt.paint_symbol["icon-halo-blur"]),"icon-translate":new We(rt.paint_symbol["icon-translate"]),"icon-translate-anchor":new We(rt.paint_symbol["icon-translate-anchor"]),"text-opacity":new Fe(rt.paint_symbol["text-opacity"]),"text-color":new Fe(rt.paint_symbol["text-color"],{runtimeType:Ol,getOverride:a=>a.textColor,hasOverride:a=>!!a.textColor}),"text-halo-color":new Fe(rt.paint_symbol["text-halo-color"]),"text-halo-width":new Fe(rt.paint_symbol["text-halo-width"]),"text-halo-blur":new Fe(rt.paint_symbol["text-halo-blur"]),"text-translate":new We(rt.paint_symbol["text-translate"]),"text-translate-anchor":new We(rt.paint_symbol["text-translate-anchor"])}),layout:cM};class dM{constructor(o){this.type=o.property.overrides?o.property.overrides.runtimeType:ar,this.defaultValue=o}evaluate(o){if(o.formattedSection){const l=this.defaultValue.property.overrides;if(l&&l.hasOverride(o.formattedSection))return l.getOverride(o.formattedSection)}return o.feature&&o.featureState?this.defaultValue.evaluate(o.feature,o.featureState):this.defaultValue.property.specification.default}eachChild(o){this.defaultValue.isConstant()||o(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}tn(dM,"FormatSectionOverride",{omit:["defaultValue"]});class Xx extends xa{constructor(o){super(o,uM)}recalculate(o,l){super.recalculate(o,l),"auto"===this.layout.get("icon-rotation-alignment")&&(this.layout._values["icon-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-rotation-alignment")&&(this.layout._values["text-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-pitch-alignment")&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),"auto"===this.layout.get("icon-pitch-alignment")&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const h=this.layout.get("text-writing-mode");if(h){const f=[];for(const v of h)f.indexOf(v)<0&&f.push(v);this.layout._values["text-writing-mode"]=f}else this.layout._values["text-writing-mode"]="point"===this.layout.get("symbol-placement")?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getValueAndResolveTokens(o,l,h,f){const v=this.layout.get(o).evaluate(l,{},h,f),b=this._unevaluatedLayout._values[o];return b.isDataDriven()||Nh(b.value)||!v?v:(C=l.properties,v.replace(/{([^{}]+)}/g,(A,L)=>L in C?String(C[L]):""));var C}createBucket(o){return new Gd(o)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const o of uM.paint.overridableProperties){if(!Xx.hasPaintOverride(this.layout,o))continue;const l=this.paint.get(o),h=new dM(l),f=new rl(h,l.property.specification);let v=null;v="constant"===l.value.kind||"source"===l.value.kind?new Bh("source",f):new Zp("composite",f,l.value.zoomStops,l.value._interpolationType),this.paint._values[o]=new pt(l.property,v,l.parameters)}}_handleOverridablePaintPropertyUpdate(o,l,h){return!(!this.layout||l.isDataDriven()||h.isDataDriven())&&Xx.hasPaintOverride(this.layout,o)}static hasPaintOverride(o,l){const h=o.get("text-field"),f=uM.paint.properties[l];let v=!1;const b=C=>{for(const D of C)if(f.overrides&&f.overrides.hasOverride(D))return void(v=!0)};if("constant"===h.value.kind&&h.value.value instanceof ko)b(h.value.value.sections);else if("source"===h.value.kind){const C=A=>{v||(A instanceof Hp&&lr(A.value)===Ch?b(A.value.sections):A instanceof nl?b(A.sections):A.eachChild(C))},D=h.value;D._styleExpression&&C(D._styleExpression.expression)}return v}getProgramConfiguration(o){return new $h(this,o)}}var hM={paint:new Bt({"background-color":new We(rt.paint_background["background-color"]),"background-pattern":new Ft(rt.paint_background["background-pattern"]),"background-opacity":new We(rt.paint_background["background-opacity"])})},pM={paint:new Bt({"raster-opacity":new We(rt.paint_raster["raster-opacity"]),"raster-hue-rotate":new We(rt.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new We(rt.paint_raster["raster-brightness-min"]),"raster-brightness-max":new We(rt.paint_raster["raster-brightness-max"]),"raster-saturation":new We(rt.paint_raster["raster-saturation"]),"raster-contrast":new We(rt.paint_raster["raster-contrast"]),"raster-resampling":new We(rt.paint_raster["raster-resampling"]),"raster-fade-duration":new We(rt.paint_raster["raster-fade-duration"])})};class $T extends xa{constructor(o){super(o,{}),this.implementation=o}is3D(){return"3d"===this.implementation.renderingMode}hasOffscreenPass(){return void 0!==this.implementation.prerender}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(o){this.implementation.onAdd&&this.implementation.onAdd(o,o.painter.context.gl)}onRemove(o){this.implementation.onRemove&&this.implementation.onRemove(o,o.painter.context.gl)}}var Yx={paint:new Bt({"sky-type":new We(rt.paint_sky["sky-type"]),"sky-atmosphere-sun":new We(rt.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new We(rt.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new We(rt.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new We(rt.paint_sky["sky-gradient-radius"]),"sky-gradient":new kt(rt.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new We(rt.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new We(rt.paint_sky["sky-atmosphere-color"]),"sky-opacity":new We(rt.paint_sky["sky-opacity"])})};function fM(a,o,l){const h=[0,0,1],f=o1([]);return l1(f,f,l?-Si(a)+Math.PI:Si(a)),a1(f,f,-Si(o)),lT(h,h,f),js(h,h)}const xR={circle:class extends xa{constructor(a){super(a,uy)}createBucket(a){return new N0(a)}queryRadius(a){const o=a;return Nd("circle-radius",this,o)+Nd("circle-stroke-width",this,o)+Xu(this.paint.get("circle-translate"))}queryIntersectsFeature(a,o,l,h,f,v,b,C){const D=e1(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),v.angle,a.pixelToTileUnitsFactor),A=this.paint.get("circle-radius").evaluate(o,l)+this.paint.get("circle-stroke-width").evaluate(o,l);return br(a,h,v,b,C,"map"===this.paint.get("circle-pitch-alignment"),"map"===this.paint.get("circle-pitch-scale"),D,A)}getProgramIds(){return["circle"]}getProgramConfiguration(a){return new $h(this,a)}},heatmap:class extends xa{createBucket(a){return new h1(a)}constructor(a){super(a,cR),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(a){"heatmap-color"===a&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Yh({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(a){return Nd("heatmap-radius",this,a)}queryIntersectsFeature(a,o,l,h,f,v,b,C){const D=this.paint.get("heatmap-radius").evaluate(o,l);return br(a,h,v,b,C,!0,!0,new Ht(0,0),D)}hasOffscreenPass(){return 0!==this.paint.get("heatmap-opacity")&&"none"!==this.visibility}getProgramIds(){return["heatmap","heatmapTexture"]}getProgramConfiguration(a){return new $h(this,a)}},hillshade:class extends xa{constructor(a){super(a,X0)}hasOffscreenPass(){return 0!==this.paint.get("hillshade-exaggeration")&&"none"!==this.visibility}getProgramIds(){return["hillshade","hillshadePrepare"]}},fill:class extends xa{constructor(a){super(a,Ef)}getProgramIds(){const a=this.paint.get("fill-pattern"),o=a&&a.constantOr(1),l=[o?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&l.push(o&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),l}getProgramConfiguration(a){return new $h(this,a)}recalculate(a,o){super.recalculate(a,o);const l=this.paint._values["fill-outline-color"];"constant"===l.value.kind&&void 0===l.value.value&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(a){return new Kc(a)}queryRadius(){return Xu(this.paint.get("fill-translate"))}queryIntersectsFeature(a,o,l,h,f,v){return!a.queryGeometry.isAboveHorizon&&B0(Jw(a.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),v.angle,a.pixelToTileUnitsFactor),h)}isTileClipped(){return!0}},"fill-extrusion":class extends xa{constructor(a){super(a,A1)}createBucket(a){return new Df(a)}queryRadius(){return Xu(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}getProgramConfiguration(a){return new $h(this,a)}queryIntersectsFeature(a,o,l,h,f,v,b,C,D){const A=e1(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),v.angle,a.pixelToTileUnitsFactor),L=this.paint.get("fill-extrusion-height").evaluate(o,l),B=this.paint.get("fill-extrusion-base").evaluate(o,l),z=[0,0],j=C&&v.elevation,$=v.elevation?v.elevation.exaggeration():1,Y=a.tile.getBucket(this);if(j&&Y instanceof Df){const be=Y.centroidVertexArray,Pe=D+1;if(Pe<be.length){const Te=be.get(Pe);z[0]=Te.a_centroid_pos0,z[1]=Te.a_centroid_pos1}}if(0===z[0]&&1===z[1])return!1;"globe"===v.projection.name&&(h=D1([h],[new Ht(0,0),new Ht(Un,Un)],a.tileID.canonical).map(be=>be.polygon).flat());const te=j?C:null,[me,Ce]=(Pe=h,Te=B,Ze=L,$e=A,ct=b,Tt=te,Je=z,mt=$,yt=v.center.lat,"globe"===(be=v).projection.name?function(It,ut,nn,zn,on,ln,qt,Rn,li,ti,Fi){const Xn=[],Br=[],ni=It.projection.upVectorScale(Fi,It.center.lat,It.worldSize).metersToTile,Ti=[0,0,0,1],Mr=[0,0,0,1],kr=(Or,zr,is,$s)=>{Or[0]=zr,Or[1]=is,Or[2]=$s,Or[3]=1},Lr=T1();nn>0&&(nn+=Lr),zn+=Lr;for(const Or of ut){const zr=[],is=[];for(const $s of Or){const dn=$s.x+on.x,Ms=$s.y+on.y,rs=It.projection.projectTilePoint(dn,Ms,Fi),zi=It.projection.upVector(Fi,$s.x,$s.y);let Wr=nn,Ls=zn;if(qt){const gr=ux(dn,Ms,nn,zn,qt,Rn,li,ti);Wr+=gr.base,Ls+=gr.top}0!==nn?kr(Ti,rs.x+zi[0]*ni*Wr,rs.y+zi[1]*ni*Wr,rs.z+zi[2]*ni*Wr):kr(Ti,rs.x,rs.y,rs.z),kr(Mr,rs.x+zi[0]*ni*Ls,rs.y+zi[1]*ni*Ls,rs.z+zi[2]*ni*Ls),_s(Ti,Ti,ln),_s(Mr,Mr,ln),zr.push(new Af(Ti[0],Ti[1],Ti[2])),is.push(new Af(Mr[0],Mr[1],Mr[2]))}Xn.push(zr),Br.push(is)}return[Xn,Br]}(be,Pe,Te,Ze,$e,ct,Tt,Je,mt,yt,a.tileID.canonical):Tt?function(It,ut,nn,zn,on,ln,qt,Rn,li){const ti=[],Fi=[],Xn=[0,0,0,1];for(const Br of It){const ni=[],Ti=[];for(const Mr of Br){const kr=Mr.x+zn.x,Lr=Mr.y+zn.y,Or=ux(kr,Lr,ut,nn,ln,qt,Rn,li);Xn[0]=kr,Xn[1]=Lr,Xn[2]=Or.base,Xn[3]=1,Bd(Xn,Xn,on),Xn[3]=Math.max(Xn[3],1e-5);const zr=new Af(Xn[0]/Xn[3],Xn[1]/Xn[3],Xn[2]/Xn[3]);Xn[0]=kr,Xn[1]=Lr,Xn[2]=Or.top,Xn[3]=1,Bd(Xn,Xn,on),Xn[3]=Math.max(Xn[3],1e-5);const is=new Af(Xn[0]/Xn[3],Xn[1]/Xn[3],Xn[2]/Xn[3]);ni.push(zr),Ti.push(is)}ti.push(ni),Fi.push(Ti)}return[ti,Fi]}(Pe,Te,Ze,$e,ct,Tt,Je,mt,yt):function(It,ut,nn,zn,on){const ln=[],qt=[],Rn=on[8]*ut,li=on[9]*ut,ti=on[10]*ut,Fi=on[11]*ut,Xn=on[8]*nn,Br=on[9]*nn,ni=on[10]*nn,Ti=on[11]*nn;for(const Mr of It){const kr=[],Lr=[];for(const Or of Mr){const zr=Or.x+zn.x,is=Or.y+zn.y,$s=on[0]*zr+on[4]*is+on[12],dn=on[1]*zr+on[5]*is+on[13],Ms=on[2]*zr+on[6]*is+on[14],rs=on[3]*zr+on[7]*is+on[15],zi=$s+Rn,Wr=dn+li,Ls=Ms+ti,gr=Math.max(rs+Fi,1e-5),cs=$s+Xn,No=dn+Br,Cs=Ms+ni,ss=Math.max(rs+Ti,1e-5);kr.push(new Af(zi/gr,Wr/gr,Ls/gr)),Lr.push(new Af(cs/ss,No/ss,Cs/ss))}ln.push(kr),qt.push(Lr)}return[ln,qt]}(Pe,Te,Ze,$e,ct)),fe=a.queryGeometry;var be,Pe,Te,Ze,$e,ct,Tt,Je,mt,yt;return function(be,Pe,Te){let Ze=1/0;B0(Te,Pe)&&(Ze=R1(Te,Pe[0]));for(let $e=0;$e<Pe.length;$e++){const ct=Pe[$e],Tt=be[$e];for(let Je=0;Je<ct.length-1;Je++){const mt=ct[Je],yt=[mt,ct[Je+1],Tt[Je+1],Tt[Je],mt];Qw(Te,yt)&&(Ze=Math.min(Ze,R1(Te,yt)))}}return Ze!==1/0&&Ze}(me,Ce,fe.isPointQuery()?fe.screenBounds:fe.screenGeometry)}},line:class extends xa{constructor(a){super(a,px),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(a){if("line-gradient"===a){const o=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=o._styleExpression&&o._styleExpression.expression instanceof Dd,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(a,o){super.recalculate(a,o),this.paint._values["line-floorwidth"]=L1.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,a)}createBucket(a){return new Xs(a)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getProgramConfiguration(a){return new $h(this,a)}queryRadius(a){const o=a,l=O1(Nd("line-width",this,o),Nd("line-gap-width",this,o)),h=Nd("line-offset",this,o);return l/2+Math.abs(h)+Xu(this.paint.get("line-translate"))}queryIntersectsFeature(a,o,l,h,f,v){if(a.queryGeometry.isAboveHorizon)return!1;const b=Jw(a.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),v.angle,a.pixelToTileUnitsFactor),C=a.pixelToTileUnitsFactor/2*O1(this.paint.get("line-width").evaluate(o,l),this.paint.get("line-gap-width").evaluate(o,l)),D=this.paint.get("line-offset").evaluate(o,l);return D&&(h=function(A,L){const B=[],z=new Ht(0,0);for(let j=0;j<A.length;j++){const $=A[j],Y=[];for(let te=0;te<$.length;te++){const me=$[te-1],Ce=$[te],fe=$[te+1],be=0===te?z:Ce.sub(me)._unit()._perp(),Pe=te===$.length-1?z:fe.sub(Ce)._unit()._perp(),Te=be._add(Pe)._unit();Te._mult(1/(Te.x*Pe.x+Te.y*Pe.y)),Y.push(Te._mult(L)._add(Ce))}B.push(Y)}return B}(h,D*a.pixelToTileUnitsFactor)),function(A,L,B){for(let z=0;z<L.length;z++){const j=L[z];if(A.length>=3)for(let $=0;$<j.length;$++)if(Zh(A,j[$]))return!0;if(sT(A,j,B))return!0}return!1}(b,h,C)}isTileClipped(){return!0}},symbol:Xx,background:class extends xa{constructor(a){super(a,hM)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}},raster:class extends xa{constructor(a){super(a,pM)}getProgramIds(){return["raster"]}},sky:class extends xa{constructor(a){super(a,Yx),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(a){"sky-gradient"===a?this._updateColorRamp():"sky-atmosphere-sun"!==a&&"sky-atmosphere-halo-color"!==a&&"sky-atmosphere-color"!==a&&"sky-atmosphere-sun-intensity"!==a||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=Yh({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(a){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const o=a.style.light.properties.get("position");return this._lightPosition.azimuthal!==o.azimuthal||this._lightPosition.polar!==o.polar}return!1}getCenter(a,o){if("atmosphere"===this.paint.get("sky-type")){const h=this.paint.get("sky-atmosphere-sun"),f=!h,v=a.style.light,b=v.properties.get("position");return f&&"viewport"===v.properties.get("anchor")&&Vr("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),f?fM(b.azimuthal,90-b.polar,o):fM(h[0],90-h[1],o)}const l=this.paint.get("sky-gradient-center");return fM(l[0],90-l[1],o)}is3D(){return!1}isSky(){return!0}markSkyboxValid(a){this._skyboxInvalidated=!1,this._lightPosition=a.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const a=this.paint.get("sky-type");return"atmosphere"===a?["skyboxCapture","skybox"]:"gradient"===a?["skyboxGradient"]:null}}};class Gy{constructor(o,l,h,f){this.context=o,this.format=h,this.texture=o.gl.createTexture(),this.update(l,f)}update(o,l,h){const{width:f,height:v}=o,{context:b}=this,{gl:C}=b,{HTMLImageElement:D,HTMLCanvasElement:A,HTMLVideoElement:L,ImageData:B,ImageBitmap:z}=lt;if(C.bindTexture(C.TEXTURE_2D,this.texture),b.pixelStoreUnpackFlipY.set(!1),b.pixelStoreUnpack.set(1),b.pixelStoreUnpackPremultiplyAlpha.set(this.format===C.RGBA&&(!l||!1!==l.premultiply)),h||this.size&&this.size[0]===f&&this.size[1]===v){const{x:j,y:$}=h||{x:0,y:0};o instanceof D||o instanceof A||o instanceof L||o instanceof B||z&&o instanceof z?C.texSubImage2D(C.TEXTURE_2D,0,j,$,C.RGBA,C.UNSIGNED_BYTE,o):C.texSubImage2D(C.TEXTURE_2D,0,j,$,f,v,C.RGBA,C.UNSIGNED_BYTE,o.data)}else this.size=[f,v],o instanceof D||o instanceof A||o instanceof L||o instanceof B||z&&o instanceof z?C.texImage2D(C.TEXTURE_2D,0,this.format,this.format,C.UNSIGNED_BYTE,o):C.texImage2D(C.TEXTURE_2D,0,this.format,f,v,0,this.format,C.UNSIGNED_BYTE,o.data);this.useMipmap=Boolean(l&&l.useMipmap&&this.isSizePowerOfTwo()),this.useMipmap&&C.generateMipmap(C.TEXTURE_2D)}bind(o,l){const{context:h}=this,{gl:f}=h;f.bindTexture(f.TEXTURE_2D,this.texture),o!==this.filter&&(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MAG_FILTER,o),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MIN_FILTER,this.useMipmap?o===f.NEAREST?f.NEAREST_MIPMAP_NEAREST:f.LINEAR_MIPMAP_NEAREST:o),this.filter=o),l!==this.wrap&&(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_S,l),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_T,l),this.wrap=l)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:o}=this.context;o.deleteTexture(this.texture),this.texture=null}}class bR{constructor(o){this._callback=o,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class wR{constructor(){this.tasks={},this.taskQueue=[],Lc(["process"],this),this.invoker=new bR(this.process),this.nextId=0}add(o,l){const h=this.nextId++,f=function({type:v,isSymbolTile:b,zoom:C}){return C=C||0,"message"===v?0:"maybePrepare"!==v||b?"parseTile"!==v||b?"parseTile"===v&&b?300-C:"maybePrepare"===v&&b?400-C:500:200-C:100-C}(l);if(0===f){kl();try{o()}finally{}return{cancel:()=>{}}}return this.tasks[h]={fn:o,metadata:l,priority:f,id:h},this.taskQueue.push(h),this.invoker.trigger(),{cancel:()=>{delete this.tasks[h]}}}process(){kl();try{if(this.taskQueue=this.taskQueue.filter(h=>!!this.tasks[h]),!this.taskQueue.length)return;const o=this.pick();if(null===o)return;const l=this.tasks[o];if(delete this.tasks[o],this.taskQueue.length&&this.invoker.trigger(),!l)return;l.fn()}finally{}}pick(){let o=null,l=1/0;for(let f=0;f<this.taskQueue.length;f++){const v=this.tasks[this.taskQueue[f]];v.priority<l&&(l=v.priority,o=f)}if(null===o)return null;const h=this.taskQueue[o];return this.taskQueue.splice(o,1),h}remove(){this.invoker.remove()}}class WT{constructor(o){this._stringToNumber={},this._numberToString=[];for(let l=0;l<o.length;l++){const h=o[l];this._stringToNumber[h]=l,this._numberToString[l]=h}}encode(o){return this._stringToNumber[o]}decode(o){return this._numberToString[o]}}const MR=["tile","layer","source","sourceLayer","state"];class qT{constructor(o,l,h,f,v){this.type="Feature",this._vectorTileFeature=o,this._z=l,this._x=h,this._y=f,this.properties=o.properties,this.id=v}get geometry(){return void 0===this._geometry&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(o){this._geometry=o}toJSON(){const o={type:"Feature",geometry:this.geometry,properties:this.properties};void 0!==this.id&&(o.id=this.id);for(const l of MR)void 0!==this[l]&&(o[l]=this[l]);return o}}const Sa=new Uint16Array(8184);for(let a=0;a<2046;a++){let o=a+2,l=0,h=0,f=0,v=0,b=0,C=0;for(1&o?f=v=b=32:l=h=C=32;(o>>=1)>1;){const A=l+f>>1,L=h+v>>1;1&o?(f=l,v=h,l=b,h=C):(l=f,h=v,f=b,v=C),b=A,C=L}const D=4*a;Sa[D+0]=l,Sa[D+1]=h,Sa[D+2]=f,Sa[D+3]=v}const jl=new Uint16Array(2178),jd=new Uint8Array(1089),wg=new Uint16Array(1089);function jy(a){return 0===a?-.03125:32===a?.03125:0}var Kx=Lt([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);const $y={type:2,extent:Un,loadGeometry:()=>[[new Ht(0,0),new Ht(8193,0),new Ht(8193,8193),new Ht(0,8193),new Ht(0,0)]]};class Qx{constructor(o,l,h,f,v){this.tileID=o,this.uid=mh(),this.uses=0,this.tileSize=l,this.tileZoom=h,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=v,this.expiredRequestCount=0,this.state="loading",f&&f.transform&&(this.projection=f.transform.projection)}registerFadeDuration(o){const l=o+this.timeAdded;l<Ui.now()||this.fadeEndTime&&l<this.fadeEndTime||(this.fadeEndTime=l)}wasRequested(){return"errored"===this.state||"loaded"===this.state||"reloading"===this.state}get tileTransform(){return this._tileTransform||(this._tileTransform=Hd(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(o,l,h){if(this.unloadVectorData(),this.state="loaded",o){o.featureIndex&&(this.latestFeatureIndex=o.featureIndex,o.rawTileData?(this.latestRawTileData=o.rawTileData,this.latestFeatureIndex.rawTileData=o.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=o.collisionBoxArray,this.buckets=function(f,v){const b={};if(!v)return b;for(const C of f){const D=C.layerIds.map(A=>v.getLayer(A)).filter(Boolean);if(0!==D.length){C.layers=D,C.stateDependentLayerIds&&(C.stateDependentLayers=C.stateDependentLayerIds.map(A=>D.filter(L=>L.id===A)[0]));for(const A of D)b[A.id]=C}}return b}(o.buckets,l.style),this.hasSymbolBuckets=!1;for(const f in this.buckets){const v=this.buckets[f];if(v instanceof Gd){if(this.hasSymbolBuckets=!0,!h)break;v.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const f in this.buckets){const v=this.buckets[f];if(v instanceof Gd&&v.hasRTLText){this.hasRTLText=!0,Se.isLoading()||Se.isLoaded()||"deferred"!==se()||Me();break}}this.queryPadding=0;for(const f in this.buckets){const v=this.buckets[f];this.queryPadding=Math.max(this.queryPadding,l.style.getLayer(f).queryRadius(v))}o.imageAtlas&&(this.imageAtlas=o.imageAtlas),o.glyphAtlasImage&&(this.glyphAtlasImage=o.glyphAtlasImage),o.lineAtlas&&(this.lineAtlas=o.lineAtlas)}else this.collisionBoxArray=new Gw}unloadVectorData(){if(this.hasData()){for(const o in this.buckets)this.buckets[o].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(o){return this.buckets[o.id]}upload(o){for(const h in this.buckets){const f=this.buckets[h];f.uploadPending()&&f.upload(o)}const l=o.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new Gy(o,this.imageAtlas.image,l.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new Gy(o,this.glyphAtlasImage,l.ALPHA),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new Gy(o,this.lineAtlas.image,l.ALPHA),this.lineAtlas.uploaded=!0)}prepare(o){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(o,this.imageAtlasTexture)}queryRenderedFeatures(o,l,h,f,v,b,C,D){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({tileResult:f,pixelPosMatrix:C,transform:b,params:v,tileTransform:this.tileTransform},o,l,h):{}}querySourceFeatures(o,l){const h=this.latestFeatureIndex;if(!h||!h.rawTileData)return;const f=h.loadVTLayers(),v=l?l.sourceLayer:"",b=f._geojsonTileLayer||f[v];if(!b)return;const C=es(l&&l.filter),{z:D,x:A,y:L}=this.tileID.canonical,B={z:D,x:A,y:L};for(let z=0;z<b.length;z++){const j=b.feature(z);if(C.needGeometry){const te=qh(j,!0);if(!C.filter(new ge(this.tileID.overscaledZ),te,this.tileID.canonical))continue}else if(!C.filter(new ge(this.tileID.overscaledZ),j))continue;const $=h.getId(j,v),Y=new qT(j,D,A,L,$);Y.tile=B,o.push(Y)}}hasData(){return"loaded"===this.state||"reloading"===this.state||"expired"===this.state}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(o){const l=this.expirationTime;if(o.cacheControl){const h=Np(o.cacheControl);h["max-age"]&&(this.expirationTime=Date.now()+1e3*h["max-age"])}else o.expires&&(this.expirationTime=new Date(o.expires).getTime());if(this.expirationTime){const h=Date.now();let f=!1;if(this.expirationTime>h)f=!1;else if(l)if(this.expirationTime<l)f=!0;else{const v=this.expirationTime-l;v?this.expirationTime=h+Math.max(v,3e4):f=!0}else f=!0;f?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-(new Date).getTime(),Math.pow(2,31)-1)}setFeatureState(o,l){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||0===Object.keys(o).length||!l)return;const h=this.latestFeatureIndex.loadVTLayers(),f=l.style.listImages();for(const v in this.buckets){if(!l.style.hasLayer(v))continue;const b=this.buckets[v],C=b.layers[0].sourceLayer||"_geojsonTileLayer",D=h[C],A=o[C];if(!D||!A||0===Object.keys(A).length)continue;if(b.update(A,D,f,this.imageAtlas&&this.imageAtlas.patternPositions||{}),b instanceof Xs||b instanceof Kc){const B=l.style._getSourceCache(b.layers[0].source);l._terrain&&l._terrain.enabled&&B&&b.programConfigurations.needsUpload&&l._terrain._clearRenderCacheForTile(B.id,this.tileID)}const L=l&&l.style&&l.style.getLayer(v);L&&(this.queryPadding=Math.max(this.queryPadding,L.queryRadius(b)))}}holdingForFade(){return void 0!==this.symbolFadeHoldUntil}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<Ui.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(o){this.symbolFadeHoldUntil=Ui.now()+o}setTexture(o,l){const h=l.context,f=h.gl;this.texture=this.texture||l.getTileTexture(o.width),this.texture?this.texture.update(o,{useMipmap:!0}):(this.texture=new Gy(h,o,f.RGBA,{useMipmap:!0}),this.texture.bind(f.LINEAR,f.CLAMP_TO_EDGE),h.extTextureFilterAnisotropic&&f.texParameterf(f.TEXTURE_2D,h.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,h.extTextureFilterAnisotropicMax))}setDependencies(o,l){const h={};for(const f of l)h[f]=!0;this.dependencies[o]=h}hasDependency(o,l){for(const h of o){const f=this.dependencies[h];if(f)for(const v of l)if(f[v])return!0}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(o,l){if(!l||"mercator"===l.name||this._tileDebugBuffer)return;const h=Zc($y,this.tileID.canonical,this.tileTransform)[0],f=new di,v=new Q_;for(let b=0;b<h.length;b++){const{x:C,y:D}=h[b];f.emplaceBack(C,D),v.emplaceBack(b)}v.emplaceBack(0),this._tileDebugIndexBuffer=o.createIndexBuffer(v),this._tileDebugBuffer=o.createVertexBuffer(f,Nf.members),this._tileDebugSegments=Xe.simpleSegment(0,0,f.length,v.length)}_makeTileBoundsBuffers(o,l){if(this._tileBoundsBuffer||!l||"mercator"===l.name)return;const h=Zc($y,this.tileID.canonical,this.tileTransform)[0];let f,v;if(this.isRaster){const b=function(C,D){const A=Hd(C,D),L=Math.pow(2,C.z);for(let te=0;te<33;te++)for(let me=0;me<33;me++){const Ce=Ga((C.x+(me+jy(me))/32)/L),fe=$r((C.y+(te+jy(te))/32)/L),be=D.project(Ce,fe),Pe=33*te+me;jl[2*Pe+0]=Math.round((be.x*A.scale-A.x)*Un),jl[2*Pe+1]=Math.round((be.y*A.scale-A.y)*Un)}jd.fill(0),wg.fill(0);for(let te=2045;te>=0;te--){const me=4*te,Ce=Sa[me+0],fe=Sa[me+1],be=Sa[me+2],Pe=Sa[me+3],Te=Ce+be>>1,Ze=fe+Pe>>1,$e=Te+Ze-fe,ct=Ze+Ce-Te,Tt=33*fe+Ce,Je=33*Pe+be,mt=33*Ze+Te,yt=Math.hypot((jl[2*Tt+0]+jl[2*Je+0])/2-jl[2*mt+0],(jl[2*Tt+1]+jl[2*Je+1])/2-jl[2*mt+1])>=16;if(jd[mt]=jd[mt]||(yt?1:0),te<1022){const wt=33*(fe+ct>>1)+(Ce+$e>>1),It=33*(Pe+ct>>1)+(be+$e>>1);jd[mt]=jd[mt]||jd[wt]||jd[It]}}const B=new dr,z=new ns;let j=0;function $(te,me){const Ce=33*me+te;return 0===wg[Ce]&&(B.emplaceBack(jl[2*Ce+0],jl[2*Ce+1],te*Un/32,me*Un/32),wg[Ce]=++j),wg[Ce]-1}function Y(te,me,Ce,fe,be,Pe){const Te=te+Ce>>1,Ze=me+fe>>1;if(Math.abs(te-be)+Math.abs(me-Pe)>1&&jd[33*Ze+Te])Y(be,Pe,te,me,Te,Ze),Y(Ce,fe,be,Pe,Te,Ze);else{const $e=$(te,me),ct=$(Ce,fe),Tt=$(be,Pe);z.emplaceBack($e,ct,Tt)}}return Y(0,0,32,32,32,0),Y(32,32,0,0,0,32),{vertices:B,indices:z}}(this.tileID.canonical,l);f=b.vertices,v=b.indices}else{f=new dr,v=new ns;for(const{x:C,y:D}of h)f.emplaceBack(C,D,0,0);const b=Mf.exports(f.int16,void 0,4);for(let C=0;C<b.length;C+=3)v.emplaceBack(b[C],b[C+1],b[C+2])}this._tileBoundsBuffer=o.createVertexBuffer(f,Kx.members),this._tileBoundsIndexBuffer=o.createIndexBuffer(v),this._tileBoundsSegments=Xe.simpleSegment(0,0,f.length,v.length)}_makeGlobeTileDebugBuffers(o,l){const h=l.projection;if(!h||"globe"!==h.name||l.freezeTileCoverage)return;const f=this.tileID.canonical,v=Vf(HT(f,l)),b=Uf(l.zoom);let C;b>0&&(C=H0(new Float64Array(16),l.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(o,f,l,v,C,b),this._makeGlobeTileDebugTextBuffer(o,f,l,v,C,b)}_globePoint(o,l,h,f,v,b,C){let D=zf(o,l,h);if(b){const A=1<<h.z,L=qc(f.center.lng),B=Vl(f.center.lat),z=(h.x+.5)/A-L;let j=0;z>.5?j=-1:z<-.5&&(j=1);let $=(o/Un+h.x)/A+j,Y=(l/Un+h.y)/A;$=($-L)*f._pixelsPerMercatorPixel+L,Y=(Y-B)*f._pixelsPerMercatorPixel+B;const te=[$*f.worldSize,Y*f.worldSize,0];_s(te,te,b),D=Bf(D,te,C)}return _s(D,D,v)}_makeGlobeTileDebugBorderBuffer(o,l,h,f,v,b){const C=new di,D=new Q_,A=new ur,L=(z,j,$,Y,te)=>{const me=($-z)/(te-1),Ce=(Y-j)/(te-1),fe=C.length;for(let be=0;be<te;be++){const Pe=z+be*me,Te=j+be*Ce;C.emplaceBack(Pe,Te);const Ze=this._globePoint(Pe,Te,l,h,f,v,b);A.emplaceBack(Ze[0],Ze[1],Ze[2]),D.emplaceBack(fe+be)}},B=Un;L(0,0,B,0,16),L(B,0,B,B,16),L(B,B,0,B,16),L(0,B,0,0,16),this._tileDebugIndexBuffer=o.createIndexBuffer(D),this._tileDebugBuffer=o.createVertexBuffer(C,Nf.members),this._globeTileDebugBorderBuffer=o.createVertexBuffer(A,eM.members),this._tileDebugSegments=Xe.simpleSegment(0,0,C.length,D.length)}_makeGlobeTileDebugTextBuffer(o,l,h,f,v,b){const C=new di,D=new ns,A=new ur,L=25;D.reserve(32),C.reserve(L),A.reserve(L);const B=(z,j)=>L*z+j;for(let z=0;z<L;z++){const j=2048*z;for(let $=0;$<L;$++){const Y=2048*$;C.emplaceBack(Y,j);const te=this._globePoint(Y,j,l,h,f,v,b);A.emplaceBack(te[0],te[1],te[2])}}for(let z=0;z<4;z++)for(let j=0;j<4;j++){const $=B(z,j),Y=B(z,j+1),te=B(z+1,j),me=B(z+1,j+1);D.emplaceBack($,Y,te),D.emplaceBack(te,Y,me)}this._tileDebugTextIndexBuffer=o.createIndexBuffer(D),this._tileDebugTextBuffer=o.createVertexBuffer(C,Nf.members),this._globeTileDebugTextBuffer=o.createVertexBuffer(A,eM.members),this._tileDebugTextSegments=Xe.simpleSegment(0,0,L,32)}}class $d{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(o,l,h){const f=String(l);if(this.stateChanges[o]=this.stateChanges[o]||{},this.stateChanges[o][f]=this.stateChanges[o][f]||{},ci(this.stateChanges[o][f],h),null===this.deletedStates[o]){this.deletedStates[o]={};for(const v in this.state[o])v!==f&&(this.deletedStates[o][v]=null)}else if(this.deletedStates[o]&&null===this.deletedStates[o][f]){this.deletedStates[o][f]={};for(const v in this.state[o][f])h[v]||(this.deletedStates[o][f][v]=null)}else for(const v in h)this.deletedStates[o]&&this.deletedStates[o][f]&&null===this.deletedStates[o][f][v]&&delete this.deletedStates[o][f][v]}removeFeatureState(o,l,h){if(null===this.deletedStates[o])return;const f=String(l);if(this.deletedStates[o]=this.deletedStates[o]||{},h&&void 0!==l)null!==this.deletedStates[o][f]&&(this.deletedStates[o][f]=this.deletedStates[o][f]||{},this.deletedStates[o][f][h]=null);else if(void 0!==l)if(this.stateChanges[o]&&this.stateChanges[o][f])for(h in this.deletedStates[o][f]={},this.stateChanges[o][f])this.deletedStates[o][f][h]=null;else this.deletedStates[o][f]=null;else this.deletedStates[o]=null}getState(o,l){const h=String(l),f=ci({},(this.state[o]||{})[h],(this.stateChanges[o]||{})[h]);if(null===this.deletedStates[o])return{};if(this.deletedStates[o]){const v=this.deletedStates[o][l];if(null===v)return{};for(const b in v)delete f[b]}return f}initializeTileState(o,l){o.setFeatureState(this.state,l)}coalesceChanges(o,l){const h={};for(const f in this.stateChanges){this.state[f]=this.state[f]||{};const v={};for(const b in this.stateChanges[f])this.state[f][b]||(this.state[f][b]={}),ci(this.state[f][b],this.stateChanges[f][b]),v[b]=this.state[f][b];h[f]=v}for(const f in this.deletedStates){this.state[f]=this.state[f]||{};const v={};if(null===this.deletedStates[f])for(const b in this.state[f])v[b]={},this.state[f][b]={};else for(const b in this.deletedStates[f]){if(null===this.deletedStates[f][b])this.state[f][b]={};else for(const C of Object.keys(this.deletedStates[f][b]))delete this.state[f][b][C];v[b]=this.state[f][b]}h[f]=h[f]||{},ci(h[f],v)}if(this.stateChanges={},this.deletedStates={},0!==Object.keys(h).length)for(const f in o)o[f].setFeatureState(h,l)}}class Jx{constructor(o){this.size=o,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(o,l){const h=this.toIdx(o,l);return{min:this.minimums[h],max:this.maximums[h]}}isLeaf(o,l){return this.leaves[this.toIdx(o,l)]}toIdx(o,l){return l*this.size+o}}function mM(a,o,l,h){let f=0,v=Number.MAX_VALUE;for(let b=0;b<3;b++)if(Math.abs(h[b])<1e-15){if(l[b]<a[b]||l[b]>o[b])return null}else{const C=1/h[b];let D=(a[b]-l[b])*C,A=(o[b]-l[b])*C;if(D>A){const L=D;D=A,A=L}if(D>f&&(f=D),A<v&&(v=A),f>v)return null}return f}function gM(a,o,l,h,f,v,b,C,D,A,L){const B=h-a,z=f-o,j=v-l,$=b-a,Y=C-o,te=D-l,me=L[1]*te-L[2]*Y,Ce=L[2]*$-L[0]*te,fe=L[0]*Y-L[1]*$,be=B*me+z*Ce+j*fe;if(Math.abs(be)<1e-15)return null;const Pe=1/be,Te=A[0]-a,Ze=A[1]-o,$e=A[2]-l,ct=(Te*me+Ze*Ce+$e*fe)*Pe;if(ct<0||ct>1)return null;const Tt=Ze*j-$e*z,Je=$e*B-Te*j,mt=Te*z-Ze*B,yt=(L[0]*Tt+L[1]*Je+L[2]*mt)*Pe;return yt<0||ct+yt>1?null:($*Tt+Y*Je+te*mt)*Pe}function eb(a,o,l){return(a-o)/(l-o)}function _M(a,o,l,h,f,v,b,C,D){const A=1<<l,L=v-h,B=b-f,z=(a+1)/A*L+h,j=(o+0)/A*B+f,$=(o+1)/A*B+f;C[0]=(a+0)/A*L+h,C[1]=j,D[0]=z,D[1]=$}class yM{constructor(o){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=o,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const l=function(v){const b=Math.ceil(Math.log2(v.dim/8)),C=[];let D=Math.ceil(Math.pow(2,b));const A=1/D,L=(j,$,Y,te,me)=>{const Ce=te?1:0,fe=(j+1)*Y-Ce,be=$*Y,Pe=($+1)*Y-Ce;me[0]=j*Y,me[1]=be,me[2]=fe,me[3]=Pe};let B=new Jx(D);const z=[];for(let j=0;j<D*D;j++){L(j%D,Math.floor(j/D),A,!1,z);const $=pl(z[0],z[1],v),Y=pl(z[2],z[1],v),te=pl(z[2],z[3],v),me=pl(z[0],z[3],v);B.minimums.push(Math.min($,Y,te,me)),B.maximums.push(Math.max($,Y,te,me)),B.leaves.push(1)}for(C.push(B),D/=2;D>=1;D/=2){const j=C[C.length-1];B=new Jx(D);for(let $=0;$<D*D;$++){L($%D,Math.floor($/D),2,!0,z);const Y=j.getElevation(z[0],z[1]),te=j.getElevation(z[2],z[1]),me=j.getElevation(z[2],z[3]),Ce=j.getElevation(z[0],z[3]),fe=j.isLeaf(z[0],z[1]),be=j.isLeaf(z[2],z[1]),Pe=j.isLeaf(z[2],z[3]),Te=j.isLeaf(z[0],z[3]),Ze=Math.min(Y.min,te.min,me.min,Ce.min),$e=Math.max(Y.max,te.max,me.max,Ce.max),ct=fe&&be&&Pe&&Te;B.maximums.push($e),B.minimums.push(Ze),B.leaves.push($e-Ze<=5&&ct?1:0)}C.push(B)}return C}(this.dem),h=l.length-1,f=l[h];this._addNode(f.minimums[0],f.maximums[0],f.leaves[0]),this._construct(l,0,0,h,0)}raycastRoot(o,l,h,f,v,b,C=1){return mM([o,l,-100],[h,f,this.maximums[0]*C],v,b)}raycast(o,l,h,f,v,b,C=1){if(!this.nodeCount)return null;const D=this.raycastRoot(o,l,h,f,v,b,C);if(null==D)return null;const A=[],L=[],B=[],z=[],j=[{idx:0,t:D,nodex:0,nodey:0,depth:0}];for(;j.length>0;){const{idx:$,t:Y,nodex:te,nodey:me,depth:Ce}=j.pop();if(this.leaves[$]){_M(te,me,Ce,o,l,h,f,B,z);const be=1<<Ce,Pe=(te+0)/be,Te=(te+1)/be,Ze=(me+0)/be,$e=(me+1)/be,ct=pl(Pe,Ze,this.dem)*C,Tt=pl(Te,Ze,this.dem)*C,Je=pl(Te,$e,this.dem)*C,mt=pl(Pe,$e,this.dem)*C,yt=gM(B[0],B[1],ct,z[0],B[1],Tt,z[0],z[1],Je,v,b),wt=gM(z[0],z[1],Je,B[0],z[1],mt,B[0],B[1],ct,v,b),It=Math.min(null!==yt?yt:Number.MAX_VALUE,null!==wt?wt:Number.MAX_VALUE);if(It!==Number.MAX_VALUE)return It;{const ut=cl([],v,b,Y);if(Mg(ct,Tt,mt,Je,eb(ut[0],B[0],z[0]),eb(ut[1],B[1],z[1]))>=ut[2])return Y}continue}let fe=0;for(let be=0;be<this._siblingOffset.length;be++){_M((te<<1)+this._siblingOffset[be][0],(me<<1)+this._siblingOffset[be][1],Ce+1,o,l,h,f,B,z),B[2]=-100,z[2]=this.maximums[this.childOffsets[$]+be]*C;const Pe=mM(B,z,v,b);if(null!=Pe){const Te=Pe;A[be]=Te;let Ze=!1;for(let $e=0;$e<fe&&!Ze;$e++)Te>=A[L[$e]]&&(L.splice($e,0,be),Ze=!0);Ze||(L[fe]=be),fe++}}for(let be=0;be<fe;be++){const Pe=L[be];j.push({idx:this.childOffsets[$]+Pe,t:A[Pe],nodex:(te<<1)+this._siblingOffset[Pe][0],nodey:(me<<1)+this._siblingOffset[Pe][1],depth:Ce+1})}}return null}_addNode(o,l,h){return this.minimums.push(o),this.maximums.push(l),this.leaves.push(h),this.childOffsets.push(0),this.nodeCount++}_construct(o,l,h,f,v){if(1===o[f].isLeaf(l,h))return;this.childOffsets[v]||(this.childOffsets[v]=this.nodeCount);const b=f-1,C=o[b];let D=0,A=0;for(let L=0;L<this._siblingOffset.length;L++){const B=2*l+this._siblingOffset[L][0],z=2*h+this._siblingOffset[L][1],j=C.getElevation(B,z),$=C.isLeaf(B,z),Y=this._addNode(j.min,j.max,$);$&&(D|=1<<L),A||(A=Y)}for(let L=0;L<this._siblingOffset.length;L++)D&1<<L||this._construct(o,2*l+this._siblingOffset[L][0],2*h+this._siblingOffset[L][1],b,A+L)}}function Mg(a,o,l,h,f,v){return Oi(Oi(a,l,v),Oi(o,h,v),f)}function pl(a,o,l){const h=l.dim,f=Ei(a*h-.5,0,h-1),v=Ei(o*h-.5,0,h-1),b=Math.floor(f),C=Math.floor(v),D=Math.min(b+1,h-1),A=Math.min(C+1,h-1);return Mg(l.get(b,C),l.get(D,C),l.get(b,A),l.get(D,A),f-b,v-C)}const Wy={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};class nd{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(o,l,h,f=!1,v=!1){if(this.uid=o,l.height!==l.width)throw new RangeError("DEM tiles must be square");if(h&&"mapbox"!==h&&"terrarium"!==h)return Vr(`"${h}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=l.height;const b=this.dim=l.height-2,C=new Uint32Array(l.data.buffer);if(this.pixels=new Uint8Array(l.data.buffer),this.encoding=h||"mapbox",this.borderReady=f,!f){for(let D=0;D<b;D++)C[this._idx(-1,D)]=C[this._idx(0,D)],C[this._idx(b,D)]=C[this._idx(b-1,D)],C[this._idx(D,-1)]=C[this._idx(D,0)],C[this._idx(D,b)]=C[this._idx(D,b-1)];C[this._idx(-1,-1)]=C[this._idx(0,0)],C[this._idx(b,-1)]=C[this._idx(b-1,0)],C[this._idx(-1,b)]=C[this._idx(0,b-1)],C[this._idx(b,b)]=C[this._idx(b-1,b-1)],v&&this._buildQuadTree()}}_buildQuadTree(){this._tree=new yM(this)}get(o,l,h=!1){h&&(o=Ei(o,-1,this.dim),l=Ei(l,-1,this.dim));const f=4*this._idx(o,l);return("terrarium"===this.encoding?this._unpackTerrarium:this._unpackMapbox)(this.pixels[f],this.pixels[f+1],this.pixels[f+2])}static getUnpackVector(o){return Wy[o]}get unpackVector(){return Wy[this.encoding]}_idx(o,l){if(o<-1||o>=this.dim+1||l<-1||l>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(l+1)*this.stride+(o+1)}_unpackMapbox(o,l,h){return(256*o*256+256*l+h)/10-1e4}_unpackTerrarium(o,l,h){return 256*o+l+h/256-32768}static pack(o,l){const h=[0,0,0,0],f=nd.getUnpackVector(l);let v=Math.floor((o+f[3])/f[2]);return h[2]=v%256,v=Math.floor(v/256),h[1]=v%256,v=Math.floor(v/256),h[0]=v,h}getPixels(){return new dl({width:this.stride,height:this.stride},this.pixels)}backfillBorder(o,l,h){if(this.dim!==o.dim)throw new Error("dem dimension mismatch");let f=l*this.dim,v=l*this.dim+this.dim,b=h*this.dim,C=h*this.dim+this.dim;switch(l){case-1:f=v-1;break;case 1:v=f+1}switch(h){case-1:b=C-1;break;case 1:C=b+1}const D=-l*this.dim,A=-h*this.dim;for(let L=b;L<C;L++)for(let B=f;B<v;B++){const z=4*this._idx(B,L),j=4*this._idx(B+D,L+A);this.pixels[z+0]=o.pixels[j+0],this.pixels[z+1]=o.pixels[j+1],this.pixels[z+2]=o.pixels[j+2],this.pixels[z+3]=o.pixels[j+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}tn(nd,"DEMData"),tn(yM,"DemMinMaxQuadTree",{omit:["dem"]});class tb{constructor(o,l){this.max=o,this.onRemove=l,this.reset()}reset(){for(const o in this.data)for(const l of this.data[o])l.timeout&&clearTimeout(l.timeout),this.onRemove(l.value);return this.data={},this.order=[],this}add(o,l,h){const f=o.wrapped().key;void 0===this.data[f]&&(this.data[f]=[]);const v={value:l,timeout:void 0};if(void 0!==h&&(v.timeout=setTimeout(()=>{this.remove(o,v)},h)),this.data[f].push(v),this.order.push(f),this.order.length>this.max){const b=this._getAndRemoveByKey(this.order[0]);b&&this.onRemove(b)}return this}has(o){return o.wrapped().key in this.data}getAndRemove(o){return this.has(o)?this._getAndRemoveByKey(o.wrapped().key):null}_getAndRemoveByKey(o){const l=this.data[o].shift();return l.timeout&&clearTimeout(l.timeout),0===this.data[o].length&&delete this.data[o],this.order.splice(this.order.indexOf(o),1),l.value}getByKey(o){const l=this.data[o];return l?l[0].value:null}get(o){return this.has(o)?this.data[o.wrapped().key][0].value:null}remove(o,l){if(!this.has(o))return this;const h=o.wrapped().key,f=void 0===l?0:this.data[h].indexOf(l),v=this.data[h][f];return this.data[h].splice(f,1),v.timeout&&clearTimeout(v.timeout),0===this.data[h].length&&delete this.data[h],this.onRemove(v.value),this.order.splice(this.order.indexOf(h),1),this}setMaxSize(o){for(this.max=o;this.order.length>this.max;){const l=this._getAndRemoveByKey(this.order[0]);l&&this.onRemove(l)}return this}filter(o){const l=[];for(const h in this.data)for(const f of this.data[h])o(f.value)||l.push(f);for(const h of l)this.remove(h.value.tileID,h)}}class id{constructor(o,l,h){this.func=o,this.mask=l,this.range=h}}id.ReadOnly=!1,id.ReadWrite=!0,id.disabled=new id(519,id.ReadOnly,[0,1]);class Zy{constructor(o,l,h,f,v,b){this.test=o,this.ref=l,this.mask=h,this.fail=f,this.depthFail=v,this.pass=b}}Zy.disabled=new Zy({func:519,mask:0},0,0,7680,7680,7680);class $l{constructor(o,l,h){this.blendFunction=o,this.blendColor=l,this.mask=h}}$l.Replace=[1,0],$l.disabled=new $l($l.Replace,ms.transparent,[!1,!1,!1,!1]),$l.unblended=new $l($l.Replace,ms.transparent,[!0,!0,!0,!0]),$l.alphaBlended=new $l([1,771],ms.transparent,[!0,!0,!0,!0]);class fl{constructor(o,l,h){this.enable=o,this.mode=l,this.frontFace=h}}fl.disabled=new fl(!1,1029,2305),fl.backCCW=new fl(!0,1029,2305),fl.backCW=new fl(!0,1029,2304),fl.frontCW=new fl(!0,1028,2304),fl.frontCCW=new fl(!0,1028,2305);class op extends ec{constructor(o,l,h){super(),this.id=o,this._onlySymbols=h,l.on("data",f=>{"source"===f.dataType&&"metadata"===f.sourceDataType&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&"source"===f.dataType&&"content"===f.sourceDataType&&(this.reload(),this.transform&&this.update(this.transform))}),l.on("error",()=>{this._sourceErrored=!0}),this._source=l,this._tiles={},this._cache=new tb(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=l.minTileCacheSize,this._maxTileCacheSize=l.maxTileCacheSize,this._loadedParentTiles={},this._coveredTiles={},this._state=new $d,this._isRaster="raster"===this._source.type||"raster-dem"===this._source.type||"custom"===this._source.type&&"raster"===this._source._dataType}onAdd(o){this.map=o,this._minTileCacheSize=void 0===this._minTileCacheSize&&o?o._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=void 0===this._maxTileCacheSize&&o?o._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const o in this._tiles){const l=this._tiles[o];if("loaded"!==l.state&&"errored"!==l.state)return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const o=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,o&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(o,l){return o.isSymbolTile=this._onlySymbols,this._source.loadTile(o,l)}_unloadTile(o){if(this._source.unloadTile)return this._source.unloadTile(o,()=>{})}_abortTile(o){if(this._source.abortTile)return this._source.abortTile(o,()=>{})}serialize(){return this._source.serialize()}prepare(o){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const l in this._tiles){const h=this._tiles[l];h.upload(o),h.prepare(this.map.style.imageManager)}}getIds(){return kc(this._tiles).map(o=>o.tileID).sort(ZT).map(o=>o.key)}getRenderableIds(o){const l=[];for(const h in this._tiles)this._isIdRenderable(+h,o)&&l.push(this._tiles[h]);return o?l.sort((h,f)=>{const v=h.tileID,b=f.tileID,C=new Ht(v.canonical.x,v.canonical.y)._rotate(this.transform.angle),D=new Ht(b.canonical.x,b.canonical.y)._rotate(this.transform.angle);return v.overscaledZ-b.overscaledZ||D.y-C.y||D.x-C.x}).map(h=>h.tileID.key):l.map(h=>h.tileID).sort(ZT).map(h=>h.key)}hasRenderableParent(o){const l=this.findLoadedParent(o,0);return!!l&&this._isIdRenderable(l.tileID.key)}_isIdRenderable(o,l){return this._tiles[o]&&this._tiles[o].hasData()&&!this._coveredTiles[o]&&(l||!this._tiles[o].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const o in this._tiles)"errored"!==this._tiles[o].state&&this._reloadTile(+o,"reloading")}}_reloadTile(o,l){const h=this._tiles[o];h&&("loading"!==h.state&&(h.state=l),this._loadTile(h,this._tileLoaded.bind(this,h,o,l)))}_tileLoaded(o,l,h,f){if(f)if(o.state="errored",404!==f.status)this._source.fire(new zc(f,{tile:o}));else if("raster-dem"===this._source.type&&this.usedForTerrain&&this.map.painter.terrain){const v=this.map.painter.terrain;this.update(this.transform,v.getScaledDemTileSize(),!0),v.resetTileLookupCache(this.id)}else this.update(this.transform);else o.timeAdded=Ui.now(),"expired"===h&&(o.refreshedUponExpiration=!0),this._setTileReloadTimer(l,o),"raster-dem"===this._source.type&&o.dem&&this._backfillDEM(o),this._state.initializeTileState(o,this.map?this.map.painter:null),this._source.fire(new pr("data",{dataType:"source",tile:o,coord:o.tileID,sourceCacheId:this.id}))}_backfillDEM(o){const l=this.getRenderableIds();for(let f=0;f<l.length;f++){const v=l[f];if(o.neighboringTiles&&o.neighboringTiles[v]){const b=this.getTileByID(v);h(o,b),h(b,o)}}function h(f,v){if(!f.dem||f.dem.borderReady)return;f.needsHillshadePrepare=!0,f.needsDEMTextureUpload=!0;let b=v.tileID.canonical.x-f.tileID.canonical.x;const C=v.tileID.canonical.y-f.tileID.canonical.y,D=Math.pow(2,f.tileID.canonical.z),A=v.tileID.key;0===b&&0===C||Math.abs(C)>1||(Math.abs(b)>1&&(1===Math.abs(b+D)?b+=D:1===Math.abs(b-D)&&(b-=D)),v.dem&&f.dem&&(f.dem.backfillBorder(v.dem,b,C),f.neighboringTiles&&f.neighboringTiles[A]&&(f.neighboringTiles[A].backfilled=!0)))}}getTile(o){return this.getTileByID(o.key)}getTileByID(o){return this._tiles[o]}_retainLoadedChildren(o,l,h,f){for(const v in this._tiles){let b=this._tiles[v];if(f[v]||!b.hasData()||b.tileID.overscaledZ<=l||b.tileID.overscaledZ>h)continue;let C=b.tileID;for(;b&&b.tileID.overscaledZ>l+1;){const A=b.tileID.scaledTo(b.tileID.overscaledZ-1);b=this._tiles[A.key],b&&b.hasData()&&(C=A)}let D=C;for(;D.overscaledZ>l;)if(D=D.scaledTo(D.overscaledZ-1),o[D.key]){f[C.key]=C;break}}}findLoadedParent(o,l){if(o.key in this._loadedParentTiles){const h=this._loadedParentTiles[o.key];return h&&h.tileID.overscaledZ>=l?h:null}for(let h=o.overscaledZ-1;h>=l;h--){const f=o.scaledTo(h),v=this._getLoadedTile(f);if(v)return v}}_getLoadedTile(o){const l=this._tiles[o.key];return l&&l.hasData()?l:this._cache.getByKey(this._source.reparseOverscaled?o.wrapped().key:o.canonical.key)}updateCacheSize(o,l){l=l||this._source.tileSize;const h=Math.ceil(o.width/l)+1,f=Math.ceil(o.height/l)+1,v=Math.floor(h*f*5),b="number"==typeof this._minTileCacheSize?Math.max(this._minTileCacheSize,v):v,C="number"==typeof this._maxTileCacheSize?Math.min(this._maxTileCacheSize,b):b;this._cache.setMaxSize(C)}handleWrapJump(o){const l=Math.round((o-(void 0===this._prevLng?o:this._prevLng))/360);if(this._prevLng=o,l){const h={};for(const f in this._tiles){const v=this._tiles[f];v.tileID=v.tileID.unwrapTo(v.tileID.wrap+l),h[v.tileID.key]=v}this._tiles=h;for(const f in this._timers)clearTimeout(this._timers[f]),delete this._timers[f];for(const f in this._tiles)this._setTileReloadTimer(+f,this._tiles[f])}}update(o,l,h){if(this.transform=o,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!h)return;let f;this.updateCacheSize(o,l),"globe"!==this.transform.projection.name&&this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?f=o.getVisibleUnwrappedCoordinates(this._source.tileID).map(C=>new ta(C.canonical.z,C.wrap,C.canonical.z,C.canonical.x,C.canonical.y)):(f=o.coveringTiles({tileSize:l||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!h,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile&&(f=f.filter(C=>this._source.hasTile(C)))):f=[];const v=this._updateRetainedTiles(f);if(vM(this._source.type)&&0!==f.length){const C={},D={},A=Object.keys(v);for(const B of A){const z=v[B],j=this._tiles[B];if(!j||j.fadeEndTime&&j.fadeEndTime<=Ui.now())continue;const $=this.findLoadedParent(z,Math.max(z.overscaledZ-op.maxOverzooming,this._source.minzoom));$&&(this._addTile($.tileID),C[$.tileID.key]=$.tileID),D[B]=z}const L=f[f.length-1].overscaledZ;for(const B in this._tiles){const z=this._tiles[B];if(v[B]||!z.hasData())continue;let j=z.tileID;for(;j.overscaledZ>L;){j=j.scaledTo(j.overscaledZ-1);const $=this._tiles[j.key];if($&&$.hasData()&&D[j.key]){v[B]=z.tileID;break}}}for(const B in C)v[B]||(this._coveredTiles[B]=!0,v[B]=C[B])}for(const C in v)this._tiles[C].clearFadeHold();const b=function(C,D){const A=[];for(const L in C)L in D||A.push(L);return A}(this._tiles,v);for(const C of b){const D=this._tiles[C];D.hasSymbolBuckets&&!D.holdingForFade()?D.setHoldDuration(this.map._fadeDuration):D.hasSymbolBuckets&&!D.symbolFadeFinished()||this._removeTile(+C)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const o in this._tiles)this._tiles[o].holdingForFade()&&this._removeTile(+o)}_updateRetainedTiles(o){const l={};if(0===o.length)return l;const h={},f=o.reduce((A,L)=>Math.min(A,L.overscaledZ),1/0),v=o[0].overscaledZ,b=Math.max(v-op.maxOverzooming,this._source.minzoom),C=Math.max(v+op.maxUnderzooming,this._source.minzoom),D={};for(const A of o){const L=this._addTile(A);l[A.key]=A,L.hasData()||f<this._source.maxzoom&&(D[A.key]=A)}this._retainLoadedChildren(D,f,C,l);for(const A of o){let L=this._tiles[A.key];if(L.hasData())continue;if(A.canonical.z>=this._source.maxzoom){const z=A.children(this._source.maxzoom)[0],j=this.getTile(z);if(j&&j.hasData()){l[z.key]=z;continue}}else{const z=A.children(this._source.maxzoom);if(l[z[0].key]&&l[z[1].key]&&l[z[2].key]&&l[z[3].key])continue}let B=L.wasRequested();for(let z=A.overscaledZ-1;z>=b;--z){const j=A.scaledTo(z);if(h[j.key]||(h[j.key]=!0,L=this.getTile(j),!L&&B&&(L=this._addTile(j)),L&&(l[j.key]=j,B=L.wasRequested(),L.hasData())))break}}return l}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const o in this._tiles){const l=[];let h,f=this._tiles[o].tileID;for(;f.overscaledZ>0;){if(f.key in this._loadedParentTiles){h=this._loadedParentTiles[f.key];break}l.push(f.key);const v=f.scaledTo(f.overscaledZ-1);if(h=this._getLoadedTile(v),h)break;f=v}for(const v of l)this._loadedParentTiles[v]=h}}_addTile(o){let l=this._tiles[o.key];if(l)return l;l=this._cache.getAndRemove(o),l&&(this._setTileReloadTimer(o.key,l),l.tileID=o,this._state.initializeTileState(l,this.map?this.map.painter:null),this._cacheTimers[o.key]&&(clearTimeout(this._cacheTimers[o.key]),delete this._cacheTimers[o.key],this._setTileReloadTimer(o.key,l)));const h=Boolean(l);if(!h){const f=this.map?this.map.painter:null;l=new Qx(o,this._source.tileSize*o.overscaleFactor(),this.transform.tileZoom,f,this._isRaster),this._loadTile(l,this._tileLoaded.bind(this,l,o.key,l.state))}return l?(l.uses++,this._tiles[o.key]=l,h||this._source.fire(new pr("dataloading",{tile:l,coord:l.tileID,dataType:"source"})),l):null}_setTileReloadTimer(o,l){o in this._timers&&(clearTimeout(this._timers[o]),delete this._timers[o]);const h=l.getExpiryTimeout();h&&(this._timers[o]=setTimeout(()=>{this._reloadTile(o,"expired"),delete this._timers[o]},h))}_removeTile(o){const l=this._tiles[o];l&&(l.uses--,delete this._tiles[o],this._timers[o]&&(clearTimeout(this._timers[o]),delete this._timers[o]),l.uses>0||(l.hasData()&&"reloading"!==l.state?this._cache.add(l.tileID,l,l.getExpiryTimeout()):(l.aborted=!0,this._abortTile(l),this._unloadTile(l))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const o in this._tiles)this._removeTile(+o);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(o,l,h){const f=[],v=this.transform;if(!v)return f;const b="globe"===v.projection.name,C=qc(v.center.lng);for(const D in this._tiles){const A=this._tiles[D];if(h&&A.clearQueryDebugViz(),A.holdingForFade())continue;let L;if(b){const B=A.tileID.canonical;if(0===B.z){const z=[Math.abs(Ei(C,...jf(B,-1))-C),Math.abs(Ei(C,...jf(B,1))-C)];L=[0,2*z.indexOf(Math.min(...z))-1]}else{const z=[Math.abs(Ei(C,...jf(B,-1))-C),Math.abs(Ei(C,...jf(B,0))-C),Math.abs(Ei(C,...jf(B,1))-C)];L=[z.indexOf(Math.min(...z))-1]}}else L=[0];for(const B of L){const z=o.containsTile(A,v,l,B);z&&f.push(z)}}return f}getVisibleCoordinates(o){const l=this.getRenderableIds(o).map(h=>this._tiles[h].tileID);for(const h of l)h.projMatrix=this.transform.calculateProjMatrix(h.toUnwrapped());return l}hasTransition(){if(this._source.hasTransition())return!0;if(vM(this._source.type))for(const o in this._tiles){const l=this._tiles[o];if(void 0!==l.fadeEndTime&&l.fadeEndTime>=Ui.now())return!0}return!1}setFeatureState(o,l,h){this._state.updateState(o=o||"_geojsonTileLayer",l,h)}removeFeatureState(o,l,h){this._state.removeFeatureState(o=o||"_geojsonTileLayer",l,h)}getFeatureState(o,l){return this._state.getState(o=o||"_geojsonTileLayer",l)}setDependencies(o,l,h){const f=this._tiles[o];f&&f.setDependencies(l,h)}reloadTilesForDependencies(o,l){for(const h in this._tiles)this._tiles[h].hasDependency(o,l)&&this._reloadTile(+h,"reloading");this._cache.filter(h=>!h.hasDependency(o,l))}_preloadTiles(o,l){const h=new Map,f=Array.isArray(o)?o:[o],v=this.map.painter.terrain,b=this.usedForTerrain&&v?v.getScaledDemTileSize():this._source.tileSize;for(const C of f){const D=C.coveringTiles({tileSize:b,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const A of D)h.set(A.key,A);this.usedForTerrain&&C.updateElevation(!1)}Rc(Array.from(h.values()),(C,D)=>{const A=new Qx(C,this._source.tileSize*C.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(A,L=>{"raster-dem"===this._source.type&&A.dem&&this._backfillDEM(A),D(L,A)})},l)}}function ZT(a,o){const l=Math.abs(2*a.wrap)-+(a.wrap<0),h=Math.abs(2*o.wrap)-+(o.wrap<0);return a.overscaledZ-o.overscaledZ||h-l||o.canonical.y-a.canonical.y||o.canonical.x-a.canonical.x}function vM(a){return"raster"===a||"image"===a||"video"===a||"custom"===a}function jf(a,o){const l=1<<a.z;return[a.x/l+o,(a.x+1)/l+o]}op.maxOverzooming=10,op.maxUnderzooming=3;class Yy{constructor(o,l,h){this._demTile=o,this._dem=this._demTile.dem,this._scale=l,this._offset=h}static create(o,l,h){const f=h||o.findDEMTileFor(l);if(!f||!f.dem)return;const v=f.dem,b=f.tileID,C=1<<l.canonical.z-b.canonical.z;return new Yy(f,f.tileSize/Un/C,[(l.canonical.x/C-b.canonical.x)*v.dim,(l.canonical.y/C-b.canonical.y)*v.dim])}tileCoordToPixel(o,l){const h=l*this._scale+this._offset[1],f=Math.floor(o*this._scale+this._offset[0]),v=Math.floor(h);return new Ht(f,v)}getElevationAt(o,l,h,f){const v=o*this._scale+this._offset[0],b=l*this._scale+this._offset[1],C=Math.floor(v),D=Math.floor(b),A=this._dem;return f=!!f,h?Oi(Oi(A.get(C,D,f),A.get(C,D+1,f),b-D),Oi(A.get(C+1,D,f),A.get(C+1,D+1,f),b-D),v-C):A.get(C,D,f)}getElevationAtPixel(o,l,h){return this._dem.get(o,l,!!h)}getMeterToDEM(o){return(1<<this._demTile.tileID.canonical.z)*ls(1,o)*this._dem.stride}}class nb{constructor(o,l){this.tileID=o,this.x=o.canonical.x,this.y=o.canonical.y,this.z=o.canonical.z,this.grid=new Wc(Un,16,0),this.featureIndexArray=new Gs,this.promoteId=l}insert(o,l,h,f,v,b=0){const C=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(h,f,v,b);const D=this.grid;for(let A=0;A<l.length;A++){const L=l[A],B=[1/0,1/0,-1/0,-1/0];for(let z=0;z<L.length;z++){const j=L[z];B[0]=Math.min(B[0],j.x),B[1]=Math.min(B[1],j.y),B[2]=Math.max(B[2],j.x),B[3]=Math.max(B[3],j.y)}B[0]<Un&&B[1]<Un&&B[2]>=0&&B[3]>=0&&D.insert(C,B[0],B[1],B[2],B[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new C1(new Sy(this.rawTileData)).layers,this.sourceLayerCoder=new WT(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const o in this.vtLayers)this.vtFeatures[o]=[]}return this.vtLayers}query(o,l,h,f){this.loadVTLayers();const v=o.params||{},b=es(v.filter),C=o.tileResult,D=o.transform,A=C.bufferedTilespaceBounds,L=this.grid.query(A.min.x,A.min.y,A.max.x,A.max.y,($,Y,te,me)=>z0(C.bufferedTilespaceGeometry,$,Y,te,me));L.sort(XT);let B=null;D.elevation&&L.length>0&&(B=Yy.create(D.elevation,this.tileID));const z={};let j;for(let $=0;$<L.length;$++){const Y=L[$];if(Y===j)continue;j=Y;const te=this.featureIndexArray.get(Y);let me=null;this.loadMatchingFeature(z,te,b,v.layers,v.availableImages,l,h,f,(Ce,fe,be,Pe=0)=>(me||(me=Zc(Ce,this.tileID.canonical,o.tileTransform)),fe.queryIntersectsFeature(C,Ce,be,me,this.z,o.transform,o.pixelPosMatrix,B,Pe)))}return z}loadMatchingFeature(o,l,h,f,v,b,C,D,A){const{featureIndex:L,bucketIndex:B,sourceLayerIndex:z,layoutVertexArrayOffset:j}=l,$=this.bucketLayerIDs[B];if(f&&!function(Ce,fe){for(let be=0;be<Ce.length;be++)if(fe.indexOf(Ce[be])>=0)return!0;return!1}(f,$))return;const Y=this.sourceLayerCoder.decode(z),te=this.vtLayers[Y].feature(L);if(h.needGeometry){const Ce=qh(te,!0);if(!h.filter(new ge(this.tileID.overscaledZ),Ce,this.tileID.canonical))return}else if(!h.filter(new ge(this.tileID.overscaledZ),te))return;const me=this.getId(te,Y);for(let Ce=0;Ce<$.length;Ce++){const fe=$[Ce];if(f&&f.indexOf(fe)<0)continue;const be=b[fe];if(!be)continue;let Pe={};void 0!==me&&D&&(Pe=D.getState(be.sourceLayer||"_geojsonTileLayer",me));const Te=ci({},C[fe]);Te.paint=ib(Te.paint,be.paint,te,Pe,v),Te.layout=ib(Te.layout,be.layout,te,Pe,v);const Ze=!A||A(te,be,Pe,j);if(!Ze)continue;const $e=new qT(te,this.z,this.x,this.y,me);$e.layer=Te;let ct=o[fe];void 0===ct&&(ct=o[fe]=[]),ct.push({featureIndex:L,feature:$e,intersectionZ:Ze})}}lookupSymbolFeatures(o,l,h,f,v,b,C,D){const A={};this.loadVTLayers();const L=es(v);for(const B of o)this.loadMatchingFeature(A,{bucketIndex:h,sourceLayerIndex:f,featureIndex:B,layoutVertexArrayOffset:0},L,b,C,D,l);return A}loadFeature(o){const{featureIndex:l,sourceLayerIndex:h}=o;this.loadVTLayers();const f=this.sourceLayerCoder.decode(h),v=this.vtFeatures[f];if(v[l])return v[l];const b=this.vtLayers[f].feature(l);return v[l]=b,b}hasLayer(o){for(const l of this.bucketLayerIDs)for(const h of l)if(o===h)return!0;return!1}getId(o,l){let h=o.id;if(this.promoteId){const f="string"==typeof this.promoteId?this.promoteId:this.promoteId[l];null!=f&&(h=o.properties[f]),"boolean"==typeof h&&(h=Number(h))}return h}}function ib(a,o,l,h,f){return Dr(a,(v,b)=>{const C=o instanceof ht?o.get(b):null;return C&&C.evaluate?C.evaluate(l,h,f):C})}function XT(a,o){return o-a}tn(nb,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});class $a{constructor(o,l){this.width=o,this.height=l,this.nextRow=0,this.image=new Yu({width:o,height:l}),this.positions={},this.uploaded=!1}getDash(o,l){const h=this.getKey(o,l);return this.positions[h]}trim(){const o=this.width,l=this.height=Pl(this.nextRow);this.image.resize({width:o,height:l})}getKey(o,l){return o.join(",")+l}getDashRanges(o,l,h){const f=[];let v=o.length%2==1?-o[o.length-1]*h:0,b=o[0]*h,C=!0;f.push({left:v,right:b,isDash:C,zeroLength:0===o[0]});let D=o[0];for(let A=1;A<o.length;A++){C=!C;const L=o[A];v=D*h,D+=L,b=D*h,f.push({left:v,right:b,isDash:C,zeroLength:0===L})}return f}addRoundDash(o,l,h){const f=l/2;for(let v=-h;v<=h;v++){const b=this.width*(this.nextRow+h+v);let C=0,D=o[C];for(let A=0;A<this.width;A++){A/D.right>1&&(D=o[++C]);const L=Math.abs(A-D.left),B=Math.abs(A-D.right),z=Math.min(L,B);let j;const $=v/h*(f+1);if(D.isDash){const Y=f-Math.abs($);j=Math.sqrt(z*z+Y*Y)}else j=f-Math.sqrt(z*z+$*$);this.image.data[b+A]=Math.max(0,Math.min(255,j+128))}}}addRegularDash(o,l){for(let D=o.length-1;D>=0;--D){const A=o[D],L=o[D+1];A.zeroLength?o.splice(D,1):L&&L.isDash===A.isDash&&(L.left=A.left,o.splice(D,1))}const h=o[0],f=o[o.length-1];h.isDash===f.isDash&&(h.left=f.left-this.width,f.right=h.right+this.width);const v=this.width*this.nextRow;let b=0,C=o[b];for(let D=0;D<this.width;D++){D/C.right>1&&(C=o[++b]);const A=Math.abs(D-C.left),L=Math.abs(D-C.right),B=Math.min(A,L);this.image.data[v+D]=Math.max(0,Math.min(255,(C.isDash?B:-B)+l+128))}}addDash(o,l){const h=this.getKey(o,l);if(this.positions[h])return this.positions[h];const f="round"===l,v=f?7:0,b=2*v+1;if(this.nextRow+b>this.height)return Vr("LineAtlas out of space"),null;0===o.length&&o.push(1);let C=0;for(let L=0;L<o.length;L++)o[L]<0&&(Vr("Negative value is found in line dasharray, replacing values with 0"),o[L]=0),C+=o[L];if(0!==C){const L=this.width/C,B=this.getDashRanges(o,this.width,L);f?this.addRoundDash(B,L,v):this.addRegularDash(B,"square"===l?.5*L:0)}const D=this.nextRow+v;this.nextRow+=b;const A={tl:[D,v],br:[C,0]};return this.positions[h]=A,A}}tn($a,"LineAtlas");class rb{constructor(o){const l={},h=[];for(const C in o){const D=o[C],A=l[C]={};for(const L in D.glyphs){const B=D.glyphs[+L];if(!B||0===B.bitmap.width||0===B.bitmap.height)continue;const z=B.metrics.localGlyph?2:1,j={x:0,y:0,w:B.bitmap.width+2*z,h:B.bitmap.height+2*z};h.push(j),A[L]=j}}const{w:f,h:v}=Dy(h),b=new Yu({width:f||1,height:v||1});for(const C in o){const D=o[C];for(const A in D.glyphs){const L=D.glyphs[+A];if(!L||0===L.bitmap.width||0===L.bitmap.height)continue;const B=l[C][A],z=L.metrics.localGlyph?2:1;Yu.copy(L.bitmap,b,{x:0,y:0},{x:B.x+z,y:B.y+z},L.bitmap)}}this.image=b,this.positions=l}}tn(rb,"GlyphAtlas");class YT{constructor(o){this.tileID=new ta(o.tileID.overscaledZ,o.tileID.wrap,o.tileID.canonical.z,o.tileID.canonical.x,o.tileID.canonical.y),this.tileZoom=o.tileZoom,this.uid=o.uid,this.zoom=o.zoom,this.canonical=o.tileID.canonical,this.pixelRatio=o.pixelRatio,this.tileSize=o.tileSize,this.source=o.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=o.showCollisionBoxes,this.collectResourceTiming=!!o.collectResourceTiming,this.returnDependencies=!!o.returnDependencies,this.promoteId=o.promoteId,this.enableTerrain=!!o.enableTerrain,this.isSymbolTile=o.isSymbolTile,this.tileTransform=Hd(o.tileID.canonical,o.projection),this.projection=o.projection}parse(o,l,h,f,v){this.status="parsing",this.data=o,this.collisionBoxArray=new Gw;const b=new WT(Object.keys(o.layers).sort()),C=new nb(this.tileID,this.promoteId);C.bucketLayerIDs=[];const D={},A=new $a(256,256),L={featureIndex:C,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:A,availableImages:h},B=l.familiesBySource[this.source];for(const Pe in B){const Te=o.layers[Pe];if(!Te)continue;let Ze=!1,$e=!1;for(const Je of B[Pe])"symbol"===Je[0].type?Ze=!0:$e=!0;if(!0===this.isSymbolTile&&!Ze||!1===this.isSymbolTile&&!$e)continue;1===Te.version&&Vr(`Vector tile source "${this.source}" layer "${Pe}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const ct=b.encode(Pe),Tt=[];for(let Je=0;Je<Te.length;Je++){const mt=Te.feature(Je),yt=C.getId(mt,Pe);Tt.push({feature:mt,id:yt,index:Je,sourceLayerIndex:ct})}for(const Je of B[Pe]){const mt=Je[0];void 0!==this.isSymbolTile&&"symbol"===mt.type!==this.isSymbolTile||mt.minzoom&&this.zoom<Math.floor(mt.minzoom)||mt.maxzoom&&this.zoom>=mt.maxzoom||"none"!==mt.visibility&&(xM(Je,this.zoom,h),(D[mt.id]=mt.createBucket({index:C.bucketLayerIDs.length,layers:Je,zoom:this.zoom,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:ct,sourceID:this.source,enableTerrain:this.enableTerrain,projection:this.projection.spec,availableImages:h})).populate(Tt,L,this.tileID.canonical,this.tileTransform),C.bucketLayerIDs.push(Je.map(yt=>yt.id)))}}let z,j,$,Y;A.trim();const te={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},me=Dr(L.glyphDependencies,Pe=>Object.keys(Pe).map(Number));Object.keys(me).length?f.send("getGlyphs",{uid:this.uid,stacks:me},(Pe,Te)=>{z||(z=Pe,j=Te,be.call(this))},void 0,!1,te):j={};const Ce=Object.keys(L.iconDependencies);Ce.length?f.send("getImages",{icons:Ce,source:this.source,tileID:this.tileID,type:"icons"},(Pe,Te)=>{z||(z=Pe,$=Te,be.call(this))},void 0,!1,te):$={};const fe=Object.keys(L.patternDependencies);function be(){if(z)return v(z);if(j&&$&&Y){const Pe=new rb(j),Te=new bx($,Y);for(const Ze in D){const $e=D[Ze];$e instanceof Gd?(xM($e.layers,this.zoom,h),J1($e,j,Pe.positions,$,Te.iconPositions,this.showCollisionBoxes,h,this.tileID.canonical,this.tileZoom,this.projection)):$e.hasPattern&&($e instanceof Xs||$e instanceof Kc||$e instanceof Df)&&(xM($e.layers,this.zoom,h),$e.addFeatures(L,this.tileID.canonical,Te.patternPositions,h,this.tileTransform))}this.status="done",v(null,{buckets:kc(D).filter(Ze=>!Ze.isEmpty()),featureIndex:C,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Pe.image,lineAtlas:A,imageAtlas:Te,glyphMap:this.returnDependencies?j:null,iconMap:this.returnDependencies?$:null,glyphPositions:this.returnDependencies?Pe.positions:null})}}fe.length?f.send("getImages",{icons:fe,source:this.source,tileID:this.tileID,type:"patterns"},(Pe,Te)=>{z||(z=Pe,Y=Te,be.call(this))},void 0,!1,te):Y={},be.call(this)}}function xM(a,o,l){const h=new ge(o);for(const f of a)f.recalculate(h,l)}class bM{constructor(o){this.entries={},this.scheduler=o}request(o,l,h,f){const v=this.entries[o]=this.entries[o]||{callbacks:[]};if(v.result){const[b,C]=v.result;return this.scheduler?this.scheduler.add(()=>{f(b,C)},l):f(b,C),()=>{}}return v.callbacks.push(f),v.cancel||(v.cancel=h((b,C)=>{v.result=[b,C];for(const D of v.callbacks)this.scheduler?this.scheduler.add(()=>{D(b,C)},l):D(b,C);setTimeout(()=>delete this.entries[o],3e3)})),()=>{v.result||(v.callbacks=v.callbacks.filter(b=>b!==f),v.callbacks.length||(v.cancel(),delete this.entries[o]))}}}function Ky(a,o,l){const h=JSON.stringify(a.request);return a.data&&(this.deduped.entries[h]={result:[null,a.data]}),this.deduped.request(h,{type:"parseTile",isSymbolTile:a.isSymbolTile,zoom:a.tileZoom},f=>{const v=Tu(a.request,(b,C,D,A)=>{b?f(b):C&&f(null,{vectorTile:l?void 0:new C1(new Sy(C)),rawData:C,cacheControl:D,expires:A})});return()=>{v.cancel(),f()}},o)}g.ARRAY_TYPE=ba,g.AUTH_ERR_MSG=Au,g.Aabb=ea,g.Actor=class{constructor(a,o,l){this.target=a,this.parent=o,this.mapId=l,this.callbacks={},this.cancelCallbacks={},Lc(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.globalScope=kl()?a:lt,this.scheduler=new wR}send(a,o,l,h,f=!1,v){const b=Math.round(1e18*Math.random()).toString(36).substring(0,10);l&&(l.metadata=v,this.callbacks[b]=l);const C=gh(this.globalScope)?void 0:[];return this.target.postMessage({id:b,type:a,hasCallback:!!l,targetMapId:h,mustQueue:f,sourceMapId:this.mapId,data:Ps(o,C)},C),{cancel:()=>{l&&delete this.callbacks[b],this.target.postMessage({id:b,type:"<cancel>",targetMapId:h,sourceMapId:this.mapId})}}}receive(a){const o=a.data,l=o.id;if(l&&(!o.targetMapId||this.mapId===o.targetMapId))if("<cancel>"===o.type){const h=this.cancelCallbacks[l];delete this.cancelCallbacks[l],h&&h.cancel()}else if(o.mustQueue||kl()){const h=this.callbacks[l];this.cancelCallbacks[l]=this.scheduler.add(()=>this.processTask(l,o),h&&h.metadata||{type:"message"})}else this.processTask(l,o)}processTask(a,o){if("<response>"===o.type){const l=this.callbacks[a];delete this.callbacks[a],l&&(o.error?l(po(o.error)):l(null,po(o.data)))}else{const l=gh(this.globalScope)?void 0:[],h=o.hasCallback?(v,b)=>{delete this.cancelCallbacks[a],this.target.postMessage({id:a,type:"<response>",sourceMapId:this.mapId,error:v?Ps(v):null,data:Ps(b,l)},l)}:v=>{},f=po(o.data);if(this.parent[o.type])this.parent[o.type](o.sourceMapId,f,h);else if(this.parent.getWorkerSource){const v=o.type.split(".");this.parent.getWorkerSource(o.sourceMapId,v[0],f.source)[v[1]](f,h)}else h(new Error(`Could not find function ${o.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}},g.CanonicalTileID=My,g.Color=ms,g.ColorMode=$l,g.CullFaceMode=fl,g.DEMData=nd,g.DataConstantProperty=We,g.DedupedRequest=bM,g.DepthMode=id,g.EXTENT=Un,g.Elevation=class{isDataAvailableAtPoint(a){const o=this._source();if(this.isUsingMockSource()||!o||a.y<0||a.y>1)return!1;const l=o.getSource().maxzoom,h=1<<l,f=Math.floor(a.x),v=Math.floor((a.x-f)*h),b=Math.floor(a.y*h),C=this.findDEMTileFor(new ta(l,f,l,v,b));return!(!C||!C.dem)}getAtPointOrZero(a,o=0){return this.getAtPoint(a,o)||0}getAtPoint(a,o,l=!0){if(this.isUsingMockSource())return null;null==o&&(o=null);const h=this._source();if(!h||a.y<0||a.y>1)return o;const f=h.getSource().maxzoom,v=1<<f,b=Math.floor(a.x),C=a.x-b,D=new ta(f,b,f,Math.floor(C*v),Math.floor(a.y*v)),A=this.findDEMTileFor(D);if(!A||!A.dem)return o;const L=A.dem,B=1<<A.tileID.canonical.z,z=(C*B-A.tileID.canonical.x)*L.dim,j=(a.y*B-A.tileID.canonical.y)*L.dim,$=Math.floor(z),Y=Math.floor(j);return(l?this.exaggeration():1)*Oi(Oi(L.get($,Y),L.get($,Y+1),j-Y),Oi(L.get($+1,Y),L.get($+1,Y+1),j-Y),z-$)}getAtTileOffset(a,o,l){const h=1<<a.canonical.z;return this.getAtPointOrZero(new Zu(a.wrap+(a.canonical.x+o/Un)/h,(a.canonical.y+l/Un)/h))}getAtTileOffsetFunc(a,o,l,h){return f=>{const v=this.getAtTileOffset(a,f.x,f.y),b=h.upVector(a.canonical,f.x,f.y);return Jo(b,b,v*h.upVectorScale(a.canonical,o,l).metersToTile),b}}getForTilePoints(a,o,l,h){if(this.isUsingMockSource())return!1;const f=Yy.create(this,a,h);return!!f&&(o.forEach(v=>{v[2]=this.exaggeration()*f.getElevationAt(v[0],v[1],l)}),!0)}getMinMaxForTile(a){if(this.isUsingMockSource())return null;const o=this.findDEMTileFor(a);if(!o||!o.dem)return null;const l=o.dem.tree,h=o.tileID,f=1<<a.canonical.z-h.canonical.z;let v=a.canonical.x/f-h.canonical.x,b=a.canonical.y/f-h.canonical.y,C=0;for(let D=0;D<a.canonical.z-h.canonical.z&&!l.leaves[C];D++){v*=2,b*=2;const A=2*Math.floor(b)+Math.floor(v);C=l.childOffsets[C]+A,v%=1,b%=1}return{min:this.exaggeration()*l.minimums[C],max:this.exaggeration()*l.maximums[C]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(a,o,l){throw new Error("Pure virtual method called.")}pointCoordinate(a){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(a){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}},g.ErrorEvent=zc,g.EvaluationParameters=ge,g.Event=pr,g.Evented=ec,g.FillExtrusionBucket=Df,g.Frustum=eg,g.FrustumCorners=py,g.GLOBE_METERS_TO_ECEF=Lx,g.GLOBE_RADIUS=Ju,g.GLOBE_SCALE_MATCH_LATITUDE=45,g.GLOBE_ZOOM_THRESHOLD_MAX=6,g.GLOBE_ZOOM_THRESHOLD_MIN=5,g.GlobeSharedBuffers=class{constructor(a){this._createGrid(a),this._createPoles(a)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const a of this._poleSegments)a.destroy();for(const a of this._gridSegments)a.destroy();if(this._wireframeIndexBuffer){this._wireframeIndexBuffer.destroy();for(const a of this._wireframeSegments)a.destroy()}}_createGrid(a){const o=new di,l=new ns,h=65;for(let f=0;f<h;f++)for(let v=0;v<h;v++)o.emplaceBack(v,f);this._gridSegments=[];for(let f=0,v=0;f<np.length;f++){const b=np[f];for(let D=0;D<b;D++)for(let A=0;A<64;A++){const L=D*h+A;l.emplaceBack(L+1,L,L+h),l.emplaceBack(L+h,L+h+1,L+1)}const C=64*b*2;this._gridSegments.push(Xe.simpleSegment(0,v,(b+1)*h,C)),v+=C}this._gridBuffer=a.createVertexBuffer(o,Nf.members),this._gridIndexBuffer=a.createIndexBuffer(l,!0)}_createPoles(a){const o=new ns;for(let f=0;f<=64;f++)o.emplaceBack(0,f+1,f+2);this._poleIndexBuffer=a.createIndexBuffer(o,!0);const l=new ol,h=new ol;this._poleSegments=[];for(let f=0,v=0;f<5;f++){const b=360/(1<<f);l.emplaceBack(0,-Ju,0,.5,0),h.emplaceBack(0,-Ju,0,.5,1);for(let C=0;C<=64;C++){const D=C/64,A=Oi(0,b,D),[L,B,z]=gc(aM,GT,A,Ju);l.emplaceBack(L,B,z,D,0),h.emplaceBack(L,B,z,D,1)}this._poleSegments.push(Xe.simpleSegment(v,0,66,64)),v+=66}this._poleNorthVertexBuffer=a.createVertexBuffer(l,kx,!1),this._poleSouthVertexBuffer=a.createVertexBuffer(h,kx,!1)}getGridBuffers(a){return[this._gridBuffer,this._gridIndexBuffer,this._gridSegments[a]]}getPoleBuffers(a){return[this._poleNorthVertexBuffer,this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[a]]}getWirefameBuffers(a,o){if(!this._wireframeSegments){const l=new _o,h=64,f=h+1;this._wireframeSegments=[];for(let v=0,b=0;v<np.length;v++){const C=np[v];for(let A=0;A<C;A++)for(let L=0;L<h;L++){const B=A*f+L;l.emplaceBack(B,B+1),l.emplaceBack(B,B+f),l.emplaceBack(B,B+f+1)}const D=C*h*3;this._wireframeSegments.push(Xe.simpleSegment(0,b,(C+1)*f,D)),b+=D}this._wireframeIndexBuffer=a.createIndexBuffer(l)}return[this._gridBuffer,this._wireframeIndexBuffer,this._wireframeSegments[o]]}},g.GlyphManager=Vd,g.ImagePosition=cg,g.LivePerformanceUtils=_t,g.LngLat=Ii,g.LngLatBounds=xr,g.LocalGlyphMode=ky,g.MAX_MERCATOR_LATITUDE=hc,g.MercatorCoordinate=Zu,g.ONE_EM=24,g.OverscaledTileID=ta,g.PerformanceMarkers=ze,g.Properties=Bt,g.RGBAImage=dl,g.Ray=wf,g.RequestManager=class{constructor(a,o,l){this._transformRequestFn=a,this._customAccessToken=o,this._silenceAuthErrors=!!l,this._createSkuToken()}_createSkuToken(){const a=function(){let o="";for(let l=0;l<10;l++)o+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",Il,o].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=a.token,this._skuTokenExpiresAt=a.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(a,o){return this._transformRequestFn&&this._transformRequestFn(a,o)||{url:a}}normalizeStyleURL(a,o){if(!ka(a))return a;const l=Io(a);return l.path=`/styles/v1${l.path}`,this._makeAPIURL(l,this._customAccessToken||o)}normalizeGlyphsURL(a,o){if(!ka(a))return a;const l=Io(a);return l.path=`/fonts/v1${l.path}`,this._makeAPIURL(l,this._customAccessToken||o)}normalizeSourceURL(a,o,l,h){if(!ka(a))return a;const f=Io(a);return f.path=`/v4/${f.authority}.json`,f.params.push("secure"),l&&f.params.push(`language=${l}`),h&&f.params.push(`worldview=${h}`),this._makeAPIURL(f,this._customAccessToken||o)}normalizeSpriteURL(a,o,l,h){const f=Io(a);return ka(a)?(f.path=`/styles/v1${f.path}/sprite${o}${l}`,this._makeAPIURL(f,this._customAccessToken||h)):(f.path+=`${o}${l}`,Bc(f))}normalizeTileURL(a,o,l){if(this._isSkuTokenExpired()&&this._createSkuToken(),a&&!ka(a))return a;const h=Io(a);h.path=h.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${o||l&&"raster"!==h.authority&&512===l?"@2x":""}${mi.supported?".webp":"$1"}`),"raster"===h.authority?h.path=`/${wi.RASTER_URL_PREFIX}${h.path}`:(h.path=h.path.replace(/^.+\/v4\//,"/"),h.path=`/${wi.TILE_URL_VERSION}${h.path}`);const f=this._customAccessToken||function(v){for(const b of v){const C=b.match(/^access_token=(.*)$/);if(C)return C[1]}return null}(h.params)||wi.ACCESS_TOKEN;return wi.REQUIRE_ACCESS_TOKEN&&f&&this._skuToken&&h.params.push(`sku=${this._skuToken}`),this._makeAPIURL(h,f)}canonicalizeTileURL(a,o){const l=Io(a);if(!l.path.match(/^(\/v4\/|\/raster\/v1\/)/)||!l.path.match(/\.[\w]+$/))return a;let h="mapbox://";l.path.match(/^\/raster\/v1\//)?h+=`raster/${l.path.replace(`/${wi.RASTER_URL_PREFIX}/`,"")}`:h+=`tiles/${l.path.replace(`/${wi.TILE_URL_VERSION}/`,"")}`;let f=l.params;return o&&(f=f.filter(v=>!v.match(/^access_token=/))),f.length&&(h+=`?${f.join("&")}`),h}canonicalizeTileset(a,o){const l=!!o&&ka(o),h=[];for(const f of a.tiles||[])Iu(f)?h.push(this.canonicalizeTileURL(f,l)):h.push(f);return h}_makeAPIURL(a,o){const l="See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes",h=Io(wi.API_URL);if(a.protocol=h.protocol,a.authority=h.authority,"http"===a.protocol){const f=a.params.indexOf("secure");f>=0&&a.params.splice(f,1)}if("/"!==h.path&&(a.path=`${h.path}${a.path}`),!wi.REQUIRE_ACCESS_TOKEN)return Bc(a);if(o=o||wi.ACCESS_TOKEN,!this._silenceAuthErrors){if(!o)throw new Error(`An API access token is required to use Mapbox GL. ${l}`);if("s"===o[0])throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${l}`)}return a.params=a.params.filter(f=>-1===f.indexOf("access_token")),a.params.push(`access_token=${o||""}`),Bc(a)}},g.ResourceType=Ra,g.SegmentVector=Xe,g.SourceCache=op,g.StencilMode=Zy,g.StructArrayLayout1ui2=Q_,g.StructArrayLayout2f1f2i16=go,g.StructArrayLayout2i4=di,g.StructArrayLayout2ui4=_o,g.StructArrayLayout3f12=Ha,g.StructArrayLayout3ui6=ns,g.StructArrayLayout4i8=dr,g.StructArrayLayout5f20=ol,g.Texture=Gy,g.Tile=Qx,g.Transitionable=Ke,g.Uniform1f=pf,g.Uniform1i=class extends ks{constructor(a){super(a),this.current=0}set(a,o,l){this.fetchUniformLocation(a,o)&&this.current!==l&&(this.current=l,this.gl.uniform1i(this.location,l))}},g.Uniform2f=class extends ks{constructor(a){super(a),this.current=[0,0]}set(a,o,l){this.fetchUniformLocation(a,o)&&(l[0]===this.current[0]&&l[1]===this.current[1]||(this.current=l,this.gl.uniform2f(this.location,l[0],l[1])))}},g.Uniform3f=class extends ks{constructor(a){super(a),this.current=[0,0,0]}set(a,o,l){this.fetchUniformLocation(a,o)&&(l[0]===this.current[0]&&l[1]===this.current[1]&&l[2]===this.current[2]||(this.current=l,this.gl.uniform3f(this.location,l[0],l[1],l[2])))}},g.Uniform4f=jh,g.UniformColor=JE,g.UniformMatrix2f=class extends ks{constructor(a){super(a),this.current=tT}set(a,o,l){if(this.fetchUniformLocation(a,o))for(let h=0;h<4;h++)if(l[h]!==this.current[h]){this.current=l,this.gl.uniformMatrix2fv(this.location,!1,l);break}}},g.UniformMatrix3f=class extends ks{constructor(a){super(a),this.current=eT}set(a,o,l){if(this.fetchUniformLocation(a,o))for(let h=0;h<9;h++)if(l[h]!==this.current[h]){this.current=l,this.gl.uniformMatrix3fv(this.location,!1,l);break}}},g.UniformMatrix4f=class extends ks{constructor(a){super(a),this.current=Ww}set(a,o,l){if(this.fetchUniformLocation(a,o)){if(l[12]!==this.current[12]||l[0]!==this.current[0])return this.current=l,void this.gl.uniformMatrix4fv(this.location,!1,l);for(let h=1;h<16;h++)if(l[h]!==this.current[h]){this.current=l,this.gl.uniformMatrix4fv(this.location,!1,l);break}}}},g.UnwrappedTileID=P1,g.ValidationError=Jt,g.VectorTileFeature=ax,g.VectorTileWorkerSource=class extends ec{constructor(a,o,l,h,f){super(),this.actor=a,this.layerIndex=o,this.availableImages=l,this.loadVectorData=f||Ky,this.loading={},this.loaded={},this.deduped=new bM(a.scheduler),this.isSpriteLoaded=h,this.scheduler=a.scheduler}loadTile(a,o){const l=a.uid,h=a&&a.request,f=h&&h.collectResourceTiming,v=this.loading[l]=new YT(a);v.abort=this.loadVectorData(a,(b,C)=>{const D=!this.loading[l];if(delete this.loading[l],D||b||!C)return v.status="done",D||(this.loaded[l]=v),o(b);const A=C.rawData,L={};C.expires&&(L.expires=C.expires),C.cacheControl&&(L.cacheControl=C.cacheControl),v.vectorTile=C.vectorTile||new C1(new Sy(A));const B=()=>{v.parse(v.vectorTile,this.layerIndex,this.availableImages,this.actor,(z,j)=>{if(z||!j)return o(z);const $={};if(f){const Y=Pn(h);Y.length>0&&($.resourceTiming=JSON.parse(JSON.stringify(Y)))}o(null,ci({rawTileData:A.slice(0)},j,L,$))})};this.isSpriteLoaded?B():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(B,{type:"parseTile",isSymbolTile:a.isSymbolTile,zoom:a.tileZoom}):B()}),this.loaded=this.loaded||{},this.loaded[l]=v})}reloadTile(a,o){const l=this.loaded,h=a.uid,f=this;if(l&&l[h]){const v=l[h];v.showCollisionBoxes=a.showCollisionBoxes,v.enableTerrain=!!a.enableTerrain,v.projection=a.projection,v.tileTransform=Hd(a.tileID.canonical,a.projection);const b=(C,D)=>{const A=v.reloadCallback;A&&(delete v.reloadCallback,v.parse(v.vectorTile,f.layerIndex,this.availableImages,f.actor,A)),o(C,D)};"parsing"===v.status?v.reloadCallback=b:"done"===v.status&&(v.vectorTile?v.parse(v.vectorTile,this.layerIndex,this.availableImages,this.actor,b):b())}}abortTile(a,o){const l=a.uid,h=this.loading[l];h&&(h.abort&&h.abort(),delete this.loading[l]),o()}removeTile(a,o){const l=this.loaded,h=a.uid;l&&l[h]&&delete l[h],o()}},g.WritingMode=Ca,g.ZoomHistory=Um,g.add=Xc,g.addDynamicAttributes=Wx,g.adjoint=function(a,o){var l=o[0],h=o[1],f=o[2],v=o[3],b=o[4],C=o[5],D=o[6],A=o[7],L=o[8];return a[0]=b*L-C*A,a[1]=f*A-h*L,a[2]=h*C-f*b,a[3]=C*D-v*L,a[4]=l*L-f*D,a[5]=f*v-l*C,a[6]=v*A-b*D,a[7]=h*D-l*A,a[8]=l*b-h*v,a},g.asyncAll=Rc,g.bezier=fh,g.bindAll=Lc,g.boundsAttributes=Kx,g.bufferConvexPolygon=function(a,o){const l=[];for(let h=0;h<a.length;h++){const f=Wo(h-1,-1,a.length-1),v=Wo(h+1,-1,a.length-1),b=a[h],C=a[v],D=a[f].sub(b).unit(),A=C.sub(b).unit(),L=A.angleWithSep(D.x,D.y),B=D.add(A).unit().mult(-1*o/Math.sin(L/2));l.push(b.add(B))}return l},g.cacheEntryPossiblyAdded=function(a){bd++,bd>Bp&&(a.getActor().send("enforceCacheSizeLimit",xd),bd=0)},g.calculateGlobeLabelMatrix=function(a,o){const{x:l,y:h}=a.point,f=rM(l,h,a.worldSize/a._pixelsPerMercatorPixel,0,0);return xf(f,f,zx(ed(o)))},g.calculateGlobeMatrix=function(a){const{x:o,y:l}=a.point,{lng:h,lat:f}=a._center;return rM(o,l,a.worldSize,h,f)},g.calculateGlobeMercatorMatrix=function(a){const o=a.pixelsPerMeter,l=o/ls(1,a.center.lat),h=Ko(new Float64Array(16));return Ym(h,h,[a.point.x,a.point.y,0]),Xh(h,h,[l,l,o]),Float32Array.from(h)},g.circumferenceAtLatitude=L0,g.clamp=Ei,g.clearTileCache=function(a){if(!vh())return;const o=lt.caches.delete(yh);a&&o.catch(a).then(()=>a())},g.clipLine=Z1,g.clone=function(a){var o=new ba(16);return o[0]=a[0],o[1]=a[1],o[2]=a[2],o[3]=a[3],o[4]=a[4],o[5]=a[5],o[6]=a[6],o[7]=a[7],o[8]=a[8],o[9]=a[9],o[10]=a[10],o[11]=a[11],o[12]=a[12],o[13]=a[13],o[14]=a[14],o[15]=a[15],o},g.clone$1=ua,g.collisionCircleLayout=ST,g.config=wi,g.conjugate=function(a,o){return a[0]=-o[0],a[1]=-o[1],a[2]=-o[2],a[3]=o[3],a},g.create=function(){var a=new ba(16);return ba!=Float32Array&&(a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[11]=0,a[12]=0,a[13]=0,a[14]=0),a[0]=1,a[5]=1,a[10]=1,a[15]=1,a},g.create$1=V0,g.createExpression=Nr,g.createLayout=Lt,g.createStyleLayer=function(a){return"custom"===a.type?new $T(a):new xR[a.type](a)},g.cross=dy,g.degToRad=Si,g.distance=function(a,o){return Math.hypot(o[0]-a[0],o[1]-a[1],o[2]-a[2])},g.div=function(a,o,l){return a[0]=o[0]/l[0],a[1]=o[1]/l[1],a[2]=o[2]/l[2],a},g.dot=ul,g.earthRadius=gf,g.ease=wu,g.easeCubicInOut=bu,g.ecefToLatLng=function([a,o,l]){const h=Math.hypot(a,o,l),f=Math.atan2(a,l),v=.5*Math.PI-Math.acos(-o/h);return new Ii(Es(f),Es(v))},g.emitValidationErrors=Va,g.endsWith=ca,g.enforceCacheSizeLimit=function(a){Eu(),qo&&qo.then(o=>{o.keys().then(l=>{for(let h=0;h<l.length-a;h++)o.delete(l[h])})})},g.evaluateSizeForFeature=Qu,g.evaluateSizeForZoom=ja,g.evaluateVariableOffset=Q1,g.evented=ue,g.exactEquals=function(a,o){return a[0]===o[0]&&a[1]===o[1]&&a[2]===o[2]&&a[3]===o[3]},g.exactEquals$1=function(a,o){return a[0]===o[0]&&a[1]===o[1]&&a[2]===o[2]},g.exported=Ui,g.exported$1=mi,g.extend=ci,g.extend$1=Ll,g.fillExtrusionHeightLift=T1,g.filterObject=Pr,g.fromMat4=function(a,o){return a[0]=o[0],a[1]=o[1],a[2]=o[2],a[3]=o[4],a[4]=o[5],a[5]=o[6],a[6]=o[8],a[7]=o[9],a[8]=o[10],a},g.fromQuat=function(a,o){var l=o[0],h=o[1],f=o[2],v=o[3],b=l+l,C=h+h,D=f+f,A=l*b,L=h*b,B=h*C,z=f*b,j=f*C,$=f*D,Y=v*b,te=v*C,me=v*D;return a[0]=1-B-$,a[1]=L+me,a[2]=z-te,a[3]=0,a[4]=L-me,a[5]=1-A-$,a[6]=j+Y,a[7]=0,a[8]=z+te,a[9]=j-Y,a[10]=1-A-B,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a},g.fromRotation=function(a,o){var l=Math.sin(o),h=Math.cos(o);return a[0]=h,a[1]=l,a[2]=0,a[3]=-l,a[4]=h,a[5]=0,a[6]=0,a[7]=0,a[8]=1,a},g.fromScaling=pc,g.furthestTileCorner=function(a){const o=Math.round((a+45+360)%360/90)%4;return xu[o]},g.getAABBPointSquareDist=function(a,o,l){let h=0;for(let f=0;f<2;++f){const v=l?l[f]:0;a[f]>v&&(h+=(a[f]-v)*(a[f]-v)),o[f]<v&&(h+=(v-o[f])*(v-o[f]))}return h},g.getAnchorAlignment=Iy,g.getAnchorJustification=Rx,g.getBounds=function(a){let o=1/0,l=1/0,h=-1/0,f=-1/0;for(const v of a)o=Math.min(o,v.x),l=Math.min(l,v.y),h=Math.max(h,v.x),f=Math.max(f,v.y);return{min:new Ht(o,l),max:new Ht(h,f)}},g.getColumn=Su,g.getGridMatrix=function(a,o,l,h){const f=o.getNorth(),v=o.getSouth(),b=o.getWest(),C=o.getEast(),D=1<<a.z,A=C-b,L=f-v,B=A/64,z=-L/np[l],j=[0,B,0,z,0,0,f,b,0];if(a.z>0){const $=180/h;U0(j,j,[$/A+1,0,0,0,$/L+1,0,-.5*$/B,.5*$/z,1])}return j[2]=D,j[5]=a.x,j[8]=a.y,j},g.getImage=Nc,g.getJSON=function(a,o){return Fc(ci(a,{type:"json"}),o)},g.getLatitudinalLod=function(a){const o=80.051129;a=Ei(a,-80.051129,o)/o*90;const l=Math.pow(Math.abs(Math.sin(Si(a))),3);return Math.round(l*(np.length-1))},g.getMapSessionAPI=Be,g.getPerformanceMeasurement=Pn,g.getProjection=bg,g.getRTLTextPluginStatus=se,g.getReferrer=bh,g.getTilePoint=function(a,{x:o,y:l},h=0){return new Ht(((o-h)*a.scale-a.x)*Un,(l*a.scale-a.y)*Un)},g.getTileVec3=function(a,o,l=0){return bf(((o.x-l)*a.scale-a.x)*Un,(o.y*a.scale-a.y)*Un,Xw(o.z,o.y))},g.getVideo=function(a,o){const l=lt.document.createElement("video");l.muted=!0,l.onloadstart=function(){o(null,l)};for(let h=0;h<a.length;h++){const f=lt.document.createElement("source");zp(a[h])||(l.crossOrigin="Anonymous"),f.src=a[h],l.appendChild(f)}return{cancel:()=>{}}},g.globeCenterToScreenPoint=function(a){const o=[0,0,0],l=Ko(new Float64Array(16));return xf(l,a.pixelMatrix,a.globeMatrix),_s(o,o,l),new Ht(o[0],o[1])},g.globeDenormalizeECEF=zx,g.globeECEFOrigin=function(a,o){const l=[0,0,0];return _s(l,l,Vf(ed(o.canonical))),_s(l,l,a),l},g.globeNormalizeECEF=Vf,g.globePixelsToTileUnits=function(a,o){return Un/(512*Math.pow(2,a))*ip(ed(o))},g.globePoleMatrixForTile=function(a,o,l){const h=Ko(new Float64Array(16)),f=(o/(1<<a)-.5)*Math.PI*2;return Qo(h,l.globeMatrix,f),Float32Array.from(h)},g.globeTileBounds=ed,g.globeTiltAtLngLat=sM,g.globeToMercatorTransition=Uf,g.globeUseCustomAntiAliasing=function(a,o,l){const h=Uf(l.zoom),f=a.style.map._antialias,v=!!o.extStandardDerivatives,b=o.extStandardDerivativesForceOff||a.terrain&&a.terrain.exaggeration()>0;return 0===h&&!f&&!b&&v},g.identity=Ko,g.identity$1=o1,g.invert=H0,g.isFullscreen=function(){return!!lt.document.fullscreenElement||!!lt.document.webkitFullscreenElement},g.isLngLatBehindGlobe=function(a,o){return sM(a,o)>Math.PI/2*1.01},g.isMapAuthenticated=function(a){return Le.has(a)},g.isMapboxURL=ka,g.isSafariWithAntialiasingBug=function(a){const o=a.navigator?a.navigator.userAgent:null;return!!gh(a)&&o&&(o.match("Version/15.4")||o.match("Version/15.5")||o.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},g.latFromMercatorY=$r,g.latLngToECEF=yg,g.len=q0,g.length=Km,g.length$1=function(a){return Math.hypot(a[0],a[1],a[2],a[3])},g.lngFromMercatorX=Ga,g.loadVectorTile=Ky,g.makeRequest=Fc,g.mapValue=function(a,o,l,h,f){return Ei((a-o)/(l-o)*(f-h)+h,h,f)},g.mercatorScale=_f,g.mercatorXfromLng=qc,g.mercatorYfromLat=Vl,g.mercatorZfromAltitude=ls,g.mul=aT,g.mul$1=W0,g.multiply=xf,g.multiply$1=U0,g.multiply$2=r1,g.nextPowerOfTwo=Pl,g.normalize=js,g.normalize$1=c1,g.normalize$2=uT,g.number=Oi,g.ortho=function(a,o,l,h,f,v,b){var C=1/(o-l),D=1/(h-f),A=1/(v-b);return a[0]=-2*C,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=-2*D,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=2*A,a[11]=0,a[12]=(o+l)*C,a[13]=(f+h)*D,a[14]=(b+v)*A,a[15]=1,a},g.pbf=Sy,g.perspective=function(a,o,l,h,f){var v,b=1/Math.tan(o/2);return a[0]=b/l,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=b,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[11]=-1,a[12]=0,a[13]=0,a[15]=0,null!=f&&f!==1/0?(a[10]=(f+h)*(v=1/(h-f)),a[14]=2*f*h*v):(a[10]=-1,a[14]=-2*h),a},g.pick=function(a,o){const l={};for(let h=0;h<o.length;h++){const f=o[h];f in a&&(l[f]=a[f])}return l},g.plugin=Se,g.pointGeometry=Ht,g.polygonContainsPoint=Zh,g.polygonIntersectsBox=z0,g.polygonIntersectsPolygon=Qw,g.polygonizeBounds=function(a,o,l=0,h=!0){const f=new Ht(l,l),v=a.sub(f),b=o.add(f),C=[v,new Ht(b.x,v.y),b,new Ht(v.x,b.y)];return h&&C.push(v.clone()),C},g.posAttributes=Nf,g.postMapLoadEvent=ce,g.postPerformanceEvent=Re,g.postTurnstileEvent=q,g.potpack=Dy,g.prevPowerOfTwo=function(a){return a<=1?1:Math.pow(2,Math.floor(Math.log(a)/Math.LN2))},g.radToDeg=Es,g.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],g.registerForPluginStateChange=function(a){return a({pluginStatus:ie,pluginURL:le}),ue.on("pluginStateChange",a),a},g.removeAuthState=function(a){Le.delete(a)},g.renderColorRamp=Yh,g.resample=Yw,g.rotateX=G0,g.rotateX$1=a1,g.rotateY=Qo,g.rotateY$1=l1,g.rotateZ=function(a,o,l){var h=Math.sin(l),f=Math.cos(l),v=o[0],b=o[1],C=o[2],D=o[3],A=o[4],L=o[5],B=o[6],z=o[7];return o!==a&&(a[8]=o[8],a[9]=o[9],a[10]=o[10],a[11]=o[11],a[12]=o[12],a[13]=o[13],a[14]=o[14],a[15]=o[15]),a[0]=v*f+A*h,a[1]=b*f+L*h,a[2]=C*f+B*h,a[3]=D*f+z*h,a[4]=A*f-v*h,a[5]=L*f-b*h,a[6]=B*f-C*h,a[7]=z*f-D*h,a},g.rotateZ$1=function(a,o,l){l*=.5;var h=o[0],f=o[1],v=o[2],b=o[3],C=Math.sin(l),D=Math.cos(l);return a[0]=h*D+f*C,a[1]=f*D-h*C,a[2]=v*D+b*C,a[3]=b*D-v*C,a},g.scale=Xh,g.scale$1=cT,g.scale$2=Jo,g.scaleAndAdd=cl,g.set=function(a,o,l,h){return a[0]=o,a[1]=l,a[2]=h,a},g.setCacheLimits=function(a,o){xd=a,Bp=o},g.setColumn=function(a,o,l){a[4*o+0]=l[0],a[4*o+1]=l[1],a[4*o+2]=l[2],a[4*o+3]=l[3]},g.setRTLTextPlugin=function(a,o,l=!1){if(ie===H||ie===Z||ie===Q)throw new Error("setRTLTextPlugin cannot be called multiple times.");le=Ui.resolveURL(a),ie=H,oe=o,ne(),l||Me()},g.smoothstep=Mu,g.spec=rt,g.squaredLength=function(a){var o=a[0],l=a[1],h=a[2];return o*o+l*l+h*h},g.storeAuthState=function(a,o){o?Le.add(a):Le.delete(a)},g.sub=Yc,g.subtract=$0,g.symbolSize=ET,g.tileAABB=function(a,o,l,h,f,v,b,C,D){if("globe"===D.name)return function nM(a,o,l){const h=o/a.worldSize,f=a.globeMatrix;if(l.z<=1){const $e=ed(l).getCorners();return tM($e,f,h),ea.fromPoints($e)}const v=Nx(l),b=Bx(v);tM(b,f,h);const C=Number.MAX_VALUE,D=[-C,-C,-C],A=[C,C,C];if(v.contains(a.center)){for(const Tt of b)Qm(A,A,Tt),Jm(D,D,Tt);D[2]=0;const $e=a.point,ct=[$e.x*h,$e.y*h,0];return Qm(A,A,ct),Jm(D,D,ct),new ea(A,D)}const L=[f[12]*h,f[13]*h,f[14]*h],B=v.getCenter(),z=Ei(a.center.lat,-85.051129,hc),j=Ei(B.lat,-85.051129,hc),$=qc(a.center.lng),Y=Vl(z);let te=$-qc(B.lng);const me=Y-Vl(j);te>.5?te-=1:te<-.5&&(te+=1);let Ce=0;Math.abs(te)>Math.abs(me)?Ce=te>=0?1:3:(Ce=me>=0?0:2,cl(L,L,[f[4]*h,f[5]*h,f[6]*h],-Math.sin(Si(me>=0?v.getSouth():v.getNorth()))*Ju));const fe=b[Ce],be=b[(Ce+1)%4],Pe=new Ox(fe,be,L),Te=[Fx(Pe,0)||fe[0],Fx(Pe,1)||fe[1],Fx(Pe,2)||fe[2]],Ze=Uf(a.zoom);if(Ze>0){const $e=function({x:Tt,y:Je,z:mt},yt,wt,It,ut){const nn=1/(1<<mt);let zn=Tt*nn,on=zn+nn,ln=Je*nn,qt=ln+nn,Rn=0;const li=(zn+on)/2-It;return li>.5?Rn=-1:li<-.5&&(Rn=1),zn=((zn+Rn)*yt-(It*=yt))*wt+It,on=((on+Rn)*yt-It)*wt+It,ln=(ln*yt-(ut*=yt))*wt+ut,qt=(qt*yt-ut)*wt+ut,[[zn,qt,0],[on,qt,0],[on,ln,0],[zn,ln,0]]}(l,o,a._pixelsPerMercatorPixel,$,Y);for(let Tt=0;Tt<b.length;Tt++)Bf(b[Tt],$e[Tt],Ze);const ct=Xc([],$e[Ce],$e[(Ce+1)%4]);Jo(ct,ct,.5),Bf(Te,ct,Ze)}for(const $e of b)Qm(A,A,$e),Jm(D,D,$e);return A[2]=Math.min(fe[2],be[2]),Qm(A,A,Te),Jm(D,D,Te),new ea(A,D)}(a,o,new My(l,h,f));const A=Hd({z:l,x:h,y:f},D);return new ea([(v+A.x/A.scale)*o,o*(A.y/A.scale),b],[(v+A.x2/A.scale)*o,o*(A.y2/A.scale),C])},g.tileCornersToBounds=Nx,g.tileTransform=Hd,g.transformMat3=function(a,o,l){var h=o[0],f=o[1],v=o[2];return a[0]=h*l[0]+f*l[3]+v*l[6],a[1]=h*l[1]+f*l[4]+v*l[7],a[2]=h*l[2]+f*l[5]+v*l[8],a},g.transformMat4=_s,g.transformMat4$1=Bd,g.transformQuat=lT,g.transitionTileAABBinECEF=HT,g.translate=Ym,g.transpose=function(a,o){if(a===o){var l=o[1],h=o[2],f=o[5];a[1]=o[3],a[2]=o[6],a[3]=l,a[5]=o[7],a[6]=h,a[7]=f}else a[0]=o[0],a[1]=o[3],a[2]=o[6],a[3]=o[1],a[4]=o[4],a[5]=o[7],a[6]=o[2],a[7]=o[5],a[8]=o[8];return a},g.triggerPluginCompletionEvent=re,g.uniqueId=mh,g.updateGlobeVertexNormal=function(a,o,l,h,f){const v=5*o+2;a.float32[v+0]=l,a.float32[v+1]=h,a.float32[v+2]=f},g.validateCustomStyleLayer=function(a){const o=[],l=a.id;return void 0===l&&o.push({message:`layers.${l}: missing required property "id"`}),void 0===a.render&&o.push({message:`layers.${l}: missing required method "render"`}),a.renderingMode&&"2d"!==a.renderingMode&&"3d"!==a.renderingMode&&o.push({message:`layers.${l}: property "renderingMode" must be either "2d" or "3d"`}),o},g.validateFilter=a=>_a(za(a)),g.validateFog=a=>_a(W_(a)),g.validateLayer=a=>_a(j_(a)),g.validateLight=a=>_a(Rd(a)),g.validateSource=a=>_a(nf(a)),g.validateStyle=Us,g.validateTerrain=a=>_a(Bm(a)),g.values=kc,g.vectorTile=Ul,g.version=Al,g.warnOnce=Vr,g.window=lt,g.wrap=Wo}),wm(0,function(g){function lt(he){if("number"==typeof he||"boolean"==typeof he||"string"==typeof he||null==he)return JSON.stringify(he);if(Array.isArray(he)){let K="[";for(const ce of he)K+=`${lt(ce)},`;return`${K}]`}let q="{";for(const K of Object.keys(he).sort())q+=`${K}:${lt(he[K])},`;return`${q}}`}function Al(he){let q="";for(const K of g.refProperties)q+=`/${lt(he[K])}`;return q}class Aa{constructor(q){this.keyCache={},q&&this.replace(q)}replace(q){this._layerConfigs={},this._layers={},this.update(q,[])}update(q,K){for(const ye of q)this._layerConfigs[ye.id]=ye,(this._layers[ye.id]=g.createStyleLayer(ye)).compileFilter(),this.keyCache[ye.id]&&delete this.keyCache[ye.id];for(const ye of K)delete this.keyCache[ye],delete this._layerConfigs[ye],delete this._layers[ye];this.familiesBySource={};const ce=function(ye,Re){const Ve={};for(let Le=0;Le<ye.length;Le++){const ze=Re&&Re[ye[Le].id]||Al(ye[Le]);Re&&(Re[ye[Le].id]=ze);let _t=Ve[ze];_t||(_t=Ve[ze]=[]),_t.push(ye[Le])}const Be=[];for(const Le in Ve)Be.push(Ve[Le]);return Be}(g.values(this._layerConfigs),this.keyCache);for(const ye of ce){const Re=ye.map(Gt=>this._layers[Gt.id]),Ve=Re[0];if("none"===Ve.visibility)continue;const Be=Ve.source||"";let Le=this.familiesBySource[Be];Le||(Le=this.familiesBySource[Be]={});const ze=Ve.sourceLayer||"_geojsonTileLayer";let _t=Le[ze];_t||(_t=Le[ze]=[]),_t.push(Re)}}}class wi{loadTile(q,K){const{uid:ce,encoding:ye,rawImageData:Re,padding:Ve,buildQuadTree:Be}=q,Le=g.window.ImageBitmap&&Re instanceof g.window.ImageBitmap?this.getImageData(Re,Ve):Re;K(null,new g.DEMData(ce,Le,ye,Ve<1,Be))}getImageData(q,K){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(q.width,q.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=q.width,this.offscreenCanvas.height=q.height,this.offscreenCanvasContext.drawImage(q,0,0,q.width,q.height);const ce=this.offscreenCanvasContext.getImageData(-K,-K,q.width+2*K,q.height+2*K);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),ce}}var mi=function he(q,K){var ce,ye=q&&q.type;if("FeatureCollection"===ye)for(ce=0;ce<q.features.length;ce++)he(q.features[ce],K);else if("GeometryCollection"===ye)for(ce=0;ce<q.geometries.length;ce++)he(q.geometries[ce],K);else if("Feature"===ye)he(q.geometry,K);else if("Polygon"===ye)Ss(q.coordinates,K);else if("MultiPolygon"===ye)for(ce=0;ce<q.coordinates.length;ce++)Ss(q.coordinates[ce],K);return q};function Ss(he,q){if(0!==he.length){ro(he[0],q);for(var K=1;K<he.length;K++)ro(he[K],!q)}}function ro(he,q){for(var K=0,ce=0,ye=0,Re=he.length,Ve=Re-1;ye<Re;Ve=ye++){var Be=(he[ye][0]-he[Ve][0])*(he[Ve][1]+he[ye][1]),Le=K+Be;ce+=Math.abs(K)>=Math.abs(Be)?K-Le+Be:Be-Le+K,K=Le}K+ce>=0!=!!q&&he.reverse()}const Ja=g.VectorTileFeature.prototype.toGeoJSON;class hh{constructor(q){this._feature=q,this.extent=g.EXTENT,this.type=q.type,this.properties=q.tags,"id"in q&&!isNaN(q.id)&&(this.id=parseInt(q.id,10))}loadGeometry(){if(1===this._feature.type){const q=[];for(const K of this._feature.geometry)q.push([new g.pointGeometry(K[0],K[1])]);return q}{const q=[];for(const K of this._feature.geometry){const ce=[];for(const ye of K)ce.push(new g.pointGeometry(ye[0],ye[1]));q.push(ce)}return q}}toGeoJSON(q,K,ce){return Ja.call(this,q,K,ce)}}class ph{constructor(q){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=g.EXTENT,this.length=q.length,this._features=q}feature(q){return new hh(this._features[q])}}var Il={exports:{}},Pc=g.pointGeometry,Ia=g.vectorTile.VectorTileFeature,Ht=Pa;function Pa(he,q){this.options=q||{},this.features=he,this.length=he.length}function Kl(he,q){this.id="number"==typeof he.id?he.id:void 0,this.type=he.type,this.rawGeometry=1===he.type?[he.geometry]:he.geometry,this.properties=he.tags,this.extent=q||4096}Pa.prototype.feature=function(he){return new Kl(this.features[he],this.options.extent)},Kl.prototype.loadGeometry=function(){var he=this.rawGeometry;this.geometry=[];for(var q=0;q<he.length;q++){for(var K=he[q],ce=[],ye=0;ye<K.length;ye++)ce.push(new Pc(K[ye][0],K[ye][1]));this.geometry.push(ce)}return this.geometry},Kl.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var he=this.geometry,q=1/0,K=-1/0,ce=1/0,ye=-1/0,Re=0;Re<he.length;Re++)for(var Ve=he[Re],Be=0;Be<Ve.length;Be++){var Le=Ve[Be];q=Math.min(q,Le.x),K=Math.max(K,Le.x),ce=Math.min(ce,Le.y),ye=Math.max(ye,Le.y)}return[q,ce,K,ye]},Kl.prototype.toGeoJSON=Ia.prototype.toGeoJSON;var Fp=g.pbf,Si=Ht;function Es(he){var q=new Fp;return function(K,ce){for(var ye in K.layers)ce.writeMessage(3,xu,K.layers[ye])}(he,q),q.finish()}function xu(he,q){var K;q.writeVarintField(15,he.version||1),q.writeStringField(1,he.name||""),q.writeVarintField(5,he.extent||4096);var ce={keys:[],values:[],keycache:{},valuecache:{}};for(K=0;K<he.length;K++)ce.feature=he.feature(K),q.writeMessage(2,bu,ce);var ye=ce.keys;for(K=0;K<ye.length;K++)q.writeStringField(3,ye[K]);var Re=ce.values;for(K=0;K<Re.length;K++)q.writeMessage(4,Wo,Re[K])}function bu(he,q){var K=he.feature;void 0!==K.id&&q.writeVarintField(1,K.id),q.writeMessage(2,fh,he),q.writeVarintField(3,K.type),q.writeMessage(4,Mu,K)}function fh(he,q){var K=he.feature,ce=he.keys,ye=he.values,Re=he.keycache,Ve=he.valuecache;for(var Be in K.properties){var Le=K.properties[Be],ze=Re[Be];if(null!==Le){void 0===ze&&(ce.push(Be),Re[Be]=ze=ce.length-1),q.writeVarint(ze);var _t=typeof Le;"string"!==_t&&"boolean"!==_t&&"number"!==_t&&(Le=JSON.stringify(Le));var Gt=_t+":"+Le,Dt=Ve[Gt];void 0===Dt&&(ye.push(Le),Ve[Gt]=Dt=ye.length-1),q.writeVarint(Dt)}}}function wu(he,q){return(q<<3)+(7&he)}function Ei(he){return he<<1^he>>31}function Mu(he,q){for(var K=he.loadGeometry(),ce=he.type,ye=0,Re=0,Ve=K.length,Be=0;Be<Ve;Be++){var Le=K[Be],ze=1;1===ce&&(ze=Le.length),q.writeVarint(wu(1,ze));for(var _t=3===ce?Le.length-1:Le.length,Gt=0;Gt<_t;Gt++){1===Gt&&1!==ce&&q.writeVarint(wu(2,_t-1));var Dt=Le[Gt].x-ye,Pn=Le[Gt].y-Re;q.writeVarint(Ei(Dt)),q.writeVarint(Ei(Pn)),ye+=Dt,Re+=Pn}3===ce&&q.writeVarint(wu(7,1))}}function Wo(he,q){var K=typeof he;"string"===K?q.writeStringField(1,he):"boolean"===K?q.writeBooleanField(7,he):"number"===K&&(he%1!=0?q.writeDoubleField(3,he):he<0?q.writeSVarintField(6,he):q.writeVarintField(5,he))}function Rc(he,q,K,ce,ye,Re){if(ye-ce<=K)return;const Ve=ce+ye>>1;kc(he,q,Ve,ce,ye,Re%2),Rc(he,q,K,ce,Ve-1,Re+1),Rc(he,q,K,Ve+1,ye,Re+1)}function kc(he,q,K,ce,ye,Re){for(;ye>ce;){if(ye-ce>600){const ze=ye-ce+1,_t=K-ce+1,Gt=Math.log(ze),Dt=.5*Math.exp(2*Gt/3),Pn=.5*Math.sqrt(Gt*Dt*(ze-Dt)/ze)*(_t-ze/2<0?-1:1);kc(he,q,K,Math.max(ce,Math.floor(K-_t*Dt/ze+Pn)),Math.min(ye,Math.floor(K+(ze-_t)*Dt/ze+Pn)),Re)}const Ve=q[2*K+Re];let Be=ce,Le=ye;for(ci(he,q,ce,K),q[2*ye+Re]>Ve&&ci(he,q,ce,ye);Be<Le;){for(ci(he,q,Be,Le),Be++,Le--;q[2*Be+Re]<Ve;)Be++;for(;q[2*Le+Re]>Ve;)Le--}q[2*ce+Re]===Ve?ci(he,q,ce,Le):(Le++,ci(he,q,Le,ye)),Le<=K&&(ce=Le+1),K<=Le&&(ye=Le-1)}}function ci(he,q,K,ce){Cu(he,K,ce),Cu(q,2*K,2*ce),Cu(q,2*K+1,2*ce+1)}function Cu(he,q,K){const ce=he[q];he[q]=he[K],he[K]=ce}function mh(he,q,K,ce){const ye=he-K,Re=q-ce;return ye*ye+Re*Re}Il.exports=Es,Il.exports.fromVectorTileJs=Es,Il.exports.fromGeojsonVt=function(he,q){q=q||{};var K={};for(var ce in he)K[ce]=new Si(he[ce].features,q),K[ce].name=ce,K[ce].version=q.version,K[ce].extent=q.extent;return Es({layers:K})},Il.exports.GeoJSONWrapper=Si;const Ql=he=>he[0],Pl=he=>he[1];class si{constructor(q,K=Ql,ce=Pl,ye=64,Re=Float64Array){this.nodeSize=ye,this.points=q;const Ve=q.length<65536?Uint16Array:Uint32Array,Be=this.ids=new Ve(q.length),Le=this.coords=new Re(2*q.length);for(let ze=0;ze<q.length;ze++)Be[ze]=ze,Le[2*ze]=K(q[ze]),Le[2*ze+1]=ce(q[ze]);Rc(Be,Le,ye,0,Be.length-1,0)}range(q,K,ce,ye){return function(Re,Ve,Be,Le,ze,_t,Gt){const Dt=[0,Re.length-1,0],Pn=[];let Sn,Mn;for(;Dt.length;){const Vn=Dt.pop(),oi=Dt.pop(),Ui=Dt.pop();if(oi-Ui<=Gt){for(let pr=Ui;pr<=oi;pr++)Sn=Ve[2*pr],Mn=Ve[2*pr+1],Sn>=Be&&Sn<=ze&&Mn>=Le&&Mn<=_t&&Pn.push(Re[pr]);continue}const Fn=Math.floor((Ui+oi)/2);Sn=Ve[2*Fn],Mn=Ve[2*Fn+1],Sn>=Be&&Sn<=ze&&Mn>=Le&&Mn<=_t&&Pn.push(Re[Fn]);const or=(Vn+1)%2;(0===Vn?Be<=Sn:Le<=Mn)&&(Dt.push(Ui),Dt.push(Fn-1),Dt.push(or)),(0===Vn?ze>=Sn:_t>=Mn)&&(Dt.push(Fn+1),Dt.push(oi),Dt.push(or))}return Pn}(this.ids,this.coords,q,K,ce,ye,this.nodeSize)}within(q,K,ce){return function(ye,Re,Ve,Be,Le,ze){const _t=[0,ye.length-1,0],Gt=[],Dt=Le*Le;for(;_t.length;){const Pn=_t.pop(),Sn=_t.pop(),Mn=_t.pop();if(Sn-Mn<=ze){for(let or=Mn;or<=Sn;or++)mh(Re[2*or],Re[2*or+1],Ve,Be)<=Dt&&Gt.push(ye[or]);continue}const Vn=Math.floor((Mn+Sn)/2),oi=Re[2*Vn],Ui=Re[2*Vn+1];mh(oi,Ui,Ve,Be)<=Dt&&Gt.push(ye[Vn]);const Fn=(Pn+1)%2;(0===Pn?Ve-Le<=oi:Be-Le<=Ui)&&(_t.push(Mn),_t.push(Vn-1),_t.push(Fn)),(0===Pn?Ve+Le>=oi:Be+Le>=Ui)&&(_t.push(Vn+1),_t.push(Sn),_t.push(Fn))}return Gt}(this.ids,this.coords,q,K,ce,this.nodeSize)}}const Lc={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:he=>he},ca=Math.fround||(Dr=new Float32Array(1),he=>(Dr[0]=+he,Dr[0]));var Dr;class Pr{constructor(q){this.options=Oc(Object.create(Lc),q),this.trees=new Array(this.options.maxZoom+1)}load(q){const{log:K,minZoom:ce,maxZoom:ye,nodeSize:Re}=this.options;K&&console.time("total time");const Ve=`prepare ${q.length} points`;K&&console.time(Ve),this.points=q;let Be=[];for(let Le=0;Le<q.length;Le++)q[Le].geometry&&Be.push(ei(q[Le],Le));this.trees[ye+1]=new si(Be,gh,_h,Re,Float32Array),K&&console.timeEnd(Ve);for(let Le=ye;Le>=ce;Le--){const ze=+Date.now();Be=this._cluster(Be,Le),this.trees[Le]=new si(Be,gh,_h,Re,Float32Array),K&&console.log("z%d: %d clusters in %dms",Le,Be.length,+Date.now()-ze)}return K&&console.timeEnd("total time"),this}getClusters(q,K){let ce=((q[0]+180)%360+360)%360-180;const ye=Math.max(-90,Math.min(90,q[1]));let Re=180===q[2]?180:((q[2]+180)%360+360)%360-180;const Ve=Math.max(-90,Math.min(90,q[3]));if(q[2]-q[0]>=360)ce=-180,Re=180;else if(ce>Re){const _t=this.getClusters([ce,ye,180,Ve],K),Gt=this.getClusters([-180,ye,Re,Ve],K);return _t.concat(Gt)}const Be=this.trees[this._limitZoom(K)],Le=Be.range(Ri(ce),kl(Ve),Ri(Re),kl(ye)),ze=[];for(const _t of Le){const Gt=Be.points[_t];ze.push(Gt.numPoints?Vr(Gt):this.points[Gt.index])}return ze}getChildren(q){const K=this._getOriginId(q),ce=this._getOriginZoom(q),ye="No cluster with the specified id.",Re=this.trees[ce];if(!Re)throw new Error(ye);const Ve=Re.points[K];if(!Ve)throw new Error(ye);const Be=this.options.radius/(this.options.extent*Math.pow(2,ce-1)),Le=Re.within(Ve.x,Ve.y,Be),ze=[];for(const _t of Le){const Gt=Re.points[_t];Gt.parentId===q&&ze.push(Gt.numPoints?Vr(Gt):this.points[Gt.index])}if(0===ze.length)throw new Error(ye);return ze}getLeaves(q,K,ce){const ye=[];return this._appendLeaves(ye,q,K=K||10,ce=ce||0,0),ye}getTile(q,K,ce){const ye=this.trees[this._limitZoom(q)],Re=Math.pow(2,q),{extent:Ve,radius:Be}=this.options,Le=Be/Ve,ze=(ce-Le)/Re,_t=(ce+1+Le)/Re,Gt={features:[]};return this._addTileFeatures(ye.range((K-Le)/Re,ze,(K+1+Le)/Re,_t),ye.points,K,ce,Re,Gt),0===K&&this._addTileFeatures(ye.range(1-Le/Re,ze,1,_t),ye.points,Re,ce,Re,Gt),K===Re-1&&this._addTileFeatures(ye.range(0,ze,Le/Re,_t),ye.points,-1,ce,Re,Gt),Gt.features.length?Gt:null}getClusterExpansionZoom(q){let K=this._getOriginZoom(q)-1;for(;K<=this.options.maxZoom;){const ce=this.getChildren(q);if(K++,1!==ce.length)break;q=ce[0].properties.cluster_id}return K}_appendLeaves(q,K,ce,ye,Re){const Ve=this.getChildren(K);for(const Be of Ve){const Le=Be.properties;if(Le&&Le.cluster?Re+Le.point_count<=ye?Re+=Le.point_count:Re=this._appendLeaves(q,Le.cluster_id,ce,ye,Re):Re<ye?Re++:q.push(Be),q.length===ce)break}return Re}_addTileFeatures(q,K,ce,ye,Re,Ve){for(const Be of q){const Le=K[Be],ze=Le.numPoints;let _t,Gt,Dt;if(ze)_t=Rl(Le),Gt=Le.x,Dt=Le.y;else{const Mn=this.points[Le.index];_t=Mn.properties,Gt=Ri(Mn.geometry.coordinates[0]),Dt=kl(Mn.geometry.coordinates[1])}const Pn={type:1,geometry:[[Math.round(this.options.extent*(Gt*Re-ce)),Math.round(this.options.extent*(Dt*Re-ye))]],tags:_t};let Sn;ze?Sn=Le.id:this.options.generateId?Sn=Le.index:this.points[Le.index].id&&(Sn=this.points[Le.index].id),void 0!==Sn&&(Pn.id=Sn),Ve.features.push(Pn)}}_limitZoom(q){return Math.max(this.options.minZoom,Math.min(Math.floor(+q),this.options.maxZoom+1))}_cluster(q,K){const ce=[],{radius:ye,extent:Re,reduce:Ve,minPoints:Be}=this.options,Le=ye/(Re*Math.pow(2,K));for(let ze=0;ze<q.length;ze++){const _t=q[ze];if(_t.zoom<=K)continue;_t.zoom=K;const Gt=this.trees[K+1],Dt=Gt.within(_t.x,_t.y,Le),Pn=_t.numPoints||1;let Sn=Pn;for(const Mn of Dt){const Vn=Gt.points[Mn];Vn.zoom>K&&(Sn+=Vn.numPoints||1)}if(Sn>Pn&&Sn>=Be){let Mn=_t.x*Pn,Vn=_t.y*Pn,oi=Ve&&Pn>1?this._map(_t,!0):null;const Ui=(ze<<5)+(K+1)+this.points.length;for(const Fn of Dt){const or=Gt.points[Fn];if(or.zoom<=K)continue;or.zoom=K;const pr=or.numPoints||1;Mn+=or.x*pr,Vn+=or.y*pr,or.parentId=Ui,Ve&&(oi||(oi=this._map(_t,!0)),Ve(oi,this._map(or)))}_t.parentId=Ui,ce.push(ua(Mn/Sn,Vn/Sn,Ui,Sn,oi))}else if(ce.push(_t),Sn>1)for(const Mn of Dt){const Vn=Gt.points[Mn];Vn.zoom<=K||(Vn.zoom=K,ce.push(Vn))}}return ce}_getOriginId(q){return q-this.points.length>>5}_getOriginZoom(q){return(q-this.points.length)%32}_map(q,K){if(q.numPoints)return K?Oc({},q.properties):q.properties;const ce=this.points[q.index].properties,ye=this.options.map(ce);return K&&ye===ce?Oc({},ye):ye}}function ua(he,q,K,ce,ye){return{x:ca(he),y:ca(q),zoom:1/0,id:K,parentId:-1,numPoints:ce,properties:ye}}function ei(he,q){const[K,ce]=he.geometry.coordinates;return{x:ca(Ri(K)),y:ca(kl(ce)),zoom:1/0,index:q,parentId:-1}}function Vr(he){return{type:"Feature",id:he.id,properties:Rl(he),geometry:{type:"Point",coordinates:[(q=he.x,360*(q-.5)),Np(he.y)]}};var q}function Rl(he){const q=he.numPoints,K=q>=1e4?`${Math.round(q/1e3)}k`:q>=1e3?Math.round(q/100)/10+"k":q;return Oc(Oc({},he.properties),{cluster:!0,cluster_id:he.id,point_count:q,point_count_abbreviated:K})}function Ri(he){return he/360+.5}function kl(he){const q=Math.sin(he*Math.PI/180),K=.5-.25*Math.log((1+q)/(1-q))/Math.PI;return K<0?0:K>1?1:K}function Np(he){const q=(180-360*he)*Math.PI/180;return 360*Math.atan(Math.exp(q))/Math.PI-90}function Oc(he,q){for(const K in q)he[K]=q[K];return he}function gh(he){return he.x}function _h(he){return he.y}function Su(he,q,K,ce){for(var ye,Re=ce,Ve=K-q>>1,Be=K-q,Le=he[q],ze=he[q+1],_t=he[K],Gt=he[K+1],Dt=q+3;Dt<K;Dt+=3){var Pn=yh(he[Dt],he[Dt+1],Le,ze,_t,Gt);if(Pn>Re)ye=Dt,Re=Pn;else if(Pn===Re){var Sn=Math.abs(Dt-Ve);Sn<Be&&(ye=Dt,Be=Sn)}}Re>ce&&(ye-q>3&&Su(he,q,ye,ce),he[ye+2]=Re,K-ye>3&&Su(he,ye,K,ce))}function yh(he,q,K,ce,ye,Re){var Ve=ye-K,Be=Re-ce;if(0!==Ve||0!==Be){var Le=((he-K)*Ve+(q-ce)*Be)/(Ve*Ve+Be*Be);Le>1?(K=ye,ce=Re):Le>0&&(K+=Ve*Le,ce+=Be*Le)}return(Ve=he-K)*Ve+(Be=q-ce)*Be}function qo(he,q,K,ce){var ye={id:void 0===he?null:he,type:q,geometry:K,tags:ce,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(Re){var Ve=Re.geometry,Be=Re.type;if("Point"===Be||"MultiPoint"===Be||"LineString"===Be)Jl(Re,Ve);else if("Polygon"===Be||"MultiLineString"===Be)for(var Le=0;Le<Ve.length;Le++)Jl(Re,Ve[Le]);else if("MultiPolygon"===Be)for(Le=0;Le<Ve.length;Le++)for(var ze=0;ze<Ve[Le].length;ze++)Jl(Re,Ve[Le][ze])}(ye),ye}function Jl(he,q){for(var K=0;K<q.length;K+=3)he.minX=Math.min(he.minX,q[K]),he.minY=Math.min(he.minY,q[K+1]),he.maxX=Math.max(he.maxX,q[K]),he.maxY=Math.max(he.maxY,q[K+1])}function xd(he,q,K,ce){if(q.geometry){var ye=q.geometry.coordinates,Re=q.geometry.type,Ve=Math.pow(K.tolerance/((1<<K.maxZoom)*K.extent),2),Be=[],Le=q.id;if(K.promoteId?Le=q.properties[K.promoteId]:K.generateId&&(Le=ce||0),"Point"===Re)Bp(ye,Be);else if("MultiPoint"===Re)for(var ze=0;ze<ye.length;ze++)Bp(ye[ze],Be);else if("LineString"===Re)vh(ye,Be,Ve,!1);else if("MultiLineString"===Re){if(K.lineMetrics){for(ze=0;ze<ye.length;ze++)vh(ye[ze],Be=[],Ve,!1),he.push(qo(Le,"LineString",Be,q.properties));return}Eu(ye,Be,Ve,!1)}else if("Polygon"===Re)Eu(ye,Be,Ve,!0);else{if("MultiPolygon"!==Re){if("GeometryCollection"===Re){for(ze=0;ze<q.geometry.geometries.length;ze++)xd(he,{id:Le,geometry:q.geometry.geometries[ze],properties:q.properties},K,ce);return}throw new Error("Input data is not a valid GeoJSON object.")}for(ze=0;ze<ye.length;ze++){var _t=[];Eu(ye[ze],_t,Ve,!0),Be.push(_t)}}he.push(qo(Le,Re,Be,q.properties))}}function Bp(he,q){q.push(el(he[0])),q.push(bd(he[1])),q.push(0)}function vh(he,q,K,ce){for(var ye,Re,Ve=0,Be=0;Be<he.length;Be++){var Le=el(he[Be][0]),ze=bd(he[Be][1]);q.push(Le),q.push(ze),q.push(0),Be>0&&(Ve+=ce?(ye*ze-Le*Re)/2:Math.sqrt(Math.pow(Le-ye,2)+Math.pow(ze-Re,2))),ye=Le,Re=ze}var _t=q.length-3;q[2]=1,Su(q,0,_t,K),q[_t+2]=1,q.size=Math.abs(Ve),q.start=0,q.end=q.size}function Eu(he,q,K,ce){for(var ye=0;ye<he.length;ye++){var Re=[];vh(he[ye],Re,K,ce),q.push(Re)}}function el(he){return he/360+.5}function bd(he){var q=Math.sin(he*Math.PI/180),K=.5-.25*Math.log((1+q)/(1-q))/Math.PI;return K<0?0:K>1?1:K}function Ra(he,q,K,ce,ye,Re,Ve,Be){if(ce/=q,Re>=(K/=q)&&Ve<ce)return he;if(Ve<K||Re>=ce)return null;for(var Le=[],ze=0;ze<he.length;ze++){var _t=he[ze],Gt=_t.geometry,Dt=_t.type,Pn=0===ye?_t.minX:_t.minY,Sn=0===ye?_t.maxX:_t.maxY;if(Pn>=K&&Sn<ce)Le.push(_t);else if(!(Sn<K||Pn>=ce)){var Mn=[];if("Point"===Dt||"MultiPoint"===Dt)xh(Gt,Mn,K,ce,ye);else if("LineString"===Dt)bh(Gt,Mn,K,ce,ye,!1,Be.lineMetrics);else if("MultiLineString"===Dt)Tu(Gt,Mn,K,ce,ye,!1);else if("Polygon"===Dt)Tu(Gt,Mn,K,ce,ye,!0);else if("MultiPolygon"===Dt)for(var Vn=0;Vn<Gt.length;Vn++){var oi=[];Tu(Gt[Vn],oi,K,ce,ye,!0),oi.length&&Mn.push(oi)}if(Mn.length){if(Be.lineMetrics&&"LineString"===Dt){for(Vn=0;Vn<Mn.length;Vn++)Le.push(qo(_t.id,Dt,Mn[Vn],_t.tags));continue}"LineString"!==Dt&&"MultiLineString"!==Dt||(1===Mn.length?(Dt="LineString",Mn=Mn[0]):Dt="MultiLineString"),"Point"!==Dt&&"MultiPoint"!==Dt||(Dt=3===Mn.length?"Point":"MultiPoint"),Le.push(qo(_t.id,Dt,Mn,_t.tags))}}}return Le.length?Le:null}function xh(he,q,K,ce,ye){for(var Re=0;Re<he.length;Re+=3){var Ve=he[Re+ye];Ve>=K&&Ve<=ce&&(q.push(he[Re]),q.push(he[Re+1]),q.push(he[Re+2]))}}function bh(he,q,K,ce,ye,Re,Ve){for(var Be,Le,ze=Fc(he),_t=0===ye?Mm:wh,Gt=he.start,Dt=0;Dt<he.length-3;Dt+=3){var Pn=he[Dt],Sn=he[Dt+1],Mn=he[Dt+2],Vn=he[Dt+3],oi=he[Dt+4],Ui=0===ye?Pn:Sn,Fn=0===ye?Vn:oi,or=!1;Ve&&(Be=Math.sqrt(Math.pow(Pn-Vn,2)+Math.pow(Sn-oi,2))),Ui<K?Fn>K&&(Le=_t(ze,Pn,Sn,Vn,oi,K),Ve&&(ze.start=Gt+Be*Le)):Ui>ce?Fn<ce&&(Le=_t(ze,Pn,Sn,Vn,oi,ce),Ve&&(ze.start=Gt+Be*Le)):zp(ze,Pn,Sn,Mn),Fn<K&&Ui>=K&&(Le=_t(ze,Pn,Sn,Vn,oi,K),or=!0),Fn>ce&&Ui<=ce&&(Le=_t(ze,Pn,Sn,Vn,oi,ce),or=!0),!Re&&or&&(Ve&&(ze.end=Gt+Be*Le),q.push(ze),ze=Fc(he)),Ve&&(Gt+=Be)}var pr=he.length-3;Pn=he[pr],Sn=he[pr+1],Mn=he[pr+2],(Ui=0===ye?Pn:Sn)>=K&&Ui<=ce&&zp(ze,Pn,Sn,Mn),pr=ze.length-3,Re&&pr>=3&&(ze[pr]!==ze[0]||ze[pr+1]!==ze[1])&&zp(ze,ze[0],ze[1],ze[2]),ze.length&&q.push(ze)}function Fc(he){var q=[];return q.size=he.size,q.start=he.start,q.end=he.end,q}function Tu(he,q,K,ce,ye,Re){for(var Ve=0;Ve<he.length;Ve++)bh(he[Ve],q,K,ce,ye,Re,!1)}function zp(he,q,K,ce){he.push(q),he.push(K),he.push(ce)}function Mm(he,q,K,ce,ye,Re){var Ve=(Re-q)/(ce-q);return he.push(Re),he.push(K+(ye-K)*Ve),he.push(1),Ve}function wh(he,q,K,ce,ye,Re){var Ve=(Re-K)/(ye-K);return he.push(q+(ce-q)*Ve),he.push(Re),he.push(1),Ve}function Du(he,q){for(var K=[],ce=0;ce<he.length;ce++){var ye,Re=he[ce],Ve=Re.type;if("Point"===Ve||"MultiPoint"===Ve||"LineString"===Ve)ye=Nc(Re.geometry,q);else if("MultiLineString"===Ve||"Polygon"===Ve){ye=[];for(var Be=0;Be<Re.geometry.length;Be++)ye.push(Nc(Re.geometry[Be],q))}else if("MultiPolygon"===Ve)for(ye=[],Be=0;Be<Re.geometry.length;Be++){for(var Le=[],ze=0;ze<Re.geometry[Be].length;ze++)Le.push(Nc(Re.geometry[Be][ze],q));ye.push(Le)}K.push(qo(Re.id,Ve,ye,Re.tags))}return K}function Nc(he,q){var K=[];K.size=he.size,void 0!==he.start&&(K.start=he.start,K.end=he.end);for(var ce=0;ce<he.length;ce+=3)K.push(he[ce]+q,he[ce+1],he[ce+2]);return K}function Au(he,q){if(he.transformed)return he;var K,ce,ye,Re=1<<he.z,Ve=he.x,Be=he.y;for(K=0;K<he.features.length;K++){var Le=he.features[K],ze=Le.geometry,_t=Le.type;if(Le.geometry=[],1===_t)for(ce=0;ce<ze.length;ce+=2)Le.geometry.push(ka(ze[ce],ze[ce+1],q,Re,Ve,Be));else for(ce=0;ce<ze.length;ce++){var Gt=[];for(ye=0;ye<ze[ce].length;ye+=2)Gt.push(ka(ze[ce][ye],ze[ce][ye+1],q,Re,Ve,Be));Le.geometry.push(Gt)}}return he.transformed=!0,he}function ka(he,q,K,ce,ye,Re){return[Math.round(K*(he*ce-ye)),Math.round(K*(q*ce-Re))]}function Iu(he,q,K,ce,ye){for(var Re=q===ye.maxZoom?0:ye.tolerance/((1<<q)*ye.extent),Ve={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:K,y:ce,z:q,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},Be=0;Be<he.length;Be++){Ve.numFeatures++,Mh(Ve,he[Be],Re,ye);var Le=he[Be].minX,ze=he[Be].minY,_t=he[Be].maxX,Gt=he[Be].maxY;Le<Ve.minX&&(Ve.minX=Le),ze<Ve.minY&&(Ve.minY=ze),_t>Ve.maxX&&(Ve.maxX=_t),Gt>Ve.maxY&&(Ve.maxY=Gt)}return Ve}function Mh(he,q,K,ce){var ye=q.geometry,Re=q.type,Ve=[];if("Point"===Re||"MultiPoint"===Re)for(var Be=0;Be<ye.length;Be+=3)Ve.push(ye[Be]),Ve.push(ye[Be+1]),he.numPoints++,he.numSimplified++;else if("LineString"===Re)wd(Ve,ye,he,K,!1,!1);else if("MultiLineString"===Re||"Polygon"===Re)for(Be=0;Be<ye.length;Be++)wd(Ve,ye[Be],he,K,"Polygon"===Re,0===Be);else if("MultiPolygon"===Re)for(var Le=0;Le<ye.length;Le++){var ze=ye[Le];for(Be=0;Be<ze.length;Be++)wd(Ve,ze[Be],he,K,!0,0===Be)}if(Ve.length){var _t=q.tags||null;if("LineString"===Re&&ce.lineMetrics){for(var Gt in _t={},q.tags)_t[Gt]=q.tags[Gt];_t.mapbox_clip_start=ye.start/ye.size,_t.mapbox_clip_end=ye.end/ye.size}var Dt={geometry:Ve,type:"Polygon"===Re||"MultiPolygon"===Re?3:"LineString"===Re||"MultiLineString"===Re?2:1,tags:_t};null!==q.id&&(Dt.id=q.id),he.features.push(Dt)}}function wd(he,q,K,ce,ye,Re){var Ve=ce*ce;if(ce>0&&q.size<(ye?Ve:ce))K.numPoints+=q.length/3;else{for(var Be=[],Le=0;Le<q.length;Le+=3)(0===ce||q[Le+2]>Ve)&&(K.numSimplified++,Be.push(q[Le]),Be.push(q[Le+1])),K.numPoints++;ye&&function(ze,_t){for(var Gt=0,Dt=0,Pn=ze.length,Sn=Pn-2;Dt<Pn;Sn=Dt,Dt+=2)Gt+=(ze[Dt]-ze[Sn])*(ze[Dt+1]+ze[Sn+1]);if(Gt>0===_t)for(Dt=0,Pn=ze.length;Dt<Pn/2;Dt+=2){var Mn=ze[Dt],Vn=ze[Dt+1];ze[Dt]=ze[Pn-2-Dt],ze[Dt+1]=ze[Pn-1-Dt],ze[Pn-2-Dt]=Mn,ze[Pn-1-Dt]=Vn}}(Be,Re),he.push(Be)}}function Pu(he,q){var K=(q=this.options=function(ye,Re){for(var Ve in Re)ye[Ve]=Re[Ve];return ye}(Object.create(this.options),q)).debug;if(K&&console.time("preprocess data"),q.maxZoom<0||q.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(q.promoteId&&q.generateId)throw new Error("promoteId and generateId cannot be used together.");var ye,Re,Ve,Be,Le,ze,ce=function(ye,Re){var Ve=[];if("FeatureCollection"===ye.type)for(var Be=0;Be<ye.features.length;Be++)xd(Ve,ye.features[Be],Re,Be);else xd(Ve,"Feature"===ye.type?ye:{geometry:ye},Re);return Ve}(he,q);this.tiles={},this.tileCoords=[],K&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",q.indexMaxZoom,q.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),Be=ye=ce,Le=Ra(ye,1,-1-(Ve=(Re=q).buffer/Re.extent),Ve,0,-1,2,Re),ze=Ra(ye,1,1-Ve,2+Ve,0,-1,2,Re),(Le||ze)&&(Be=Ra(ye,1,-Ve,1+Ve,0,-1,2,Re)||[],Le&&(Be=Du(Le,1).concat(Be)),ze&&(Be=Be.concat(Du(ze,-1)))),(ce=Be).length&&this.splitTile(ce,0,0,0),K&&(ce.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function Io(he,q,K){return 32*((1<<he)*K+q)+he}function Bc(he,q){const K=he.tileID.canonical;if(!this._geoJSONIndex)return q(null,null);const ce=this._geoJSONIndex.getTile(K.z,K.x,K.y);if(!ce)return q(null,null);const ye=new ph(ce.features);let Re=Il.exports(ye);0===Re.byteOffset&&Re.byteLength===Re.buffer.byteLength||(Re=new Uint8Array(Re)),q(null,{vectorTile:ye,rawData:Re.buffer})}Pu.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},Pu.prototype.splitTile=function(he,q,K,ce,ye,Re,Ve){for(var Be=[he,q,K,ce],Le=this.options,ze=Le.debug;Be.length;){ce=Be.pop(),K=Be.pop(),q=Be.pop(),he=Be.pop();var _t=1<<q,Gt=Io(q,K,ce),Dt=this.tiles[Gt];if(!Dt&&(ze>1&&console.time("creation"),Dt=this.tiles[Gt]=Iu(he,q,K,ce,Le),this.tileCoords.push({z:q,x:K,y:ce}),ze)){ze>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",q,K,ce,Dt.numFeatures,Dt.numPoints,Dt.numSimplified),console.timeEnd("creation"));var Pn="z"+q;this.stats[Pn]=(this.stats[Pn]||0)+1,this.total++}if(Dt.source=he,ye){if(q===Le.maxZoom||q===ye)continue;var Sn=1<<ye-q;if(K!==Math.floor(Re/Sn)||ce!==Math.floor(Ve/Sn))continue}else if(q===Le.indexMaxZoom||Dt.numPoints<=Le.indexMaxPoints)continue;if(Dt.source=null,0!==he.length){ze>1&&console.time("clipping");var Mn,Vn,oi,Ui,Fn,or,pr=.5*Le.buffer/Le.extent,zc=.5-pr,ec=.5+pr,rt=1+pr;Mn=Vn=oi=Ui=null,Fn=Ra(he,_t,K-pr,K+ec,0,Dt.minX,Dt.maxX,Le),or=Ra(he,_t,K+zc,K+rt,0,Dt.minX,Dt.maxX,Le),he=null,Fn&&(Mn=Ra(Fn,_t,ce-pr,ce+ec,1,Dt.minY,Dt.maxY,Le),Vn=Ra(Fn,_t,ce+zc,ce+rt,1,Dt.minY,Dt.maxY,Le),Fn=null),or&&(oi=Ra(or,_t,ce-pr,ce+ec,1,Dt.minY,Dt.maxY,Le),Ui=Ra(or,_t,ce+zc,ce+rt,1,Dt.minY,Dt.maxY,Le),or=null),ze>1&&console.timeEnd("clipping"),Be.push(Mn||[],q+1,2*K,2*ce),Be.push(Vn||[],q+1,2*K,2*ce+1),Be.push(oi||[],q+1,2*K+1,2*ce),Be.push(Ui||[],q+1,2*K+1,2*ce+1)}}},Pu.prototype.getTile=function(he,q,K){var ce=this.options,ye=ce.extent,Re=ce.debug;if(he<0||he>24)return null;var Ve=1<<he,Be=Io(he,q=(q%Ve+Ve)%Ve,K);if(this.tiles[Be])return Au(this.tiles[Be],ye);Re>1&&console.log("drilling down to z%d-%d-%d",he,q,K);for(var Le,ze=he,_t=q,Gt=K;!Le&&ze>0;)ze--,_t=Math.floor(_t/2),Gt=Math.floor(Gt/2),Le=this.tiles[Io(ze,_t,Gt)];return Le&&Le.source?(Re>1&&console.log("found parent tile z%d-%d-%d",ze,_t,Gt),Re>1&&console.time("drilling down"),this.splitTile(Le.source,ze,_t,Gt,he,q,K),Re>1&&console.timeEnd("drilling down"),this.tiles[Be]?Au(this.tiles[Be],ye):null):null};class Md extends g.VectorTileWorkerSource{constructor(q,K,ce,ye,Re){super(q,K,ce,ye,Bc),Re&&(this.loadGeoJSON=Re)}loadData(q,K){const ce=q&&q.request,ye=ce&&ce.collectResourceTiming;this.loadGeoJSON(q,(Re,Ve)=>{if(Re||!Ve)return K(Re);if("object"!=typeof Ve)return K(new Error(`Input data given to '${q.source}' is not a valid GeoJSON object.`));{mi(Ve,!0);try{if(q.filter){const Le=g.createExpression(q.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if("error"===Le.result)throw new Error(Le.value.map(_t=>`${_t.key}: ${_t.message}`).join(", "));const ze=Ve.features.filter(_t=>Le.value.evaluate({zoom:0},_t));Ve={type:"FeatureCollection",features:ze}}this._geoJSONIndex=q.cluster?new Pr(function({superclusterOptions:Le,clusterProperties:ze}){if(!ze||!Le)return Le;const _t={},Gt={},Dt={accumulated:null,zoom:0},Pn={properties:null},Sn=Object.keys(ze);for(const Mn of Sn){const[Vn,oi]=ze[Mn],Ui=g.createExpression(oi),Fn=g.createExpression("string"==typeof Vn?[Vn,["accumulated"],["get",Mn]]:Vn);_t[Mn]=Ui.value,Gt[Mn]=Fn.value}return Le.map=Mn=>{Pn.properties=Mn;const Vn={};for(const oi of Sn)Vn[oi]=_t[oi].evaluate(Dt,Pn);return Vn},Le.reduce=(Mn,Vn)=>{Pn.properties=Vn;for(const oi of Sn)Dt.accumulated=Mn[oi],Mn[oi]=Gt[oi].evaluate(Dt,Pn)},Le}(q)).load(Ve.features):new Pu(Le=Ve,q.geojsonVtOptions)}catch(Le){return K(Le)}this.loaded={};const Be={};if(ye){const Le=g.getPerformanceMeasurement(ce);Le&&(Be.resourceTiming={},Be.resourceTiming[q.source]=JSON.parse(JSON.stringify(Le)))}K(null,Be)}var Le})}reloadTile(q,K){const ce=this.loaded;return ce&&ce[q.uid]?super.reloadTile(q,K):this.loadTile(q,K)}loadGeoJSON(q,K){if(q.request)g.getJSON(q.request,K);else{if("string"!=typeof q.data)return K(new Error(`Input data given to '${q.source}' is not a valid GeoJSON object.`));try{return K(null,JSON.parse(q.data))}catch{return K(new Error(`Input data given to '${q.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(q,K){try{K(null,this._geoJSONIndex.getClusterExpansionZoom(q.clusterId))}catch(ce){K(ce)}}getClusterChildren(q,K){try{K(null,this._geoJSONIndex.getChildren(q.clusterId))}catch(ce){K(ce)}}getClusterLeaves(q,K){try{K(null,this._geoJSONIndex.getLeaves(q.clusterId,q.limit,q.offset))}catch(ce){K(ce)}}}class ws{constructor(q){this.self=q,this.actor=new g.Actor(q,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=g.getProjection({name:"mercator"}),this.workerSourceTypes={vector:g.VectorTileWorkerSource,geojson:Md},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(K,ce)=>{if(this.workerSourceTypes[K])throw new Error(`Worker source with name "${K}" already registered.`);this.workerSourceTypes[K]=ce},this.self.registerRTLTextPlugin=K=>{if(g.plugin.isParsed())throw new Error("RTL text plugin already registered.");g.plugin.applyArabicShaping=K.applyArabicShaping,g.plugin.processBidirectionalText=K.processBidirectionalText,g.plugin.processStyledBidirectionalText=K.processStyledBidirectionalText}}clearCaches(q,K,ce){delete this.layerIndexes[q],delete this.availableImages[q],delete this.workerSources[q],delete this.demWorkerSources[q],ce()}checkIfReady(q,K,ce){ce()}setReferrer(q,K){this.referrer=K}spriteLoaded(q,K){this.isSpriteLoaded[q]=K;for(const ce in this.workerSources[q]){const ye=this.workerSources[q][ce];for(const Re in ye)ye[Re]instanceof g.VectorTileWorkerSource&&(ye[Re].isSpriteLoaded=K,ye[Re].fire(new g.Event("isSpriteLoaded")))}}setImages(q,K,ce){this.availableImages[q]=K;for(const ye in this.workerSources[q]){const Re=this.workerSources[q][ye];for(const Ve in Re)Re[Ve].availableImages=K}ce()}enableTerrain(q,K,ce){this.terrain=K,ce()}setProjection(q,K){this.projections[q]=g.getProjection(K)}setLayers(q,K,ce){this.getLayerIndex(q).replace(K),ce()}updateLayers(q,K,ce){this.getLayerIndex(q).update(K.layers,K.removedIds),ce()}loadTile(q,K,ce){const ye=this.enableTerrain?g.extend({enableTerrain:this.terrain},K):K;ye.projection=this.projections[q]||this.defaultProjection,this.getWorkerSource(q,K.type,K.source).loadTile(ye,ce)}loadDEMTile(q,K,ce){const ye=this.enableTerrain?g.extend({buildQuadTree:this.terrain},K):K;this.getDEMWorkerSource(q,K.source).loadTile(ye,ce)}reloadTile(q,K,ce){const ye=this.enableTerrain?g.extend({enableTerrain:this.terrain},K):K;ye.projection=this.projections[q]||this.defaultProjection,this.getWorkerSource(q,K.type,K.source).reloadTile(ye,ce)}abortTile(q,K,ce){this.getWorkerSource(q,K.type,K.source).abortTile(K,ce)}removeTile(q,K,ce){this.getWorkerSource(q,K.type,K.source).removeTile(K,ce)}removeSource(q,K,ce){if(!this.workerSources[q]||!this.workerSources[q][K.type]||!this.workerSources[q][K.type][K.source])return;const ye=this.workerSources[q][K.type][K.source];delete this.workerSources[q][K.type][K.source],void 0!==ye.removeSource?ye.removeSource(K,ce):ce()}loadWorkerSource(q,K,ce){try{this.self.importScripts(K.url),ce()}catch(ye){ce(ye.toString())}}syncRTLPluginState(q,K,ce){try{g.plugin.setState(K);const ye=g.plugin.getPluginURL();if(g.plugin.isLoaded()&&!g.plugin.isParsed()&&null!=ye){this.self.importScripts(ye);const Re=g.plugin.isParsed();ce(Re?void 0:new Error(`RTL Text Plugin failed to import scripts from ${ye}`),Re)}}catch(ye){ce(ye.toString())}}getAvailableImages(q){let K=this.availableImages[q];return K||(K=[]),K}getLayerIndex(q){let K=this.layerIndexes[q];return K||(K=this.layerIndexes[q]=new Aa),K}getWorkerSource(q,K,ce){return this.workerSources[q]||(this.workerSources[q]={}),this.workerSources[q][K]||(this.workerSources[q][K]={}),this.workerSources[q][K][ce]||(this.workerSources[q][K][ce]=new this.workerSourceTypes[K]({send:(Re,Ve,Be,Le,ze,_t)=>{this.actor.send(Re,Ve,Be,q,ze,_t)},scheduler:this.actor.scheduler},this.getLayerIndex(q),this.getAvailableImages(q),this.isSpriteLoaded[q])),this.workerSources[q][K][ce]}getDEMWorkerSource(q,K){return this.demWorkerSources[q]||(this.demWorkerSources[q]={}),this.demWorkerSources[q][K]||(this.demWorkerSources[q][K]=new wi),this.demWorkerSources[q][K]}enforceCacheSizeLimit(q,K){g.enforceCacheSizeLimit(K)}getWorkerPerformanceMetrics(q,K,ce){ce(void 0,void 0)}}return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope&&(self.worker=new ws(self)),ws}),wm(0,function(g){function lt(_,u){if(Array.isArray(_)){if(!Array.isArray(u)||_.length!==u.length)return!1;for(let p=0;p<_.length;p++)if(!lt(_[p],u[p]))return!1;return!0}if("object"==typeof _&&null!==_&&null!==u){if("object"!=typeof u||Object.keys(_).length!==Object.keys(u).length)return!1;for(const p in _)if(!lt(_[p],u[p]))return!1;return!0}return _===u}var Al=Aa;function Aa(_){return u=_,!(typeof window>"u"||typeof document>"u"||!(Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray)||!Function.prototype||!Function.prototype.bind||!(Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions)||!("JSON"in window&&"parse"in JSON&&"stringify"in JSON)||!function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var x,M,E=new Blob([""],{type:"text/javascript"}),P=URL.createObjectURL(E);try{M=new Worker(P),x=!0}catch{x=!1}return M&&M.terminate(),URL.revokeObjectURL(P),x}()||!("Uint8ClampedArray"in window)||!ArrayBuffer.isView||!function(){var x=document.createElement("canvas");x.width=x.height=1;var M=x.getContext("2d");if(!M)return!1;var E=M.getImageData(0,0,1,1);return E&&E.width===x.width}()||(void 0===wi[p=u&&u.failIfMajorPerformanceCaveat]&&(wi[p]=function(x){var M,P,O,N,E=(P=x,O=document.createElement("canvas"),(N=Object.create(Aa.webGLContextAttributes)).failIfMajorPerformanceCaveat=P,O.getContext("webgl",N)||O.getContext("experimental-webgl",N));if(!E)return!1;try{M=E.createShader(E.VERTEX_SHADER)}catch{return!1}return!(!M||E.isContextLost())&&(E.shaderSource(M,"void main() {}"),E.compileShader(M),!0===E.getShaderParameter(M,E.COMPILE_STATUS))}(p)),!wi[p]||document.documentMode));var u,p}var wi={};function mi(_,u,p){const x=g.window.document.createElement(_);return void 0!==u&&(x.className=u),p&&p.appendChild(x),x}function Ss(_,u,p){const x=g.window.document.createElementNS("http://www.w3.org/2000/svg",_);for(const M of Object.keys(u))x.setAttributeNS(null,M,u[M]);return p&&p.appendChild(x),x}Aa.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};const ro=g.window.document&&g.window.document.documentElement.style,Ja=ro&&void 0!==ro.userSelect?"userSelect":"WebkitUserSelect";let hh;function ph(){ro&&Ja&&(hh=ro[Ja],ro[Ja]="none")}function Il(){ro&&Ja&&(ro[Ja]=hh)}function Pc(_){_.preventDefault(),_.stopPropagation(),g.window.removeEventListener("click",Pc,!0)}function Ia(){g.window.addEventListener("click",Pc,!0),g.window.setTimeout(()=>{g.window.removeEventListener("click",Pc,!0)},0)}function Ht(_,u){const p=_.getBoundingClientRect();return Fp(_,p,u)}function Pa(_,u){const p=_.getBoundingClientRect(),x=[];for(let M=0;M<u.length;M++)x.push(Fp(_,p,u[M]));return x}function Kl(_){return void 0!==g.window.InstallTrigger&&2===_.button&&_.ctrlKey&&g.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:_.button}function Fp(_,u,p){const x=_.offsetWidth===u.width?1:_.offsetWidth/u.width;return new g.pointGeometry((p.clientX-u.left)*x,(p.clientY-u.top)*x)}function Si(_,u){var p=u[0],x=u[1],M=u[2],E=u[3],P=p*E-M*x;return P?(_[0]=E*(P=1/P),_[1]=-x*P,_[2]=-M*P,_[3]=p*P,_):null}function Es(_){const{userImage:u}=_;return!!(u&&u.render&&u.render())&&(_.data.replace(new Uint8Array(u.data.buffer)),!0)}class xu extends g.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new g.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(u){if(this.loaded!==u&&(this.loaded=u,u)){for(const{ids:p,callback:x}of this.requestors)this._notify(p,x);this.requestors=[]}}hasImage(u){return!!this.getImage(u)}getImage(u){return this.images[u]}addImage(u,p){this._validate(u,p)&&(this.images[u]=p)}_validate(u,p){let x=!0;return this._validateStretch(p.stretchX,p.data&&p.data.width)||(this.fire(new g.ErrorEvent(new Error(`Image "${u}" has invalid "stretchX" value`))),x=!1),this._validateStretch(p.stretchY,p.data&&p.data.height)||(this.fire(new g.ErrorEvent(new Error(`Image "${u}" has invalid "stretchY" value`))),x=!1),this._validateContent(p.content,p)||(this.fire(new g.ErrorEvent(new Error(`Image "${u}" has invalid "content" value`))),x=!1),x}_validateStretch(u,p){if(!u)return!0;let x=0;for(const M of u){if(M[0]<x||M[1]<M[0]||p<M[1])return!1;x=M[1]}return!0}_validateContent(u,p){return!(u&&(4!==u.length||u[0]<0||p.data.width<u[0]||u[1]<0||p.data.height<u[1]||u[2]<0||p.data.width<u[2]||u[3]<0||p.data.height<u[3]||u[2]<u[0]||u[3]<u[1]))}updateImage(u,p){p.version=this.images[u].version+1,this.images[u]=p,this.updatedImages[u]=!0}removeImage(u){const p=this.images[u];delete this.images[u],delete this.patterns[u],p.userImage&&p.userImage.onRemove&&p.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(u,p){let x=!0;if(!this.isLoaded())for(const M of u)this.images[M]||(x=!1);this.isLoaded()||x?this._notify(u,p):this.requestors.push({ids:u,callback:p})}_notify(u,p){const x={};for(const M of u){this.images[M]||this.fire(new g.Event("styleimagemissing",{id:M}));const E=this.images[M];E?x[M]={data:E.data.clone(),pixelRatio:E.pixelRatio,sdf:E.sdf,version:E.version,stretchX:E.stretchX,stretchY:E.stretchY,content:E.content,hasRenderCallback:Boolean(E.userImage&&E.userImage.render)}:g.warnOnce(`Image "${M}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}p(null,x)}getPixelSize(){const{width:u,height:p}=this.atlasImage;return{width:u,height:p}}getPattern(u){const p=this.patterns[u],x=this.getImage(u);if(!x)return null;if(p&&p.position.version===x.version)return p.position;if(p)p.position.version=x.version;else{const M={w:x.data.width+2,h:x.data.height+2,x:0,y:0},E=new g.ImagePosition(M,x);this.patterns[u]={bin:M,position:E}}return this._updatePatternAtlas(),this.patterns[u].position}bind(u){const p=u.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new g.Texture(u,this.atlasImage,p.RGBA),this.atlasTexture.bind(p.LINEAR,p.CLAMP_TO_EDGE)}_updatePatternAtlas(){const u=[];for(const E in this.patterns)u.push(this.patterns[E].bin);const{w:p,h:x}=g.potpack(u),M=this.atlasImage;M.resize({width:p||1,height:x||1});for(const E in this.patterns){const{bin:P}=this.patterns[E],O=P.x+1,N=P.y+1,U=this.images[E].data,H=U.width,Z=U.height;g.RGBAImage.copy(U,M,{x:0,y:0},{x:O,y:N},{width:H,height:Z}),g.RGBAImage.copy(U,M,{x:0,y:Z-1},{x:O,y:N-1},{width:H,height:1}),g.RGBAImage.copy(U,M,{x:0,y:0},{x:O,y:N+Z},{width:H,height:1}),g.RGBAImage.copy(U,M,{x:H-1,y:0},{x:O-1,y:N},{width:1,height:Z}),g.RGBAImage.copy(U,M,{x:0,y:0},{x:O+H,y:N},{width:1,height:Z})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(u){for(const p of u){if(this.callbackDispatchedThisFrame[p])continue;this.callbackDispatchedThisFrame[p]=!0;const x=this.images[p];Es(x)&&this.updateImage(p,x)}}}const bu=new g.Properties({anchor:new g.DataConstantProperty(g.spec.light.anchor),position:new class{constructor(){this.specification=g.spec.light.position}possiblyEvaluate(_,u){return function([p,x,M]){const E=g.degToRad(x+90),P=g.degToRad(M);return{x:p*Math.cos(E)*Math.sin(P),y:p*Math.sin(E)*Math.sin(P),z:p*Math.cos(P),azimuthal:x,polar:M}}(_.expression.evaluate(u))}interpolate(_,u,p){return{x:g.number(_.x,u.x,p),y:g.number(_.y,u.y,p),z:g.number(_.z,u.z,p),azimuthal:g.number(_.azimuthal,u.azimuthal,p),polar:g.number(_.polar,u.polar,p)}}},color:new g.DataConstantProperty(g.spec.light.color),intensity:new g.DataConstantProperty(g.spec.light.intensity)}),fh="-transition";class wu extends g.Evented{constructor(u){super(),this._transitionable=new g.Transitionable(bu),this.setLight(u),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(u,p={}){if(!this._validate(g.validateLight,u,p))for(const x in u){const M=u[x];g.endsWith(x,fh)?this._transitionable.setTransition(x.slice(0,-fh.length),M):this._transitionable.setValue(x,M)}}updateTransitions(u){this._transitioning=this._transitionable.transitioned(u,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(u){this.properties=this._transitioning.possiblyEvaluate(u)}_validate(u,p,x){return(!x||!1!==x.validate)&&g.emitValidationErrors(this,u.call(g.validateStyle,g.extend({value:p,style:{glyphs:!0,sprite:!0},styleSpec:g.spec})))}}const Ei=new g.Properties({source:new g.DataConstantProperty(g.spec.terrain.source),exaggeration:new g.DataConstantProperty(g.spec.terrain.exaggeration)}),Mu="-transition";class Wo extends g.Evented{constructor(u,p){super(),this._transitionable=new g.Transitionable(Ei),this.set(u),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=p}get(){return this._transitionable.serialize()}set(u){for(const p in u){const x=u[p];g.endsWith(p,Mu)?this._transitionable.setTransition(p.slice(0,-Mu.length),x):this._transitionable.setValue(p,x)}}updateTransitions(u){this._transitioning=this._transitionable.transitioned(u,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(u){this.properties=this._transitioning.possiblyEvaluate(u)}}function Rc(_,u,p,x){const M=g.smoothstep(45,65,p),[E,P]=kc(_,x),O=g.length(u);let N=1-Math.min(1,Math.exp((O-E)/(P-E)*-6));return N*=N*N,N=Math.min(1,1.00747*N),N*M*_.alpha}function kc(_,u){const p=.5/Math.tan(.5*u);return[_.range[0]+p,_.range[1]+p]}const ci=new g.Properties({range:new g.DataConstantProperty(g.spec.fog.range),color:new g.DataConstantProperty(g.spec.fog.color),"high-color":new g.DataConstantProperty(g.spec.fog["high-color"]),"space-color":new g.DataConstantProperty(g.spec.fog["space-color"]),"horizon-blend":new g.DataConstantProperty(g.spec.fog["horizon-blend"]),"star-intensity":new g.DataConstantProperty(g.spec.fog["star-intensity"])}),Cu="-transition";class mh extends g.Evented{constructor(u,p){super(),this._transitionable=new g.Transitionable(ci),this.set(u),this._transitioning=this._transitionable.untransitioned(),this._transform=p}get state(){const u=this._transform,p="globe"===u.projection.name,x=g.globeToMercatorTransition(u.zoom),M=this.properties.get("range"),E=[.5,3];return{range:p?[g.number(E[0],M[0],x),g.number(E[1],M[1],x)]:M,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(u,p={}){if(!this._validate(g.validateFog,u,p)){for(const x of Object.keys(g.spec.fog))u&&void 0===u[x]&&(u[x]=g.spec.fog[x].default);for(const x in u){const M=u[x];g.endsWith(x,Cu)?this._transitionable.setTransition(x.slice(0,-Cu.length),M):this._transitionable.setValue(x,M)}}}getOpacity(u){if(!this._transform.projection.supportsFog)return 0;const p=this.properties&&this.properties.get("color")||1;return("globe"===this._transform.projection.name?1:g.smoothstep(45,65,u))*p.a}getOpacityAtLatLng(u,p){return this._transform.projection.supportsFog?function(x,M,E){const P=g.MercatorCoordinate.fromLngLat(M),O=E.elevation?E.elevation.getAtPointOrZero(P):0,N=[P.x,P.y,O];return g.transformMat4(N,N,E.mercatorFogMatrix),Rc(x,N,E.pitch,E._fov)}(this.state,u,p):0}getFovAdjustedRange(u){return this._transform.projection.supportsFog?kc(this.state,u):[0,1]}updateTransitions(u){this._transitioning=this._transitionable.transitioned(u,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(u){this.properties=this._transitioning.possiblyEvaluate(u)}_validate(u,p,x){return(!x||!1!==x.validate)&&g.emitValidationErrors(this,u.call(g.validateStyle,g.extend({value:p,style:{glyphs:!0,sprite:!0},styleSpec:g.spec})))}}class Ql{constructor(u,p){this.workerPool=u,this.actors=[],this.currentActor=0,this.id=g.uniqueId();const x=this.workerPool.acquire(this.id);for(let M=0;M<x.length;M++){const E=new Ql.Actor(x[M],p,this.id);E.name=`Worker ${M}`,this.actors.push(E)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(u,p,x){g.asyncAll(this.actors,(M,E)=>{M.send(u,p,E)},x=x||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(u=>{u.remove()}),this.actors=[],this.workerPool.release(this.id)}}function Pl(_,u,p){return u*(g.EXTENT/(_.tileSize*Math.pow(2,p-_.tileID.overscaledZ)))}Ql.Actor=g.Actor;class si{constructor(u,p,x,M){this.screenBounds=u,this.cameraPoint=p,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=x,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,M)}static createFromScreenPoints(u,p){let x,M;if(u instanceof g.pointGeometry||"number"==typeof u[0]){const E=g.pointGeometry.convert(u);x=[E],M=p.isPointAboveHorizon(E)}else{const E=g.pointGeometry.convert(u[0]),P=g.pointGeometry.convert(u[1]);x=[E,P],M=g.polygonizeBounds(E,P).every(O=>p.isPointAboveHorizon(O))}return new si(x,p.getCameraPoint(),M,p)}isPointQuery(){return 1===this.screenBounds.length}bufferedScreenGeometry(u){return g.polygonizeBounds(this.screenBounds[0],1===this.screenBounds.length?this.screenBounds[0]:this.screenBounds[1],u)}bufferedCameraGeometry(u){const p=this.screenBounds[0],x=1===this.screenBounds.length?this.screenBounds[0].add(new g.pointGeometry(1,1)):this.screenBounds[1],M=g.polygonizeBounds(p,x,0,!1);return this.cameraPoint.y>x.y&&(this.cameraPoint.x>p.x&&this.cameraPoint.x<x.x?M.splice(3,0,this.cameraPoint):this.cameraPoint.x>=x.x?M[2]=this.cameraPoint:this.cameraPoint.x<=p.x&&(M[3]=this.cameraPoint)),g.bufferConvexPolygon(M,u)}bufferedCameraGeometryGlobe(u){const p=this.screenBounds[0],x=1===this.screenBounds.length?this.screenBounds[0].add(new g.pointGeometry(1,1)):this.screenBounds[1],M=g.polygonizeBounds(p,x,u),E=this.cameraPoint.clone();switch(3*((E.y>p.y)+(E.y>x.y))+((E.x>p.x)+(E.x>x.x))){case 0:M[0]=E,M[4]=E.clone();break;case 1:M.splice(1,0,E);break;case 2:M[1]=E;break;case 3:M.splice(4,0,E);break;case 5:M.splice(2,0,E);break;case 6:M[3]=E;break;case 7:M.splice(3,0,E);break;case 8:M[2]=E}return M}containsTile(u,p,x,M=0){const E=u.queryPadding/p._pixelsPerMercatorPixel+1,P=x?this._bufferedCameraMercator(E,p):this._bufferedScreenMercator(E,p);let O=u.tileID.wrap+(P.unwrapped?M:0);const N=P.polygon.map(re=>g.getTilePoint(u.tileTransform,re,O));if(!g.polygonIntersectsBox(N,0,0,g.EXTENT,g.EXTENT))return;O=u.tileID.wrap+(this.screenGeometryMercator.unwrapped?M:0);const U=this.screenGeometryMercator.polygon.map(re=>g.getTileVec3(u.tileTransform,re,O)),H=U.map(re=>new g.pointGeometry(re[0],re[1])),Z=p.getFreeCameraOptions().position||new g.MercatorCoordinate(0,0,0),Q=g.getTileVec3(u.tileTransform,Z,O),oe=U.map(re=>{const ne=g.sub(re,re,Q);return g.normalize(ne,ne),new g.Ray(Q,ne)}),ie=Pl(u,1,p.zoom)*p._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:H,tilespaceRays:oe,bufferedTilespaceGeometry:N,bufferedTilespaceBounds:(le=g.getBounds(N),le.min.x=g.clamp(le.min.x,0,g.EXTENT),le.min.y=g.clamp(le.min.y,0,g.EXTENT),le.max.x=g.clamp(le.max.x,0,g.EXTENT),le.max.y=g.clamp(le.max.y,0,g.EXTENT),le),tile:u,tileID:u.tileID,pixelToTileUnitsFactor:ie};var le}_bufferedScreenMercator(u,p){const x=Dr(u);if(this._screenRaycastCache[x])return this._screenRaycastCache[x];{let M;return M="globe"===p.projection.name?this._projectAndResample(this.bufferedScreenGeometry(u),p):{polygon:this.bufferedScreenGeometry(u).map(E=>p.pointCoordinate3D(E)),unwrapped:!0},this._screenRaycastCache[x]=M,M}}_bufferedCameraMercator(u,p){const x=Dr(u);if(this._cameraRaycastCache[x])return this._cameraRaycastCache[x];{let M;return M="globe"===p.projection.name?this._projectAndResample(this.bufferedCameraGeometryGlobe(u),p):{polygon:this.bufferedCameraGeometry(u).map(E=>p.pointCoordinate3D(E)),unwrapped:!0},this._cameraRaycastCache[x]=M,M}}_projectAndResample(u,p){const x=function(E,P){const O=g.multiply([],P.pixelMatrix,P.globeMatrix),N=[0,-g.GLOBE_RADIUS,0,1],U=[0,g.GLOBE_RADIUS,0,1],H=[0,0,0,1];g.transformMat4$1(N,N,O),g.transformMat4$1(U,U,O),g.transformMat4$1(H,H,O);const Z=new g.pointGeometry(N[0]/N[3],N[1]/N[3]),Q=new g.pointGeometry(U[0]/U[3],U[1]/U[3]),oe=g.polygonContainsPoint(E,Z)&&N[3]<H[3],ie=g.polygonContainsPoint(E,Q)&&U[3]<H[3];if(!oe&&!ie)return null;const le=function(De,Ue,Ke){for(let je=1;je<De.length;je++){const St=ca(Ue.pointCoordinate3D(De[je-1]).x),Ne=ca(Ue.pointCoordinate3D(De[je]).x);if(Ke<0){if(St<Ne)return{idx:je,t:-St/(Ne-1-St)}}else if(Ne<St)return{idx:je,t:(1-St)/(Ne+1-St)}}return null}(E,P,oe?-1:1);if(!le)return null;const{idx:re,t:ne}=le;let ue=re>1?Lc(E.slice(0,re),P):[],se=re<E.length?Lc(E.slice(re),P):[];ue=ue.map(De=>new g.pointGeometry(ca(De.x),De.y)),se=se.map(De=>new g.pointGeometry(ca(De.x),De.y));const Me=[...ue];0===Me.length&&Me.push(se[se.length-1]);const Se=g.number(Me[Me.length-1].y,(0===se.length?ue[0]:se[0]).y,ne);let ge;return ge=oe?[new g.pointGeometry(0,Se),new g.pointGeometry(0,0),new g.pointGeometry(1,0),new g.pointGeometry(1,Se)]:[new g.pointGeometry(1,Se),new g.pointGeometry(1,1),new g.pointGeometry(0,1),new g.pointGeometry(0,Se)],Me.push(...ge),0===se.length?Me.push(ue[0]):Me.push(...se),{polygon:Me.map(De=>new g.MercatorCoordinate(De.x,De.y)),unwrapped:!1}}(u,p);if(x)return x;const M=function(E,P){let O=!1,N=-1/0,U=0;for(let Z=0;Z<E.length-1;Z++)E[Z].x>N&&(N=E[Z].x,U=Z);for(let Z=0;Z<E.length-1;Z++){const Q=(U+Z)%(E.length-1),oe=E[Q],ie=E[Q+1];Math.abs(oe.x-ie.x)>.5&&(oe.x<ie.x?(oe.x+=1,0===Q&&(E[E.length-1].x+=1)):(ie.x+=1,Q+1===E.length-1&&(E[0].x+=1)),O=!0)}const H=g.mercatorXfromLng(P.center.lng);return O&&H<Math.abs(H-1)&&E.forEach(Z=>{Z.x-=1}),{polygon:E,unwrapped:O}}(Lc(u,p).map(E=>new g.pointGeometry(ca(E.x),E.y)),p);return{polygon:M.polygon.map(E=>new g.MercatorCoordinate(E.x,E.y)),unwrapped:M.unwrapped}}}function Lc(_,u){return g.resample(_,p=>{const x=u.pointCoordinate3D(p);p.x=x.x,p.y=x.y},1/256)}function ca(_){return _<0?1+_%1:_%1}function Dr(_){return 100*_|0}function Pr(_,u,p,x,M){const E=function(P,O){if(P)return M(P);if(O){_.url&&O.tiles&&_.tiles&&delete _.tiles;const N=g.pick(g.extend(O,_),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);O.vector_layers&&(N.vectorLayers=O.vector_layers,N.vectorLayerIds=N.vectorLayers.map(U=>U.id)),N.tiles=u.canonicalizeTileset(N,_.url),M(null,N)}};return _.url?g.getJSON(u.transformRequest(u.normalizeSourceURL(_.url,null,p,x),g.ResourceType.Source),E):g.exported.frame(()=>E(null,_))}class ua{constructor(u,p,x){this.bounds=g.LngLatBounds.convert(this.validateBounds(u)),this.minzoom=p||0,this.maxzoom=x||24}validateBounds(u){return Array.isArray(u)&&4===u.length?[Math.max(-180,u[0]),Math.max(-90,u[1]),Math.min(180,u[2]),Math.min(90,u[3])]:[-180,-90,180,90]}contains(u){const p=Math.pow(2,u.z),x=Math.floor(g.mercatorXfromLng(this.bounds.getWest())*p),M=Math.floor(g.mercatorYfromLat(this.bounds.getNorth())*p),E=Math.ceil(g.mercatorXfromLng(this.bounds.getEast())*p),P=Math.ceil(g.mercatorYfromLat(this.bounds.getSouth())*p);return u.x>=x&&u.x<E&&u.y>=M&&u.y<P}}class ei{constructor(u,p,x){this.context=u;const M=u.gl;this.buffer=M.createBuffer(),this.dynamicDraw=Boolean(x),this.context.unbindVAO(),u.bindElementBuffer.set(this.buffer),M.bufferData(M.ELEMENT_ARRAY_BUFFER,p.arrayBuffer,this.dynamicDraw?M.DYNAMIC_DRAW:M.STATIC_DRAW),this.dynamicDraw||p.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(u){const p=this.context.gl;this.context.unbindVAO(),this.bind(),p.bufferSubData(p.ELEMENT_ARRAY_BUFFER,0,u.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Vr={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Rl{constructor(u,p,x,M){this.length=p.length,this.attributes=x,this.itemSize=p.bytesPerElement,this.dynamicDraw=M,this.context=u;const E=u.gl;this.buffer=E.createBuffer(),u.bindVertexBuffer.set(this.buffer),E.bufferData(E.ARRAY_BUFFER,p.arrayBuffer,this.dynamicDraw?E.DYNAMIC_DRAW:E.STATIC_DRAW),this.dynamicDraw||p.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(u){const p=this.context.gl;this.bind(),p.bufferSubData(p.ARRAY_BUFFER,0,u.arrayBuffer)}enableAttributes(u,p){for(let x=0;x<this.attributes.length;x++){const M=p.attributes[this.attributes[x].name];void 0!==M&&u.enableVertexAttribArray(M)}}setVertexAttribPointers(u,p,x){for(let M=0;M<this.attributes.length;M++){const E=this.attributes[M],P=p.attributes[E.name];void 0!==P&&u.vertexAttribPointer(P,E.components,u[Vr[E.type]],!1,this.itemSize,E.offset+this.itemSize*(x||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Ri{constructor(u){this.gl=u.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(u){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class kl extends Ri{getDefault(){return g.Color.transparent}set(u){const p=this.current;(u.r!==p.r||u.g!==p.g||u.b!==p.b||u.a!==p.a||this.dirty)&&(this.gl.clearColor(u.r,u.g,u.b,u.a),this.current=u,this.dirty=!1)}}class Np extends Ri{getDefault(){return 1}set(u){(u!==this.current||this.dirty)&&(this.gl.clearDepth(u),this.current=u,this.dirty=!1)}}class Oc extends Ri{getDefault(){return 0}set(u){(u!==this.current||this.dirty)&&(this.gl.clearStencil(u),this.current=u,this.dirty=!1)}}class gh extends Ri{getDefault(){return[!0,!0,!0,!0]}set(u){const p=this.current;(u[0]!==p[0]||u[1]!==p[1]||u[2]!==p[2]||u[3]!==p[3]||this.dirty)&&(this.gl.colorMask(u[0],u[1],u[2],u[3]),this.current=u,this.dirty=!1)}}class _h extends Ri{getDefault(){return!0}set(u){(u!==this.current||this.dirty)&&(this.gl.depthMask(u),this.current=u,this.dirty=!1)}}class Su extends Ri{getDefault(){return 255}set(u){(u!==this.current||this.dirty)&&(this.gl.stencilMask(u),this.current=u,this.dirty=!1)}}class yh extends Ri{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(u){const p=this.current;(u.func!==p.func||u.ref!==p.ref||u.mask!==p.mask||this.dirty)&&(this.gl.stencilFunc(u.func,u.ref,u.mask),this.current=u,this.dirty=!1)}}class qo extends Ri{getDefault(){const u=this.gl;return[u.KEEP,u.KEEP,u.KEEP]}set(u){const p=this.current;(u[0]!==p[0]||u[1]!==p[1]||u[2]!==p[2]||this.dirty)&&(this.gl.stencilOp(u[0],u[1],u[2]),this.current=u,this.dirty=!1)}}class Jl extends Ri{getDefault(){return!1}set(u){if(u===this.current&&!this.dirty)return;const p=this.gl;u?p.enable(p.STENCIL_TEST):p.disable(p.STENCIL_TEST),this.current=u,this.dirty=!1}}class xd extends Ri{getDefault(){return[0,1]}set(u){const p=this.current;(u[0]!==p[0]||u[1]!==p[1]||this.dirty)&&(this.gl.depthRange(u[0],u[1]),this.current=u,this.dirty=!1)}}class Bp extends Ri{getDefault(){return!1}set(u){if(u===this.current&&!this.dirty)return;const p=this.gl;u?p.enable(p.DEPTH_TEST):p.disable(p.DEPTH_TEST),this.current=u,this.dirty=!1}}class vh extends Ri{getDefault(){return this.gl.LESS}set(u){(u!==this.current||this.dirty)&&(this.gl.depthFunc(u),this.current=u,this.dirty=!1)}}class Eu extends Ri{getDefault(){return!1}set(u){if(u===this.current&&!this.dirty)return;const p=this.gl;u?p.enable(p.BLEND):p.disable(p.BLEND),this.current=u,this.dirty=!1}}class el extends Ri{getDefault(){const u=this.gl;return[u.ONE,u.ZERO]}set(u){const p=this.current;(u[0]!==p[0]||u[1]!==p[1]||this.dirty)&&(this.gl.blendFunc(u[0],u[1]),this.current=u,this.dirty=!1)}}class bd extends Ri{getDefault(){return g.Color.transparent}set(u){const p=this.current;(u.r!==p.r||u.g!==p.g||u.b!==p.b||u.a!==p.a||this.dirty)&&(this.gl.blendColor(u.r,u.g,u.b,u.a),this.current=u,this.dirty=!1)}}class Ra extends Ri{getDefault(){return this.gl.FUNC_ADD}set(u){(u!==this.current||this.dirty)&&(this.gl.blendEquation(u),this.current=u,this.dirty=!1)}}class xh extends Ri{getDefault(){return!1}set(u){if(u===this.current&&!this.dirty)return;const p=this.gl;u?p.enable(p.CULL_FACE):p.disable(p.CULL_FACE),this.current=u,this.dirty=!1}}class bh extends Ri{getDefault(){return this.gl.BACK}set(u){(u!==this.current||this.dirty)&&(this.gl.cullFace(u),this.current=u,this.dirty=!1)}}class Fc extends Ri{getDefault(){return this.gl.CCW}set(u){(u!==this.current||this.dirty)&&(this.gl.frontFace(u),this.current=u,this.dirty=!1)}}class Tu extends Ri{getDefault(){return null}set(u){(u!==this.current||this.dirty)&&(this.gl.useProgram(u),this.current=u,this.dirty=!1)}}class zp extends Ri{getDefault(){return this.gl.TEXTURE0}set(u){(u!==this.current||this.dirty)&&(this.gl.activeTexture(u),this.current=u,this.dirty=!1)}}class Mm extends Ri{getDefault(){const u=this.gl;return[0,0,u.drawingBufferWidth,u.drawingBufferHeight]}set(u){const p=this.current;(u[0]!==p[0]||u[1]!==p[1]||u[2]!==p[2]||u[3]!==p[3]||this.dirty)&&(this.gl.viewport(u[0],u[1],u[2],u[3]),this.current=u,this.dirty=!1)}}class wh extends Ri{getDefault(){return null}set(u){if(u===this.current&&!this.dirty)return;const p=this.gl;p.bindFramebuffer(p.FRAMEBUFFER,u),this.current=u,this.dirty=!1}}class Du extends Ri{getDefault(){return null}set(u){if(u===this.current&&!this.dirty)return;const p=this.gl;p.bindRenderbuffer(p.RENDERBUFFER,u),this.current=u,this.dirty=!1}}class Nc extends Ri{getDefault(){return null}set(u){if(u===this.current&&!this.dirty)return;const p=this.gl;p.bindTexture(p.TEXTURE_2D,u),this.current=u,this.dirty=!1}}class Au extends Ri{getDefault(){return null}set(u){if(u===this.current&&!this.dirty)return;const p=this.gl;p.bindBuffer(p.ARRAY_BUFFER,u),this.current=u,this.dirty=!1}}class ka extends Ri{getDefault(){return null}set(u){const p=this.gl;p.bindBuffer(p.ELEMENT_ARRAY_BUFFER,u),this.current=u,this.dirty=!1}}class Iu extends Ri{constructor(u){super(u),this.vao=u.extVertexArrayObject}getDefault(){return null}set(u){this.vao&&(u!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(u),this.current=u,this.dirty=!1)}}class Mh extends Ri{getDefault(){return 4}set(u){if(u===this.current&&!this.dirty)return;const p=this.gl;p.pixelStorei(p.UNPACK_ALIGNMENT,u),this.current=u,this.dirty=!1}}class wd extends Ri{getDefault(){return!1}set(u){if(u===this.current&&!this.dirty)return;const p=this.gl;p.pixelStorei(p.UNPACK_PREMULTIPLY_ALPHA_WEBGL,u),this.current=u,this.dirty=!1}}class Pu extends Ri{getDefault(){return!1}set(u){if(u===this.current&&!this.dirty)return;const p=this.gl;p.pixelStorei(p.UNPACK_FLIP_Y_WEBGL,u),this.current=u,this.dirty=!1}}class Io extends Ri{constructor(u,p){super(u),this.context=u,this.parent=p}getDefault(){return null}}class Bc extends Io{setDirty(){this.dirty=!0}set(u){if(u===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const p=this.gl;p.framebufferTexture2D(p.FRAMEBUFFER,p.COLOR_ATTACHMENT0,p.TEXTURE_2D,u,0),this.current=u,this.dirty=!1}}class Md extends Io{attachment(){return this.gl.DEPTH_ATTACHMENT}set(u){if(u===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const p=this.gl;p.framebufferRenderbuffer(p.FRAMEBUFFER,this.attachment(),p.RENDERBUFFER,u),this.current=u,this.dirty=!1}}class ws extends Md{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class he{constructor(u,p,x,M){this.context=u,this.width=p,this.height=x;const E=this.framebuffer=u.gl.createFramebuffer();this.colorAttachment=new Bc(u,E),M&&(this.depthAttachment=new Md(u,E))}destroy(){const u=this.context.gl,p=this.colorAttachment.get();if(p&&u.deleteTexture(p),this.depthAttachment){const x=this.depthAttachment.get();x&&u.deleteRenderbuffer(x)}u.deleteFramebuffer(this.framebuffer)}}class q{constructor(u){this.gl=u,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new kl(this),this.clearDepth=new Np(this),this.clearStencil=new Oc(this),this.colorMask=new gh(this),this.depthMask=new _h(this),this.stencilMask=new Su(this),this.stencilFunc=new yh(this),this.stencilOp=new qo(this),this.stencilTest=new Jl(this),this.depthRange=new xd(this),this.depthTest=new Bp(this),this.depthFunc=new vh(this),this.blend=new Eu(this),this.blendFunc=new el(this),this.blendColor=new bd(this),this.blendEquation=new Ra(this),this.cullFace=new xh(this),this.cullFaceSide=new bh(this),this.frontFace=new Fc(this),this.program=new Tu(this),this.activeTexture=new zp(this),this.viewport=new Mm(this),this.bindFramebuffer=new wh(this),this.bindRenderbuffer=new Du(this),this.bindTexture=new Nc(this),this.bindVertexBuffer=new Au(this),this.bindElementBuffer=new ka(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new Iu(this),this.pixelStoreUnpack=new Mh(this),this.pixelStoreUnpackPremultiplyAlpha=new wd(this),this.pixelStoreUnpackFlipY=new Pu(this),this.extTextureFilterAnisotropic=u.getExtension("EXT_texture_filter_anisotropic")||u.getExtension("MOZ_EXT_texture_filter_anisotropic")||u.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=u.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureFilterAnisotropicForceOff=!1,this.extStandardDerivativesForceOff=!1,this.extDebugRendererInfo=u.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=u.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=u.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),this.extTextureHalfFloat=u.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(u.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=u.getExtension("EXT_color_buffer_half_float")),this.extStandardDerivatives=u.getExtension("OES_standard_derivatives"),this.extTimerQuery=u.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=u.getParameter(u.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(u,p){return new ei(this,u,p)}createVertexBuffer(u,p,x){return new Rl(this,u,p,x)}createRenderbuffer(u,p,x){const M=this.gl,E=M.createRenderbuffer();return this.bindRenderbuffer.set(E),M.renderbufferStorage(M.RENDERBUFFER,u,p,x),this.bindRenderbuffer.set(null),E}createFramebuffer(u,p,x){return new he(this,u,p,x)}clear({color:u,depth:p,stencil:x}){const M=this.gl;let E=0;u&&(E|=M.COLOR_BUFFER_BIT,this.clearColor.set(u),this.colorMask.set([!0,!0,!0,!0])),void 0!==p&&(E|=M.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(p),this.depthMask.set(!0)),void 0!==x&&(E|=M.STENCIL_BUFFER_BIT,this.clearStencil.set(x),this.stencilMask.set(255)),M.clear(E)}setCullFace(u){!1===u.enable?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(u.mode),this.frontFace.set(u.frontFace))}setDepthMode(u){u.func!==this.gl.ALWAYS||u.mask?(this.depthTest.set(!0),this.depthFunc.set(u.func),this.depthMask.set(u.mask),this.depthRange.set(u.range)):this.depthTest.set(!1)}setStencilMode(u){u.test.func!==this.gl.ALWAYS||u.mask?(this.stencilTest.set(!0),this.stencilMask.set(u.mask),this.stencilOp.set([u.fail,u.depthFail,u.pass]),this.stencilFunc.set({func:u.test.func,ref:u.ref,mask:u.test.mask})):this.stencilTest.set(!1)}setColorMode(u){lt(u.blendFunction,g.ColorMode.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(u.blendFunction),this.blendColor.set(u.blendColor)),this.colorMask.set(u.mask)}unbindVAO(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)}}class K extends g.Evented{constructor(u,p,x,M){super(),this.id=u,this.dispatcher=x,this.setEventedParent(M),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=g.extend({type:"raster"},p),g.extend(this,g.pick(p,["url","scheme","tileSize"]))}load(){this._loaded=!1,this.fire(new g.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=Pr(this._options,this.map._requestManager,null,null,(u,p)=>{this._tileJSONRequest=null,this._loaded=!0,u?this.fire(new g.ErrorEvent(u)):p&&(g.extend(this,p),p.bounds&&(this.tileBounds=new ua(p.bounds,this.minzoom,this.maxzoom)),g.postTurnstileEvent(p.tiles),this.fire(new g.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new g.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}onAdd(u){this.map=u,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return g.extend({},this._options)}hasTile(u){return!this.tileBounds||this.tileBounds.contains(u.canonical)}loadTile(u,p){const x=g.exported.devicePixelRatio>=2,M=this.map._requestManager.normalizeTileURL(u.tileID.canonical.url(this.tiles,this.scheme),x,this.tileSize);u.request=g.getImage(this.map._requestManager.transformRequest(M,g.ResourceType.Tile),(E,P,O,N)=>(delete u.request,u.aborted?(u.state="unloaded",p(null)):E?(u.state="errored",p(E)):P?(this.map._refreshExpiredTiles&&u.setExpiryData({cacheControl:O,expires:N}),u.setTexture(P,this.map.painter),u.state="loaded",g.cacheEntryPossiblyAdded(this.dispatcher),void p(null)):p(null)))}static loadTileData(u,p,x){u.setTexture(p,x)}static unloadTileData(u,p){u.texture&&p.saveTileTexture(u.texture)}abortTile(u,p){u.request&&(u.request.cancel(),delete u.request),p()}unloadTile(u,p){u.texture&&this.map.painter.saveTileTexture(u.texture),p()}hasTransition(){return!1}}let ce;function ye(_,u,p,x,M,E,P,O){const N=[_,p,M,u,x,E,1,1,1],U=[P,O,1],H=g.adjoint([],N),[Z,Q,oe]=g.transformMat3(U,U,g.transpose(H,H));return g.multiply$1(N,[Z,0,0,0,Q,0,0,0,oe],N)}class Re extends g.Evented{constructor(u,p,x,M){super(),this.id=u,this.dispatcher=x,this.coordinates=p.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(M),this.options=p,this._dirty=!1}load(u,p){this._loaded=p||!1,this.fire(new g.Event("dataloading",{dataType:"source"})),this.url=this.options.url,this._imageRequest=g.getImage(this.map._requestManager.transformRequest(this.url,g.ResourceType.Image),(x,M)=>{if(this._imageRequest=null,this._loaded=!0,x)this.fire(new g.ErrorEvent(x));else if(M){const{HTMLImageElement:E}=g.window;this.image=M instanceof E?g.exported.getImageData(M):M,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,u&&(this.coordinates=u),this._finishLoading()}})}loaded(){return this._loaded}updateImage(u){return this.image&&u.url?(this._imageRequest&&u.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=u.url,this.load(u.coordinates,this._loaded),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new g.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(u){this.map=u,this.load()}onRemove(){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),this.texture&&this.texture.destroy()}setCoordinates(u){this.coordinates=u,this._boundsArray=void 0;const p=u.map(g.MercatorCoordinate.fromLngLat);return this.tileID=function(x){let M=1/0,E=1/0,P=-1/0,O=-1/0;for(const Z of x)M=Math.min(M,Z.x),E=Math.min(E,Z.y),P=Math.max(P,Z.x),O=Math.max(O,Z.y);const N=Math.max(P-M,O-E),U=Math.max(0,Math.floor(-Math.log(N)/Math.LN2)),H=Math.pow(2,U);return new g.CanonicalTileID(U,Math.floor((M+P)/2*H),Math.floor((E+O)/2*H))}(p),this.minzoom=this.maxzoom=this.tileID.z,this.fire(new g.Event("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0}_prepareData(u){for(const N in this.tiles){const U=this.tiles[N];"loaded"!==U.state&&(U.state="loaded",U.texture=this.texture)}if(this._boundsArray)return;const p=g.tileTransform(this.tileID,this.map.transform.projection),[x,M,E,P]=this.coordinates.map(N=>{const U=p.projection.project(N[0],N[1]);return g.getTilePoint(p,U)._round()});this.perspectiveTransform=function(N,U,H,Z,Q,oe,ie,le,re,ne){const ue=ye(0,0,N,0,0,U,N,U),se=ye(H,Z,Q,oe,ie,le,re,ne);return g.multiply$1(se,g.adjoint(ue,ue),se),[se[6]/se[8]*N/g.EXTENT,se[7]/se[8]*U/g.EXTENT]}(this.width,this.height,x.x,x.y,M.x,M.y,P.x,P.y,E.x,E.y);const O=this._boundsArray=new g.StructArrayLayout4i8;O.emplaceBack(x.x,x.y,0,0),O.emplaceBack(M.x,M.y,g.EXTENT,0),O.emplaceBack(P.x,P.y,0,g.EXTENT),O.emplaceBack(E.x,E.y,g.EXTENT,g.EXTENT),this.boundsBuffer&&this.boundsBuffer.destroy(),this.boundsBuffer=u.createVertexBuffer(O,g.boundsAttributes.members),this.boundsSegments=g.SegmentVector.simpleSegment(0,0,4,2)}prepare(){if(0===Object.keys(this.tiles).length||!this.image)return;const u=this.map.painter.context,p=u.gl;this._dirty&&(this.texture?this.texture.update(this.image):(this.texture=new g.Texture(u,this.image,p.RGBA),this.texture.bind(p.LINEAR,p.CLAMP_TO_EDGE)),this._dirty=!1),this._prepareData(u)}loadTile(u,p){this.tileID&&this.tileID.equals(u.tileID.canonical)?(this.tiles[String(u.tileID.wrap)]=u,u.buckets={},p(null)):(u.state="errored",p(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}const Ve={vector:class extends g.Evented{constructor(_,u,p,x){if(super(),this.id=_,this.dispatcher=p,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,g.extend(this,g.pick(u,["url","scheme","tileSize","promoteId"])),this._options=g.extend({type:"vector"},u),this._collectResourceTiming=u.collectResourceTiming,512!==this.tileSize)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(x),this._tileWorkers={},this._deduped=new g.DedupedRequest}load(_){this._loaded=!1,this.fire(new g.Event("dataloading",{dataType:"source"}));const u=Array.isArray(this.map._language)?this.map._language.join():this.map._language,p=this.map._worldview;this._tileJSONRequest=Pr(this._options,this.map._requestManager,u,p,(x,M)=>{this._tileJSONRequest=null,this._loaded=!0,x?(u&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${u}`),p&&2!==p.length&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${p}`),this.fire(new g.ErrorEvent(x))):M&&(g.extend(this,M),M.bounds&&(this.tileBounds=new ua(M.bounds,this.minzoom,this.maxzoom)),g.postTurnstileEvent(M.tiles,this.map._requestManager._customAccessToken),this.fire(new g.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new g.Event("data",{dataType:"source",sourceDataType:"content"}))),_&&_(x)})}loaded(){return this._loaded}hasTile(_){return!this.tileBounds||this.tileBounds.contains(_.canonical)}onAdd(_){this.map=_,this.load()}reload(){this.cancelTileJSONRequest(),this.load(()=>{const _=this.map.style._getSourceCaches(this.id);for(const u of _)u.clearTiles()})}setSourceProperty(_){_(),this.reload()}setTiles(_){return this._options.tiles=_,this.reload(),this}setUrl(_){return this.url=_,this._options.url=_,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return g.extend({},this._options)}loadTile(_,u){const p=this.map._requestManager.normalizeTileURL(_.tileID.canonical.url(this.tiles,this.scheme)),x={request:this.map._requestManager.transformRequest(p,g.ResourceType.Tile),data:void 0,uid:_.uid,tileID:_.tileID,tileZoom:_.tileZoom,zoom:_.tileID.overscaledZ,tileSize:this.tileSize*_.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:g.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:_.isSymbolTile};if(x.request.collectResourceTiming=this._collectResourceTiming,_.actor&&"expired"!==_.state)"loading"===_.state?_.reloadCallback=u:_.request=_.actor.send("reloadTile",x,M.bind(this));else if(_.actor=this._tileWorkers[p]=this._tileWorkers[p]||this.dispatcher.getActor(),this.dispatcher.ready)_.request=_.actor.send("loadTile",x,M.bind(this),void 0,!0);else{const E=g.loadVectorTile.call({deduped:this._deduped},x,(P,O)=>{P||!O?M.call(this,P):(x.data={cacheControl:O.cacheControl,expires:O.expires,rawData:O.rawData.slice(0)},_.actor&&_.actor.send("loadTile",x,M.bind(this),void 0,!0))},!0);_.request={cancel:E}}function M(E,P){return delete _.request,_.aborted?u(null):E&&404!==E.status?u(E):(P&&P.resourceTiming&&(_.resourceTiming=P.resourceTiming),this.map._refreshExpiredTiles&&P&&_.setExpiryData(P),_.loadVectorData(P,this.map.painter),g.cacheEntryPossiblyAdded(this.dispatcher),u(null),void(_.reloadCallback&&(this.loadTile(_,_.reloadCallback),_.reloadCallback=null)))}}abortTile(_){_.request&&(_.request.cancel(),delete _.request),_.actor&&_.actor.send("abortTile",{uid:_.uid,type:this.type,source:this.id})}unloadTile(_){_.unloadVectorData(),_.actor&&_.actor.send("removeTile",{uid:_.uid,type:this.type,source:this.id})}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}},raster:K,"raster-dem":class extends K{constructor(_,u,p,x){super(_,u,p,x),this.type="raster-dem",this.maxzoom=22,this._options=g.extend({type:"raster-dem"},u),this.encoding=u.encoding||"mapbox"}loadTile(_,u){const p=this.map._requestManager.normalizeTileURL(_.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function x(M,E){M&&(_.state="errored",u(M)),E&&(_.dem=E,_.dem.onDeserialize(),_.needsHillshadePrepare=!0,_.needsDEMTextureUpload=!0,_.state="loaded",u(null))}_.request=g.getImage(this.map._requestManager.transformRequest(p,g.ResourceType.Tile),function(M,E,P,O){if(delete _.request,_.aborted)_.state="unloaded",u(null);else if(M)_.state="errored",u(M);else if(E){this.map._refreshExpiredTiles&&_.setExpiryData({cacheControl:P,expires:O});const N=g.window.ImageBitmap&&E instanceof g.window.ImageBitmap&&(null==ce&&(ce=g.window.OffscreenCanvas&&new g.window.OffscreenCanvas(1,1).getContext("2d")&&"function"==typeof g.window.createImageBitmap),ce),U=1-(E.width-g.prevPowerOfTwo(E.width))/2;U<1||_.neighboringTiles||(_.neighboringTiles=this._getNeighboringTiles(_.tileID));const H=N?E:g.exported.getImageData(E,U),Z={uid:_.uid,coord:_.tileID,source:this.id,rawImageData:H,encoding:this.encoding,padding:U};_.actor&&"expired"!==_.state||(_.actor=this.dispatcher.getActor(),_.actor.send("loadDEMTile",Z,x.bind(this),void 0,!0))}}.bind(this))}_getNeighboringTiles(_){const u=_.canonical,p=Math.pow(2,u.z),x=(u.x-1+p)%p,M=0===u.x?_.wrap-1:_.wrap,E=(u.x+1+p)%p,P=u.x+1===p?_.wrap+1:_.wrap,O={};return O[new g.OverscaledTileID(_.overscaledZ,M,u.z,x,u.y).key]={backfilled:!1},O[new g.OverscaledTileID(_.overscaledZ,P,u.z,E,u.y).key]={backfilled:!1},u.y>0&&(O[new g.OverscaledTileID(_.overscaledZ,M,u.z,x,u.y-1).key]={backfilled:!1},O[new g.OverscaledTileID(_.overscaledZ,_.wrap,u.z,u.x,u.y-1).key]={backfilled:!1},O[new g.OverscaledTileID(_.overscaledZ,P,u.z,E,u.y-1).key]={backfilled:!1}),u.y+1<p&&(O[new g.OverscaledTileID(_.overscaledZ,M,u.z,x,u.y+1).key]={backfilled:!1},O[new g.OverscaledTileID(_.overscaledZ,_.wrap,u.z,u.x,u.y+1).key]={backfilled:!1},O[new g.OverscaledTileID(_.overscaledZ,P,u.z,E,u.y+1).key]={backfilled:!1}),O}unloadTile(_){_.demTexture&&this.map.painter.saveTileTexture(_.demTexture),_.fbo&&(_.fbo.destroy(),delete _.fbo),_.dem&&delete _.dem,delete _.neighboringTiles,_.state="unloaded"}},geojson:class extends g.Evented{constructor(_,u,p,x){super(),this.id=_,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=p.getActor(),this.setEventedParent(x),this._data=u.data,this._options=g.extend({},u),this._collectResourceTiming=u.collectResourceTiming,void 0!==u.maxzoom&&(this.maxzoom=u.maxzoom),u.type&&(this.type=u.type),u.attribution&&(this.attribution=u.attribution),this.promoteId=u.promoteId;const M=g.EXTENT/this.tileSize;this.workerOptions=g.extend({source:this.id,cluster:u.cluster||!1,geojsonVtOptions:{buffer:(void 0!==u.buffer?u.buffer:128)*M,tolerance:(void 0!==u.tolerance?u.tolerance:.375)*M,extent:g.EXTENT,maxZoom:this.maxzoom,lineMetrics:u.lineMetrics||!1,generateId:u.generateId||!1},superclusterOptions:{maxZoom:void 0!==u.clusterMaxZoom?u.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,u.clusterMinPoints||2),extent:g.EXTENT,radius:(void 0!==u.clusterRadius?u.clusterRadius:50)*M,log:!1,generateId:u.generateId||!1},clusterProperties:u.clusterProperties,filter:u.filter},u.workerOptions)}onAdd(_){this.map=_,this.setData(this._data)}setData(_){return this._data=_,this._updateWorkerData(),this}getClusterExpansionZoom(_,u){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:_,source:this.id},u),this}getClusterChildren(_,u){return this.actor.send("geojson.getClusterChildren",{clusterId:_,source:this.id},u),this}getClusterLeaves(_,u,p,x){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:_,limit:u,offset:p},x),this}_updateWorkerData(){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new g.Event("dataloading",{dataType:"source"})),this._loaded=!1;const _=g.extend({},this.workerOptions),u=this._data;"string"==typeof u?(_.request=this.map._requestManager.transformRequest(g.exported.resolveURL(u),g.ResourceType.Source),_.request.collectResourceTiming=this._collectResourceTiming):_.data=JSON.stringify(u),this._pendingLoad=this.actor.send(`${this.type}.loadData`,_,(p,x)=>{if(this._loaded=!0,this._pendingLoad=null,p)this.fire(new g.ErrorEvent(p));else{const M={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&x&&x.resourceTiming&&x.resourceTiming[this.id]&&(M.resourceTiming=x.resourceTiming[this.id]),this.fire(new g.Event("data",M)),this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(_,u){const p=_.actor?"reloadTile":"loadTile";_.actor=this.actor,_.request=this.actor.send(p,{type:this.type,uid:_.uid,tileID:_.tileID,tileZoom:_.tileZoom,zoom:_.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:g.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},(x,M)=>(delete _.request,_.unloadVectorData(),_.aborted?u(null):x?u(x):(_.loadVectorData(M,this.map.painter,"reloadTile"===p),u(null))),void 0,"loadTile"===p)}abortTile(_){_.request&&(_.request.cancel(),delete _.request),_.aborted=!0}unloadTile(_){_.unloadVectorData(),this.actor.send("removeTile",{uid:_.uid,type:this.type,source:this.id})}onRemove(){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return g.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends Re{constructor(_,u,p,x){super(_,u,p,x),this.roundZoom=!0,this.type="video",this.options=u}load(){this._loaded=!1;const _=this.options;this.urls=[];for(const u of _.urls)this.urls.push(this.map._requestManager.transformRequest(u,g.ResourceType.Source).url);g.getVideo(this.urls,(u,p)=>{this._loaded=!0,u?this.fire(new g.ErrorEvent(u)):p&&(this.video=p,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(_){if(this.video){const u=this.video.seekable;_<u.start(0)||_>u.end(0)?this.fire(new g.ErrorEvent(new g.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${u.start(0)} and ${u.end(0)}-second mark.`))):this.video.currentTime=_}}getVideo(){return this.video}onAdd(_){this.map||(this.map=_,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(0===Object.keys(this.tiles).length||this.video.readyState<2)return;const _=this.map.painter.context,u=_.gl;this.texture?this.video.paused||(this.texture.bind(u.LINEAR,u.CLAMP_TO_EDGE),u.texSubImage2D(u.TEXTURE_2D,0,0,0,u.RGBA,u.UNSIGNED_BYTE,this.video)):(this.texture=new g.Texture(_,this.video,u.RGBA),this.texture.bind(u.LINEAR,u.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(_)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:Re,canvas:class extends Re{constructor(_,u,p,x){super(_,u,p,x),u.coordinates?Array.isArray(u.coordinates)&&4===u.coordinates.length&&!u.coordinates.some(M=>!Array.isArray(M)||2!==M.length||M.some(E=>"number"!=typeof E))||this.fire(new g.ErrorEvent(new g.ValidationError(`sources.${_}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new g.ErrorEvent(new g.ValidationError(`sources.${_}`,null,'missing required property "coordinates"'))),u.animate&&"boolean"!=typeof u.animate&&this.fire(new g.ErrorEvent(new g.ValidationError(`sources.${_}`,null,'optional "animate" property must be a boolean value'))),u.canvas?"string"==typeof u.canvas||u.canvas instanceof g.window.HTMLCanvasElement||this.fire(new g.ErrorEvent(new g.ValidationError(`sources.${_}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new g.ErrorEvent(new g.ValidationError(`sources.${_}`,null,'missing required property "canvas"'))),this.options=u,this.animate=void 0===u.animate||u.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof g.window.HTMLCanvasElement?this.options.canvas:g.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new g.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(_){this.map=_,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let _=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,_=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,_=!0),this._hasInvalidDimensions()||0===Object.keys(this.tiles).length)return;const u=this.map.painter.context;this.texture?(_||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new g.Texture(u,this.canvas,u.gl.RGBA,{premultiply:!0}),this._prepareData(u)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const _ of[this.canvas.width,this.canvas.height])if(isNaN(_)||_<=0)return!0;return!1}},custom:class extends g.Evented{constructor(_,u,p,x){super(),this.id=_,this.type="custom",this._dataType="raster",this._dispatcher=p,this._implementation=u,this.setEventedParent(x),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new g.ErrorEvent(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new g.ErrorEvent(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new ua(this._implementation.bounds,this.minzoom,this.maxzoom)),u.update=this._update.bind(this),u.clearTiles=this._clearTiles.bind(this),u.coveringTiles=this._coveringTiles.bind(this),g.extend(this,g.pick(u,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return g.pick(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new g.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new g.Event("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(_){this._map=_,this._loaded=!1,this.fire(new g.Event("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(_),this.load()}onRemove(_){this._implementation.onRemove&&this._implementation.onRemove(_)}hasTile(_){if(this._implementation.hasTile){const{x:u,y:p,z:x}=_.canonical;return this._implementation.hasTile({x:u,y:p,z:x})}return!this.tileBounds||this.tileBounds.contains(_.canonical)}loadTile(_,u){const{x:p,y:x,z:M}=_.tileID.canonical,E=new g.window.AbortController;_.request=Promise.resolve(this._implementation.loadTile({x:p,y:x,z:M},{signal:E.signal})).then(function(P){return delete _.request,_.aborted?(_.state="unloaded",u(null)):void 0===P?(_.state="errored",u(null)):null===P?(this.loadTileData(_,{width:this.tileSize,height:this.tileSize,data:null}),_.state="loaded",u(null)):(O=P)instanceof g.window.ImageData||O instanceof g.window.HTMLCanvasElement||O instanceof g.window.ImageBitmap||O instanceof g.window.HTMLImageElement?(this.loadTileData(_,P),_.state="loaded",void u(null)):(_.state="errored",u(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)));var O}.bind(this)).catch(P=>{20!==P.code&&(_.state="errored",u(P))}),_.request.cancel=()=>E.abort()}loadTileData(_,u){K.loadTileData(_,u,this._map.painter)}unloadTileData(_){K.unloadTileData(_,this._map.painter)}unloadTile(_,u){if(this.unloadTileData(_),this._implementation.unloadTile){const{x:p,y:x,z:M}=_.tileID.canonical;this._implementation.unloadTile({x:p,y:x,z:M})}u()}abortTile(_,u){_.request&&_.request.cancel&&(_.request.cancel(),delete _.request),u()}hasTransition(){return!1}_coveringTiles(){return this._map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(_=>({x:_.canonical.x,y:_.canonical.y,z:_.canonical.z}))}_clearTiles(){this._map.style._clearSource(this.id)}_update(){this.fire(new g.Event("data",{dataType:"source",sourceDataType:"content"}))}}},Be=function(_,u,p,x){const M=new Ve[u.type](_,u,p,x);if(M.id!==_)throw new Error(`Expected Source id to be ${_} instead of ${M.id}`);return g.bindAll(["load","abort","unload","serialize","prepare"],M),M};function Le(_,u){const p=g.identity([]);return g.scale(p,p,[.5*_.width,.5*-_.height,1]),g.translate(p,p,[1,-1,0]),g.multiply(p,p,_.calculateProjMatrix(u.toUnwrapped())),Float32Array.from(p)}function ze(_,u,p,x,M,E,P,O=!1){const N=_.tilesIn(x,P,O);N.sort(Gt);const U=[];for(const Z of N)U.push({wrappedTileID:Z.tile.tileID.wrapped().key,queryResults:Z.tile.queryRenderedFeatures(u,p,_._state,Z,M,E,Le(_.transform,Z.tile.tileID),O)});const H=function(Z){const Q={},oe={};for(const ie of Z){const le=ie.queryResults,re=ie.wrappedTileID,ne=oe[re]=oe[re]||{};for(const ue in le){const se=le[ue],Me=ne[ue]=ne[ue]||{},Se=Q[ue]=Q[ue]||[];for(const ge of se)Me[ge.featureIndex]||(Me[ge.featureIndex]=!0,Se.push(ge))}}return Q}(U);for(const Z in H)H[Z].forEach(Q=>{const oe=Q.feature,ie=oe.layer;ie&&"background"!==ie.type&&"sky"!==ie.type&&(oe.source=ie.source,ie["source-layer"]&&(oe.sourceLayer=ie["source-layer"]),oe.state=void 0!==oe.id?_.getFeatureState(ie["source-layer"],oe.id):{})});return H}function _t(_,u){const p=_.getRenderableIds().map(E=>_.getTileByID(E)),x=[],M={};for(let E=0;E<p.length;E++){const P=p[E],O=P.tileID.canonical.key;M[O]||(M[O]=!0,P.querySourceFeatures(x,u))}return x}function Gt(_,u){const p=_.tileID,x=u.tileID;return p.overscaledZ-x.overscaledZ||p.canonical.y-x.canonical.y||p.wrap-x.wrap||p.canonical.x-x.canonical.x}function Dt(){return null!=Hh.workerClass?new Hh.workerClass:new g.window.Worker(Hh.workerUrl)}const Pn="mapboxgl_preloaded_worker_pool";class Sn{constructor(){this.active={}}acquire(u){if(!this.workers)for(this.workers=[];this.workers.length<Sn.workerCount;)this.workers.push(new Dt);return this.active[u]=!0,this.workers.slice()}release(u){delete this.active[u],0===this.numActive()&&(this.workers.forEach(p=>{p.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[Pn]}numActive(){return Object.keys(this.active).length}}let Mn;function Vn(){return Mn||(Mn=new Sn),Mn}function oi(_,u){const p={};for(const x in _)"ref"!==x&&(p[x]=_[x]);return g.refProperties.forEach(x=>{x in u&&(p[x]=u[x])}),p}function Ui(_){_=_.slice();const u=Object.create(null);for(let p=0;p<_.length;p++)u[_[p].id]=_[p];for(let p=0;p<_.length;p++)"ref"in _[p]&&(_[p]=oi(_[p],u[_[p].ref]));return _}Sn.workerCount=2;const Fn={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setProjection:"setProjection"};function or(_,u,p){p.push({command:Fn.addSource,args:[_,u[_]]})}function pr(_,u,p){u.push({command:Fn.removeSource,args:[_]}),p[_]=!0}function zc(_,u,p,x){pr(_,p,x),or(_,u,p)}function ec(_,u,p){let x;for(x in _[p])if(_[p].hasOwnProperty(x)&&"data"!==x&&!lt(_[p][x],u[p][x]))return!1;for(x in u[p])if(u[p].hasOwnProperty(x)&&"data"!==x&&!lt(_[p][x],u[p][x]))return!1;return!0}function rt(_,u,p,x,M,E){let P;for(P in u=u||{},_=_||{})_.hasOwnProperty(P)&&(lt(_[P],u[P])||p.push({command:E,args:[x,P,u[P],M]}));for(P in u)u.hasOwnProperty(P)&&!_.hasOwnProperty(P)&&(lt(_[P],u[P])||p.push({command:E,args:[x,P,u[P],M]}))}function Ll(_){return _.id}function ps(_,u){return _[u.id]=u,_}class Vc{constructor(u,p){this.reset(u,p)}reset(u,p){this.points=u||[],this._distances=[0];for(let x=1;x<this.points.length;x++)this._distances[x]=this._distances[x-1]+this.points[x].dist(this.points[x-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(p||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(u){if(1===this.points.length)return this.points[0];u=g.clamp(u,0,1);let p=1,x=this._distances[p];const M=u*this.paddedLength+this.padding;for(;x<M&&p<this._distances.length;)x=this._distances[++p];const E=p-1,P=this._distances[E],O=x-P,N=O>0?(M-P)/O:0;return this.points[E].mult(1-N).add(this.points[p].mult(N))}}class fs{constructor(u,p,x){const M=this.boxCells=[],E=this.circleCells=[];this.xCellCount=Math.ceil(u/x),this.yCellCount=Math.ceil(p/x);for(let P=0;P<this.xCellCount*this.yCellCount;P++)M.push([]),E.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=u,this.height=p,this.xScale=this.xCellCount/u,this.yScale=this.yCellCount/p,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(u,p,x,M,E){this._forEachCell(p,x,M,E,this._insertBoxCell,this.boxUid++),this.boxKeys.push(u),this.bboxes.push(p),this.bboxes.push(x),this.bboxes.push(M),this.bboxes.push(E)}insertCircle(u,p,x,M){this._forEachCell(p-M,x-M,p+M,x+M,this._insertCircleCell,this.circleUid++),this.circleKeys.push(u),this.circles.push(p),this.circles.push(x),this.circles.push(M)}_insertBoxCell(u,p,x,M,E,P){this.boxCells[E].push(P)}_insertCircleCell(u,p,x,M,E,P){this.circleCells[E].push(P)}_query(u,p,x,M,E,P){if(x<0||u>this.width||M<0||p>this.height)return!E&&[];const O=[];if(u<=0&&p<=0&&this.width<=x&&this.height<=M){if(E)return!0;for(let N=0;N<this.boxKeys.length;N++)O.push({key:this.boxKeys[N],x1:this.bboxes[4*N],y1:this.bboxes[4*N+1],x2:this.bboxes[4*N+2],y2:this.bboxes[4*N+3]});for(let N=0;N<this.circleKeys.length;N++){const U=this.circles[3*N],H=this.circles[3*N+1],Z=this.circles[3*N+2];O.push({key:this.circleKeys[N],x1:U-Z,y1:H-Z,x2:U+Z,y2:H+Z})}return P?O.filter(P):O}return this._forEachCell(u,p,x,M,this._queryCell,O,{hitTest:E,seenUids:{box:{},circle:{}}},P),E?O.length>0:O}_queryCircle(u,p,x,M,E){const P=u-x,O=u+x,N=p-x,U=p+x;if(O<0||P>this.width||U<0||N>this.height)return!M&&[];const H=[];return this._forEachCell(P,N,O,U,this._queryCellCircle,H,{hitTest:M,circle:{x:u,y:p,radius:x},seenUids:{box:{},circle:{}}},E),M?H.length>0:H}query(u,p,x,M,E){return this._query(u,p,x,M,!1,E)}hitTest(u,p,x,M,E){return this._query(u,p,x,M,!0,E)}hitTestCircle(u,p,x,M){return this._queryCircle(u,p,x,!0,M)}_queryCell(u,p,x,M,E,P,O,N){const U=O.seenUids,H=this.boxCells[E];if(null!==H){const Q=this.bboxes;for(const oe of H)if(!U.box[oe]){U.box[oe]=!0;const ie=4*oe;if(u<=Q[ie+2]&&p<=Q[ie+3]&&x>=Q[ie+0]&&M>=Q[ie+1]&&(!N||N(this.boxKeys[oe]))){if(O.hitTest)return P.push(!0),!0;P.push({key:this.boxKeys[oe],x1:Q[ie],y1:Q[ie+1],x2:Q[ie+2],y2:Q[ie+3]})}}}const Z=this.circleCells[E];if(null!==Z){const Q=this.circles;for(const oe of Z)if(!U.circle[oe]){U.circle[oe]=!0;const ie=3*oe;if(this._circleAndRectCollide(Q[ie],Q[ie+1],Q[ie+2],u,p,x,M)&&(!N||N(this.circleKeys[oe]))){if(O.hitTest)return P.push(!0),!0;{const le=Q[ie],re=Q[ie+1],ne=Q[ie+2];P.push({key:this.circleKeys[oe],x1:le-ne,y1:re-ne,x2:le+ne,y2:re+ne})}}}}}_queryCellCircle(u,p,x,M,E,P,O,N){const U=O.circle,H=O.seenUids,Z=this.boxCells[E];if(null!==Z){const oe=this.bboxes;for(const ie of Z)if(!H.box[ie]){H.box[ie]=!0;const le=4*ie;if(this._circleAndRectCollide(U.x,U.y,U.radius,oe[le+0],oe[le+1],oe[le+2],oe[le+3])&&(!N||N(this.boxKeys[ie])))return P.push(!0),!0}}const Q=this.circleCells[E];if(null!==Q){const oe=this.circles;for(const ie of Q)if(!H.circle[ie]){H.circle[ie]=!0;const le=3*ie;if(this._circlesCollide(oe[le],oe[le+1],oe[le+2],U.x,U.y,U.radius)&&(!N||N(this.circleKeys[ie])))return P.push(!0),!0}}}_forEachCell(u,p,x,M,E,P,O,N){const U=this._convertToXCellCoord(u),H=this._convertToYCellCoord(p),Z=this._convertToXCellCoord(x),Q=this._convertToYCellCoord(M);for(let oe=U;oe<=Z;oe++)for(let ie=H;ie<=Q;ie++)if(E.call(this,u,p,x,M,this.xCellCount*ie+oe,P,O,N))return}_convertToXCellCoord(u){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(u*this.xScale)))}_convertToYCellCoord(u){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(u*this.yScale)))}_circlesCollide(u,p,x,M,E,P){const O=M-u,N=E-p,U=x+P;return U*U>O*O+N*N}_circleAndRectCollide(u,p,x,M,E,P,O){const N=(P-M)/2,U=Math.abs(u-(M+N));if(U>N+x)return!1;const H=(O-E)/2,Z=Math.abs(p-(E+H));if(Z>H+x)return!1;if(U<=N||Z<=H)return!0;const Q=U-N,oe=Z-H;return Q*Q+oe*oe<=x*x}}const so=Math.tan(85*Math.PI/180);function Ru(_,u,p,x,M,E,P){const O=g.create();if(p)if("globe"===E.name){const N=g.calculateGlobeLabelMatrix(M,u);g.multiply(O,O,N)}else{const N=Si([],P);O[0]=N[0],O[1]=N[1],O[4]=N[2],O[5]=N[3],x||g.rotateZ(O,O,M.angle)}else g.multiply(O,M.labelPlaneMatrix,_);return O}function Vp(_,u,p,x,M,E,P){const O=Ru(_,u,p,x,M,E,P);return"globe"===E.name&&p||(O[2]=O[6]=O[10]=O[14]=0),O}function ar(_,u,p,x,M,E,P){if(p){if("globe"===E.name){const O=Ru(_,u,p,x,M,E,P);return g.invert(O,O),g.multiply(O,_,O),O}{const O=g.clone(_),N=g.identity([]);return N[0]=P[0],N[1]=P[1],N[4]=P[2],N[5]=P[3],g.multiply(O,O,N),x||g.rotateZ(O,O,-M.angle),O}}return M.glCoordMatrix}function Zt(_,u,p=0){const x=[_.x,_.y,p,1];p?g.transformMat4$1(x,x,u):Cm(x,x,u);const M=x[3];return{point:[x[0]/M,x[1]/M,x[2]/M],signedDistanceFromCamera:M}}function vn(_,u){const p=[_[0],_[1],_[2],1];g.transformMat4$1(p,p,u);const x=p[3];return{point:[p[0]/x,p[1]/x,p[2]/x],signedDistanceFromCamera:x}}function _i(_,u){return Math.min(.5+_/u*.5,1.5)}function Ol(_,u){const p=_[0]/_[3],x=_[1]/_[3];return p>=-u[0]&&p<=u[0]&&x>=-u[1]&&x<=u[1]}function Ai(_,u,p,x,M,E,P,O,N,U){const H=p.transform,Z=x?_.textSizeData:_.iconSizeData,Q=g.evaluateSizeForZoom(Z,p.transform.zoom),oe="globe"===H.projection.name,ie=[256/p.width*2+1,256/p.height*2+1],le=x?_.text.dynamicLayoutVertexArray:_.icon.dynamicLayoutVertexArray;le.clear();let re=null;oe&&(re=x?_.text.globeExtVertexArray:_.icon.globeExtVertexArray);const ne=_.lineVertexArray,ue=x?_.text.placedSymbolArray:_.icon.placedSymbolArray,se=p.transform.width/p.transform.height;let Me=!1;for(let Se=0;Se<ue.length;Se++){const ge=ue.get(Se);if(ge.writingMode!==g.WritingMode.vertical||Me||0!==Se&&ue.get(Se-1).writingMode===g.WritingMode.horizontal||(Me=!0),(ge.hidden||ge.writingMode===g.WritingMode.vertical)&&!Me){tl(ge.numGlyphs,le);continue}Me=!1;const De=new g.pointGeometry(ge.tileAnchorX,ge.tileAnchorY),Ue=N?N(De):[0,0,0],Ke=H.projection.projectTilePoint(De.x,De.y,U.canonical),je=[Ke.x+Ue[0],Ke.y+Ue[1],Ke.z+Ue[2]],St=[...je,1];if(g.transformMat4$1(St,St,u),!Ol(St,ie)){tl(ge.numGlyphs,le);continue}const Ne=_i(p.transform.cameraToCenterDistance,St[3]),pt=g.evaluateSizeForFeature(Z,Q,ge),ht=P?pt/Ne:pt*Ne,We=Zt(new g.pointGeometry(je[0],je[1]),M,je[2]);if(We.signedDistanceFromCamera<=0){tl(ge.numGlyphs,le);continue}let Fe={};const $t=P?null:N,Ft=Ch(ge,ht,!1,O,u,M,E,_.glyphOffsetArray,ne,le,re,We.point,De,Fe,se,$t,H.projection,U,P);Me=Ft.useVertical,$t&&Ft.needsFlipping&&(Fe={}),(Ft.notEnoughRoom||Me||Ft.needsFlipping&&Ch(ge,ht,!0,O,u,M,E,_.glyphOffsetArray,ne,le,re,We.point,De,Fe,se,$t,H.projection,U,P).notEnoughRoom)&&tl(ge.numGlyphs,le)}x?(_.text.dynamicLayoutVertexBuffer.updateData(le),re&&_.text.globeExtVertexBuffer.updateData(re)):(_.icon.dynamicLayoutVertexBuffer.updateData(le),re&&_.icon.globeExtVertexBuffer.updateData(re))}function Xt(_,u,p,x,M,E,P,O,N,U,H,Z,Q,oe,ie,le){const re=O.glyphStartIndex+O.numGlyphs,ne=O.lineStartIndex,ue=O.lineStartIndex+O.lineLength,se=u.getoffsetX(O.glyphStartIndex),Me=u.getoffsetX(re-1),Se=bn(_*se,p,x,M,E,P,O.segment,ne,ue,N,U,H,Z,Q,!0,oe,ie,le);if(!Se)return null;const ge=bn(_*Me,p,x,M,E,P,O.segment,ne,ue,N,U,H,Z,Q,!0,oe,ie,le);return ge?{first:Se,last:ge}:null}function ku(_,u,p,x){return _.writingMode===g.WritingMode.horizontal&&Math.abs(p.y-u.y)>Math.abs(p.x-u.x)*x?{useVertical:!0}:_.writingMode===g.WritingMode.vertical?u.y<p.y?{needsFlipping:!0}:null:0!==_.flipState&&function(M,E,P){const O=(E.x-M.x)*P;return 0===O||Math.abs((E.y-M.y)/O)>so}(u,p,x)?1===_.flipState?{needsFlipping:!0}:null:u.x>p.x?{needsFlipping:!0}:null}function Ch(_,u,p,x,M,E,P,O,N,U,H,Z,Q,oe,ie,le,re,ne,ue){const se=u/24,Me=_.lineOffsetX*se,Se=_.lineOffsetY*se;let ge=[];if(_.numGlyphs>1){const De=_.glyphStartIndex+_.numGlyphs,Ue=_.lineStartIndex,Ke=_.lineStartIndex+_.lineLength,je=Xt(se,O,Me,Se,p,Z,Q,_,N,E,oe,le,!1,re,ne,ue);if(!je)return{notEnoughRoom:!0};const St=vn(je.first.point,P).point,Ne=vn(je.last.point,P).point,pt=new g.pointGeometry(St[0],St[1]),ht=new g.pointGeometry(Ne[0],Ne[1]);if(x&&!p){const We=ku(_,pt,ht,ie);if(_.flipState=We&&We.needsFlipping?1:2,We)return We}ge=[je.first];for(let We=_.glyphStartIndex+1;We<De-1;We++){const Fe=bn(se*O.getoffsetX(We),Me,Se,p,Z,Q,_.segment,Ue,Ke,N,E,oe,le,!1,!1,re,ne,ue);if(!Fe)return{notEnoughRoom:!0};ge.push(Fe)}ge.push(je.last)}else{if(x&&!p){const Ue=Zt(Q,M).point,Ke=_.lineStartIndex+_.segment+1,je=new g.pointGeometry(N.getx(Ke),N.gety(Ke)),St=Zt(je,M),Ne=St.signedDistanceFromCamera>0?St.point:oo(Q,je,Ue,1,M,void 0,re,ne.canonical),pt=ku(_,new g.pointGeometry(Ue[0],Ue[1]),new g.pointGeometry(Ne[0],Ne[1]),ie);if(_.flipState=pt&&pt.needsFlipping?1:2,pt)return pt}const De=bn(se*O.getoffsetX(_.glyphStartIndex),Me,Se,p,Z,Q,_.segment,_.lineStartIndex,_.lineStartIndex+_.lineLength,N,E,oe,le,!1,!1,re,ne,ue);if(!De)return{notEnoughRoom:!0};ge=[De]}if(H)for(const De of ge)g.updateGlobeVertexNormal(H,U.length+0,De.up[0],De.up[1],De.up[2]),g.updateGlobeVertexNormal(H,U.length+1,De.up[0],De.up[1],De.up[2]),g.updateGlobeVertexNormal(H,U.length+2,De.up[0],De.up[1],De.up[2]),g.updateGlobeVertexNormal(H,U.length+3,De.up[0],De.up[1],De.up[2]),g.addDynamicAttributes(U,De.point[0],De.point[1],De.point[2],De.angle);else for(const De of ge)g.addDynamicAttributes(U,De.point[0],De.point[1],De.point[2],De.angle);return{}}function bt(_,u,p,x,M){const E=x.projectTilePoint(_.x,_.y,u);if(!M)return Zt(E,p,E.z);const P=M(_);return Zt(new g.pointGeometry(E.x+P[0],E.y+P[1]),p,E.z+P[2])}function oo(_,u,p,x,M,E,P,O){const N=bt(_.add(_.sub(u)._unit()),O,M,P,E).point,U=g.sub([],p,N);return g.scaleAndAdd([],p,U,x/g.length(U))}function bn(_,u,p,x,M,E,P,O,N,U,H,Z,Q,oe,ie,le,re,ne){const ue=x?_-u:_+u;let se=ue>0?1:-1,Me=0;x&&(se*=-1,Me=Math.PI),se<0&&(Me+=Math.PI);let Se=se>0?O+P:O+P+1,ge=M,De=M,Ue=0,Ke=0;const je=Math.abs(ue),St=[],Ne=[];let pt=E;const ht=()=>{const Lt=Se-se;return 0===Ue?E:new g.pointGeometry(U.getx(Lt),U.gety(Lt))},We=()=>{const Lt=ht();return oo(Lt,pt||Lt,De,je-Ue+1,H,Q,le,re.canonical)};for(;Ue+Ke<=je;){if(Se+=se,Se<O||Se>=N)return null;if(De=ge,St.push(ge),oe&&Ne.push(pt||ht()),ge=Z[Se],void 0===ge){pt=new g.pointGeometry(U.getx(Se),U.gety(Se));const Lt=bt(pt,re.canonical,H,le,Q);ge=Lt.signedDistanceFromCamera>0?Z[Se]=Lt.point:We()}else pt=null;Ue+=Ke,Ke=g.distance(De,ge)}pt=pt||new g.pointGeometry(U.getx(Se),U.gety(Se));const Fe=ht();ie&&Q&&(Z[Se]=ge=void 0===Z[Se]?ge:We(),Ke=g.distance(De,ge));const $t=(je-Ue)/Ke,Ft=pt.sub(Fe).mult($t)._add(Fe),kt=g.sub([],ge,De),Bt=g.scaleAndAdd([],De,kt,$t);let un=[0,0,1],Nn=kt[0],Tn=kt[1];if(ne&&(un=le.upVector(re.canonical,Ft.x,Ft.y),0!==un[0]||0!==un[1]||1!==un[2])){const Lt=[1,0,0],qn=[0,1,0];Lt[0]=un[2],Lt[1]=0,Lt[2]=-un[0],g.cross(qn,un,Lt),g.normalize(Lt,Lt),g.normalize(qn,qn),Nn=g.dot(kt,Lt),Tn=g.dot(kt,qn)}if(p){const Lt=g.cross([],un,kt);g.normalize(Lt,Lt),g.scaleAndAdd(Bt,Bt,Lt,p*se)}const mn=Me+Math.atan2(Tn,Nn);return St.push(Bt),oe&&Ne.push(Ft),{point:Bt,angle:mn,path:St,tilePath:Ne,up:un}}const fr=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function tl(_,u){for(let p=0;p<_;p++){const x=u.length;u.resize(x+4),u.float32.set(fr,4*x)}}function Cm(_,u,p){const x=u[0],M=u[1];return _[0]=p[0]*x+p[4]*M+p[12],_[1]=p[1]*x+p[5]*M+p[13],_[3]=p[3]*x+p[7]*M+p[15],_}const Zo=100;class Cd{constructor(u,p,x=new fs(u.width+200,u.height+200,25),M=new fs(u.width+200,u.height+200,25)){this.transform=u,this.grid=x,this.ignoredGrid=M,this.pitchfactor=Math.cos(u._pitch)*u.cameraToCenterDistance,this.screenRightBoundary=u.width+Zo,this.screenBottomBoundary=u.height+Zo,this.gridRightBoundary=u.width+200,this.gridBottomBoundary=u.height+200,this.fogState=p}placeCollisionBox(u,p,x,M,E,P,O,N){let U=x.projectedAnchorX,H=x.projectedAnchorY,Z=x.projectedAnchorZ;const Q=x.elevation,oe=x.tileID;if(Q&&oe){const Se=u.getProjection().upVector(oe.canonical,x.tileAnchorX,x.tileAnchorY),ge=u.getProjection().upVectorScale(oe.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;U+=Se[0]*Q*ge,H+=Se[1]*Q*ge,Z+=Se[2]*Q*ge}const ie=this.projectAndGetPerspectiveRatio(O,[U,H,Z],x.tileID,"globe"===u.projection.name||!!Q||this.transform.pitch>0,u.getProjection()),le=P*ie.perspectiveRatio,re=(x.x1*p+M.x-x.padding)*le+ie.point.x,ne=(x.y1*p+M.y-x.padding)*le+ie.point.y,ue=(x.x2*p+M.x+x.padding)*le+ie.point.x,se=(x.y2*p+M.y+x.padding)*le+ie.point.y,Me=ie.perspectiveRatio<=.55||ie.occluded;return!this.isInsideGrid(re,ne,ue,se)||!E&&this.grid.hitTest(re,ne,ue,se,N)||Me?{box:[],offscreen:!1,occluded:ie.occluded}:{box:[re,ne,ue,se],offscreen:this.isOffscreen(re,ne,ue,se),occluded:!1}}placeCollisionCircles(u,p,x,M,E,P,O,N,U,H,Z,Q,oe,ie,le){const re=[],ne=this.transform.elevation,ue=ne?ne.getAtTileOffsetFunc(le,this.transform.center.lat,this.transform.worldSize,u.getProjection()):Fe=>[0,0,0],se=new g.pointGeometry(x.tileAnchorX,x.tileAnchorY),Me=u.getProjection().projectTilePoint(x.tileAnchorX,x.tileAnchorY,le.canonical),Se=ue(se),ge=[Me.x+Se[0],Me.y+Se[1],Me.z+Se[2]],De="globe"===u.projection.name,Ue=this.projectAndGetPerspectiveRatio(O,[ge[0],ge[1],ge[2]],le,De||!!ne||this.transform.pitch>0,u.getProjection()),{perspectiveRatio:Ke}=Ue,je=(Z?P/Ke:P*Ke)/g.ONE_EM,St=Zt(new g.pointGeometry(ge[0],ge[1]),N,ge[2]).point,Ne=Ue.signedDistanceFromCamera>0?Xt(je,E,x.lineOffsetX*je,x.lineOffsetY*je,!1,St,se,x,M,N,{},ne&&!Z?ue:null,Z&&!!ne,u.getProjection(),le,Z):null;let pt=!1,ht=!1,We=!0;if(Ne&&!Ue.occluded){const Fe=.5*oe*Ke+ie,$t=new g.pointGeometry(-100,-100),Ft=new g.pointGeometry(this.screenRightBoundary,this.screenBottomBoundary),kt=new Vc,Bt=Ne.first,un=Ne.last;let Nn=[];for(let Lt=Bt.path.length-1;Lt>=1;Lt--)Nn.push(Bt.path[Lt]);for(let Lt=1;Lt<un.path.length;Lt++)Nn.push(un.path[Lt]);const Tn=2.5*Fe;if(U){const Lt=Nn.map(ne&&!De?(qn,di)=>{const ur=ue(di<Bt.path.length-1?Bt.tilePath[Bt.path.length-1-di]:un.tilePath[di-Bt.path.length+2]);return qn[2]=ur[2],vn(qn,U)}:qn=>vn(qn,U));Nn=Lt.some(qn=>qn.signedDistanceFromCamera<=0)?[]:Lt.map(qn=>qn.point)}let mn=[];if(Nn.length>0){const Lt=Nn.map(Yi=>new g.pointGeometry(Yi[0],Yi[1]));let qn=1/0,di=-1/0,ur=1/0,dr=-1/0;for(let Yi=0;Yi<Lt.length;Yi++)qn=Math.min(qn,Lt[Yi].x),ur=Math.min(ur,Lt[Yi].y),di=Math.max(di,Lt[Yi].x),dr=Math.max(dr,Lt[Yi].y);mn=qn>=$t.x&&di<=Ft.x&&ur>=$t.y&&dr<=Ft.y?[Lt]:di<$t.x||qn>Ft.x||dr<$t.y||ur>Ft.y?[]:g.clipLine([Lt],$t.x,$t.y,Ft.x,Ft.y)}for(const Lt of mn){kt.reset(Lt,.25*Fe);let qn=0;qn=kt.length<=.5*Fe?1:Math.ceil(kt.paddedLength/Tn)+1;for(let di=0;di<qn;di++){const ur=di/Math.max(qn-1,1),dr=kt.lerp(ur),Yi=dr.x+Zo,Rs=dr.y+Zo;re.push(Yi,Rs,Fe,0);const Hs=Yi-Fe,Yo=Rs-Fe,Rr=Yi+Fe,Gr=Rs+Fe;if(We=We&&this.isOffscreen(Hs,Yo,Rr,Gr),ht=ht||this.isInsideGrid(Hs,Yo,Rr,Gr),!p&&this.grid.hitTestCircle(Yi,Rs,Fe,Q)&&(pt=!0,!H))return{circles:[],offscreen:!1,collisionDetected:pt,occluded:!1}}}}return{circles:!H&&pt||!ht?[]:re,offscreen:We,collisionDetected:pt,occluded:Ue.occluded}}queryRenderedSymbols(u){if(0===u.length||0===this.grid.keysLength()&&0===this.ignoredGrid.keysLength())return{};const p=[];let x=1/0,M=1/0,E=-1/0,P=-1/0;for(const H of u){const Z=new g.pointGeometry(H.x+Zo,H.y+Zo);x=Math.min(x,Z.x),M=Math.min(M,Z.y),E=Math.max(E,Z.x),P=Math.max(P,Z.y),p.push(Z)}const O=this.grid.query(x,M,E,P).concat(this.ignoredGrid.query(x,M,E,P)),N={},U={};for(const H of O){const Z=H.key;if(void 0===N[Z.bucketInstanceId]&&(N[Z.bucketInstanceId]={}),N[Z.bucketInstanceId][Z.featureIndex])continue;const Q=[new g.pointGeometry(H.x1,H.y1),new g.pointGeometry(H.x2,H.y1),new g.pointGeometry(H.x2,H.y2),new g.pointGeometry(H.x1,H.y2)];g.polygonIntersectsPolygon(p,Q)&&(N[Z.bucketInstanceId][Z.featureIndex]=!0,void 0===U[Z.bucketInstanceId]&&(U[Z.bucketInstanceId]=[]),U[Z.bucketInstanceId].push(Z.featureIndex))}return U}insertCollisionBox(u,p,x,M,E){(p?this.ignoredGrid:this.grid).insert({bucketInstanceId:x,featureIndex:M,collisionGroupID:E},u[0],u[1],u[2],u[3])}insertCollisionCircles(u,p,x,M,E){const P=p?this.ignoredGrid:this.grid,O={bucketInstanceId:x,featureIndex:M,collisionGroupID:E};for(let N=0;N<u.length;N+=4)P.insertCircle(O,u[N],u[N+1],u[N+2])}projectAndGetPerspectiveRatio(u,p,x,M,E){const P=[p[0],p[1],p[2],1];let O=!1;if(p[2]||this.transform.pitch>0){g.transformMat4$1(P,P,u);const N="globe"===E.name;this.fogState&&x&&!N&&(O=function(U,H,Z,Q,oe,ie){const le=ie.calculateFogTileMatrix(oe),re=[H,Z,Q];return g.transformMat4(re,re,le),Rc(U,re,ie.pitch,ie._fov)}(this.fogState,p[0],p[1],p[2],x.toUnwrapped(),this.transform)>.9)}else Cm(P,P,u);return{point:new g.pointGeometry((P[0]/P[3]+1)/2*this.transform.width+Zo,(-P[1]/P[3]+1)/2*this.transform.height+Zo),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(E)/P[3]*.5,1.5),signedDistanceFromCamera:P[3],occluded:M&&P[2]>P[3]||O}}isOffscreen(u,p,x,M){return x<Zo||u>=this.screenRightBoundary||M<Zo||p>this.screenBottomBoundary}isInsideGrid(u,p,x,M){return x>=0&&u<this.gridRightBoundary&&M>=0&&p<this.gridBottomBoundary}getViewportMatrix(){const u=g.identity([]);return g.translate(u,u,[-100,-100,0]),u}}function ao(_,u,p){const x=u.createTileMatrix(_,_.worldSize,p.toUnwrapped());return g.multiply(new Float32Array(16),_.projMatrix,x)}function Sm(_,u,p){if(u.projection.name===p.projection.name)return _.projMatrix;const x=p.clone();return x.setProjection(u.projection),ao(x,u.getProjection(),_)}function Sh(_,u,p){return u.name===p.projection.name?_.projMatrix:ao(p,u,_)}class Up{constructor(u,p,x,M){this.opacity=u?Math.max(0,Math.min(1,u.opacity+(u.placed?p:-p))):M&&x?1:0,this.placed=x}isHidden(){return 0===this.opacity&&!this.placed}}class Po{constructor(u,p,x,M,E,P=!1){this.text=new Up(u?u.text:null,p,x,E),this.icon=new Up(u?u.icon:null,p,M,E),this.clipped=P}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Ro{constructor(u,p,x,M=!1){this.text=u,this.icon=p,this.skipFade=x,this.clipped=M}}class ms{constructor(){this.invProjMatrix=g.create(),this.viewportMatrix=g.create(),this.circles=[]}}class b_{constructor(u,p,x,M,E){this.bucketInstanceId=u,this.featureIndex=p,this.sourceLayerIndex=x,this.bucketIndex=M,this.tileID=E}}class w_{constructor(u){this.crossSourceCollisions=u,this.maxGroupID=0,this.collisionGroups={}}get(u){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[u]){const p=++this.maxGroupID;this.collisionGroups[u]={ID:p,predicate:x=>x.collisionGroupID===p}}return this.collisionGroups[u]}}function ko(_,u,p,x,M){const{horizontalAlign:E,verticalAlign:P}=g.getAnchorAlignment(_),O=-(E-.5)*u,N=-(P-.5)*p,U=g.evaluateVariableOffset(_,x);return new g.pointGeometry(O+U[0]*M,N+U[1]*M)}function da(_,u,p,x,M){const E=new g.pointGeometry(_,u);return p&&E._rotate(x?M:-M),E}class M_{constructor(u,p,x,M,E){this.transform=u.clone(),this.projection=u.projection.name,this.collisionIndex=new Cd(this.transform,E),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=p,this.retainedQueryData={},this.collisionGroups=new w_(x),this.collisionCircleArrays={},this.prevPlacement=M,M&&(M.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(u,p,x,M){const E=x.getBucket(p),P=x.latestFeatureIndex;if(!E||!P||p.id!==E.layerIds[0])return;const O=E.layers[0].layout,N=x.collisionBoxArray,U=Math.pow(2,this.transform.zoom-x.tileID.overscaledZ),H=x.tileSize/g.EXTENT,Z=x.tileID.toUnwrapped();this.transform.setProjection(E.projection);const Q=(oe=x.tileID,ie=E.getProjection(),le=this.transform,ie.name===this.projection?le.calculateProjMatrix(oe.toUnwrapped()):ao(le,ie,oe));var oe,ie,le;const re="map"===O.get("text-pitch-alignment"),ne="map"===O.get("text-rotation-alignment");p.compileFilter();const ue=p.dynamicFilter(),se=p.dynamicFilterNeedsFeature(),Me=this.transform.calculatePixelsToTileUnitsMatrix(x),Se=Vp(Q,x.tileID.canonical,re,ne,this.transform,E.getProjection(),Me);let ge=null;if(re){const Ke=ar(Q,x.tileID.canonical,re,ne,this.transform,E.getProjection(),Me);ge=g.multiply([],this.transform.labelPlaneMatrix,Ke)}let De=null;ue&&x.latestFeatureIndex&&(De={unwrappedTileID:Z,dynamicFilter:ue,dynamicFilterNeedsFeature:se,featureIndex:x.latestFeatureIndex}),this.retainedQueryData[E.bucketInstanceId]=new b_(E.bucketInstanceId,P,E.sourceLayerIndex,E.index,x.tileID);const Ue={bucket:E,layout:O,posMatrix:Q,textLabelPlaneMatrix:Se,labelToScreenMatrix:ge,clippingData:De,scale:U,textPixelRatio:H,holdingForFade:x.holdingForFade(),collisionBoxArray:N,partiallyEvaluatedTextSize:g.evaluateSizeForZoom(E.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:g.evaluateSizeForZoom(E.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(E.sourceID)};if(M)for(const Ke of E.sortKeyRanges){const{sortKey:je,symbolInstanceStart:St,symbolInstanceEnd:Ne}=Ke;u.push({sortKey:je,symbolInstanceStart:St,symbolInstanceEnd:Ne,parameters:Ue})}else u.push({symbolInstanceStart:0,symbolInstanceEnd:E.symbolInstances.length,parameters:Ue})}attemptAnchorPlacement(u,p,x,M,E,P,O,N,U,H,Z,Q,oe,ie,le,re,ne,ue){const se=[Q.textOffset0,Q.textOffset1],Me=ko(u,x,M,se,E),Se=this.collisionIndex.placeCollisionBox(ie,E,p,da(Me.x,Me.y,P,O,this.transform.angle),Z,N,U,H.predicate);if(re){const ge=ie.getSymbolInstanceIconSize(ue,this.transform.zoom,Q.placedIconSymbolIndex);if(0===this.collisionIndex.placeCollisionBox(ie,ge,re,da(Me.x,Me.y,P,O,this.transform.angle),Z,N,U,H.predicate).box.length)return}if(Se.box.length>0){let ge;return this.prevPlacement&&this.prevPlacement.variableOffsets[Q.crossTileID]&&this.prevPlacement.placements[Q.crossTileID]&&this.prevPlacement.placements[Q.crossTileID].text&&(ge=this.prevPlacement.variableOffsets[Q.crossTileID].anchor),this.variableOffsets[Q.crossTileID]={textOffset:se,width:x,height:M,anchor:u,textScale:E,prevAnchor:ge},this.markUsedJustification(ie,u,Q,le),ie.allowVerticalPlacement&&(this.markUsedOrientation(ie,le,Q),this.placedOrientations[Q.crossTileID]=le),{shift:Me,placedGlyphBoxes:Se}}}placeLayerBucketPart(u,p,x,M){const{bucket:E,layout:P,posMatrix:O,textLabelPlaneMatrix:N,labelToScreenMatrix:U,clippingData:H,textPixelRatio:Z,holdingForFade:Q,collisionBoxArray:oe,partiallyEvaluatedTextSize:ie,partiallyEvaluatedIconSize:le,collisionGroup:re}=u.parameters,ne=P.get("text-optional"),ue=P.get("icon-optional"),se=P.get("text-allow-overlap"),Me=P.get("icon-allow-overlap"),Se="map"===P.get("text-rotation-alignment"),ge="map"===P.get("text-pitch-alignment"),De="none"!==P.get("icon-text-fit"),Ue="viewport-y"===P.get("symbol-z-order");this.transform.setProjection(E.projection);let Ke=se&&(Me||!E.hasIconData()||ue),je=Me&&(se||!E.hasTextData()||ne);!E.collisionArrays&&oe&&E.deserializeCollisionBoxes(oe),x&&M&&E.updateCollisionDebugBuffers(this.transform.zoom,oe);const St=(Ne,pt,ht)=>{if(H){const Rr={zoom:this.transform.zoom,pitch:this.transform.pitch};let Gr=null;if(H.dynamicFilterNeedsFeature){const Hi=this.retainedQueryData[E.bucketInstanceId];Gr=H.featureIndex.loadFeature({featureIndex:Ne.featureIndex,bucketIndex:Hi.bucketIndex,sourceLayerIndex:Hi.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,H.dynamicFilter)(Rr,Gr,this.retainedQueryData[E.bucketInstanceId].tileID.canonical,new g.pointGeometry(Ne.tileAnchorX,Ne.tileAnchorY),this.transform.calculateDistanceTileData(H.unwrappedTileID)))return this.placements[Ne.crossTileID]=new Ro(!1,!1,!1,!0),void(p[Ne.crossTileID]=!0)}if(p[Ne.crossTileID])return;if(Q)return void(this.placements[Ne.crossTileID]=new Ro(!1,!1,!1));let We=!1,Fe=!1,$t=!0,Ft=!1,kt=!1,Bt=null,un={box:null,offscreen:null,occluded:null},Nn={box:null,offscreen:null,occluded:null},Tn=null,mn=null,Lt=null,qn=0,di=0,ur=0;ht.textFeatureIndex?qn=ht.textFeatureIndex:Ne.useRuntimeCollisionCircles&&(qn=Ne.featureIndex),ht.verticalTextFeatureIndex&&(di=ht.verticalTextFeatureIndex);const dr=Rr=>{Rr.tileID=this.retainedQueryData[E.bucketInstanceId].tileID,(this.transform.elevation||Rr.elevation)&&(Rr.elevation=this.transform.elevation?this.transform.elevation.getAtTileOffset(this.retainedQueryData[E.bucketInstanceId].tileID,Rr.tileAnchorX,Rr.tileAnchorY):0)},Yi=ht.textBox;if(Yi){dr(Yi);const Rr=Hi=>{let jr=g.WritingMode.horizontal;if(E.allowVerticalPlacement&&!Hi&&this.prevPlacement){const mo=this.prevPlacement.placedOrientations[Ne.crossTileID];mo&&(this.placedOrientations[Ne.crossTileID]=mo,jr=mo,this.markUsedOrientation(E,jr,Ne))}return jr},Gr=(Hi,jr)=>{if(E.allowVerticalPlacement&&Ne.numVerticalGlyphVertices>0&&ht.verticalTextBox){for(const mo of E.writingModes)if(mo===g.WritingMode.vertical?(un=jr(),Nn=un):un=Hi(),un&&un.box&&un.box.length)break}else un=Hi()};if(P.get("text-variable-anchor")){let Hi=P.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[Ne.crossTileID]){const hi=this.prevPlacement.variableOffsets[Ne.crossTileID];Hi.indexOf(hi.anchor)>0&&(Hi=Hi.filter(go=>go!==hi.anchor),Hi.unshift(hi.anchor))}const jr=(hi,go,$u)=>{const Ha=E.getSymbolInstanceTextSize(ie,Ne,this.transform.zoom,pt),ns=(hi.x2-hi.x1)*Ha+2*hi.padding,sl=(hi.y2-hi.y1)*Ha+2*hi.padding,va=De&&!Me?go:null;va&&dr(va);let as={box:[],offscreen:!1,occluded:!1};const ol=se?2*Hi.length:Hi.length;for(let zl=0;zl<ol;++zl){const _o=this.attemptAnchorPlacement(Hi[zl%Hi.length],hi,ns,sl,Ha,Se,ge,Z,O,re,zl>=Hi.length,Ne,pt,E,$u,va,ie,le);if(_o&&(as=_o.placedGlyphBoxes,as&&as.box&&as.box.length)){We=!0,Bt=_o.shift;break}}return as};Gr(()=>jr(Yi,ht.iconBox,g.WritingMode.horizontal),()=>{const hi=ht.verticalTextBox;return hi&&dr(hi),E.allowVerticalPlacement&&!(un&&un.box&&un.box.length)&&Ne.numVerticalGlyphVertices>0&&hi?jr(hi,ht.verticalIconBox,g.WritingMode.vertical):{box:null,offscreen:null,occluded:null}}),un&&(We=un.box,$t=un.offscreen,Ft=un.occluded);const mo=Rr(un&&un.box);if(!We&&this.prevPlacement){const hi=this.prevPlacement.variableOffsets[Ne.crossTileID];hi&&(this.variableOffsets[Ne.crossTileID]=hi,this.markUsedJustification(E,hi.anchor,Ne,mo))}}else{const Hi=(jr,mo)=>{const hi=E.getSymbolInstanceTextSize(ie,Ne,this.transform.zoom,pt),go=this.collisionIndex.placeCollisionBox(E,hi,jr,new g.pointGeometry(0,0),se,Z,O,re.predicate);return go&&go.box&&go.box.length&&(this.markUsedOrientation(E,mo,Ne),this.placedOrientations[Ne.crossTileID]=mo),go};Gr(()=>Hi(Yi,g.WritingMode.horizontal),()=>{const jr=ht.verticalTextBox;return E.allowVerticalPlacement&&Ne.numVerticalGlyphVertices>0&&jr?(dr(jr),Hi(jr,g.WritingMode.vertical)):{box:null,offscreen:null,occluded:null}}),Rr(un&&un.box&&un.box.length)}}if(Tn=un,We=Tn&&Tn.box&&Tn.box.length>0,$t=Tn&&Tn.offscreen,Ft=Tn&&Tn.occluded,Ne.useRuntimeCollisionCircles){const Rr=E.text.placedSymbolArray.get(Ne.centerJustifiedTextSymbolIndex>=0?Ne.centerJustifiedTextSymbolIndex:Ne.verticalPlacedTextSymbolIndex),Gr=g.evaluateSizeForFeature(E.textSizeData,ie,Rr),Hi=P.get("text-padding");mn=this.collisionIndex.placeCollisionCircles(E,se,Rr,E.lineVertexArray,E.glyphOffsetArray,Gr,O,N,U,x,ge,re.predicate,Ne.collisionCircleDiameter*Gr/g.ONE_EM,Hi,this.retainedQueryData[E.bucketInstanceId].tileID),We=se||mn.circles.length>0&&!mn.collisionDetected,$t=$t&&mn.offscreen,Ft=mn.occluded}if(ht.iconFeatureIndex&&(ur=ht.iconFeatureIndex),ht.iconBox){const Rr=Gr=>{dr(Gr);const Hi=De&&Bt?da(Bt.x,Bt.y,Se,ge,this.transform.angle):new g.pointGeometry(0,0),jr=E.getSymbolInstanceIconSize(le,this.transform.zoom,Ne.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(E,jr,Gr,Hi,Me,Z,O,re.predicate)};Nn&&Nn.box&&Nn.box.length&&ht.verticalIconBox?(Lt=Rr(ht.verticalIconBox),Fe=Lt.box.length>0):(Lt=Rr(ht.iconBox),Fe=Lt.box.length>0),$t=$t&&Lt.offscreen,kt=Lt.occluded}const Rs=ne||0===Ne.numHorizontalGlyphVertices&&0===Ne.numVerticalGlyphVertices,Hs=ue||0===Ne.numIconVertices;if(Rs||Hs?Hs?Rs||(Fe=Fe&&We):We=Fe&&We:Fe=We=Fe&&We,We&&Tn&&Tn.box&&this.collisionIndex.insertCollisionBox(Tn.box,P.get("text-ignore-placement"),E.bucketInstanceId,Nn&&Nn.box&&di?di:qn,re.ID),Fe&&Lt&&this.collisionIndex.insertCollisionBox(Lt.box,P.get("icon-ignore-placement"),E.bucketInstanceId,ur,re.ID),mn&&(We&&this.collisionIndex.insertCollisionCircles(mn.circles,P.get("text-ignore-placement"),E.bucketInstanceId,qn,re.ID),x)){const Rr=E.bucketInstanceId;let Gr=this.collisionCircleArrays[Rr];void 0===Gr&&(Gr=this.collisionCircleArrays[Rr]=new ms);for(let Hi=0;Hi<mn.circles.length;Hi+=4)Gr.circles.push(mn.circles[Hi+0]),Gr.circles.push(mn.circles[Hi+1]),Gr.circles.push(mn.circles[Hi+2]),Gr.circles.push(mn.collisionDetected?1:0)}const Yo="globe"!==E.projection.name;Ke=Ke&&(Yo||!Ft),je=je&&(Yo||!kt),this.placements[Ne.crossTileID]=new Ro(We||Ke,Fe||je,$t||E.justReloaded),p[Ne.crossTileID]=!0};if(Ue){const Ne=E.getSortedSymbolIndexes(this.transform.angle);for(let pt=Ne.length-1;pt>=0;--pt){const ht=Ne[pt];St(E.symbolInstances.get(ht),ht,E.collisionArrays[ht])}}else for(let Ne=u.symbolInstanceStart;Ne<u.symbolInstanceEnd;Ne++)St(E.symbolInstances.get(Ne),Ne,E.collisionArrays[Ne]);if(x&&E.bucketInstanceId in this.collisionCircleArrays){const Ne=this.collisionCircleArrays[E.bucketInstanceId];g.invert(Ne.invProjMatrix,O),Ne.viewportMatrix=this.collisionIndex.getViewportMatrix()}E.justReloaded=!1}markUsedJustification(u,p,x,M){let E;E=M===g.WritingMode.vertical?x.verticalPlacedTextSymbolIndex:{left:x.leftJustifiedTextSymbolIndex,center:x.centerJustifiedTextSymbolIndex,right:x.rightJustifiedTextSymbolIndex}[g.getAnchorJustification(p)];const P=[x.leftJustifiedTextSymbolIndex,x.centerJustifiedTextSymbolIndex,x.rightJustifiedTextSymbolIndex,x.verticalPlacedTextSymbolIndex];for(const O of P)O>=0&&(u.text.placedSymbolArray.get(O).crossTileID=E>=0&&O!==E?0:x.crossTileID)}markUsedOrientation(u,p,x){const M=p===g.WritingMode.horizontal||p===g.WritingMode.horizontalOnly?p:0,E=p===g.WritingMode.vertical?p:0,P=[x.leftJustifiedTextSymbolIndex,x.centerJustifiedTextSymbolIndex,x.rightJustifiedTextSymbolIndex].filter(O=>-1!==O);for(const O of P)u.text.placedSymbolArray.get(O).placedOrientation=M;-1!==x.verticalPlacedTextSymbolIndex&&(u.text.placedSymbolArray.get(x.verticalPlacedTextSymbolIndex).placedOrientation=E)}commit(u){this.commitTime=u,this.zoomAtLastRecencyCheck=this.transform.zoom;const p=this.prevPlacement;let x=!1;this.prevZoomAdjustment=p?p.zoomAdjustment(this.transform.zoom):0;const M=p?p.symbolFadeChange(u):1,E=p?p.opacities:{},P=p?p.variableOffsets:{},O=p?p.placedOrientations:{};for(const N in this.placements){const U=this.placements[N],H=E[N];H?(this.opacities[N]=new Po(H,M,U.text,U.icon,null,U.clipped),x=x||U.text!==H.text.placed||U.icon!==H.icon.placed):(this.opacities[N]=new Po(null,M,U.text,U.icon,U.skipFade,U.clipped),x=x||U.text||U.icon)}for(const N in E){const U=E[N];if(!this.opacities[N]){const H=new Po(U,M,!1,!1);H.isHidden()||(this.opacities[N]=H,x=x||U.text.placed||U.icon.placed)}}for(const N in P)this.variableOffsets[N]||!this.opacities[N]||this.opacities[N].isHidden()||(this.variableOffsets[N]=P[N]);for(const N in O)this.placedOrientations[N]||!this.opacities[N]||this.opacities[N].isHidden()||(this.placedOrientations[N]=O[N]);x?this.lastPlacementChangeTime=u:"number"!=typeof this.lastPlacementChangeTime&&(this.lastPlacementChangeTime=p?p.lastPlacementChangeTime:u)}updateLayerOpacities(u,p){const x={};for(const M of p){const E=M.getBucket(u);E&&M.latestFeatureIndex&&u.id===E.layerIds[0]&&this.updateBucketOpacities(E,x,M.collisionBoxArray)}}updateBucketOpacities(u,p,x){u.hasTextData()&&u.text.opacityVertexArray.clear(),u.hasIconData()&&u.icon.opacityVertexArray.clear(),u.hasIconCollisionBoxData()&&u.iconCollisionBox.collisionVertexArray.clear(),u.hasTextCollisionBoxData()&&u.textCollisionBox.collisionVertexArray.clear();const M=u.layers[0].layout,E=!!u.layers[0].dynamicFilter(),P=new Po(null,0,!1,!1,!0),O=M.get("text-allow-overlap"),N=M.get("icon-allow-overlap"),U=M.get("text-variable-anchor"),H="map"===M.get("text-rotation-alignment"),Z="map"===M.get("text-pitch-alignment"),Q="none"!==M.get("icon-text-fit"),oe=new Po(null,0,O&&(N||!u.hasIconData()||M.get("icon-optional")),N&&(O||!u.hasTextData()||M.get("text-optional")),!0);!u.collisionArrays&&x&&(u.hasIconCollisionBoxData()||u.hasTextCollisionBoxData())&&u.deserializeCollisionBoxes(x);const ie=(re,ne,ue)=>{for(let se=0;se<ne/4;se++)re.opacityVertexArray.emplaceBack(ue)};let le=0;for(let re=0;re<u.symbolInstances.length;re++){const ne=u.symbolInstances.get(re),{numHorizontalGlyphVertices:ue,numVerticalGlyphVertices:se,crossTileID:Me}=ne;let Se=this.opacities[Me];p[Me]?Se=P:Se||(Se=oe,this.opacities[Me]=Se),p[Me]=!0;const ge=ue>0||se>0,De=ne.numIconVertices>0,Ue=this.placedOrientations[ne.crossTileID],Ke=Ue===g.WritingMode.vertical,je=Ue===g.WritingMode.horizontal||Ue===g.WritingMode.horizontalOnly;if(!ge&&!De||Se.isHidden()||le++,ge){const St=Bn(Se.text);ie(u.text,ue,Ke?nl:St),ie(u.text,se,je?nl:St);const Ne=Se.text.isHidden();[ne.rightJustifiedTextSymbolIndex,ne.centerJustifiedTextSymbolIndex,ne.leftJustifiedTextSymbolIndex].forEach(We=>{We>=0&&(u.text.placedSymbolArray.get(We).hidden=Ne||Ke?1:0)}),ne.verticalPlacedTextSymbolIndex>=0&&(u.text.placedSymbolArray.get(ne.verticalPlacedTextSymbolIndex).hidden=Ne||je?1:0);const pt=this.variableOffsets[ne.crossTileID];pt&&this.markUsedJustification(u,pt.anchor,ne,Ue);const ht=this.placedOrientations[ne.crossTileID];ht&&(this.markUsedJustification(u,"left",ne,ht),this.markUsedOrientation(u,ht,ne))}if(De){const St=Bn(Se.icon);ne.placedIconSymbolIndex>=0&&(ie(u.icon,ne.numIconVertices,Ke?nl:St),u.icon.placedSymbolArray.get(ne.placedIconSymbolIndex).hidden=Se.icon.isHidden()),ne.verticalPlacedIconSymbolIndex>=0&&(ie(u.icon,ne.numVerticalIconVertices,je?nl:St),u.icon.placedSymbolArray.get(ne.verticalPlacedIconSymbolIndex).hidden=Se.icon.isHidden())}if(u.hasIconCollisionBoxData()||u.hasTextCollisionBoxData()){const St=u.collisionArrays[re];if(St){let Ne=new g.pointGeometry(0,0),pt=!0;if(St.textBox||St.verticalTextBox){if(U){const We=this.variableOffsets[Me];We?(Ne=ko(We.anchor,We.width,We.height,We.textOffset,We.textScale),H&&Ne._rotate(Z?this.transform.angle:-this.transform.angle)):pt=!1}E&&(pt=!Se.clipped),St.textBox&&Sd(u.textCollisionBox.collisionVertexArray,Se.text.placed,!pt||Ke,Ne.x,Ne.y),St.verticalTextBox&&Sd(u.textCollisionBox.collisionVertexArray,Se.text.placed,!pt||je,Ne.x,Ne.y)}const ht=pt&&Boolean(!je&&St.verticalIconBox);St.iconBox&&Sd(u.iconCollisionBox.collisionVertexArray,Se.icon.placed,ht,Q?Ne.x:0,Q?Ne.y:0),St.verticalIconBox&&Sd(u.iconCollisionBox.collisionVertexArray,Se.icon.placed,!ht,Q?Ne.x:0,Q?Ne.y:0)}}}if(u.fullyClipped=0===le,u.sortFeatures(this.transform.angle),this.retainedQueryData[u.bucketInstanceId]&&(this.retainedQueryData[u.bucketInstanceId].featureSortOrder=u.featureSortOrder),u.hasTextData()&&u.text.opacityVertexBuffer&&u.text.opacityVertexBuffer.updateData(u.text.opacityVertexArray),u.hasIconData()&&u.icon.opacityVertexBuffer&&u.icon.opacityVertexBuffer.updateData(u.icon.opacityVertexArray),u.hasIconCollisionBoxData()&&u.iconCollisionBox.collisionVertexBuffer&&u.iconCollisionBox.collisionVertexBuffer.updateData(u.iconCollisionBox.collisionVertexArray),u.hasTextCollisionBoxData()&&u.textCollisionBox.collisionVertexBuffer&&u.textCollisionBox.collisionVertexBuffer.updateData(u.textCollisionBox.collisionVertexArray),u.bucketInstanceId in this.collisionCircleArrays){const re=this.collisionCircleArrays[u.bucketInstanceId];u.placementInvProjMatrix=re.invProjMatrix,u.placementViewportMatrix=re.viewportMatrix,u.collisionCircleArray=re.circles,delete this.collisionCircleArrays[u.bucketInstanceId]}}symbolFadeChange(u){return 0===this.fadeDuration?1:(u-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(u){return Math.max(0,(this.transform.zoom-u)/1.5)}hasTransitions(u){return this.stale||u-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(u,p){const x=this.zoomAtLastRecencyCheck===p?1-this.zoomAdjustment(p):1;return this.zoomAtLastRecencyCheck=p,this.commitTime+this.fadeDuration*x>u}setStale(){this.stale=!0}}function Sd(_,u,p,x,M){_.emplaceBack(u?1:0,p?1:0,x||0,M||0),_.emplaceBack(u?1:0,p?1:0,x||0,M||0),_.emplaceBack(u?1:0,p?1:0,x||0,M||0),_.emplaceBack(u?1:0,p?1:0,x||0,M||0)}const lr=Math.pow(2,25),Zi=Math.pow(2,24),C_=Math.pow(2,17),Hp=Math.pow(2,16),lo=Math.pow(2,9),Yt=Math.pow(2,8),S_=Math.pow(2,1);function Bn(_){if(0===_.opacity&&!_.placed)return 0;if(1===_.opacity&&_.placed)return 4294967295;const u=_.placed?1:0,p=Math.floor(127*_.opacity);return p*lr+u*Zi+p*C_+u*Hp+p*lo+u*Yt+p*S_+u}const nl=0;class Gp{constructor(u){this._sortAcrossTiles="viewport-y"!==u.layout.get("symbol-z-order")&&void 0!==u.layout.get("symbol-sort-key").constantOr(1),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(u,p,x,M,E){const P=this._bucketParts;for(;this._currentTileIndex<u.length;)if(p.getBucketParts(P,M,u[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,E())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,P.sort((O,N)=>O.sortKey-N.sortKey));this._currentPartIndex<P.length;){const O=P[this._currentPartIndex];if(p.placeLayerBucketPart(O,this._seenCrossTileIDs,x,0===O.symbolInstanceStart),this._currentPartIndex++,E())return!0}return!1}}class E_{constructor(u,p,x,M,E,P,O,N){this.placement=new M_(u,E,P,O,N),this._currentPlacementIndex=p.length-1,this._forceFullPlacement=x,this._showCollisionBoxes=M,this._done=!1}isDone(){return this._done}continuePlacement(u,p,x){const M=g.exported.now(),E=()=>{const P=g.exported.now()-M;return!this._forceFullPlacement&&P>2};for(;this._currentPlacementIndex>=0;){const P=p[u[this._currentPlacementIndex]],O=this.placement.collisionIndex.transform.zoom;if("symbol"===P.type&&(!P.minzoom||P.minzoom<=O)&&(!P.maxzoom||P.maxzoom>O)){if(this._inProgressLayer||(this._inProgressLayer=new Gp(P)),this._inProgressLayer.continuePlacement(x[P.source],this.placement,this._showCollisionBoxes,P,E))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(u){return this.placement.commit(u),this.placement}}const Em=512/g.EXTENT/2;class Ed{constructor(u,p,x){this.tileID=u,this.indexedSymbolInstances={},this.bucketInstanceId=x;for(let M=0;M<p.length;M++){const E=p.get(M),P=E.key;this.indexedSymbolInstances[P]||(this.indexedSymbolInstances[P]=[]),this.indexedSymbolInstances[P].push({crossTileID:E.crossTileID,coord:this.getScaledCoordinates(E,u)})}}getScaledCoordinates(u,p){const x=Em/Math.pow(2,p.canonical.z-this.tileID.canonical.z);return{x:Math.floor((p.canonical.x*g.EXTENT+u.tileAnchorX)*x),y:Math.floor((p.canonical.y*g.EXTENT+u.tileAnchorY)*x)}}findMatches(u,p,x){const M=this.tileID.canonical.z<p.canonical.z?1:Math.pow(2,this.tileID.canonical.z-p.canonical.z);for(let E=0;E<u.length;E++){const P=u.get(E);if(P.crossTileID)continue;const O=this.indexedSymbolInstances[P.key];if(!O)continue;const N=this.getScaledCoordinates(P,p);for(const U of O)if(Math.abs(U.coord.x-N.x)<=M&&Math.abs(U.coord.y-N.y)<=M&&!x[U.crossTileID]){x[U.crossTileID]=!0,P.crossTileID=U.crossTileID;break}}}}class T_{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Eh{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(u){const p=Math.round((u-this.lng)/360);if(0!==p)for(const x in this.indexes){const M=this.indexes[x],E={};for(const P in M){const O=M[P];O.tileID=O.tileID.unwrapTo(O.tileID.wrap+p),E[O.tileID.key]=O}this.indexes[x]=E}this.lng=u}addBucket(u,p,x){if(this.indexes[u.overscaledZ]&&this.indexes[u.overscaledZ][u.key]){if(this.indexes[u.overscaledZ][u.key].bucketInstanceId===p.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(u.overscaledZ,this.indexes[u.overscaledZ][u.key])}for(let E=0;E<p.symbolInstances.length;E++)p.symbolInstances.get(E).crossTileID=0;this.usedCrossTileIDs[u.overscaledZ]||(this.usedCrossTileIDs[u.overscaledZ]={});const M=this.usedCrossTileIDs[u.overscaledZ];for(const E in this.indexes){const P=this.indexes[E];if(Number(E)>u.overscaledZ)for(const O in P){const N=P[O];N.tileID.isChildOf(u)&&N.findMatches(p.symbolInstances,u,M)}else{const O=P[u.scaledTo(Number(E)).key];O&&O.findMatches(p.symbolInstances,u,M)}}for(let E=0;E<p.symbolInstances.length;E++){const P=p.symbolInstances.get(E);P.crossTileID||(P.crossTileID=x.generate(),M[P.crossTileID]=!0)}return void 0===this.indexes[u.overscaledZ]&&(this.indexes[u.overscaledZ]={}),this.indexes[u.overscaledZ][u.key]=new Ed(u,p.symbolInstances,p.bucketInstanceId),!0}removeBucketCrossTileIDs(u,p){for(const x in p.indexedSymbolInstances)for(const M of p.indexedSymbolInstances[x])delete this.usedCrossTileIDs[u][M.crossTileID]}removeStaleBuckets(u){let p=!1;for(const x in this.indexes){const M=this.indexes[x];for(const E in M)u[M[E].bucketInstanceId]||(this.removeBucketCrossTileIDs(x,M[E]),delete M[E],p=!0)}return p}}class tc{constructor(){this.layerIndexes={},this.crossTileIDs=new T_,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(u,p,x,M){let E=this.layerIndexes[u.id];void 0===E&&(E=this.layerIndexes[u.id]=new Eh);let P=!1;const O={};"globe"!==M.name&&E.handleWrapJump(x);for(const N of p){const U=N.getBucket(u);U&&u.id===U.layerIds[0]&&(U.bucketInstanceId||(U.bucketInstanceId=++this.maxBucketInstanceId),E.addBucket(N.tileID,U,this.crossTileIDs)&&(P=!0),O[U.bucketInstanceId]=!0)}return E.removeStaleBuckets(O)&&(P=!0),P}pruneUnusedLayers(u){const p={};u.forEach(x=>{p[x]=!0});for(const x in this.layerIndexes)p[x]||delete this.layerIndexes[x]}}const La=(_,u)=>g.emitValidationErrors(_,u&&u.filter(p=>"source.canvas"!==p.identifier)),jp=g.pick(Fn,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection"]),Hn=g.pick(Fn,["setCenter","setZoom","setBearing","setPitch"]),Th={version:8,layers:[],sources:{}},$p={fill:!0,line:!0,background:!0,hillshade:!0,raster:!0};class gs extends g.Evented{constructor(u,p={}){super(),this.map=u,this.dispatcher=new Ql(Vn(),this),this.imageManager=new xu,this.imageManager.setEventedParent(this),this.glyphManager=new g.GlyphManager(u._requestManager,p.localFontFamily?g.LocalGlyphMode.all:p.localIdeographFontFamily?g.LocalGlyphMode.ideographs:g.LocalGlyphMode.none,p.localFontFamily||p.localIdeographFontFamily),this.crossTileSymbolIndex=new tc,this._layers={},this._num3DLayers=0,this._numSymbolLayers=0,this._numCircleLayers=0,this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this.zoomHistory=new g.ZoomHistory,this._loaded=!1,this._availableImages=[],this._order=[],this._drapedFirstOrder=[],this._markersNeedUpdate=!1,this._resetUpdates(),this.dispatcher.broadcast("setReferrer",g.getReferrer());const x=this;this._rtlTextPluginCallback=gs.registerForPluginStateChange(M=>{x.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:M.pluginStatus,pluginURL:M.pluginURL},(E,P)=>{if(g.triggerPluginCompletionEvent(E),P&&P.every(O=>O))for(const O in x._sourceCaches){const N=x._sourceCaches[O],U=N.getSource().type;"vector"!==U&&"geojson"!==U||N.reload()}})}),this.on("data",M=>{if("source"!==M.dataType||"metadata"!==M.sourceDataType)return;const E=this.getSource(M.sourceId);if(E&&E.vectorLayerIds)for(const P in this._layers){const O=this._layers[P];O.source===E.id&&this._validateLayer(O)}})}loadURL(u,p={}){this.fire(new g.Event("dataloading",{dataType:"style"}));const x="boolean"==typeof p.validate?p.validate:!g.isMapboxURL(u);u=this.map._requestManager.normalizeStyleURL(u,p.accessToken);const M=this.map._requestManager.transformRequest(u,g.ResourceType.Style);this._request=g.getJSON(M,(E,P)=>{this._request=null,E?this.fire(new g.ErrorEvent(E)):P&&this._load(P,x)})}loadJSON(u,p={}){this.fire(new g.Event("dataloading",{dataType:"style"})),this._request=g.exported.frame(()=>{this._request=null,this._load(u,!1!==p.validate)})}loadEmpty(){this.fire(new g.Event("dataloading",{dataType:"style"})),this._load(Th,!1)}_updateLayerCount(u,p){const x=p?1:-1;u.is3D()&&(this._num3DLayers+=x),"circle"===u.type&&(this._numCircleLayers+=x),"symbol"===u.type&&(this._numSymbolLayers+=x)}_load(u,p){if(p&&La(this,g.validateStyle(u)))return;this._loaded=!0,this.stylesheet=g.clone$1(u),this._updateMapProjection();for(const M in u.sources)this.addSource(M,u.sources[M],{validate:!1});this._changed=!1,u.sprite?this._loadSprite(u.sprite):(this.imageManager.setLoaded(!0),this.dispatcher.broadcast("spriteLoaded",!0)),this.glyphManager.setURL(u.glyphs);const x=Ui(this.stylesheet.layers);this._order=x.map(M=>M.id),this._layers={},this._serializedLayers={};for(let M of x)M=g.createStyleLayer(M),M.setEventedParent(this,{layer:{id:M.id}}),this._layers[M.id]=M,this._serializedLayers[M.id]=M.serialize(),this._updateLayerCount(M,!0);this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new wu(this.stylesheet.light),this.stylesheet.terrain&&!this.terrainSetForDrapingOnly()&&this._createTerrain(this.stylesheet.terrain,1),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this._updateDrapeFirstLayers(),this.fire(new g.Event("data",{dataType:"style"})),this.fire(new g.Event("style.load"))}terrainSetForDrapingOnly(){return!!this.terrain&&0===this.terrain.drapeRenderMode}setProjection(u){u?this.stylesheet.projection=u:delete this.stylesheet.projection,this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?this.getTerrain()||this.stylesheet.terrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null))}_updateMapProjection(){this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.stylesheet.projection)}_loadSprite(u){this._spriteRequest=function(p,x,M){let E,P,O;const N=g.exported.devicePixelRatio>1?"@2x":"";let U=g.getJSON(x.transformRequest(x.normalizeSpriteURL(p,N,".json"),g.ResourceType.SpriteJSON),(Q,oe)=>{U=null,O||(O=Q,E=oe,Z())}),H=g.getImage(x.transformRequest(x.normalizeSpriteURL(p,N,".png"),g.ResourceType.SpriteImage),(Q,oe)=>{H=null,O||(O=Q,P=oe,Z())});function Z(){if(O)M(O);else if(E&&P){const Q=g.exported.getImageData(P),oe={};for(const ie in E){const{width:le,height:re,x:ne,y:ue,sdf:se,pixelRatio:Me,stretchX:Se,stretchY:ge,content:De}=E[ie],Ue=new g.RGBAImage({width:le,height:re});g.RGBAImage.copy(Q,Ue,{x:ne,y:ue},{x:0,y:0},{width:le,height:re}),oe[ie]={data:Ue,pixelRatio:Me,sdf:se,stretchX:Se,stretchY:ge,content:De}}M(null,oe)}}return{cancel(){U&&(U.cancel(),U=null),H&&(H.cancel(),H=null)}}}(u,this.map._requestManager,(p,x)=>{if(this._spriteRequest=null,p)this.fire(new g.ErrorEvent(p));else if(x)for(const M in x)this.imageManager.addImage(M,x[M]);this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),this.dispatcher.broadcast("setImages",this._availableImages),this.dispatcher.broadcast("spriteLoaded",!0),this.fire(new g.Event("data",{dataType:"style"}))})}_validateLayer(u){const p=this.getSource(u.source);if(!p)return;const x=u.sourceLayer;x&&("geojson"===p.type||p.vectorLayerIds&&-1===p.vectorLayerIds.indexOf(x))&&this.fire(new g.ErrorEvent(new Error(`Source layer "${x}" does not exist on source "${p.id}" as specified by style layer "${u.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const u in this._sourceCaches)if(!this._sourceCaches[u].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeLayers(u){const p=[];for(const x of u){const M=this._layers[x];"custom"!==M.type&&p.push(M.serialize())}return p}hasTransitions(){if(this.light&&this.light.hasTransition()||this.fog&&this.fog.hasTransition())return!0;for(const u in this._sourceCaches)if(this._sourceCaches[u].hasTransition())return!0;for(const u in this._layers)if(this._layers[u].hasTransition())return!0;return!1}get order(){return this.map._optimizeForTerrain&&this.terrain?this._drapedFirstOrder:this._order}isLayerDraped(u){return!!this.terrain&&$p[u.type]}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}update(u){if(!this._loaded)return;const p=this._changed;if(this._changed){const M=Object.keys(this._updatedLayers),E=Object.keys(this._removedLayers);(M.length||E.length)&&this._updateWorkerLayers(M,E);for(const P in this._updatedSources){const O=this._updatedSources[P];"reload"===O?this._reloadSource(P):"clear"===O&&this._clearSource(P)}this._updateTilesForChangedImages();for(const P in this._updatedPaintProps)this._layers[P].updateTransitions(u);this.light.updateTransitions(u),this.fog&&this.fog.updateTransitions(u),this._resetUpdates()}const x={};for(const M in this._sourceCaches){const E=this._sourceCaches[M];x[M]=E.used,E.used=!1}for(const M of this._order){const E=this._layers[M];if(E.recalculate(u,this._availableImages),!E.isHidden(u.zoom)){const O=this._getLayerSourceCache(E);O&&(O.used=!0)}const P=this.map.painter;if(P){const O=E.getProgramIds();if(!O)continue;const N=E.getProgramConfiguration(u.zoom);for(const U of O)P.useProgram(U,N)}}for(const M in x){const E=this._sourceCaches[M];x[M]!==E.used&&E.getSource().fire(new g.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:E.getSource().id}))}this.light.recalculate(u),this.terrain&&this.terrain.recalculate(u),this.fog&&this.fog.recalculate(u),this.z=u.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),p&&this.fire(new g.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){const u=Object.keys(this._changedImages);if(u.length){for(const p in this._sourceCaches)this._sourceCaches[p].reloadTilesForDependencies(["icons","patterns"],u);this._changedImages={}}}_updateWorkerLayers(u,p){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(u),removedIds:p})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}}setState(u){if(this._checkLoaded(),La(this,g.validateStyle(u)))return!1;(u=g.clone$1(u)).layers=Ui(u.layers);const p=function(M,E){if(!M)return[{command:Fn.setStyle,args:[E]}];let P=[];try{if(!lt(M.version,E.version))return[{command:Fn.setStyle,args:[E]}];lt(M.center,E.center)||P.push({command:Fn.setCenter,args:[E.center]}),lt(M.zoom,E.zoom)||P.push({command:Fn.setZoom,args:[E.zoom]}),lt(M.bearing,E.bearing)||P.push({command:Fn.setBearing,args:[E.bearing]}),lt(M.pitch,E.pitch)||P.push({command:Fn.setPitch,args:[E.pitch]}),lt(M.sprite,E.sprite)||P.push({command:Fn.setSprite,args:[E.sprite]}),lt(M.glyphs,E.glyphs)||P.push({command:Fn.setGlyphs,args:[E.glyphs]}),lt(M.transition,E.transition)||P.push({command:Fn.setTransition,args:[E.transition]}),lt(M.light,E.light)||P.push({command:Fn.setLight,args:[E.light]}),lt(M.fog,E.fog)||P.push({command:Fn.setFog,args:[E.fog]}),lt(M.projection,E.projection)||P.push({command:Fn.setProjection,args:[E.projection]});const O={},N=[];!function(Z,Q,oe,ie){let le;for(le in Q=Q||{},Z=Z||{})Z.hasOwnProperty(le)&&(Q.hasOwnProperty(le)||pr(le,oe,ie));for(le in Q)Q.hasOwnProperty(le)&&(Z.hasOwnProperty(le)?lt(Z[le],Q[le])||("geojson"===Z[le].type&&"geojson"===Q[le].type&&ec(Z,Q,le)?oe.push({command:Fn.setGeoJSONSourceData,args:[le,Q[le].data]}):zc(le,Q,oe,ie)):or(le,Q,oe))}(M.sources,E.sources,N,O);const U=[];M.layers&&M.layers.forEach(Z=>{Z.source&&O[Z.source]?P.push({command:Fn.removeLayer,args:[Z.id]}):U.push(Z)});let H=M.terrain;H&&O[H.source]&&(P.push({command:Fn.setTerrain,args:[void 0]}),H=void 0),P=P.concat(N),lt(H,E.terrain)||P.push({command:Fn.setTerrain,args:[E.terrain]}),function(Z,Q,oe){Q=Q||[];const ie=(Z=Z||[]).map(Ll),le=Q.map(Ll),re=Z.reduce(ps,{}),ne=Q.reduce(ps,{}),ue=ie.slice(),se=Object.create(null);let Me,Se,ge,De,Ue,Ke,je;for(Me=0,Se=0;Me<ie.length;Me++)ge=ie[Me],ne.hasOwnProperty(ge)?Se++:(oe.push({command:Fn.removeLayer,args:[ge]}),ue.splice(ue.indexOf(ge,Se),1));for(Me=0,Se=0;Me<le.length;Me++)ge=le[le.length-1-Me],ue[ue.length-1-Me]!==ge&&(re.hasOwnProperty(ge)?(oe.push({command:Fn.removeLayer,args:[ge]}),ue.splice(ue.lastIndexOf(ge,ue.length-Se),1)):Se++,Ke=ue[ue.length-Me],oe.push({command:Fn.addLayer,args:[ne[ge],Ke]}),ue.splice(ue.length-Me,0,ge),se[ge]=!0);for(Me=0;Me<le.length;Me++)if(ge=le[Me],De=re[ge],Ue=ne[ge],!se[ge]&&!lt(De,Ue))if(lt(De.source,Ue.source)&&lt(De["source-layer"],Ue["source-layer"])&&lt(De.type,Ue.type)){for(je in rt(De.layout,Ue.layout,oe,ge,null,Fn.setLayoutProperty),rt(De.paint,Ue.paint,oe,ge,null,Fn.setPaintProperty),lt(De.filter,Ue.filter)||oe.push({command:Fn.setFilter,args:[ge,Ue.filter]}),lt(De.minzoom,Ue.minzoom)&&lt(De.maxzoom,Ue.maxzoom)||oe.push({command:Fn.setLayerZoomRange,args:[ge,Ue.minzoom,Ue.maxzoom]}),De)De.hasOwnProperty(je)&&"layout"!==je&&"paint"!==je&&"filter"!==je&&"metadata"!==je&&"minzoom"!==je&&"maxzoom"!==je&&(0===je.indexOf("paint.")?rt(De[je],Ue[je],oe,ge,je.slice(6),Fn.setPaintProperty):lt(De[je],Ue[je])||oe.push({command:Fn.setLayerProperty,args:[ge,je,Ue[je]]}));for(je in Ue)Ue.hasOwnProperty(je)&&!De.hasOwnProperty(je)&&"layout"!==je&&"paint"!==je&&"filter"!==je&&"metadata"!==je&&"minzoom"!==je&&"maxzoom"!==je&&(0===je.indexOf("paint.")?rt(De[je],Ue[je],oe,ge,je.slice(6),Fn.setPaintProperty):lt(De[je],Ue[je])||oe.push({command:Fn.setLayerProperty,args:[ge,je,Ue[je]]}))}else oe.push({command:Fn.removeLayer,args:[ge]}),Ke=ue[ue.lastIndexOf(ge)+1],oe.push({command:Fn.addLayer,args:[Ue,Ke]})}(U,E.layers,P)}catch(O){console.warn("Unable to compute style diff:",O),P=[{command:Fn.setStyle,args:[E]}]}return P}(this.serialize(),u).filter(M=>!(M.command in Hn));if(0===p.length)return!1;const x=p.filter(M=>!(M.command in jp));if(x.length>0)throw new Error(`Unimplemented: ${x.map(M=>M.command).join(", ")}.`);return p.forEach(M=>{"setTransition"!==M.command&&"setProjection"!==M.command&&this[M.command].apply(this,M.args)}),this.stylesheet=u,this._updateMapProjection(),!0}addImage(u,p){return this.getImage(u)?this.fire(new g.ErrorEvent(new Error("An image with this name already exists."))):(this.imageManager.addImage(u,p),this._afterImageUpdated(u),this)}updateImage(u,p){this.imageManager.updateImage(u,p)}getImage(u){return this.imageManager.getImage(u)}removeImage(u){return this.getImage(u)?(this.imageManager.removeImage(u),this._afterImageUpdated(u),this):this.fire(new g.ErrorEvent(new Error("No image with this name exists.")))}_afterImageUpdated(u){this._availableImages=this.imageManager.listImages(),this._changedImages[u]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new g.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addSource(u,p,x={}){if(this._checkLoaded(),void 0!==this.getSource(u))throw new Error("There is already a source with this ID");if(!p.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(p).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(p.type)>=0&&this._validate(g.validateSource,`sources.${u}`,p,null,x))return;this.map&&this.map._collectResourceTiming&&(p.collectResourceTiming=!0);const M=Be(u,p,this.dispatcher,this);M.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(u),source:M.serialize(),sourceId:u}));const E=P=>{const O=(P?"symbol:":"other:")+u,N=this._sourceCaches[O]=new g.SourceCache(O,M,P);(P?this._symbolSourceCaches:this._otherSourceCaches)[u]=N,N.style=this,N.onAdd(this.map)};E(!1),"vector"!==p.type&&"geojson"!==p.type||E(!0),M.onAdd&&M.onAdd(this.map),this._changed=!0}removeSource(u){this._checkLoaded();const p=this.getSource(u);if(!p)throw new Error("There is no source with this ID");for(const M in this._layers)if(this._layers[M].source===u)return this.fire(new g.ErrorEvent(new Error(`Source "${u}" cannot be removed while layer "${M}" is using it.`)));if(this.terrain&&this.terrain.get().source===u)return this.fire(new g.ErrorEvent(new Error(`Source "${u}" cannot be removed while terrain is using it.`)));const x=this._getSourceCaches(u);for(const M of x)delete this._sourceCaches[M.id],delete this._updatedSources[M.id],M.fire(new g.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:M.getSource().id})),M.setEventedParent(null),M.clearTiles();return delete this._otherSourceCaches[u],delete this._symbolSourceCaches[u],p.setEventedParent(null),p.onRemove&&p.onRemove(this.map),this._changed=!0,this}setGeoJSONSourceData(u,p){this._checkLoaded(),this.getSource(u).setData(p),this._changed=!0}getSource(u){const p=this._getSourceCache(u);return p&&p.getSource()}_getSources(){const u=[];for(const p in this._otherSourceCaches){const x=this._getSourceCache(p);x&&u.push(x.getSource())}return u}addLayer(u,p,x={}){this._checkLoaded();const M=u.id;if(this.getLayer(M))return void this.fire(new g.ErrorEvent(new Error(`Layer with id "${M}" already exists on this map`)));let E;if("custom"===u.type){if(La(this,g.validateCustomStyleLayer(u)))return;E=g.createStyleLayer(u)}else{if("object"==typeof u.source&&(this.addSource(M,u.source),u=g.clone$1(u),u=g.extend(u,{source:M})),this._validate(g.validateLayer,`layers.${M}`,u,{arrayIndex:-1},x))return;E=g.createStyleLayer(u),this._validateLayer(E),E.setEventedParent(this,{layer:{id:M}}),this._serializedLayers[E.id]=E.serialize(),this._updateLayerCount(E,!0)}const P=p?this._order.indexOf(p):this._order.length;if(p&&-1===P)return void this.fire(new g.ErrorEvent(new Error(`Layer with id "${p}" does not exist on this map.`)));this._order.splice(P,0,M),this._layerOrderChanged=!0,this._layers[M]=E;const O=this._getLayerSourceCache(E);if(this._removedLayers[M]&&E.source&&O&&"custom"!==E.type){const N=this._removedLayers[M];delete this._removedLayers[M],N.type!==E.type?this._updatedSources[E.source]="clear":(this._updatedSources[E.source]="reload",O.pause())}this._updateLayer(E),E.onAdd&&E.onAdd(this.map),this._updateDrapeFirstLayers()}moveLayer(u,p){if(this._checkLoaded(),this._changed=!0,!this._layers[u])return void this.fire(new g.ErrorEvent(new Error(`The layer '${u}' does not exist in the map's style and cannot be moved.`)));if(u===p)return;const x=this._order.indexOf(u);this._order.splice(x,1);const M=p?this._order.indexOf(p):this._order.length;p&&-1===M?this.fire(new g.ErrorEvent(new Error(`Layer with id "${p}" does not exist on this map.`))):(this._order.splice(M,0,u),this._layerOrderChanged=!0,this._updateDrapeFirstLayers())}removeLayer(u){this._checkLoaded();const p=this._layers[u];if(!p)return void this.fire(new g.ErrorEvent(new Error(`The layer '${u}' does not exist in the map's style and cannot be removed.`)));p.setEventedParent(null),this._updateLayerCount(p,!1);const x=this._order.indexOf(u);this._order.splice(x,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[u]=p,delete this._layers[u],delete this._serializedLayers[u],delete this._updatedLayers[u],delete this._updatedPaintProps[u],p.onRemove&&p.onRemove(this.map),this._updateDrapeFirstLayers()}getLayer(u){return this._layers[u]}hasLayer(u){return u in this._layers}hasLayerType(u){for(const p in this._layers)if(this._layers[p].type===u)return!0;return!1}setLayerZoomRange(u,p,x){this._checkLoaded();const M=this.getLayer(u);M?M.minzoom===p&&M.maxzoom===x||(null!=p&&(M.minzoom=p),null!=x&&(M.maxzoom=x),this._updateLayer(M)):this.fire(new g.ErrorEvent(new Error(`The layer '${u}' does not exist in the map's style and cannot have zoom extent.`)))}setFilter(u,p,x={}){this._checkLoaded();const M=this.getLayer(u);if(M){if(!lt(M.filter,p))return null==p?(M.filter=void 0,void this._updateLayer(M)):void(this._validate(g.validateFilter,`layers.${M.id}.filter`,p,{layerType:M.type},x)||(M.filter=g.clone$1(p),this._updateLayer(M)))}else this.fire(new g.ErrorEvent(new Error(`The layer '${u}' does not exist in the map's style and cannot be filtered.`)))}getFilter(u){const p=this.getLayer(u);return p&&g.clone$1(p.filter)}setLayoutProperty(u,p,x,M={}){this._checkLoaded();const E=this.getLayer(u);E?lt(E.getLayoutProperty(p),x)||(E.setLayoutProperty(p,x,M),this._updateLayer(E)):this.fire(new g.ErrorEvent(new Error(`The layer '${u}' does not exist in the map's style and cannot be styled.`)))}getLayoutProperty(u,p){const x=this.getLayer(u);if(x)return x.getLayoutProperty(p);this.fire(new g.ErrorEvent(new Error(`The layer '${u}' does not exist in the map's style.`)))}setPaintProperty(u,p,x,M={}){this._checkLoaded();const E=this.getLayer(u);E?lt(E.getPaintProperty(p),x)||(E.setPaintProperty(p,x,M)&&this._updateLayer(E),this._changed=!0,this._updatedPaintProps[u]=!0):this.fire(new g.ErrorEvent(new Error(`The layer '${u}' does not exist in the map's style and cannot be styled.`)))}getPaintProperty(u,p){const x=this.getLayer(u);return x&&x.getPaintProperty(p)}setFeatureState(u,p){this._checkLoaded();const x=u.source,M=u.sourceLayer,E=this.getSource(x);if(!E)return void this.fire(new g.ErrorEvent(new Error(`The source '${x}' does not exist in the map's style.`)));const P=E.type;if("geojson"===P&&M)return void this.fire(new g.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if("vector"===P&&!M)return void this.fire(new g.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));void 0===u.id&&this.fire(new g.ErrorEvent(new Error("The feature id parameter must be provided.")));const O=this._getSourceCaches(x);for(const N of O)N.setFeatureState(M,u.id,p)}removeFeatureState(u,p){this._checkLoaded();const x=u.source,M=this.getSource(x);if(!M)return void this.fire(new g.ErrorEvent(new Error(`The source '${x}' does not exist in the map's style.`)));const E=M.type,P="vector"===E?u.sourceLayer:void 0;if("vector"===E&&!P)return void this.fire(new g.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));if(p&&"string"!=typeof u.id&&"number"!=typeof u.id)return void this.fire(new g.ErrorEvent(new Error("A feature id is required to remove its specific state property.")));const O=this._getSourceCaches(x);for(const N of O)N.removeFeatureState(P,u.id,p)}getFeatureState(u){this._checkLoaded();const p=u.source,x=u.sourceLayer,M=this.getSource(p);if(M){if("vector"!==M.type||x)return void 0===u.id&&this.fire(new g.ErrorEvent(new Error("The feature id parameter must be provided."))),this._getSourceCaches(p)[0].getFeatureState(x,u.id);this.fire(new g.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new g.ErrorEvent(new Error(`The source '${p}' does not exist in the map's style.`)))}getTransition(){return g.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){const u={};for(const p in this._sourceCaches){const x=this._sourceCaches[p].getSource();u[x.id]||(u[x.id]=x.serialize())}return g.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,terrain:this.getTerrain()||void 0,fog:this.stylesheet.fog,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:u,layers:this._serializeLayers(this._order)},p=>void 0!==p)}_updateLayer(u){this._updatedLayers[u.id]=!0;const p=this._getLayerSourceCache(u);u.source&&!this._updatedSources[u.source]&&p&&"raster"!==p.getSource().type&&(this._updatedSources[u.source]="reload",p.pause()),this._changed=!0,u.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(u){const p=P=>"fill-extrusion"===this._layers[P].type,x={},M=[];for(let P=this._order.length-1;P>=0;P--){const O=this._order[P];if(p(O)){x[O]=P;for(const N of u){const U=N[O];if(U)for(const H of U)M.push(H)}}}M.sort((P,O)=>O.intersectionZ-P.intersectionZ);const E=[];for(let P=this._order.length-1;P>=0;P--){const O=this._order[P];if(p(O))for(let N=M.length-1;N>=0;N--){const U=M[N].feature;if(x[U.layer.id]<P)break;E.push(U),M.pop()}else for(const N of u){const U=N[O];if(U)for(const H of U)E.push(H.feature)}}return E}queryRenderedFeatures(u,p,x){p&&p.filter&&this._validate(g.validateFilter,"queryRenderedFeatures.filter",p.filter,null,p);const M={};if(p&&p.layers){if(!Array.isArray(p.layers))return this.fire(new g.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(const N of p.layers){const U=this._layers[N];if(!U)return this.fire(new g.ErrorEvent(new Error(`The layer '${N}' does not exist in the map's style and cannot be queried for features.`))),[];M[U.source]=!0}}const E=[];p.availableImages=this._availableImages;const P=p&&p.layers?p.layers.some(N=>{const U=this.getLayer(N);return U&&U.is3D()}):this.has3DLayers(),O=si.createFromScreenPoints(u,x);for(const N in this._sourceCaches){const U=this._sourceCaches[N].getSource().id;p.layers&&!M[U]||E.push(ze(this._sourceCaches[N],this._layers,this._serializedLayers,O,p,x,P,!!this.map._showQueryGeometry))}return this.placement&&E.push(function(N,U,H,Z,Q,oe,ie){const le={},re=oe.queryRenderedSymbols(Z),ne=[];for(const ue of Object.keys(re).map(Number))ne.push(ie[ue]);ne.sort(Gt);for(const ue of ne){const se=ue.featureIndex.lookupSymbolFeatures(re[ue.bucketInstanceId],U,ue.bucketIndex,ue.sourceLayerIndex,Q.filter,Q.layers,Q.availableImages,N);for(const Me in se){const Se=le[Me]=le[Me]||[],ge=se[Me];ge.sort((De,Ue)=>{const Ke=ue.featureSortOrder;if(Ke){const je=Ke.indexOf(De.featureIndex);return Ke.indexOf(Ue.featureIndex)-je}return Ue.featureIndex-De.featureIndex});for(const De of ge)Se.push(De)}}for(const ue in le)le[ue].forEach(se=>{const Me=se.feature,Se=H(N[ue]).getFeatureState(Me.layer["source-layer"],Me.id);Me.source=Me.layer.source,Me.layer["source-layer"]&&(Me.sourceLayer=Me.layer["source-layer"]),Me.state=Se});return le}(this._layers,this._serializedLayers,this._getLayerSourceCache.bind(this),O.screenGeometry,p,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(E)}querySourceFeatures(u,p){p&&p.filter&&this._validate(g.validateFilter,"querySourceFeatures.filter",p.filter,null,p);const x=this._getSourceCaches(u);let M=[];for(const E of x)M=M.concat(_t(E,p));return M}addSourceType(u,p,x){return gs.getSourceType(u)?x(new Error(`A source type called "${u}" already exists.`)):(gs.setSourceType(u,p),p.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:u,url:p.workerSourceURL},x):x(null,null))}getLight(){return this.light.getLight()}setLight(u,p={}){this._checkLoaded();const x=this.light.getLight();let M=!1;for(const P in u)if(!lt(u[P],x[P])){M=!0;break}if(!M)return;const E=this._setTransitionParameters({duration:300,delay:0});this.light.setLight(u,p),this.light.updateTransitions(E)}getTerrain(){return this.terrain&&1===this.terrain.drapeRenderMode?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}setTerrain(u,p=1){if(this._checkLoaded(),!u)return delete this.terrain,delete this.stylesheet.terrain,this.dispatcher.broadcast("enableTerrain",!1),this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);if(1===p){if("object"==typeof u.source){const x="terrain-dem-src";this.addSource(x,u.source),u=g.clone$1(u),u=g.extend(u,{source:x})}if(this._validate(g.validateTerrain,"terrain",u))return}if(!this.terrain||this.terrain&&p!==this.terrain.drapeRenderMode)this._createTerrain(u,p);else{const x=this.terrain,M=x.get();for(const E of Object.keys(g.spec.terrain))!u.hasOwnProperty(E)&&g.spec.terrain[E].default&&(u[E]=g.spec.terrain[E].default);for(const E in u)if(!lt(u[E],M[E])){x.set(u),this.stylesheet.terrain=u;const P=this._setTransitionParameters({duration:0});x.updateTransitions(P);break}}this._updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(u){const p=this.fog=new mh(u,this.map.transform);this.stylesheet.fog=u;const x=this._setTransitionParameters({duration:0});p.updateTransitions(x)}_updateMarkersOpacity(){0!==this.map._markers.length&&this.map._requestDomTask(()=>{for(const u of this.map._markers)u._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(u){if(this._checkLoaded(),!u)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const p=this.fog,x=p.get();0===Object.keys(u).length&&p.set(u);for(const M in u)if(!lt(u[M],x[M])){p.set(u),this.stylesheet.fog=u;const E=this._setTransitionParameters({duration:0});p.updateTransitions(E);break}}else this._createFog(u);this._markersNeedUpdate=!0}_setTransitionParameters(u){return{now:g.exported.now(),transition:g.extend(u,this.stylesheet.transition)}}_updateDrapeFirstLayers(){if(!this.map._optimizeForTerrain||!this.terrain)return;const u=this._order.filter(x=>this.isLayerDraped(this._layers[x])),p=this._order.filter(x=>!this.isLayerDraped(this._layers[x]));this._drapedFirstOrder=[],this._drapedFirstOrder.push(...u),this._drapedFirstOrder.push(...p)}_createTerrain(u,p){const x=this.terrain=new Wo(u,p);this.stylesheet.terrain=u,this.dispatcher.broadcast("enableTerrain",!this.terrainSetForDrapingOnly()),this._force3DLayerUpdate();const M=this._setTransitionParameters({duration:0});x.updateTransitions(M)}_force3DLayerUpdate(){for(const u in this._layers){const p=this._layers[u];"fill-extrusion"===p.type&&this._updateLayer(p)}}_forceSymbolLayerUpdate(){for(const u in this._layers){const p=this._layers[u];"symbol"===p.type&&this._updateLayer(p)}}_validate(u,p,x,M,E={}){return(!E||!1!==E.validate)&&La(this,u.call(g.validateStyle,g.extend({key:p,style:this.serialize(),value:x,styleSpec:g.spec},M)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),g.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(const u in this._layers)this._layers[u].setEventedParent(null);for(const u in this._sourceCaches)this._sourceCaches[u].clearTiles(),this._sourceCaches[u].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()}_clearSource(u){const p=this._getSourceCaches(u);for(const x of p)x.clearTiles()}_reloadSource(u){const p=this._getSourceCaches(u);for(const x of p)x.resume(),x.reload()}_reloadSources(){for(const u of this._getSources())u.reload&&u.reload()}_updateSources(u){for(const p in this._sourceCaches)this._sourceCaches[p].update(u)}_generateCollisionBoxes(){for(const u in this._sourceCaches){const p=this._sourceCaches[u];p.resume(),p.reload()}}_updatePlacement(u,p,x,M,E=!1){let P=!1,O=!1;const N={};for(const U of this._order){const H=this._layers[U];if("symbol"!==H.type)continue;if(!N[H.source]){const Q=this._getLayerSourceCache(H);if(!Q)continue;N[H.source]=Q.getRenderableIds(!0).map(oe=>Q.getTileByID(oe)).sort((oe,ie)=>ie.tileID.overscaledZ-oe.tileID.overscaledZ||(oe.tileID.isLessThan(ie.tileID)?-1:1))}const Z=this.crossTileSymbolIndex.addLayer(H,N[H.source],u.center.lng,u.projection);P=P||Z}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),E=E||this._layerOrderChanged||0===x,this._layerOrderChanged&&this.fire(new g.Event("neworder")),(E||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(g.exported.now(),u.zoom))&&(this.pauseablePlacement=new E_(u,this._order,E,p,x,M,this.placement,this.fog&&u.projection.supportsFog?this.fog.state:null),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,N),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(g.exported.now()),O=!0),P&&this.pauseablePlacement.placement.setStale()),O||P)for(const U of this._order){const H=this._layers[U];"symbol"===H.type&&this.placement.updateLayerOpacities(H,N[H.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(g.exported.now())}_releaseSymbolFadeTiles(){for(const u in this._sourceCaches)this._sourceCaches[u].releaseSymbolFadeTiles()}getImages(u,p,x){this.imageManager.getImages(p.icons,x),this._updateTilesForChangedImages();const M=E=>{E&&E.setDependencies(p.tileID.key,p.type,p.icons)};M(this._otherSourceCaches[p.source]),M(this._symbolSourceCaches[p.source])}getGlyphs(u,p,x){this.glyphManager.getGlyphs(p.stacks,x)}getResource(u,p,x){return g.makeRequest(p,x)}_getSourceCache(u){return this._otherSourceCaches[u]}_getLayerSourceCache(u){return"symbol"===u.type?this._symbolSourceCaches[u.source]:this._otherSourceCaches[u.source]}_getSourceCaches(u){const p=[];return this._otherSourceCaches[u]&&p.push(this._otherSourceCaches[u]),this._symbolSourceCaches[u]&&p.push(this._symbolSourceCaches[u]),p}_isSourceCacheLoaded(u){const p=this._getSourceCaches(u);return 0===p.length?(this.fire(new g.ErrorEvent(new Error(`There is no source with ID '${u}'`))),!1):p.every(x=>x.loaded())}has3DLayers(){return this._num3DLayers>0}hasSymbolLayers(){return this._numSymbolLayers>0}hasCircleLayers(){return this._numCircleLayers>0}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}gs.getSourceType=function(_){return Ve[_]},gs.setSourceType=function(_,u){Ve[_]=u},gs.registerForPluginStateChange=g.registerForPluginStateChange;var Tm="\n#define EPSILON 0.0000001\n#define PI 3.141592653589793\n#define EXTENT 8192.0\n#define HALF_PI PI/2.0\n#define QUARTER_PI PI/4.0\n#define RAD_TO_DEG 180.0/PI\n#define DEG_TO_RAD PI/180.0\n#define GLOBE_RADIUS EXTENT/PI/2.0",Dm="attribute highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;varying highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",nc="\n#define ELEVATION_SCALE 7.0\n#define ELEVATION_OFFSET 450.0\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(\nmix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}\n#else\nvec3 elevationVector(vec2 pos) { return vec3(0,0,1); }\n#endif\n#ifdef TERRAIN\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nuniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;\n#else\nuniform sampler2D u_dem;uniform sampler2D u_dem_prev;\n#endif\nuniform vec4 u_dem_unpack;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float decodeElevation(vec4 v) {return dot(vec4(v.xyz*255.0,-1.0),u_dem_unpack);}float currentElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem,pos).a;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem,pos));\n#ifdef TERRAIN_DEM_NEAREST_FILTER\nreturn u_exaggeration*tl;\n#endif\nfloat tr=decodeElevation(texture2D(u_dem,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}float prevElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem_prev,pos).a;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem_prev,pos));float tr=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem_prev,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}\n#ifdef TERRAIN_VERTEX_MORPHING\nfloat elevation(vec2 apos) {float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}\n#else\nfloat elevation(vec2 apos) {return currentElevation(apos);}\n#endif\nhighp float unpack_depth(highp vec4 rgba_depth)\n{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture2D(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(\nunpack_depth(texture2D(u_depth,uv-df.xz)),unpack_depth(texture2D(u_depth,uv+df.xz)),unpack_depth(texture2D(u_depth,uv-df.zy)),unpack_depth(texture2D(u_depth,uv+df.zy))\n);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nfloat tl=texture2D(u_dem,pos).a;float tr=texture2D(u_dem,pos+vec2(off.x,0.0)).a;float bl=texture2D(u_dem,pos+vec2(0.0,off.y)).a;float br=texture2D(u_dem,pos+off).a;\n#else\nvec4 demtl=vec4(texture2D(u_dem,pos).xyz*255.0,-1.0);float tl=dot(demtl,u_dem_unpack);vec4 demtr=vec4(texture2D(u_dem,pos+vec2(off.x,0.0)).xyz*255.0,-1.0);float tr=dot(demtr,u_dem_unpack);vec4 dembl=vec4(texture2D(u_dem,pos+vec2(0.0,off.y)).xyz*255.0,-1.0);float bl=dot(dembl,u_dem_unpack);vec4 dembr=vec4(texture2D(u_dem,pos+off).xyz*255.0,-1.0);float br=dot(dembr,u_dem_unpack);\n#endif\nreturn vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;vec4 bounds=vec4(d,vec2(1.0)-d);h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}\n#else\nfloat elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }\n#endif",ha="#ifdef FOG\nuniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;varying vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}\n#endif",S0="#ifdef FOG\nuniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump float u_fog_temporal_offset;varying vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,opacity);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec3 fog_dither(vec3 color) {vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}\n#endif";let D_={},pa={};const cr=[];fa(Tm,cr),fa(nc,cr),fa(ha,cr),fa(S0,cr),D_=Li("",nc),pa=Li(S0,ha);const A_=Li("\nhighp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}highp float unpack_depth(highp vec4 rgba_depth)\n{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}","\nfloat wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {\n#ifndef PROJECTED_POS_ON_VIEWPORT\nfloat tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;\n#else\nreturn vec3(0.0);\n#endif\n}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}\n#endif\nvec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(\nunpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0\n);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);//Normalized device coordinate that is not rendered."),I_=Tm,ic="\n#ifdef GL_ES\nprecision mediump float;\n#else\n\n#if !defined(lowp)\n#define lowp\n#endif\n\n#if !defined(mediump)\n#define mediump\n#endif\n\n#if !defined(highp)\n#define highp\n#endif\n\n#endif";var er={background:Li("uniform vec4 u_color;uniform float u_opacity;void main() {vec4 out_color=u_color;\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),backgroundPattern:Li("uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_mix);\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),circle:Li("varying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(\nantialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)\n);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);\n#ifdef FOG\nout_color=fog_apply_premultiplied(out_color,v_fog_pos);\n#endif\ngl_FragColor=out_color*(v_visibility*opacity_t);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","#define NUM_VISIBILITY_RINGS 2\n#define INV_SQRT2 0.70710678\n#define ELEVATION_BIAS 0.0001\n#define NUM_SAMPLES_PER_RING 16\nuniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\nvarying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {\n#if defined(TERRAIN)\nreturn elevation(pos)+ELEVATION_BIAS;\n#else\nreturn 0.0;\n#endif\n}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);\n#ifdef PITCH_WITH_MAP\n#ifdef PROJECTION_GLOBE_VIEW\nreturn u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );\n#else\nreturn u_matrix*( world_center+vec4(sample_offset,0,0) );\n#endif\n#else\nreturn projected_center+vec4(sample_offset,0,0);\n#endif\n}float get_sample_step() {\n#ifdef PITCH_WITH_MAP\nreturn 2.0*PI/float(NUM_SAMPLES_PER_RING);\n#else\nreturn PI/float(NUM_SAMPLES_PER_RING);\n#endif\n}void main(void) {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);\n#else \nsurface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);\n#endif\nvec4 projected_center=u_matrix*world_center;float view_scale=0.0;\n#ifdef PITCH_WITH_MAP\n#ifdef SCALE_WITH_MAP\nview_scale=1.0;\n#else\nview_scale=projected_center.w/u_camera_to_center_distance;\n#endif\n#else\n#ifdef SCALE_WITH_MAP\nview_scale=u_camera_to_center_distance;\n#else\nview_scale=projected_center.w;\n#endif\n#endif\ngl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;\n#ifdef TERRAIN\nfloat step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;\n#ifdef PITCH_WITH_MAP\nfloat cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;\n#else\nocclusion_world_center=world_center;occlusion_projected_center=projected_center;\n#endif\nfor(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);\n#else\nvisibility=1.0;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nvisibility=1.0;\n#endif\nv_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);\n#ifdef FOG\nv_fog_pos=fog_position(world_center.xyz);\n#endif\n}"),clippingMask:Li("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Li("uniform highp float u_intensity;varying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#define GAUSS_COEF 0.3989422804014327\nvoid main() {\n#pragma mapbox: initialize highp float weight\nfloat d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);\n#ifdef FOG\nif (u_is_globe==0) {gl_FragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\nvarying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#pragma mapbox: define mediump float radius\nconst highp float ZERO=1.0/255.0/16.0;\n#define GAUSS_COEF 0.3989422804014327\nvoid main(void) {\n#pragma mapbox: initialize highp float weight\n#pragma mapbox: initialize mediump float radius\nvec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#else\npos=vec3(tilePos+extrude,elevation(tilePos));\n#endif\ngl_Position=u_matrix*vec4(pos,1);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),heatmapTexture:Li("uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(0.0);\n#endif\n}","attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:Li("varying float v_placed;varying float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);gl_FragColor =mix(red,blue,step(0.5,v_placed))*0.5;gl_FragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}","attribute vec3 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;attribute float a_size_scale;attribute vec2 a_padding;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*elevation(a_anchor_pos),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:Li("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos_2f;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(\nmix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:Li("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;\n#endif\nvarying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;\n#ifdef PROJECTION_GLOBE_VIEW\ngl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);\n#else\ngl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);\n#endif\n}"),fill:Li("#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\nvec4 out_color=color;\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillOutline:Li("varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillOutlinePattern:Li("uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=mix(color1,color2,u_fade);\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillPattern:Li("uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_fade);\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillExtrusion:Li("varying vec4 v_color;\n#ifdef RENDER_SHADOWS\nvarying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying float v_depth;\n#endif\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;varying vec3 v_ao;\n#endif\n#ifdef ZERO_ROOF_RADIUS\nvarying vec4 v_roof_color;\n#endif\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)\nvarying highp vec3 v_normal;\n#endif\nvoid main() {\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)\nvec3 normal=v_normal;\n#endif\nfloat z;vec4 color;\n#ifdef ZERO_ROOF_RADIUS\nz=float(normal.z > 0.00001);color=mix(v_color,v_roof_color,z);\n#else\ncolor=v_color;\n#endif\n#ifdef FAUX_AO\nfloat intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;\n#ifdef ZERO_ROOF_RADIUS\nconcave*=(1.0-z);\n#endif\nfloat x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);color.rgb=color.rgb*shade;\n#endif\n#ifdef RENDER_SHADOWS\n#ifdef ZERO_ROOF_RADIUS\nnormal=mix(normal,vec3(0.0,0.0,1.0),z);\n#endif\ncolor.xyz=shadowed_color_normal(color.xyz,normalize(normal),v_pos_light_view_0,v_pos_light_view_1,v_depth);\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;\n#endif\nvarying vec4 v_color;\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying float v_depth;\n#endif\n#ifdef ZERO_ROOF_RADIUS\nvarying vec4 v_roof_color;\n#endif\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)\nvarying highp vec3 v_normal;\n#endif\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;varying vec3 v_ao;\n#endif\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define highp vec4 color\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize highp vec4 color\nvec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)\nv_normal=normal;\n#endif\nbase=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\nfloat ele=0.0;float h=0.0;float c_ele;vec3 pos;\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);pos=vec3(pos_nx.xy,h);\n#else\nh=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);\n#ifdef RENDER_SHADOWS\nv_pos_light_view_0=u_light_matrix_0*vec4(pos,1);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1);v_depth=gl_Position.w;\n#endif\nfloat colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}\n#ifdef FAUX_AO\nfloat concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;\n#ifdef TERRAIN\ntop_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);\n#endif\nv_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);directional*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);\n#ifdef PROJECTION_GLOBE_VIEW\ntop_height+=u_height_lift;\n#endif\ngl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;\n#endif\nv_color.rgb+=clamp(color.rgb*directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;\n#ifdef ZERO_ROOF_RADIUS\nv_roof_color=vec4(0.0,0.0,0.0,1.0);float roof_radiance=clamp(u_lightpos.z,0.0,1.0);roof_radiance=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roof_radiance);v_roof_color.rgb+=clamp(color.rgb*roof_radiance*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_roof_color*=u_opacity;\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),fillExtrusionPattern:Li("uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;varying vec3 v_ao;\n#endif\nvarying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_fade);out_color=out_color*v_lighting;\n#ifdef FAUX_AO\nfloat intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;\n#endif\nvarying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;varying vec3 v_ao;\n#endif\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\nfloat ele=0.0;float h=z;vec3 p;float c_ele;\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);p=vec3(pos_nx.xy,h);\n#else\np=vec3(pos_nx.xy,z);\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0\n? pos_nx.xy\n: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}\n#ifdef FAUX_AO\nfloat concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;\n#ifdef TERRAIN\ntop_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);\n#endif\nv_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);directional*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);\n#ifdef PROJECTION_GLOBE_VIEW\ntop_height+=u_height_lift;\n#endif\ngl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;\n#endif\nv_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;\n#ifdef FOG\nv_fog_pos=fog_position(p);\n#endif\n}"),hillshadePrepare:Li("#ifdef GL_ES\nprecision highp float;\n#endif\nuniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nreturn texture2D(u_image,coord).a/4.0;\n#else\nvec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;\n#endif\n}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos);float f=getElevation(v_pos+vec2(epsilon.x,0));float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float h=getElevation(v_pos+vec2(0,epsilon.y));float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(\n(c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c)\n)/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(\nderiv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Li("uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;\n#ifdef FOG\ngl_FragColor=fog_dither(fog_apply_premultiplied(gl_FragColor,v_fog_pos));\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),line:Li("uniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec4 v_uv;\n#ifdef RENDER_LINE_DASH\nuniform sampler2D u_dash_image;uniform float u_mix;uniform vec3 u_scale;varying vec2 v_tex_a;varying vec2 v_tex_b;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform sampler2D u_gradient_image;\n#endif\nuniform float u_border_width;uniform vec4 u_border_color;float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash_from\n#pragma mapbox: define lowp vec4 dash_to\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash_from\n#pragma mapbox: initialize lowp vec4 dash_to\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);\n#ifdef RENDER_LINE_DASH\nfloat sdfdist_a=texture2D(u_dash_image,v_tex_a).a;float sdfdist_b=texture2D(u_dash_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);float sdfwidth=min(dash_from.z*u_scale.y,dash_to.z*u_scale.z);float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/sdfwidth;alpha*=smoothstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);\n#endif\n#ifdef RENDER_LINE_GRADIENT\nhighp vec4 out_color=texture2D(u_gradient_image,v_uv.xy);\n#else\nvec4 out_color=color;\n#endif\n#ifdef RENDER_LINE_TRIM_OFFSET\nhighp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {out_color=vec4(0,0,0,0);}}\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\n#ifdef RENDER_LINE_ALPHA_DISCARD\nif (alpha < u_alpha_discard_threshold) {discard;}\n#endif\n#ifdef RENDER_LINE_BORDER\nfloat edgeBlur=(u_border_width+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);\n#ifdef RENDER_LINE_BORDER_AUTO\nfloat Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}\n#else\nout_color.rgb=mix(u_border_color.rgb,out_color.rgb,smoothAlpha);\n#endif\n}\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define EXTRUDE_SCALE 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;\n#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)\nattribute highp vec4 a_packed;\n#endif\n#ifdef RENDER_LINE_DASH\nattribute float a_linesofar;\n#endif\nuniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec4 v_uv;\n#ifdef RENDER_LINE_DASH\nuniform vec2 u_texsize;uniform mediump vec3 u_scale;varying vec2 v_tex_a;varying vec2 v_tex_b;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform float u_image_height;\n#endif\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash_from\n#pragma mapbox: define lowp vec4 dash_to\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash_from\n#pragma mapbox: initialize lowp vec4 dash_to\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\n#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)\nfloat a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];\n#ifdef RENDER_LINE_GRADIENT\nhighp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec4(a_uv_x,a_split_index*texel_height-half_texel_height,a_clip_start,a_clip_end);\n#else\nv_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);\n#endif\n#endif\n#ifdef RENDER_LINE_DASH\nfloat tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;float scaleA=dash_from.z==0.0 ? 0.0 : tileZoomRatio/(dash_from.z*fromScale);float scaleB=dash_to.z==0.0 ? 0.0 : tileZoomRatio/(dash_to.z*toScale);float heightA=dash_from.y;float heightB=dash_to.y;v_tex_a=vec2(a_linesofar*scaleA/floorwidth,(-normal.y*heightA+dash_from.x+0.5)/u_texsize.y);v_tex_b=vec2(a_linesofar*scaleB/floorwidth,(-normal.y*heightB+dash_to.x+0.5)/u_texsize.y);\n#endif\nv_width2=vec2(outset,inset);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),linePattern:Li("uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_linesofar;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\nv_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),raster:Li("uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(\ndot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);\n#ifdef FOG\nout_color=fog_dither(fog_apply(out_color,v_fog_pos));\n#endif\ngl_FragColor=vec4(out_color*color.a,color.a);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {float w=1.0+dot(a_texture_pos,u_perspective_transform);gl_Position=u_matrix*vec4(a_pos*w,0,w);v_pos0=a_texture_pos/8192.0;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),symbolIcon:Li("uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nlowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform vec3 u_up_vector;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nvarying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nmercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nworld_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjected_point;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetProjected_point=u_matrix*vec4(a_globe_anchor+displacement,1);\n#else\noffsetProjected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);\n#endif\nvec2 a=projected_point.xy/projected_point.w;vec2 b=offsetProjected_point.xy/offsetProjected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);\n#ifdef TERRAIN\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#endif\nfloat projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nv_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;}"),symbolSDF:Li("#define SDF_PX 8.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nvarying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nmercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nworld_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);\n#else\noffsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);\n#endif\nvec2 a=projected_point.xy/projected_point.w;vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);\n#ifdef TERRAIN\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#endif\nfloat gamma_scale=gl_Position.w;float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nvec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade);}"),symbolTextAndIcon:Li("#define SDF_PX 8.0\n#define SDF 1.0\n#define ICON 0.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nreturn;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_projected_pos;attribute float a_fade_opacity;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nvarying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nmercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nworld_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offset_projected_point=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offset_projected_point.xy/offset_projected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*font_scale);\n#ifdef TERRAIN\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#endif\nfloat gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nv_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade,is_sdf);}"),terrainRaster:Li("uniform sampler2D u_image0;varying vec2 v_pos0;\n#ifdef FOG\nvarying float v_fog_opacity;\n#endif\n#ifdef RENDER_SHADOWS\nvarying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;\n#endif\nvoid main() {vec4 color=texture2D(u_image0,v_pos0);\n#ifdef RENDER_SHADOWS\ncolor.xyz=shadowed_color(color.xyz,v_pos_light_view_0,v_pos_light_view_1,v_depth);\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_from_vert(color,v_fog_opacity));\n#endif\ngl_FragColor=color;\n#ifdef TERRAIN_WIREFRAME\ngl_FragColor=vec4(1.0,0.0,0.0,0.8);\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform float u_skirt_height;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;\n#ifdef FOG\nvarying float v_fog_opacity;\n#endif\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;\n#endif\nconst float skirtOffset=24575.0;const float wireframeOffset=0.00015;void main() {v_pos0=a_texture_pos/8192.0;float skirt=float(a_pos.x >=skirtOffset);float elevation=elevation(a_texture_pos)-skirt*u_skirt_height;\n#ifdef TERRAIN_WIREFRAME\nelevation+=u_skirt_height*u_skirt_height*wireframeOffset;\n#endif\nvec2 decodedPos=a_pos-vec2(skirt*skirtOffset,0.0);gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);\n#ifdef FOG\nv_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));\n#endif\n#ifdef RENDER_SHADOWS\nvec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);v_depth=gl_Position.w;\n#endif\n}"),terrainDepth:Li("#ifdef GL_ES\nprecision highp float;\n#endif\nvarying float v_depth;void main() {gl_FragColor=pack_depth(v_depth);}","uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying float v_depth;void main() {float elevation=elevation(a_texture_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}"),skybox:Li("\nvarying lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(\ncos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=textureCube(u_cubemap,uv).rgb;\n#ifdef FOG\nsky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);\n#endif\nsky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);gl_FragColor=vec4(sky_color*u_opacity,u_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}",Dm),skyboxGradient:Li("varying highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture2D(u_color_ramp,vec2(progress,0.5));\n#ifdef FOG\ncolor.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;\n#endif\ncolor*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}",Dm),skyboxCapture:Li("\nvarying highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;\n#ifdef GL_ES\nprecision highp float;\n#endif\n#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)\n#define BETA_M                  vec3(21e-6,21e-6,21e-6)\n#define MIE_G                   0.76\n#define DENSITY_HEIGHT_SCALE_R  8000.0\n#define DENSITY_HEIGHT_SCALE_M  1200.0\n#define PLANET_RADIUS           6360e3\n#define ATMOSPHERE_RADIUS       6420e3\n#define SAMPLE_STEPS            10\n#define DENSITY_STEPS           4\nfloat ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;gl_FragColor=vec4(color,1.0);}","attribute highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;varying highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:Li("uniform sampler2D u_image0;varying vec2 v_pos0;\n#ifndef FOG\nuniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;\n#endif\nvoid main() {vec4 color;\n#ifdef CUSTOM_ANTIALIASING\nvec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);vec3 dir=normalize(ray_dir);vec3 closest_point=dot(u_globe_pos,dir)*dir;float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture2D(u_image0,v_pos0);color=vec4(raster.rgb*antialias,raster.a*antialias);\n#else\ncolor=texture2D(u_image0,v_pos0);\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color;\n#ifdef TERRAIN_WIREFRAME\ngl_FragColor=vec4(1.0,0.0,0.0,0.8);\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;\n#ifdef GLOBE_POLES\nattribute vec3 a_globe_pos;attribute vec2 a_uv;\n#else\nattribute vec2 a_pos;\n#endif\nvarying vec2 v_pos0;const float wireframeOffset=1e3;float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(QUARTER_PI+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}void main() {\n#ifdef GLOBE_POLES\nvec3 globe_pos=a_globe_pos;vec2 uv=a_uv;\n#else\nfloat tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 latLng=u_grid_matrix*vec3(a_pos,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);\n#endif\nv_pos0=uv;vec2 tile_pos=uv*EXTENT;\n#ifdef GLOBE_POLES\nvec3 up_vector=normalize(globe_pos)*u_tile_up_scale;\n#else\nvec3 up_vector=elevationVector(tile_pos);\n#endif\nfloat height=elevation(tile_pos);\n#ifdef TERRAIN_WIREFRAME\nheight+=wireframeOffset;\n#endif\nglobe_pos+=up_vector*height;\n#ifdef GLOBE_POLES\nvec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);\n#else\nvec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);\n#endif\ngl_Position=u_proj_matrix*interpolated_pos;\n#ifdef FOG\nv_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);\n#endif\n}"),globeAtmosphere:Li("uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec3 u_start_color;uniform vec4 u_color;uniform vec4 u_space_color;uniform vec4 u_high_color;uniform float u_star_intensity;uniform float u_star_size;uniform float u_star_density;uniform float u_horizon_angle;uniform mat4 u_rotation_matrix;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;highp float random(highp vec3 p) {p=fract(p*vec3(23.2342,97.1231,91.2342));p+=dot(p.zxy,p.yxz+123.1234);return fract(p.x*p.y);}float stars(vec3 p,float scale,vec2 offset) {vec2 uv_scale=(u_viewport/u_star_size)*scale;vec3 position=vec3(p.xy*uv_scale+offset*u_viewport,p.z);vec3 q=fract(position)-0.5;vec3 id=floor(position);float random_visibility=step(random(id),u_star_density);float circle=smoothstep(0.5+u_star_intensity,0.5,length(q));return circle*random_visibility;}void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;\n#ifdef PROJECTION_GLOBE_VIEW\nglobe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {discard;return;}\n#endif\nhighp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?\n0.0 : max(acos(dot(dir,horizon_dir)),0.0);float horizon_angle;\n#ifdef PROJECTION_GLOBE_VIEW\nhighp vec3 closest_point=globe_pos_dot_dir*dir;float closest_point_to_center=length(closest_point-u_globe_pos);float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?\nPI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);\n#else\nhorizon_angle=horizon_angle_mercator;\n#endif\nhorizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c =mix(color_stop_2,c2,t);float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);vec2 uv=gl_FragCoord.xy/u_viewport-0.5;float aspect_ratio=u_viewport.x/u_viewport.y;vec4 uv_dir=vec4(normalize(vec3(uv.x*aspect_ratio,uv.y,1.0)),1.0);uv_dir=u_rotation_matrix*uv_dir;vec3 n=abs(uv_dir.xyz);vec2 uv_remap=(n.x > n.y && n.x > n.z) ? uv_dir.yz/uv_dir.x:\n(n.y > n.x && n.y > n.z) ? uv_dir.zx/uv_dir.y:\nuv_dir.xy/uv_dir.z;uv_remap.x/=aspect_ratio;vec3 D=vec3(uv_remap,1.0);highp float star_field=0.0;if (u_star_intensity > 0.0) {star_field+=stars(D,1.2,vec2(0.0,0.0));star_field+=stars(D,1.0,vec2(1.0,0.0));star_field+=stars(D,0.8,vec2(0.0,1.0));star_field+=stars(D,0.6,vec2(1.0,1.0));star_field*=(1.0-pow(t,0.25+(1.0-u_high_color.a)*0.75));c+=star_field*alpha_2;}c=dither(c,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=vec4(c,a);}","attribute vec3 a_pos;attribute vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(\nmix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}")};function fa(_,u){const p=_.replace(/\s*\/\/[^\n]*\n/g,"\n").split("\n");for(let x of p)if(x=x.trim(),"#"===x[0]&&x.includes("if")&&!x.includes("endif")){x=x.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const M=x.split(" ");for(const E of M)u.includes(E)||u.push(E)}}function Li(_,u){const p=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,x=u.match(/attribute (highp |mediump |lowp )?([\w]+) ([\w]+)/g),M={},E=[...cr];return fa(_,E),fa(u,E),{fragmentSource:_=_.replace(p,(P,O,N,U,H)=>(M[H]=!0,"define"===O?`\n#ifndef HAS_UNIFORM_u_${H}\nvarying ${N} ${U} ${H};\n#else\nuniform ${N} ${U} u_${H};\n#endif\n`:`\n#ifdef HAS_UNIFORM_u_${H}\n    ${N} ${U} ${H} = u_${H};\n#endif\n`)),vertexSource:u=u.replace(p,(P,O,N,U,H)=>{const Z="float"===U?"vec2":"vec4",Q=H.match(/color/)?"color":Z;return M[H]?"define"===O?`\n#ifndef HAS_UNIFORM_u_${H}\nuniform lowp float u_${H}_t;\nattribute ${N} ${Z} a_${H};\nvarying ${N} ${U} ${H};\n#else\nuniform ${N} ${U} u_${H};\n#endif\n`:"vec4"===Q?`\n#ifndef HAS_UNIFORM_u_${H}\n    ${H} = a_${H};\n#else\n    ${N} ${U} ${H} = u_${H};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${H}\n    ${H} = unpack_mix_${Q}(a_${H}, u_${H}_t);\n#else\n    ${N} ${U} ${H} = u_${H};\n#endif\n`:"define"===O?`\n#ifndef HAS_UNIFORM_u_${H}\nuniform lowp float u_${H}_t;\nattribute ${N} ${Z} a_${H};\n#else\nuniform ${N} ${U} u_${H};\n#endif\n`:"vec4"===Q?`\n#ifndef HAS_UNIFORM_u_${H}\n    ${N} ${U} ${H} = a_${H};\n#else\n    ${N} ${U} ${H} = u_${H};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${H}\n    ${N} ${U} ${H} = unpack_mix_${Q}(a_${H}, u_${H}_t);\n#else\n    ${N} ${U} ${H} = u_${H};\n#endif\n`}),staticAttributes:x,usedDefines:E}}class Lu{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(u,p,x,M,E,P,O){this.context=u;let N=this.boundPaintVertexBuffers.length!==M.length;for(let H=0;!N&&H<M.length;H++)this.boundPaintVertexBuffers[H]!==M[H]&&(N=!0);let U=this.boundDynamicVertexBuffers.length!==O.length;for(let H=0;!U&&H<O.length;H++)this.boundDynamicVertexBuffers[H]!==O[H]&&(U=!0);if(!u.extVertexArrayObject||!this.vao||this.boundProgram!==p||this.boundLayoutVertexBuffer!==x||N||U||this.boundIndexBuffer!==E||this.boundVertexOffset!==P)this.freshBind(p,x,M,E,P,O);else{u.bindVertexArrayOES.set(this.vao);for(const H of O)H&&H.bind();E&&E.dynamicDraw&&E.bind()}}freshBind(u,p,x,M,E,P){let O;const N=u.numAttributes,U=this.context,H=U.gl;if(U.extVertexArrayObject)this.vao&&this.destroy(),this.vao=U.extVertexArrayObject.createVertexArrayOES(),U.bindVertexArrayOES.set(this.vao),O=0,this.boundProgram=u,this.boundLayoutVertexBuffer=p,this.boundPaintVertexBuffers=x,this.boundIndexBuffer=M,this.boundVertexOffset=E,this.boundDynamicVertexBuffers=P;else{O=U.currentNumAttributes||0;for(let Z=N;Z<O;Z++)H.disableVertexAttribArray(Z)}p.enableAttributes(H,u),p.bind(),p.setVertexAttribPointers(H,u,E);for(const Z of x)Z.enableAttributes(H,u),Z.bind(),Z.setVertexAttribPointers(H,u,E);for(const Z of P)Z&&(Z.enableAttributes(H,u),Z.bind(),Z.setVertexAttribPointers(H,u,E));M&&M.bind(),U.currentNumAttributes=N}destroy(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)}}function Dh(_,u){const p=Math.pow(2,u.canonical.z),x=u.canonical.y;return[new g.MercatorCoordinate(0,x/p).toLngLat().lat,new g.MercatorCoordinate(0,(x+1)/p).toLngLat().lat]}function Oa(_,u,p,x,M,E,P){const O=_.context,N=O.gl,U=p.fbo;if(!U)return;_.prepareDrawTile();const H=_.useProgram("hillshade");O.activeTexture.set(N.TEXTURE0),N.bindTexture(N.TEXTURE_2D,U.colorAttachment.get());const Z=((le,re,ne,ue)=>{const se=ne.paint.get("hillshade-shadow-color"),Me=ne.paint.get("hillshade-highlight-color"),Se=ne.paint.get("hillshade-accent-color");let ge=ne.paint.get("hillshade-illumination-direction")*(Math.PI/180);"viewport"===ne.paint.get("hillshade-illumination-anchor")&&(ge-=le.transform.angle);const De=!le.options.moving;return{u_matrix:ue||le.transform.calculateProjMatrix(re.tileID.toUnwrapped(),De),u_image:0,u_latrange:Dh(0,re.tileID),u_light:[ne.paint.get("hillshade-exaggeration"),ge],u_shadow:se,u_highlight:Me,u_accent:Se}})(_,p,x,_.terrain?u.projMatrix:null);_.prepareDrawProgram(O,H,u.toUnwrapped());const{tileBoundsBuffer:Q,tileBoundsIndexBuffer:oe,tileBoundsSegments:ie}=_.getTileBoundsBuffers(p);H.draw(O,N.TRIANGLES,M,E,P,g.CullFaceMode.disabled,Z,x.id,Q,oe,ie)}function Uc(_,u,p){if(!u.needsDEMTextureUpload)return;const x=_.context,M=x.gl;x.pixelStoreUnpackPremultiplyAlpha.set(!1),u.demTexture=u.demTexture||_.getTileTexture(p.stride);const E=p.getPixels();u.demTexture?u.demTexture.update(E,{premultiply:!1}):u.demTexture=new g.Texture(x,E,M.RGBA,{premultiply:!1}),u.needsDEMTextureUpload=!1}function P_(_,u,p,x,M,E){const P=_.context,O=P.gl;if(!u.dem)return;const N=u.dem;if(P.activeTexture.set(O.TEXTURE1),Uc(_,u,N),!u.demTexture)return;u.demTexture.bind(O.NEAREST,O.CLAMP_TO_EDGE);const U=N.dim;P.activeTexture.set(O.TEXTURE0);let H=u.fbo;if(!H){const ie=new g.Texture(P,{width:U,height:U,data:null},O.RGBA);ie.bind(O.LINEAR,O.CLAMP_TO_EDGE),H=u.fbo=P.createFramebuffer(U,U,!0),H.colorAttachment.set(ie.texture)}P.bindFramebuffer.set(H.framebuffer),P.viewport.set([0,0,U,U]);const{tileBoundsBuffer:Z,tileBoundsIndexBuffer:Q,tileBoundsSegments:oe}=_.getMercatorTileBoundsBuffers();_.useProgram("hillshadePrepare").draw(P,O.TRIANGLES,x,M,E,g.CullFaceMode.disabled,((ie,le)=>{const re=le.stride,ne=g.create();return g.ortho(ne,0,g.EXTENT,-g.EXTENT,0,0,1),g.translate(ne,ne,[0,-g.EXTENT,0]),{u_matrix:ne,u_image:1,u_dimension:[re,re],u_zoom:ie.overscaledZ,u_unpack:le.unpackVector}})(u.tileID,N),p.id,Z,Q,oe),u.needsHillshadePrepare=!1}const Qn=_=>({u_matrix:new g.UniformMatrix4f(_),u_image0:new g.Uniform1i(_),u_skirt_height:new g.Uniform1f(_)}),Am=(_,u)=>({u_matrix:_,u_image0:0,u_skirt_height:u}),Ah=(_,u,p,x,M,E,P,O,N,U,H,Z,Q,oe)=>({u_proj_matrix:Float32Array.from(_),u_globe_matrix:u,u_normalize_matrix:Float32Array.from(x),u_merc_matrix:p,u_zoom_transition:M,u_merc_center:E,u_image0:0,u_frustum_tl:P,u_frustum_tr:O,u_frustum_br:N,u_frustum_bl:U,u_globe_pos:H,u_globe_radius:Z,u_viewport:Q,u_grid_matrix:oe?Float32Array.from(oe):new Float32Array(9)});function Td(_,u){return null!=_&&null!=u&&!(!_.hasData()||!u.hasData())&&null!=_.demTexture&&null!=u.demTexture&&_.tileID.key!==u.tileID.key}const Gn=new class{constructor(){this.operations={}}newMorphing(_,u,p,x,M){if(_ in this.operations){const E=this.operations[_];E.to.tileID.key!==p.tileID.key&&(E.queued=p)}else this.operations[_]={startTime:x,phase:0,duration:M,from:u,to:p,queued:null}}getMorphValuesForProxy(_){if(!(_ in this.operations))return null;const u=this.operations[_];return{from:u.from,to:u.to,phase:u.phase}}update(_){for(const u in this.operations){const p=this.operations[u];for(p.phase=(_-p.startTime)/p.duration;p.phase>=1||!this._validOp(p);)if(!this._nextOp(p,_)){delete this.operations[u];break}}}_nextOp(_,u){return!!_.queued&&(_.from=_.to,_.to=_.queued,_.queued=null,_.phase=0,_.startTime=u,!0)}_validOp(_){return _.from.hasData()&&_.to.hasData()}},Dd={0:null,1:"TERRAIN_VERTEX_MORPHING",2:"TERRAIN_WIREFRAME"};function Oi(_,u){const p=1<<_.z;return!u&&(0===_.x||_.x===p-1)||0===_.y||_.y===p-1}const an=_=>({u_matrix:_});function co(_,u,p,x,M){if(M>0){const E=g.exported.now(),P=(E-_.timeAdded)/M,O=u?(E-u.timeAdded)/M:-1,N=p.getSource(),U=x.coveringZoomLevel({tileSize:N.tileSize,roundZoom:N.roundZoom}),H=!u||Math.abs(u.tileID.overscaledZ-U)>Math.abs(_.tileID.overscaledZ-U),Z=H&&_.refreshedUponExpiration?1:g.clamp(H?P:1-O,0,1);return _.refreshedUponExpiration&&P>=1&&(_.refreshedUponExpiration=!1),u?{opacity:1,mix:1-Z}:{opacity:Z,mix:0}}return{opacity:1,mix:0}}class yr extends g.SourceCache{constructor(u){const p={type:"raster-dem",maxzoom:u.transform.maxZoom},x=new Ql(Vn(),null),M=Be("mock-dem",p,x,u.style);super("mock-dem",M,!1),M.setEventedParent(this),this._sourceLoaded=!0}_loadTile(u,p){u.state="loaded",p(null)}}class uo extends g.SourceCache{constructor(u){const p=Be("proxy",{type:"geojson",maxzoom:u.transform.maxZoom},new Ql(Vn(),null),u.style);super("proxy",p,!1),p.setEventedParent(this),this.map=this.getSource().map=u,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(u,p,x){if(u.freezeTileCoverage)return;this.transform=u;const M=u.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((E,P)=>{if(E[P.key]="",!this._tiles[P.key]){const O=new g.Tile(P,this._source.tileSize*P.overscaleFactor(),u.tileZoom);O.state="loaded",this._tiles[P.key]=O}return E},{});for(const E in this._tiles)E in M||(this.freeFBO(E),this._tiles[E].unloadVectorData(),delete this._tiles[E])}freeFBO(u){const p=this.proxyCachedFBO[u];if(void 0!==p){const x=Object.values(p);this.renderCachePool.push(...x),delete this.proxyCachedFBO[u]}}deallocRenderCache(){this.renderCache.forEach(u=>u.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class Bs extends g.OverscaledTileID{constructor(u,p,x){super(u.overscaledZ,u.wrap,u.canonical.z,u.canonical.x,u.canonical.y),this.proxyTileKey=p,this.projMatrix=x}}class Ou extends g.Elevation{constructor(u,p){super(),this.painter=u,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[x,M,E]=function(N){const U=new g.StructArrayLayout4i8,H=new g.StructArrayLayout3ui6,Z=131;U.reserve(17161),H.reserve(33800);const Q=g.EXTENT/128,oe=g.EXTENT+Q/2,ie=oe+Q;for(let re=-Q;re<ie;re+=Q)for(let ne=-Q;ne<ie;ne+=Q){const ue=ne<0||ne>oe||re<0||re>oe?24575:0,se=g.clamp(Math.round(ne),0,g.EXTENT),Me=g.clamp(Math.round(re),0,g.EXTENT);U.emplaceBack(se+ue,Me,se,Me)}const le=(re,ne)=>{const ue=ne*Z+re;H.emplaceBack(ue+1,ue,ue+Z),H.emplaceBack(ue+Z,ue+Z+1,ue+1)};for(let re=1;re<129;re++)for(let ne=1;ne<129;ne++)le(ne,re);return[0,129].forEach(re=>{for(let ne=0;ne<130;ne++)le(ne,re),le(re,ne)}),[U,H,32768]}(),P=u.context;this.gridBuffer=P.createVertexBuffer(x,g.boundsAttributes.members),this.gridIndexBuffer=P.createIndexBuffer(M),this.gridSegments=g.SegmentVector.simpleSegment(0,0,x.length,M.length),this.gridNoSkirtSegments=g.SegmentVector.simpleSegment(0,0,x.length,E),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new uo(p.map),this.orthoMatrix=g.create(),g.ortho(this.orthoMatrix,"globe"===this.painter.transform.projection.name?.015:0,g.EXTENT,0,g.EXTENT,0,1);const O=P.gl;this._overlapStencilMode=new g.StencilMode({func:O.GEQUAL,mask:255},0,255,O.KEEP,O.KEEP,O.REPLACE),this._previousZoom=u.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=p,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new yr(p.map)}set style(u){u.on("data",this._onStyleDataEvent.bind(this)),u.on("neworder",this._checkRenderCacheEfficiency.bind(this)),this._style=u,this._checkRenderCacheEfficiency()}update(u,p,x){if(u&&u.terrain){this._style!==u&&(this.style=u),this.enabled=!0;const M=u.terrain.properties;this.sourceCache=0===u.terrain.drapeRenderMode?this._mockSourceCache:u._getSourceCache(M.get("source")),this._exaggeration=M.get("exaggeration");const E=()=>{this.sourceCache.used&&g.warnOnce(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.\nThis leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const P=this.getScaledDemTileSize();this.sourceCache.update(p,P,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,E(),this._initializing=!0),E(),p.updateElevation(!x),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(p),this._emptyDEMTextureDirty=!0}else this._disable()}resetTileLookupCache(u){this._findCoveringTileCache[u]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_checkRenderCacheEfficiency(){const u=this.renderCacheEfficiency(this._style);this._style.map._optimizeForTerrain||100!==u.efficiency&&g.warnOnce(`Terrain render cache efficiency is not optimal (${u.efficiency}%) and performance\n                may be affected negatively, consider placing all background, fill and line layers before layer\n                with id '${u.firstUndrapedLayer}' or create a map using optimizeForTerrain: true option.`)}_onStyleDataEvent(u){u.coord&&"source"===u.dataType?this._clearRenderCacheForTile(u.sourceCacheId,u.coord):"style"===u.dataType&&(this._invalidateRenderCache=!0)}_disable(){if(this.enabled&&(this.enabled=!1,this._sharedDepthStencil=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const u in this._style._sourceCaches)this._style._sourceCaches[u].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this._emptyDepthBufferTexture&&this._emptyDepthBufferTexture.destroy(),this.pool.forEach(u=>u.fb.destroy()),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0)}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this._exaggeration}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const u=2*this.proxySourceCache.getSource().tileSize;return[u,u]}set useVertexMorphing(u){this._useVertexMorphing=u}updateTileBinding(u){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const p=this.proxySourceCache,x=this.painter.transform;this._initializing&&(this._initializing=0===x._centerAltitude&&-1===this.getAtPointOrZero(g.MercatorCoordinate.fromLngLat(x.center),-1),this._emptyDEMTextureDirty=!this._initializing);const M=this.proxyCoords=p.getIds().map(N=>{const U=p.getTileByID(N).tileID;return U.projMatrix=x.calculateProjMatrix(U.toUnwrapped()),U});(function(N,U){const H=U.transform.pointCoordinate(U.transform.getCameraPoint()),Z=new g.pointGeometry(H.x,H.y);N.sort((Q,oe)=>{if(oe.overscaledZ-Q.overscaledZ)return oe.overscaledZ-Q.overscaledZ;const ie=new g.pointGeometry(Q.canonical.x+(1<<Q.canonical.z)*Q.wrap,Q.canonical.y),le=new g.pointGeometry(oe.canonical.x+(1<<oe.canonical.z)*oe.wrap,oe.canonical.y),re=Z.mult(1<<Q.canonical.z);return re.x-=.5,re.y-=.5,re.distSqr(ie)-re.distSqr(le)})})(M,this.painter),this._previousZoom=x.zoom;const E=this.proxyToSource||{};this.proxyToSource={},M.forEach(N=>{this.proxyToSource[N.key]={}}),this.terrainTileForTile={};const P=this._style._sourceCaches;for(const N in P){const U=P[N];if(!U.used||(U!==this.sourceCache&&this.resetTileLookupCache(U.id),this._setupProxiedCoordsForOrtho(U,u[N],E),U.usedForTerrain))continue;const H=u[N];U.getSource().reparseOverscaled&&this._assignTerrainTiles(H)}this.proxiedCoords[p.id]=M.map(N=>new Bs(N,N.key,this.orthoMatrix)),this._assignTerrainTiles(M),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(E),this.renderingToTexture=!1,this._updateTimestamp=g.exported.now();const O={};this._visibleDemTiles=[];for(const N of this.proxyCoords){const U=this.terrainTileForTile[N.key];if(!U)continue;const H=U.tileID.key;H in O||(this._visibleDemTiles.push(U),O[H]=H)}}_assignTerrainTiles(u){this._initializing||u.forEach(p=>{if(this.terrainTileForTile[p.key])return;const x=this._findTileCoveringTileID(p,this.sourceCache);x&&(this.terrainTileForTile[p.key]=x)})}_prepareDEMTextures(){const u=this.painter.context,p=u.gl;for(const x in this.terrainTileForTile){const M=this.terrainTileForTile[x],E=M.dem;!E||M.demTexture&&!M.needsDEMTextureUpload||(u.activeTexture.set(p.TEXTURE1),Uc(this.painter,M,E))}}_prepareDemTileUniforms(u,p,x,M){if(!p||null==p.demTexture)return!1;const E=u.tileID.canonical,P=Math.pow(2,p.tileID.canonical.z-E.z),O=M||"";return x[`u_dem_tl${O}`]=[E.x*P%1,E.y*P%1],x[`u_dem_scale${O}`]=P,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}get emptyDepthBufferTexture(){const u=this.painter.context,p=u.gl;if(!this._emptyDepthBufferTexture){const x=new g.RGBAImage({width:1,height:1},Uint8Array.of(255,255,255,255));this._emptyDepthBufferTexture=new g.Texture(u,x,p.RGBA,{premultiply:!1})}return this._emptyDepthBufferTexture}_getLoadedAreaMinimum(){let u=0;const p=this._visibleDemTiles.reduce((x,M)=>{if(!M.dem)return x;const E=M.dem.tree.minimums[0];return E>0&&u++,x+E},0);return u?p/u:0}_updateEmptyDEMTexture(){const u=this.painter.context,p=u.gl;u.activeTexture.set(p.TEXTURE2);const x=this._getLoadedAreaMinimum(),M=new g.RGBAImage({width:1,height:1},new Uint8Array(g.DEMData.pack(x,this.sourceCache.getSource().encoding)));this._emptyDEMTextureDirty=!1;let E=this._emptyDEMTexture;return E?E.update(M,{premultiply:!1}):E=this._emptyDEMTexture=new g.Texture(u,M,p.RGBA,{premultiply:!1}),E}setupElevationDraw(u,p,x){const M=this.painter.context,E=M.gl,P=(O=this.sourceCache.getSource().encoding,{u_dem:2,u_dem_prev:4,u_dem_unpack:g.DEMData.getUnpackVector(O),u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0});var O;P.u_dem_size=this.sourceCache.getSource().tileSize,P.u_exaggeration=this.exaggeration();let N=null,U=null,H=1;if(x&&x.morphing&&this._useVertexMorphing){const Z=x.morphing.srcDemTile,Q=x.morphing.dstDemTile;H=x.morphing.phase,Z&&Q&&(this._prepareDemTileUniforms(u,Z,P,"_prev")&&(U=Z),this._prepareDemTileUniforms(u,Q,P)&&(N=Q))}if(U&&N?(M.activeTexture.set(E.TEXTURE2),N.demTexture.bind(E.NEAREST,E.CLAMP_TO_EDGE,E.NEAREST),M.activeTexture.set(E.TEXTURE4),U.demTexture.bind(E.NEAREST,E.CLAMP_TO_EDGE,E.NEAREST),P.u_dem_lerp=H):(N=this.terrainTileForTile[u.tileID.key],M.activeTexture.set(E.TEXTURE2),(this._prepareDemTileUniforms(u,N,P)?N.demTexture:this.emptyDEMTexture).bind(E.NEAREST,E.CLAMP_TO_EDGE)),M.activeTexture.set(E.TEXTURE3),x&&x.useDepthForOcclusion?(this._depthTexture&&this._depthTexture.bind(E.NEAREST,E.CLAMP_TO_EDGE),this._depthFBO&&(P.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height])):(this.emptyDepthBufferTexture.bind(E.NEAREST,E.CLAMP_TO_EDGE),P.u_depth_size_inv=[1,1]),x&&x.useMeterToDem&&N){const Z=(1<<N.tileID.canonical.z)*g.mercatorZfromAltitude(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;P.u_meter_to_dem=Z}if(x&&x.labelPlaneMatrixInv&&(P.u_label_plane_matrix_inv=x.labelPlaneMatrixInv),p.setTerrainUniformValues(M,P),"globe"===this.painter.transform.projection.name){const Z=this.globeUniformValues(this.painter.transform,u.tileID.canonical,x&&x.useDenormalizedUpVectorScale);p.setGlobeUniformValues(M,Z)}}globeUniformValues(u,p,x){const M=u.projection;return{u_tile_tl_up:M.upVector(p,0,0),u_tile_tr_up:M.upVector(p,g.EXTENT,0),u_tile_br_up:M.upVector(p,g.EXTENT,g.EXTENT),u_tile_bl_up:M.upVector(p,0,g.EXTENT),u_tile_up_scale:x?g.GLOBE_METERS_TO_ECEF:M.upVectorScale(p,u.center.lat,u.worldSize).metersToTile}}renderToBackBuffer(u){const p=this.painter,x=this.painter.context;0!==u.length&&(x.bindFramebuffer.set(null),x.viewport.set([0,0,p.width,p.height]),p.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(M,E,P,O,N){if("globe"===M.transform.projection.name)!function(U,H,Z,Q,oe){const ie=U.context,le=ie.gl;let re,ne;const ue=U.options.showTerrainWireframe?2:0,se=U.transform,Me=g.globeUseCustomAntiAliasing(U,ie,se),Se=(We,Fe)=>{if(ne===We)return;const $t=[Dd[We],"PROJECTION_GLOBE_VIEW"];Me&&$t.push("CUSTOM_ANTIALIASING"),Fe&&$t.push(Dd[ue]),re=U.useProgram("globeRaster",null,$t),ne=We},ge=U.colorModeForRenderPass(),De=new g.DepthMode(le.LEQUAL,g.DepthMode.ReadWrite,U.depthRangeFor3D);Gn.update(oe);const Ue=g.calculateGlobeMercatorMatrix(se),Ke=[g.mercatorXfromLng(se.center.lng),g.mercatorYfromLat(se.center.lat)],je=ue?[!1,!0]:[!1],St=U.globeSharedBuffers,Ne=[se.width*g.exported.devicePixelRatio,se.height*g.exported.devicePixelRatio],pt=Float32Array.from(se.globeMatrix),ht={useDenormalizedUpVectorScale:!0};if(je.forEach(We=>{ne=-1;const Fe=We?le.LINES:le.TRIANGLES;for(const $t of Q){const Ft=Z.getTile($t),kt=g.StencilMode.disabled,Bt=H.prevTerrainTileForTile[$t.key],un=H.terrainTileForTile[$t.key];Td(Bt,un)&&Gn.newMorphing($t.key,Bt,un,oe,250),ie.activeTexture.set(le.TEXTURE0),Ft.texture.bind(le.LINEAR,le.CLAMP_TO_EDGE);const Nn=Gn.getMorphValuesForProxy($t.key),Tn=Nn?1:0;Nn&&g.extend$1(ht,{morphing:{srcDemTile:Nn.from,dstDemTile:Nn.to,phase:g.easeCubicInOut(Nn.phase)}});const mn=g.tileCornersToBounds($t.canonical),Lt=g.getLatitudinalLod(mn.getCenter().lat),qn=g.getGridMatrix($t.canonical,mn,Lt,se.worldSize/se._pixelsPerMercatorPixel),di=g.globeNormalizeECEF(g.globeTileBounds($t.canonical)),ur=Ah(se.projMatrix,pt,Ue,di,g.globeToMercatorTransition(se.zoom),Ke,se.frustumCorners.TL,se.frustumCorners.TR,se.frustumCorners.BR,se.frustumCorners.BL,se.globeCenterInViewSpace,se.globeRadius,Ne,qn);if(Se(Tn,We),H.setupElevationDraw(Ft,re,ht),U.prepareDrawProgram(ie,re,$t.toUnwrapped()),St){const[dr,Yi,Rs]=We?St.getWirefameBuffers(U.context,Lt):St.getGridBuffers(Lt);re.draw(ie,Fe,De,kt,ge,g.CullFaceMode.backCCW,ur,"globe_raster",dr,Yi,Rs)}}}),St){const We=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];Me&&We.push("CUSTOM_ANTIALIASING"),re=U.useProgram("globeRaster",null,We);for(const Fe of Q){const{x:$t,y:Ft,z:kt}=Fe.canonical,Bt=0===Ft,un=Ft===(1<<kt)-1,[Nn,Tn,mn,Lt]=St.getPoleBuffers(kt);if(Lt&&(Bt||un)){const qn=Z.getTile(Fe);ie.activeTexture.set(le.TEXTURE0),qn.texture.bind(le.LINEAR,le.CLAMP_TO_EDGE);let di=g.globePoleMatrixForTile(kt,$t,se);const ur=g.globeNormalizeECEF(g.globeTileBounds(Fe.canonical)),dr=(Yi,Rs)=>Yi.draw(ie,le.TRIANGLES,De,g.StencilMode.disabled,ge,g.CullFaceMode.disabled,Ah(se.projMatrix,di,di,ur,0,Ke,se.frustumCorners.TL,se.frustumCorners.TR,se.frustumCorners.BR,se.frustumCorners.BL,se.globeCenterInViewSpace,se.globeRadius,Ne),"globe_pole_raster",Rs,mn,Lt);H.setupElevationDraw(qn,re,ht),U.prepareDrawProgram(ie,re,Fe.toUnwrapped()),Bt&&dr(re,Nn),un&&(di=g.scale(g.create(),di,[1,-1,1]),dr(re,Tn))}}}}(M,E,P,O,N);else{const U=M.context,H=U.gl;let Z,Q;const oe=M.options.showTerrainWireframe?2:0,ie=(se,Me)=>{if(Q===se)return;const Se=[Dd[se]];Me&&Se.push(Dd[oe]),Z=M.useProgram("terrainRaster",null,Se),Q=se},le=M.colorModeForRenderPass(),re=new g.DepthMode(H.LEQUAL,g.DepthMode.ReadWrite,M.depthRangeFor3D);Gn.update(N);const ne=M.transform,ue=6*Math.pow(1.5,22-ne.zoom)*E.exaggeration();(oe?[!1,!0]:[!1]).forEach(se=>{Q=-1;const Me=se?H.LINES:H.TRIANGLES,[Se,ge]=se?E.getWirefameBuffer():[E.gridIndexBuffer,E.gridSegments];for(const De of O){const Ue=P.getTile(De),Ke=g.StencilMode.disabled,je=E.prevTerrainTileForTile[De.key],St=E.terrainTileForTile[De.key];Td(je,St)&&Gn.newMorphing(De.key,je,St,N,250),U.activeTexture.set(H.TEXTURE0),Ue.texture.bind(H.LINEAR,H.CLAMP_TO_EDGE,H.LINEAR_MIPMAP_NEAREST);const Ne=Gn.getMorphValuesForProxy(De.key),pt=Ne?1:0;let ht;Ne&&(ht={morphing:{srcDemTile:Ne.from,dstDemTile:Ne.to,phase:g.easeCubicInOut(Ne.phase)}});const We=Am(De.projMatrix,Oi(De.canonical,ne.renderWorldCopies)?ue/10:ue);ie(pt,se),E.setupElevationDraw(Ue,Z,ht),M.prepareDrawProgram(U,Z,De.toUnwrapped()),Z.draw(U,Me,re,Ke,le,g.CullFaceMode.backCCW,We,"terrain_raster",E.gridBuffer,Se,ge)}})}}(p,this,this.proxySourceCache,u,this._updateTimestamp),this.renderingToTexture=!0,p.gpuTimingDeferredRenderEnd(),u.splice(0,u.length))}renderBatch(u){if(0===this._drapedRenderBatches.length)return u+1;this.renderingToTexture=!0;const p=this.painter,x=this.painter.context,M=this.proxySourceCache,E=this.proxiedCoords[M.id],P=this._drapedRenderBatches.shift(),O=[],N=p.style.order;let U=0;for(const H of E){const Z=M.getTileByID(H.proxyTileKey),Q=M.proxyCachedFBO[H.key]?M.proxyCachedFBO[H.key][u]:void 0,oe=void 0!==Q?M.renderCache[Q]:this.pool[U++],ie=void 0!==Q;if(Z.texture=oe.tex,ie&&!oe.dirty){O.push(Z.tileID);continue}let le;x.bindFramebuffer.set(oe.fb.framebuffer),this.renderedToTile=!1,oe.dirty&&(x.clear({color:g.Color.transparent,stencil:0}),oe.dirty=!1);for(let re=P.start;re<=P.end;++re){const ne=p.style._layers[N[re]];if(ne.isHidden(p.transform.zoom))continue;const ue=p.style._getLayerSourceCache(ne),se=ue?this.proxyToSource[H.key][ue.id]:[H];if(!se)continue;const Me=se;x.viewport.set([0,0,oe.fb.width,oe.fb.height]),le!==(ue?ue.id:null)&&(this._setupStencil(oe,se,ne,ue),le=ue?ue.id:null),p.renderLayer(p,ue,ne,Me)}this.renderedToTile?(oe.dirty=!0,O.push(Z.tileID)):ie||--U,5===U&&(U=0,this.renderToBackBuffer(O))}return this.renderToBackBuffer(O),this.renderingToTexture=!1,x.bindFramebuffer.set(null),x.viewport.set([0,0,p.width,p.height]),P.end+1}postRender(){}renderCacheEfficiency(u){const p=u.order.length;if(0===p)return{efficiency:100};let x,M=0,E=0,P=!1;for(let O=0;O<p;++O){const N=u._layers[u.order[O]];this._style.isLayerDraped(N)?(P&&++M,++E):P||(P=!0,x=N.id)}return 0===E?{efficiency:100}:{efficiency:100*(1-M/E),firstUndrapedLayer:x}}getMinElevationBelowMSL(){let u=0;return this._visibleDemTiles.filter(p=>p.dem).forEach(p=>{u=Math.min(u,p.dem.tree.minimums[0])}),0===u?u:(u-30)*this._exaggeration}raycast(u,p,x){if(!this._visibleDemTiles)return null;const M=this._visibleDemTiles.filter(E=>E.dem).map(E=>{const P=E.tileID,O=1<<P.overscaledZ,{x:N,y:U}=P.canonical,H=N/O,Z=(N+1)/O,Q=U/O,oe=(U+1)/O;return{minx:H,miny:Q,maxx:Z,maxy:oe,t:E.dem.tree.raycastRoot(H,Q,Z,oe,u,p,x),tile:E}});M.sort((E,P)=>(null!==E.t?E.t:Number.MAX_VALUE)-(null!==P.t?P.t:Number.MAX_VALUE));for(const E of M){if(null==E.t)return null;const P=E.tile.dem.tree.raycast(E.minx,E.miny,E.maxx,E.maxy,u,p,x);if(null!=P)return P}return null}_createFBO(){const u=this.painter.context,p=u.gl,x=this.drapeBufferSize;u.activeTexture.set(p.TEXTURE0);const M=new g.Texture(u,{width:x[0],height:x[1],data:null},p.RGBA);M.bind(p.LINEAR,p.CLAMP_TO_EDGE);const E=u.createFramebuffer(x[0],x[1],!1);return E.colorAttachment.set(M.texture),E.depthAttachment=new ws(u,E.framebuffer),void 0===this._sharedDepthStencil?(this._sharedDepthStencil=u.createRenderbuffer(u.gl.DEPTH_STENCIL,x[0],x[1]),this._stencilRef=0,E.depthAttachment.set(this._sharedDepthStencil),u.clear({stencil:0})):E.depthAttachment.set(this._sharedDepthStencil),u.extTextureFilterAnisotropic&&!u.extTextureFilterAnisotropicForceOff&&p.texParameterf(p.TEXTURE_2D,u.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,u.extTextureFilterAnisotropicMax),{fb:E,tex:M,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._style.light&&this._style.light.hasTransition())return!0;for(const u in this._style._sourceCaches)if(this._style._sourceCaches[u].hasTransition())return!0;return this._style.order.some(u=>{const p=this._style._layers[u],x=p.isHidden(this.painter.transform.zoom),M=p.getCrossfadeParameters(),E=!!M&&1!==M.t,P=p.hasTransition();return"custom"!==p.type&&!x&&(E||P)})}_clearRasterFadeFromRenderCache(){let u=!1;for(const p in this._style._sourceCaches)if(this._style._sourceCaches[p]._source instanceof K){u=!0;break}if(u)for(let p=0;p<this._style.order.length;++p){const x=this._style._layers[this._style.order[p]],M=x.isHidden(this.painter.transform.zoom),E=this._style._getLayerSourceCache(x);if("raster"!==x.type||M||!E)continue;const P=x.paint.get("raster-fade-duration");for(const O of this.proxyCoords){const N=this.proxyToSource[O.key][E.id];if(N)for(const U of N){const H=co(E.getTile(U),E.findLoadedParent(U,0),E,this.painter.transform,P);(1!==H.opacity||0!==H.mix)&&this._clearRenderCacheForTile(E.id,U)}}}}_setupDrapedRenderBatches(){const u=this._style.order,p=u.length;if(0===p)return;const x=[];let M,E=0,P=this._style._layers[u[E]];for(;!this._style.isLayerDraped(P)&&P.isHidden(this.painter.transform.zoom)&&++E<p;)P=this._style._layers[u[E]];for(;E<p;++E){const O=this._style._layers[u[E]];O.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(O)?void 0===M&&(M=E):void 0!==M&&(x.push({start:M,end:E-1}),M=void 0))}void 0!==M&&x.push({start:M,end:E-1}),this._drapedRenderBatches=x}_setupRenderCache(u){const p=this.proxySourceCache;if(this._shouldDisableRenderCache()||this._invalidateRenderCache){if(this._invalidateRenderCache=!1,p.renderCache.length>p.renderCachePool.length){const P=Object.values(p.proxyCachedFBO);p.proxyCachedFBO={};for(let O=0;O<P.length;++O){const N=Object.values(P[O]);p.renderCachePool.push(...N)}}return}this._clearRasterFadeFromRenderCache();const x=this.proxyCoords,M=this._tilesDirty;for(let P=x.length-1;P>=0;P--){const O=x[P];if(p.getTileByID(O.key),void 0!==p.proxyCachedFBO[O.key]){const N=u[O.key],U=this.proxyToSource[O.key];let H=0;for(const Z in U){const Q=U[Z],oe=N[Z];if(!oe||oe.length!==Q.length||Q.some((ie,le)=>ie!==oe[le]||M[Z]&&M[Z].hasOwnProperty(ie.key))){H=-1;break}++H}for(const Z in p.proxyCachedFBO[O.key])p.renderCache[p.proxyCachedFBO[O.key][Z]].dirty=H<0||H!==Object.values(N).length}}const E=[...this._drapedRenderBatches];E.sort((P,O)=>O.end-O.start-(P.end-P.start));for(const P of E)for(const O of x){if(p.proxyCachedFBO[O.key])continue;let N=p.renderCachePool.pop();void 0===N&&p.renderCache.length<50&&(N=p.renderCache.length,p.renderCache.push(this._createFBO())),void 0!==N&&(p.proxyCachedFBO[O.key]={},p.proxyCachedFBO[O.key][P.start]=N,p.renderCache[N].dirty=!0)}this._tilesDirty={}}_setupStencil(u,p,x,M){if(!M||!this._sourceTilesOverlap[M.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const E=this.painter.context,P=E.gl;if(p.length<=1)return void(this._overlapStencilType=!1);let O;if(x.isTileClipped())O=p.length,this._overlapStencilMode.test={func:P.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(p[0].overscaledZ>p[p.length-1].overscaledZ))return void(this._overlapStencilType=!1);O=1,this._overlapStencilMode.test={func:P.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+O>255&&(E.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=O,this._overlapStencilMode.ref=this._stencilRef,x.isTileClipped()&&this._renderTileClippingMasks(p,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return"Clip"===this._overlapStencilType||"Mask"===this._overlapStencilType}stencilModeForRTTOverlap(u){return this.renderingToTexture&&this._overlapStencilType?("Clip"===this._overlapStencilType&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[u.key]),this._overlapStencilMode):g.StencilMode.disabled}_renderTileClippingMasks(u,p){const x=this.painter,M=this.painter.context,E=M.gl;x._tileClippingMaskIDs={},M.setColorMode(g.ColorMode.disabled),M.setDepthMode(g.DepthMode.disabled);const P=x.useProgram("clippingMask");for(const O of u){const N=x._tileClippingMaskIDs[O.key]=--p;P.draw(M,E.TRIANGLES,g.DepthMode.disabled,new g.StencilMode({func:E.ALWAYS,mask:0},N,255,E.KEEP,E.KEEP,E.REPLACE),g.ColorMode.disabled,g.CullFaceMode.disabled,an(O.projMatrix),"$clipping",x.tileExtentBuffer,x.quadTriangleIndexBuffer,x.tileExtentSegments)}}pointCoordinate(u){const p=this.painter.transform;if(u.x<0||u.x>p.width||u.y<0||u.y>p.height)return null;const x=[u.x,u.y,1,1];g.transformMat4$1(x,x,p.pixelMatrixInverse),g.scale$1(x,x,1/x[3]),x[0]/=p.worldSize,x[1]/=p.worldSize;const M=p._camera.position,E=g.mercatorZfromAltitude(1,p.center.lat),P=[M[0],M[1],M[2]/E,0],O=g.subtract([],x.slice(0,3),P);g.normalize(O,O);const N=this.raycast(P,O,this._exaggeration);return null!==N&&N?(g.scaleAndAdd(P,P,O,N),P[3]=P[2],P[2]*=E,P):null}drawDepth(){const u=this.painter,p=u.context,x=this.proxySourceCache,M=Math.ceil(u.width),E=Math.ceil(u.height);if(!this._depthFBO||this._depthFBO.width===M&&this._depthFBO.height===E||(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),!this._depthFBO){const P=p.gl,O=p.createFramebuffer(M,E,!0);p.activeTexture.set(P.TEXTURE0);const N=new g.Texture(p,{width:M,height:E,data:null},P.RGBA);N.bind(P.NEAREST,P.CLAMP_TO_EDGE),O.colorAttachment.set(N.texture);const U=p.createRenderbuffer(p.gl.DEPTH_COMPONENT16,M,E);O.depthAttachment.set(U),this._depthFBO=O,this._depthTexture=N}p.bindFramebuffer.set(this._depthFBO.framebuffer),p.viewport.set([0,0,M,E]),function(P,O,N,U){if("globe"===P.transform.projection.name)return;const H=P.context,Z=H.gl;H.clear({depth:1});const Q=P.useProgram("terrainDepth"),oe=new g.DepthMode(Z.LESS,g.DepthMode.ReadWrite,P.depthRangeFor3D);for(const ie of U){const le=N.getTile(ie),re=Am(ie.projMatrix,0);O.setupElevationDraw(le,Q),Q.draw(H,Z.TRIANGLES,oe,g.StencilMode.disabled,g.ColorMode.unblended,g.CullFaceMode.backCCW,re,"terrain_depth",O.gridBuffer,O.gridIndexBuffer,O.gridNoSkirtSegments)}}(u,this,x,this.proxyCoords)}_setupProxiedCoordsForOrtho(u,p,x){if(u.getSource()instanceof Re)return this._setupProxiedCoordsForImageSource(u,p,x);this._findCoveringTileCache[u.id]=this._findCoveringTileCache[u.id]||{};const M=this.proxiedCoords[u.id]=[],E=this.proxyCoords;for(let O=0;O<E.length;O++){const N=E[O],U=this._findTileCoveringTileID(N,u);if(U){const H=this._createProxiedId(N,U,x[N.key]&&x[N.key][u.id]);M.push(H),this.proxyToSource[N.key][u.id]=[H]}}let P=!1;for(let O=0;O<p.length;O++){const N=u.getTile(p[O]);if(!N||!N.hasData())continue;const U=this._findTileCoveringTileID(N.tileID,this.proxySourceCache);if(U&&U.tileID.canonical.z!==N.tileID.canonical.z){const H=this.proxyToSource[U.tileID.key][u.id],Z=this._createProxiedId(U.tileID,N,x[U.tileID.key]&&x[U.tileID.key][u.id]);H?H.splice(H.length-1,0,Z):this.proxyToSource[U.tileID.key][u.id]=[Z],M.push(Z),P=!0}}this._sourceTilesOverlap[u.id]=P}_setupProxiedCoordsForImageSource(u,p,x){if(!u.getSource().loaded())return;const M=this.proxiedCoords[u.id]=[],E=this.proxyCoords,P=u.getSource(),O=new g.pointGeometry(P.tileID.x,P.tileID.y)._div(1<<P.tileID.z),N=P.coordinates.map(g.MercatorCoordinate.fromLngLat).reduce((H,Z)=>(H.min.x=Math.min(H.min.x,Z.x-O.x),H.min.y=Math.min(H.min.y,Z.y-O.y),H.max.x=Math.max(H.max.x,Z.x-O.x),H.max.y=Math.max(H.max.y,Z.y-O.y),H),{min:new g.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE),max:new g.pointGeometry(-Number.MAX_VALUE,-Number.MAX_VALUE)}),U=(H,Z)=>{const Q=H.wrap+H.canonical.x/(1<<H.canonical.z),oe=H.canonical.y/(1<<H.canonical.z),ie=g.EXTENT/(1<<H.canonical.z),le=Z.wrap+Z.canonical.x/(1<<Z.canonical.z),re=Z.canonical.y/(1<<Z.canonical.z);return Q+ie<le+N.min.x||Q>le+N.max.x||oe+ie<re+N.min.y||oe>re+N.max.y};for(let H=0;H<E.length;H++){const Z=E[H];for(let Q=0;Q<p.length;Q++){const oe=u.getTile(p[Q]);if(!oe||!oe.hasData()||U(Z,oe.tileID))continue;const ie=this._createProxiedId(Z,oe,x[Z.key]&&x[Z.key][u.id]),le=this.proxyToSource[Z.key][u.id];le?le.push(ie):this.proxyToSource[Z.key][u.id]=[ie],M.push(ie)}}}_createProxiedId(u,p,x){let M=this.orthoMatrix;if(x){const E=x.find(P=>P.key===p.tileID.key);if(E)return E}if(p.tileID.key!==u.key){const E=u.canonical.z-p.tileID.canonical.z;let P,O,N;M=g.create();const U=p.tileID.wrap-u.wrap<<u.overscaledZ;E>0?(P=g.EXTENT>>E,O=P*((p.tileID.canonical.x<<E)-u.canonical.x+U),N=P*((p.tileID.canonical.y<<E)-u.canonical.y)):(P=g.EXTENT<<-E,O=g.EXTENT*(p.tileID.canonical.x-(u.canonical.x+U<<-E)),N=g.EXTENT*(p.tileID.canonical.y-(u.canonical.y<<-E))),g.ortho(M,0,P,0,P,0,1),g.translate(M,M,[O,N,0])}return new Bs(p.tileID,u.key,M)}_findTileCoveringTileID(u,p){let x=p.getTile(u);if(x&&x.hasData())return x;const M=this._findCoveringTileCache[p.id],E=M[u.key];if(x=E?p.getTileByID(E):null,x&&x.hasData()||null===E)return x;let P=x?x.tileID:u,O=P.overscaledZ;const N=p.getSource().minzoom,U=[];if(!E){const Z=p.getSource().maxzoom;if(u.canonical.z>=Z){const Q=u.canonical.z-Z;p.getSource().reparseOverscaled?(O=Math.max(u.canonical.z+2,p.transform.tileZoom),P=new g.OverscaledTileID(O,u.wrap,Z,u.canonical.x>>Q,u.canonical.y>>Q)):0!==Q&&(O=Z,P=new g.OverscaledTileID(O,u.wrap,Z,u.canonical.x>>Q,u.canonical.y>>Q))}P.key!==u.key&&(U.push(P.key),x=p.getTile(P))}const H=Z=>{U.forEach(Q=>{M[Q]=Z}),U.length=0};for(O-=1;O>=N&&(!x||!x.hasData());O--){x&&H(x.tileID.key);const Z=P.calculateScaledKey(O);if(x=p.getTileByID(Z),x&&x.hasData())break;const Q=M[Z];if(null===Q)break;void 0===Q?U.push(Z):x=p.getTileByID(Q)}return H(x?x.tileID.key:null),x&&x.hasData()?x:null}findDEMTileFor(u){return this.enabled?this._findTileCoveringTileID(u,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(u,p){let x=this._tilesDirty[u];x||(x=this._tilesDirty[u]={}),x[p.key]=!0}getWirefameBuffer(){if(!this.wireframeSegments){const u=function(p){let x=0;const M=new g.StructArrayLayout2ui4,E=131;for(let P=1;P<129;P++){for(let O=1;O<129;O++)x=P*E+O,M.emplaceBack(x,x+1),M.emplaceBack(x,x+E),M.emplaceBack(x+1,x+E),128===P&&M.emplaceBack(x+E,x+E+1);M.emplaceBack(x+1,x+1+E)}return M}();this.wireframeIndexBuffer=this.painter.context.createIndexBuffer(u),this.wireframeSegments=g.SegmentVector.simpleSegment(0,0,this.gridBuffer.length,u.length)}return[this.wireframeIndexBuffer,this.wireframeSegments]}}class Xo{static cacheKey(u,p,x,M){let E=`${p}${M?M.cacheKey:""}`;for(const P of x)u.usedDefines.includes(P)&&(E+=`/${P}`);return E}constructor(u,p,x,M,E,P){const O=u.gl;this.program=O.createProgram();const N=function(re){const ne=[];for(let ue=0;ue<re.length;ue++){if(null===re[ue])continue;const se=re[ue].split(" ");ne.push(se.pop())}return ne}(x.staticAttributes),U=M?M.getBinderAttributes():[],H=N.concat(U);let Z=M?M.defines():[];Z=Z.concat(P.map(re=>`#define ${re}`));const Q=Z.concat(u.extStandardDerivatives?"#extension GL_OES_standard_derivatives : enable\n".concat(ic):ic,ic,I_,A_.fragmentSource,pa.fragmentSource,x.fragmentSource).join("\n"),oe=Z.concat("\n#ifdef GL_ES\nprecision highp float;\n#else\n\n#if !defined(lowp)\n#define lowp\n#endif\n\n#if !defined(mediump)\n#define mediump\n#endif\n\n#if !defined(highp)\n#define highp\n#endif\n\n#endif",I_,A_.vertexSource,pa.vertexSource,D_.vertexSource,x.vertexSource).join("\n"),ie=O.createShader(O.FRAGMENT_SHADER);if(O.isContextLost())return void(this.failedToCreate=!0);O.shaderSource(ie,Q),O.compileShader(ie),O.attachShader(this.program,ie);const le=O.createShader(O.VERTEX_SHADER);if(O.isContextLost())this.failedToCreate=!0;else{O.shaderSource(le,oe),O.compileShader(le),O.attachShader(this.program,le),this.attributes={},this.numAttributes=H.length;for(let re=0;re<this.numAttributes;re++)H[re]&&(O.bindAttribLocation(this.program,re,H[re]),this.attributes[H[re]]=re);O.linkProgram(this.program),O.deleteShader(le),O.deleteShader(ie),this.fixedUniforms=E(u),this.binderUniforms=M?M.getUniforms(u):[],P.includes("TERRAIN")&&(this.terrainUniforms={u_dem:new g.Uniform1i(re=u),u_dem_prev:new g.Uniform1i(re),u_dem_unpack:new g.Uniform4f(re),u_dem_tl:new g.Uniform2f(re),u_dem_scale:new g.Uniform1f(re),u_dem_tl_prev:new g.Uniform2f(re),u_dem_scale_prev:new g.Uniform1f(re),u_dem_size:new g.Uniform1f(re),u_dem_lerp:new g.Uniform1f(re),u_exaggeration:new g.Uniform1f(re),u_depth:new g.Uniform1i(re),u_depth_size_inv:new g.Uniform2f(re),u_meter_to_dem:new g.Uniform1f(re),u_label_plane_matrix_inv:new g.UniformMatrix4f(re)}),P.includes("GLOBE")&&(this.globeUniforms=(re=>({u_tile_tl_up:new g.Uniform3f(re),u_tile_tr_up:new g.Uniform3f(re),u_tile_br_up:new g.Uniform3f(re),u_tile_bl_up:new g.Uniform3f(re),u_tile_up_scale:new g.Uniform1f(re)}))(u)),P.includes("FOG")&&(this.fogUniforms=(re=>({u_fog_matrix:new g.UniformMatrix4f(re),u_fog_range:new g.Uniform2f(re),u_fog_color:new g.Uniform4f(re),u_fog_horizon_blend:new g.Uniform1f(re),u_fog_temporal_offset:new g.Uniform1f(re),u_frustum_tl:new g.Uniform3f(re),u_frustum_tr:new g.Uniform3f(re),u_frustum_br:new g.Uniform3f(re),u_frustum_bl:new g.Uniform3f(re),u_globe_pos:new g.Uniform3f(re),u_globe_radius:new g.Uniform1f(re),u_globe_transition:new g.Uniform1f(re),u_is_globe:new g.Uniform1i(re),u_viewport:new g.Uniform2f(re)}))(u))}var re}setTerrainUniformValues(u,p){if(!this.terrainUniforms)return;const x=this.terrainUniforms;if(!this.failedToCreate){u.program.set(this.program);for(const M in p)x[M]&&x[M].set(this.program,M,p[M])}}setGlobeUniformValues(u,p){if(!this.globeUniforms)return;const x=this.globeUniforms;if(!this.failedToCreate){u.program.set(this.program);for(const M in p)x[M]&&x[M].set(this.program,M,p[M])}}setFogUniformValues(u,p){if(!this.fogUniforms)return;const x=this.fogUniforms;if(!this.failedToCreate){u.program.set(this.program);for(const M in p)x[M].set(this.program,M,p[M])}}draw(u,p,x,M,E,P,O,N,U,H,Z,Q,oe,ie,le){const re=u.gl;if(this.failedToCreate)return;u.program.set(this.program),u.setDepthMode(x),u.setStencilMode(M),u.setColorMode(E),u.setCullFace(P);for(const ue of Object.keys(this.fixedUniforms))this.fixedUniforms[ue].set(this.program,ue,O[ue]);ie&&ie.setUniforms(this.program,u,this.binderUniforms,Q,{zoom:oe});const ne={[re.LINES]:2,[re.TRIANGLES]:3,[re.LINE_STRIP]:1}[p];for(const ue of Z.get()){const se=ue.vaos||(ue.vaos={});(se[N]||(se[N]=new Lu)).bind(u,this,U,ie?ie.getPaintVertexBuffers():[],H,ue.vertexOffset,le||[]),re.drawElements(p,ue.primitiveLength*ne,re.UNSIGNED_SHORT,ue.primitiveOffset*ne*2)}}}function ma(_,u,p){const x=1/Pl(p,1,u.transform.tileZoom),M=Math.pow(2,p.tileID.overscaledZ),E=p.tileSize*Math.pow(2,u.transform.tileZoom)/M,P=E*(p.tileID.canonical.x+p.tileID.wrap*M),O=E*p.tileID.canonical.y;return{u_image:0,u_texsize:p.imageAtlasTexture.size,u_scale:[x,_.fromScale,_.toScale],u_fade:_.t,u_pixel_coord_upper:[P>>16,O>>16],u_pixel_coord_lower:[65535&P,65535&O]}}const hn=g.create(),yi=(_,u,p,x,M,E,P,O,N,U,H)=>{const Z=u.style.light,Q=Z.properties.get("position"),oe=[Q.x,Q.y,Q.z],ie=g.create$1();"viewport"===Z.properties.get("anchor")&&(g.fromRotation(ie,-u.transform.angle),g.transformMat3(oe,oe,ie));const le=Z.properties.get("color"),re=u.transform,ne={u_matrix:_,u_lightpos:oe,u_lightintensity:Z.properties.get("intensity"),u_lightcolor:[le.r,le.g,le.b],u_vertical_gradient:+p,u_opacity:x,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:hn,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_ao:M,u_edge_radius:E};return"globe"===re.projection.name&&(ne.u_tile_id=[P.canonical.x,P.canonical.y,1<<P.canonical.z],ne.u_zoom_transition=N,ne.u_inv_rot_matrix=H,ne.u_merc_center=U,ne.u_up_dir=re.projection.upVector(new g.CanonicalTileID(0,0,0),U[0]*g.EXTENT,U[1]*g.EXTENT),ne.u_height_lift=O),ne},Ur=(_,u,p,x,M,E,P,O,N,U,H,Z,Q)=>{const oe=yi(_,u,p,x,M,E,P,U,H,Z,Q),ie={u_height_factor:-Math.pow(2,P.overscaledZ)/N.tileSize/8};return g.extend(oe,ma(O,u,N),ie)},ho=_=>({u_matrix:_}),rc=(_,u,p,x)=>g.extend(ho(_),ma(p,u,x)),Ts=(_,u)=>({u_matrix:_,u_world:u}),Fu=(_,u,p,x,M)=>g.extend(rc(_,u,p,x),{u_world:M}),Hr=g.create(),sc=(_,u,p,x,M,E)=>{const P=_.transform,O="globe"===P.projection.name;let N;if("map"===E.paint.get("circle-pitch-alignment"))if(O){const H=g.globePixelsToTileUnits(P.zoom,u.canonical)*P._pixelsPerMercatorPixel;N=Float32Array.from([H,0,0,H])}else N=P.calculatePixelsToTileUnitsMatrix(p);else N=new Float32Array([P.pixelsToGLUnits[0],0,0,P.pixelsToGLUnits[1]]);const U={u_camera_to_center_distance:P.cameraToCenterDistance,u_matrix:_.translatePosMatrix(u.projMatrix,p,E.paint.get("circle-translate"),E.paint.get("circle-translate-anchor")),u_device_pixel_ratio:g.exported.devicePixelRatio,u_extrude_scale:N,u_inv_rot_matrix:Hr,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(O){U.u_inv_rot_matrix=x,U.u_merc_center=M,U.u_tile_id=[u.canonical.x,u.canonical.y,1<<u.canonical.z],U.u_zoom_transition=g.globeToMercatorTransition(P.zoom);const H=M[0]*g.EXTENT,Z=M[1]*g.EXTENT;U.u_up_dir=P.projection.upVector(new g.CanonicalTileID(0,0,0),H,Z)}return U},Ad=_=>{const u=[];return"map"===_.paint.get("circle-pitch-alignment")&&u.push("PITCH_WITH_MAP"),"map"===_.paint.get("circle-pitch-scale")&&u.push("SCALE_WITH_MAP"),u},Mi=(_,u,p,x)=>{const M=g.EXTENT/p.tileSize;return{u_matrix:_,u_camera_to_center_distance:u.getCameraToCenterDistance(x),u_extrude_scale:[u.pixelsToGLUnits[0]/M,u.pixelsToGLUnits[1]/M]}},Nu=(_,u,p=1)=>({u_matrix:_,u_color:u,u_overlay:0,u_overlay_scale:p}),Lo=g.create(),Ih=(_,u,p,x,M,E,P)=>{const O=_.transform,N="globe"===O.projection.name,U=N?g.globePixelsToTileUnits(O.zoom,u.canonical)*O._pixelsPerMercatorPixel:Pl(p,1,E),H={u_matrix:u.projMatrix,u_extrude_scale:U,u_intensity:P,u_inv_rot_matrix:Lo,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(N){H.u_inv_rot_matrix=x,H.u_merc_center=M,H.u_tile_id=[u.canonical.x,u.canonical.y,1<<u.canonical.z],H.u_zoom_transition=g.globeToMercatorTransition(O.zoom);const Z=M[0]*g.EXTENT,Q=M[1]*g.EXTENT;H.u_up_dir=O.projection.upVector(new g.CanonicalTileID(0,0,0),Z,Q)}return H},Hc=(_,u,p,x,M,E,P,O)=>{const N=_.transform,U=N.calculatePixelsToTileUnitsMatrix(u),H={u_matrix:oc(_,u,p,M),u_pixels_to_tile_units:U,u_device_pixel_ratio:P,u_units_to_pixels:[1/N.pixelsToGLUnits[0],1/N.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:E,u_texsize:[0,0],u_scale:[0,0,0],u_mix:0,u_alpha_discard_threshold:0,u_trim_offset:O};if(Fa(p)){const Z=Bu(u,_.transform);H.u_texsize=u.lineAtlasTexture.size,H.u_scale=[Z,x.fromScale,x.toScale],H.u_mix=x.t}return H},zs=(_,u,p,x,M,E)=>{const P=_.transform,O=Bu(u,P);return{u_matrix:oc(_,u,p,M),u_texsize:u.imageAtlasTexture.size,u_pixels_to_tile_units:P.calculatePixelsToTileUnitsMatrix(u),u_device_pixel_ratio:E,u_image:0,u_scale:[O,x.fromScale,x.toScale],u_fade:x.t,u_units_to_pixels:[1/P.pixelsToGLUnits[0],1/P.pixelsToGLUnits[1]],u_alpha_discard_threshold:0}};function Bu(_,u){return 1/Pl(_,1,u.tileZoom)}function oc(_,u,p,x){return _.translatePosMatrix(x||u.tileID.projMatrix,u,p.paint.get("line-translate"),p.paint.get("line-translate-anchor"))}function Fa(_){const u=_.paint.get("line-dasharray").value;return u.value||"constant"!==u.kind}const Gc=(_,u,p,x,M,E)=>{return{u_matrix:_,u_tl_parent:u,u_scale_parent:p,u_fade_t:x.mix,u_opacity:x.opacity*M.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:M.paint.get("raster-brightness-min"),u_brightness_high:M.paint.get("raster-brightness-max"),u_saturation_factor:(O=M.paint.get("raster-saturation"),O>0?1-1/(1.001-O):-O),u_contrast_factor:(P=M.paint.get("raster-contrast"),P>0?1/(1-P):1+P),u_spin_weights:R_(M.paint.get("raster-hue-rotate")),u_perspective_transform:E};var P,O};function R_(_){_*=Math.PI/180;const u=Math.sin(_),p=Math.cos(_);return[(2*p+1)/3,(-Math.sqrt(3)*u-p+1)/3,(Math.sqrt(3)*u-p+1)/3]}const vr=g.create(),k_=(_,u,p,x,M,E,P,O,N,U,H,Z,Q,oe,ie,le)=>{const re=M.transform,ne={u_is_size_zoom_constant:+("constant"===_||"source"===_),u_is_size_feature_constant:+("constant"===_||"camera"===_),u_size_t:u?u.uSizeT:0,u_size:u?u.uSize:0,u_camera_to_center_distance:re.cameraToCenterDistance,u_rotate_symbol:+p,u_aspect_ratio:re.width/re.height,u_fade_change:M.options.fadeDuration?M.symbolFadeChange:1,u_matrix:E,u_label_plane_matrix:P,u_coord_matrix:O,u_is_text:+N,u_pitch_with_map:+x,u_texsize:U,u_texture:0,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:vr,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:vr,u_up_vector:[0,-1,0]};return"globe"===le.name&&(ne.u_tile_id=[H.canonical.x,H.canonical.y,1<<H.canonical.z],ne.u_zoom_transition=Z,ne.u_inv_rot_matrix=oe,ne.u_merc_center=Q,ne.u_camera_forward=re._camera.forward(),ne.u_ecef_origin=g.globeECEFOrigin(re.globeMatrix,H.toUnwrapped()),ne.u_tile_matrix=Float32Array.from(re.globeMatrix),ne.u_up_vector=ie),ne},Wp=(_,u,p,x,M,E,P,O,N,U,H,Z,Q,oe,ie,le,re)=>g.extend(k_(_,u,p,x,M,E,P,O,N,U,Z,Q,oe,ie,le,re),{u_gamma_scale:x?M.transform.cameraToCenterDistance*Math.cos(M.terrain?0:M.transform._pitch):1,u_device_pixel_ratio:g.exported.devicePixelRatio,u_is_halo:+H}),qp=(_,u,p,x,M,E,P,O,N,U,H,Z,Q,oe,ie,le)=>g.extend(Wp(_,u,p,x,M,E,P,O,!0,N,!0,H,Z,Q,oe,ie,le),{u_texsize_icon:U,u_texture_icon:1}),Ph=(_,u,p)=>({u_matrix:_,u_opacity:u,u_color:p}),Rh=(_,u,p,x,M,E)=>g.extend(function(P,O,N,U){const H=N.imageManager.getPattern(P.from.toString()),Z=N.imageManager.getPattern(P.to.toString()),{width:Q,height:oe}=N.imageManager.getPixelSize(),ie=Math.pow(2,U.tileID.overscaledZ),le=U.tileSize*Math.pow(2,N.transform.tileZoom)/ie,re=le*(U.tileID.canonical.x+U.tileID.wrap*ie),ne=le*U.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:H.tl,u_pattern_br_a:H.br,u_pattern_tl_b:Z.tl,u_pattern_br_b:Z.br,u_texsize:[Q,oe],u_mix:O.t,u_pattern_size_a:H.displaySize,u_pattern_size_b:Z.displaySize,u_scale_a:O.fromScale,u_scale_b:O.toScale,u_tile_units_to_pixels:1/Pl(U,1,N.transform.tileZoom),u_pixel_coord_upper:[re>>16,ne>>16],u_pixel_coord_lower:[65535&re,65535&ne]}}(x,E,p,M),{u_matrix:_,u_opacity:u}),zu={fillExtrusion:_=>({u_matrix:new g.UniformMatrix4f(_),u_lightpos:new g.Uniform3f(_),u_lightintensity:new g.Uniform1f(_),u_lightcolor:new g.Uniform3f(_),u_vertical_gradient:new g.Uniform1f(_),u_opacity:new g.Uniform1f(_),u_edge_radius:new g.Uniform1f(_),u_ao:new g.Uniform2f(_),u_tile_id:new g.Uniform3f(_),u_zoom_transition:new g.Uniform1f(_),u_inv_rot_matrix:new g.UniformMatrix4f(_),u_merc_center:new g.Uniform2f(_),u_up_dir:new g.Uniform3f(_),u_height_lift:new g.Uniform1f(_)}),fillExtrusionPattern:_=>({u_matrix:new g.UniformMatrix4f(_),u_lightpos:new g.Uniform3f(_),u_lightintensity:new g.Uniform1f(_),u_lightcolor:new g.Uniform3f(_),u_vertical_gradient:new g.Uniform1f(_),u_height_factor:new g.Uniform1f(_),u_edge_radius:new g.Uniform1f(_),u_ao:new g.Uniform2f(_),u_tile_id:new g.Uniform3f(_),u_zoom_transition:new g.Uniform1f(_),u_inv_rot_matrix:new g.UniformMatrix4f(_),u_merc_center:new g.Uniform2f(_),u_up_dir:new g.Uniform3f(_),u_height_lift:new g.Uniform1f(_),u_image:new g.Uniform1i(_),u_texsize:new g.Uniform2f(_),u_pixel_coord_upper:new g.Uniform2f(_),u_pixel_coord_lower:new g.Uniform2f(_),u_scale:new g.Uniform3f(_),u_fade:new g.Uniform1f(_),u_opacity:new g.Uniform1f(_)}),fill:_=>({u_matrix:new g.UniformMatrix4f(_)}),fillPattern:_=>({u_matrix:new g.UniformMatrix4f(_),u_image:new g.Uniform1i(_),u_texsize:new g.Uniform2f(_),u_pixel_coord_upper:new g.Uniform2f(_),u_pixel_coord_lower:new g.Uniform2f(_),u_scale:new g.Uniform3f(_),u_fade:new g.Uniform1f(_)}),fillOutline:_=>({u_matrix:new g.UniformMatrix4f(_),u_world:new g.Uniform2f(_)}),fillOutlinePattern:_=>({u_matrix:new g.UniformMatrix4f(_),u_world:new g.Uniform2f(_),u_image:new g.Uniform1i(_),u_texsize:new g.Uniform2f(_),u_pixel_coord_upper:new g.Uniform2f(_),u_pixel_coord_lower:new g.Uniform2f(_),u_scale:new g.Uniform3f(_),u_fade:new g.Uniform1f(_)}),circle:_=>({u_camera_to_center_distance:new g.Uniform1f(_),u_extrude_scale:new g.UniformMatrix2f(_),u_device_pixel_ratio:new g.Uniform1f(_),u_matrix:new g.UniformMatrix4f(_),u_inv_rot_matrix:new g.UniformMatrix4f(_),u_merc_center:new g.Uniform2f(_),u_tile_id:new g.Uniform3f(_),u_zoom_transition:new g.Uniform1f(_),u_up_dir:new g.Uniform3f(_)}),collisionBox:_=>({u_matrix:new g.UniformMatrix4f(_),u_camera_to_center_distance:new g.Uniform1f(_),u_extrude_scale:new g.Uniform2f(_)}),collisionCircle:_=>({u_matrix:new g.UniformMatrix4f(_),u_inv_matrix:new g.UniformMatrix4f(_),u_camera_to_center_distance:new g.Uniform1f(_),u_viewport_size:new g.Uniform2f(_)}),debug:_=>({u_color:new g.UniformColor(_),u_matrix:new g.UniformMatrix4f(_),u_overlay:new g.Uniform1i(_),u_overlay_scale:new g.Uniform1f(_)}),clippingMask:_=>({u_matrix:new g.UniformMatrix4f(_)}),heatmap:_=>({u_extrude_scale:new g.Uniform1f(_),u_intensity:new g.Uniform1f(_),u_matrix:new g.UniformMatrix4f(_),u_inv_rot_matrix:new g.UniformMatrix4f(_),u_merc_center:new g.Uniform2f(_),u_tile_id:new g.Uniform3f(_),u_zoom_transition:new g.Uniform1f(_),u_up_dir:new g.Uniform3f(_)}),heatmapTexture:_=>({u_image:new g.Uniform1i(_),u_color_ramp:new g.Uniform1i(_),u_opacity:new g.Uniform1f(_)}),hillshade:_=>({u_matrix:new g.UniformMatrix4f(_),u_image:new g.Uniform1i(_),u_latrange:new g.Uniform2f(_),u_light:new g.Uniform2f(_),u_shadow:new g.UniformColor(_),u_highlight:new g.UniformColor(_),u_accent:new g.UniformColor(_)}),hillshadePrepare:_=>({u_matrix:new g.UniformMatrix4f(_),u_image:new g.Uniform1i(_),u_dimension:new g.Uniform2f(_),u_zoom:new g.Uniform1f(_),u_unpack:new g.Uniform4f(_)}),line:_=>({u_matrix:new g.UniformMatrix4f(_),u_pixels_to_tile_units:new g.UniformMatrix2f(_),u_device_pixel_ratio:new g.Uniform1f(_),u_units_to_pixels:new g.Uniform2f(_),u_dash_image:new g.Uniform1i(_),u_gradient_image:new g.Uniform1i(_),u_image_height:new g.Uniform1f(_),u_texsize:new g.Uniform2f(_),u_scale:new g.Uniform3f(_),u_mix:new g.Uniform1f(_),u_alpha_discard_threshold:new g.Uniform1f(_),u_trim_offset:new g.Uniform2f(_)}),linePattern:_=>({u_matrix:new g.UniformMatrix4f(_),u_texsize:new g.Uniform2f(_),u_pixels_to_tile_units:new g.UniformMatrix2f(_),u_device_pixel_ratio:new g.Uniform1f(_),u_image:new g.Uniform1i(_),u_units_to_pixels:new g.Uniform2f(_),u_scale:new g.Uniform3f(_),u_fade:new g.Uniform1f(_),u_alpha_discard_threshold:new g.Uniform1f(_)}),raster:_=>({u_matrix:new g.UniformMatrix4f(_),u_tl_parent:new g.Uniform2f(_),u_scale_parent:new g.Uniform1f(_),u_fade_t:new g.Uniform1f(_),u_opacity:new g.Uniform1f(_),u_image0:new g.Uniform1i(_),u_image1:new g.Uniform1i(_),u_brightness_low:new g.Uniform1f(_),u_brightness_high:new g.Uniform1f(_),u_saturation_factor:new g.Uniform1f(_),u_contrast_factor:new g.Uniform1f(_),u_spin_weights:new g.Uniform3f(_),u_perspective_transform:new g.Uniform2f(_)}),symbolIcon:_=>({u_is_size_zoom_constant:new g.Uniform1i(_),u_is_size_feature_constant:new g.Uniform1i(_),u_size_t:new g.Uniform1f(_),u_size:new g.Uniform1f(_),u_camera_to_center_distance:new g.Uniform1f(_),u_rotate_symbol:new g.Uniform1i(_),u_aspect_ratio:new g.Uniform1f(_),u_fade_change:new g.Uniform1f(_),u_matrix:new g.UniformMatrix4f(_),u_label_plane_matrix:new g.UniformMatrix4f(_),u_coord_matrix:new g.UniformMatrix4f(_),u_is_text:new g.Uniform1i(_),u_pitch_with_map:new g.Uniform1i(_),u_texsize:new g.Uniform2f(_),u_tile_id:new g.Uniform3f(_),u_zoom_transition:new g.Uniform1f(_),u_inv_rot_matrix:new g.UniformMatrix4f(_),u_merc_center:new g.Uniform2f(_),u_camera_forward:new g.Uniform3f(_),u_tile_matrix:new g.UniformMatrix4f(_),u_up_vector:new g.Uniform3f(_),u_ecef_origin:new g.Uniform3f(_),u_texture:new g.Uniform1i(_)}),symbolSDF:_=>({u_is_size_zoom_constant:new g.Uniform1i(_),u_is_size_feature_constant:new g.Uniform1i(_),u_size_t:new g.Uniform1f(_),u_size:new g.Uniform1f(_),u_camera_to_center_distance:new g.Uniform1f(_),u_rotate_symbol:new g.Uniform1i(_),u_aspect_ratio:new g.Uniform1f(_),u_fade_change:new g.Uniform1f(_),u_matrix:new g.UniformMatrix4f(_),u_label_plane_matrix:new g.UniformMatrix4f(_),u_coord_matrix:new g.UniformMatrix4f(_),u_is_text:new g.Uniform1i(_),u_pitch_with_map:new g.Uniform1i(_),u_texsize:new g.Uniform2f(_),u_texture:new g.Uniform1i(_),u_gamma_scale:new g.Uniform1f(_),u_device_pixel_ratio:new g.Uniform1f(_),u_tile_id:new g.Uniform3f(_),u_zoom_transition:new g.Uniform1f(_),u_inv_rot_matrix:new g.UniformMatrix4f(_),u_merc_center:new g.Uniform2f(_),u_camera_forward:new g.Uniform3f(_),u_tile_matrix:new g.UniformMatrix4f(_),u_up_vector:new g.Uniform3f(_),u_ecef_origin:new g.Uniform3f(_),u_is_halo:new g.Uniform1i(_)}),symbolTextAndIcon:_=>({u_is_size_zoom_constant:new g.Uniform1i(_),u_is_size_feature_constant:new g.Uniform1i(_),u_size_t:new g.Uniform1f(_),u_size:new g.Uniform1f(_),u_camera_to_center_distance:new g.Uniform1f(_),u_rotate_symbol:new g.Uniform1i(_),u_aspect_ratio:new g.Uniform1f(_),u_fade_change:new g.Uniform1f(_),u_matrix:new g.UniformMatrix4f(_),u_label_plane_matrix:new g.UniformMatrix4f(_),u_coord_matrix:new g.UniformMatrix4f(_),u_is_text:new g.Uniform1i(_),u_pitch_with_map:new g.Uniform1i(_),u_texsize:new g.Uniform2f(_),u_texsize_icon:new g.Uniform2f(_),u_texture:new g.Uniform1i(_),u_texture_icon:new g.Uniform1i(_),u_gamma_scale:new g.Uniform1f(_),u_device_pixel_ratio:new g.Uniform1f(_),u_is_halo:new g.Uniform1i(_)}),background:_=>({u_matrix:new g.UniformMatrix4f(_),u_opacity:new g.Uniform1f(_),u_color:new g.UniformColor(_)}),backgroundPattern:_=>({u_matrix:new g.UniformMatrix4f(_),u_opacity:new g.Uniform1f(_),u_image:new g.Uniform1i(_),u_pattern_tl_a:new g.Uniform2f(_),u_pattern_br_a:new g.Uniform2f(_),u_pattern_tl_b:new g.Uniform2f(_),u_pattern_br_b:new g.Uniform2f(_),u_texsize:new g.Uniform2f(_),u_mix:new g.Uniform1f(_),u_pattern_size_a:new g.Uniform2f(_),u_pattern_size_b:new g.Uniform2f(_),u_scale_a:new g.Uniform1f(_),u_scale_b:new g.Uniform1f(_),u_pixel_coord_upper:new g.Uniform2f(_),u_pixel_coord_lower:new g.Uniform2f(_),u_tile_units_to_pixels:new g.Uniform1f(_)}),terrainRaster:Qn,terrainDepth:Qn,skybox:_=>({u_matrix:new g.UniformMatrix4f(_),u_sun_direction:new g.Uniform3f(_),u_cubemap:new g.Uniform1i(_),u_opacity:new g.Uniform1f(_),u_temporal_offset:new g.Uniform1f(_)}),skyboxGradient:_=>({u_matrix:new g.UniformMatrix4f(_),u_color_ramp:new g.Uniform1i(_),u_center_direction:new g.Uniform3f(_),u_radius:new g.Uniform1f(_),u_opacity:new g.Uniform1f(_),u_temporal_offset:new g.Uniform1f(_)}),skyboxCapture:_=>({u_matrix_3f:new g.UniformMatrix3f(_),u_sun_direction:new g.Uniform3f(_),u_sun_intensity:new g.Uniform1f(_),u_color_tint_r:new g.Uniform4f(_),u_color_tint_m:new g.Uniform4f(_),u_luminance:new g.Uniform1f(_)}),globeRaster:_=>({u_proj_matrix:new g.UniformMatrix4f(_),u_globe_matrix:new g.UniformMatrix4f(_),u_normalize_matrix:new g.UniformMatrix4f(_),u_merc_matrix:new g.UniformMatrix4f(_),u_zoom_transition:new g.Uniform1f(_),u_merc_center:new g.Uniform2f(_),u_image0:new g.Uniform1i(_),u_grid_matrix:new g.UniformMatrix3f(_),u_frustum_tl:new g.Uniform3f(_),u_frustum_tr:new g.Uniform3f(_),u_frustum_br:new g.Uniform3f(_),u_frustum_bl:new g.Uniform3f(_),u_globe_pos:new g.Uniform3f(_),u_globe_radius:new g.Uniform1f(_),u_viewport:new g.Uniform2f(_)}),globeAtmosphere:_=>({u_frustum_tl:new g.Uniform3f(_),u_frustum_tr:new g.Uniform3f(_),u_frustum_br:new g.Uniform3f(_),u_frustum_bl:new g.Uniform3f(_),u_horizon:new g.Uniform1f(_),u_transition:new g.Uniform1f(_),u_fadeout_range:new g.Uniform1f(_),u_color:new g.Uniform4f(_),u_high_color:new g.Uniform4f(_),u_space_color:new g.Uniform4f(_),u_star_intensity:new g.Uniform1f(_),u_star_density:new g.Uniform1f(_),u_star_size:new g.Uniform1f(_),u_temporal_offset:new g.Uniform1f(_),u_horizon_angle:new g.Uniform1f(_),u_rotation_matrix:new g.UniformMatrix4f(_)})};let Fl;function Vs(_,u,p,x,M,E,P){const O=_.context,N=O.gl,U=_.transform,H=_.useProgram("collisionBox"),Z=[];let Q=0,oe=0;for(let Me=0;Me<x.length;Me++){const Se=x[Me],ge=u.getTile(Se),De=ge.getBucket(p);if(!De)continue;const Ue=Sm(Se,De,U);let Ke=Ue;0===M[0]&&0===M[1]||(Ke=_.translatePosMatrix(Ue,ge,M,E));const je=P?De.textCollisionBox:De.iconCollisionBox,St=De.collisionCircleArray;if(St.length>0){const Ne=g.create(),pt=Ke;g.mul(Ne,De.placementInvProjMatrix,U.glCoordMatrix),g.mul(Ne,Ne,De.placementViewportMatrix),Z.push({circleArray:St,circleOffset:oe,transform:pt,invTransform:Ne,projection:De.getProjection()}),Q+=St.length/4,oe=Q}je&&(_.terrain&&_.terrain.setupElevationDraw(ge,H),H.draw(O,N.LINES,g.DepthMode.disabled,g.StencilMode.disabled,_.colorModeForRenderPass(),g.CullFaceMode.disabled,Mi(Ke,U,ge,De.getProjection()),p.id,je.layoutVertexBuffer,je.indexBuffer,je.segments,null,U.zoom,null,[je.collisionVertexBuffer,je.collisionVertexBufferExt]))}if(!P||!Z.length)return;const ie=_.useProgram("collisionCircle"),le=new g.StructArrayLayout2f1f2i16;le.resize(4*Q),le._trim();let re=0;for(const Me of Z)for(let Se=0;Se<Me.circleArray.length/4;Se++){const ge=4*Se,De=Me.circleArray[ge+0],Ue=Me.circleArray[ge+1],Ke=Me.circleArray[ge+2],je=Me.circleArray[ge+3];le.emplace(re++,De,Ue,Ke,je,0),le.emplace(re++,De,Ue,Ke,je,1),le.emplace(re++,De,Ue,Ke,je,2),le.emplace(re++,De,Ue,Ke,je,3)}(!Fl||Fl.length<2*Q)&&(Fl=function(Me){const Se=2*Me,ge=new g.StructArrayLayout3ui6;ge.resize(Se),ge._trim();for(let De=0;De<Se;De++){const Ue=6*De;ge.uint16[Ue+0]=4*De+0,ge.uint16[Ue+1]=4*De+1,ge.uint16[Ue+2]=4*De+2,ge.uint16[Ue+3]=4*De+2,ge.uint16[Ue+4]=4*De+3,ge.uint16[Ue+5]=4*De+0}return ge}(Q));const ne=O.createIndexBuffer(Fl,!0),ue=O.createVertexBuffer(le,g.collisionCircleLayout.members,!0);for(const Me of Z){const Se={u_matrix:Me.transform,u_inv_matrix:Me.invTransform,u_camera_to_center_distance:(se=U).getCameraToCenterDistance(Me.projection),u_viewport_size:[se.width,se.height]};ie.draw(O,N.TRIANGLES,g.DepthMode.disabled,g.StencilMode.disabled,_.colorModeForRenderPass(),g.CullFaceMode.disabled,Se,p.id,ue,ne,g.SegmentVector.simpleSegment(0,2*Me.circleOffset,Me.circleArray.length,Me.circleArray.length/2),null,U.zoom)}var se;ue.destroy(),ne.destroy()}const Im=g.create();function Ds(_,u,p,x,M,E){const{horizontalAlign:P,verticalAlign:O}=g.getAnchorAlignment(_),N=-(P-.5)*u,U=-(O-.5)*p,H=g.evaluateVariableOffset(_,x);return new g.pointGeometry((N/M+H[0])*E,(U/M+H[1])*E)}function il(_,u,p,x,M,E,P,O,N,U,H){const Z=_.text.placedSymbolArray,Q=_.text.dynamicLayoutVertexArray,oe=_.icon.dynamicLayoutVertexArray,ie={},le=Sh(O,_.getProjection(),E),re=E.elevation,ne=_.getProjection().upVectorScale(O.canonical,E.center.lat,E.worldSize);Q.clear();for(let ue=0;ue<Z.length;ue++){const se=Z.get(ue),Me=_.allowVerticalPlacement&&!se.placedOrientation,Se=se.hidden||!se.crossTileID||Me?null:x[se.crossTileID];if(Se){const ge=new g.pointGeometry(se.tileAnchorX,se.tileAnchorY),De=_.getProjection().upVector(O.canonical,ge.x,ge.y),Ue=re?re.getAtTileOffset(O,ge.x,ge.y):0,Ke=vn([se.projectedAnchorX+Ue*De[0]*ne.metersToTile,se.projectedAnchorY+Ue*De[1]*ne.metersToTile,se.projectedAnchorZ+Ue*De[2]*ne.metersToTile],p?le:P),je=_i(E.getCameraToCenterDistance(_.getProjection()),Ke.signedDistanceFromCamera);let St=M.evaluateSizeForFeature(_.textSizeData,U,se)*je/g.ONE_EM;p&&(St*=_.tilePixelRatio/N);const{width:Ne,height:pt,anchor:ht,textOffset:We,textScale:Fe}=Se,$t=Ds(ht,Ne,pt,We,Fe,St);let Ft;if(p){const Bt=ge.add($t),{x:un,y:Nn,z:Tn}=_.getProjection().projectTilePoint(Bt.x,Bt.y,O.canonical);Ft=vn([un+Ue*De[0]*ne.metersToTile,Nn+Ue*De[1]*ne.metersToTile,Tn+Ue*De[2]*ne.metersToTile],P).point}else{const Bt=u?$t.rotate(-E.angle):$t;Ft=[Ke.point[0]+Bt.x,Ke.point[1]+Bt.y,0]}const kt=_.allowVerticalPlacement&&se.placedOrientation===g.WritingMode.vertical?Math.PI/2:0;for(let Bt=0;Bt<se.numGlyphs;Bt++)g.addDynamicAttributes(Q,Ft[0],Ft[1],Ft[2],kt);H&&se.associatedIconIndex>=0&&(ie[se.associatedIconIndex]={shiftedAnchor:Ft,angle:kt})}else tl(se.numGlyphs,Q)}if(H){oe.clear();const ue=_.icon.placedSymbolArray;for(let se=0;se<ue.length;se++){const Me=ue.get(se);if(Me.hidden)tl(Me.numGlyphs,oe);else{const Se=ie[se];if(Se)for(let ge=0;ge<Me.numGlyphs;ge++)g.addDynamicAttributes(oe,Se.shiftedAnchor[0],Se.shiftedAnchor[1],Se.shiftedAnchor[2],Se.angle);else tl(Me.numGlyphs,oe)}}_.icon.dynamicLayoutVertexBuffer.updateData(oe)}_.text.dynamicLayoutVertexBuffer.updateData(Q)}function Pm(_,u,p){return p.iconsInText&&u?"symbolTextAndIcon":_?"symbolSDF":"symbolIcon"}function kh(_,u,p,x,M,E,P,O,N,U,H,Z){const Q=_.context,oe=Q.gl,ie=_.transform,le="map"===O,re="map"===N,ne=le&&"point"!==p.layout.get("symbol-placement"),ue=le&&!re&&!ne,se=void 0!==p.layout.get("symbol-sort-key").constantOr(1);let Me=!1;const Se=_.depthModeForSublayer(0,g.DepthMode.ReadOnly),ge=[g.mercatorXfromLng(ie.center.lng),g.mercatorYfromLat(ie.center.lat)],De=p.layout.get("text-variable-anchor"),Ue="globe"===ie.projection.name,Ke=[],je=[0,-1,0];let St=je;!Ue&&!ie.mercatorFromTransition||le||(St=function(Ne){const pt=Ne._camera.getWorldToCamera(Ne.worldSize,1),ht=g.multiply([],pt,Ne.globeMatrix);g.invert(ht,ht);const We=[0,0,0],Fe=[0,1,0,0];return g.transformMat4$1(Fe,Fe,ht),We[0]=Fe[0],We[1]=Fe[1],We[2]=Fe[2],g.normalize(We,We),We}(ie));for(const Ne of x){const pt=u.getTile(Ne),ht=pt.getBucket(p);if(!ht||"mercator"===ht.projection.name&&Ue)continue;const We=M?ht.text:ht.icon;if(!We||ht.fullyClipped||!We.segments.get().length)continue;const Fe=We.programConfigurations.get(p.id),$t=M||ht.sdfIcons,Ft=M?ht.textSizeData:ht.iconSizeData,kt=re||0!==ie.pitch,Bt=g.evaluateSizeForZoom(Ft,ie.zoom);let un,Nn,Tn,mn,Lt=[0,0],qn=null;if(M){if(Nn=pt.glyphAtlasTexture,Tn=oe.LINEAR,un=pt.glyphAtlasTexture.size,ht.iconsInText){Lt=pt.imageAtlasTexture.size,qn=pt.imageAtlasTexture;const as="composite"===Ft.kind||"camera"===Ft.kind;mn=kt||_.options.rotating||_.options.zooming||as?oe.LINEAR:oe.NEAREST}}else{const as=1!==p.layout.get("icon-size").constantOr(0)||ht.iconsNeedLinear;Nn=pt.imageAtlasTexture,Tn=$t||_.options.rotating||_.options.zooming||as||kt?oe.LINEAR:oe.NEAREST,un=pt.imageAtlasTexture.size}const di="globe"===ht.projection.name,ur=di?St:je,dr=di?g.globeToMercatorTransition(ie.zoom):0,Yi=Sh(Ne,ht.getProjection(),ie),Rs=ie.calculatePixelsToTileUnitsMatrix(pt),Hs=Ru(Yi,pt.tileID.canonical,re,le,ie,ht.getProjection(),Rs),Yo=_.terrain&&re&&ne?g.invert(g.create(),Hs):Im,Rr=ar(Yi,pt.tileID.canonical,re,le,ie,ht.getProjection(),Rs),Gr=De&&ht.hasTextData(),Hi="none"!==p.layout.get("icon-text-fit")&&Gr&&ht.hasIconData();if(ne){const as=ie.elevation,ol=as?as.getAtTileOffsetFunc(Ne,ie.center.lat,ie.worldSize,ht.getProjection()):_o=>[0,0,0],zl=Vp(Yi,pt.tileID.canonical,re,le,ie,ht.getProjection(),Rs);Ai(ht,Yi,_,M,zl,Rr,re,U,ol,Ne)}const jr=ne||M&&De||Hi,mo=_.translatePosMatrix(Yi,pt,E,P),hi=jr?Im:Hs,go=_.translatePosMatrix(Rr,pt,E,P,!0),$u=ht.getProjection().createInversionMatrix(ie,Ne.canonical),Ha=[];_.terrainRenderModeElevated()&&re&&Ha.push("PITCH_WITH_MAP_TERRAIN"),di&&Ha.push("PROJECTION_GLOBE_VIEW"),jr&&Ha.push("PROJECTED_POS_ON_VIEWPORT");const ns=$t&&0!==p.paint.get(M?"text-halo-width":"icon-halo-width").constantOr(1);let sl;sl=$t?ht.iconsInText?qp(Ft.kind,Bt,ue,re,_,mo,hi,go,un,Lt,Ne,dr,ge,$u,ur,ht.getProjection()):Wp(Ft.kind,Bt,ue,re,_,mo,hi,go,M,un,!0,Ne,dr,ge,$u,ur,ht.getProjection()):k_(Ft.kind,Bt,ue,re,_,mo,hi,go,M,un,Ne,dr,ge,$u,ur,ht.getProjection());const va={program:_.useProgram(Pm($t,M,ht),Fe,Ha),buffers:We,uniformValues:sl,atlasTexture:Nn,atlasTextureIcon:qn,atlasInterpolation:Tn,atlasInterpolationIcon:mn,isSDF:$t,hasHalo:ns,tile:pt,labelPlaneMatrixInv:Yo};if(se&&ht.canOverlap){Me=!0;const as=We.segments.get();for(const ol of as)Ke.push({segments:new g.SegmentVector([ol]),sortKey:ol.sortKey,state:va})}else Ke.push({segments:We.segments,sortKey:0,state:va})}Me&&Ke.sort((Ne,pt)=>Ne.sortKey-pt.sortKey);for(const Ne of Ke){const pt=Ne.state;if(_.terrain&&_.terrain.setupElevationDraw(pt.tile,pt.program,{useDepthForOcclusion:!Ue,labelPlaneMatrixInv:pt.labelPlaneMatrixInv}),Q.activeTexture.set(oe.TEXTURE0),pt.atlasTexture.bind(pt.atlasInterpolation,oe.CLAMP_TO_EDGE),pt.atlasTextureIcon&&(Q.activeTexture.set(oe.TEXTURE1),pt.atlasTextureIcon&&pt.atlasTextureIcon.bind(pt.atlasInterpolationIcon,oe.CLAMP_TO_EDGE)),pt.isSDF){const ht=pt.uniformValues;pt.hasHalo&&(ht.u_is_halo=1,Lh(pt.buffers,Ne.segments,p,_,pt.program,Se,H,Z,ht)),ht.u_is_halo=0}Lh(pt.buffers,Ne.segments,p,_,pt.program,Se,H,Z,pt.uniformValues)}}function Lh(_,u,p,x,M,E,P,O,N){const U=x.context,H=[_.dynamicLayoutVertexBuffer,_.opacityVertexBuffer,_.globeExtVertexBuffer];M.draw(U,U.gl.TRIANGLES,E,P,O,g.CullFaceMode.disabled,N,p.id,_.layoutVertexBuffer,_.indexBuffer,u,p.paint,x.transform.zoom,_.programConfigurations.get(p.id),H)}function Na(_,u,p,x,M,E,P){const O=_.context.gl,N=p.paint.get("fill-pattern"),U=N&&N.constantOr(1),H=p.getCrossfadeParameters();let Z,Q,oe,ie,le;P?(Q=U&&!p.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",Z=O.LINES):(Q=U?"fillPattern":"fill",Z=O.TRIANGLES);for(const re of x){const ne=u.getTile(re);if(U&&!ne.patternsLoaded())continue;const ue=ne.getBucket(p);if(!ue)continue;_.prepareDrawTile();const se=ue.programConfigurations.get(p.id),Me=_.useProgram(Q,se);U&&(_.context.activeTexture.set(O.TEXTURE0),ne.imageAtlasTexture.bind(O.LINEAR,O.CLAMP_TO_EDGE),se.updatePaintBuffers(H));const Se=N.constantOr(null);if(Se&&ne.imageAtlas){const De=ne.imageAtlas,Ue=De.patternPositions[Se.to.toString()],Ke=De.patternPositions[Se.from.toString()];Ue&&Ke&&se.setConstantPatternPositions(Ue,Ke)}const ge=_.translatePosMatrix(re.projMatrix,ne,p.paint.get("fill-translate"),p.paint.get("fill-translate-anchor"));if(P){ie=ue.indexBuffer2,le=ue.segments2;const De=_.terrain&&_.terrain.renderingToTexture?_.terrain.drapeBufferSize:[O.drawingBufferWidth,O.drawingBufferHeight];oe="fillOutlinePattern"===Q&&U?Fu(ge,_,H,ne,De):Ts(ge,De)}else ie=ue.indexBuffer,le=ue.segments,oe=U?rc(ge,_,H,ne):ho(ge);_.prepareDrawProgram(_.context,Me,re.toUnwrapped()),Me.draw(_.context,Z,M,_.stencilModeForClipping(re),E,g.CullFaceMode.disabled,oe,p.id,ue.layoutVertexBuffer,ie,le,p.paint,_.transform.zoom,se)}}function Rm(_,u,p,x,M,E,P){const O=_.context,N=O.gl,U=_.transform,H=p.paint.get("fill-extrusion-pattern"),Z=H.constantOr(1),Q=p.getCrossfadeParameters(),oe=p.paint.get("fill-extrusion-opacity"),ie=[p.paint.get("fill-extrusion-ambient-occlusion-intensity"),p.paint.get("fill-extrusion-ambient-occlusion-radius")],le=p.layout.get("fill-extrusion-edge-radius"),re="globe"===U.projection.name?g.fillExtrusionHeightLift():0,ne="globe"===U.projection.name,ue=ne?g.globeToMercatorTransition(U.zoom):0,se=[g.mercatorXfromLng(U.center.lng),g.mercatorYfromLat(U.center.lat)],Me=[];ne&&(Me.push("PROJECTION_GLOBE_VIEW"),_.style.terrainSetForDrapingOnly()&&Me.push("TERRAIN")),ie[0]>0&&Me.push("FAUX_AO");for(const Se of x){const ge=u.getTile(Se),De=ge.getBucket(p);if(!De||De.projection.name!==U.projection.name)continue;const Ue=De.programConfigurations.get(p.id),Ke=_.useProgram(Z?"fillExtrusionPattern":"fillExtrusion",Ue,Me);if(_.terrain){const Fe=_.terrain;if(_.style.terrainSetForDrapingOnly())Fe.setupElevationDraw(ge,Ke,{useMeterToDem:!0});else{if(!De.enableTerrain)continue;if(Fe.setupElevationDraw(ge,Ke,{useMeterToDem:!0}),L_(O,u,Se,De,p,Fe),!De.centroidVertexBuffer){const $t=Ke.attributes.a_centroid_pos;void 0!==$t&&N.vertexAttrib2f($t,0,0)}}}Z&&(_.context.activeTexture.set(N.TEXTURE0),ge.imageAtlasTexture.bind(N.LINEAR,N.CLAMP_TO_EDGE),Ue.updatePaintBuffers(Q));const je=H.constantOr(null);if(je&&ge.imageAtlas){const Fe=ge.imageAtlas,$t=Fe.patternPositions[je.to.toString()],Ft=Fe.patternPositions[je.from.toString()];$t&&Ft&&Ue.setConstantPatternPositions($t,Ft)}const St=_.translatePosMatrix(Se.projMatrix,ge,p.paint.get("fill-extrusion-translate"),p.paint.get("fill-extrusion-translate-anchor")),Ne=U.projection.createInversionMatrix(U,Se.canonical),pt=p.paint.get("fill-extrusion-vertical-gradient"),ht=Z?Ur(St,_,pt,oe,ie,le,Se,Q,ge,re,ue,se,Ne):yi(St,_,pt,oe,ie,le,Se,re,ue,se,Ne);_.prepareDrawProgram(O,Ke,Se.toUnwrapped());const We=[];_.terrain&&We.push(De.centroidVertexBuffer),ne&&We.push(De.layoutVertexExtBuffer),Ke.draw(O,O.gl.TRIANGLES,M,E,P,g.CullFaceMode.backCCW,ht,p.id,De.layoutVertexBuffer,De.indexBuffer,De.segments,p.paint,_.transform.zoom,Ue,We)}}function L_(_,u,p,x,M,E){const P=[ne=>{let ue=ne.canonical.x-1,se=ne.wrap;return ue<0&&(ue=(1<<ne.canonical.z)-1,se--),new g.OverscaledTileID(ne.overscaledZ,se,ne.canonical.z,ue,ne.canonical.y)},ne=>{let ue=ne.canonical.x+1,se=ne.wrap;return ue===1<<ne.canonical.z&&(ue=0,se++),new g.OverscaledTileID(ne.overscaledZ,se,ne.canonical.z,ue,ne.canonical.y)},ne=>new g.OverscaledTileID(ne.overscaledZ,ne.wrap,ne.canonical.z,ne.canonical.x,(0===ne.canonical.y?1<<ne.canonical.z:ne.canonical.y)-1),ne=>new g.OverscaledTileID(ne.overscaledZ,ne.wrap,ne.canonical.z,ne.canonical.x,ne.canonical.y===(1<<ne.canonical.z)-1?0:ne.canonical.y+1)],O=ne=>{const ue=u.getSource().minzoom,se=Se=>{const ge=u.getTileByID(Se);if(ge&&ge.hasData())return ge.getBucket(M)},Me=[0,-1,1];for(const Se of Me){if(ne.overscaledZ+Se<ue)continue;const ge=se(ne.calculateScaledKey(ne.overscaledZ+Se));if(ge)return ge}},N=[0,0,0],U=(ne,ue)=>(N[0]=Math.min(ne.min.y,ue.min.y),N[1]=Math.max(ne.max.y,ue.max.y),N[2]=g.EXTENT-ue.min.x>ne.max.x?ue.min.x-g.EXTENT:ne.max.x,N),H=(ne,ue)=>(N[0]=Math.min(ne.min.x,ue.min.x),N[1]=Math.max(ne.max.x,ue.max.x),N[2]=g.EXTENT-ue.min.y>ne.max.y?ue.min.y-g.EXTENT:ne.max.y,N),Z=[(ne,ue)=>U(ne,ue),(ne,ue)=>U(ue,ne),(ne,ue)=>H(ne,ue),(ne,ue)=>H(ue,ne)],Q=new g.pointGeometry(0,0);let oe,ie,le;const re=(ne,ue,se,Me,Se)=>{const ge=[[Me?se:ne,Me?ne:se,0],[Me?se:ue,Me?ue:se,0]],De=Se<0?g.EXTENT+Se:Se,Ue=[Me?De:(ne+ue)/2,Me?(ne+ue)/2:De,0];return 0===se&&Se<0||0!==se&&Se>0?E.getForTilePoints(le,[Ue],!0,ie):ge.push(Ue),E.getForTilePoints(p,ge,!0,oe),Math.max(ge[0][2],ge[1][2],Ue[2])/E.exaggeration()};for(let ne=0;ne<4;ne++){const ue=(ne<2?1:5)-ne,se=x.borders[ne];if(0===se.length)continue;const Me=le=P[ne](p),Se=O(Me);if(!(Se&&Se instanceof g.FillExtrusionBucket&&Se.enableTerrain)||x.borderDoneWithNeighborZ[ne]===Se.canonical.z&&Se.borderDoneWithNeighborZ[ue]===x.canonical.z||(ie=E.findDEMTileFor(Me),!ie||!ie.dem))continue;if(!oe){const Ke=E.findDEMTileFor(p);if(!Ke||!Ke.dem)return;oe=Ke}const ge=Se.borders[ue];let De=0;const Ue=Se.borderDoneWithNeighborZ[ue]!==x.canonical.z;if(x.canonical.z===Se.canonical.z){for(let Ke=0;Ke<se.length;Ke++){const je=x.featuresOnBorder[se[Ke]],St=je.borders[ne];let Ne;for(;De<ge.length&&(Ne=Se.featuresOnBorder[ge[De]],!(Ne.borders[ue][1]>St[0]+3));)Ue&&Se.encodeCentroid(void 0,Ne,!1),De++;if(Ne&&De<ge.length){const pt=De;let ht=0;for(;!(Ne.borders[ue][0]>St[1]-3)&&(ht++,++De!==ge.length);)Ne=Se.featuresOnBorder[ge[De]];if(Ne=Se.featuresOnBorder[ge[pt]],je.intersectsCount()>1||Ne.intersectsCount()>1||1!==ht){1!==ht&&(De=pt),x.encodeCentroid(void 0,je,!1),Ue&&Se.encodeCentroid(void 0,Ne,!1);continue}const We=Z[ne](je,Ne),Fe=ne%2?g.EXTENT-1:0;Q.x=re(We[0],Math.min(g.EXTENT-1,We[1]),Fe,ne<2,We[2]),Q.y=0,x.encodeCentroid(Q,je,!1),Ue&&Se.encodeCentroid(Q,Ne,!1)}else x.encodeCentroid(void 0,je,!1)}x.borderDoneWithNeighborZ[ne]=Se.canonical.z,x.needsCentroidUpdate=!0,Ue&&(Se.borderDoneWithNeighborZ[ue]=x.canonical.z,Se.needsCentroidUpdate=!0)}else{for(const Ke of se)x.encodeCentroid(void 0,x.featuresOnBorder[Ke],!1);if(Ue){for(const Ke of ge)Se.encodeCentroid(void 0,Se.featuresOnBorder[Ke],!1);Se.borderDoneWithNeighborZ[ue]=x.canonical.z,Se.needsCentroidUpdate=!0}x.borderDoneWithNeighborZ[ne]=Se.canonical.z,x.needsCentroidUpdate=!0}}(x.needsCentroidUpdate||!x.centroidVertexBuffer&&0!==x.centroidVertexArray.length)&&x.uploadCentroid(_)}const km=new g.Color(1,0,0,1),O_=new g.Color(0,1,0,1),E0=new g.Color(0,0,1,1),T0=new g.Color(1,0,1,1),F_=new g.Color(0,1,1,1);function Id(_,u,p){const x=_.context,M=_.transform,E=x.gl,P="globe"===M.projection.name,O=P?["PROJECTION_GLOBE_VIEW"]:null;let N=p.projMatrix;if(P&&g.globeToMercatorTransition(M.zoom)>0){const je=g.transitionTileAABBinECEF(p.canonical,M),St=g.globeDenormalizeECEF(je);N=g.multiply(new Float32Array(16),M.globeMatrix,St),g.multiply(N,M.projMatrix,N)}const U=_.useProgram("debug",null,O),H=u.getTileByID(p.key);_.terrain&&_.terrain.setupElevationDraw(H,U);const Z=g.DepthMode.disabled,Q=g.StencilMode.disabled,oe=_.colorModeForRenderPass();x.activeTexture.set(E.TEXTURE0),_.emptyTexture.bind(E.LINEAR,E.CLAMP_TO_EDGE),P?H._makeGlobeTileDebugBuffers(_.context,M):H._makeDebugTileBoundsBuffers(_.context,M.projection);const le=H._tileDebugBuffer||_.debugBuffer,re=H._tileDebugIndexBuffer||_.debugIndexBuffer,ne=H._tileDebugSegments||_.debugSegments;U.draw(x,E.LINE_STRIP,Z,Q,oe,g.CullFaceMode.disabled,Nu(N,g.Color.red),"$debug",le,re,ne,null,null,null,[H._globeTileDebugBorderBuffer]);const ue=H.latestRawTileData,se=Math.floor((ue&&ue.byteLength||0)/1024),Me=u.getTile(p).tileSize,Se=512/Math.min(Me,512)*(p.overscaledZ/M.zoom)*.5;let ge=p.canonical.toString();p.overscaledZ!==p.canonical.z&&(ge+=` => ${p.overscaledZ}`),ge+=` ${se}kb`,function(je,St){je.initDebugOverlayCanvas();const Ne=je.debugOverlayCanvas,pt=je.context.gl,ht=je.debugOverlayCanvas.getContext("2d");ht.clearRect(0,0,Ne.width,Ne.height),ht.shadowColor="white",ht.shadowBlur=2,ht.lineWidth=1.5,ht.strokeStyle="white",ht.textBaseline="top",ht.font="bold 36px Open Sans, sans-serif",ht.fillText(St,5,5),ht.strokeText(St,5,5),je.debugOverlayTexture.update(Ne),je.debugOverlayTexture.bind(pt.LINEAR,pt.CLAMP_TO_EDGE)}(_,ge);const De=H._tileDebugTextBuffer||_.debugBuffer,Ue=H._tileDebugTextIndexBuffer||_.quadTriangleIndexBuffer,Ke=H._tileDebugTextSegments||_.debugSegments;U.draw(x,E.TRIANGLES,Z,Q,g.ColorMode.alphaBlended,g.CullFaceMode.disabled,Nu(N,g.Color.transparent,Se),"$debug",De,Ue,Ke,null,null,null,[H._globeTileDebugTextBuffer])}function Oh(_,u,p,x){jc(_,0,u+p/2,_.transform.width,p,x)}function N_(_,u,p,x){jc(_,u-p/2,0,p,_.transform.height,x)}function jc(_,u,p,x,M,E){const P=_.context,O=P.gl;O.enable(O.SCISSOR_TEST),O.scissor(u*g.exported.devicePixelRatio,p*g.exported.devicePixelRatio,x*g.exported.devicePixelRatio,M*g.exported.devicePixelRatio),P.clear({color:E}),O.disable(O.SCISSOR_TEST)}const Fh=g.createLayout([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:D0}=Fh;function ac(_,u,p,x){_.emplaceBack(u,p,x)}class Xi{constructor(u){this.vertexArray=new g.StructArrayLayout3f12,this.indices=new g.StructArrayLayout3ui6,ac(this.vertexArray,-1,-1,1),ac(this.vertexArray,1,-1,1),ac(this.vertexArray,-1,1,1),ac(this.vertexArray,1,1,1),ac(this.vertexArray,-1,-1,-1),ac(this.vertexArray,1,-1,-1),ac(this.vertexArray,-1,1,-1),ac(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=u.createVertexBuffer(this.vertexArray,D0),this.indexBuffer=u.createIndexBuffer(this.indices),this.segment=g.SegmentVector.simpleSegment(0,0,36,12)}}function $c(_,u,p,x,M,E){const P=_.gl,O=u.paint.get("sky-atmosphere-color"),N=u.paint.get("sky-atmosphere-halo-color"),U=u.paint.get("sky-atmosphere-sun-intensity"),H={u_matrix_3f:g.fromMat4(g.create$1(),x),u_sun_direction:M,u_sun_intensity:U,u_color_tint_r:[(ie=O).r,ie.g,ie.b,ie.a],u_color_tint_m:[(le=N).r,le.g,le.b,le.a],u_luminance:5e-5};var ie,le;P.framebufferTexture2D(P.FRAMEBUFFER,P.COLOR_ATTACHMENT0,P.TEXTURE_CUBE_MAP_POSITIVE_X+E,u.skyboxTexture,0),p.draw(_,P.TRIANGLES,g.DepthMode.disabled,g.StencilMode.disabled,g.ColorMode.unblended,g.CullFaceMode.frontCW,H,"skyboxCapture",u.skyboxGeometry.vertexBuffer,u.skyboxGeometry.indexBuffer,u.skyboxGeometry.segment)}const Hw=g.createLayout([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class A0{constructor(u){const p=new g.StructArrayLayout5f20;p.emplaceBack(-1,1,1,0,0),p.emplaceBack(1,1,1,1,0),p.emplaceBack(1,-1,1,1,1),p.emplaceBack(-1,-1,1,0,1);const x=new g.StructArrayLayout3ui6;x.emplaceBack(0,1,2),x.emplaceBack(2,3,0),this.vertexBuffer=u.createVertexBuffer(p,Hw.members),this.indexBuffer=u.createIndexBuffer(x),this.segments=g.SegmentVector.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const Vu={symbol:function(_,u,p,x,M){if("translucent"!==_.renderPass)return;const E=g.StencilMode.disabled,P=_.colorModeForRenderPass();p.layout.get("text-variable-anchor")&&function(O,N,U,H,Z,Q,oe){const ie=N.transform,le="map"===Z,re="map"===Q;for(const ne of O){const ue=H.getTile(ne),se=ue.getBucket(U);if(!se||!se.text||!se.text.segments.get().length)continue;const Me=g.evaluateSizeForZoom(se.textSizeData,ie.zoom),Se=Sh(ne,se.getProjection(),ie),ge=ie.calculatePixelsToTileUnitsMatrix(ue),De=Ru(Se,ue.tileID.canonical,re,le,ie,se.getProjection(),ge),Ue="none"!==U.layout.get("icon-text-fit")&&se.hasIconData();if(Me){const Ke=Math.pow(2,ie.zoom-ue.tileID.overscaledZ);il(se,le,re,oe,g.symbolSize,ie,De,ne,Ke,Me,Ue)}}}(x,_,p,u,p.layout.get("text-rotation-alignment"),p.layout.get("text-pitch-alignment"),M),0!==p.paint.get("icon-opacity").constantOr(1)&&kh(_,u,p,x,!1,p.paint.get("icon-translate"),p.paint.get("icon-translate-anchor"),p.layout.get("icon-rotation-alignment"),p.layout.get("icon-pitch-alignment"),p.layout.get("icon-keep-upright"),E,P),0!==p.paint.get("text-opacity").constantOr(1)&&kh(_,u,p,x,!0,p.paint.get("text-translate"),p.paint.get("text-translate-anchor"),p.layout.get("text-rotation-alignment"),p.layout.get("text-pitch-alignment"),p.layout.get("text-keep-upright"),E,P),u.map.showCollisionBoxes&&(Vs(_,u,p,x,p.paint.get("text-translate"),p.paint.get("text-translate-anchor"),!0),Vs(_,u,p,x,p.paint.get("icon-translate"),p.paint.get("icon-translate-anchor"),!1))},circle:function(_,u,p,x){if("translucent"!==_.renderPass)return;const M=p.paint.get("circle-opacity"),E=p.paint.get("circle-stroke-width"),P=p.paint.get("circle-stroke-opacity"),O=void 0!==p.layout.get("circle-sort-key").constantOr(1);if(0===M.constantOr(1)&&(0===E.constantOr(1)||0===P.constantOr(1)))return;const N=_.context,U=N.gl,H=_.transform,Z=_.depthModeForSublayer(0,g.DepthMode.ReadOnly),Q=g.StencilMode.disabled,oe=_.colorModeForRenderPass(),ie="globe"===H.projection.name,le=[g.mercatorXfromLng(H.center.lng),g.mercatorYfromLat(H.center.lat)],re=[];for(let ue=0;ue<x.length;ue++){const se=x[ue],Me=u.getTile(se),Se=Me.getBucket(p);if(!Se||Se.projection.name!==H.projection.name)continue;const ge=Se.programConfigurations.get(p.id),De=Ad(p);ie&&De.push("PROJECTION_GLOBE_VIEW");const Ue=_.useProgram("circle",ge,De),Ke=Se.layoutVertexBuffer,je=Se.globeExtVertexBuffer,St=Se.indexBuffer,Ne=H.projection.createInversionMatrix(H,se.canonical),pt={programConfiguration:ge,program:Ue,layoutVertexBuffer:Ke,globeExtVertexBuffer:je,indexBuffer:St,uniformValues:sc(_,se,Me,Ne,le,p),tile:Me};if(O){const ht=Se.segments.get();for(const We of ht)re.push({segments:new g.SegmentVector([We]),sortKey:We.sortKey,state:pt})}else re.push({segments:Se.segments,sortKey:0,state:pt})}O&&re.sort((ue,se)=>ue.sortKey-se.sortKey);const ne={useDepthForOcclusion:!ie};for(const ue of re){const{programConfiguration:se,program:Me,layoutVertexBuffer:Se,globeExtVertexBuffer:ge,indexBuffer:De,uniformValues:Ue,tile:Ke}=ue.state,je=ue.segments;_.terrain&&_.terrain.setupElevationDraw(Ke,Me,ne),_.prepareDrawProgram(N,Me,Ke.tileID.toUnwrapped()),Me.draw(N,U.TRIANGLES,Z,Q,oe,g.CullFaceMode.disabled,Ue,p.id,Se,De,je,p.paint,H.zoom,se,[ge])}},heatmap:function(_,u,p,x){if(0!==p.paint.get("heatmap-opacity"))if("offscreen"===_.renderPass){const M=_.context,E=M.gl,P=g.StencilMode.disabled,O=new g.ColorMode([E.ONE,E.ONE],g.Color.transparent,[!0,!0,!0,!0]);(function(oe,ie,le,re){const ne=oe.gl,ue=ie.width*re,se=ie.height*re;oe.activeTexture.set(ne.TEXTURE1),oe.viewport.set([0,0,ue,se]);let Me=le.heatmapFbo;if(!Me||Me&&(Me.width!==ue||Me.height!==se)){Me&&Me.destroy();const Se=ne.createTexture();ne.bindTexture(ne.TEXTURE_2D,Se),ne.texParameteri(ne.TEXTURE_2D,ne.TEXTURE_WRAP_S,ne.CLAMP_TO_EDGE),ne.texParameteri(ne.TEXTURE_2D,ne.TEXTURE_WRAP_T,ne.CLAMP_TO_EDGE),ne.texParameteri(ne.TEXTURE_2D,ne.TEXTURE_MIN_FILTER,ne.LINEAR),ne.texParameteri(ne.TEXTURE_2D,ne.TEXTURE_MAG_FILTER,ne.LINEAR),Me=le.heatmapFbo=oe.createFramebuffer(ue,se,!1),function(ge,De,Ue,Ke,je,St){const Ne=ge.gl;Ne.texImage2D(Ne.TEXTURE_2D,0,Ne.RGBA,je,St,0,Ne.RGBA,ge.extRenderToTextureHalfFloat?ge.extTextureHalfFloat.HALF_FLOAT_OES:Ne.UNSIGNED_BYTE,null),Ke.colorAttachment.set(Ue)}(oe,0,Se,Me,ue,se)}else ne.bindTexture(ne.TEXTURE_2D,Me.colorAttachment.get()),oe.bindFramebuffer.set(Me.framebuffer)})(M,_,p,"globe"===_.transform.projection.name?.5:.25),M.clear({color:g.Color.transparent});const N=_.transform,U="globe"===N.projection.name,H=U?["PROJECTION_GLOBE_VIEW"]:null,Z=U?g.CullFaceMode.frontCCW:g.CullFaceMode.disabled,Q=[g.mercatorXfromLng(N.center.lng),g.mercatorYfromLat(N.center.lat)];for(let oe=0;oe<x.length;oe++){const ie=x[oe];if(u.hasRenderableParent(ie))continue;const le=u.getTile(ie),re=le.getBucket(p);if(!re||re.projection.name!==N.projection.name)continue;const ne=re.programConfigurations.get(p.id),ue=_.useProgram("heatmap",ne,H),{zoom:se}=_.transform;_.terrain&&_.terrain.setupElevationDraw(le,ue),_.prepareDrawProgram(M,ue,ie.toUnwrapped());const Me=N.projection.createInversionMatrix(N,ie.canonical);ue.draw(M,E.TRIANGLES,g.DepthMode.disabled,P,O,Z,Ih(_,ie,le,Me,Q,se,p.paint.get("heatmap-intensity")),p.id,re.layoutVertexBuffer,re.indexBuffer,re.segments,p.paint,_.transform.zoom,ne,U?[re.globeExtVertexBuffer]:null)}M.viewport.set([0,0,_.width,_.height])}else"translucent"===_.renderPass&&(_.context.setColorMode(_.colorModeForRenderPass()),function(M,E){const P=M.context,O=P.gl,N=E.heatmapFbo;if(!N)return;P.activeTexture.set(O.TEXTURE0),O.bindTexture(O.TEXTURE_2D,N.colorAttachment.get()),P.activeTexture.set(O.TEXTURE1);let U=E.colorRampTexture;U||(U=E.colorRampTexture=new g.Texture(P,E.colorRamp,O.RGBA)),U.bind(O.LINEAR,O.CLAMP_TO_EDGE),M.useProgram("heatmapTexture").draw(P,O.TRIANGLES,g.DepthMode.disabled,g.StencilMode.disabled,M.colorModeForRenderPass(),g.CullFaceMode.disabled,{u_image:0,u_color_ramp:1,u_opacity:E.paint.get("heatmap-opacity")},E.id,M.viewportBuffer,M.quadTriangleIndexBuffer,M.viewportSegments,E.paint,M.transform.zoom)}(_,p))},line:function(_,u,p,x){if("translucent"!==_.renderPass)return;const M=p.paint.get("line-opacity"),E=p.paint.get("line-width");if(0===M.constantOr(1)||0===E.constantOr(1))return;const P=_.depthModeForSublayer(0,g.DepthMode.ReadOnly),O=_.colorModeForRenderPass(),N=_.terrain&&_.terrain.renderingToTexture?1:g.exported.devicePixelRatio,U=p.paint.get("line-dasharray"),H=U.constantOr(1),Z=p.layout.get("line-cap"),Q=p.paint.get("line-pattern"),oe=Q.constantOr(1),ie=p.paint.get("line-gradient"),le=p.getCrossfadeParameters(),re=oe?"linePattern":"line",ne=_.context,ue=ne.gl,se=(Se=>{const ge=[];Fa(Se)&&ge.push("RENDER_LINE_DASH"),Se.paint.get("line-gradient")&&ge.push("RENDER_LINE_GRADIENT");const De=Se.paint.get("line-trim-offset");0===De[0]&&0===De[1]||ge.push("RENDER_LINE_TRIM_OFFSET");const Ue=Se.paint.get("line-pattern").constantOr(1),Ke=1!==Se.paint.get("line-opacity").constantOr(1);return!Ue&&Ke&&ge.push("RENDER_LINE_ALPHA_DISCARD"),ge})(p);let Me=se.includes("RENDER_LINE_ALPHA_DISCARD");_.terrain&&_.terrain.clipOrMaskOverlapStencilType()&&(Me=!1);for(const Se of x){const ge=u.getTile(Se);if(oe&&!ge.patternsLoaded())continue;const De=ge.getBucket(p);if(!De)continue;_.prepareDrawTile();const Ue=De.programConfigurations.get(p.id),Ke=_.useProgram(re,Ue,se),je=Q.constantOr(null);if(je&&ge.imageAtlas){const Ft=ge.imageAtlas,kt=Ft.patternPositions[je.to.toString()],Bt=Ft.patternPositions[je.from.toString()];kt&&Bt&&Ue.setConstantPatternPositions(kt,Bt)}const St=U.constantOr(null),Ne=Z.constantOr(null);if(!oe&&St&&Ne&&ge.lineAtlas){const Ft=ge.lineAtlas,kt=Ft.getDash(St.to,Ne),Bt=Ft.getDash(St.from,Ne);kt&&Bt&&Ue.setConstantPatternPositions(kt,Bt)}let[pt,ht]=p.paint.get("line-trim-offset");("round"===Ne||"square"===Ne)&&pt!==ht&&(0===pt&&(pt-=1),1===ht&&(ht+=1));const We=_.terrain?Se.projMatrix:null,Fe=oe?zs(_,ge,p,le,We,N):Hc(_,ge,p,le,We,De.lineClipsArray.length,N,[pt,ht]);if(ie){const Ft=De.gradients[p.id];let kt=Ft.texture;if(p.gradientVersion!==Ft.version){let Bt=256;if(p.stepInterpolant){const un=u.getSource().maxzoom,Nn=Se.canonical.z===un?Math.ceil(1<<_.transform.maxZoom-Se.canonical.z):1;Bt=g.clamp(g.nextPowerOfTwo(De.maxLineLength/g.EXTENT*1024*Nn),256,ne.maxTextureSize)}Ft.gradient=g.renderColorRamp({expression:p.gradientExpression(),evaluationKey:"lineProgress",resolution:Bt,image:Ft.gradient||void 0,clips:De.lineClipsArray}),Ft.texture?Ft.texture.update(Ft.gradient):Ft.texture=new g.Texture(ne,Ft.gradient,ue.RGBA),Ft.version=p.gradientVersion,kt=Ft.texture}ne.activeTexture.set(ue.TEXTURE1),kt.bind(p.stepInterpolant?ue.NEAREST:ue.LINEAR,ue.CLAMP_TO_EDGE)}H&&(ne.activeTexture.set(ue.TEXTURE0),ge.lineAtlasTexture.bind(ue.LINEAR,ue.REPEAT),Ue.updatePaintBuffers(le)),oe&&(ne.activeTexture.set(ue.TEXTURE0),ge.imageAtlasTexture.bind(ue.LINEAR,ue.CLAMP_TO_EDGE),Ue.updatePaintBuffers(le)),_.prepareDrawProgram(ne,Ke,Se.toUnwrapped());const $t=Ft=>{Ke.draw(ne,ue.TRIANGLES,P,Ft,O,g.CullFaceMode.disabled,Fe,p.id,De.layoutVertexBuffer,De.indexBuffer,De.segments,p.paint,_.transform.zoom,Ue,[De.layoutVertexBuffer2])};if(Me){const Ft=_.stencilModeForClipping(Se).ref;0===Ft&&_.terrain&&ne.clear({stencil:0});const kt={func:ue.EQUAL,mask:255};Fe.u_alpha_discard_threshold=.8,$t(new g.StencilMode(kt,Ft,255,ue.KEEP,ue.KEEP,ue.INVERT)),Fe.u_alpha_discard_threshold=0,$t(new g.StencilMode(kt,Ft,255,ue.KEEP,ue.KEEP,ue.KEEP))}else $t(_.stencilModeForClipping(Se))}Me&&(_.resetStencilClippingMasks(),_.terrain&&ne.clear({stencil:0}))},fill:function(_,u,p,x){const M=p.paint.get("fill-color"),E=p.paint.get("fill-opacity");if(0===E.constantOr(1))return;const P=_.colorModeForRenderPass(),O=p.paint.get("fill-pattern"),N=_.opaquePassEnabledForLayer()&&!O.constantOr(1)&&1===M.constantOr(g.Color.transparent).a&&1===E.constantOr(0)?"opaque":"translucent";if(_.renderPass===N){const U=_.depthModeForSublayer(1,"opaque"===_.renderPass?g.DepthMode.ReadWrite:g.DepthMode.ReadOnly);Na(_,u,p,x,U,P,!1)}if("translucent"===_.renderPass&&p.paint.get("fill-antialias")){const U=_.depthModeForSublayer(p.getPaintProperty("fill-outline-color")?2:0,g.DepthMode.ReadOnly);Na(_,u,p,x,U,P,!0)}},"fill-extrusion":function(_,u,p,x){const M=p.paint.get("fill-extrusion-opacity");if(0!==M&&"translucent"===_.renderPass){const E=new g.DepthMode(_.context.gl.LEQUAL,g.DepthMode.ReadWrite,_.depthRangeFor3D);if(1!==M||p.paint.get("fill-extrusion-pattern").constantOr(1))Rm(_,u,p,x,E,g.StencilMode.disabled,g.ColorMode.disabled),Rm(_,u,p,x,E,_.stencilModeFor3D(),_.colorModeForRenderPass()),_.resetStencilClippingMasks();else{const P=_.colorModeForRenderPass();Rm(_,u,p,x,E,g.StencilMode.disabled,P)}}},hillshade:function(_,u,p,x){if("offscreen"!==_.renderPass&&"translucent"!==_.renderPass)return;const M=_.context,E=_.depthModeForSublayer(0,g.DepthMode.ReadOnly),P=_.colorModeForRenderPass(),O=_.terrain&&_.terrain.renderingToTexture,[N,U]="translucent"!==_.renderPass||O?[{},x]:_.stencilConfigForOverlap(x);for(const H of U){const Z=u.getTile(H);if(Z.needsHillshadePrepare&&"offscreen"===_.renderPass)P_(_,Z,p,E,g.StencilMode.disabled,P);else if("translucent"===_.renderPass){const Q=O&&_.terrain?_.terrain.stencilModeForRTTOverlap(H):N[H.overscaledZ];Oa(_,H,Z,p,E,Q,P)}}M.viewport.set([0,0,_.width,_.height]),_.resetStencilClippingMasks()},raster:function(_,u,p,x,M,E){if("translucent"!==_.renderPass||0===p.paint.get("raster-opacity")||!x.length)return;const P=_.context,O=P.gl,N=u.getSource(),U=_.useProgram("raster"),H=_.colorModeForRenderPass(),Z=_.terrain&&_.terrain.renderingToTexture,[Q,oe]=N instanceof Re||Z?[{},x]:_.stencilConfigForOverlap(x),ie=oe[oe.length-1].overscaledZ,le=!_.options.moving;for(const re of oe){const ne=Z?g.DepthMode.disabled:_.depthModeForSublayer(re.overscaledZ-ie,1===p.paint.get("raster-opacity")?g.DepthMode.ReadWrite:g.DepthMode.ReadOnly,O.LESS),ue=re.toUnwrapped(),se=u.getTile(re);if(Z&&(!se||!se.hasData()))continue;const Me=Z?re.projMatrix:_.transform.calculateProjMatrix(ue,le),Se=_.terrain&&Z?_.terrain.stencilModeForRTTOverlap(re):Q[re.overscaledZ],ge=E?0:p.paint.get("raster-fade-duration");se.registerFadeDuration(ge);const De=u.findLoadedParent(re,0),Ue=co(se,De,u,_.transform,ge);let Ke,je;_.terrain&&_.terrain.prepareDrawTile();const St="nearest"===p.paint.get("raster-resampling")?O.NEAREST:O.LINEAR;P.activeTexture.set(O.TEXTURE0),se.texture.bind(St,O.CLAMP_TO_EDGE),P.activeTexture.set(O.TEXTURE1),De?(De.texture.bind(St,O.CLAMP_TO_EDGE),Ke=Math.pow(2,De.tileID.overscaledZ-se.tileID.overscaledZ),je=[se.tileID.canonical.x*Ke%1,se.tileID.canonical.y*Ke%1]):se.texture.bind(St,O.CLAMP_TO_EDGE);const Ne=Gc(Me,je||[0,0],Ke||1,Ue,p,N instanceof Re?N.perspectiveTransform:[0,0]);if(_.prepareDrawProgram(P,U,ue),N instanceof Re)N.boundsBuffer&&N.boundsSegments&&U.draw(P,O.TRIANGLES,ne,g.StencilMode.disabled,H,g.CullFaceMode.disabled,Ne,p.id,N.boundsBuffer,_.quadTriangleIndexBuffer,N.boundsSegments);else{const{tileBoundsBuffer:pt,tileBoundsIndexBuffer:ht,tileBoundsSegments:We}=_.getTileBoundsBuffers(se);U.draw(P,O.TRIANGLES,ne,Se,H,g.CullFaceMode.disabled,Ne,p.id,pt,ht,We)}}_.resetStencilClippingMasks()},background:function(_,u,p,x){const M=p.paint.get("background-color"),E=p.paint.get("background-opacity");if(0===E)return;const P=_.context,O=P.gl,N=_.transform,U=N.tileSize,H=p.paint.get("background-pattern");if(_.isPatternMissing(H))return;const Z=!H&&1===M.a&&1===E&&_.opaquePassEnabledForLayer()?"opaque":"translucent";if(_.renderPass!==Z)return;const Q=g.StencilMode.disabled,oe=_.depthModeForSublayer(0,"opaque"===Z?g.DepthMode.ReadWrite:g.DepthMode.ReadOnly),ie=_.colorModeForRenderPass(),le=_.useProgram(H?"backgroundPattern":"background");let re,ne=x;ne||(re=_.getBackgroundTiles(),ne=Object.values(re).map(se=>se.tileID)),H&&(P.activeTexture.set(O.TEXTURE0),_.imageManager.bind(_.context));const ue=p.getCrossfadeParameters();for(const se of ne){const Me=se.toUnwrapped(),Se=x?se.projMatrix:_.transform.calculateProjMatrix(Me);_.prepareDrawTile();const ge=u?u.getTile(se):re?re[se.key]:new g.Tile(se,U,N.zoom,_),De=H?Rh(Se,E,_,H,{tileID:se,tileSize:U},ue):Ph(Se,E,M);_.prepareDrawProgram(P,le,Me);const{tileBoundsBuffer:Ue,tileBoundsIndexBuffer:Ke,tileBoundsSegments:je}=_.getTileBoundsBuffers(ge);le.draw(P,O.TRIANGLES,oe,Q,ie,g.CullFaceMode.disabled,De,p.id,Ue,Ke,je)}},sky:function(_,u,p){const x=_.transform,M="mercator"===x.projection.name||"globe"===x.projection.name?1:g.smoothstep(7,8,x.zoom),E=p.paint.get("sky-opacity")*M;if(0===E)return;const P=_.context,O=p.paint.get("sky-type"),N=new g.DepthMode(P.gl.LEQUAL,g.DepthMode.ReadOnly,[0,1]),U=_.frameCounter/1e3%1;"atmosphere"===O?"offscreen"===_.renderPass?p.needsSkyboxCapture(_)&&(function(H,Z,Q,oe){const ie=H.context,le=ie.gl;let re=Z.skyboxFbo;if(!re){re=Z.skyboxFbo=ie.createFramebuffer(32,32,!1),Z.skyboxGeometry=new Xi(ie),Z.skyboxTexture=ie.gl.createTexture(),le.bindTexture(le.TEXTURE_CUBE_MAP,Z.skyboxTexture),le.texParameteri(le.TEXTURE_CUBE_MAP,le.TEXTURE_WRAP_S,le.CLAMP_TO_EDGE),le.texParameteri(le.TEXTURE_CUBE_MAP,le.TEXTURE_WRAP_T,le.CLAMP_TO_EDGE),le.texParameteri(le.TEXTURE_CUBE_MAP,le.TEXTURE_MIN_FILTER,le.LINEAR),le.texParameteri(le.TEXTURE_CUBE_MAP,le.TEXTURE_MAG_FILTER,le.LINEAR);for(let Me=0;Me<6;++Me)le.texImage2D(le.TEXTURE_CUBE_MAP_POSITIVE_X+Me,0,le.RGBA,32,32,0,le.RGBA,le.UNSIGNED_BYTE,null)}ie.bindFramebuffer.set(re.framebuffer),ie.viewport.set([0,0,32,32]);const ne=Z.getCenter(H,!0),ue=H.useProgram("skyboxCapture"),se=new Float64Array(16);g.identity(se),g.rotateY(se,se,.5*-Math.PI),$c(ie,Z,ue,se,ne,0),g.identity(se),g.rotateY(se,se,.5*Math.PI),$c(ie,Z,ue,se,ne,1),g.identity(se),g.rotateX(se,se,.5*-Math.PI),$c(ie,Z,ue,se,ne,2),g.identity(se),g.rotateX(se,se,.5*Math.PI),$c(ie,Z,ue,se,ne,3),g.identity(se),$c(ie,Z,ue,se,ne,4),g.identity(se),g.rotateY(se,se,Math.PI),$c(ie,Z,ue,se,ne,5),ie.viewport.set([0,0,H.width,H.height])}(_,p),p.markSkyboxValid(_)):"sky"===_.renderPass&&function(H,Z,Q,oe,ie){const le=H.context,re=le.gl,ne=H.transform,ue=H.useProgram("skybox");le.activeTexture.set(re.TEXTURE0),re.bindTexture(re.TEXTURE_CUBE_MAP,Z.skyboxTexture);const se={u_matrix:ne.skyboxMatrix,u_sun_direction:Z.getCenter(H,!1),u_cubemap:0,u_opacity:oe,u_temporal_offset:ie};H.prepareDrawProgram(le,ue),ue.draw(le,re.TRIANGLES,Q,g.StencilMode.disabled,H.colorModeForRenderPass(),g.CullFaceMode.backCW,se,"skybox",Z.skyboxGeometry.vertexBuffer,Z.skyboxGeometry.indexBuffer,Z.skyboxGeometry.segment)}(_,p,N,E,U):"gradient"===O&&"sky"===_.renderPass&&function(H,Z,Q,oe,ie){const le=H.context,re=le.gl,ne=H.transform,ue=H.useProgram("skyboxGradient");Z.skyboxGeometry||(Z.skyboxGeometry=new Xi(le)),le.activeTexture.set(re.TEXTURE0);let se=Z.colorRampTexture;se||(se=Z.colorRampTexture=new g.Texture(le,Z.colorRamp,re.RGBA)),se.bind(re.LINEAR,re.CLAMP_TO_EDGE);const Me=(Se=ne.skyboxMatrix,ge=Z.getCenter(H,!1),De=Z.paint.get("sky-gradient-radius"),Ue=oe,Ke=ie,{u_matrix:Se,u_color_ramp:0,u_center_direction:ge,u_radius:g.degToRad(De),u_opacity:Ue,u_temporal_offset:Ke});var Se,ge,De,Ue,Ke;H.prepareDrawProgram(le,ue),ue.draw(le,re.TRIANGLES,Q,g.StencilMode.disabled,H.colorModeForRenderPass(),g.CullFaceMode.backCW,Me,"skyboxGradient",Z.skyboxGeometry.vertexBuffer,Z.skyboxGeometry.indexBuffer,Z.skyboxGeometry.segment)}(_,p,N,E,U)},debug:function(_,u,p){for(let x=0;x<p.length;x++)Id(_,u,p[x])},custom:function(_,u,p){const x=_.context,M=p.implementation;if(_.transform.projection.unsupportedLayers&&_.transform.projection.unsupportedLayers.includes("custom"))g.warnOnce("Custom layers are not yet supported with non-mercator projections. Use mercator to enable custom layers.");else if("offscreen"===_.renderPass){const E=M.prerender;E&&(_.setCustomLayerDefaults(),x.setColorMode(_.colorModeForRenderPass()),E.call(M,x.gl,_.transform.customLayerMatrix()),x.setDirty(),_.setBaseState())}else if("translucent"===_.renderPass){_.setCustomLayerDefaults(),x.setColorMode(_.colorModeForRenderPass()),x.setStencilMode(g.StencilMode.disabled);const E="3d"===M.renderingMode?new g.DepthMode(_.context.gl.LEQUAL,g.DepthMode.ReadWrite,_.depthRangeFor3D):_.depthModeForSublayer(0,g.DepthMode.ReadOnly);x.setDepthMode(E),M.render(x.gl,_.transform.customLayerMatrix()),x.setDirty(),_.setBaseState(),x.bindFramebuffer.set(null)}}};class Lm{constructor(u,p){this.context=new q(u),this.transform=p,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.setup(),this.numSublayers=g.SourceCache.maxUnderzooming+g.SourceCache.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new tc,this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={}}updateTerrain(u,p){const x=!!u&&!!u.terrain&&this.transform.projection.supportsTerrain;if(!(x||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new Ou(this,u));const M=this._terrain;this.transform.elevation=x?M:null,M.update(u,this.transform,p)}_updateFog(u){const p=u.fog;if(!p||"globe"===this.transform.projection.name||p.getOpacity(this.transform.pitch)<1||p.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[x,M]=p.getFovAdjustedRange(this.transform._fov);if(x>M)return void(this.transform.fogCullDistSq=null);const E=x+.78*(M-x);this.transform.fogCullDistSq=E*E}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled?this._terrain:null}resize(u,p){if(this.width=u*g.exported.devicePixelRatio,this.height=p*g.exported.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const x of this.style.order)this.style._layers[x].resize()}setup(){const u=this.context,p=new g.StructArrayLayout2i4;p.emplaceBack(0,0),p.emplaceBack(g.EXTENT,0),p.emplaceBack(0,g.EXTENT),p.emplaceBack(g.EXTENT,g.EXTENT),this.tileExtentBuffer=u.createVertexBuffer(p,g.posAttributes.members),this.tileExtentSegments=g.SegmentVector.simpleSegment(0,0,4,2);const x=new g.StructArrayLayout2i4;x.emplaceBack(0,0),x.emplaceBack(g.EXTENT,0),x.emplaceBack(0,g.EXTENT),x.emplaceBack(g.EXTENT,g.EXTENT),this.debugBuffer=u.createVertexBuffer(x,g.posAttributes.members),this.debugSegments=g.SegmentVector.simpleSegment(0,0,4,5);const M=new g.StructArrayLayout2i4;M.emplaceBack(-1,-1),M.emplaceBack(1,-1),M.emplaceBack(-1,1),M.emplaceBack(1,1),this.viewportBuffer=u.createVertexBuffer(M,g.posAttributes.members),this.viewportSegments=g.SegmentVector.simpleSegment(0,0,4,2);const E=new g.StructArrayLayout4i8;E.emplaceBack(0,0,0,0),E.emplaceBack(g.EXTENT,0,g.EXTENT,0),E.emplaceBack(0,g.EXTENT,0,g.EXTENT),E.emplaceBack(g.EXTENT,g.EXTENT,g.EXTENT,g.EXTENT),this.mercatorBoundsBuffer=u.createVertexBuffer(E,g.boundsAttributes.members),this.mercatorBoundsSegments=g.SegmentVector.simpleSegment(0,0,4,2);const P=new g.StructArrayLayout3ui6;P.emplaceBack(0,1,2),P.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=u.createIndexBuffer(P);const O=new g.StructArrayLayout1ui2;for(const U of[0,1,3,2,0])O.emplaceBack(U);this.debugIndexBuffer=u.createIndexBuffer(O),this.emptyTexture=new g.Texture(u,new g.RGBAImage({width:1,height:1},Uint8Array.of(0,0,0,0)),u.gl.RGBA),this.identityMat=g.create();const N=this.context.gl;this.stencilClearMode=new g.StencilMode({func:N.ALWAYS,mask:0},0,255,N.ZERO,N.ZERO,N.ZERO),this.loadTimeStamps.push(g.window.performance.now()),this.atmosphereBuffer=new A0(this.context)}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(u){return u._makeTileBoundsBuffers(this.context,this.transform.projection),u._tileBoundsBuffer?{tileBoundsBuffer:u._tileBoundsBuffer,tileBoundsIndexBuffer:u._tileBoundsIndexBuffer,tileBoundsSegments:u._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const u=this.context,p=u.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.useProgram("clippingMask").draw(u,p.TRIANGLES,g.DepthMode.disabled,this.stencilClearMode,g.ColorMode.disabled,g.CullFaceMode.disabled,an(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(u,p,x){if(!p||this.currentStencilSource===p.id||!u.isTileClipped()||!x||0===x.length)return;if(this._tileClippingMaskIDs&&!this.terrain){let O=!1;for(const N of x)if(void 0===this._tileClippingMaskIDs[N.key]){O=!0;break}if(!O)return}this.currentStencilSource=p.id;const M=this.context,E=M.gl;this.nextStencilID+x.length>256&&this.clearStencil(),M.setColorMode(g.ColorMode.disabled),M.setDepthMode(g.DepthMode.disabled);const P=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const O of x){const N=p.getTile(O),U=this._tileClippingMaskIDs[O.key]=this.nextStencilID++,{tileBoundsBuffer:H,tileBoundsIndexBuffer:Z,tileBoundsSegments:Q}=this.getTileBoundsBuffers(N);P.draw(M,E.TRIANGLES,g.DepthMode.disabled,new g.StencilMode({func:E.ALWAYS,mask:0},U,255,E.KEEP,E.KEEP,E.REPLACE),g.ColorMode.disabled,g.CullFaceMode.disabled,an(O.projMatrix),"$clipping",H,Z,Q)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const u=this.nextStencilID++,p=this.context.gl;return new g.StencilMode({func:p.NOTEQUAL,mask:255},u,255,p.KEEP,p.KEEP,p.REPLACE)}stencilModeForClipping(u){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(u);const p=this.context.gl;return new g.StencilMode({func:p.EQUAL,mask:255},this._tileClippingMaskIDs[u.key],0,p.KEEP,p.KEEP,p.REPLACE)}stencilConfigForOverlap(u){const p=this.context.gl,x=u.sort((P,O)=>O.overscaledZ-P.overscaledZ),M=x[x.length-1].overscaledZ,E=x[0].overscaledZ-M+1;if(E>1){this.currentStencilSource=void 0,this.nextStencilID+E>256&&this.clearStencil();const P={};for(let O=0;O<E;O++)P[O+M]=new g.StencilMode({func:p.GEQUAL,mask:255},O+this.nextStencilID,255,p.KEEP,p.KEEP,p.REPLACE);return this.nextStencilID+=E,[P,x]}return[{[M]:g.StencilMode.disabled},x]}colorModeForRenderPass(){const u=this.context.gl;return this._showOverdrawInspector?new g.ColorMode([u.CONSTANT_COLOR,u.ONE],new g.Color(.125,.125,.125,0),[!0,!0,!0,!0]):"opaque"===this.renderPass?g.ColorMode.unblended:g.ColorMode.alphaBlended}depthModeForSublayer(u,p,x){if(!this.opaquePassEnabledForLayer())return g.DepthMode.disabled;const M=1-((1+this.currentLayer)*this.numSublayers+u)*this.depthEpsilon;return new g.DepthMode(x||this.context.gl.LEQUAL,p,[M,M])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(u,p){this.style=u,this.options=p,this.imageManager=u.imageManager,this.glyphManager=u.glyphManager,this.symbolFadeChange=u.placement.symbolFadeChange(g.exported.now()),this.imageManager.beginFrame();const x=this.style.order,M=this.style._sourceCaches;for(const N in M){const U=M[N];U.used&&U.prepare(this.context)}const E={},P={},O={};for(const N in M){const U=M[N];E[N]=U.getVisibleCoordinates(),P[N]=E[N].slice().reverse(),O[N]=U.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let N=0;N<x.length;N++)if(this.style._layers[x[N]].is3D()){this.opaquePassCutoff=N;break}if(this.terrain&&(this.terrain.updateTileBinding(O),this.opaquePassCutoff=0),"globe"!==this.transform.projection.name||this.globeSharedBuffers||(this.globeSharedBuffers=new g.GlobeSharedBuffers(this.context)),g.isMapAuthenticated(this.context.gl)){this.renderPass="offscreen";for(const N of x){const U=this.style._layers[N],H=u._getLayerSourceCache(U);if(!U.hasOffscreenPass()||U.isHidden(this.transform.zoom))continue;const Z=H?P[H.id]:void 0;("custom"===U.type||U.isSky()||Z&&Z.length)&&this.renderLayer(this,H,U,Z)}if(this.depthRangeFor3D=[0,1-(u.order.length+2)*this.numSublayers*this.depthEpsilon],this.terrain&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&this.terrain.drawDepth(),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]),this.context.clear({color:p.showOverdrawInspector?g.Color.black:g.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=p.showOverdrawInspector,this.renderPass="opaque",!this.terrain)for(this.currentLayer=x.length-1;this.currentLayer>=0;this.currentLayer--){const N=this.style._layers[x[this.currentLayer]],U=u._getLayerSourceCache(N);if(N.isSky())continue;const H=U?P[U.id]:void 0;this._renderTileClippingMasks(N,U,H),this.renderLayer(this,U,N,H)}if(this.style.fog&&this.transform.projection.supportsFog&&function(N,U){const H=N.context,Z=H.gl,Q=N.transform,oe=new g.DepthMode(Z.LEQUAL,g.DepthMode.ReadOnly,[0,1]),ie=N.useProgram("globeAtmosphere",null,"globe"===Q.projection.name?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"]),le=g.globeToMercatorTransition(Q.zoom),re=U.properties.get("color").toArray01(),ne=U.properties.get("high-color").toArray01(),ue=U.properties.get("space-color").toArray01PremultipliedAlpha(),se=g.identity$1([]);g.rotateY$1(se,se,-g.degToRad(Q._center.lng)),g.rotateX$1(se,se,g.degToRad(Q._center.lat)),g.rotateZ$1(se,se,Q.angle),g.rotateX$1(se,se,-Q._pitch);const Me=g.fromQuat(new Float32Array(16),se),Se=g.mapValue(U.properties.get("star-intensity"),0,1,0,.25),De=g.mapValue(U.properties.get("horizon-blend"),0,1,5e-4,.25),Ue=g.globeUseCustomAntiAliasing(N,H,Q)&&5e-4===De?Q.worldSize/(2*Math.PI*1.025)-1:Q.globeRadius,Ke=N.frameCounter/1e3%1,je=g.length(Q.globeCenterInViewSpace),St=Math.sqrt(Math.pow(je,2)-Math.pow(Ue,2)),Ne=Math.acos(St/je),pt={u_frustum_tl:Q.frustumCorners.TL,u_frustum_tr:Q.frustumCorners.TR,u_frustum_br:Q.frustumCorners.BR,u_frustum_bl:Q.frustumCorners.BL,u_horizon:Q.frustumCorners.horizon,u_transition:le,u_fadeout_range:De,u_color:re,u_high_color:ne,u_space_color:ue,u_star_intensity:Se,u_star_size:5*g.exported.devicePixelRatio,u_star_density:0,u_temporal_offset:Ke,u_horizon_angle:Ne,u_rotation_matrix:Me};N.prepareDrawProgram(H,ie);const ht=N.atmosphereBuffer;ht&&ie.draw(H,Z.TRIANGLES,oe,g.StencilMode.disabled,g.ColorMode.alphaBlended,g.CullFaceMode.backCW,pt,"skybox",ht.vertexBuffer,ht.indexBuffer,ht.segments)}(this,this.style.fog),this.renderPass="sky",(g.globeToMercatorTransition(this.transform.zoom)>0||"globe"!==this.transform.projection.name)&&this.transform.isHorizonVisible())for(this.currentLayer=0;this.currentLayer<x.length;this.currentLayer++){const N=this.style._layers[x[this.currentLayer]],U=u._getLayerSourceCache(N);N.isSky()&&this.renderLayer(this,U,N,U?P[U.id]:void 0)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<x.length;){const N=this.style._layers[x[this.currentLayer]],U=u._getLayerSourceCache(N);if(N.isSky()){++this.currentLayer;continue}if(this.terrain&&this.style.isLayerDraped(N)){if(N.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer);continue}const H=U?("symbol"===N.type?O:P)[U.id]:void 0;this._renderTileClippingMasks(N,U,U?E[U.id]:void 0),this.renderLayer(this,U,N,H),++this.currentLayer}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let N=null;g.values(this.style._layers).forEach(U=>{const H=u._getLayerSourceCache(U);H&&!U.isHidden(this.transform.zoom)&&(!N||N.getSource().maxzoom<H.getSource().maxzoom)&&(N=H)}),N&&this.options.showTileBoundaries&&Vu.debug(this,N,N.getVisibleCoordinates())}this.options.showPadding&&function(N){const U=N.transform.padding;Oh(N,N.transform.height-(U.top||0),3,km),Oh(N,U.bottom||0,3,O_),N_(N,U.left||0,3,E0),N_(N,N.transform.width-(U.right||0),3,T0);const H=N.transform.centerPoint;var Z,Q,oe,ie;jc(Z=N,(Q=H.x)-1,(oe=N.transform.height-H.y)-10,2,20,ie=F_),jc(Z,Q-10,oe-1,20,2,ie)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(g.window.performance.now()),this.saveCanvasCopy())}}renderLayer(u,p,x,M){x.isHidden(this.transform.zoom)||("background"===x.type||"sky"===x.type||"custom"===x.type||M&&M.length)&&(this.id=x.id,this.gpuTimingStart(x),u.transform.projection.unsupportedLayers&&u.transform.projection.unsupportedLayers.includes(x.type)||Vu[x.type](u,p,x,M,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(u){if(!this.options.gpuTiming)return;const p=this.context.extTimerQuery;let x=this.gpuTimers[u.id];x||(x=this.gpuTimers[u.id]={calls:0,cpuTime:0,query:p.createQueryEXT()}),x.calls++,p.beginQueryEXT(p.TIME_ELAPSED_EXT,x.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const u=this.context.extTimerQuery,p=u.createQueryEXT();this.deferredRenderGpuTimeQueries.push(p),u.beginQueryEXT(u.TIME_ELAPSED_EXT,p)}}gpuTimingDeferredRenderEnd(){if(!this.options.gpuTimingDeferredRender)return;const u=this.context.extTimerQuery;u.endQueryEXT(u.TIME_ELAPSED_EXT)}gpuTimingEnd(){if(!this.options.gpuTiming)return;const u=this.context.extTimerQuery;u.endQueryEXT(u.TIME_ELAPSED_EXT)}collectGpuTimers(){const u=this.gpuTimers;return this.gpuTimers={},u}collectDeferredRenderGpuQueries(){const u=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],u}queryGpuTimers(u){const p={};for(const x in u){const M=u[x],E=this.context.extTimerQuery,P=E.getQueryObjectEXT(M.query,E.QUERY_RESULT_EXT)/1e6;E.deleteQueryEXT(M.query),p[x]=P}return p}queryGpuTimeDeferredRender(u){if(!this.options.gpuTimingDeferredRender)return 0;const p=this.context.extTimerQuery;let x=0;for(const M of u)x+=p.getQueryObjectEXT(M,p.QUERY_RESULT_EXT)/1e6,p.deleteQueryEXT(M);return x}translatePosMatrix(u,p,x,M,E){if(!x[0]&&!x[1])return u;const P=E?"map"===M?this.transform.angle:0:"viewport"===M?-this.transform.angle:0;if(P){const U=Math.sin(P),H=Math.cos(P);x=[x[0]*H-x[1]*U,x[0]*U+x[1]*H]}const O=[E?x[0]:Pl(p,x[0],this.transform.zoom),E?x[1]:Pl(p,x[1],this.transform.zoom),0],N=new Float32Array(16);return g.translate(N,u,O),N}saveTileTexture(u){const p=this._tileTextures[u.size[0]];p?p.push(u):this._tileTextures[u.size[0]]=[u]}getTileTexture(u){const p=this._tileTextures[u];return p&&p.length>0?p.pop():null}isPatternMissing(u){if(!u)return!1;if(!u.from||!u.to)return!0;const p=this.imageManager.getPattern(u.from.toString()),x=this.imageManager.getPattern(u.to.toString());return!p||!x}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture}currentGlobalDefines(){const u=this.terrain&&this.terrain.renderingToTexture,p=this.style&&this.style.fog,x=[];return this.terrainRenderModeElevated()&&x.push("TERRAIN"),"globe"===this.transform.projection.name&&x.push("GLOBE"),p&&!u&&0!==p.getOpacity(this.transform.pitch)&&x.push("FOG"),u&&x.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&x.push("OVERDRAW_INSPECTOR"),x}useProgram(u,p,x){this.cache=this.cache||{};const M=x||[],E=this.currentGlobalDefines().concat(M),P=Xo.cacheKey(er[u],u,E,p);return this.cache[P]||(this.cache[P]=new Xo(this.context,u,er[u],p,zu[u],E)),this.cache[P]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const u=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(u.FUNC_ADD)}initDebugOverlayCanvas(){null==this.debugOverlayCanvas&&(this.debugOverlayCanvas=g.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new g.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this.atmosphereBuffer&&this.atmosphereBuffer.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}prepareDrawProgram(u,p,x){if(this.terrain&&this.terrain.renderingToTexture)return;const M=this.style.fog;if(M){const E=M.getOpacity(this.transform.pitch),P=((O,N,U,H,Z,Q,oe,ie,le,re,ne)=>{const ue=O.transform,se=N.properties.get("color").toArray01();se[3]=H;const Me=O.frameCounter/1e3%1;return{u_fog_matrix:U?ue.calculateFogTileMatrix(U):O.identityMat,u_fog_range:N.getFovAdjustedRange(ue._fov),u_fog_color:se,u_fog_horizon_blend:N.properties.get("horizon-blend"),u_fog_temporal_offset:Me,u_frustum_tl:Z,u_frustum_tr:Q,u_frustum_br:oe,u_frustum_bl:ie,u_globe_pos:le,u_globe_radius:re,u_viewport:ne,u_globe_transition:g.globeToMercatorTransition(ue.zoom),u_is_globe:+("globe"===ue.projection.name)}})(this,M,x,E,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*g.exported.devicePixelRatio,this.transform.height*g.exported.devicePixelRatio]);p.setFogUniformValues(u,P)}}setTileLoadedFlag(u){this.tileLoaded=u}saveCanvasCopy(){this.frameCopies.push(this.canvasCopy()),this.tileLoaded=!1}canvasCopy(){const u=this.context.gl,p=u.createTexture();return u.bindTexture(u.TEXTURE_2D,p),u.copyTexImage2D(u.TEXTURE_2D,0,u.RGBA,0,0,u.drawingBufferWidth,u.drawingBufferHeight,0),p}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const u=this.style&&this.style.fog;return!!u&&0!==u.getOpacity(this.transform.pitch)}getBackgroundTiles(){const u=this._backgroundTiles,p=this._backgroundTiles={},x=this.transform.coveringTiles({tileSize:512});for(const M of x)p[M.key]=u[M.key]||new g.Tile(M,512,this.transform.tileZoom,this);return p}clearBackgroundTiles(){this._backgroundTiles={}}}class B_{constructor(u=0,p=0,x=0,M=0){if(isNaN(u)||u<0||isNaN(p)||p<0||isNaN(x)||x<0||isNaN(M)||M<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=u,this.bottom=p,this.left=x,this.right=M}interpolate(u,p,x){return null!=p.top&&null!=u.top&&(this.top=g.number(u.top,p.top,x)),null!=p.bottom&&null!=u.bottom&&(this.bottom=g.number(u.bottom,p.bottom,x)),null!=p.left&&null!=u.left&&(this.left=g.number(u.left,p.left,x)),null!=p.right&&null!=u.right&&(this.right=g.number(u.right,p.right,x)),this}getCenter(u,p){const x=g.clamp((this.left+u-this.right)/2,0,u),M=g.clamp((this.top+p-this.bottom)/2,0,p);return new g.pointGeometry(x,M)}equals(u){return this.top===u.top&&this.bottom===u.bottom&&this.left===u.left&&this.right===u.right}clone(){return new B_(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function z_(_,u){const p=g.getColumn(_,3);g.fromQuat(_,u),g.setColumn(_,3,p)}function V_(_,u){const p=g.identity$1([]);return g.rotateZ$1(p,p,-u),g.rotateX$1(p,p,-_),p}function rl(_,u){const p=[_[0],_[1],0],x=[u[0],u[1],0];if(g.length(p)>=1e-15){const P=g.normalize([],p);g.scale$2(x,P,g.dot(x,P)),u[0]=x[0],u[1]=x[1]}const M=g.cross([],u,_);if(g.len(M)<1e-15)return null;const E=Math.atan2(-M[1],M[0]);return V_(Math.atan2(Math.sqrt(_[0]*_[0]+_[1]*_[1]),-_[2]),E)}class Nh{constructor(u,p){this.position=u,this.orientation=p}get position(){return this._position}set position(u){if(u){const p=u instanceof g.MercatorCoordinate?u:new g.MercatorCoordinate(u[0],u[1],u[2]);this._renderWorldCopies&&(p.x=g.wrap(p.x,0,1)),this._position=p}else this._position=null}lookAtPoint(u,p){if(this.orientation=null,!this.position)return;const x=this._elevation?this._elevation.getAtPointOrZero(g.MercatorCoordinate.fromLngLat(u)):0,M=this.position,E=g.MercatorCoordinate.fromLngLat(u,x),P=[E.x-M.x,E.y-M.y,E.z-M.z];p||(p=[0,0,1]),p[2]=Math.abs(p[2]),this.orientation=rl(P,p)}setPitchBearing(u,p){this.orientation=V_(g.degToRad(u),g.degToRad(-p))}}class Nr{constructor(u,p){this._transform=g.identity([]),this.orientation=p,this.position=u}get mercatorPosition(){const u=this.position;return new g.MercatorCoordinate(u[0],u[1],u[2])}get position(){const u=g.getColumn(this._transform,3);return[u[0],u[1],u[2]]}set position(u){var p;u&&g.setColumn(this._transform,3,[(p=u)[0],p[1],p[2],1])}get orientation(){return this._orientation}set orientation(u){this._orientation=u||g.identity$1([]),u&&z_(this._transform,this._orientation)}getPitchBearing(){const u=this.forward(),p=this.right();return{bearing:Math.atan2(-p[1],p[0]),pitch:Math.atan2(Math.sqrt(u[0]*u[0]+u[1]*u[1]),-u[2])}}setPitchBearing(u,p){this._orientation=V_(u,p),z_(this._transform,this._orientation)}forward(){const u=g.getColumn(this._transform,2);return[-u[0],-u[1],-u[2]]}up(){const u=g.getColumn(this._transform,1);return[-u[0],-u[1],-u[2]]}right(){const u=g.getColumn(this._transform,0);return[u[0],u[1],u[2]]}getCameraToWorld(u,p){const x=new Float64Array(16);return g.invert(x,this.getWorldToCamera(u,p)),x}getWorldToCameraPosition(u,p,x){const M=this.position;g.scale$2(M,M,-u);const E=new Float64Array(16);return g.fromScaling(E,[x,x,x]),g.translate(E,E,M),E[10]*=p,E}getWorldToCamera(u,p){const x=new Float64Array(16),M=new Float64Array(4),E=this.position;return g.conjugate(M,this._orientation),g.scale$2(E,E,-u),g.fromQuat(x,M),g.translate(x,x,E),x[1]*=-1,x[5]*=-1,x[9]*=-1,x[13]*=-1,x[8]*=p,x[9]*=p,x[10]*=p,x[11]*=p,x}getCameraToClipPerspective(u,p,x,M){const E=new Float64Array(16);return g.perspective(E,u,p,x,M),E}getDistanceToElevation(u){const p=0===u?0:g.mercatorZfromAltitude(u,this.position[1]),x=this.forward();return(p-this.position[2])/x[2]}clone(){return new Nr([...this.position],[...this.orientation])}}function Bh(_,u){const p=zh(_.projection,_.zoom,_.width,_.height),x=function(E,P,O,N,U){const H=new g.LngLat(O.lng-180*Nl,O.lat),Z=new g.LngLat(O.lng+180*Nl,O.lat),Q=E.project(H.lng,H.lat),oe=E.project(Z.lng,Z.lat),ie=-Math.atan2(oe.y-Q.y,oe.x-Q.x),le=g.MercatorCoordinate.fromLngLat(O);le.y=g.clamp(le.y,-.999975,.999975);const re=le.toLngLat(),ne=E.project(re.lng,re.lat),ue=g.MercatorCoordinate.fromLngLat(re);ue.x+=Nl;const se=ue.toLngLat(),Me=E.project(se.lng,se.lat),Se=Jt(Me.x-ne.x,Me.y-ne.y,ie),ge=g.MercatorCoordinate.fromLngLat(re);ge.y+=Nl;const De=ge.toLngLat(),Ue=E.project(De.lng,De.lat),Ke=Jt(Ue.x-ne.x,Ue.y-ne.y,ie),je=Math.abs(Se.x)/Math.abs(Ke.y),St=g.identity([]);g.rotateZ(St,St,-ie*(1-(U?0:N)));const Ne=g.identity([]);return g.scale(Ne,Ne,[1,1-(1-je)*N,1]),Ne[4]=-Ke.x/Ke.y*N,g.rotateZ(Ne,Ne,ie),g.multiply(Ne,St,Ne),Ne}(_.projection,0,_.center,p,u),M=Zp(_);return g.scale(x,x,[M,M,1]),x}function Zp(_){const u=_.projection,p=zh(_.projection,_.zoom,_.width,_.height),x=Pd(u,_.center),M=Pd(u,g.LngLat.convert(u.center));return Math.pow(2,x*p+(1-p)*M)}function zh(_,u,p,x,M=1/0){const E=_.range;if(!E)return 0;const P=Math.min(M,Math.max(p,x)),O=Math.log(P/1024)/Math.LN2;return g.smoothstep(E[0]+O,E[1]+O,u)}const Nl=1/4e4;function Pd(_,u){const p=g.clamp(u.lat,-g.MAX_MERCATOR_LATITUDE,g.MAX_MERCATOR_LATITUDE),x=new g.LngLat(u.lng-180*Nl,p),M=new g.LngLat(u.lng+180*Nl,p),E=_.project(x.lng,p),P=_.project(M.lng,p),O=g.MercatorCoordinate.fromLngLat(x),N=g.MercatorCoordinate.fromLngLat(M),U=P.x-E.x,H=P.y-E.y,Z=N.x-O.x,Q=N.y-O.y,oe=Math.sqrt((Z*Z+Q*Q)/(U*U+H*H));return Math.log(oe)/Math.LN2}function Jt(_,u,p){const x=Math.cos(p),M=Math.sin(p);return{x:_*x-u*M,y:_*M+u*x}}class Oo{constructor(u,p,x,M,E,P,O){this.tileSize=512,this._renderWorldCopies=void 0===E||E,this._minZoom=u||0,this._maxZoom=p||22,this._minPitch=x??0,this._maxPitch=M??60,this.setProjection(P),this.setMaxBounds(O),this.width=0,this.height=0,this._center=new g.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new B_,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._distanceTileDataCache={},this._camera=new Nr,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._horizonShift=.1}clone(){const u=new Oo(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return u._elevation=this._elevation,u._centerAltitude=this._centerAltitude,u._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,u.tileSize=this.tileSize,u.mercatorFromTransition=this.mercatorFromTransition,u.width=this.width,u.height=this.height,u.cameraElevationReference=this.cameraElevationReference,u._center=this._center,u._setZoom(this.zoom),u._seaLevelZoom=this._seaLevelZoom,u.angle=this.angle,u._fov=this._fov,u._pitch=this._pitch,u._nearZ=this._nearZ,u._farZ=this._farZ,u._averageElevation=this._averageElevation,u._unmodified=this._unmodified,u._edgeInsets=this._edgeInsets.clone(),u._camera=this._camera.clone(),u._calcMatrices(),u.freezeTileCoverage=this.freezeTileCoverage,u.frustumCorners=this.frustumCorners,u}get elevation(){return this._elevation}set elevation(u){this._elevation!==u&&(this._elevation=u,this._updateCameraOnTerrain(),this._calcMatrices())}updateElevation(u){const p=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(null==this._seaLevelZoom||p)&&this._updateCameraOnTerrain(),(u||p)&&this._constrainCameraAltitude(),this._calcMatrices()}getProjection(){return g.pick(this.projection,["name","center","parallels"])}setProjection(u){this.projectionOptions=u||{name:"mercator"};const p=this.projection?this.getProjection():void 0;this.projection=g.getProjection(this.projectionOptions);const x=!lt(p,this.getProjection());return x&&this._calcMatrices(),this.mercatorFromTransition=!1,x}setMercatorFromTransition(){const u=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=g.getProjection({name:"mercator"});const p=u!==this.projection.name;return p&&this._calcMatrices(),p}get minZoom(){return this._minZoom}set minZoom(u){this._minZoom!==u&&(this._minZoom=u,this.zoom=Math.max(this.zoom,u))}get maxZoom(){return this._maxZoom}set maxZoom(u){this._maxZoom!==u&&(this._maxZoom=u,this.zoom=Math.min(this.zoom,u))}get minPitch(){return this._minPitch}set minPitch(u){this._minPitch!==u&&(this._minPitch=u,this.pitch=Math.max(this.pitch,u))}get maxPitch(){return this._maxPitch}set maxPitch(u){this._maxPitch!==u&&(this._maxPitch=u,this.pitch=Math.min(this.pitch,u))}get renderWorldCopies(){return this._renderWorldCopies&&!0===this.projection.supportsWorldCopies}set renderWorldCopies(u){void 0===u?u=!0:null===u&&(u=!1),this._renderWorldCopies=u}get worldSize(){return this.tileSize*this.scale}get cameraWorldSize(){const u=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(u))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return g.mercatorZfromAltitude(this.center.lat,this.cameraWorldSize)}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new g.pointGeometry(this.width,this.height)}get bearing(){return g.wrap(this.rotation,-180,180)}set bearing(u){this.rotation=u}get rotation(){return-this.angle/Math.PI*180}set rotation(u){const p=-u*Math.PI/180;var x,M,E,P,O,N,U,H,Z,Q;this.angle!==p&&(this._unmodified=!1,this.angle=p,this._calcMatrices(),this.rotationMatrix=(x=new g.ARRAY_TYPE(4),g.ARRAY_TYPE!=Float32Array&&(x[1]=0,x[2]=0),x[0]=1,x[3]=1,x),M=this.rotationMatrix,P=this.angle,O=(E=this.rotationMatrix)[0],N=E[1],U=E[2],H=E[3],Z=Math.sin(P),Q=Math.cos(P),M[0]=O*Q+U*Z,M[1]=N*Q+H*Z,M[2]=O*-Z+U*Q,M[3]=N*-Z+H*Q)}get pitch(){return this._pitch/Math.PI*180}set pitch(u){const p=g.clamp(u,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==p&&(this._unmodified=!1,this._pitch=p,this._calcMatrices())}get aspect(){return this.width/this.height}get fovX(){return this._fov}get fovY(){const u=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/u)}set fov(u){u=Math.max(.01,Math.min(60,u)),this._fov!==u&&(this._unmodified=!1,this._fov=g.degToRad(u),this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(u){this._averageElevation=u,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(u){const p=Math.min(Math.max(u,this.minZoom),this.maxZoom);this._zoom!==p&&(this._unmodified=!1,this._setZoom(p),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(u){this._zoom=u,this.scale=this.zoomScale(u),this.tileZoom=Math.floor(u),this.zoomFraction=u-this.tileZoom}_updateCameraOnTerrain(){if(!this._elevation||!this._elevation.isDataAvailableAtPoint(this.locationCoordinate(this.center)))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const u=this._elevation;this._centerAltitude=u.getAtPointOrZero(this.locationCoordinate(this.center)),this._centerAltitudeValidForExaggeration=u.exaggeration(),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){void 0!==this._centerAltitudeValidForExaggeration&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;const u=this._elevation,p=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],x=this.horizonLineFromTop();let M=0,E=0;for(let P=0;P<p.length;P++){const O=new g.pointGeometry(p[P][0]*this.width,x+p[P][1]*(this.height-x)),N=u.pointCoordinate(O);if(!N)continue;const U=1/Math.hypot(N[0]-this._camera.position[0],N[1]-this._camera.position[1]);M+=N[3]*U,E+=U}return 0===E?NaN:M/E}get center(){return this._center}set center(u){u.lat===this._center.lat&&u.lng===this._center.lng||(this._unmodified=!1,this._center=u,this._terrainEnabled()&&("ground"===this.cameraElevationReference?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(null==this._seaLevelZoom||!this._elevation)return;const u=this._seaLevelZoom,p=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),x=this.pixelsPerMeter/this.worldSize*p,M=this._mercatorZfromZoom(u),E=this._mercatorZfromZoom(this._maxZoom),P=Math.max(M-x,E);this._setZoom(this._zoomFromMercatorZ(P))}get padding(){return this._edgeInsets.toJSON()}set padding(u){this._edgeInsets.equals(u)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,u,1),this._calcMatrices())}computeZoomRelativeTo(u){const p=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,u.toAltitude()));let x;x=u.z<this._camera.position[2]?[p.x,p.y,p.z]:[u.x,u.y,u.z];const M=g.length(g.sub([],this._camera.position,x));return g.clamp(this._zoomFromMercatorZ(M),this._minZoom,this._maxZoom)}setFreeCameraOptions(u){if(!this.height||!u.position&&!u.orientation)return;this._updateCameraState();let p=!1;if(u.orientation&&!g.exactEquals(u.orientation,this._camera.orientation)&&(p=this._setCameraOrientation(u.orientation)),u.position){const x=[u.position.x,u.position.y,u.position.z];g.exactEquals$1(x,this._camera.position)||(this._setCameraPosition(x),p=!0)}p&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const u=this._camera.position,p=new Nh;return p.position=new g.MercatorCoordinate(u[0],u[1],u[2]),p.orientation=this._camera.orientation,p._elevation=this.elevation,p._renderWorldCopies=this.renderWorldCopies,p}_setCameraOrientation(u){if(!g.length$1(u))return!1;g.normalize$1(u,u);const p=g.transformQuat([],[0,0,-1],u),x=g.transformQuat([],[0,-1,0],u);if(x[2]<0)return!1;const M=rl(p,x);return!!M&&(this._camera.orientation=M,!0)}_setCameraPosition(u){const p=this.zoomScale(this.minZoom)*this.tileSize,x=this.zoomScale(this.maxZoom)*this.tileSize,M=this.cameraToCenterDistance;u[2]=g.clamp(u[2],M/x,M/p),this._camera.position=u}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(u){return this._edgeInsets.equals(u)}interpolatePadding(u,p,x){this._unmodified=!1,this._edgeInsets.interpolate(u,p,x),this._constrain(),this._calcMatrices()}coveringZoomLevel(u){const p=(u.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/u.tileSize));return Math.max(0,p)}getVisibleUnwrappedCoordinates(u){const p=[new g.UnwrappedTileID(0,u)];if(this.renderWorldCopies){const x=this.pointCoordinate(new g.pointGeometry(0,0)),M=this.pointCoordinate(new g.pointGeometry(this.width,0)),E=this.pointCoordinate(new g.pointGeometry(this.width,this.height)),P=this.pointCoordinate(new g.pointGeometry(0,this.height)),O=Math.floor(Math.min(x.x,M.x,E.x,P.x)),N=Math.floor(Math.max(x.x,M.x,E.x,P.x)),U=1;for(let H=O-U;H<=N+U;H++)0!==H&&p.push(new g.UnwrappedTileID(H,u))}return p}coveringTiles(u){let p=this.coveringZoomLevel(u);const x=p,M=this.elevation&&!u.isTerrainDEM,E="mercator"===this.projection.name;if(void 0!==u.minzoom&&p<u.minzoom)return[];void 0!==u.maxzoom&&p>u.maxzoom&&(p=u.maxzoom);const P=this.locationCoordinate(this.center),O=this.center.lat,N=1<<p,U=[N*P.x,N*P.y,0],H="globe"===this.projection.name,Z=!H,Q=g.Frustum.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,p,Z),oe=H?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),ie=N*g.mercatorZfromAltitude(1,this.center.lat),le=this._camera.position[2]/g.mercatorZfromAltitude(1,this.center.lat),re=[N*oe.x,N*oe.y,le*(Z?1:ie)],ne=this.cameraToCenterDistance/u.tileSize*(u.roundZoom?1:.502),ue=this.pitch<=60&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace?p:0,se=u.isTerrainDEM&&this._elevation?1e4*this._elevation.exaggeration():this._centerAltitude,Me=u.isTerrainDEM?-se:this._elevation?this._elevation.getMinElevationBelowMSL():0,Se=this.projection.isReprojectedInTileSpace?Zp(this):1,ge=Fe=>{const Ft=new g.MercatorCoordinate(Fe.x+25e-6,Fe.y,Fe.z),kt=new g.MercatorCoordinate(Fe.x,Fe.y+25e-6,Fe.z),Bt=Fe.toLngLat(),un=Ft.toLngLat(),Nn=kt.toLngLat(),Tn=this.locationCoordinate(Bt),mn=this.locationCoordinate(un),Lt=this.locationCoordinate(Nn),qn=Math.hypot(mn.x-Tn.x,mn.y-Tn.y),di=Math.hypot(Lt.x-Tn.x,Lt.y-Tn.y);return Math.sqrt(qn*di)*Se/25e-6},De=Fe=>{const $t=se,Ft=Me;return{aabb:g.tileAABB(this,N,0,0,0,Fe,Ft,$t,this.projection),zoom:0,x:0,y:0,minZ:Ft,maxZ:$t,wrap:Fe,fullyVisible:!1}},Ue=[];let Ke=[];const je=p,St=u.reparseOverscaled?x:p,Ne=Fe=>Fe*Fe,pt=Ne((le-this._centerAltitude)*ie),ht=Fe=>{if(!this._elevation||!Fe.tileID||!E)return;const $t=this._elevation.getMinMaxForTile(Fe.tileID),Ft=Fe.aabb;$t?(Ft.min[2]=$t.min,Ft.max[2]=$t.max,Ft.center[2]=(Ft.min[2]+Ft.max[2])/2):(Fe.shouldSplit=We(Fe),Fe.shouldSplit||(Ft.min[2]=Ft.max[2]=Ft.center[2]=this._centerAltitude))},We=Fe=>{if(Fe.zoom<ue)return!0;if(Fe.zoom===je)return!1;if(null!=Fe.shouldSplit)return Fe.shouldSplit;const $t=Fe.aabb.distanceX(re),Ft=Fe.aabb.distanceY(re);let kt=pt,Bt=1;if(H){kt=Ne(Fe.aabb.distanceZ(re));const Tn=Math.pow(2,Fe.zoom),mn=g.latFromMercatorY((Fe.y+1)/Tn),Lt=g.latFromMercatorY(Fe.y/Tn),qn=Math.min(Math.max(O,mn),Lt),di=g.circumferenceAtLatitude(qn)/g.circumferenceAtLatitude(O);if(Bt=qn===O?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,di/this._mercatorScaleRatio),this.zoom<=g.GLOBE_ZOOM_THRESHOLD_MIN&&Fe.zoom===je-1&&di>=.9)return!0}else if(M&&(kt=Ne(Fe.aabb.distanceZ(re)*ie)),this.projection.isReprojectedInTileSpace&&x<=5){const Tn=Math.pow(2,Fe.zoom),mn=ge(new g.MercatorCoordinate((Fe.x+.5)/Tn,(Fe.y+.5)/Tn));Bt=mn>.85?1:mn}const un=$t*$t+Ft*Ft+kt;return un<Ne((1<<je-Fe.zoom)*ne*Bt*((Tn,mn)=>{if(mn*Ne(.707)<Tn)return 1;const Lt=Math.sqrt(mn/Tn);return Lt/(1.4144271570014144+(Math.pow(1.1,Lt-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max(kt,pt),un))};if(this.renderWorldCopies)for(let Fe=1;Fe<=3;Fe++)Ue.push(De(-Fe)),Ue.push(De(Fe));for(Ue.push(De(0));Ue.length>0;){const Fe=Ue.pop(),$t=Fe.x,Ft=Fe.y;let kt=Fe.fullyVisible;if(!kt){const Bt=Fe.aabb.intersects(Q);if(0===Bt)continue;kt=2===Bt}if(Fe.zoom!==je&&We(Fe))for(let Bt=0;Bt<4;Bt++){const un=($t<<1)+Bt%2,Nn=(Ft<<1)+(Bt>>1),Tn={aabb:E?Fe.aabb.quadrant(Bt):g.tileAABB(this,N,Fe.zoom+1,un,Nn,Fe.wrap,Fe.minZ,Fe.maxZ,this.projection),zoom:Fe.zoom+1,x:un,y:Nn,wrap:Fe.wrap,fullyVisible:kt,tileID:void 0,shouldSplit:void 0,minZ:Fe.minZ,maxZ:Fe.maxZ};M&&!H&&(Tn.tileID=new g.OverscaledTileID(Fe.zoom+1===je?St:Fe.zoom+1,Fe.wrap,Fe.zoom+1,un,Nn),ht(Tn)),Ue.push(Tn)}else{const Bt=Fe.zoom===je?St:Fe.zoom;if(u.minzoom&&u.minzoom>Bt)continue;const un=U[0]-(.5+$t+(Fe.wrap<<Fe.zoom))*(1<<p-Fe.zoom),Nn=U[1]-.5-Ft,Tn=Fe.tileID?Fe.tileID:new g.OverscaledTileID(Bt,Fe.wrap,Fe.zoom,$t,Ft);Ke.push({tileID:Tn,distanceSq:un*un+Nn*Nn})}}if(this.fogCullDistSq){const Fe=this.fogCullDistSq,$t=this.horizonLineFromTop();Ke=Ke.filter(Ft=>{const kt=[0,0,0,1],Bt=[g.EXTENT,g.EXTENT,0,1],un=this.calculateFogTileMatrix(Ft.tileID.toUnwrapped());g.transformMat4$1(kt,kt,un),g.transformMat4$1(Bt,Bt,un);const Nn=g.getAABBPointSquareDist(kt,Bt);if(0===Nn)return!0;let Tn=!1;const mn=this._elevation;if(mn&&Nn>Fe&&0!==$t){const Lt=this.calculateProjMatrix(Ft.tileID.toUnwrapped());let qn;u.isTerrainDEM||(qn=mn.getMinMaxForTile(Ft.tileID)),qn||(qn={min:Me,max:se});const di=g.furthestTileCorner(this.rotation),ur=[di[0]*g.EXTENT,di[1]*g.EXTENT,qn.max];g.transformMat4(ur,ur,Lt),Tn=(1-ur[1])*this.height*.5<$t}return Nn<Fe||Tn})}return Ke.sort((Fe,$t)=>Fe.distanceSq-$t.distanceSq).map(Fe=>Fe.tileID)}resize(u,p){this.width=u,this.height=p,this.pixelsToGLUnits=[2/u,-2/p],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(u){return Math.pow(2,u)}scaleZoom(u){return Math.log(u)/Math.LN2}project(u){const p=g.clamp(u.lat,-g.MAX_MERCATOR_LATITUDE,g.MAX_MERCATOR_LATITUDE),x=this.projection.project(u.lng,p);return new g.pointGeometry(x.x*this.worldSize,x.y*this.worldSize)}unproject(u){return this.projection.unproject(u.x/this.worldSize,u.y/this.worldSize)}get point(){return this.project(this.center)}setLocationAtPoint(u,p){let x,M;const E=this.centerPoint;if("globe"===this.projection.name){const O=this.worldSize;x=(p.x-E.x)/O,M=(p.y-E.y)/O}else{const O=this.pointCoordinate(p),N=this.pointCoordinate(E);x=O.x-N.x,M=O.y-N.y}const P=this.locationCoordinate(u);this.setLocation(new g.MercatorCoordinate(P.x-x,P.y-M))}setLocation(u){this.center=this.coordinateLocation(u),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(u){return this.projection.locationPoint(this,u)}locationPoint3D(u){return this.projection.locationPoint(this,u,!0)}pointLocation(u){return this.coordinateLocation(this.pointCoordinate(u))}pointLocation3D(u){return this.coordinateLocation(this.pointCoordinate3D(u))}locationCoordinate(u,p){const x=p?g.mercatorZfromAltitude(p,u.lat):void 0,M=this.projection.project(u.lng,u.lat);return new g.MercatorCoordinate(M.x,M.y,x)}coordinateLocation(u){return this.projection.unproject(u.x,u.y)}pointRayIntersection(u,p){const x=p??this._centerAltitude,M=[u.x,u.y,0,1],E=[u.x,u.y,1,1];g.transformMat4$1(M,M,this.pixelMatrixInverse),g.transformMat4$1(E,E,this.pixelMatrixInverse);const P=E[3];g.scale$1(M,M,1/M[3]),g.scale$1(E,E,1/P);const O=M[2],N=E[2];return{p0:M,p1:E,t:O===N?0:(x-O)/(N-O)}}screenPointToMercatorRay(u){const p=[u.x,u.y,0,1],x=[u.x,u.y,1,1];return g.transformMat4$1(p,p,this.pixelMatrixInverse),g.transformMat4$1(x,x,this.pixelMatrixInverse),g.scale$1(p,p,1/p[3]),g.scale$1(x,x,1/x[3]),p[2]=g.mercatorZfromAltitude(p[2],this._center.lat)*this.worldSize,x[2]=g.mercatorZfromAltitude(x[2],this._center.lat)*this.worldSize,g.scale$1(p,p,1/this.worldSize),g.scale$1(x,x,1/this.worldSize),new g.Ray([p[0],p[1],p[2]],g.normalize([],g.sub([],x,p)))}rayIntersectionCoordinate(u){const{p0:p,p1:x,t:M}=u,E=g.mercatorZfromAltitude(p[2],this._center.lat),P=g.mercatorZfromAltitude(x[2],this._center.lat);return new g.MercatorCoordinate(g.number(p[0],x[0],M)/this.worldSize,g.number(p[1],x[1],M)/this.worldSize,g.number(E,P,M))}pointCoordinate(u,p=this._centerAltitude){return this.projection.pointCoordinate(this,u.x,u.y,p)}pointCoordinate3D(u){if(!this.elevation)return this.pointCoordinate(u);let p=this.projection.pointCoordinate3D(this,u.x,u.y);if(p)return new g.MercatorCoordinate(p[0],p[1],p[2]);let x=0,M=this.horizonLineFromTop();if(u.y>M)return this.pointCoordinate(u);const E=.02*M,P=u.clone();for(let O=0;O<10&&M-x>E;O++){P.y=g.number(x,M,.66);const N=this.projection.pointCoordinate3D(this,P.x,P.y);N?(M=P.y,p=N):x=P.y}return p?new g.MercatorCoordinate(p[0],p[1],p[2]):this.pointCoordinate(u)}isPointAboveHorizon(u){return this.projection.isPointAboveHorizon(this,u)}_coordinatePoint(u,p){const x=p&&this.elevation?this.elevation.getAtPointOrZero(u,this._centerAltitude):this._centerAltitude,M=[u.x*this.worldSize,u.y*this.worldSize,x+u.toAltitude(),1];return g.transformMat4$1(M,M,this.pixelMatrix),M[3]>0?new g.pointGeometry(M[0]/M[3],M[1]/M[3]):new g.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE)}_getGlobeBounds(){const{top:u,left:p}=this._edgeInsets,x=this.height-this._edgeInsets.bottom,M=this.width-this._edgeInsets.right,E=this.pointCoordinate3D(new g.pointGeometry(p,u)),P=this.pointCoordinate3D(new g.pointGeometry(M,u)),O=this.pointCoordinate3D(new g.pointGeometry(M,x)),N=this.pointCoordinate3D(new g.pointGeometry(p,x));let U=Math.min(E.x,N.x),H=Math.max(P.x,O.x),Z=Math.min(E.y,P.y),Q=Math.max(N.y,O.y);const oe=Math.pow(2,-this.zoom)/16,ie=(ne,ue,se,Me)=>{const Se=(ne+se)/2,ge=(ue+Me)/2,De=new g.pointGeometry(Se,ge),Ue=this.pointCoordinate3D(De),Ke=Math.max(0,U-Ue.x,Z-Ue.y,Ue.x-H,Ue.y-Q);U=Math.min(U,Ue.x),H=Math.max(H,Ue.x),Z=Math.min(Z,Ue.y),Q=Math.max(Q,Ue.y),Ke>oe&&(ie(ne,ue,Se,ge),ie(Se,ge,se,Me))};ie(p,u,M,u),ie(M,u,M,x),ie(M,x,p,x),ie(p,x,p,u);const le=new g.LngLat(g.lngFromMercatorX(H),g.latFromMercatorY(Z)),re=new g.LngLat(g.lngFromMercatorX(U),g.latFromMercatorY(Q));return new g.LngLatBounds(re,le)}_getBounds(u,p){if("globe"===this.projection.name)return this._getGlobeBounds();const x=new g.pointGeometry(this._edgeInsets.left,this._edgeInsets.top),M=new g.pointGeometry(this.width-this._edgeInsets.right,this._edgeInsets.top),E=new g.pointGeometry(this.width-this._edgeInsets.right,this.height-this._edgeInsets.bottom),P=new g.pointGeometry(this._edgeInsets.left,this.height-this._edgeInsets.bottom);let O=this.pointCoordinate(x,u),N=this.pointCoordinate(M,u);const U=this.pointCoordinate(E,p),H=this.pointCoordinate(P,p),Z=(Q,oe)=>(oe.y-Q.y)/(oe.x-Q.x);return O.y>1&&N.y>=0?O=new g.MercatorCoordinate((1-H.y)/Z(H,O)+H.x,1):O.y<0&&N.y<=1&&(O=new g.MercatorCoordinate(-H.y/Z(H,O)+H.x,0)),N.y>1&&O.y>=0?N=new g.MercatorCoordinate((1-U.y)/Z(U,N)+U.x,1):N.y<0&&O.y<=1&&(N=new g.MercatorCoordinate(-U.y/Z(U,N)+U.x,0)),(new g.LngLatBounds).extend(this.coordinateLocation(O)).extend(this.coordinateLocation(N)).extend(this.coordinateLocation(H)).extend(this.coordinateLocation(U))}_getBounds3D(){const u=this.elevation;if(!u.visibleDemTiles.length||u.isUsingMockSource())return this._getBounds(0,0);const p=u.visibleDemTiles.reduce((x,M)=>{if(M.dem){const E=M.dem.tree;x.min=Math.min(x.min,E.minimums[0]),x.max=Math.max(x.max,E.maximums[0])}return x},{min:Number.MAX_VALUE,max:0});return this._getBounds(p.min*u.exaggeration(),p.max*u.exaggeration())}getBounds(){return this._terrainEnabled()?this._getBounds3D():this._getBounds(0,0)}horizonLineFromTop(u=!0){const p=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))+this.centerOffset.y,x=this.height/2-p*(1-this._horizonShift);return u?Math.max(0,x):x}getMaxBounds(){return this.maxBounds}setMaxBounds(u){this.maxBounds=u,this.minLat=-g.MAX_MERCATOR_LATITUDE,this.maxLat=g.MAX_MERCATOR_LATITUDE,this.minLng=-180,this.maxLng=180,u&&(this.minLat=u.getSouth(),this.maxLat=u.getNorth(),this.minLng=u.getWest(),this.maxLng=u.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=g.mercatorXfromLng(this.minLng)*this.tileSize,this.worldMaxX=g.mercatorXfromLng(this.maxLng)*this.tileSize,this.worldMinY=g.mercatorYfromLat(this.maxLat)*this.tileSize,this.worldMaxY=g.mercatorYfromLat(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(u,p){return this.projection.createTileMatrix(this,p,u)}calculateDistanceTileData(u){const p=u.key,x=this._distanceTileDataCache;if(x[p])return x[p];const M=u.canonical,E=1/this.height,P=this.cameraWorldSize/this.zoomScale(M.z),O=(M.x+Math.pow(2,M.z)*u.wrap)*P,N=M.y*P,U=this.point,H=this.angle,Z=Math.sin(-H),Q=-Math.cos(-H);return x[p]={bearing:[Z,Q],center:[(U.x-O)*E,(U.y-N)*E],scale:P/g.EXTENT*E},x[p]}calculateFogTileMatrix(u){const p=u.key,x=this._fogTileMatrixCache;if(x[p])return x[p];const M=this.projection.createTileMatrix(this,this.cameraWorldSize,u);return g.multiply(M,this.worldToFogMatrix,M),x[p]=new Float32Array(M),x[p]}calculateProjMatrix(u,p=!1){const x=u.key,M=p?this._alignedProjMatrixCache:this._projMatrixCache;if(M[x])return M[x];const E=this.calculatePosMatrix(u,this.worldSize);return g.multiply(E,this.projection.isReprojectedInTileSpace?this.mercatorMatrix:p?this.alignedProjMatrix:this.projMatrix,E),M[x]=new Float32Array(E),M[x]}calculatePixelsToTileUnitsMatrix(u){const p=u.tileID.key,x=this._pixelsToTileUnitsCache;if(x[p])return x[p];const M=function(E,P){const{scale:O}=E.tileTransform,N=O*g.EXTENT/(E.tileSize*Math.pow(2,P.zoom-E.tileID.overscaledZ+E.tileID.canonical.z));return U=new Float32Array(4),Q=(H=P.inverseAdjustmentMatrix)[1],oe=H[2],ie=H[3],re=(Z=[N,N])[1],U[0]=H[0]*(le=Z[0]),U[1]=Q*le,U[2]=oe*re,U[3]=ie*re,U;var U,H,Z,Q,oe,ie,le,re}(u,this);return x[p]=M,x[p]}customLayerMatrix(){return this.mercatorMatrix.slice()}recenterOnTerrain(){if(!this._elevation||"globe"===this.projection.name)return;const u=this._elevation;this._updateCameraState();const p=g.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,x=this._computeCameraPosition(p),M=this._camera.forward(),E=g.mercatorZfromAltitude(1,this._center.lat);x[2]/=E,M[2]/=E,g.normalize(M,M);const P=u.raycast(x,M,u.exaggeration());if(P){const O=g.scaleAndAdd([],x,M,P),N=new g.MercatorCoordinate(O[0],O[1],g.mercatorZfromAltitude(O[2],g.latFromMercatorY(O[1]))),U=(N.z+g.length([N.x-x[0],N.y-x[1],N.z-x[2]*E]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(U),this._centerAltitude=N.toAltitude(),this._center=this.coordinateLocation(N),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCameraAltitude(){if(!this._elevation)return;const u=this._elevation;this._updateCameraState();const p=g.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,x=this._computeCameraPosition(p),M=u.getAtPointOrZero(new g.MercatorCoordinate(...x)),E=this._minimumHeightOverTerrain()*Math.cos(g.degToRad(this._maxPitch)),P=this._camera.position[2]-this.pixelsPerMeter/this.worldSize*M;if(P<E){const O=this.locationCoordinate(this._center,this._centerAltitude),N=[O.x-x[0],O.y-x[1],O.z-x[2]],U=g.length(N);N[2]-=(E-P)/this._pixelsPerMercatorPixel;const H=g.length(N);if(0===H)return;g.scale$2(N,N,U/H*this._pixelsPerMercatorPixel),this._camera.position=[O.x-N[0],O.y-N[1],O.z*this._pixelsPerMercatorPixel-N[2]],this._camera.orientation=rl(N,this._camera.up()),this._updateStateFromCamera()}}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const u="globe"===this.projection.name||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||u){const Q=this.center;return Q.lat=g.clamp(Q.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!u)&&(Q.lng=g.clamp(Q.lng,this.minLng,this.maxLng)),this.center=Q,void(this._constraining=!1)}const p=this._unmodified,{x,y:M}=this.point;let E=0,P=x,O=M;const N=this.width/2,U=this.height/2,H=this.worldMinY*this.scale,Z=this.worldMaxY*this.scale;if(M-U<H&&(O=H+U),M+U>Z&&(O=Z-U),Z-H<this.height&&(E=Math.max(E,this.height/(Z-H)),O=(Z+H)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const Q=this.worldMinX*this.scale,oe=this.worldMaxX*this.scale,ie=this.worldSize/2-(Q+oe)/2;P=(x+ie+this.worldSize)%this.worldSize-ie,P-N<Q&&(P=Q+N),P+N>oe&&(P=oe-N),oe-Q<this.width&&(E=Math.max(E,this.width/(oe-Q)),P=(oe+Q)/2)}P===x&&O===M||(this.center=this.unproject(new g.pointGeometry(P,O))),E&&(this.zoom+=this.scaleZoom(E)),this._constrainCameraAltitude(),this._unmodified=p,this._constraining=!1}_minZoomForBounds(){let u=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(u=Math.max(u,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),u}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const u=this.centerOffset,p=this.pixelsPerMeter;"globe"===this.projection.name&&(this._mercatorScaleRatio=g.mercatorZfromAltitude(1,this.center.lat)/g.mercatorZfromAltitude(1,g.GLOBE_SCALE_MATCH_LATITUDE));const x=zh(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,x),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const M=this._camera.getWorldToCamera(this.worldSize,"meters"===this.projection.zAxisUnit?p:1),E=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);E[8]=2*-u.x/this.width,E[9]=2*u.y/this.height;let P=g.mul([],E,M);if(this.projection.isReprojectedInTileSpace){const Se=this.locationCoordinate(this.center),ge=g.identity([]);g.translate(ge,ge,[Se.x*this.worldSize,Se.y*this.worldSize,0]),g.multiply(ge,ge,Bh(this)),g.translate(ge,ge,[-Se.x*this.worldSize,-Se.y*this.worldSize,0]),g.multiply(P,P,ge),this.inverseAdjustmentMatrix=function(De){const Ue=Bh(De,!0);return Si([],[Ue[0],Ue[1],Ue[4],Ue[5]])}(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];this.mercatorMatrix=g.scale([],P,[this.worldSize,this.worldSize,this.worldSize/p,1]),this.projMatrix=P,this.invProjMatrix=g.invert(new Float64Array(16),this.projMatrix);const O=g.invert([],E);this.frustumCorners=g.FrustumCorners.fromInvProjectionMatrix(O,this.horizonLineFromTop(),this.height);const N=new Float32Array(16);g.identity(N),g.scale(N,N,[1,-1,1]),g.rotateX(N,N,this._pitch),g.rotateZ(N,N,this.angle);const U=g.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ),H=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;U[8]=2*-u.x/this.width,U[9]=2*(u.y+H)/this.height,this.skyboxMatrix=g.multiply(N,U,N);const Z=this.point,Q=Z.x,oe=Z.y,ie=this.width%2/2,le=this.height%2/2,re=Math.cos(this.angle),ne=Math.sin(this.angle),ue=Q-Math.round(Q)+re*ie+ne*le,se=oe-Math.round(oe)+re*le+ne*ie,Me=new Float64Array(P);if(g.translate(Me,Me,[ue>.5?ue-1:ue,se>.5?se-1:se,0]),this.alignedProjMatrix=Me,P=g.create(),g.scale(P,P,[this.width/2,-this.height/2,1]),g.translate(P,P,[1,-1,0]),this.labelPlaneMatrix=P,P=g.create(),g.scale(P,P,[1,-1,1]),g.translate(P,P,[-1,-1,0]),g.scale(P,P,[2/this.width,2/this.height,1]),this.glCoordMatrix=P,this.pixelMatrix=g.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),this._calcFogMatrices(),this._distanceTileDataCache={},P=g.invert(new Float64Array(16),this.pixelMatrix),!P)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=P,"globe"===this.projection.name||this.mercatorFromTransition){this.globeMatrix=g.calculateGlobeMatrix(this);const Se=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=g.transformMat4(Se,Se,M),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=P;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const u=this.cameraWorldSize,p=this.cameraPixelsPerMeter,x=this._camera.position,M=1/this.height/this._pixelsPerMercatorPixel,E=[u,u,p];g.scale$2(E,E,M),g.scale$2(x,x,-1),g.multiply$2(x,x,E);const P=g.create();g.translate(P,P,x),g.scale(P,P,E),this.mercatorFogMatrix=P,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(u,p,M)}_computeCameraPosition(u){const p=(u=u||this.pixelsPerMeter)/this.pixelsPerMeter,x=this._camera.forward(),M=this.point,E=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*p-u/this.worldSize*this._centerAltitude;return[M.x/this.worldSize-x[0]*E,M.y/this.worldSize-x[1]*E,u/this.worldSize*this._centerAltitude-x[2]*E]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(u){const p=this._maxCameraBoundsDistance()*Math.cos(this._pitch),x=this._camera.position[2],M=u[2];let E=1;this.projection.wrap&&(this.center=this.center.wrap()),M>0&&(E=Math.min((p-x)/M,1)),this._camera.position=g.scaleAndAdd([],this._camera.position,u,E),this._updateStateFromCamera()}_updateStateFromCamera(){const u=this._camera.position,p=this._camera.forward(),{pitch:x,bearing:M}=this._camera.getPitchBearing(),E=g.mercatorZfromAltitude(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,P=this._mercatorZfromZoom(this._maxZoom)*Math.cos(g.degToRad(this._maxPitch)),O=Math.max((u[2]-E)/Math.cos(x),P),N=this._zoomFromMercatorZ(O);g.scaleAndAdd(u,u,p,O),this._pitch=g.clamp(x,g.degToRad(this.minPitch),g.degToRad(this.maxPitch)),this.angle=g.wrap(M,-Math.PI,Math.PI),this._setZoom(g.clamp(N,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new g.MercatorCoordinate(u[0],u[1],u[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(u){return Math.pow(2,u)*this.tileSize}_mercatorZfromZoom(u){return this.cameraToCenterDistance/this._worldSizeFromZoom(u)}_minimumHeightOverTerrain(){const u=Math.min((null!=this._seaLevelZoom?this._seaLevelZoom:this._zoom)+2,this._maxZoom);return this._mercatorZfromZoom(u)}_zoomFromMercatorZ(u){return this.scaleZoom(this.cameraToCenterDistance/(u*this.tileSize))}zoomFromMercatorZAdjusted(u){const p=P=>{const O=this.getCameraToCenterDistance(this.projection,P);return this.scaleZoom(O/(u*this.tileSize))};let x,M=p(this.zoom),E=Math.abs(M-p(M));for(;x!==E;)M=p(M),x=E,E=Math.abs(M-p(M));return M}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(g.warnOnce("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(u,p){const x=Math.min(u.x,p.x),M=Math.max(u.x,p.x),E=Math.min(u.y,p.y),P=Math.max(u.y,p.y);if(E<this.horizonLineFromTop(!1))return!0;if("mercator"!==this.projection.name)return!1;const O=[new g.pointGeometry(x,E),new g.pointGeometry(M,P),new g.pointGeometry(x,P),new g.pointGeometry(M,E)],N=this.renderWorldCopies?-3:0,U=this.renderWorldCopies?4:1;for(const H of O){const Z=this.pointRayIntersection(H);if(Z.t<0)return!0;const Q=this.rayIntersectionCoordinate(Z);if(Q.x<N||Q.y<0||Q.x>U||Q.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+g.radToDeg(this.fovAboveCenter)>88||this.anyCornerOffEdge(new g.pointGeometry(0,0),new g.pointGeometry(this.width,this.height))}zoomDeltaToMovement(u,p){const x=g.length(g.sub([],this._camera.position,u)),M=this._zoomFromMercatorZ(x)+p;return x-this._mercatorZfromZoom(M)}getCameraPoint(){if("globe"===this.projection.name){const u=function(p,x){const M=[p[0],p[1],p[2],1];g.transformMat4$1(M,M,x);const E=Math.max(M[3],1e-6);return[M[0]/E,M[1]/E,M[2]/E,E]}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new g.pointGeometry(u[0],u[1])}{const u=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new g.pointGeometry(0,u))}}getCameraToCenterDistance(u,p=this.zoom){const x=zh(u,p,this.width,this.height,1024),M=u.pixelSpaceConversion(this.center.lat,this.worldSize,x);return.5/Math.tan(.5*this._fov)*this.height*M}getWorldToCameraMatrix(){const u=this._camera.getWorldToCamera(this.worldSize,"meters"===this.projection.zAxisUnit?this.pixelsPerMeter:1);return"globe"===this.projection.name&&g.multiply(u,u,this.globeMatrix),u}}function Om(_,u){let p=!1,x=null;const M=()=>{x=null,p&&(_(),x=setTimeout(M,u),p=!1)};return()=>(p=!0,x||M(),x)}class ga{constructor(u){this._hashName=u&&encodeURIComponent(u),g.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=Om(this._updateHashUnthrottled.bind(this),300)}addTo(u){return this._map=u,g.window.addEventListener("hashchange",this._onHashChange,!1),u.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),g.window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const u=this._map;if(!u)return"";const p=Vh(u);if(this._hashName){const x=this._hashName;let M=!1;const E=g.window.location.hash.slice(1).split("&").map(P=>{const O=P.split("=")[0];return O===x?(M=!0,`${O}=${p}`):P}).filter(P=>P);return M||E.push(`${x}=${p}`),`#${E.join("&")}`}return`#${p}`}_getCurrentHash(){const u=g.window.location.hash.replace("#","");if(this._hashName){let p;return u.split("&").map(x=>x.split("=")).forEach(x=>{x[0]===this._hashName&&(p=x)}),(p&&p[1]||"").split("/")}return u.split("/")}_onHashChange(){const u=this._map;if(!u)return!1;const p=this._getCurrentHash();if(p.length>=3&&!p.some(x=>isNaN(x))){const x=u.dragRotate.isEnabled()&&u.touchZoomRotate.isEnabled()?+(p[3]||0):u.getBearing();return u.jumpTo({center:[+p[2],+p[1]],zoom:+p[0],bearing:x,pitch:+(p[4]||0)}),!0}return!1}_updateHashUnthrottled(){const u=g.window.location.href.replace(/(#.+)?$/,this.getHashString());g.window.history.replaceState(g.window.history.state,null,u)}}function Vh(_,u){const p=_.getCenter(),x=Math.round(100*_.getZoom())/100,M=Math.ceil((x*Math.LN2+Math.log(512/360/.5))/Math.LN10),E=Math.pow(10,M),P=Math.round(p.lng*E)/E,O=Math.round(p.lat*E)/E,N=_.getBearing(),U=_.getPitch();let H=u?`/${P}/${O}/${x}`:`${x}/${O}/${P}`;return(N||U)&&(H+="/"+Math.round(10*N)/10),U&&(H+=`/${Math.round(U)}`),H}const lc={linearity:.3,easing:g.bezier(0,0,.3,1)},Xp=g.extend({deceleration:2500,maxSpeed:1400},lc),Yp=g.extend({deceleration:20,maxSpeed:1400},lc),U_=g.extend({deceleration:1e3,maxSpeed:360},lc),es=g.extend({deceleration:1e3,maxSpeed:90},lc);class H_{constructor(u){this._map=u,this.clear()}clear(){this._inertiaBuffer=[]}record(u){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:g.exported.now(),settings:u})}_drainInertiaBuffer(){const u=this._inertiaBuffer,p=g.exported.now();for(;u.length>0&&p-u[0].time>160;)u.shift()}_onMoveEnd(u){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const p={zoom:0,bearing:0,pitch:0,pan:new g.pointGeometry(0,0),pinchAround:void 0,around:void 0};for(const{settings:E}of this._inertiaBuffer)p.zoom+=E.zoomDelta||0,p.bearing+=E.bearingDelta||0,p.pitch+=E.pitchDelta||0,E.panDelta&&p.pan._add(E.panDelta),E.around&&(p.around=E.around),E.pinchAround&&(p.pinchAround=E.pinchAround);const x=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,M={};if(p.pan.mag()){const E=Ba(p.pan.mag(),x,g.extend({},Xp,u||{}));M.offset=p.pan.mult(E.amount/p.pan.mag()),M.center=this._map.transform.center,Kp(M,E)}if(p.zoom){const E=Ba(p.zoom,x,Yp);M.zoom=this._map.transform.zoom+E.amount,Kp(M,E)}if(p.bearing){const E=Ba(p.bearing,x,U_);M.bearing=this._map.transform.bearing+g.clamp(E.amount,-179,179),Kp(M,E)}if(p.pitch){const E=Ba(p.pitch,x,es);M.pitch=this._map.transform.pitch+E.amount,Kp(M,E)}if(M.zoom||M.bearing){const E=void 0===p.pinchAround?p.around:p.pinchAround;M.around=E?this._map.unproject(E):this._map.getCenter()}return this.clear(),M.noMoveStart=!0,M}}function Kp(_,u){(!_.duration||_.duration<u.duration)&&(_.duration=u.duration,_.easing=u.easing)}function Ba(_,u,p){const{maxSpeed:x,linearity:M,deceleration:E}=p,P=g.clamp(_*M/(u/1e3),-x,x),O=Math.abs(P)/(E*M);return{easing:p.easing,duration:1e3*O,amount:P*(O/2)}}class Zr extends g.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(u,p,x,M={}){const E=Ht(p.getCanvasContainer(),x),P=p.unproject(E);super(u,g.extend({point:E,lngLat:P,originalEvent:x},M)),this._defaultPrevented=!1,this.target=p}}class Qp extends g.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(u,p,x){const M="touchend"===u?x.changedTouches:x.touches,E=Pa(p.getCanvasContainer(),M),P=E.map(N=>p.unproject(N)),O=E.reduce((N,U,H,Z)=>N.add(U.div(Z.length)),new g.pointGeometry(0,0));super(u,{points:E,point:O,lngLats:P,lngLat:p.unproject(O),originalEvent:x}),this._defaultPrevented=!1}}class Jp extends g.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(u,p,x){super(u,{originalEvent:x}),this._defaultPrevented=!1}}class cc{constructor(u,p){this._map=u,this._clickTolerance=p.clickTolerance}reset(){this._mousedownPos=void 0}wheel(u){return this._firePreventable(new Jp(u.type,this._map,u))}mousedown(u,p){return this._mousedownPos=p,this._firePreventable(new Zr(u.type,this._map,u))}mouseup(u){this._map.fire(new Zr(u.type,this._map,u))}preclick(u){const p=g.extend({},u);p.type="preclick",this._map.fire(new Zr(p.type,this._map,p))}click(u,p){this._mousedownPos&&this._mousedownPos.dist(p)>=this._clickTolerance||(this.preclick(u),this._map.fire(new Zr(u.type,this._map,u)))}dblclick(u){return this._firePreventable(new Zr(u.type,this._map,u))}mouseover(u){this._map.fire(new Zr(u.type,this._map,u))}mouseout(u){this._map.fire(new Zr(u.type,this._map,u))}touchstart(u){return this._firePreventable(new Qp(u.type,this._map,u))}touchmove(u){this._map.fire(new Qp(u.type,this._map,u))}touchend(u){this._map.fire(new Qp(u.type,this._map,u))}touchcancel(u){this._map.fire(new Qp(u.type,this._map,u))}_firePreventable(u){if(this._map.fire(u),u.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Fo{constructor(u){this._map=u}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(u){this._map.fire(new Zr(u.type,this._map,u))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Zr("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(u){this._delayContextMenu?this._contextMenuEvent=u:this._map.fire(new Zr(u.type,this._map,u)),this._map.listens("contextmenu")&&u.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class G_{constructor(u,p){this._map=u,this._el=u.getCanvasContainer(),this._container=u.getContainer(),this._clickTolerance=p.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(u,p){this.isEnabled()&&u.shiftKey&&0===u.button&&(ph(),this._startPos=this._lastPos=p,this._active=!0)}mousemoveWindow(u,p){if(!this._active)return;const x=p,M=this._startPos,E=this._lastPos;if(!M||!E||E.equals(x)||!this._box&&x.dist(M)<this._clickTolerance)return;this._lastPos=x,this._box||(this._box=mi("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",u));const P=Math.min(M.x,x.x),O=Math.max(M.x,x.x),N=Math.min(M.y,x.y),U=Math.max(M.y,x.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${P}px,${N}px)`,this._box.style.width=O-P+"px",this._box.style.height=U-N+"px")})}mouseupWindow(u,p){if(!this._active)return;const x=this._startPos,M=p;if(x&&0===u.button){if(this.reset(),Ia(),x.x!==M.x||x.y!==M.y)return this._map.fire(new g.Event("boxzoomend",{originalEvent:u})),{cameraAnimation:E=>E.fitScreenCoordinates(x,M,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",u)}}keydown(u){this._active&&27===u.keyCode&&(this.reset(),this._fireEvent("boxzoomcancel",u))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),Il(),delete this._startPos,delete this._lastPos}_fireEvent(u,p){return this._map.fire(new g.Event(u,{originalEvent:p}))}}function Uu(_,u){const p={};for(let x=0;x<_.length;x++)p[_[x].identifier]=u[x];return p}class ef{constructor(u){this.reset(),this.numTouches=u.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(u,p,x){(this.centroid||x.length>this.numTouches)&&(this.aborted=!0),this.aborted||(0===this.startTime&&(this.startTime=u.timeStamp),x.length===this.numTouches&&(this.centroid=function(M){const E=new g.pointGeometry(0,0);for(const P of M)E._add(P);return E.div(M.length)}(p),this.touches=Uu(x,p)))}touchmove(u,p,x){if(this.aborted||!this.centroid)return;const M=Uu(x,p);for(const E in this.touches){const P=this.touches[E],O=M[E];(!O||O.dist(P)>30)&&(this.aborted=!0)}}touchend(u,p,x){if((!this.centroid||u.timeStamp-this.startTime>500)&&(this.aborted=!0),0===x.length){const M=!this.aborted&&this.centroid;if(this.reset(),M)return M}}}class za{constructor(u){this.singleTap=new ef(u),this.numTaps=u.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(u,p,x){this.singleTap.touchstart(u,p,x)}touchmove(u,p,x){this.singleTap.touchmove(u,p,x)}touchend(u,p,x){const M=this.singleTap.touchend(u,p,x);if(M){const E=u.timeStamp-this.lastTime<500,P=!this.lastTap||this.lastTap.dist(M)<30;if(E&&P||this.reset(),this.count++,this.lastTime=u.timeStamp,this.lastTap=M,this.count===this.numTaps)return this.reset(),M}}}class Fm{constructor(){this._zoomIn=new za({numTouches:1,numTaps:2}),this._zoomOut=new za({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(u,p,x){this._zoomIn.touchstart(u,p,x),this._zoomOut.touchstart(u,p,x)}touchmove(u,p,x){this._zoomIn.touchmove(u,p,x),this._zoomOut.touchmove(u,p,x)}touchend(u,p,x){const M=this._zoomIn.touchend(u,p,x),E=this._zoomOut.touchend(u,p,x);return M?(this._active=!0,u.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:P=>P.easeTo({duration:300,zoom:P.getZoom()+1,around:P.unproject(M)},{originalEvent:u})}):E?(this._active=!0,u.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:P=>P.easeTo({duration:300,zoom:P.getZoom()-1,around:P.unproject(E)},{originalEvent:u})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const tf={0:1,2:2};class ui{constructor(u){this.reset(),this._clickTolerance=u.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(u,p){return!1}_move(u,p){return{}}mousedown(u,p){if(this._lastPoint)return;const x=Kl(u);this._correctButton(u,x)&&(this._lastPoint=p,this._eventButton=x)}mousemoveWindow(u,p){const x=this._lastPoint;if(x)if(u.preventDefault(),null!=this._eventButton&&function(M,E){const P=tf[E];return void 0===M.buttons||(M.buttons&P)!==P}(u,this._eventButton))this.reset();else if(this._moved||!(p.dist(x)<this._clickTolerance))return this._moved=!0,this._lastPoint=p,this._move(x,p)}mouseupWindow(u){this._lastPoint&&Kl(u)===this._eventButton&&(this._moved&&Ia(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Nm extends ui{mousedown(u,p){super.mousedown(u,p),this._lastPoint&&(this._active=!0)}_correctButton(u,p){return 0===p&&!u.ctrlKey}_move(u,p){return{around:p,panDelta:p.sub(u)}}}class j_ extends ui{_correctButton(u,p){return 0===p&&u.ctrlKey||2===p}_move(u,p){const x=.8*(p.x-u.x);if(x)return this._active=!0,{bearingDelta:x}}contextmenu(u){u.preventDefault()}}class Hu extends ui{_correctButton(u,p){return 0===p&&u.ctrlKey||2===p}_move(u,p){const x=-.5*(p.y-u.y);if(x)return this._active=!0,{pitchDelta:x}}contextmenu(u){u.preventDefault()}}class $_{constructor(u,p){this._map=u,this._el=u.getCanvasContainer(),this._minTouches=1,this._clickTolerance=p.clickTolerance||1,this.reset(),g.bindAll(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new g.pointGeometry(0,0)}touchstart(u,p,x){return this._calculateTransform(u,p,x)}touchmove(u,p,x){if(this._active&&!(x.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(1===x.length&&!g.isFullscreen())return void this._showTouchPanBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return u.cancelable&&u.preventDefault(),this._calculateTransform(u,p,x)}}touchend(u,p,x){this._calculateTransform(u,p,x),this._active&&x.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(u,p,x){x.length>0&&(this._active=!0);const M=Uu(x,p),E=new g.pointGeometry(0,0),P=new g.pointGeometry(0,0);let O=0;for(const U in M){const H=M[U],Z=this._touches[U];Z&&(E._add(H),P._add(H.sub(Z)),O++,M[U]=H)}if(this._touches=M,O<this._minTouches||!P.mag())return;const N=P.div(O);return this._sum._add(N),this._sum.mag()<this._clickTolerance?void 0:{around:E.div(O),panDelta:N}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=mi("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","null")},500)}}class nf{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(u){}_move(u,p,x){return{}}touchstart(u,p,x){this._firstTwoTouches||x.length<2||(this._firstTwoTouches=[x[0].identifier,x[1].identifier],this._start([p[0],p[1]]))}touchmove(u,p,x){const M=this._firstTwoTouches;if(!M)return;u.preventDefault();const[E,P]=M,O=Rd(x,p,E),N=Rd(x,p,P);if(!O||!N)return;const U=this._aroundCenter?null:O.add(N).div(2);return this._move([O,N],U,u)}touchend(u,p,x){if(!this._firstTwoTouches)return;const[M,E]=this._firstTwoTouches,P=Rd(x,p,M),O=Rd(x,p,E);P&&O||(this._active&&Ia(),this.reset())}touchcancel(){this.reset()}enable(u){this._enabled=!0,this._aroundCenter=!!u&&"center"===u.around}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Rd(_,u,p){for(let x=0;x<_.length;x++)if(_[x].identifier===p)return u[x]}function Bm(_,u){return Math.log(_/u)/Math.LN2}class W_ extends nf{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(u){this._startDistance=this._distance=u[0].dist(u[1])}_move(u,p){const x=this._distance;if(this._distance=u[0].dist(u[1]),this._active||!(Math.abs(Bm(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Bm(this._distance,x),pinchAround:p}}}function Rt(_,u){return 180*_.angleWith(u)/Math.PI}class ai extends nf{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(u){this._startVector=this._vector=u[0].sub(u[1]),this._minDiameter=u[0].dist(u[1])}_move(u,p){const x=this._vector;if(this._vector=u[0].sub(u[1]),x&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:Rt(this._vector,x),pinchAround:p}}_isBelowThreshold(u){this._minDiameter=Math.min(this._minDiameter,u.mag());const p=25/(Math.PI*this._minDiameter)*360,x=this._startVector;if(!x)return!1;const M=Rt(u,x);return Math.abs(M)<p}}function As(_){return Math.abs(_.y)>Math.abs(_.x)}class Us extends nf{constructor(u){super(),this._map=u}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(u){this._lastPoints=u,As(u[0].sub(u[1]))&&(this._valid=!1)}_move(u,p,x){const M=this._lastPoints;if(!M)return;const E=u[0].sub(M[0]),P=u[1].sub(M[1]);return this._map._cooperativeGestures&&!g.isFullscreen()&&x.touches.length<3||(this._valid=this.gestureBeginsVertically(E,P,x.timeStamp),!this._valid)?void 0:(this._lastPoints=u,this._active=!0,{pitchDelta:(E.y+P.y)/2*-.5})}gestureBeginsVertically(u,p,x){if(void 0!==this._valid)return this._valid;const M=u.mag()>=2,E=p.mag()>=2;if(!M&&!E)return;if(!M||!E)return null==this._firstMove&&(this._firstMove=x),x-this._firstMove<100&&void 0;const P=u.y>0==p.y>0;return As(u)&&As(p)&&P}}const Is={panStep:100,bearingStep:15,pitchStep:10};class q_{constructor(){const u=Is;this._panStep=u.panStep,this._bearingStep=u.bearingStep,this._pitchStep=u.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(u){if(u.altKey||u.ctrlKey||u.metaKey)return;let p=0,x=0,M=0,E=0,P=0;switch(u.keyCode){case 61:case 107:case 171:case 187:p=1;break;case 189:case 109:case 173:p=-1;break;case 37:u.shiftKey?x=-1:(u.preventDefault(),E=-1);break;case 39:u.shiftKey?x=1:(u.preventDefault(),E=1);break;case 38:u.shiftKey?M=1:(u.preventDefault(),P=-1);break;case 40:u.shiftKey?M=-1:(u.preventDefault(),P=1);break;default:return}return this._rotationDisabled&&(x=0,M=0),{cameraAnimation:O=>{const N=O.getZoom();O.easeTo({duration:300,easeId:"keyboardHandler",easing:_a,zoom:p?Math.round(N)+p*(u.shiftKey?2:1):N,bearing:O.getBearing()+x*this._bearingStep,pitch:O.getPitch()+M*this._pitchStep,offset:[-E*this._panStep,-P*this._panStep],center:O.getCenter()},{originalEvent:u})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function _a(_){return _*(2-_)}const Va=4.000244140625;class Wc{constructor(u,p){this._map=u,this._el=u.getCanvasContainer(),this._handler=p,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,g.bindAll(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(u){this._defaultZoomRate=u}setWheelZoomRate(u){this._wheelZoomRate=u}isEnabled(){return!!this._enabled}isActive(){return this._active||void 0!==this._finishTimeout}isZooming(){return!!this._zooming}enable(u){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!u&&"center"===u.around,this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(u){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(u.ctrlKey||u.metaKey||this.isZooming()||g.isFullscreen()))return void this._showBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let p=u.deltaMode===g.window.WheelEvent.DOM_DELTA_LINE?40*u.deltaY:u.deltaY;const x=g.exported.now(),M=x-(this._lastWheelEventTime||0);this._lastWheelEventTime=x,0!==p&&p%Va==0?this._type="wheel":0!==p&&Math.abs(p)<4?this._type="trackpad":M>400?(this._type=null,this._lastValue=p,this._timeout=setTimeout(this._onTimeout,40,u)):this._type||(this._type=Math.abs(M*p)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,p+=this._lastValue)),u.shiftKey&&p&&(p/=4),this._type&&(this._lastWheelEvent=u,this._delta-=p,this._active||this._start(u)),u.preventDefault()}_onTimeout(u){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(u)}_start(u){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const p=Ht(this._el,u);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:p,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const u=this._map.transform;"wheel"===this._type&&u.projection.wrap&&(u._center.lng>=180||u._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const p=()=>u._terrainEnabled()&&this._aroundCoord?u.computeZoomRelativeTo(this._aroundCoord):u.zoom;if(0!==this._delta){const N="wheel"===this._type&&Math.abs(this._delta)>Va?this._wheelZoomRate:this._defaultZoomRate;let U=2/(1+Math.exp(-Math.abs(this._delta*N)));this._delta<0&&0!==U&&(U=1/U);const H=p(),Z=Math.pow(2,H),Q="number"==typeof this._targetZoom?u.zoomScale(this._targetZoom):Z;this._targetZoom=Math.min(u.maxZoom,Math.max(u.minZoom,u.scaleZoom(Q*U))),"wheel"===this._type&&(this._startZoom=H,this._easing=this._smoothOutEasing(200)),this._delta=0}const x="number"==typeof this._targetZoom?this._targetZoom:p(),M=this._startZoom,E=this._easing;let P,O=!1;if("wheel"===this._type&&M&&E){const N=Math.min((g.exported.now()-this._lastWheelEventTime)/200,1),U=E(N);P=g.number(M,x,U),N<1?this._frameId||(this._frameId=!0):O=!0}else P=x,O=!0;return this._active=!0,O&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!O,zoomDelta:P-p(),around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(u){let p=g.ease;if(this._prevEase){const x=this._prevEase,M=(g.exported.now()-x.start)/x.duration,E=x.easing(M+.01)-x.easing(M),P=.27/Math.sqrt(E*E+1e-4)*.01,O=Math.sqrt(.0729-P*P);p=g.bezier(P,O,.25,1)}return this._prevEase={start:g.exported.now(),duration:u,easing:p},p}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=mi("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(g.window.navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","null")},200)}}class Ua{constructor(u,p){this._clickZoom=u,this._tapZoom=p}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class zm{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(u,p){return u.preventDefault(),{cameraAnimation:x=>{x.easeTo({duration:300,zoom:x.getZoom()+(u.shiftKey?-1:1),around:x.unproject(p)},{originalEvent:u})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class tn{constructor(){this._tap=new za({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(u,p,x){this._swipePoint||(this._tapTime&&u.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?x.length>0&&(this._swipePoint=p[0],this._swipeTouch=x[0].identifier):this._tap.touchstart(u,p,x))}touchmove(u,p,x){if(this._tapTime){if(this._swipePoint){if(x[0].identifier!==this._swipeTouch)return;const M=p[0],E=M.y-this._swipePoint.y;return this._swipePoint=M,u.preventDefault(),this._active=!0,{zoomDelta:E/128}}}else this._tap.touchmove(u,p,x)}touchend(u,p,x){this._tapTime?this._swipePoint&&0===x.length&&this.reset():this._tap.touchend(u,p,x)&&(this._tapTime=u.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class I0{constructor(u,p,x){this._el=u,this._mousePan=p,this._touchPan=x}enable(u){this._inertiaOptions=u||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Vm{constructor(u,p,x){this._pitchWithRotate=u.pitchWithRotate,this._mouseRotate=p,this._mousePitch=x}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Ps{constructor(u,p,x,M){this._el=u,this._touchZoom=p,this._touchRotate=x,this._tapDragZoom=M,this._rotationDisabled=!1,this._enabled=!0}enable(u){this._touchZoom.enable(u),this._rotationDisabled||this._touchRotate.enable(u),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const po=_=>_.zoom||_.drag||_.pitch||_.rotate;class Um extends g.Event{}class Gu{constructor(){this.constants=[1,1,.01],this.radius=0}setup(u,p){const x=g.sub([],p,u);this.radius=g.length(x[2]<0?g.div([],x,this.constants):[x[0],x[1],0])}projectRay(u){g.div(u,u,this.constants),g.normalize(u,u),g.mul$1(u,u,this.constants);const p=g.scale$2([],u,this.radius);if(p[2]>0){const x=g.scale$2([],[0,0,1],g.dot(p,[0,0,1])),M=g.scale$2([],g.normalize([],[p[0],p[1],0]),this.radius),E=g.add([],p,g.scale$2([],g.sub([],g.add([],M,x),p),2));p[0]=E[0],p[1]=E[1]}return p}}function ya(_){return _.panDelta&&_.panDelta.mag()||_.zoomDelta||_.bearingDelta||_.pitchDelta}class Z_{constructor(u,p){this._map=u,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new H_(u),this._bearingSnap=p.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new Gu,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(p),g.bindAll(["handleEvent","handleWindowEvent"],this);const x=this._el;this._listeners=[[x,"touchstart",{passive:!0}],[x,"touchmove",{passive:!1}],[x,"touchend",void 0],[x,"touchcancel",void 0],[x,"mousedown",void 0],[x,"mousemove",void 0],[x,"mouseup",void 0],[g.window.document,"mousemove",{capture:!0}],[g.window.document,"mouseup",void 0],[x,"mouseover",void 0],[x,"mouseout",void 0],[x,"dblclick",void 0],[x,"click",void 0],[x,"keydown",{capture:!1}],[x,"keyup",void 0],[x,"wheel",{passive:!1}],[x,"contextmenu",void 0],[g.window,"blur",void 0]];for(const[M,E,P]of this._listeners)M.addEventListener(E,M===g.window.document?this.handleWindowEvent:this.handleEvent,P)}destroy(){for(const[u,p,x]of this._listeners)u.removeEventListener(p,u===g.window.document?this.handleWindowEvent:this.handleEvent,x)}_addDefaultHandlers(u){const p=this._map,x=p.getCanvasContainer();this._add("mapEvent",new cc(p,u));const M=p.boxZoom=new G_(p,u);this._add("boxZoom",M);const E=new Fm,P=new zm;p.doubleClickZoom=new Ua(P,E),this._add("tapZoom",E),this._add("clickZoom",P);const O=new tn;this._add("tapDragZoom",O);const N=p.touchPitch=new Us(p);this._add("touchPitch",N);const U=new j_(u),H=new Hu(u);p.dragRotate=new Vm(u,U,H),this._add("mouseRotate",U,["mousePitch"]),this._add("mousePitch",H,["mouseRotate"]);const Z=new Nm(u),Q=new $_(p,u);p.dragPan=new I0(x,Z,Q),this._add("mousePan",Z),this._add("touchPan",Q,["touchZoom","touchRotate"]);const oe=new ai,ie=new W_;p.touchZoomRotate=new Ps(x,ie,oe,O),this._add("touchRotate",oe,["touchPan","touchZoom"]),this._add("touchZoom",ie,["touchPan","touchRotate"]),this._add("blockableMapEvent",new Fo(p));const le=p.scrollZoom=new Wc(p,this);this._add("scrollZoom",le,["mousePan"]);const re=p.keyboard=new q_;this._add("keyboard",re);for(const ne of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])u.interactive&&u[ne]&&p[ne].enable(u[ne])}_add(u,p,x){this._handlers.push({handlerName:u,handler:p,allowed:x}),this._handlersById[u]=p}stop(u){if(!this._updatingCamera){for(const{handler:p}of this._handlers)p.reset();this._inertia.clear(),this._fireEvents({},{},u),this._changes=[]}}isActive(){for(const{handler:u}of this._handlers)if(u.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!po(this._eventsInProgress)||this.isZooming()}_blockedByActive(u,p,x){for(const M in u)if(M!==x&&(!p||p.indexOf(M)<0))return!0;return!1}handleWindowEvent(u){this.handleEvent(u,`${u.type}Window`)}_getMapTouches(u){const p=[];for(const x of u)this._el.contains(x.target)&&p.push(x);return p}handleEvent(u,p){this._updatingCamera=!0;const x="renderFrame"===u.type,M=x?void 0:u,E={needsRenderFrame:!1},P={},O={},N=u.touches?this._getMapTouches(u.touches):void 0,U=N?Pa(this._el,N):x?void 0:Ht(this._el,u);for(const{handlerName:Q,handler:oe,allowed:ie}of this._handlers){if(!oe.isEnabled())continue;let le;this._blockedByActive(O,ie,Q)?oe.reset():oe[p||u.type]&&(le=oe[p||u.type](u,U,N),this.mergeHandlerResult(E,P,le,Q,M),le&&le.needsRenderFrame&&this._triggerRenderFrame()),(le||oe.isActive())&&(O[Q]=oe)}const H={};for(const Q in this._previousActiveHandlers)O[Q]||(H[Q]=M);this._previousActiveHandlers=O,(Object.keys(H).length||ya(E))&&(this._changes.push([E,P,H]),this._triggerRenderFrame()),(Object.keys(O).length||ya(E))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:Z}=E;Z&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],Z(this._map))}mergeHandlerResult(u,p,x,M,E){if(!x)return;g.extend(u,x);const P={handlerName:M,originalEvent:x.originalEvent||E};void 0!==x.zoomDelta&&(p.zoom=P),void 0!==x.panDelta&&(p.drag=P),void 0!==x.pitchDelta&&(p.pitch=P),void 0!==x.bearingDelta&&(p.rotate=P)}_applyChanges(){const u={},p={},x={};for(const[M,E,P]of this._changes)M.panDelta&&(u.panDelta=(u.panDelta||new g.pointGeometry(0,0))._add(M.panDelta)),M.zoomDelta&&(u.zoomDelta=(u.zoomDelta||0)+M.zoomDelta),M.bearingDelta&&(u.bearingDelta=(u.bearingDelta||0)+M.bearingDelta),M.pitchDelta&&(u.pitchDelta=(u.pitchDelta||0)+M.pitchDelta),void 0!==M.around&&(u.around=M.around),void 0!==M.aroundCoord&&(u.aroundCoord=M.aroundCoord),void 0!==M.pinchAround&&(u.pinchAround=M.pinchAround),M.noInertia&&(u.noInertia=M.noInertia),g.extend(p,E),g.extend(x,P);this._updateMapTransform(u,p,x),this._changes=[]}_updateMapTransform(u,p,x){const M=this._map,E=M.transform,P=ue=>[ue.x,ue.y,ue.z];if((ue=>{const se=this._eventsInProgress.drag;return se&&!this._handlersById[se.handlerName].isActive()})()&&!ya(u)){const ue=E.zoom;E.cameraElevationReference="sea",E.recenterOnTerrain(),E.cameraElevationReference="ground",ue!==E.zoom&&this._map._update(!0)}if(!ya(u))return void this._fireEvents(p,x,!0);let{panDelta:O,zoomDelta:N,bearingDelta:U,pitchDelta:H,around:Z,aroundCoord:Q,pinchAround:oe}=u;void 0!==oe&&(Z=oe),(ue=>p.drag&&!this._eventsInProgress.drag)()&&Z&&(this._dragOrigin=P(E.pointCoordinate3D(Z)),this._trackingEllipsoid.setup(E._camera.position,this._dragOrigin)),E.cameraElevationReference="sea",M._stop(!0),Z=Z||M.transform.centerPoint,U&&(E.bearing+=U),H&&(E.pitch+=H),E._updateCameraState();const ie=[0,0,0];if(O)if("mercator"===E.projection.name){const ue=this._trackingEllipsoid.projectRay(E.screenPointToMercatorRay(Z).dir),se=this._trackingEllipsoid.projectRay(E.screenPointToMercatorRay(Z.sub(O)).dir);ie[0]=se[0]-ue[0],ie[1]=se[1]-ue[1]}else{const ue=E.pointCoordinate(Z);if("globe"===E.projection.name){O=O.rotate(-E.angle);const se=E._pixelsPerMercatorPixel/E.worldSize;ie[0]=-O.x*g.mercatorScale(g.latFromMercatorY(ue.y))*se,ie[1]=-O.y*g.mercatorScale(E.center.lat)*se}else{const se=E.pointCoordinate(Z.sub(O));ue&&se&&(ie[0]=se.x-ue.x,ie[1]=se.y-ue.y)}}const le=E.zoom,re=[0,0,0];if(N){const ue=P(Q||E.pointCoordinate3D(Z)),se={dir:g.normalize([],g.sub([],ue,E._camera.position))};if(se.dir[2]<0){const Me=E.zoomDeltaToMovement(ue,N);g.scale$2(re,se.dir,Me)}}const ne=g.add(ie,ie,re);E._translateCameraConstrained(ne),N&&Math.abs(E.zoom-le)>1e-4&&E.recenterOnTerrain(),E.cameraElevationReference="ground",this._map._update(),u.noInertia||this._inertia.record(u),this._fireEvents(p,x,!0)}_fireEvents(u,p,x){const M=po(this._eventsInProgress),E=po(u),P={};for(const H in u){const{originalEvent:Z}=u[H];this._eventsInProgress[H]||(P[`${H}start`]=Z),this._eventsInProgress[H]=u[H]}!M&&E&&this._fireEvent("movestart",E.originalEvent);for(const H in P)this._fireEvent(H,P[H]);E&&this._fireEvent("move",E.originalEvent);for(const H in u){const{originalEvent:Z}=u[H];this._fireEvent(H,Z)}const O={};let N;for(const H in this._eventsInProgress){const{handlerName:Z,originalEvent:Q}=this._eventsInProgress[H];this._handlersById[Z].isActive()||(delete this._eventsInProgress[H],N=p[Z]||Q,O[`${H}end`]=N)}for(const H in O)this._fireEvent(H,O[H]);const U=po(this._eventsInProgress);if(x&&(M||E)&&!U){this._updatingCamera=!0;const H=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),Z=Q=>0!==Q&&-this._bearingSnap<Q&&Q<this._bearingSnap;H?(Z(H.bearing||this._map.getBearing())&&(H.bearing=0),this._map.easeTo(H,{originalEvent:N})):(this._map.fire(new g.Event("moveend",{originalEvent:N})),Z(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(u,p){this._map.fire(new g.Event(u,p?{originalEvent:p}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(u=>{this._frameId=void 0,this.handleEvent(new Um("renderFrame",{timeStamp:u})),this._applyChanges()})}_triggerRenderFrame(){void 0===this._frameId&&(this._frameId=this._requestFrame())}}const rf="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class X_ extends g.Evented{constructor(u,p){super(),this._moving=!1,this._zooming=!1,this.transform=u,this._bearingSnap=p.bearingSnap,g.bindAll(["_renderFrameCallback"],this)}getCenter(){return new g.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(u,p){return this.jumpTo({center:u},p)}panBy(u,p,x){return u=g.pointGeometry.convert(u).mult(-1),this.panTo(this.transform.center,g.extend({offset:u},p),x)}panTo(u,p,x){return this.easeTo(g.extend({center:u},p),x)}getZoom(){return this.transform.zoom}setZoom(u,p){return this.jumpTo({zoom:u},p),this}zoomTo(u,p,x){return this.easeTo(g.extend({zoom:u},p),x)}zoomIn(u,p){return this.zoomTo(this.getZoom()+1,u,p),this}zoomOut(u,p){return this.zoomTo(this.getZoom()-1,u,p),this}getBearing(){return this.transform.bearing}setBearing(u,p){return this.jumpTo({bearing:u},p),this}getPadding(){return this.transform.padding}setPadding(u,p){return this.jumpTo({padding:u},p),this}rotateTo(u,p,x){return this.easeTo(g.extend({bearing:u},p),x)}resetNorth(u,p){return this.rotateTo(0,g.extend({duration:1e3},u),p),this}resetNorthPitch(u,p){return this.easeTo(g.extend({bearing:0,pitch:0,duration:1e3},u),p),this}snapToNorth(u,p){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(u,p):this}getPitch(){return this.transform.pitch}setPitch(u,p){return this.jumpTo({pitch:u},p),this}cameraForBounds(u,p){u=g.LngLatBounds.convert(u);const x=p&&p.bearing||0,M=u.getNorthWest(),E=u.getSouthEast();return this._cameraForBounds(this.transform,M,E,x,p)}_extendCameraOptions(u){const p={top:0,bottom:0,right:0,left:0};if("number"==typeof(u=g.extend({padding:p,offset:[0,0],maxZoom:this.transform.maxZoom},u)).padding){const x=u.padding;u.padding={top:x,bottom:x,right:x,left:x}}return u.padding=g.extend(p,u.padding),u}_minimumAABBFrustumDistance(u,p){const x=p.max[0]-p.min[0],M=p.max[1]-p.min[1];return x/M>u.aspect?x/(2*Math.tan(.5*u.fovX)*u.aspect):M/(2*Math.tan(.5*u.fovY)*u.aspect)}_cameraForBoundsOnGlobe(u,p,x,M,E){const P=u.clone(),O=this._extendCameraOptions(E);P.bearing=M;const N=g.LngLat.convert(p),U=g.LngLat.convert(x),H=.5*(N.lat+U.lat),Z=.5*(N.lng+U.lng),Q=g.latLngToECEF(H,Z),oe=g.normalize([],Q),ie=g.normalize([],g.cross([],oe,[0,1,0])),le=g.cross([],ie,oe),re=[ie[0],ie[1],ie[2],0,le[0],le[1],le[2],0,oe[0],oe[1],oe[2],0,0,0,0,1],ne=[Q,g.latLngToECEF(N.lat,N.lng),g.latLngToECEF(U.lat,N.lng),g.latLngToECEF(U.lat,U.lng),g.latLngToECEF(N.lat,U.lng),g.latLngToECEF(H,N.lng),g.latLngToECEF(H,U.lng),g.latLngToECEF(N.lat,Z),g.latLngToECEF(U.lat,Z)];let ue=g.Aabb.fromPoints(ne.map(Ft=>[g.dot(ie,Ft),g.dot(le,Ft),g.dot(oe,Ft)]));const se=g.transformMat4([],ue.center,re);0===g.squaredLength(se)&&g.set(se,0,0,1),g.normalize(se,se),g.scale$2(se,se,g.GLOBE_RADIUS),P.center=g.ecefToLatLng(se);const Me=P.getWorldToCameraMatrix(),Se=g.invert(new Float64Array(16),Me);ue=g.Aabb.applyTransform(ue,g.multiply([],Me,re)),g.transformMat4(se,se,Me);const ge=.5*(ue.max[2]-ue.min[2]),De=this._minimumAABBFrustumDistance(P,ue),Ue=g.scale$2([],[0,0,1],ge),Ke=g.add(Ue,se,Ue),je=De+(0===P.pitch?0:g.distance(se,Ke)),St=P.globeCenterInViewSpace,Ne=g.sub([],se,[St[0],St[1],St[2]]);g.normalize(Ne,Ne),g.scale$2(Ne,Ne,je);const pt=g.add([],se,Ne);g.transformMat4(pt,pt,Se);const ht=g.earthRadius/g.GLOBE_RADIUS,We=g.length(pt),Fe=g.mercatorZfromAltitude(We*ht-g.earthRadius,0),$t=Math.min(P.zoomFromMercatorZAdjusted(Fe),O.maxZoom);return $t>.5*(g.GLOBE_ZOOM_THRESHOLD_MIN+g.GLOBE_ZOOM_THRESHOLD_MAX)?(P.setProjection({name:"mercator"}),P.zoom=$t,this._cameraForBounds(P,p,x,M,E)):{center:P.center,zoom:$t,bearing:M}}queryTerrainElevation(u,p){const x=this.transform.elevation;return x?(p=g.extend({},{exaggerated:!0},p),x.getAtPoint(g.MercatorCoordinate.fromLngLat(u),null,p.exaggerated)):null}_cameraForBounds(u,p,x,M,E){if("globe"===u.projection.name)return this._cameraForBoundsOnGlobe(u,p,x,M,E);const P=u.clone(),O=this._extendCameraOptions(E),N=P.padding;P.bearing=M;const U=g.LngLat.convert(p),H=g.LngLat.convert(x),Z=new g.LngLat(U.lng,H.lat),Q=new g.LngLat(H.lng,U.lat),oe=P.project(U),ie=P.project(H),le=this.queryTerrainElevation(U),re=this.queryTerrainElevation(H),ne=this.queryTerrainElevation(Z),ue=this.queryTerrainElevation(Q),se=[[oe.x,oe.y,Math.min(le||0,re||0,ne||0,ue||0)],[ie.x,ie.y,Math.max(le||0,re||0,ne||0,ue||0)]];let Me=g.Aabb.fromPoints(se);const Se=P.getWorldToCameraMatrix(),ge=g.invert(new Float64Array(16),Se);Me=g.Aabb.applyTransform(Me,Se);const De=g.sub([],Me.max,Me.min),Ue=N.left||0,Ke=N.right||0,je=N.bottom||0,St=N.top||0,{left:Ne,right:pt,top:ht,bottom:We}=O.padding,Fe=.5*(Ue+Ke),$t=.5*(St+je),Ft=Math.min(P.scaleZoom(P.scale*Math.min((P.width-(Ue+Ke+Ne+pt))/De[0],(P.height-(je+St+We+ht))/De[1])),O.maxZoom),kt=P.scale/P.zoomScale(Ft);Me=new g.Aabb([Me.min[0]-(Ne+Fe)*kt,Me.min[1]-(We+$t)*kt,Me.min[2]],[Me.max[0]+(pt+Fe)*kt,Me.max[1]+(ht+$t)*kt,Me.max[2]]);const Bt=.5*De[2],un=this._minimumAABBFrustumDistance(P,Me),Nn=[0,0,1,0];g.transformMat4$1(Nn,Nn,Se),g.normalize$2(Nn,Nn);const Tn=g.scale$2([],Nn,un+Bt),mn=g.add([],Me.center,Tn),Lt=("number"==typeof O.offset.x&&"number"==typeof O.offset.y?new g.pointGeometry(O.offset.x,O.offset.y):g.pointGeometry.convert(O.offset)).rotate(-g.degToRad(M));Me.center[0]-=Lt.x*kt,Me.center[1]+=Lt.y*kt,g.transformMat4(Me.center,Me.center,ge),g.transformMat4(mn,mn,ge);const qn=[Me.center[0],Me.center[1],mn[2]*P.pixelsPerMeter];g.scale$2(qn,qn,1/P.worldSize);const di=g.lngFromMercatorX(qn[0]),ur=g.latFromMercatorY(qn[1]),dr=Math.min(P._zoomFromMercatorZ(qn[2]),O.maxZoom),Yi=new g.LngLat(di,ur);return P.mercatorFromTransition&&dr<.5*(g.GLOBE_ZOOM_THRESHOLD_MIN+g.GLOBE_ZOOM_THRESHOLD_MAX)?(P.setProjection({name:"globe"}),P.zoom=dr,this._cameraForBounds(P,p,x,M,E)):{center:Yi,zoom:dr,bearing:M}}fitBounds(u,p,x){const M=this.cameraForBounds(u,p);return this._fitInternal(M,p,x)}fitScreenCoordinates(u,p,x,M,E){const P=g.pointGeometry.convert(u),O=g.pointGeometry.convert(p),N=new g.pointGeometry(Math.min(P.x,O.x),Math.min(P.y,O.y)),U=new g.pointGeometry(Math.max(P.x,O.x),Math.max(P.y,O.y));if("mercator"===this.transform.projection.name&&this.transform.anyCornerOffEdge(P,O))return this;const H=this.transform.pointLocation3D(N),Z=this.transform.pointLocation3D(U),Q=this.transform.pointLocation3D(new g.pointGeometry(N.x,U.y)),oe=this.transform.pointLocation3D(new g.pointGeometry(U.x,N.y)),ie=[Math.min(H.lng,Z.lng,Q.lng,oe.lng),Math.min(H.lat,Z.lat,Q.lat,oe.lat)],le=[Math.max(H.lng,Z.lng,Q.lng,oe.lng),Math.max(H.lat,Z.lat,Q.lat,oe.lat)],re=this._cameraForBounds(this.transform,ie,le,x,M);return this._fitInternal(re,M,E)}_fitInternal(u,p,x){return u?(delete(p=g.extend(u,p)).padding,p.linear?this.easeTo(p,x):this.flyTo(p,x)):this}jumpTo(u,p){this.stop();const x=u.preloadOnly?this.transform.clone():this.transform;let M=!1,E=!1,P=!1;return"zoom"in u&&x.zoom!==+u.zoom&&(M=!0,x.zoom=+u.zoom),void 0!==u.center&&(x.center=g.LngLat.convert(u.center)),"bearing"in u&&x.bearing!==+u.bearing&&(E=!0,x.bearing=+u.bearing),"pitch"in u&&x.pitch!==+u.pitch&&(P=!0,x.pitch=+u.pitch),null==u.padding||x.isPaddingEqual(u.padding)||(x.padding=u.padding),u.preloadOnly?(this._preloadTiles(x),this):(this.fire(new g.Event("movestart",p)).fire(new g.Event("move",p)),M&&this.fire(new g.Event("zoomstart",p)).fire(new g.Event("zoom",p)).fire(new g.Event("zoomend",p)),E&&this.fire(new g.Event("rotatestart",p)).fire(new g.Event("rotate",p)).fire(new g.Event("rotateend",p)),P&&this.fire(new g.Event("pitchstart",p)).fire(new g.Event("pitch",p)).fire(new g.Event("pitchend",p)),this.fire(new g.Event("moveend",p)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||g.warnOnce(rf),this.transform.getFreeCameraOptions()}setFreeCameraOptions(u,p){const x=this.transform;if(!x.projection.supportsFreeCamera)return g.warnOnce(rf),this;this.stop();const M=x.zoom,E=x.pitch,P=x.bearing;x.setFreeCameraOptions(u);const O=M!==x.zoom,N=E!==x.pitch,U=P!==x.bearing;return this.fire(new g.Event("movestart",p)).fire(new g.Event("move",p)),O&&this.fire(new g.Event("zoomstart",p)).fire(new g.Event("zoom",p)).fire(new g.Event("zoomend",p)),U&&this.fire(new g.Event("rotatestart",p)).fire(new g.Event("rotate",p)).fire(new g.Event("rotateend",p)),N&&this.fire(new g.Event("pitchstart",p)).fire(new g.Event("pitch",p)).fire(new g.Event("pitchend",p)),this.fire(new g.Event("moveend",p)),this}easeTo(u,p){this._stop(!1,u.easeId),(!1===(u=g.extend({offset:[0,0],duration:500,easing:g.ease},u)).animate||!u.essential&&g.exported.prefersReducedMotion)&&(u.duration=0);const x=this.transform,M=this.getZoom(),E=this.getBearing(),P=this.getPitch(),O=this.getPadding(),N="zoom"in u?+u.zoom:M,U="bearing"in u?this._normalizeBearing(u.bearing,E):E,H="pitch"in u?+u.pitch:P,Z="padding"in u?u.padding:x.padding,Q=g.pointGeometry.convert(u.offset);let oe,ie,le;if("globe"===x.projection.name){const Ke=g.MercatorCoordinate.fromLngLat(x.center),je=Q.rotate(-x.angle);Ke.x+=je.x/x.worldSize,Ke.y+=je.y/x.worldSize;const St=Ke.toLngLat(),Ne=g.LngLat.convert(u.center||St);this._normalizeCenter(Ne),oe=x.centerPoint.add(je),ie=new g.pointGeometry(Ke.x,Ke.y).mult(x.worldSize),le=new g.pointGeometry(g.mercatorXfromLng(Ne.lng),g.mercatorYfromLat(Ne.lat)).mult(x.worldSize).sub(ie)}else{oe=x.centerPoint.add(Q);const Ke=x.pointLocation(oe),je=g.LngLat.convert(u.center||Ke);this._normalizeCenter(je),ie=x.project(Ke),le=x.project(je).sub(ie)}const re=x.zoomScale(N-M);let ne,ue;u.around&&(ne=g.LngLat.convert(u.around),ue=x.locationPoint(ne));const se=this._zooming||N!==M,Me=this._rotating||E!==U,Se=this._pitching||H!==P,ge=!x.isPaddingEqual(Z),De=Ke=>je=>{if(se&&(Ke.zoom=g.number(M,N,je)),Me&&(Ke.bearing=g.number(E,U,je)),Se&&(Ke.pitch=g.number(P,H,je)),ge&&(Ke.interpolatePadding(O,Z,je),oe=Ke.centerPoint.add(Q)),ne)Ke.setLocationAtPoint(ne,ue);else{const St=Ke.zoomScale(Ke.zoom-M),Ne=N>M?Math.min(2,re):Math.max(.5,re),pt=Math.pow(Ne,1-je),ht=Ke.unproject(ie.add(le.mult(je*pt)).mult(St));Ke.setLocationAtPoint(Ke.renderWorldCopies?ht.wrap():ht,oe)}return u.preloadOnly||this._fireMoveEvents(p),Ke};if(u.preloadOnly){const Ke=this._emulate(De,u.duration,x);return this._preloadTiles(Ke),this}const Ue={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=se,this._rotating=Me,this._pitching=Se,this._padding=ge,this._easeId=u.easeId,this._prepareEase(p,u.noMoveStart,Ue),this._ease(De(x),Ke=>{x.recenterOnTerrain(),this._afterEase(p,Ke)},u),this}_prepareEase(u,p,x={}){this._moving=!0,this.transform.cameraElevationReference="sea",p||x.moving||this.fire(new g.Event("movestart",u)),this._zooming&&!x.zooming&&this.fire(new g.Event("zoomstart",u)),this._rotating&&!x.rotating&&this.fire(new g.Event("rotatestart",u)),this._pitching&&!x.pitching&&this.fire(new g.Event("pitchstart",u))}_fireMoveEvents(u){this.fire(new g.Event("move",u)),this._zooming&&this.fire(new g.Event("zoom",u)),this._rotating&&this.fire(new g.Event("rotate",u)),this._pitching&&this.fire(new g.Event("pitch",u))}_afterEase(u,p){if(this._easeId&&p&&this._easeId===p)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const x=this._zooming,M=this._rotating,E=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,x&&this.fire(new g.Event("zoomend",u)),M&&this.fire(new g.Event("rotateend",u)),E&&this.fire(new g.Event("pitchend",u)),this.fire(new g.Event("moveend",u))}flyTo(u,p){if(!u.essential&&g.exported.prefersReducedMotion){const kt=g.pick(u,["center","zoom","bearing","pitch","around"]);return this.jumpTo(kt,p)}this.stop(),u=g.extend({offset:[0,0],speed:1.2,curve:1.42,easing:g.ease},u);const x=this.transform,M=this.getZoom(),E=this.getBearing(),P=this.getPitch(),O=this.getPadding(),N="zoom"in u?g.clamp(+u.zoom,x.minZoom,x.maxZoom):M,U="bearing"in u?this._normalizeBearing(u.bearing,E):E,H="pitch"in u?+u.pitch:P,Z="padding"in u?u.padding:x.padding,Q=x.zoomScale(N-M),oe=g.pointGeometry.convert(u.offset);let ie=x.centerPoint.add(oe);const le=x.pointLocation(ie),re=g.LngLat.convert(u.center||le);this._normalizeCenter(re);const ne=x.project(le),ue=x.project(re).sub(ne);let se=u.curve;const Me=Math.max(x.width,x.height),Se=Me/Q,ge=ue.mag();if("minZoom"in u){const kt=g.clamp(Math.min(u.minZoom,M,N),x.minZoom,x.maxZoom),Bt=Me/x.zoomScale(kt-M);se=Math.sqrt(Bt/ge*2)}const De=se*se;function Ue(kt){const Bt=(Se*Se-Me*Me+(kt?-1:1)*De*De*ge*ge)/(2*(kt?Se:Me)*De*ge);return Math.log(Math.sqrt(Bt*Bt+1)-Bt)}function Ke(kt){return(Math.exp(kt)-Math.exp(-kt))/2}function je(kt){return(Math.exp(kt)+Math.exp(-kt))/2}const St=Ue(0);let Ne=function(kt){return je(St)/je(St+se*kt)},pt=function(kt){return Me*((je(St)*(Ke(Bt=St+se*kt)/je(Bt))-Ke(St))/De)/ge;var Bt},ht=(Ue(1)-St)/se;if(Math.abs(ge)<1e-6||!isFinite(ht)){if(Math.abs(Me-Se)<1e-6)return this.easeTo(u,p);const kt=Se<Me?-1:1;ht=Math.abs(Math.log(Se/Me))/se,pt=function(){return 0},Ne=function(Bt){return Math.exp(kt*se*Bt)}}u.duration="duration"in u?+u.duration:1e3*ht/("screenSpeed"in u?+u.screenSpeed/se:+u.speed),u.maxDuration&&u.duration>u.maxDuration&&(u.duration=0);const We=E!==U,Fe=H!==P,$t=!x.isPaddingEqual(Z),Ft=kt=>Bt=>{const un=Bt*ht,Nn=1/Ne(un);kt.zoom=1===Bt?N:M+kt.scaleZoom(Nn),We&&(kt.bearing=g.number(E,U,Bt)),Fe&&(kt.pitch=g.number(P,H,Bt)),$t&&(kt.interpolatePadding(O,Z,Bt),ie=kt.centerPoint.add(oe));const Tn=1===Bt?re:kt.unproject(ne.add(ue.mult(pt(un))).mult(Nn));return kt.setLocationAtPoint(kt.renderWorldCopies?Tn.wrap():Tn,ie),kt._updateCameraOnTerrain(),u.preloadOnly||this._fireMoveEvents(p),kt};if(u.preloadOnly){const kt=this._emulate(Ft,u.duration,x);return this._preloadTiles(kt),this}return this._zooming=!0,this._rotating=We,this._pitching=Fe,this._padding=$t,this._prepareEase(p,!1),this._ease(Ft(x),()=>this._afterEase(p),u),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(u,p){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const x=this._onEaseEnd;this._onEaseEnd=void 0,x.call(this,p)}if(!u){const x=this.handlers;x&&x.stop(!1)}return this}_ease(u,p,x){!1===x.animate||0===x.duration?(u(1),p()):(this._easeStart=g.exported.now(),this._easeOptions=x,this._onEaseFrame=u,this._onEaseEnd=p,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const u=Math.min((g.exported.now()-this._easeStart)/this._easeOptions.duration,1),p=this._onEaseFrame;p&&p(this._easeOptions.easing(u)),u<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(u,p){u=g.wrap(u,-180,180);const x=Math.abs(u-p);return Math.abs(u-360-p)<x&&(u-=360),Math.abs(u+360-p)<x&&(u+=360),u}_normalizeCenter(u){const p=this.transform;if(!p.renderWorldCopies||p.maxBounds)return;const x=u.lng-p.center.lng;u.lng+=x>180?-360:x<-180?360:0}_emulate(u,p,x){const M=Math.ceil(15*p/1e3),E=[],P=u(x.clone());for(let O=0;O<=M;O++){const N=P(O/M);E.push(N.clone())}return E}}class Hm{constructor(u={}){this.options=u,g.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(u){const p=this.options&&this.options.compact;return this._map=u,this._container=mi("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=mi("button","mapboxgl-ctrl-attrib-button",this._container),mi("span","mapboxgl-ctrl-icon",this._compactButton).setAttribute("aria-hidden","true"),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=mi("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),p&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),void 0===p&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(u,p){const x=this._map._getUIString(`AttributionControl.${p}`);u.setAttribute("aria-label",x),u.removeAttribute("title"),u.firstElementChild&&u.firstElementChild.setAttribute("title",x)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let u=this._editLink;u||(u=this._editLink=this._container.querySelector(".mapbox-improve-map"));const p=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||g.config.ACCESS_TOKEN}];if(u){const x=p.reduce((M,E,P)=>(E.value&&(M+=`${E.key}=${E.value}${P<p.length-1?"&":""}`),M),"?");u.href=`${g.config.FEEDBACK_URL}/${x}#${Vh(this._map,!0)}`,u.rel="noopener nofollow",this._setElementTitle(u,"MapFeedback")}}_updateData(u){!u||"metadata"!==u.sourceDataType&&"visibility"!==u.sourceDataType&&"style"!==u.dataType||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let u=[];if(this._map.style.stylesheet){const M=this._map.style.stylesheet;this.styleOwner=M.owner,this.styleId=M.id}const p=this._map.style._sourceCaches;for(const M in p){const E=p[M];if(E.used){const P=E.getSource();P.attribution&&u.indexOf(P.attribution)<0&&u.push(P.attribution)}}u.sort((M,E)=>M.length-E.length),u=u.filter((M,E)=>{for(let P=E+1;P<u.length;P++)if(u[P].indexOf(M)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?u=[...this.options.customAttribution,...u]:u.unshift(this.options.customAttribution));const x=u.join(" | ");x!==this._attribHTML&&(this._attribHTML=x,u.length?(this._innerContainer.innerHTML=x,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class ju{constructor(){g.bindAll(["_updateLogo","_updateCompact"],this)}onAdd(u){this._map=u,this._container=mi("div","mapboxgl-ctrl");const p=mi("a","mapboxgl-ctrl-logo");return p.target="_blank",p.rel="noopener nofollow",p.href="https://www.mapbox.com/",p.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),p.setAttribute("rel","noopener nofollow"),this._container.appendChild(p),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(u){u&&"metadata"!==u.sourceDataType||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const u=this._map.style._sourceCaches;if(0===Object.entries(u).length)return!0;for(const p in u){const x=u[p].getSource();if(x.hasOwnProperty("mapbox_logo")&&!x.mapbox_logo)return!1}return!0}_updateCompact(){const u=this._container.children;if(u.length){const p=u[0];this._map.getCanvasContainer().offsetWidth<250?p.classList.add("mapboxgl-compact"):p.classList.remove("mapboxgl-compact")}}}class kd{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(u){const p=++this._id;return this._queue.push({callback:u,id:p,cancelled:!1}),p}remove(u){const p=this._currentlyRunning,x=p?this._queue.concat(p):this._queue;for(const M of x)if(M.id===u)return void(M.cancelled=!0)}run(u=0){const p=this._currentlyRunning=this._queue;this._queue=[];for(const x of p)if(!x.cancelled&&(x.callback(u),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function Ld(_,u,p){if(_=new g.LngLat(_.lng,_.lat),u){const x=new g.LngLat(_.lng-360,_.lat),M=new g.LngLat(_.lng+360,_.lat),E=360*Math.ceil(Math.abs(_.lng-p.center.lng)/360),P=p.locationPoint(_).distSqr(u),O=u.x<0||u.y<0||u.x>p.width||u.y>p.height;p.locationPoint(x).distSqr(u)<P&&(O||Math.abs(x.lng-p.center.lng)<E)?_=x:p.locationPoint(M).distSqr(u)<P&&(O||Math.abs(M.lng-p.center.lng)<E)&&(_=M)}for(;Math.abs(_.lng-p.center.lng)>180;){const x=p.locationPoint(_);if(x.x>=0&&x.y>=0&&x.x<=p.width&&x.y<=p.height)break;_.lng>p.center.lng?_.lng-=360:_.lng+=360}return _}const Od={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class sf extends g.Evented{constructor(u,p){if(super(),(u instanceof g.window.HTMLElement||p)&&(u=g.extend({element:u},p)),g.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=u&&u.anchor||"center",this._color=u&&u.color||"#3FB1CE",this._scale=u&&u.scale||1,this._draggable=u&&u.draggable||!1,this._clickTolerance=u&&u.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=u&&u.rotation||0,this._rotationAlignment=u&&u.rotationAlignment||"auto",this._pitchAlignment=u&&u.pitchAlignment&&u.pitchAlignment||"auto",this._updateMoving=()=>this._update(!0),this._occludedOpacity=u&&u.occludedOpacity||.2,u&&u.element)this._element=u.element,this._offset=g.pointGeometry.convert(u&&u.offset||[0,0]);else{this._defaultMarker=!0,this._element=mi("div");const M=41,E=27,P=Ss("svg",{display:"block",height:M*this._scale+"px",width:E*this._scale+"px",viewBox:`0 0 ${E} ${M}`},this._element),O=Ss("radialGradient",{id:"shadowGradient"},Ss("defs",{},P));Ss("stop",{offset:"10%","stop-opacity":.4},O),Ss("stop",{offset:"100%","stop-opacity":.05},O),Ss("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},P),Ss("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},P),Ss("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},P),Ss("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},P),this._offset=g.pointGeometry.convert(u&&u.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",M=>{M.preventDefault()}),this._element.addEventListener("mousedown",M=>{M.preventDefault()});const x=this._element.classList;for(const M in Od)x.remove(`mapboxgl-marker-anchor-${M}`);x.add(`mapboxgl-marker-anchor-${this._anchor}`),this._popup=null}addTo(u){return u===this._map||(this.remove(),this._map=u,u.getCanvasContainer().appendChild(this._element),u.on("move",this._updateMoving),u.on("moveend",this._update),u.on("remove",this._clearFadeTimer),u._addMarker(this),this.setDraggable(this._draggable),this._update(),u.on("click",this._onMapClick)),this}remove(){const u=this._map;return u&&(u.off("click",this._onMapClick),u.off("move",this._updateMoving),u.off("moveend",this._update),u.off("mousedown",this._addDragHandler),u.off("touchstart",this._addDragHandler),u.off("mouseup",this._onUp),u.off("touchend",this._onUp),u.off("mousemove",this._onMove),u.off("touchmove",this._onMove),u.off("remove",this._clearFadeTimer),u._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(u){return this._lngLat=g.LngLat.convert(u),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(u){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),u){if(!("offset"in u.options)){const M=Math.sqrt(Math.pow(13.5,2)/2);u.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[M,-1*(24.6+M)],"bottom-right":[-M,-1*(24.6+M)],left:[13.5,-24.6],right:[-13.5,-24.6]}:this._offset}this._popup=u,u._marker=this,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(u){const p=u.code,x=u.charCode||u.keyCode;"Space"!==p&&"Enter"!==p&&32!==x&&13!==x||this.togglePopup()}_onMapClick(u){const p=u.originalEvent.target,x=this._element;this._popup&&(p===x||x.contains(p))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const u=this._popup;return u?(u.isOpen()?(u.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(u.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const u=this._map,p=this._pos;if(!u||!p)return!1;const x=u.unproject(p),M=u.getFreeCameraOptions();if(!M.position)return!1;const E=M.position.toLngLat();return E.distanceTo(x)<.9*E.distanceTo(this._lngLat)}_evaluateOpacity(){const u=this._map;if(!u)return;const p=this._pos;if(!p||p.x<0||p.x>u.transform.width||p.y<0||p.y>u.transform.height)return void this._clearFadeTimer();const x=u.unproject(p);let M;u._showingGlobe()&&g.isLngLatBehindGlobe(u.transform,this._lngLat)?M=0:(M=1-u._queryFogOpacity(x),u.transform._terrainEnabled()&&u.getTerrain()&&this._behindTerrain()&&(M*=this._occludedOpacity)),this._element.style.opacity=`${M}`,this._element.style.pointerEvents=M>0?"auto":"none",this._popup&&this._popup._setOpacity(M),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const u=this._pos;if(!u||!this._map)return;const p=this._offset.mult(this._scale);this._element.style.transform=`\n            translate(${u.x}px,${u.y}px)\n            ${Od[this._anchor]}\n            ${this._calculateXYTransform()} ${this._calculateZTransform()}\n            translate(${p.x}px,${p.y}px)\n        `}_calculateXYTransform(){const u=this._pos,p=this._map,x=this.getPitchAlignment();if(!p||!u||"map"!==x)return"";if(!p._showingGlobe()){const N=p.getPitch();return N?`rotateX(${N}deg)`:""}const M=g.radToDeg(g.globeTiltAtLngLat(p.transform,this._lngLat)),E=u.sub(g.globeCenterToScreenPoint(p.transform)),P=Math.abs(E.x)+Math.abs(E.y);if(0===P)return"";const O=M/P;return`rotateX(${-E.y*O}deg) rotateY(${E.x*O}deg)`}_calculateZTransform(){const u=this._pos,p=this._map;if(!p||!u)return"";let x=0;const M=this.getRotationAlignment();if("map"===M)if(p._showingGlobe()){const E=p.project(new g.LngLat(this._lngLat.lng,this._lngLat.lat+.001)),P=p.project(new g.LngLat(this._lngLat.lng,this._lngLat.lat-.001)).sub(E);x=g.radToDeg(Math.atan2(P.y,P.x))-90}else x=-p.getBearing();else if("horizon"===M){const E=g.smoothstep(4,6,p.getZoom()),P=g.globeCenterToScreenPoint(p.transform);P.y+=E*p.transform.height;const O=u.sub(P),N=g.radToDeg(Math.atan2(O.y,O.x));x=(N>90?N-270:N+90)*(1-E)}return x+=this._rotation,x?`rotateZ(${x}deg)`:""}_update(u){g.window.cancelAnimationFrame(this._updateFrameId);const p=this._map;p&&(p.transform.renderWorldCopies&&(this._lngLat=Ld(this._lngLat,this._pos,p.transform)),this._pos=p.project(this._lngLat),!0===u?this._updateFrameId=g.window.requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),p._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(p._showingGlobe()||p.getTerrain()||p.getFog())&&!this._fadeTimer&&(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(u){return this._offset=g.pointGeometry.convert(u),this._update(),this}_onMove(u){const p=this._map;if(!p)return;const x=this._pointerdownPos,M=this._positionDelta;if(x&&M){if(!this._isDragging){const E=this._clickTolerance||p._clickTolerance;if(u.point.dist(x)<E)return;this._isDragging=!0}this._pos=u.point.sub(M),this._lngLat=p.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none","pending"===this._state&&(this._state="active",this.fire(new g.Event("dragstart"))),this.fire(new g.Event("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const u=this._map;u&&(u.off("mousemove",this._onMove),u.off("touchmove",this._onMove)),"active"===this._state&&this.fire(new g.Event("dragend")),this._state="inactive"}_addDragHandler(u){const p=this._map,x=this._pos;p&&x&&this._element.contains(u.originalEvent.target)&&(u.preventDefault(),this._positionDelta=u.point.sub(x),this._pointerdownPos=u.point,this._state="pending",p.on("mousemove",this._onMove),p.on("touchmove",this._onMove),p.once("mouseup",this._onUp),p.once("touchend",this._onUp))}setDraggable(u){this._draggable=!!u;const p=this._map;return p&&(u?(p.on("mousedown",this._addDragHandler),p.on("touchstart",this._addDragHandler)):(p.off("mousedown",this._addDragHandler),p.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(u){return this._rotation=u||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(u){return this._rotationAlignment=u||"auto",this._update(),this}getRotationAlignment(){return"auto"===this._rotationAlignment||"horizon"===this._rotationAlignment&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(u){return this._pitchAlignment=u||"auto",this._update(),this}getPitchAlignment(){return"auto"===this._pitchAlignment?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(u){return this._occludedOpacity=u||.2,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const Gm={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},af=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function lf(_=new g.pointGeometry(0,0),u="bottom"){if("number"==typeof _){const p=Math.round(Math.sqrt(.5*Math.pow(_,2)));switch(u){case"top":return new g.pointGeometry(0,_);case"top-left":return new g.pointGeometry(p,p);case"top-right":return new g.pointGeometry(-p,p);case"bottom":return new g.pointGeometry(0,-_);case"bottom-left":return new g.pointGeometry(p,-p);case"bottom-right":return new g.pointGeometry(-p,-p);case"left":return new g.pointGeometry(_,0);case"right":return new g.pointGeometry(-_,0)}return new g.pointGeometry(0,0)}return _ instanceof g.pointGeometry||Array.isArray(_)?g.pointGeometry.convert(_):g.pointGeometry.convert(_[u]||[0,0])}class jm{constructor(u){this.jumpTo(u)}getValue(u){if(u<=this._startTime)return this._start;if(u>=this._endTime)return this._end;const p=g.easeCubicInOut((u-this._startTime)/(this._endTime-this._startTime));return this._start*(1-p)+this._end*p}isEasing(u){return u>=this._startTime&&u<=this._endTime}jumpTo(u){this._startTime=-1/0,this._endTime=-1/0,this._start=u,this._end=u}easeTo(u,p,x){this._start=this.getValue(p),this._end=u,this._startTime=p,this._endTime=p+x}}const $m={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use \u2318 + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"},cf={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,optimizeForTerrain:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,crossSourceCollisions:!0};function Fd(_){_.parentNode&&_.parentNode.removeChild(_)}const Y_={showCompass:!0,showZoom:!0,visualizePitch:!1};class K_{constructor(u,p,x=!1){this._clickTolerance=10,this.element=p,this.mouseRotate=new j_({clickTolerance:u.dragRotate._mouseRotate._clickTolerance}),this.map=u,x&&(this.mousePitch=new Hu({clickTolerance:u.dragRotate._mousePitch._clickTolerance})),g.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),p.addEventListener("mousedown",this.mousedown),p.addEventListener("touchstart",this.touchstart,{passive:!1}),p.addEventListener("touchmove",this.touchmove),p.addEventListener("touchend",this.touchend),p.addEventListener("touchcancel",this.reset)}down(u,p){this.mouseRotate.mousedown(u,p),this.mousePitch&&this.mousePitch.mousedown(u,p),ph()}move(u,p){const x=this.map,M=this.mouseRotate.mousemoveWindow(u,p),E=M&&M.bearingDelta;if(E&&x.setBearing(x.getBearing()+E),this.mousePitch){const P=this.mousePitch.mousemoveWindow(u,p),O=P&&P.pitchDelta;O&&x.setPitch(x.getPitch()+O)}}off(){const u=this.element;u.removeEventListener("mousedown",this.mousedown),u.removeEventListener("touchstart",this.touchstart,{passive:!1}),u.removeEventListener("touchmove",this.touchmove),u.removeEventListener("touchend",this.touchend),u.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){Il(),g.window.removeEventListener("mousemove",this.mousemove),g.window.removeEventListener("mouseup",this.mouseup)}mousedown(u){this.down(g.extend({},u,{ctrlKey:!0,preventDefault:()=>u.preventDefault()}),Ht(this.element,u)),g.window.addEventListener("mousemove",this.mousemove),g.window.addEventListener("mouseup",this.mouseup)}mousemove(u){this.move(u,Ht(this.element,u))}mouseup(u){this.mouseRotate.mouseupWindow(u),this.mousePitch&&this.mousePitch.mouseupWindow(u),this.offTemp()}touchstart(u){1!==u.targetTouches.length?this.reset():(this._startPos=this._lastPos=Pa(this.element,u.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>u.preventDefault()},this._startPos))}touchmove(u){1!==u.targetTouches.length?this.reset():(this._lastPos=Pa(this.element,u.targetTouches)[0],this.move({preventDefault:()=>u.preventDefault()},this._lastPos))}touchend(u){0===u.targetTouches.length&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}const fo={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},Bl={maxWidth:100,unit:"metric"};function ts(_,u,p){const x=Uh(u),M=x/u,E={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"}[p];this._map._requestDomTask(()=>{this._container.style.width=_*M+"px",this._container.innerHTML=`${x}&nbsp;${E}`})}function Uh(_){const u=Math.pow(10,`${Math.floor(_)}`.length-1);let p=_/u;return p=p>=10?10:p>=5?5:p>=3?3:p>=2?2:p>=1?1:function(x){const M=Math.pow(10,Math.ceil(-Math.log(x)/Math.LN10));return Math.round(x*M)/M}(p),u*p}const Hh={version:g.version,supported:Al,setRTLTextPlugin:g.setRTLTextPlugin,getRTLTextPluginStatus:g.getRTLTextPluginStatus,Map:class extends X_{constructor(_){if(g.LivePerformanceUtils.mark(g.PerformanceMarkers.create),null!=(_=g.extend({},cf,_)).minZoom&&null!=_.maxZoom&&_.minZoom>_.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(null!=_.minPitch&&null!=_.maxPitch&&_.minPitch>_.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(null!=_.minPitch&&_.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(null!=_.maxPitch&&_.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(_.antialias&&g.isSafariWithAntialiasingBug(g.window)&&(_.antialias=!1,g.warnOnce("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new Oo(_.minZoom,_.maxZoom,_.minPitch,_.maxPitch,_.renderWorldCopies),_),this._interactive=_.interactive,this._minTileCacheSize=_.minTileCacheSize,this._maxTileCacheSize=_.maxTileCacheSize,this._failIfMajorPerformanceCaveat=_.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=_.preserveDrawingBuffer,this._antialias=_.antialias,this._trackResize=_.trackResize,this._bearingSnap=_.bearingSnap,this._refreshExpiredTiles=_.refreshExpiredTiles,this._fadeDuration=_.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=_.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=_.collectResourceTiming,this._optimizeForTerrain=_.optimizeForTerrain,this._language=this._parseLanguage(_.language),this._worldview=_.worldview,this._renderTaskQueue=new kd,this._domRenderTaskQueue=new kd,this._controls=[],this._markers=[],this._popups=[],this._mapId=g.uniqueId(),this._locale=g.extend({},$m,_.locale),this._clickTolerance=_.clickTolerance,this._cooperativeGestures=_.cooperativeGestures,this._performanceMetricsCollection=_.performanceMetricsCollection,this._containerWidth=0,this._containerHeight=0,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new jm(0),this._interactionRange=[1/0,-1/0],this._useExplicitProjection=!1,this._requestManager=new g.RequestManager(_.transformRequest,_.accessToken,_.testMode),this._silenceAuthErrors=!!_.testMode,"string"==typeof _.container){if(this._container=g.window.document.getElementById(_.container),!this._container)throw new Error(`Container '${_.container}' not found.`)}else{if(!(_.container instanceof g.window.HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=_.container}if(this._container.childNodes.length>0&&g.warnOnce("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),_.maxBounds&&this.setMaxBounds(_.maxBounds),g.bindAll(["_onWindowOnline","_onWindowResize","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),void 0===this.painter)throw new Error("Failed to initialize WebGL.");this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),void 0!==g.window&&(g.window.addEventListener("online",this._onWindowOnline,!1),g.window.addEventListener("resize",this._onWindowResize,!1),g.window.addEventListener("orientationchange",this._onWindowResize,!1),g.window.addEventListener("webkitfullscreenchange",this._onWindowResize,!1)),this.handlers=new Z_(this,_),this._localFontFamily=_.localFontFamily,this._localIdeographFontFamily=_.localIdeographFontFamily,_.style&&this.setStyle(_.style,{localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),_.projection&&this.setProjection(_.projection),this._hash=_.hash&&new ga("string"==typeof _.hash&&_.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:_.center,zoom:_.zoom,bearing:_.bearing,pitch:_.pitch}),_.bounds&&(this.resize(),this.fitBounds(_.bounds,g.extend({},_.fitBoundsOptions,{duration:0})))),this.resize(),_.attributionControl&&this.addControl(new Hm({customAttribution:_.customAttribution})),this._logoControl=new ju,this.addControl(this._logoControl,_.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",u=>{this._update("style"===u.dataType),this.fire(new g.Event(`${u.dataType}data`,u))}),this.on("dataloading",u=>{this.fire(new g.Event(`${u.dataType}dataloading`,u))})}_getMapId(){return this._mapId}addControl(_,u){if(void 0===u&&(u=_.getDefaultPosition?_.getDefaultPosition():"top-right"),!_||!_.onAdd)return this.fire(new g.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const p=_.onAdd(this);this._controls.push(_);const x=this._controlPositions[u];return-1!==u.indexOf("bottom")?x.insertBefore(p,x.firstChild):x.appendChild(p),this}removeControl(_){if(!_||!_.onRemove)return this.fire(new g.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const u=this._controls.indexOf(_);return u>-1&&this._controls.splice(u,1),_.onRemove(this),this}hasControl(_){return this._controls.indexOf(_)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(_){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const u=!this._moving;return u&&this.fire(new g.Event("movestart",_)).fire(new g.Event("move",_)),this.fire(new g.Event("resize",_)),u&&this.fire(new g.Event("moveend",_)),this}getBounds(){return"globe"===this.transform.projection.name&&g.warnOnce('Globe projection does not support getBounds API, this API may behave unexpectedly when viewing the poles."'),this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(_){return this.transform.setMaxBounds(g.LngLatBounds.convert(_)),this._update()}setMinZoom(_){if((_=_??-2)>=-2&&_<=this.transform.maxZoom)return this.transform.minZoom=_,this._update(),this.getZoom()<_?this.setZoom(_):this.fire(new g.Event("zoomstart")).fire(new g.Event("zoom")).fire(new g.Event("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(_){if((_=_??22)>=this.transform.minZoom)return this.transform.maxZoom=_,this._update(),this.getZoom()>_?this.setZoom(_):this.fire(new g.Event("zoomstart")).fire(new g.Event("zoom")).fire(new g.Event("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(_){if((_=_??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(_>=0&&_<=this.transform.maxPitch)return this.transform.minPitch=_,this._update(),this.getPitch()<_?this.setPitch(_):this.fire(new g.Event("pitchstart")).fire(new g.Event("pitch")).fire(new g.Event("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(_){if((_=_??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(_>=this.transform.minPitch)return this.transform.maxPitch=_,this._update(),this.getPitch()>_?this.setPitch(_):this.fire(new g.Event("pitchstart")).fire(new g.Event("pitch")).fire(new g.Event("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(_){return this.transform.renderWorldCopies=_,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(_){return"auto"===_?g.window.navigator.language:Array.isArray(_)?0===_.length?void 0:_.map(u=>"auto"===u?g.window.navigator.language:u):_}setLanguage(_){const u=this._parseLanguage(_);if(!this.style||u===this._language)return this;this._language=u,this.style._reloadSources();for(const p of this._controls)p._setLanguage&&p._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(_){return this.style&&_!==this._worldview?(this._worldview=_,this.style._reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return"globe"===this.transform.projection.name}setProjection(_){return this._lazyInitEmptyStyle(),_?"string"==typeof _&&(_={name:_}):_=null,this._useExplicitProjection=!!_,this._prioritizeAndUpdateProjection(_,this.style.stylesheet?this.style.stylesheet.projection:null)}_updateProjectionTransition(){if("globe"!==this.getProjection().name)return;const _=this.transform,u=_.projection.name;let p;"globe"===u&&_.zoom>=g.GLOBE_ZOOM_THRESHOLD_MAX?(_.setMercatorFromTransition(),p=!0):"mercator"===u&&_.zoom<g.GLOBE_ZOOM_THRESHOLD_MAX&&(_.setProjection({name:"globe"}),p=!0),p&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(_,u){return this._updateProjection(_||u||{name:"mercator"})}_updateProjection(_){let u;if(u="globe"===_.name&&this.transform.zoom>=g.GLOBE_ZOOM_THRESHOLD_MAX?this.transform.setMercatorFromTransition():this.transform.setProjection(_),this.style.applyProjectionUpdate(),u){this.painter.clearBackgroundTiles();for(const p in this.style._sourceCaches)this.style._sourceCaches[p].clearTiles();this._update(!0),this._forceMarkerAndPopupUpdate(!0)}return this}project(_){return this.transform.locationPoint3D(g.LngLat.convert(_))}unproject(_){return this.transform.pointLocation3D(g.pointGeometry.convert(_))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_createDelegatedListener(_,u,p){if("mouseenter"===_||"mouseover"===_){let x=!1;const M=P=>{const O=u.filter(U=>this.getLayer(U)),N=O.length?this.queryRenderedFeatures(P.point,{layers:O}):[];N.length?x||(x=!0,p.call(this,new Zr(_,this,P.originalEvent,{features:N}))):x=!1},E=()=>{x=!1};return{layers:new Set(u),listener:p,delegates:{mousemove:M,mouseout:E}}}if("mouseleave"===_||"mouseout"===_){let x=!1;const M=P=>{const O=u.filter(N=>this.getLayer(N));(O.length?this.queryRenderedFeatures(P.point,{layers:O}):[]).length?x=!0:x&&(x=!1,p.call(this,new Zr(_,this,P.originalEvent)))},E=P=>{x&&(x=!1,p.call(this,new Zr(_,this,P.originalEvent)))};return{layers:new Set(u),listener:p,delegates:{mousemove:M,mouseout:E}}}{const x=M=>{const E=u.filter(O=>this.getLayer(O)),P=E.length?this.queryRenderedFeatures(M.point,{layers:E}):[];P.length&&(M.features=P,p.call(this,M),delete M.features)};return{layers:new Set(u),listener:p,delegates:{[_]:x}}}}on(_,u,p){if(void 0===p)return super.on(_,u);Array.isArray(u)||(u=[u]);const x=this._createDelegatedListener(_,u,p);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[_]=this._delegatedListeners[_]||[],this._delegatedListeners[_].push(x);for(const M in x.delegates)this.on(M,x.delegates[M]);return this}once(_,u,p){if(void 0===p)return super.once(_,u);Array.isArray(u)||(u=[u]);const x=this._createDelegatedListener(_,u,p);for(const M in x.delegates)this.once(M,x.delegates[M]);return this}off(_,u,p){if(void 0===p)return super.off(_,u);u=new Set(Array.isArray(u)?u:[u]);const x=(E,P)=>{if(E.size!==P.size)return!1;for(const O of E)if(!P.has(O))return!1;return!0},M=this._delegatedListeners?this._delegatedListeners[_]:void 0;return M&&(E=>{for(let P=0;P<E.length;P++){const O=E[P];if(O.listener===p&&x(O.layers,u)){for(const N in O.delegates)this.off(N,O.delegates[N]);return E.splice(P,1),this}}})(M),this}queryRenderedFeatures(_,u){return this.style?(void 0!==u||void 0===_||_ instanceof g.pointGeometry||Array.isArray(_)||(u=_,_=void 0),this.style.queryRenderedFeatures(_=_||[[0,0],[this.transform.width,this.transform.height]],u=u||{},this.transform)):[]}querySourceFeatures(_,u){return this.style.querySourceFeatures(_,u)}setStyle(_,u){return!1!==(u=g.extend({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},u)).diff&&u.localIdeographFontFamily===this._localIdeographFontFamily&&u.localFontFamily===this._localFontFamily&&this.style&&_?(this._diffStyle(_,u),this):(this._localIdeographFontFamily=u.localIdeographFontFamily,this._localFontFamily=u.localFontFamily,this._updateStyle(_,u))}_getUIString(_){const u=this._locale[_];if(null==u)throw new Error(`Missing UI string '${_}'`);return u}_updateStyle(_,u){return this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),_&&(this.style=new gs(this,u||{}),this.style.setEventedParent(this,{style:this.style}),"string"==typeof _?this.style.loadURL(_):this.style.loadJSON(_)),this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new gs(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(_,u){if("string"==typeof _){const p=this._requestManager.normalizeStyleURL(_),x=this._requestManager.transformRequest(p,g.ResourceType.Style);g.getJSON(x,(M,E)=>{M?this.fire(new g.ErrorEvent(M)):E&&this._updateDiff(E,u)})}else"object"==typeof _&&this._updateDiff(_,u)}_updateDiff(_,u){try{this.style.setState(_)&&this._update(!0)}catch(p){g.warnOnce(`Unable to perform style diff: ${p.message||p.error||p}.  Rebuilding the style from scratch.`),this._updateStyle(_,u)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(g.warnOnce("There is no style added to the map."),!1)}addSource(_,u){return this._lazyInitEmptyStyle(),this.style.addSource(_,u),this._update(!0)}isSourceLoaded(_){return!!this.style&&this.style._isSourceCacheLoaded(_)}areTilesLoaded(){const _=this.style&&this.style._sourceCaches;for(const u in _){const p=_[u]._tiles;for(const x in p){const M=p[x];if("loaded"!==M.state&&"errored"!==M.state)return!1}}return!0}addSourceType(_,u,p){this._lazyInitEmptyStyle(),this.style.addSourceType(_,u,p)}removeSource(_){return this.style.removeSource(_),this._updateTerrain(),this._update(!0)}getSource(_){return this.style.getSource(_)}addImage(_,u,{pixelRatio:p=1,sdf:x=!1,stretchX:M,stretchY:E,content:P}={}){if(this._lazyInitEmptyStyle(),u instanceof g.window.HTMLImageElement||g.window.ImageBitmap&&u instanceof g.window.ImageBitmap){const{width:O,height:N,data:U}=g.exported.getImageData(u);this.style.addImage(_,{data:new g.RGBAImage({width:O,height:N},U),pixelRatio:p,stretchX:M,stretchY:E,content:P,sdf:x,version:0})}else if(void 0===u.width||void 0===u.height)this.fire(new g.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:O,height:N}=u,U=u;this.style.addImage(_,{data:new g.RGBAImage({width:O,height:N},new Uint8Array(U.data)),pixelRatio:p,stretchX:M,stretchY:E,content:P,sdf:x,version:0,userImage:U}),U.onAdd&&U.onAdd(this,_)}}updateImage(_,u){const p=this.style.getImage(_);if(!p)return void this.fire(new g.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const x=u instanceof g.window.HTMLImageElement||g.window.ImageBitmap&&u instanceof g.window.ImageBitmap?g.exported.getImageData(u):u,{width:M,height:E}=x;void 0!==M&&void 0!==E?M===p.data.width&&E===p.data.height?(p.data.replace(x.data,!(u instanceof g.window.HTMLImageElement||g.window.ImageBitmap&&u instanceof g.window.ImageBitmap)),this.style.updateImage(_,p)):this.fire(new g.ErrorEvent(new Error(`The width and height of the updated image (${M}, ${E})\n                must be that same as the previous version of the image\n                (${p.data.width}, ${p.data.height})`))):this.fire(new g.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")))}hasImage(_){return _?!!this.style.getImage(_):(this.fire(new g.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(_){this.style.removeImage(_)}loadImage(_,u){g.getImage(this._requestManager.transformRequest(_,g.ResourceType.Image),(p,x)=>{u(p,x instanceof g.window.HTMLImageElement?g.exported.getImageData(x):x)})}listImages(){return this.style.listImages()}addLayer(_,u){return this._lazyInitEmptyStyle(),this.style.addLayer(_,u),this._update(!0)}moveLayer(_,u){return this.style.moveLayer(_,u),this._update(!0)}removeLayer(_){return this.style.removeLayer(_),this._update(!0)}getLayer(_){return this.style.getLayer(_)}setLayerZoomRange(_,u,p){return this.style.setLayerZoomRange(_,u,p),this._update(!0)}setFilter(_,u,p={}){return this.style.setFilter(_,u,p),this._update(!0)}getFilter(_){return this.style.getFilter(_)}setPaintProperty(_,u,p,x={}){return this.style.setPaintProperty(_,u,p,x),this._update(!0)}getPaintProperty(_,u){return this.style.getPaintProperty(_,u)}setLayoutProperty(_,u,p,x={}){return this.style.setLayoutProperty(_,u,p,x),this._update(!0)}getLayoutProperty(_,u){return this.style.getLayoutProperty(_,u)}setLight(_,u={}){return this._lazyInitEmptyStyle(),this.style.setLight(_,u),this._update(!0)}getLight(){return this.style.getLight()}setTerrain(_){return this._lazyInitEmptyStyle(),!_&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(_),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(_){return this._lazyInitEmptyStyle(),this.style.setFog(_),this._update(!0)}getFog(){return this.style?this.style.getFog():null}_queryFogOpacity(_){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(g.LngLat.convert(_),this.transform):0}setFeatureState(_,u){return this.style.setFeatureState(_,u),this._update()}removeFeatureState(_,u){return this.style.removeFeatureState(_,u),this._update()}getFeatureState(_){return this.style.getFeatureState(_)}_updateContainerDimensions(){if(!this._container)return;const _=this._container.getBoundingClientRect().width||400,u=this._container.getBoundingClientRect().height||300;let p,x,M,E=this._container;for(;E&&(!x||!M);){const P=g.window.getComputedStyle(E).transform;P&&"none"!==P&&(p=P.match(/matrix.*\((.+)\)/)[1].split(", "),p[0]&&"0"!==p[0]&&"1"!==p[0]&&(x=p[0]),p[3]&&"0"!==p[3]&&"1"!==p[3]&&(M=p[3])),E=E.parentElement}this._containerWidth=x?Math.abs(_/x):_,this._containerHeight=M?Math.abs(u/M):u}_detectMissingCSS(){"rgb(250, 128, 114)"!==g.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")&&g.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const _=this._container;_.classList.add("mapboxgl-map"),(this._missingCSSCanary=mi("div","mapboxgl-canary",_)).style.visibility="hidden",this._detectMissingCSS();const u=this._canvasContainer=mi("div","mapboxgl-canvas-container",_);this._interactive&&u.classList.add("mapboxgl-interactive"),this._canvas=mi("canvas","mapboxgl-canvas",u),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const p=this._controlContainer=mi("div","mapboxgl-control-container",_),x=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(M=>{x[M]=mi("div",`mapboxgl-ctrl-${M}`,p)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(_,u){const p=g.exported.devicePixelRatio||1;this._canvas.width=p*Math.ceil(_),this._canvas.height=p*Math.ceil(u),this._canvas.style.width=`${_}px`,this._canvas.style.height=`${u}px`}_addMarker(_){this._markers.push(_)}_removeMarker(_){const u=this._markers.indexOf(_);-1!==u&&this._markers.splice(u,1)}_addPopup(_){this._popups.push(_)}_removePopup(_){const u=this._popups.indexOf(_);-1!==u&&this._popups.splice(u,1)}_setupPainter(){const _=g.extend({},Al.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),u=this._canvas.getContext("webgl",_)||this._canvas.getContext("experimental-webgl",_);u?(g.storeAuthState(u,!0),this.painter=new Lm(u,this.transform),this.on("data",p=>{"source"===p.dataType&&this.painter.setTileLoadedFlag(!0)}),g.exported$1.testSupport(u)):this.fire(new g.ErrorEvent(new Error("Failed to initialize WebGL")))}_contextLost(_){_.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new g.Event("webglcontextlost",{originalEvent:_}))}_contextRestored(_){this._setupPainter(),this.resize(),this._update(),this.fire(new g.Event("webglcontextrestored",{originalEvent:_}))}_onMapScroll(_){if(_.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(_){return this.style?(this._styleDirty=this._styleDirty||_,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(_){return this._update(),this._renderTaskQueue.add(_)}_cancelRenderFrame(_){this._renderTaskQueue.remove(_)}_requestDomTask(_){!this.loaded()||this.loaded()&&!this.isMoving()?_():this._domRenderTaskQueue.add(_)}_render(_){let u;const p=this.painter.context.extTimerQuery,x=g.exported.now();if(this.listens("gpu-timing-frame")&&(u=p.createQueryEXT(),p.beginQueryEXT(p.TIME_ELAPSED_EXT,u)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],g.window.performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],g.window.performance.now())),this._renderTaskQueue.run(_),this._domRenderTaskQueue.run(_),this._removed)return;this._updateProjectionTransition();let M=!1;const E=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const N=this.transform.zoom,U=this.transform.pitch,H=g.exported.now();this.style.zoomHistory.update(N,H);const Z=new g.EvaluationParameters(N,{now:H,fadeDuration:E,pitch:U,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),Q=Z.crossFadingFactor();1===Q&&Q===this._crossFadingFactor||(M=!0,this._crossFadingFactor=Q),this.style.update(Z)}this.style&&this.style.fog&&this.style.fog.hasTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let P=!1;if(this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),P=this._updateAverageElevation(x),this.style._updateSources(this.transform),this._forceMarkerAndPopupUpdate()):P=this._updateAverageElevation(x),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,E,this._crossSourceCollisions),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showTerrainWireframe:this.showTerrainWireframe,showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:E,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new g.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new g.Event("load"))),this.style&&(this.style.hasTransitions()||M)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),u){const N=g.exported.now()-x;p.endQueryEXT(p.TIME_ELAPSED_EXT,u),setTimeout(()=>{const U=p.getQueryObjectEXT(u,p.QUERY_RESULT_EXT)/1e6;p.deleteQueryEXT(u),this.fire(new g.Event("gpu-timing-frame",{cpuTime:N,gpuTime:U})),g.window.performance.mark("frame-gpu",{startTime:x,detail:{gpuTime:U}})},50)}if(this.listens("gpu-timing-layer")){const N=this.painter.collectGpuTimers();setTimeout(()=>{const U=this.painter.queryGpuTimers(N);this.fire(new g.Event("gpu-timing-layer",{layerTimes:U}))},50)}if(this.listens("gpu-timing-deferred-render")){const N=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const U=this.painter.queryGpuTimeDeferredRender(N);this.fire(new g.Event("gpu-timing-deferred-render",{gpuTime:U}))},50)}const O=this._sourcesDirty||this._styleDirty||this._placementDirty||P;if(O||this._repaint)this.triggerRepaint();else{const N=!this.isMoving()&&this.loaded();if(N&&(P=this._updateAverageElevation(x,!0)),P)this.triggerRepaint();else if(this._triggerFrame(!1),N&&(this.fire(new g.Event("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const U=this._calculateSpeedIndex();this.fire(new g.Event("speedindexcompleted",{speedIndex:U})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||O||(this._fullyLoaded=!0,g.LivePerformanceUtils.mark(g.PerformanceMarkers.fullLoad),this._performanceMetricsCollection&&g.postPerformanceEvent(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.painter.transform.projection,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(_){for(const u of this._markers)_&&!this.getRenderWorldCopies()&&(u._lngLat=u._lngLat.wrap()),u._update();for(const u of this._popups)!_||this.getRenderWorldCopies()||u._trackPointer||(u._lngLat=u._lngLat.wrap()),u._update()}_updateAverageElevation(_,u=!1){const p=x=>(this.transform.averageElevation=x,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return 0!==this.transform.averageElevation&&p(0);if((u||_-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(_)){const x=this.transform.averageElevation;let M=this.transform.sampleAverageElevation(),E=!1;this.transform.elevation&&(E=this.transform.elevation.exaggeration()!==this._averageElevationExaggeration,this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(M)?M=0:this._averageElevationLastSampledAt=_;const P=Math.abs(x-M);if(P>1){if(this._isInitialLoad||E)return this._averageElevation.jumpTo(M),p(M);this._averageElevation.easeTo(M,_,300)}else if(P>1e-4)return this._averageElevation.jumpTo(M),p(M)}return!!this._averageElevation.isEasing(_)&&p(this._averageElevation.getValue(_))}_authenticate(){g.getMapSessionAPI(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,_=>{if(_&&(_.message===g.AUTH_ERR_MSG||401===_.status)){const u=this.painter.context.gl;g.storeAuthState(u,!1),this._logoControl instanceof ju&&this._logoControl._updateLogo(),u&&u.clear(u.DEPTH_BUFFER_BIT|u.COLOR_BUFFER_BIT|u.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new g.ErrorEvent(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),g.postMapLoadEvent(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_updateTerrain(){this.painter.updateTerrain(this.style,this.isMoving()||this.isRotating()||this.isZooming())}_calculateSpeedIndex(){const _=this.painter.canvasCopy(),u=this.painter.getCanvasCopiesAndTimestamps();u.timeStamps.push(performance.now());const p=this.painter.context.gl,x=p.createFramebuffer();function M(E){p.framebufferTexture2D(p.FRAMEBUFFER,p.COLOR_ATTACHMENT0,p.TEXTURE_2D,E,0);const P=new Uint8Array(p.drawingBufferWidth*p.drawingBufferHeight*4);return p.readPixels(0,0,p.drawingBufferWidth,p.drawingBufferHeight,p.RGBA,p.UNSIGNED_BYTE,P),P}return p.bindFramebuffer(p.FRAMEBUFFER,x),this._canvasPixelComparison(M(_),u.canvasCopies.map(M),u.timeStamps)}_canvasPixelComparison(_,u,p){let x=p[1]-p[0];const M=_.length/4;for(let E=0;E<u.length;E++){const P=u[E];let O=0;for(let N=0;N<P.length;N+=4)P[N]===_[N]&&P[N+1]===_[N+1]&&P[N+2]===_[N+2]&&P[N+3]===_[N+3]&&(O+=1);x+=(p[E+2]-p[E+1])*(1-O/M)}return x}remove(){this._hash&&this._hash.remove();for(const u of this._controls)u.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),void 0!==g.window&&(g.window.removeEventListener("resize",this._onWindowResize,!1),g.window.removeEventListener("orientationchange",this._onWindowResize,!1),g.window.removeEventListener("webkitfullscreenchange",this._onWindowResize,!1),g.window.removeEventListener("online",this._onWindowOnline,!1));const _=this.painter.context.gl.getExtension("WEBGL_lose_context");_&&_.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),Fd(this._canvasContainer),Fd(this._controlContainer),Fd(this._missingCSSCanary),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),g.removeAuthState(this.painter.context.gl),this._removed=!0,this.fire(new g.Event("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(_){this._renderNextFrame=this._renderNextFrame||_,this.style&&!this._frame&&(this._frame=g.exported.frame(u=>{const p=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,p&&this._render(u)}))}_preloadTiles(_){const u=this.style?Object.values(this.style._sourceCaches):[];return g.asyncAll(u,(p,x)=>p._preloadTiles(_,x),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(_){this._trackResize&&this.resize({originalEvent:_})._update()}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(_){this._showTileBoundaries!==_&&(this._showTileBoundaries=_,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(_){this._showTerrainWireframe!==_&&(this._showTerrainWireframe=_,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(_){this._speedIndexTiming!==_&&(this._speedIndexTiming=_,this._update())}get showPadding(){return!!this._showPadding}set showPadding(_){this._showPadding!==_&&(this._showPadding=_,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(_){this._showCollisionBoxes!==_&&(this._showCollisionBoxes=_,_?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(_){this._showOverdrawInspector!==_&&(this._showOverdrawInspector=_,this._update())}get repaint(){return!!this._repaint}set repaint(_){this._repaint!==_&&(this._repaint=_,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(_){this._vertices=_,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(_){this._showTileAABBs!==_&&(this._showTileAABBs=_,_&&this._update())}_setCacheLimits(_,u){g.setCacheLimits(_,u)}get version(){return g.version}},NavigationControl:class{constructor(_){this.options=g.extend({},Y_,_),this._container=mi("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",u=>u.preventDefault()),this.options.showZoom&&(g.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",u=>{this._map&&this._map.zoomIn({},{originalEvent:u})}),mi("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",u=>{this._map&&this._map.zoomOut({},{originalEvent:u})}),mi("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(g.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",u=>{const p=this._map;p&&(this.options.visualizePitch?p.resetNorthPitch({},{originalEvent:u}):p.resetNorth({},{originalEvent:u}))}),this._compassIcon=mi("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const _=this._map;if(!_)return;const u=_.getZoom(),p=u===_.getMaxZoom(),x=u===_.getMinZoom();this._zoomInButton.disabled=p,this._zoomOutButton.disabled=x,this._zoomInButton.setAttribute("aria-disabled",p.toString()),this._zoomOutButton.setAttribute("aria-disabled",x.toString())}_rotateCompassArrow(){const _=this._map;if(!_)return;const u=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(_.transform.pitch*(Math.PI/180)),.5)}) rotateX(${_.transform.pitch}deg) rotateZ(${_.transform.angle*(180/Math.PI)}deg)`:`rotate(${_.transform.angle*(180/Math.PI)}deg)`;_._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=u)})}onAdd(_){return this._map=_,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),_.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&_.on("pitch",this._rotateCompassArrow),_.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new K_(_,this._compass,this.options.visualizePitch)),this._container}onRemove(){const _=this._map;_&&(this._container.remove(),this.options.showZoom&&_.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&_.off("pitch",this._rotateCompassArrow),_.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(_,u){const p=mi("button",_,this._container);return p.type="button",p.addEventListener("click",u),p}_setButtonTitle(_,u){if(!this._map)return;const p=this._map._getUIString(`NavigationControl.${u}`);_.setAttribute("aria-label",p),_.firstElementChild&&_.firstElementChild.setAttribute("title",p)}},GeolocateControl:class extends g.Evented{constructor(_){super(),this.options=g.extend({geolocation:g.window.navigator.geolocation},fo,_),g.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=Om(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(_){return this._map=_,this._container=mi("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){void 0!==this._geolocationWatchID&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(_){const u=(p=!!this.options.geolocation)=>{this._supportsGeolocation=p,_(p)};void 0!==this._supportsGeolocation?_(this._supportsGeolocation):void 0!==g.window.navigator.permissions?g.window.navigator.permissions.query({name:"geolocation"}).then(p=>u("denied"!==p.state)).catch(()=>u()):u()}_isOutOfMapMaxBounds(_){const u=this._map.getMaxBounds(),p=_.coords;return!!u&&(p.longitude<u.getWest()||p.longitude>u.getEast()||p.latitude<u.getSouth()||p.latitude>u.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(_){if(this._map){if(this._isOutOfMapMaxBounds(_))return this._setErrorState(),this.fire(new g.Event("outofmaxbounds",_)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=_,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&"OFF"!==this._watchState&&this._updateMarker(_),this.options.trackUserLocation&&"ACTIVE_LOCK"!==this._watchState||this._updateCamera(_),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new g.Event("geolocate",_)),this._finish()}}_updateCamera(_){const u=new g.LngLat(_.coords.longitude,_.coords.latitude),p=_.coords.accuracy,x=this._map.getBearing(),M=g.extend({bearing:x},this.options.fitBoundsOptions);this._map.fitBounds(u.toBounds(p),M,{geolocateSource:!0})}_updateMarker(_){if(_){const u=new g.LngLat(_.coords.longitude,_.coords.latitude);this._accuracyCircleMarker.setLngLat(u).addTo(this._map),this._userLocationDotMarker.setLngLat(u).addTo(this._map),this._accuracy=_.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const _=this._map.transform,u=g.mercatorZfromAltitude(1,_._center.lat)*_.worldSize,p=Math.ceil(2*this._accuracy*u);this._circleElement.style.width=`${p}px`,this._circleElement.style.height=`${p}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&"number"==typeof this._heading?(this._userLocationDotMarker.setRotation(this._heading),this._dotElement.classList.add("mapboxgl-user-location-show-heading")):(this._dotElement.classList.remove("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(_){if(this._map){if(this.options.trackUserLocation)if(1===_.code){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const u=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",u),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",u),void 0!==this._geolocationWatchID&&this._clearWatch()}else{if(3===_.code&&this._noTimeout)return;this._setErrorState()}"OFF"!==this._watchState&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new g.Event("error",_)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(_){if(this._container.addEventListener("contextmenu",u=>u.preventDefault()),this._geolocateButton=mi("button","mapboxgl-ctrl-geolocate",this._container),mi("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",!1===_){g.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");const u=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",u),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",u)}else{const u=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",u),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",u)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=mi("div","mapboxgl-user-location"),this._dotElement.appendChild(mi("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(mi("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new sf({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=mi("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new sf({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",u=>{u.geolocateSource||"ACTIVE_LOCK"!==this._watchState||u.originalEvent&&"resize"===u.originalEvent.type||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new g.Event("trackuserlocationend")))})}_onDeviceOrientation(_){this._userLocationDotMarker&&(_.webkitCompassHeading?this._heading=_.webkitCompassHeading:!0===_.absolute&&(this._heading=-1*_.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return g.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new g.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new g.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new g.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if("OFF"===this._watchState&&void 0!==this._geolocationWatchID)this._clearWatch();else if(void 0===this._geolocationWatchID){let _;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(_={maximumAge:6e5,timeout:0},this._noTimeout=!0):(_=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,_),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const _=()=>{g.window.addEventListener("ondeviceorientationabsolute"in g.window?"deviceorientationabsolute":"deviceorientation",this._onDeviceOrientation)};void 0!==g.window.DeviceMotionEvent&&"function"==typeof g.window.DeviceMotionEvent.requestPermission?DeviceOrientationEvent.requestPermission().then(u=>{"granted"===u&&_()}).catch(console.error):_()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),g.window.removeEventListener("deviceorientation",this._onDeviceOrientation),g.window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:Hm,ScaleControl:class{constructor(_){this.options=g.extend({},Bl,_),function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"narrow",unit:"meter"}),!0}catch{return!1}}()||(this._setScale=ts.bind(this)),g.bindAll(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const _=this.options.maxWidth||100,u=this._map,p=u._containerHeight/2,x=u._containerWidth/2-_/2,M=u.unproject([x,p]),E=u.unproject([x+_,p]),P=M.distanceTo(E);if("imperial"===this.options.unit){const O=3.2808*P;O>5280?this._setScale(_,O/5280,"mile"):this._setScale(_,O,"foot")}else"nautical"===this.options.unit?this._setScale(_,P/1852,"nautical-mile"):P>=1e3?this._setScale(_,P/1e3,"kilometer"):this._setScale(_,P,"meter")}_setScale(_,u,p){const x=Uh(u),M=x/u;this._map._requestDomTask(()=>{this._container.style.width=_*M+"px",this._container.innerHTML="nautical-mile"!==p?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"narrow",unit:p}).format(x):`${x}&nbsp;nm`})}onAdd(_){return this._map=_,this._language=_.getLanguage(),this._container=mi("div","mapboxgl-ctrl mapboxgl-ctrl-scale",_.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(_){this._language=_,this._update()}setUnit(_){this.options.unit=_,this._update()}},FullscreenControl:class{constructor(_){this._fullscreen=!1,_&&_.container&&(_.container instanceof g.window.HTMLElement?this._container=_.container:g.warnOnce("Full screen control 'container' must be a DOM element.")),g.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in g.window.document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in g.window.document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(_){return this._map=_,this._container||(this._container=this._map.getContainer()),this._controlContainer=mi("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",g.warnOnce("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,g.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!g.window.document.fullscreenEnabled&&!g.window.document.webkitFullscreenEnabled)}_setupUI(){const _=this._fullscreenButton=mi("button","mapboxgl-ctrl-fullscreen",this._controlContainer);mi("span","mapboxgl-ctrl-icon",_).setAttribute("aria-hidden","true"),_.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),g.window.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const _=this._getTitle();this._fullscreenButton.setAttribute("aria-label",_),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",_)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(g.window.document.fullscreenElement||g.window.document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?g.window.document.exitFullscreen?g.window.document.exitFullscreen():g.window.document.webkitCancelFullScreen&&g.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends g.Evented{constructor(_){super(),this.options=g.extend(Object.create(Gm),_),g.bindAll(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(_&&_.className?_.className.trim().split(/\s+/):[])}addTo(_){return this._map&&this.remove(),this._map=_,this.options.closeOnClick&&_.on("preclick",this._onClose),this.options.closeOnMove&&_.on("move",this._onClose),_.on("remove",this.remove),this._update(),_._addPopup(this),this._focusFirstElement(),this._trackPointer?(_.on("mousemove",this._onMouseEvent),_.on("mouseup",this._onMouseEvent),_._canvasContainer.classList.add("mapboxgl-track-pointer")):_.on("move",this._update),this.fire(new g.Event("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const _=this._map;return _&&(_.off("move",this._update),_.off("move",this._onClose),_.off("preclick",this._onClose),_.off("click",this._onClose),_.off("remove",this.remove),_.off("mousemove",this._onMouseEvent),_.off("mouseup",this._onMouseEvent),_.off("drag",this._onMouseEvent),_._canvasContainer&&_._canvasContainer.classList.remove("mapboxgl-track-pointer"),_._removePopup(this),this._map=void 0),this.fire(new g.Event("close")),this}getLngLat(){return this._lngLat}setLngLat(_){this._lngLat=g.LngLat.convert(_),this._pos=null,this._trackPointer=!1,this._update();const u=this._map;return u&&(u.on("move",this._update),u.off("mousemove",this._onMouseEvent),u._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const _=this._map;return _&&(_.off("move",this._update),_.on("mousemove",this._onMouseEvent),_.on("drag",this._onMouseEvent),_._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(_){return this.setDOMContent(g.window.document.createTextNode(_))}setHTML(_){const u=g.window.document.createDocumentFragment(),p=g.window.document.createElement("body");let x;for(p.innerHTML=_;x=p.firstChild,x;)u.appendChild(x);return this.setDOMContent(u)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(_){return this.options.maxWidth=_,this._update(),this}setDOMContent(_){let u=this._content;if(u)for(;u.hasChildNodes();)u.firstChild&&u.removeChild(u.firstChild);else u=this._content=mi("div","mapboxgl-popup-content",this._container||void 0);if(u.appendChild(_),this.options.closeButton){const p=this._closeButton=mi("button","mapboxgl-popup-close-button",u);p.type="button",p.setAttribute("aria-label","Close popup"),p.setAttribute("aria-hidden","true"),p.innerHTML="&#215;",p.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(_){return this._classList.add(_),this._updateClassList(),this}removeClassName(_){return this._classList.delete(_),this._updateClassList(),this}setOffset(_){return this.options.offset=_,this._update(),this}toggleClassName(_){let u;return this._classList.delete(_)?u=!1:(this._classList.add(_),u=!0),this._updateClassList(),u}_onMouseEvent(_){this._update(_.point)}_getAnchor(_){if(this.options.anchor)return this.options.anchor;const u=this._map,p=this._container,x=this._pos;if(!u||!p||!x)return"bottom";const M=p.offsetWidth,E=p.offsetHeight,P=x.x<M/2,O=x.x>u.transform.width-M/2;if(x.y+_<E)return P?"top-left":O?"top-right":"top";if(x.y>u.transform.height-E){if(P)return"bottom-left";if(O)return"bottom-right"}return P?"left":O?"right":"bottom"}_updateClassList(){const _=this._container;if(!_)return;const u=[...this._classList];u.push("mapboxgl-popup"),this._anchor&&u.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&u.push("mapboxgl-popup-track-pointer"),_.className=u.join(" ")}_update(_){const u=this._map,p=this._content;if(!u||!this._lngLat&&!this._trackPointer||!p)return;let x=this._container;if(x||(x=this._container=mi("div","mapboxgl-popup",u.getContainer()),this._tip=mi("div","mapboxgl-popup-tip",x),x.appendChild(p)),this.options.maxWidth&&x.style.maxWidth!==this.options.maxWidth&&(x.style.maxWidth=this.options.maxWidth),u.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Ld(this._lngLat,this._pos,u.transform)),!this._trackPointer||_){const M=this._pos=this._trackPointer&&_?_:u.project(this._lngLat),E=lf(this.options.offset),P=this._anchor=this._getAnchor(E.y),O=lf(this.options.offset,P),N=M.add(O).round();u._requestDomTask(()=>{this._container&&P&&(this._container.style.transform=`${Od[P]} translate(${N.x}px,${N.y}px)`)})}if(!this._marker&&u._showingGlobe()){const M=g.isLngLatBehindGlobe(u.transform,this._lngLat)?0:1;this._setOpacity(M)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const _=this._container.querySelector(af);_&&_.focus()}_onClose(){this.remove()}_setOpacity(_){this._container&&(this._container.style.opacity=`${_}`),this._content&&(this._content.style.pointerEvents=_?"auto":"none")}},Marker:sf,Style:gs,LngLat:g.LngLat,LngLatBounds:g.LngLatBounds,Point:g.pointGeometry,MercatorCoordinate:g.MercatorCoordinate,FreeCameraOptions:Nh,Evented:g.Evented,config:g.config,prewarm:function(){Vn().acquire(Pn)},clearPrewarmedResources:function(){const _=Mn;_&&(_.isPreloaded()&&1===_.numActive()?(_.release(Pn),Mn=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return g.config.ACCESS_TOKEN},set accessToken(_){g.config.ACCESS_TOKEN=_},get baseApiUrl(){return g.config.API_URL},set baseApiUrl(_){g.config.API_URL=_},get workerCount(){return Sn.workerCount},set workerCount(_){Sn.workerCount=_},get maxParallelImageRequests(){return g.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(_){g.config.MAX_PARALLEL_IMAGE_REQUESTS=_},clearStorage(_){g.clearTileCache(_)},workerUrl:"",workerClass:null,setNow:g.exported.setNow,restoreNow:g.exported.restoreNow};return Hh}),sr}()}},M0=>{M0(M0.s=25)}]);